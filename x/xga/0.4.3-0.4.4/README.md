# Comparing `tmp/xga-0.4.3.tar.gz` & `tmp/xga-0.4.4.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/xga-0.4.3.tar", last modified: Tue Feb  6 14:57:02 2024, max compression
+gzip compressed data, was "dist/xga-0.4.4.tar", last modified: Thu May  2 15:38:56 2024, max compression
```

## Comparing `xga-0.4.3.tar` & `xga-0.4.4.tar`

### file list

```diff
@@ -1,122 +1,123 @@
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/
--rw-r--r--   0 runner    (1001) docker     (127)      113 2024-02-06 14:56:50.000000 xga-0.4.3/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (127)     9108 2024-02-06 14:57:02.000000 xga-0.4.3/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)     7792 2024-02-06 14:56:50.000000 xga-0.4.3/README.md
--rw-r--r--   0 runner    (1001) docker     (127)      188 2024-02-06 14:57:02.000000 xga-0.4.3/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (127)     1343 2024-02-06 14:56:50.000000 xga-0.4.3/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/tests/
--rw-r--r--   0 runner    (1001) docker     (127)      846 2024-02-06 14:56:50.000000 xga-0.4.3/tests/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/tests/imagetools/
--rw-r--r--   0 runner    (1001) docker     (127)      217 2024-02-06 14:56:50.000000 xga-0.4.3/tests/imagetools/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     7489 2024-02-06 14:56:50.000000 xga-0.4.3/tests/imagetools/test_it_misc.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/tests/sourcetools/
--rw-r--r--   0 runner    (1001) docker     (127)      217 2024-02-06 14:56:50.000000 xga-0.4.3/tests/sourcetools/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     2206 2024-02-06 14:56:50.000000 xga-0.4.3/tests/sourcetools/test_st_misc.py
--rw-r--r--   0 runner    (1001) docker     (127)    68829 2024-02-06 14:56:50.000000 xga-0.4.3/versioneer.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/
--rw-r--r--   0 runner    (1001) docker     (127)      587 2024-02-06 14:56:50.000000 xga-0.4.3/xga/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    18661 2024-02-06 14:56:50.000000 xga-0.4.3/xga/_version.py
--rw-r--r--   0 runner    (1001) docker     (127)    16280 2024-02-06 14:56:50.000000 xga-0.4.3/xga/exceptions.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/files/
--rw-r--r--   0 runner    (1001) docker     (127)     1012 2024-02-06 14:56:50.000000 xga-0.4.3/xga/files/add_model_list.txt
--rw-r--r--   0 runner    (1001) docker     (127)    38322 2024-02-06 14:56:50.000000 xga-0.4.3/xga/files/long_xga_logo.png
--rw-r--r--   0 runner    (1001) docker     (127)      387 2024-02-06 14:56:50.000000 xga-0.4.3/xga/files/mult_model_list.txt
--rw-r--r--   0 runner    (1001) docker     (127)    55115 2024-02-06 14:56:50.000000 xga-0.4.3/xga/files/quick_xga_logo.png
--rw-r--r--   0 runner    (1001) docker     (127)    21617 2024-02-06 14:56:50.000000 xga-0.4.3/xga/files/sas_errors.csv
--rw-r--r--   0 runner    (1001) docker     (127)    15346 2024-02-06 14:56:50.000000 xga-0.4.3/xga/files/sas_warnings.csv
--rw-r--r--   0 runner    (1001) docker     (127)    16975 2024-02-06 14:56:50.000000 xga-0.4.3/xga/files/xspec_model_pars.json5
--rw-r--r--   0 runner    (1001) docker     (127)    11690 2024-02-06 14:56:50.000000 xga-0.4.3/xga/files/xspec_model_units.json5
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/imagetools/
--rw-r--r--   0 runner    (1001) docker     (127)      347 2024-02-06 14:56:50.000000 xga-0.4.3/xga/imagetools/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    15405 2024-02-06 14:56:50.000000 xga-0.4.3/xga/imagetools/bin.py
--rw-r--r--   0 runner    (1001) docker     (127)    14581 2024-02-06 14:56:50.000000 xga-0.4.3/xga/imagetools/misc.py
--rw-r--r--   0 runner    (1001) docker     (127)    21456 2024-02-06 14:56:50.000000 xga-0.4.3/xga/imagetools/profile.py
--rw-r--r--   0 runner    (1001) docker     (127)    15234 2024-02-06 14:56:50.000000 xga-0.4.3/xga/imagetools/psf.py
--rw-r--r--   0 runner    (1001) docker     (127)    10252 2024-02-06 14:56:50.000000 xga-0.4.3/xga/imagetools/smooth.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/models/
--rw-r--r--   0 runner    (1001) docker     (127)     4709 2024-02-06 14:56:50.000000 xga-0.4.3/xga/models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    59947 2024-02-06 14:56:50.000000 xga-0.4.3/xga/models/base.py
--rw-r--r--   0 runner    (1001) docker     (127)    35832 2024-02-06 14:56:50.000000 xga-0.4.3/xga/models/density.py
--rw-r--r--   0 runner    (1001) docker     (127)     3548 2024-02-06 14:56:50.000000 xga-0.4.3/xga/models/fitting.py
--rw-r--r--   0 runner    (1001) docker     (127)     2248 2024-02-06 14:56:50.000000 xga-0.4.3/xga/models/misc.py
--rw-r--r--   0 runner    (1001) docker     (127)    24643 2024-02-06 14:56:50.000000 xga-0.4.3/xga/models/sb.py
--rw-r--r--   0 runner    (1001) docker     (127)    16630 2024-02-06 14:56:50.000000 xga-0.4.3/xga/models/temperature.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/products/
--rw-r--r--   0 runner    (1001) docker     (127)      704 2024-02-06 14:56:50.000000 xga-0.4.3/xga/products/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)   153439 2024-02-06 14:56:50.000000 xga-0.4.3/xga/products/base.py
--rw-r--r--   0 runner    (1001) docker     (127)    73512 2024-02-06 14:56:50.000000 xga-0.4.3/xga/products/lightcurve.py
--rw-r--r--   0 runner    (1001) docker     (127)     1182 2024-02-06 14:56:50.000000 xga-0.4.3/xga/products/misc.py
--rw-r--r--   0 runner    (1001) docker     (127)   190844 2024-02-06 14:56:50.000000 xga-0.4.3/xga/products/phot.py
--rw-r--r--   0 runner    (1001) docker     (127)   136143 2024-02-06 14:56:50.000000 xga-0.4.3/xga/products/profile.py
--rw-r--r--   0 runner    (1001) docker     (127)    83783 2024-02-06 14:56:50.000000 xga-0.4.3/xga/products/relation.py
--rw-r--r--   0 runner    (1001) docker     (127)   167696 2024-02-06 14:56:50.000000 xga-0.4.3/xga/products/spec.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/relations/
--rw-r--r--   0 runner    (1001) docker     (127)      218 2024-02-06 14:56:50.000000 xga-0.4.3/xga/relations/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/relations/clusters/
--rw-r--r--   0 runner    (1001) docker     (127)     1620 2024-02-06 14:56:50.000000 xga-0.4.3/xga/relations/clusters/LT.py
--rw-r--r--   0 runner    (1001) docker     (127)      872 2024-02-06 14:56:50.000000 xga-0.4.3/xga/relations/clusters/Lλ.py
--rw-r--r--   0 runner    (1001) docker     (127)     3855 2024-02-06 14:56:50.000000 xga-0.4.3/xga/relations/clusters/MT.py
--rw-r--r--   0 runner    (1001) docker     (127)      225 2024-02-06 14:56:50.000000 xga-0.4.3/xga/relations/clusters/Mλ.py
--rw-r--r--   0 runner    (1001) docker     (127)     3481 2024-02-06 14:56:50.000000 xga-0.4.3/xga/relations/clusters/RT.py
--rw-r--r--   0 runner    (1001) docker     (127)     1587 2024-02-06 14:56:50.000000 xga-0.4.3/xga/relations/clusters/TL.py
--rw-r--r--   0 runner    (1001) docker     (127)      325 2024-02-06 14:56:50.000000 xga-0.4.3/xga/relations/clusters/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    29780 2024-02-06 14:56:50.000000 xga-0.4.3/xga/relations/fit.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/samples/
--rw-r--r--   0 runner    (1001) docker     (127)      365 2024-02-06 14:56:50.000000 xga-0.4.3/xga/samples/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    26678 2024-02-06 14:56:50.000000 xga-0.4.3/xga/samples/base.py
--rw-r--r--   0 runner    (1001) docker     (127)    88457 2024-02-06 14:56:50.000000 xga-0.4.3/xga/samples/extended.py
--rw-r--r--   0 runner    (1001) docker     (127)    20608 2024-02-06 14:56:50.000000 xga-0.4.3/xga/samples/general.py
--rw-r--r--   0 runner    (1001) docker     (127)    13296 2024-02-06 14:56:50.000000 xga-0.4.3/xga/samples/point.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/sas/
--rw-r--r--   0 runner    (1001) docker     (127)      318 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sas/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    15331 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sas/_common.py
--rw-r--r--   0 runner    (1001) docker     (127)    22112 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sas/lightcurve.py
--rw-r--r--   0 runner    (1001) docker     (127)     3996 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sas/misc.py
--rw-r--r--   0 runner    (1001) docker     (127)    28627 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sas/phot.py
--rw-r--r--   0 runner    (1001) docker     (127)    16188 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sas/run.py
--rw-r--r--   0 runner    (1001) docker     (127)    54920 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sas/spec.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/sources/
--rw-r--r--   0 runner    (1001) docker     (127)      370 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sources/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)   254537 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sources/base.py
--rw-r--r--   0 runner    (1001) docker     (127)    71159 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sources/extended.py
--rw-r--r--   0 runner    (1001) docker     (127)    37987 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sources/general.py
--rw-r--r--   0 runner    (1001) docker     (127)    14617 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sources/point.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/sourcetools/
--rw-r--r--   0 runner    (1001) docker     (127)      308 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     8228 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/_common.py
--rw-r--r--   0 runner    (1001) docker     (127)    45416 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/density.py
--rw-r--r--   0 runner    (1001) docker     (127)     4777 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/deproj.py
--rw-r--r--   0 runner    (1001) docker     (127)    13858 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/entropy.py
--rw-r--r--   0 runner    (1001) docker     (127)    13599 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/mass.py
--rw-r--r--   0 runner    (1001) docker     (127)    38586 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/match.py
--rw-r--r--   0 runner    (1001) docker     (127)     9086 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/misc.py
--rw-r--r--   0 runner    (1001) docker     (127)    47485 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/stack.py
--rw-r--r--   0 runner    (1001) docker     (127)    55307 2024-02-06 14:56:50.000000 xga-0.4.3/xga/sourcetools/temperature.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/tools/
--rw-r--r--   0 runner    (1001) docker     (127)      242 2024-02-06 14:56:50.000000 xga-0.4.3/xga/tools/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/tools/clusters/
--rw-r--r--   0 runner    (1001) docker     (127)    40027 2024-02-06 14:56:50.000000 xga-0.4.3/xga/tools/clusters/LT.py
--rw-r--r--   0 runner    (1001) docker     (127)      266 2024-02-06 14:56:50.000000 xga-0.4.3/xga/tools/clusters/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    24247 2024-02-06 14:56:50.000000 xga-0.4.3/xga/utils.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/xspec/
--rw-r--r--   0 runner    (1001) docker     (127)      387 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    11909 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec/fakeit.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/xspec/fit/
--rw-r--r--   0 runner    (1001) docker     (127)      302 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec/fit/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    12625 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec/fit/_common.py
--rw-r--r--   0 runner    (1001) docker     (127)    55552 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec/fit/general.py
--rw-r--r--   0 runner    (1001) docker     (127)    10831 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec/fit/profile.py
--rw-r--r--   0 runner    (1001) docker     (127)    18696 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec/run.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga/xspec_scripts/
--rw-r--r--   0 runner    (1001) docker     (127)     6273 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec_scripts/cr_conv_calc.xcm
--rw-r--r--   0 runner    (1001) docker     (127)    21107 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec_scripts/crossarf_xspec_fit.xcm
--rw-r--r--   0 runner    (1001) docker     (127)    20818 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec_scripts/general_xspec_fit.xcm
--rw-r--r--   0 runner    (1001) docker     (127)     3198 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec_scripts/get_pars.tcl
--rw-r--r--   0 runner    (1001) docker     (127)       28 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec_scripts/null_script.xcm
--rw-r--r--   0 runner    (1001) docker     (127)    13829 2024-02-06 14:56:50.000000 xga-0.4.3/xga/xspec_scripts/xga_extract.tcl
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-02-06 14:57:02.000000 xga-0.4.3/xga.egg-info/
--rw-r--r--   0 runner    (1001) docker     (127)     9108 2024-02-06 14:57:01.000000 xga-0.4.3/xga.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)     2431 2024-02-06 14:57:02.000000 xga-0.4.3/xga.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-02-06 14:57:01.000000 xga-0.4.3/xga.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (127)      219 2024-02-06 14:57:01.000000 xga-0.4.3/xga.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (127)       10 2024-02-06 14:57:01.000000 xga-0.4.3/xga.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/
+-rw-r--r--   0 runner    (1001) docker     (127)      113 2024-05-02 15:38:51.000000 xga-0.4.4/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (127)     9108 2024-05-02 15:38:56.000000 xga-0.4.4/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)     7792 2024-05-02 15:38:51.000000 xga-0.4.4/README.md
+-rw-r--r--   0 runner    (1001) docker     (127)      188 2024-05-02 15:38:56.000000 xga-0.4.4/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (127)     1343 2024-05-02 15:38:51.000000 xga-0.4.4/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/tests/
+-rw-r--r--   0 runner    (1001) docker     (127)      846 2024-05-02 15:38:51.000000 xga-0.4.4/tests/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/tests/imagetools/
+-rw-r--r--   0 runner    (1001) docker     (127)      217 2024-05-02 15:38:51.000000 xga-0.4.4/tests/imagetools/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7489 2024-05-02 15:38:51.000000 xga-0.4.4/tests/imagetools/test_it_misc.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/tests/sourcetools/
+-rw-r--r--   0 runner    (1001) docker     (127)      217 2024-05-02 15:38:51.000000 xga-0.4.4/tests/sourcetools/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2206 2024-05-02 15:38:51.000000 xga-0.4.4/tests/sourcetools/test_st_misc.py
+-rw-r--r--   0 runner    (1001) docker     (127)    68829 2024-05-02 15:38:52.000000 xga-0.4.4/versioneer.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/
+-rw-r--r--   0 runner    (1001) docker     (127)      587 2024-05-02 15:38:52.000000 xga-0.4.4/xga/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    18661 2024-05-02 15:38:52.000000 xga-0.4.4/xga/_version.py
+-rw-r--r--   0 runner    (1001) docker     (127)    16280 2024-05-02 15:38:52.000000 xga-0.4.4/xga/exceptions.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/files/
+-rw-r--r--   0 runner    (1001) docker     (127)     1012 2024-05-02 15:38:52.000000 xga-0.4.4/xga/files/add_model_list.txt
+-rw-r--r--   0 runner    (1001) docker     (127)    38322 2024-05-02 15:38:52.000000 xga-0.4.4/xga/files/long_xga_logo.png
+-rw-r--r--   0 runner    (1001) docker     (127)      387 2024-05-02 15:38:52.000000 xga-0.4.4/xga/files/mult_model_list.txt
+-rw-r--r--   0 runner    (1001) docker     (127)    55115 2024-05-02 15:38:52.000000 xga-0.4.4/xga/files/quick_xga_logo.png
+-rw-r--r--   0 runner    (1001) docker     (127)    21617 2024-05-02 15:38:52.000000 xga-0.4.4/xga/files/sas_errors.csv
+-rw-r--r--   0 runner    (1001) docker     (127)    15346 2024-05-02 15:38:52.000000 xga-0.4.4/xga/files/sas_warnings.csv
+-rw-r--r--   0 runner    (1001) docker     (127)    16975 2024-05-02 15:38:52.000000 xga-0.4.4/xga/files/xspec_model_pars.json5
+-rw-r--r--   0 runner    (1001) docker     (127)    11690 2024-05-02 15:38:52.000000 xga-0.4.4/xga/files/xspec_model_units.json5
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/imagetools/
+-rw-r--r--   0 runner    (1001) docker     (127)      347 2024-05-02 15:38:52.000000 xga-0.4.4/xga/imagetools/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    15405 2024-05-02 15:38:52.000000 xga-0.4.4/xga/imagetools/bin.py
+-rw-r--r--   0 runner    (1001) docker     (127)    14581 2024-05-02 15:38:52.000000 xga-0.4.4/xga/imagetools/misc.py
+-rw-r--r--   0 runner    (1001) docker     (127)    21456 2024-05-02 15:38:52.000000 xga-0.4.4/xga/imagetools/profile.py
+-rw-r--r--   0 runner    (1001) docker     (127)    15234 2024-05-02 15:38:52.000000 xga-0.4.4/xga/imagetools/psf.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10252 2024-05-02 15:38:52.000000 xga-0.4.4/xga/imagetools/smooth.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/models/
+-rw-r--r--   0 runner    (1001) docker     (127)     4709 2024-05-02 15:38:52.000000 xga-0.4.4/xga/models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    59947 2024-05-02 15:38:52.000000 xga-0.4.4/xga/models/base.py
+-rw-r--r--   0 runner    (1001) docker     (127)    35832 2024-05-02 15:38:52.000000 xga-0.4.4/xga/models/density.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3548 2024-05-02 15:38:52.000000 xga-0.4.4/xga/models/fitting.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2248 2024-05-02 15:38:52.000000 xga-0.4.4/xga/models/misc.py
+-rw-r--r--   0 runner    (1001) docker     (127)    24643 2024-05-02 15:38:52.000000 xga-0.4.4/xga/models/sb.py
+-rw-r--r--   0 runner    (1001) docker     (127)    16630 2024-05-02 15:38:52.000000 xga-0.4.4/xga/models/temperature.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/products/
+-rw-r--r--   0 runner    (1001) docker     (127)      704 2024-05-02 15:38:52.000000 xga-0.4.4/xga/products/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)   153439 2024-05-02 15:38:52.000000 xga-0.4.4/xga/products/base.py
+-rw-r--r--   0 runner    (1001) docker     (127)    73512 2024-05-02 15:38:52.000000 xga-0.4.4/xga/products/lightcurve.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1182 2024-05-02 15:38:52.000000 xga-0.4.4/xga/products/misc.py
+-rw-r--r--   0 runner    (1001) docker     (127)   194625 2024-05-02 15:38:52.000000 xga-0.4.4/xga/products/phot.py
+-rw-r--r--   0 runner    (1001) docker     (127)   136143 2024-05-02 15:38:52.000000 xga-0.4.4/xga/products/profile.py
+-rw-r--r--   0 runner    (1001) docker     (127)    87262 2024-05-02 15:38:52.000000 xga-0.4.4/xga/products/relation.py
+-rw-r--r--   0 runner    (1001) docker     (127)   167882 2024-05-02 15:38:52.000000 xga-0.4.4/xga/products/spec.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/relations/
+-rw-r--r--   0 runner    (1001) docker     (127)      218 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/relations/clusters/
+-rw-r--r--   0 runner    (1001) docker     (127)     5637 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/clusters/LT.py
+-rw-r--r--   0 runner    (1001) docker     (127)      942 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/clusters/Lλ.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3855 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/clusters/MT.py
+-rw-r--r--   0 runner    (1001) docker     (127)      225 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/clusters/Mλ.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3481 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/clusters/RT.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1587 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/clusters/TL.py
+-rw-r--r--   0 runner    (1001) docker     (127)      886 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/clusters/Tλ.py
+-rw-r--r--   0 runner    (1001) docker     (127)      325 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/clusters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    29780 2024-05-02 15:38:52.000000 xga-0.4.4/xga/relations/fit.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/samples/
+-rw-r--r--   0 runner    (1001) docker     (127)      365 2024-05-02 15:38:52.000000 xga-0.4.4/xga/samples/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    26678 2024-05-02 15:38:52.000000 xga-0.4.4/xga/samples/base.py
+-rw-r--r--   0 runner    (1001) docker     (127)    91396 2024-05-02 15:38:52.000000 xga-0.4.4/xga/samples/extended.py
+-rw-r--r--   0 runner    (1001) docker     (127)    20608 2024-05-02 15:38:52.000000 xga-0.4.4/xga/samples/general.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13296 2024-05-02 15:38:52.000000 xga-0.4.4/xga/samples/point.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/sas/
+-rw-r--r--   0 runner    (1001) docker     (127)      318 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sas/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    15331 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sas/_common.py
+-rw-r--r--   0 runner    (1001) docker     (127)    22112 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sas/lightcurve.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3996 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sas/misc.py
+-rw-r--r--   0 runner    (1001) docker     (127)    28627 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sas/phot.py
+-rw-r--r--   0 runner    (1001) docker     (127)    18762 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sas/run.py
+-rw-r--r--   0 runner    (1001) docker     (127)    54920 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sas/spec.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/sources/
+-rw-r--r--   0 runner    (1001) docker     (127)      370 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sources/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)   254899 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sources/base.py
+-rw-r--r--   0 runner    (1001) docker     (127)    71159 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sources/extended.py
+-rw-r--r--   0 runner    (1001) docker     (127)    37987 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sources/general.py
+-rw-r--r--   0 runner    (1001) docker     (127)    14617 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sources/point.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/sourcetools/
+-rw-r--r--   0 runner    (1001) docker     (127)      308 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8228 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/_common.py
+-rw-r--r--   0 runner    (1001) docker     (127)    45416 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/density.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4777 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/deproj.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13858 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/entropy.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13599 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/mass.py
+-rw-r--r--   0 runner    (1001) docker     (127)    38586 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/match.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9086 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/misc.py
+-rw-r--r--   0 runner    (1001) docker     (127)    47485 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/stack.py
+-rw-r--r--   0 runner    (1001) docker     (127)    55307 2024-05-02 15:38:52.000000 xga-0.4.4/xga/sourcetools/temperature.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/tools/
+-rw-r--r--   0 runner    (1001) docker     (127)      242 2024-05-02 15:38:52.000000 xga-0.4.4/xga/tools/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/tools/clusters/
+-rw-r--r--   0 runner    (1001) docker     (127)    42641 2024-05-02 15:38:52.000000 xga-0.4.4/xga/tools/clusters/LT.py
+-rw-r--r--   0 runner    (1001) docker     (127)      266 2024-05-02 15:38:52.000000 xga-0.4.4/xga/tools/clusters/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    24247 2024-05-02 15:38:52.000000 xga-0.4.4/xga/utils.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/xspec/
+-rw-r--r--   0 runner    (1001) docker     (127)      387 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    11909 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec/fakeit.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/xspec/fit/
+-rw-r--r--   0 runner    (1001) docker     (127)      302 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec/fit/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12625 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec/fit/_common.py
+-rw-r--r--   0 runner    (1001) docker     (127)    55552 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec/fit/general.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10831 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec/fit/profile.py
+-rw-r--r--   0 runner    (1001) docker     (127)    18696 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec/run.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga/xspec_scripts/
+-rw-r--r--   0 runner    (1001) docker     (127)     6273 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec_scripts/cr_conv_calc.xcm
+-rw-r--r--   0 runner    (1001) docker     (127)    21107 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec_scripts/crossarf_xspec_fit.xcm
+-rw-r--r--   0 runner    (1001) docker     (127)    20818 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec_scripts/general_xspec_fit.xcm
+-rw-r--r--   0 runner    (1001) docker     (127)     3198 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec_scripts/get_pars.tcl
+-rw-r--r--   0 runner    (1001) docker     (127)       28 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec_scripts/null_script.xcm
+-rw-r--r--   0 runner    (1001) docker     (127)    13829 2024-05-02 15:38:52.000000 xga-0.4.4/xga/xspec_scripts/xga_extract.tcl
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-05-02 15:38:56.000000 xga-0.4.4/xga.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (127)     9108 2024-05-02 15:38:56.000000 xga-0.4.4/xga.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)     2461 2024-05-02 15:38:56.000000 xga-0.4.4/xga.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-05-02 15:38:56.000000 xga-0.4.4/xga.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (127)      219 2024-05-02 15:38:56.000000 xga-0.4.4/xga.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       10 2024-05-02 15:38:56.000000 xga-0.4.4/xga.egg-info/top_level.txt
```

### Comparing `xga-0.4.3/PKG-INFO` & `xga-0.4.4/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: xga
-Version: 0.4.3
+Version: 0.4.4
 Summary: Python package to easily generate and analyse XMM data products
 Home-page: http://github.com/DavidT3/XGA
 Author: David Turner
 Author-email: david.turner@sussex.ac.uk
 License: UNKNOWN
 Description: <p align="center">
             <img src="https://raw.githubusercontent.com/DavidT3/XGA/master/xga/files/long_xga_logo.png" width="500">
```

### Comparing `xga-0.4.3/README.md` & `xga-0.4.4/README.md`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/setup.py` & `xga-0.4.4/setup.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/tests/__init__.py` & `xga-0.4.4/tests/__init__.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/tests/imagetools/test_it_misc.py` & `xga-0.4.4/tests/imagetools/test_it_misc.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/tests/sourcetools/test_st_misc.py` & `xga-0.4.4/tests/sourcetools/test_st_misc.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/versioneer.py` & `xga-0.4.4/versioneer.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/__init__.py` & `xga-0.4.4/xga/__init__.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/_version.py` & `xga-0.4.4/xga/_version.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/exceptions.py` & `xga-0.4.4/xga/exceptions.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/files/add_model_list.txt` & `xga-0.4.4/xga/files/add_model_list.txt`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/files/long_xga_logo.png` & `xga-0.4.4/xga/files/long_xga_logo.png`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/files/quick_xga_logo.png` & `xga-0.4.4/xga/files/quick_xga_logo.png`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/files/sas_errors.csv` & `xga-0.4.4/xga/files/sas_errors.csv`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/files/sas_warnings.csv` & `xga-0.4.4/xga/files/sas_warnings.csv`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/files/xspec_model_pars.json5` & `xga-0.4.4/xga/files/xspec_model_pars.json5`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/files/xspec_model_units.json5` & `xga-0.4.4/xga/files/xspec_model_units.json5`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/imagetools/bin.py` & `xga-0.4.4/xga/imagetools/bin.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/imagetools/misc.py` & `xga-0.4.4/xga/imagetools/misc.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/imagetools/profile.py` & `xga-0.4.4/xga/imagetools/profile.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/imagetools/psf.py` & `xga-0.4.4/xga/imagetools/psf.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/imagetools/smooth.py` & `xga-0.4.4/xga/imagetools/smooth.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/models/__init__.py` & `xga-0.4.4/xga/models/__init__.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/models/base.py` & `xga-0.4.4/xga/models/base.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/models/density.py` & `xga-0.4.4/xga/models/density.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/models/fitting.py` & `xga-0.4.4/xga/models/fitting.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/models/misc.py` & `xga-0.4.4/xga/models/misc.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/models/sb.py` & `xga-0.4.4/xga/models/sb.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/models/temperature.py` & `xga-0.4.4/xga/models/temperature.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/products/__init__.py` & `xga-0.4.4/xga/products/__init__.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/products/base.py` & `xga-0.4.4/xga/products/base.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/products/lightcurve.py` & `xga-0.4.4/xga/products/lightcurve.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/products/misc.py` & `xga-0.4.4/xga/products/misc.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/products/phot.py` & `xga-0.4.4/xga/products/phot.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #  This code is a part of X-ray: Generate and Analyse (XGA), a module designed for the XMM Cluster Survey (XCS).
-#  Last modified by David J Turner (turne540@msu.edu) 07/11/2023, 10:16. Copyright (c) The Contributors
+#  Last modified by David J Turner (turne540@msu.edu) 15/03/2024, 13:31. Copyright (c) The Contributors
 
 import os
 import warnings
 from copy import deepcopy
 from typing import Tuple, List, Union, Dict
 
 import numpy as np
@@ -1047,15 +1047,16 @@
         return peak_conv, None
 
     def get_view(self, ax: Axes, cross_hair: Quantity = None, mask: np.ndarray = None,
                  chosen_points: np.ndarray = None, other_points: List[np.ndarray] = None, zoom_in: bool = False,
                  manual_zoom_xlims: tuple = None, manual_zoom_ylims: tuple = None,
                  radial_bins_pix: np.ndarray = np.array([]), back_bin_pix: np.ndarray = None,
                  stretch: BaseStretch = LogStretch(), mask_edges: bool = True, view_regions: bool = False,
-                 ch_thickness: float = 0.8) -> Axes:
+                 ch_thickness: float = 0.8, low_val_lim: float = None, upp_val_lim: float = None,
+                 custom_title: str = None) -> Axes:
         """
         The method that creates and populates the view axes, separate from actual view so outside methods
         can add a view to other matplotlib axes.
 
         :param Axes ax: The matplotlib axes on which to show the image.
         :param Quantity cross_hair: An optional parameter that can be used to plot a cross hair at
             the coordinates. Up to two cross-hairs can be plotted, as any more can be visually confusing. If
@@ -1085,26 +1086,45 @@
         :param BaseStretch stretch: The astropy scaling to use for the image data, default is log.
         :param bool mask_edges: If viewing a RateMap, this variable will control whether the chip edges are masked
             to remove artificially bright pixels, default is True.
         :param bool view_regions: If regions have been associated with this object (either on init or using
             the 'regions' property setter, should they be displayed. Default is False.
         :param float ch_thickness: The desired linewidth of the crosshair(s), can be useful to increase this in
             certain circumstances. Default is 0.8.
+        :param float low_val_lim: This can be used to set a lower limit for the value range across which an image
+            is scaled and normalised (i.e. a ManualInterval from Astropy). The default is None, and if low_val_lim is
+            not None, upp_val_lim must be as well.
+        :param float upp_val_lim: This can be used to set an upper limit for the value range across which an image
+            is scaled and normalised (i.e. a ManualInterval from Astropy). The default is None, and if upp_val_lim is
+            not None, low_val_lim must be as well.
+        :param str custom_title: If set, this will overwrite the automatically generated title for this
+            visualisation. Default is None.
         :return: A populated figure displaying the view of the data.
         :rtype: Axes
         """
 
         if mask is not None and mask.shape != self.data.shape:
             raise ValueError("The shape of the mask array ({0}) must be the same as that of the data array "
                              "({1}).".format(mask.shape, self.data.shape))
         elif mask is not None and mask.shape == self.data.shape:
             plot_data = self.data * mask
         else:
             plot_data = self.data
 
+        # We check that the values that set manual value limits are legal, otherwise we throw an error
+        check_lim_arg = [low_val_lim is None, upp_val_lim is None]
+        if any(check_lim_arg) and not all(check_lim_arg):
+            raise ValueError("Either 'low_val_lim' and 'upp_val_lim' are both None, or both have values.")
+        elif not all(check_lim_arg) and low_val_lim >= upp_val_lim:
+            raise ValueError("The 'low_val_lim' argument must be lower than 'upp_val_lim'.")
+        elif not all(check_lim_arg):
+            interval = ManualInterval(low_val_lim, upp_val_lim)
+        else:
+            interval = MinMaxInterval()
+
         # If we're showing a RateMap, then we're gonna apply an edge mask to remove all the artificially brightened
         #  pixels that we can - it makes the view look better
         if type(self) == RateMap and mask_edges:
             plot_data *= self.edge_mask
 
         ax.tick_params(axis='both', direction='in', which='both', top=False, right=False)
         ax.xaxis.set_ticklabels([])
@@ -1113,35 +1133,40 @@
         # Check if this is a combined product, because if it is then ObsID and instrument are both 'combined'
         #  and it makes the title ugly
         if self.obs_id == "combined":
             ident = 'Combined'
         else:
             ident = "{o} {i}".format(o=self.obs_id, i=self.instrument.upper())
 
-        if self.src_name is not None:
-            title = "{n} - {i} {l}-{u}keV {t}".format(n=self.src_name, i=ident,
-                                                      l=self._energy_bounds[0].to("keV").value,
-                                                      u=self._energy_bounds[1].to("keV").value, t=self.type)
-        else:
-            title = "{i} {l}-{u}keV {t}".format(i=ident, l=self._energy_bounds[0].to("keV").value,
-                                                u=self._energy_bounds[1].to("keV").value, t=self.type)
-
-        # Its helpful to be able to distinguish PSF corrected image/ratemaps from the title
-        if self.psf_corrected:
-            title += ' - PSF Corrected'
+        # Ugly nested if statement but oh well I'm in a hurry - if the custom title is None then we auto generate a
+        #  title - otherwise we use the custom title and don't add anything to it
+        if custom_title is None:
+            if self.src_name is not None:
+                title = "{n} - {i} {l}-{u}keV {t}".format(n=self.src_name, i=ident,
+                                                          l=self._energy_bounds[0].to("keV").value,
+                                                          u=self._energy_bounds[1].to("keV").value, t=self.type)
+            else:
+                title = "{i} {l}-{u}keV {t}".format(i=ident, l=self._energy_bounds[0].to("keV").value,
+                                                    u=self._energy_bounds[1].to("keV").value, t=self.type)
 
-        # And smoothed as well
-        if self.smoothed:
-            title += ' - Smoothed'
+            # Its helpful to be able to distinguish PSF corrected image/ratemaps from the title
+            if self.psf_corrected:
+                title += ' - PSF Corrected'
+
+            # And smoothed as well
+            if self.smoothed:
+                title += ' - Smoothed'
+        else:
+            title = custom_title
 
         ax.set_title(title)
 
         # As this is a very quick view method, users will not be offered a choice of scaling
         #  There will be a more in depth way of viewing cluster data eventually
-        norm = ImageNormalize(data=plot_data, interval=MinMaxInterval(), stretch=stretch)
+        norm = ImageNormalize(data=plot_data, interval=interval, stretch=stretch)
         # I normalize with a log stretch, and use gnuplot2 colormap (pretty decent for clusters imo)
 
         # If we want to plot point clusters on the image, then we go here
         if chosen_points is not None:
             # Add the point cluster points
             ax.plot(chosen_points[:, 0], chosen_points[:, 1], '+', color='black', label="Chosen Point Cluster")
             ax.legend(loc="best")
@@ -1234,15 +1259,15 @@
         return ax
 
     def view(self, cross_hair: Quantity = None, mask: np.ndarray = None, chosen_points: np.ndarray = None,
              other_points: List[np.ndarray] = None, figsize: Tuple = (10, 8), zoom_in: bool = False,
              manual_zoom_xlims: tuple = None, manual_zoom_ylims: tuple = None,
              radial_bins_pix: np.ndarray = np.array([]), back_bin_pix: np.ndarray = None,
              stretch: BaseStretch = LogStretch(), mask_edges: bool = True, view_regions: bool = False,
-             ch_thickness: float = 0.8):
+             ch_thickness: float = 0.8, low_val_lim: float = None, upp_val_lim: float = None, custom_title: str = None):
         """
         Powerful method to view this Image/RateMap/Expmap, with different options that can be used for eyeballing
         and producing figures for publication.
 
         :param Quantity cross_hair: An optional parameter that can be used to plot a cross hair at
             the coordinates. Up to two cross-hairs can be plotted, as any more can be visually confusing. If
             passing two, each row of a quantity is considered to be a separate coordinate pair.
@@ -1270,38 +1295,47 @@
         :param BaseStretch stretch: The astropy scaling to use for the image data, default is log.
         :param bool mask_edges: If viewing a RateMap, this variable will control whether the chip edges are masked
             to remove artificially bright pixels, default is True.
         :param bool view_regions: If regions have been associated with this object (either on init or using
             the 'regions' property setter, should they be displayed. Default is False.
         :param float ch_thickness: The desired linewidth of the crosshair(s), can be useful to increase this in
             certain circumstances. Default is 0.8.
+        :param float low_val_lim: This can be used to set a lower limit for the value range across which an image
+            is scaled and normalised (i.e. a ManualInterval from Astropy). The default is None, and if low_val_lim is
+            not None, upp_val_lim must be as well.
+        :param float upp_val_lim: This can be used to set an upper limit for the value range across which an image
+            is scaled and normalised (i.e. a ManualInterval from Astropy). The default is None, and if upp_val_lim is
+            not None, low_val_lim must be as well.
+        :param str custom_title: If set, this will overwrite the automatically generated title for this
+            visualisation. Default is None.
         """
 
         # Create figure object
         fig = plt.figure(figsize=figsize)
 
         ax = plt.gca()
         ax = self.get_view(ax, cross_hair, mask, chosen_points, other_points, zoom_in, manual_zoom_xlims,
                            manual_zoom_ylims, radial_bins_pix, back_bin_pix, stretch, mask_edges, view_regions,
-                           ch_thickness)
+                           ch_thickness, low_val_lim, upp_val_lim, custom_title)
         cbar = plt.colorbar(ax.images[0])
         cbar.ax.set_ylabel(self.data_unit.to_string('latex'), fontsize=15)
         plt.tight_layout()
         # Display the image
         plt.show()
 
         # Wipe the figure
         plt.close("all")
 
     def save_view(self, save_path: str, cross_hair: Quantity = None, mask: np.ndarray = None,
                   chosen_points: np.ndarray = None, other_points: List[np.ndarray] = None, figsize: Tuple = (10, 8),
                   zoom_in: bool = False, manual_zoom_xlims: tuple = None, manual_zoom_ylims: tuple = None,
                   radial_bins_pix: np.ndarray = np.array([]), back_bin_pix: np.ndarray = None,
                   stretch: BaseStretch = LogStretch(), mask_edges: bool = True, view_regions: bool = False,
-                  ch_thickness: float = 0.8):
+                  ch_thickness: float = 0.8, low_val_lim: float = None, upp_val_lim: float = None,
+                  custom_title: str = None):
         """
         This is entirely equivalent to the view() method, but instead of displaying the view it will save it to
         a path of your choosing.
 
         :param str save_path: The path (including file name) where you wish to save the view.
         :param Quantity cross_hair: An optional parameter that can be used to plot a cross hair at
             the coordinates. Up to two cross-hairs can be plotted, as any more can be visually confusing. If
@@ -1330,25 +1364,33 @@
         :param BaseStretch stretch: The astropy scaling to use for the image data, default is log.
         :param bool mask_edges: If viewing a RateMap, this variable will control whether the chip edges are masked
             to remove artificially bright pixels, default is True.
         :param bool view_regions: If regions have been associated with this object (either on init or using
             the 'regions' property setter, should they be displayed. Default is False.
         :param float ch_thickness: The desired linewidth of the crosshair(s), can be useful to increase this in
             certain circumstances. Default is 0.8.
+        :param float low_val_lim: This can be used to set a lower limit for the value range across which an image
+            is scaled and normalised (i.e. a ManualInterval from Astropy). The default is None, and if low_val_lim is
+            not None, upp_val_lim must be as well.
+        :param float upp_val_lim: This can be used to set an upper limit for the value range across which an image
+            is scaled and normalised (i.e. a ManualInterval from Astropy). The default is None, and if upp_val_lim is
+            not None, low_val_lim must be as well.
+        :param str custom_title: If set, this will overwrite the automatically generated title for this
+            visualisation. Default is None.
         """
 
         # Create figure object
         fig = plt.figure(figsize=figsize)
 
         # Turns off any ticks and tick labels, we don't want them in an image
         ax = plt.gca()
 
         ax = self.get_view(ax, cross_hair, mask, chosen_points, other_points, zoom_in, manual_zoom_xlims,
                            manual_zoom_ylims, radial_bins_pix, back_bin_pix, stretch, mask_edges, view_regions,
-                           ch_thickness)
+                           ch_thickness, low_val_lim, upp_val_lim, custom_title)
         cbar = plt.colorbar(ax.images[0], label=self.data_unit.to_string('latex'))
         cbar.ax.set_ylabel(self.data_unit.to_string('latex'), fontsize=15)
         plt.tight_layout()
 
         # Save figure to disk
         plt.savefig(save_path)
 
@@ -1832,20 +1874,22 @@
             This method is called by an _InteractiveView instance when regions need to be drawn on top of the
             data view axis (i.e. the image/ratemap). Either for the first time or as an update due to a button
             click, region changing, or new region being added.
             """
             # These artists are the ones that represent regions, the ones in self._ignore_arts are there
             #  just for visualisation (for instance showing an analysis/background region) and can't be
             #  turned on or off, can't be edited, and shouldn't be saved.
-            rel_artists = [arty for arty in self._im_ax.artists if arty not in self._ignore_arts]
+            # rel_artists = [arty for arty in self._im_ax.artists if arty not in self._ignore_arts]
+            rel_artists = [arty for arty in self._im_ax.patches if arty not in self._ignore_arts]
 
             # This will trigger in initial cases where there ARE regions associated with the photometric product
             #  that has spawned this InteractiveView, but they haven't been added as artists yet. ALSO, this will
             #  always run prior to any artists being added that are just there to indicate analysis regions, see
             #  toward the end of the __init__ for what I mean.
+
             if len(rel_artists) == 0 and len([r for o, rl in self._regions.items() for r in rl]) != 0:
                 for o in self._regions:
                     for region in self._regions[o]:
                         # Uses the region module's convenience function to turn the region into a matplotlib artist
                         art_reg = region.as_artist()
                         # Makes sure that the region can be 'picked', which enables selecting regions to modify
                         art_reg.set_picker(True)
@@ -1869,15 +1913,16 @@
                         # Here we save the knowledge of which artists belong to which ObsID, and vice versa
                         self._obsid_artists[o].append(art_reg)
                         self._artist_obsids[art_reg] = o
                         # This allows us to lookup the original regions from their artist
                         self._artist_region[art_reg] = region
 
                 # Need to update this in this case
-                rel_artists = [arty for arty in self._im_ax.artists if arty not in self._ignore_arts]
+                # rel_artists = [arty for arty in self._im_ax.artists if arty not in self._ignore_arts]
+                rel_artists = [arty for arty in self._im_ax.patches if arty not in self._ignore_arts]
 
             # This chunk controls which regions will be drawn when this method is called. The _cur_act_reg_type
             #  dictionary has keys representing the four toggle buttons, and their values are True or False. This
             #  first option is triggered if all entries are True and thus draws all regions
             if all(self._cur_act_reg_type.values()):
                 allowed_colours = list(self._colour_convert.keys())
 
@@ -1952,15 +1997,15 @@
                 # Performs the actual re-plotting that takes into account the newly calculated normalisation
                 self._replot_data()
 
             return gen_func
 
         def _change_interval(self, boundaries: Tuple):
             """
-            This method is called when a change is made to the RangeSlider that controls the inverval range
+            This method is called when a change is made to the RangeSlider that controls the interval range
             of the data that is displayed.
 
             :param Tuple boundaries: The lower and upper boundary currently selected by the RangeSlider
                 controlling the interval.
             """
             # Creates a new interval, manually defined this time, with boundaries taken from the RangeSlider
             self._interval = ManualInterval(*boundaries)
@@ -2355,16 +2400,16 @@
                 #  that have been added during the editing.
                 new_reg_dict = {o: [] for o in self._parent_phot_obj.obs_ids}
                 new_reg_dict['new'] = []
 
                 # These artists are the ones that represent regions, the ones in self._ignore_arts are there
                 #  just for visualisation (for instance showing an analysis/background region) and can't be
                 #  turned on or off, can't be edited, and shouldn't be saved.
-                rel_artists = [arty for arty in self._im_ax.artists if arty not in self._ignore_arts]
-
+                # rel_artists = [arty for arty in self._im_ax.artists if arty not in self._ignore_arts]
+                rel_artists = [arty for arty in self._im_ax.patches if arty not in self._ignore_arts]
                 for artist in rel_artists:
                     # Fetches the boolean variable that describes if the region was edited
                     altered = self._edited_dict[artist]
                     # The altered variable is True if an existing region has changed or if a new artist exists
                     if altered and type(artist) == Ellipse:
                         # As instances of this class are always declared internally by an Image class, and I know
                         #  the image class always turns SkyRegions into PixelRegions, we know that its valid to
@@ -2916,28 +2961,28 @@
             edge_flag = True
 
         return edge_flag
 
     def signal_to_noise(self, source_mask: np.ndarray, back_mask: np.ndarray, exp_corr: bool = True,
                         allow_negative: bool = False):
         """
-        A signal to noise calculation method which takes information on source and background regions, then uses
-        that to calculate a signal to noise for the source. This was primarily motivated by the desire to produce
+        A signal-to-noise calculation method which takes information on source and background regions, then uses
+        that to calculate a signal-to-noise for the source. This was primarily motivated by the desire to produce
         valid SNR values for combined data, where uneven exposure times across the combined field of view could
         cause issues with the usual approach of just summing the counts in the region images and scaling by area.
         This method can also measure signal to noises without exposure time correction.
 
         :param np.ndarray source_mask: The mask which defines the source region, ideally with interlopers removed.
         :param np.ndarray back_mask: The mask which defines the background region, ideally with interlopers removed.
-        :param bool exp_corr: Should signal to noises be measured with exposure time correction, default is True. I
+        :param bool exp_corr: Should signal-to-noise be measured with exposure time correction, default is True. I
             recommend that this be true for combined observations, as exposure time could change quite dramatically
             across the combined product.
         :param bool allow_negative: Should pixels in the background subtracted count map be allowed to go below
-            zero, which results in a lower signal to noise (and can result in a negative signal to noise).
-        :return: A signal to noise value for the source region.
+            zero, which results in a lower signal-to-noise (and can result in a negative signal-to-noise).
+        :return: A signal-to-noise value for the source region.
         :rtype: float
         """
         # Perform some quick checks on the masks to check they are broadly compatible with this ratemap
         if source_mask.shape != self.shape:
             raise ValueError("The source mask shape {sm} is not the same as the ratemap shape "
                              "{rt}!".format(sm=source_mask.shape, rt=self.shape))
         elif not (source_mask >= 0).all() or not (source_mask <= 1).all():
```

### Comparing `xga-0.4.3/xga/products/profile.py` & `xga-0.4.4/xga/products/profile.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/products/relation.py` & `xga-0.4.4/xga/products/relation.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #  This code is a part of X-ray: Generate and Analyse (XGA), a module designed for the XMM Cluster Survey (XCS).
-#  Last modified by David J Turner (turne540@msu.edu) 30/11/2023, 19:50. Copyright (c) The Contributors
+#  Last modified by David J Turner (turne540@msu.edu) 28/02/2024, 10:43. Copyright (c) The Contributors
 
 import inspect
 import pickle
 from copy import deepcopy
 from datetime import date
 from typing import List, Union, Tuple
 from warnings import warn
@@ -15,15 +15,15 @@
 from cycler import cycler
 from getdist import plots, MCSamples
 from matplotlib import cm
 from matplotlib import pyplot as plt
 from matplotlib.colors import TABLEAU_COLORS, BASE_COLORS, Colormap, CSS4_COLORS, Normalize
 from matplotlib.ticker import FuncFormatter
 
-from ..models import MODEL_PUBLICATION_NAMES
+from ..models import MODEL_PUBLICATION_NAMES, power_law
 
 # This is the default colour cycle for the AggregateScalingRelation view method
 PRETTY_COLOUR_CYCLE = ['tab:gray', 'tab:blue', 'darkgreen', 'firebrick', 'slateblue', 'goldenrod']
 
 # Given the existing structure of this part of XGA, I would have written a BaseRelation class in xga.products.base,
 #  but I can't think of a reason why individual scaling relations should have their own classes. One general class
 #  should be enough. Also I don't want relations to be able to be stored in source objects - these are for samples
@@ -752,35 +752,55 @@
         # If the user passed a save_path value, then we assume they want to save the figure
         if save_path is not None:
             plt.savefig(save_path)
 
         plt.show()
 
     def predict(self, x_values: Quantity, redshift: Union[float, np.ndarray] = None,
-                cosmo: Cosmology = None) -> Quantity:
+                cosmo: Cosmology = None, x_errors: Quantity = None) -> Quantity:
         """
         This method allows for the prediction of y values from this scaling relation, you just need to pass in an
         appropriate set of x values. If a power of E(z) was applied to the y-axis data before fitting, and that
         information was passed on declaration (using 'dim_hubb_ind'), then a redshift and cosmology are required
         to remove out the E(z) contribution.
 
         :param Quantity x_values: The x values to predict y values for.
         :param float/np.ndarray redshift: The redshift(s) of the objects for which we wish to predict values. This is
             only necessary if the 'dim_hubb_ind' argument was set on declaration. Default is None.
         :param Cosmology cosmo: The cosmology in which we wish to predict values. This is only necessary if the
             'dim_hubb_ind' argument was set on declaration. Default is None.
-        :return: The predicted y values.
+        :param Quantity x_errors: The uncertainties for passed x-values. Default is None. If this argument is not None
+            then uncertainties in x-value and the model fit will be propagated to a final prediction uncertainty. If
+            minus and plus uncertainties are passed then they will be averaged before propagation.
+        :return: The predicted y values (and predicted uncertainties if x-errors were passed).
         :rtype: Quantity
         """
         # Got to check that people aren't passing any nonsense x quantities in
         if not x_values.unit.is_equivalent(self.x_unit):
             raise UnitConversionError('Values of x passed to the predict method ({xp}) must be convertible '
                                       'to the x-axis units of this scaling relation '
                                       '({xr}).'.format(xp=x_values.unit.to_string(), xr=self.x_unit.to_string()))
 
+        # Check that if x errors have been passed, they're in the right units
+        if x_errors is not None and x_errors.unit != x_values.unit:
+            raise UnitConversionError("The x errors are not in the same units as 'x_values'.")
+        elif (x_errors is not None and not x_errors.isscalar and not x_values.isscalar and
+              len(x_errors) != len(x_values)):
+            raise ValueError("The length of the 'x_errors' argument ({xe}) should be the same as the 'x_values' "
+                             "argument({xv}).".format(xe=len(x_errors), xv=len(x_values)))
+        elif x_errors is not None and x_errors.isscalar and not x_values.isscalar:
+            raise ValueError("Pass either a non-scalar set of 'x_values' and 'x_errors', a scalar value for both, or a "
+                             "scalar value for 'x_values' and a two-entry value for 'x_errors' (for plus and minus).")
+
+        # We average the uncertainties if there are minus and plus values (bad I know)
+        if x_errors is not None and x_errors.ndim == 2:
+            x_errors = x_errors.mean(axis=1)
+        elif x_errors is not None and x_values.isscalar and not x_errors.isscalar and len(x_errors) == 2:
+            x_errors = x_errors.mean()
+
         # This is a check that all passed x values are within the validity limits of this relation (if the
         #  user passed those on init) - if they aren't a warning will be issued
         if self.x_lims is not None and len(x_values[(x_values < self.x_lims[0]) | (x_values > self.x_lims[1])]) != 0:
             warn("Some of the x values you have passed are outside the validity range of this relation "
                  "({l}-{h}{u}).".format(l=self.x_lims[0].value, h=self.x_lims[1].value, u=self.x_unit.to_string()))
 
         # Need to check if any power of E(z) was applied to the y-axis data before fitting, if so (and no
@@ -792,22 +812,54 @@
             raise ValueError("You must supply one redshift for every entry in x_values.")
         elif self._ez_power is not None and isinstance(redshift, np.ndarray) and len(x_values) != len(redshift):
             raise ValueError("The x_values argument has {x} entries, and the redshift argument has {z} entries; "
                              "please supply one redshift per x_value.".format(x=len(x_values), z=len(redshift)))
 
         # Units that are convertible to the x-units of this relation are allowed, so we make sure we convert
         #  to the exact units the fit was done in. This includes dividing by the x_norm value
-        x_values = x_values.to(self.x_unit) / self.x_norm
+        x_values = x_values.to(self.x_unit)
         # Then we just pass the x_values into the model, along with fit parameters. Then multiply by
         #  the y normalisation
-        predicted_y = self._model_func(x_values.value, *self.pars[:, 0]) * self.y_norm
+        predicted_y = self._model_func((x_values / self.x_norm).value, *self.pars[:, 0]) * self.y_norm
 
         # If there was a power of E(z) applied to the data, we undo it for the prediction.
         if self._ez_power is not None:
-            predicted_y /= (cosmo.efunc(redshift)**self._ez_power)
+            # We store this so that error propogation can use it later
+            ez = (cosmo.efunc(redshift)**self._ez_power)
+            predicted_y /= ez
+        else:
+            # This means that error propagation doesn't need to keep checking whether there is an ez power stored
+            ez = np.ones(len(predicted_y))
+
+        # errors
+        if x_errors is not None and self.model_func == power_law:
+            # This is just the error propagation for a powerlaw - the standard form of a scaling relation
+            term_one = ((self.y_norm.value * (1/ez) * (x_values.value/self.x_norm.value)**self.pars[0, 0]) *
+                        self.pars[1, 1])**2
+
+            term_two = (((self.y_norm.value * (1/ez) * self.pars[1, 0] * self.pars[0, 0] *
+                          ((1/self.x_norm.value)**self.pars[0, 0]) *
+                          x_values.value**(self.pars[0, 0] - 1)))*x_errors.value)**2
+
+            term_three = ((self.y_norm.value*(1/ez)*self.pars[1, 0] *
+                           ((x_values.value/self.x_norm.value)**self.pars[0, 0]) *
+                           np.log(x_values.value/self.x_norm.value))*self.pars[0, 1])**2
+
+            predicted_y_errs = Quantity(np.sqrt(term_one + term_two + term_three), self.y_unit)
+
+            # We use a slightly different method of combining the predicted value and uncertainty depending on whether
+            #  a single x-value was passed, or a set of them.
+            if x_values.isscalar:
+                predicted_y = Quantity([predicted_y, predicted_y_errs])
+            else:
+                predicted_y = np.vstack([predicted_y, predicted_y_errs]).T
+
+        elif x_errors is not None and self.model_func != power_law:
+            raise NotImplementedError("Error propagation for scaling relation models other than 'power_law' is not "
+                                      "implemented yet.")
 
         return predicted_y
 
     def view(self, x_lims: Quantity = None, log_scale: bool = True, plot_title: str = None, figsize: tuple = (10, 8),
              data_colour: str = 'black', model_colour: str = None, grid_on: bool = False, conf_level: int = 90,
              custom_x_label: str = None, custom_y_label: str = None, fontsize: float = 15, legend_fontsize: float = 13,
              x_ticks: list = None, x_minor_ticks: list = None, y_ticks: list = None, y_minor_ticks: list = None,
@@ -961,15 +1013,15 @@
                     # Then we convert the current data coordinate into display coordinate system
                     cur_fig_coord = ax.transData.transform((cur_x, cur_y))
                     # And make a label coordinate by offsetting the x and y data coordinate by some fraction of the
                     #  overall size of the axis, in display coordinates, with the final coordinate transformed back
                     #  to data coordinates.
                     inv_tran = ax.transData.inverted()
                     lab_data_coord = inv_tran.transform((cur_fig_coord[0]+(point_label_offset[0]*x_size),
-                                                         cur_fig_coord[1]+(point_label_offset[0]*y_size)))
+                                                         cur_fig_coord[1]+(point_label_offset[1]*y_size)))
                     plt.text(lab_data_coord[0], lab_data_coord[1], str(ind), fontsize=point_label_size,
                              color=point_label_colour)
 
         # Need to randomly sample from the fitted model
         num_rand = 10000
         model_pars = np.repeat(self._fit_pars[..., None], num_rand, axis=1).T
         model_par_errs = np.repeat(self._fit_par_errs[..., None], num_rand, axis=1).T
@@ -1052,22 +1104,22 @@
         #  Though as I don't much like the look of the grid it is off by default, and users can enable it if they
         #  want to.
         if grid_on and (max(x_axis_lims) / min(x_axis_lims)) < 10:
             ax.grid(which='minor', axis='x', linestyle='dotted', color='grey')
         elif grid_on:
             ax.grid(which='major', axis='x', linestyle='dotted', color='grey')
         else:
-            ax.grid(which='both', axis='both', b=False)
+            ax.grid(False, which='both', axis='both')
 
         if grid_on and (max(y_axis_lims) / min(y_axis_lims)) < 10:
             ax.grid(which='minor', axis='y', linestyle='dotted', color='grey')
         elif grid_on:
             ax.grid(which='major', axis='y', linestyle='dotted', color='grey')
         else:
-            ax.grid(which='both', axis='both', b=False)
+            ax.grid(False, which='both', axis='both')
 
         # I change the lengths of the tick lines, to make it look nicer (imo)
         ax.tick_params(length=7)
         ax.tick_params(which='minor', length=3)
 
         # Here we check whether the user has manually set any of the ticks to be displayed (major or minor, either axis)
         if x_ticks is not None:
@@ -1508,22 +1560,22 @@
         #  Though as I don't much like the look of the grid it is off by default, and users can enable it if they
         #  want to.
         if grid_on and (max(x_axis_lims) / min(x_axis_lims)) < 10:
             ax.grid(which='minor', axis='x', linestyle='dotted', color='grey')
         elif grid_on:
             ax.grid(which='major', axis='x', linestyle='dotted', color='grey')
         else:
-            ax.grid(which='both', axis='both', b=False)
+            ax.grid(False, which='both', axis='both')
 
         if grid_on and (max(y_axis_lims) / min(y_axis_lims)) < 10:
             ax.grid(which='minor', axis='y', linestyle='dotted', color='grey')
         elif grid_on:
             ax.grid(which='major', axis='y', linestyle='dotted', color='grey')
         else:
-            ax.grid(which='both', axis='both', b=False)
+            ax.grid(False, which='both', axis='both')
 
         # I change the lengths of the tick lines, to make it look nicer (imo)
         ax.tick_params(length=7)
         ax.tick_params(which='minor', length=3)
 
         # Here we check whether the user has manually set any of the ticks to be displayed (major or minor, either axis)
         if x_ticks is not None:
```

### Comparing `xga-0.4.3/xga/products/spec.py` & `xga-0.4.4/xga/products/spec.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #  This code is a part of X-ray: Generate and Analyse (XGA), a module designed for the XMM Cluster Survey (XCS).
-#  Last modified by David J Turner (turne540@msu.edu) 07/11/2023, 12:05. Copyright (c) The Contributors
+#  Last modified by David J Turner (turne540@msu.edu) 21/02/2024, 09:53. Copyright (c) The Contributors
 
 import os
 import warnings
 from typing import Tuple, Union, List, Dict
 from warnings import warn
 
 import numpy as np
@@ -1787,21 +1787,23 @@
 
         # This can be set through a property, as products shouldn't have any knowledge of their source
         #  other than the name. And someone might define one of these source-lessly. It will contain radii
         #  which are proper, not in degrees
         self._proper_radii = None
         self._proper_ann_centres = None
 
+        # self._component_products = {ai: {o: {i: None for i in self._instruments[o]} for o in self.obs_ids}
+        #                             for ai in range(self._num_ann)}
+        # self._component_products = {o: {i: {ai: None for ai in range(self._num_ann)}
+        #                                 for i in self._instruments[o]} for o in self.obs_ids}
+
         # Finally storing the spectra inside the product, though with multiple layers of products
         # This sets up the component products dictionary, allowing for the separated storage of
-        #  spectra from different ObsIDs
-        self._component_products = {ai: {o: {i: None for i in self._instruments[o]} for o in self.obs_ids}
-                                    for ai in range(self._num_ann)}
-        self._component_products = {o: {i: {ai: None for ai in range(self._num_ann)}
-                                        for i in self._instruments[o]} for o in self.obs_ids}
+        #  spectra from different ObsIDs. We don't require that every ObsID-inst combo has an entry for every annulus
+        self._component_products = {o: {i: {} for i in self._instruments[o]} for o in self.obs_ids}
         # And putting the spectra in their place
         for s in spectra:
             self._component_products[s.obs_id][s.instrument][s.annulus_ident] = s
 
         # Run through all the spectra associated with this AnnularSpectra and see if they are usable
         self._all_usable = all(s.usable for s in self.all_spectra)
```

### Comparing `xga-0.4.3/xga/relations/clusters/Lλ.py` & `xga-0.4.4/xga/relations/clusters/Lλ.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,20 +1,21 @@
 #  This code is a part of X-ray: Generate and Analyse (XGA), a module designed for the XMM Cluster Survey (XCS).
-#  Last modified by David J Turner (turne540@msu.edu) 17/04/2023, 21:02. Copyright (c) The Contributors
+#  Last modified by David J Turner (turne540@msu.edu) 28/02/2024, 11:18. Copyright (c) The Contributors
 
 import numpy as np
 from astropy.units import Quantity
 
 from ...models.misc import power_law
 from ...products.relation import ScalingRelation
 
-xcs_sdss_r500_52 = ScalingRelation(np.array([1.67, 0.96]), np.array([0.13, 0.08]), power_law, Quantity(60),
+xcs_sdss_r500_52 = ScalingRelation(np.array([1.61, 0.98]), np.array([0.14, 0.09]), power_law, Quantity(60),
                                    Quantity(0.8e+44, 'erg / s'), r"$\lambda$", r"E(z)$^{-1}$L$_{\rm{x},500,0.5-2.0}$",
                                    x_lims=Quantity([20, 220]), relation_name='SDSSRM-XCS$_{T_{x},vol}$ 0.5-2.0keV',
-                                   relation_author='Giles et al.', relation_year='In Prep', relation_doi='',
+                                   relation_author='Giles et al.', relation_year='2022',
+                                   relation_doi='https://doi.org/10.1093/mnras/stac2414',
                                    dim_hubb_ind=-1)
```

### Comparing `xga-0.4.3/xga/relations/clusters/MT.py` & `xga-0.4.4/xga/relations/clusters/MT.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/relations/clusters/RT.py` & `xga-0.4.4/xga/relations/clusters/RT.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/relations/clusters/TL.py` & `xga-0.4.4/xga/relations/clusters/TL.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/relations/fit.py` & `xga-0.4.4/xga/relations/fit.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/samples/base.py` & `xga-0.4.4/xga/samples/base.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/samples/extended.py` & `xga-0.4.4/xga/samples/extended.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #  This code is a part of X-ray: Generate and Analyse (XGA), a module designed for the XMM Cluster Survey (XCS).
-#  Last modified by David J Turner (turne540@msu.edu) 14/06/2023, 23:25. Copyright (c) The Contributors
+#  Last modified by David J Turner (turne540@msu.edu) 26/02/2024, 22:30. Copyright (c) The Contributors
 
 from typing import List
 
 import numpy as np
 from astropy.cosmology import Cosmology
 from astropy.units import Quantity
 from tqdm import tqdm
@@ -64,14 +64,47 @@
                  back_inn_rad_factor: float = 1.05, back_out_rad_factor: float = 1.5,
                  cosmology: Cosmology = DEFAULT_COSMO, load_fits: bool = False, clean_obs: bool = True,
                  clean_obs_reg: str = "r200", clean_obs_threshold: float = 0.3, no_prog_bar: bool = False,
                  psf_corr: bool = False, peak_find_method: str = "hierarchical"):
         """
         The init of the ClusterSample XGA class, for the analysis of a large sample of galaxy clusters.
         Takes information on the clusters to enable analyses.
+
+        :param np.ndarray ra: The right-ascensions of the clusters, in degrees.
+        :param np.ndarray dec: The declinations of the clusters, in degrees.
+        :param np.ndarray redshift: The redshifts of the clusters, required for cluster analysis.
+        :param np.ndarray name: The names of the clusters.
+        :param Quantity r200: Values for the R200s of the clusters. At least one overdensity radius must be passed.
+        :param Quantity r500: Values for the R500s of the clusters. At least one overdensity radius must be passed.
+        :param Quantity r2500: Values for the R2500s of the clusters. At least one overdensity radius must be passed.
+        :param np.ndarray richness: Optical richnesses of the clusters, optional.
+        :param np.ndarray richness_err: Uncertainties on the optical richnesses of the clusters, optional.
+        :param Quantity wl_mass: Weak lensing masses of the clusters, optional.
+        :param Quantity wl_mass_err: Uncertainties on the weak lensing masses of the clusters, optional.
+        :param Quantity custom_region_radius: A custom analysis region radius for this cluster, optional.
+        :param bool use_peak: Whether peak position should be found and used.
+        :param Quantity peak_lo_en: The lower energy bound for the RateMap to calculate peak position
+            from. Default is 0.5keV
+        :param Quantity peak_hi_en: The upper energy bound for the RateMap to calculate peak position
+            from. Default is 2.0keV.
+        :param float back_inn_rad_factor: This factor is multiplied by an analysis region radius, and gives the inner
+            radius for the background region. Default is 1.05.
+        :param float back_out_rad_factor: This factor is multiplied by an analysis region radius, and gives the outer
+            radius for the background region. Default is 1.5.
+        :param Cosmology cosmology: An astropy cosmology object for use throughout analysis of the source.
+        :param bool load_fits: Whether existing fits should be loaded from disk.
+        :param str peak_find_method: Which peak finding method should be used (if use_peak is True). Default
+            is hierarchical, simple may also be passed.
+        :param bool clean_obs: Should the observations be subjected to a minimum coverage check, i.e. whether a
+            certain fraction of a certain region is covered by an ObsID. Default is True.
+        :param str clean_obs_reg: The region to use for the cleaning step, default is R200.
+        :param float clean_obs_threshold: The minimum coverage fraction for an observation to be kept for analysis.
+        :param str peak_find_method: Which peak finding method should be used (if use_peak is True). Default
+            is 'hierarchical' (uses XGA's hierarchical clustering peak finder), 'simple' may also be passed in which
+            case the brightest unmasked pixel within the source region will be selected.
         """
 
         # I don't like having this here, but it does avoid a circular import problem
         from xga.sas import evselect_image, eexpmap, emosaic
 
         # Using the super defines BaseSources and stores them in the self._sources dictionary
         super().__init__(ra, dec, redshift, name, cosmology, load_products=True, load_fits=False,
```

### Comparing `xga-0.4.3/xga/samples/general.py` & `xga-0.4.4/xga/samples/general.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/samples/point.py` & `xga-0.4.4/xga/samples/point.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sas/_common.py` & `xga-0.4.4/xga/sas/_common.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sas/lightcurve.py` & `xga-0.4.4/xga/sas/lightcurve.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sas/misc.py` & `xga-0.4.4/xga/sas/misc.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sas/phot.py` & `xga-0.4.4/xga/sas/phot.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sas/run.py` & `xga-0.4.4/xga/sas/run.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #  This code is a part of X-ray: Generate and Analyse (XGA), a module designed for the XMM Cluster Survey (XCS).
-#  Last modified by David J Turner (turne540@msu.edu) 09/08/2023, 13:01. Copyright (c) The Contributors
+#  Last modified by David J Turner (turne540@msu.edu) 01/05/2024, 15:27. Copyright (c) The Contributors
 
 from functools import wraps
 from multiprocessing.dummy import Pool
 from subprocess import Popen, PIPE
 from typing import Tuple
 from warnings import warn
 
@@ -28,66 +28,82 @@
     :param str p_type: The product type that will be produced by this command.
     :param str p_path: The final output path of the product.
     :param dict extra_info: Any extra information required to define the product object.
     :param str src: A string representation of the source object that this product is associated with.
     :return: The product object, and the string representation of the associated source object.
     :rtype: Tuple[BaseProduct, str]
     """
-    out, err = Popen(cmd, shell=True, stdout=PIPE, stderr=PIPE).communicate()
-    out = out.decode("UTF-8", errors='ignore')
-    err = err.decode("UTF-8", errors='ignore')
-
-    # This part for defining an image object used to make sure that the src wasn't a NullSource, as defining product
-    #  objects is wasteful considering the purpose of a NullSource, but generating exposure maps requires a
-    #  pre-existing image
-    if p_type == "image":
-        # Maybe let the user decide not to raise errors detected in stderr
-        prod = Image(p_path[0], extra_info["obs_id"], extra_info["instrument"], out, err, cmd, extra_info["lo_en"],
-                     extra_info["hi_en"])
-        if "psf_corr" in extra_info and extra_info["psf_corr"]:
-            prod.psf_corrected = True
-            prod.psf_bins = extra_info["psf_bins"]
-            prod.psf_model = extra_info["psf_model"]
-            prod.psf_iterations = extra_info["psf_iter"]
-            prod.psf_algorithm = extra_info["psf_algo"]
-    elif p_type == "expmap":
-        prod = ExpMap(p_path[0], extra_info["obs_id"], extra_info["instrument"], out, err, cmd,
-                      extra_info["lo_en"], extra_info["hi_en"])
-    elif p_type == "ccf" and "NullSource" not in src:
-        # ccf files may not be destined to spend life as product objects, but that doesn't mean
-        # I can't take momentarily advantage of the error parsing I built into the product classes
-        prod = BaseProduct(p_path[0], "", "", out, err, cmd)
-    elif (p_type == "spectrum" or p_type == "annular spectrum set components") and "NullSource" not in src:
-        prod = Spectrum(p_path[0], extra_info["rmf_path"], extra_info["arf_path"], extra_info["b_spec_path"],
-                        extra_info['central_coord'], extra_info["inner_radius"], extra_info["outer_radius"],
-                        extra_info["obs_id"], extra_info["instrument"], extra_info["grouped"], extra_info["min_counts"],
-                        extra_info["min_sn"], extra_info["over_sample"], out, err, cmd, extra_info["from_region"],
-                        extra_info["b_rmf_path"], extra_info["b_arf_path"])
-    elif p_type == "psf" and "NullSource" not in src:
-        prod = PSFGrid(extra_info["files"], extra_info["chunks_per_side"], extra_info["model"],
-                       extra_info["x_bounds"], extra_info["y_bounds"], extra_info["obs_id"],
-                       extra_info["instrument"], out, err, cmd)
-    elif p_type == 'light curve' and "NullSource" not in src:
-        prod = LightCurve(p_path[0],  extra_info["obs_id"], extra_info["instrument"], out, err, cmd,
-                          extra_info['central_coord'], extra_info["inner_radius"], extra_info["outer_radius"],
-                          extra_info["lo_en"], extra_info["hi_en"], extra_info['time_bin'], extra_info['pattern'],
-                          extra_info["from_region"])
-    elif p_type == "cross arfs":
-        prod = BaseProduct(p_path[0], extra_info['obs_id'], extra_info['inst'], out, err, cmd, extra_info)
-    elif "NullSource" in src:
-        prod = None
-    else:
-        raise NotImplementedError("Not implemented yet")
-
-    # An extra step is required for annular spectrum set components
-    if p_type == "annular spectrum set components":
-        prod.annulus_ident = extra_info["ann_ident"]
-        prod.set_ident = extra_info["set_ident"]
+    try:
+        out, err = Popen(cmd, shell=True, stdout=PIPE, stderr=PIPE).communicate()
+        out = out.decode("UTF-8", errors='ignore')
+        err = err.decode("UTF-8", errors='ignore')
+
+        # This part for defining an image object used to make sure that the src wasn't a NullSource, as defining product
+        #  objects is wasteful considering the purpose of a NullSource, but generating exposure maps requires a
+        #  pre-existing image
+        if p_type == "image":
+            # Maybe let the user decide not to raise errors detected in stderr
+            prod = Image(p_path[0], extra_info["obs_id"], extra_info["instrument"], out, err, cmd, extra_info["lo_en"],
+                         extra_info["hi_en"])
+            if "psf_corr" in extra_info and extra_info["psf_corr"]:
+                prod.psf_corrected = True
+                prod.psf_bins = extra_info["psf_bins"]
+                prod.psf_model = extra_info["psf_model"]
+                prod.psf_iterations = extra_info["psf_iter"]
+                prod.psf_algorithm = extra_info["psf_algo"]
+        elif p_type == "expmap":
+            prod = ExpMap(p_path[0], extra_info["obs_id"], extra_info["instrument"], out, err, cmd,
+                          extra_info["lo_en"], extra_info["hi_en"])
+        elif p_type == "ccf" and "NullSource" not in src:
+            # ccf files may not be destined to spend life as product objects, but that doesn't mean
+            # I can't take momentarily advantage of the error parsing I built into the product classes
+            prod = BaseProduct(p_path[0], "", "", out, err, cmd)
+        elif (p_type == "spectrum" or p_type == "annular spectrum set components") and "NullSource" not in src:
+            prod = Spectrum(p_path[0], extra_info["rmf_path"], extra_info["arf_path"], extra_info["b_spec_path"],
+                            extra_info['central_coord'], extra_info["inner_radius"], extra_info["outer_radius"],
+                            extra_info["obs_id"], extra_info["instrument"], extra_info["grouped"],
+                            extra_info["min_counts"], extra_info["min_sn"], extra_info["over_sample"], out, err, cmd,
+                            extra_info["from_region"], extra_info["b_rmf_path"], extra_info["b_arf_path"])
+        elif p_type == "psf" and "NullSource" not in src:
+            prod = PSFGrid(extra_info["files"], extra_info["chunks_per_side"], extra_info["model"],
+                           extra_info["x_bounds"], extra_info["y_bounds"], extra_info["obs_id"],
+                           extra_info["instrument"], out, err, cmd)
+        elif p_type == 'light curve' and "NullSource" not in src:
+            prod = LightCurve(p_path[0],  extra_info["obs_id"], extra_info["instrument"], out, err, cmd,
+                              extra_info['central_coord'], extra_info["inner_radius"], extra_info["outer_radius"],
+                              extra_info["lo_en"], extra_info["hi_en"], extra_info['time_bin'], extra_info['pattern'],
+                              extra_info["from_region"])
+        elif p_type == "cross arfs":
+            prod = BaseProduct(p_path[0], extra_info['obs_id'], extra_info['inst'], out, err, cmd, extra_info)
+        elif "NullSource" in src:
+            prod = None
+        else:
+            raise NotImplementedError("Not implemented yet")
 
-    return prod, src
+        # An extra step is required for annular spectrum set components
+        if p_type == "annular spectrum set components":
+            prod.annulus_ident = extra_info["ann_ident"]
+            prod.set_ident = extra_info["set_ident"]
+
+        return prod, src
+
+    # This is deliberately an all encompassing except - as I want to modify the message of what error may get thrown
+    #  and then I will re-raise it, just it will include the source, ObsID, and instrument that caused the issue
+    except Exception as err:
+        # Some possible errors (I'm looking at you OSError) tend to have a number as their first argument and then
+        #  the actual message as the second. In most cases though, I think just the first is populated
+        if len(err.args) == 1:
+            err.args = (err.args[0] + "- {s} is the associated source, the specific data used is " \
+                                      "{o}-{i}.".format(s=src, o=extra_info["obs_id"], i=extra_info["instrument"]), )
+        # But if there are two we do want to include them both
+        else:
+            err.args = (err.args[0], err.args[1] + "- {s} is the associated source, the specific data used is "
+                                                   "{o}-{i}.".format(s=src, o=extra_info["obs_id"],
+                                                                     i=extra_info["instrument"]))
+        raise err
 
 
 def sas_call(sas_func):
     """
     This is used as a decorator for functions that produce SAS command strings. Depending on the
     system that XGA is running on (and whether the user requests parallel execution), the method of
     executing the SAS command will change. This supports both simple multi-threading and submission
@@ -174,16 +190,30 @@
                 def err_callback(err):
                     """
                     The callback function for errors that occur inside a task running in the pool.
                     :param err: An error that occurred inside a task.
                     """
                     nonlocal raised_errors
                     nonlocal gen
+                    nonlocal src_lookup
+                    nonlocal sources
 
                     if err is not None:
+                        # We used a memory address laden source name representation when we adjusted the error
+                        #  message in execute_cmd, so we'll replace it with an actual name here
+                        # Again it matters how many arguments the error has
+                        if len(err.args) == 1:
+                            err_src_rep = err.args[0].split(' is the associated source')[0].split('- ')[-1].strip()
+                            act_src_name = sources[src_lookup[err_src_rep]].name
+                            err.args = (err.args[0].replace(err_src_rep, act_src_name),)
+                        else:
+                            err_src_rep = err.args[1].split(' is the associated source')[0].split('- ')[-1].strip()
+                            act_src_name = sources[src_lookup[err_src_rep]].name
+                            err.args = (err.args[0], err.args[1].replace(err_src_rep, act_src_name))
+
                         # Rather than throwing an error straight away I append them all to a list for later.
                         raised_errors.append(err)
                     gen.update(1)
 
                 for cmd_ind, cmd in enumerate(all_run):
                     # These are just the relevant entries in all these lists for the current command
                     # Just defined like this to save on line length for apply_async call.
@@ -234,16 +264,18 @@
                 elif product.type is not None and product.usable and prod_type_str == "annular spectrum set components":
                     # Really we're just re-creating the results dictionary here, but I want these products
                     #  to go through the error checking stuff like everything else does
                     ann_spec_comps[entry].append(product)
                 # In case they are components of an annular spectrum but they are either none or not usable
                 elif prod_type_str == "annular spectrum set components":
                     warn("An annular spectrum component ({a}) for {o}{i} has not been generated properly, contact "
-                         "the development team if a SAS error is not "
-                         "shown.".format(a=product.storage_key, o=product.obs_id, i=product.instrument), stacklevel=2)
+                         "the development team if a SAS error is not shown. The std_err entry is:\n\n "
+                         "{se}\n\n The std_out entry is:\n\n "
+                         "{so}".format(a=product.storage_key, o=product.obs_id, i=product.instrument,
+                                       se=product.unprocessed_stderr, so=product.unprocessed_stdout), stacklevel=2)
                 # Here the generated product was a cross-arf, and needs to be added to the right annular spectrum
                 #  object that already exists in our source
                 elif prod_type_str == "cross arfs":
                     # OH NO WE'RE USING A PROTECTED ATTRIBUTE - but don't worry, I didn't give this a property
                     #  deliberately to hopefully discourage any user from doing anything with it
                     ei = product._extra_info
                     ann_spec = sources[ind].get_annular_spectra(set_id=ei['ann_spec_set_id'])
@@ -264,16 +296,16 @@
                 if sources[ind].redshift is not None:
                     # If we know the redshift we will add the radii to the annular spectra in proper distance units
                     ann_spec.proper_radii = sources[ind].convert_radius(ann_spec.radii, 'kpc')
                 # And adding our exciting new set of annular spectra into the storage structure
                 sources[ind].update_products(ann_spec)
 
         # Errors raised here should not be to do with SAS generation problems, but other purely pythonic errors
-        for error in raised_errors:
-            raise error
+        if len(raised_errors) != 0:
+            raise Exception(raised_errors)
 
         # And here are all the errors during SAS generation, if any
         if len(all_to_raise) != 0:
             raise SASGenerationError(all_to_raise)
 
         # If only one source was passed, turn it back into a source object rather than a source
         # object in a list.
```

### Comparing `xga-0.4.3/xga/sas/spec.py` & `xga-0.4.4/xga/sas/spec.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sources/base.py` & `xga-0.4.4/xga/sources/base.py`

 * *Files 0% similar despite different names*

```diff
@@ -4,16 +4,16 @@
 00000030: 616c 7973 6520 2858 4741 292c 2061 206d  alyse (XGA), a m
 00000040: 6f64 756c 6520 6465 7369 676e 6564 2066  odule designed f
 00000050: 6f72 2074 6865 2058 4d4d 2043 6c75 7374  or the XMM Clust
 00000060: 6572 2053 7572 7665 7920 2858 4353 292e  er Survey (XCS).
 00000070: 0a23 2020 4c61 7374 206d 6f64 6966 6965  .#  Last modifie
 00000080: 6420 6279 2044 6176 6964 204a 2054 7572  d by David J Tur
 00000090: 6e65 7220 2874 7572 6e65 3534 3040 6d73  ner (turne540@ms
-000000a0: 752e 6564 7529 2030 382f 3132 2f32 3032  u.edu) 08/12/202
-000000b0: 332c 2031 353a 3232 2e20 436f 7079 7269  3, 15:22. Copyri
+000000a0: 752e 6564 7529 2030 322f 3035 2f32 3032  u.edu) 02/05/202
+000000b0: 342c 2031 303a 3430 2e20 436f 7079 7269  4, 10:40. Copyri
 000000c0: 6768 7420 2863 2920 5468 6520 436f 6e74  ght (c) The Cont
 000000d0: 7269 6275 746f 7273 0a0a 696d 706f 7274  ributors..import
 000000e0: 206f 730a 696d 706f 7274 2070 6963 6b6c   os.import pickl
 000000f0: 650a 6672 6f6d 2063 6f70 7920 696d 706f  e.from copy impo
 00000100: 7274 2064 6565 7063 6f70 790a 6672 6f6d  rt deepcopy.from
 00000110: 2069 7465 7274 6f6f 6c73 2069 6d70 6f72   itertools impor
 00000120: 7420 7072 6f64 7563 740a 6672 6f6d 2073  t product.from s
@@ -7962,7948 +7962,7971 @@
 0001f190: 2c20 7468 656e 2063 6f6e 7665 7274 0a20  , then convert. 
 0001f1a0: 2020 2020 2020 2023 2020 6672 6f6d 2064         #  from d
 0001f1b0: 6567 7265 6573 2074 6f20 584d 4d20 736b  egrees to XMM sk
 0001f1c0: 7920 636f 6f72 6469 6e61 7465 7320 7573  y coordinates us
 0001f1d0: 696e 6720 7468 6520 6661 6374 6f72 2077  ing the factor w
 0001f1e0: 6520 6361 6c63 756c 6174 6564 2069 6e20  e calculated in 
 0001f1f0: 7468 6520 6d61 696e 2066 756e 6374 696f  the main functio
-0001f200: 6e0a 2020 2020 2020 2020 7720 3d20 7265  n.        w = re
-0001f210: 672e 7769 6474 682e 746f 2827 6465 6727  g.width.to('deg'
-0001f220: 292e 7661 6c75 6520 2f20 3220 2f20 736b  ).value / 2 / sk
-0001f230: 795f 746f 5f64 6567 0a20 2020 2020 2020  y_to_deg.       
-0001f240: 2023 2057 6520 646f 2074 6865 2073 616d   # We do the sam
-0001f250: 6520 666f 7220 7468 6520 6865 6967 6874  e for the height
-0001f260: 0a20 2020 2020 2020 2068 203d 2072 6567  .        h = reg
-0001f270: 2e68 6569 6768 742e 746f 2827 6465 6727  .height.to('deg'
-0001f280: 292e 7661 6c75 6520 2f20 3220 2f20 736b  ).value / 2 / sk
-0001f290: 795f 746f 5f64 6567 0a20 2020 2020 2020  y_to_deg.       
-0001f2a0: 2069 6620 7720 3d3d 2068 3a0a 2020 2020   if w == h:.    
-0001f2b0: 2020 2020 2020 2020 7368 6170 655f 7374          shape_st
-0001f2c0: 7220 3d20 2228 287b 747d 2920 494e 2063  r = "(({t}) IN c
-0001f2d0: 6972 636c 6528 7b63 787d 2c7b 6379 7d2c  ircle({cx},{cy},
-0001f2e0: 7b72 7d29 2922 0a20 2020 2020 2020 2020  {r}))".         
-0001f2f0: 2020 2073 6861 7065 5f73 7472 203d 2073     shape_str = s
-0001f300: 6861 7065 5f73 7472 2e66 6f72 6d61 7428  hape_str.format(
-0001f310: 743d 635f 7374 722c 2063 783d 636f 6e76  t=c_str, cx=conv
-0001f320: 5f63 656e 5b30 5d2e 7661 6c75 652c 2063  _cen[0].value, c
-0001f330: 793d 636f 6e76 5f63 656e 5b31 5d2e 7661  y=conv_cen[1].va
-0001f340: 6c75 652c 2072 3d68 290a 2020 2020 2020  lue, r=h).      
-0001f350: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001f360: 2020 2020 2320 5468 6520 726f 7461 7469      # The rotati
-0001f370: 6f6e 2061 6e67 6c65 2066 726f 6d20 7468  on angle from th
-0001f380: 6520 7265 6769 6f6e 206f 626a 6563 7420  e region object 
-0001f390: 6973 2069 6e20 6465 6772 6565 7320 616c  is in degrees al
-0001f3a0: 7265 6164 790a 2020 2020 2020 2020 2020  ready.          
-0001f3b0: 2020 7368 6170 655f 7374 7220 3d20 2228    shape_str = "(
-0001f3c0: 287b 747d 2920 494e 2065 6c6c 6970 7365  ({t}) IN ellipse
-0001f3d0: 287b 6378 7d2c 7b63 797d 2c7b 777d 2c7b  ({cx},{cy},{w},{
-0001f3e0: 687d 2c7b 726f 747d 2929 222e 666f 726d  h},{rot}))".form
-0001f3f0: 6174 2874 3d63 5f73 7472 2c20 6378 3d63  at(t=c_str, cx=c
-0001f400: 6f6e 765f 6365 6e5b 305d 2e76 616c 7565  onv_cen[0].value
-0001f410: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f450: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001f460: 793d 636f 6e76 5f63 656e 5b31 5d2e 7661  y=conv_cen[1].va
-0001f470: 6c75 652c 2077 3d77 2c20 683d 682c 0a20  lue, w=w, h=h,. 
+0001f200: 6e0a 2020 2020 2020 2020 7720 3d20 2872  n.        w = (r
+0001f210: 6567 2e77 6964 7468 2e74 6f28 2764 6567  eg.width.to('deg
+0001f220: 2729 2e76 616c 7565 202f 2032 202f 2073  ').value / 2 / s
+0001f230: 6b79 5f74 6f5f 6465 6729 2e72 6f75 6e64  ky_to_deg).round
+0001f240: 2834 290a 2020 2020 2020 2020 2320 5765  (4).        # We
+0001f250: 2064 6f20 7468 6520 7361 6d65 2066 6f72   do the same for
+0001f260: 2074 6865 2068 6569 6768 740a 2020 2020   the height.    
+0001f270: 2020 2020 6820 3d20 2872 6567 2e68 6569      h = (reg.hei
+0001f280: 6768 742e 746f 2827 6465 6727 292e 7661  ght.to('deg').va
+0001f290: 6c75 6520 2f20 3220 2f20 736b 795f 746f  lue / 2 / sky_to
+0001f2a0: 5f64 6567 292e 726f 756e 6428 3429 0a20  _deg).round(4). 
+0001f2b0: 2020 2020 2020 2069 6620 7720 3d3d 2068         if w == h
+0001f2c0: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
+0001f2d0: 6170 655f 7374 7220 3d20 2228 287b 747d  ape_str = "(({t}
+0001f2e0: 2920 494e 2063 6972 636c 6528 7b63 787d  ) IN circle({cx}
+0001f2f0: 2c7b 6379 7d2c 7b72 7d29 2922 0a20 2020  ,{cy},{r}))".   
+0001f300: 2020 2020 2020 2020 2073 6861 7065 5f73           shape_s
+0001f310: 7472 203d 2073 6861 7065 5f73 7472 2e66  tr = shape_str.f
+0001f320: 6f72 6d61 7428 743d 635f 7374 722c 2063  ormat(t=c_str, c
+0001f330: 783d 636f 6e76 5f63 656e 5b30 5d2e 726f  x=conv_cen[0].ro
+0001f340: 756e 6428 3429 2e76 616c 7565 2c20 6379  und(4).value, cy
+0001f350: 3d63 6f6e 765f 6365 6e5b 315d 2e72 6f75  =conv_cen[1].rou
+0001f360: 6e64 2834 292e 7661 6c75 652c 2072 3d68  nd(4).value, r=h
+0001f370: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0001f380: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+0001f390: 6520 726f 7461 7469 6f6e 2061 6e67 6c65  e rotation angle
+0001f3a0: 2066 726f 6d20 7468 6520 7265 6769 6f6e   from the region
+0001f3b0: 206f 626a 6563 7420 6973 2069 6e20 6465   object is in de
+0001f3c0: 6772 6565 7320 616c 7265 6164 790a 2020  grees already.  
+0001f3d0: 2020 2020 2020 2020 2020 7368 6170 655f            shape_
+0001f3e0: 7374 7220 3d20 2228 287b 747d 2920 494e  str = "(({t}) IN
+0001f3f0: 2065 6c6c 6970 7365 287b 6378 7d2c 7b63   ellipse({cx},{c
+0001f400: 797d 2c7b 777d 2c7b 687d 2c7b 726f 747d  y},{w},{h},{rot}
+0001f410: 2929 222e 666f 726d 6174 2874 3d63 5f73  ))".format(t=c_s
+0001f420: 7472 2c20 6378 3d63 6f6e 765f 6365 6e5b  tr, cx=conv_cen[
+0001f430: 305d 2e72 6f75 6e64 2834 292e 7661 6c75  0].round(4).valu
+0001f440: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4c0: 2020 2020 2020 2020 2020 2020 726f 743d              rot=
-0001f4d0: 7265 672e 616e 676c 652e 7661 6c75 6529  reg.angle.value)
-0001f4e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001f4f0: 7368 6170 655f 7374 720a 0a20 2020 2064  shape_str..    d
-0001f500: 6566 2067 6574 5f61 6e6e 756c 6172 5f73  ef get_annular_s
-0001f510: 6173 5f72 6567 696f 6e28 7365 6c66 2c20  as_region(self, 
-0001f520: 696e 6e65 725f 7261 6469 7573 3a20 5175  inner_radius: Qu
-0001f530: 616e 7469 7479 2c20 6f75 7465 725f 7261  antity, outer_ra
-0001f540: 6469 7573 3a20 5175 616e 7469 7479 2c20  dius: Quantity, 
-0001f550: 6f62 735f 6964 3a20 7374 722c 2069 6e73  obs_id: str, ins
-0001f560: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
-0001f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f580: 2020 2020 2020 206f 7574 7075 745f 756e         output_un
-0001f590: 6974 3a20 556e 696f 6e5b 556e 6974 4261  it: Union[UnitBa
-0001f5a0: 7365 2c20 7374 725d 203d 2078 6d6d 5f73  se, str] = xmm_s
-0001f5b0: 6b79 2c20 726f 745f 616e 676c 653a 2051  ky, rot_angle: Q
-0001f5c0: 7561 6e74 6974 7920 3d20 5175 616e 7469  uantity = Quanti
-0001f5d0: 7479 2830 2c20 2764 6567 2729 2c0a 2020  ty(0, 'deg'),.  
-0001f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5f0: 2020 2020 2020 2020 2020 2020 2069 6e74               int
-0001f600: 6572 6c6f 7065 725f 7265 6769 6f6e 733a  erloper_regions:
-0001f610: 206e 702e 6e64 6172 7261 7920 3d20 4e6f   np.ndarray = No
-0001f620: 6e65 2c20 6365 6e74 7261 6c5f 636f 6f72  ne, central_coor
-0001f630: 643a 2051 7561 6e74 6974 7920 3d20 4e6f  d: Quantity = No
-0001f640: 6e65 2920 2d3e 2073 7472 3a0a 2020 2020  ne) -> str:.    
-0001f650: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001f660: 4120 6d65 7468 6f64 2074 6f20 6765 6e65  A method to gene
-0001f670: 7261 7465 2061 2053 4153 2072 6567 696f  rate a SAS regio
-0001f680: 6e20 7374 7269 6e67 2066 6f72 2061 6e20  n string for an 
-0001f690: 6172 6269 7472 6172 7920 6369 7263 756c  arbitrary circul
-0001f6a0: 6172 206f 7220 656c 6c69 7074 6963 616c  ar or elliptical
-0001f6b0: 2061 6e6e 756c 6172 2072 6567 696f 6e2c   annular region,
-0001f6c0: 2077 6974 680a 2020 2020 2020 2020 696e   with.        in
-0001f6d0: 7465 726c 6f70 6572 2073 6f75 7263 6573  terloper sources
-0001f6e0: 2072 656d 6f76 6564 2e0a 0a20 2020 2020   removed...     
-0001f6f0: 2020 203a 7061 7261 6d20 5175 616e 7469     :param Quanti
-0001f700: 7479 2069 6e6e 6572 5f72 6164 6975 733a  ty inner_radius:
-0001f710: 2054 6865 2069 6e6e 6572 2072 6164 6975   The inner radiu
-0001f720: 732f 7261 6469 6920 6f66 2074 6865 2072  s/radii of the r
-0001f730: 6567 696f 6e20 796f 7520 7769 7368 2074  egion you wish t
-0001f740: 6f20 6765 6e65 7261 7465 2069 6e20 5341  o generate in SA
-0001f750: 532c 2069 6620 7468 650a 2020 2020 2020  S, if the.      
-0001f760: 2020 2020 2020 7175 616e 7469 7479 2068        quantity h
-0001f770: 6173 206d 756c 7469 706c 6520 656c 656d  as multiple elem
-0001f780: 656e 7473 2074 6865 6e20 616e 2065 6c6c  ents then an ell
-0001f790: 6970 7469 6361 6c20 7265 6769 6f6e 2077  iptical region w
-0001f7a0: 696c 6c20 6265 2067 656e 6572 6174 6564  ill be generated
-0001f7b0: 2c20 7769 7468 2074 6865 2066 6972 7374  , with the first
-0001f7c0: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
-0001f7d0: 2020 2020 2062 6569 6e67 2074 6865 2069       being the i
-0001f7e0: 6e6e 6572 2072 6164 6975 7320 6f6e 2074  nner radius on t
-0001f7f0: 6865 2073 656d 692d 6d61 6a6f 7220 6178  he semi-major ax
-0001f800: 6973 2c20 616e 6420 7468 6520 7365 636f  is, and the seco
-0001f810: 6e64 206f 6e20 7468 6520 7365 6d69 2d6d  nd on the semi-m
-0001f820: 696e 6f72 2061 7869 732e 0a20 2020 2020  inor axis..     
-0001f830: 2020 203a 7061 7261 6d20 5175 616e 7469     :param Quanti
-0001f840: 7479 206f 7574 6572 5f72 6164 6975 733a  ty outer_radius:
-0001f850: 2054 6865 2069 6e6e 6572 206f 7574 6572   The inner outer
-0001f860: 5f72 6164 6975 732f 7261 6469 6920 6f66  _radius/radii of
-0001f870: 2074 6865 2072 6567 696f 6e20 796f 7520   the region you 
-0001f880: 7769 7368 2074 6f20 6765 6e65 7261 7465  wish to generate
-0001f890: 2069 6e20 5341 532c 2069 6620 7468 650a   in SAS, if the.
-0001f8a0: 2020 2020 2020 2020 2020 2020 7175 616e              quan
-0001f8b0: 7469 7479 2068 6173 206d 756c 7469 706c  tity has multipl
-0001f8c0: 6520 656c 656d 656e 7473 2074 6865 6e20  e elements then 
-0001f8d0: 616e 2065 6c6c 6970 7469 6361 6c20 7265  an elliptical re
-0001f8e0: 6769 6f6e 2077 696c 6c20 6265 2067 656e  gion will be gen
-0001f8f0: 6572 6174 6564 2c20 7769 7468 2074 6865  erated, with the
-0001f900: 2066 6972 7374 2065 6c65 6d65 6e74 0a20   first element. 
-0001f910: 2020 2020 2020 2020 2020 2062 6569 6e67             being
-0001f920: 2074 6865 206f 7574 6572 2072 6164 6975   the outer radiu
-0001f930: 7320 6f6e 2074 6865 2073 656d 692d 6d61  s on the semi-ma
-0001f940: 6a6f 7220 6178 6973 2c20 616e 6420 7468  jor axis, and th
-0001f950: 6520 7365 636f 6e64 206f 6e20 7468 6520  e second on the 
-0001f960: 7365 6d69 2d6d 696e 6f72 2061 7869 732e  semi-minor axis.
-0001f970: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001f980: 7374 7220 6f62 735f 6964 3a20 5468 6520  str obs_id: The 
-0001f990: 4f62 7349 4420 6f66 2074 6865 206f 6273  ObsID of the obs
-0001f9a0: 6572 7661 7469 6f6e 2079 6f75 2077 6973  ervation you wis
-0001f9b0: 6820 746f 2067 656e 6572 6174 6520 7468  h to generate th
-0001f9c0: 6520 5341 5320 7265 6769 6f6e 2066 6f72  e SAS region for
-0001f9d0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001f9e0: 2073 7472 2069 6e73 743a 2054 6865 2069   str inst: The i
-0001f9f0: 6e73 7472 756d 656e 7420 6f66 2074 6865  nstrument of the
-0001fa00: 206f 6273 6572 7661 7469 6f6e 2079 6f75   observation you
-0001fa10: 2074 6f20 6765 6e65 7261 7465 2074 6865   to generate the
-0001fa20: 2053 4153 2072 6567 696f 6e20 666f 722e   SAS region for.
-0001fa30: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001fa40: 556e 6974 4261 7365 2f73 7472 206f 7574  UnitBase/str out
-0001fa50: 7075 745f 756e 6974 3a20 5468 6520 6f75  put_unit: The ou
-0001fa60: 7470 7574 2075 6e69 7420 666f 7220 7468  tput unit for th
-0001fa70: 6973 2053 4153 2072 6567 696f 6e2c 2065  is SAS region, e
-0001fa80: 6974 6865 7220 786d 6d5f 736b 7920 6f72  ither xmm_sky or
-0001fa90: 2078 6d6d 5f64 6574 2e0a 2020 2020 2020   xmm_det..      
-0001faa0: 2020 3a70 6172 616d 206e 702e 6e64 6172    :param np.ndar
-0001fab0: 7261 7920 696e 7465 726c 6f70 6572 5f72  ray interloper_r
-0001fac0: 6567 696f 6e73 3a20 5468 6520 696e 7465  egions: The inte
-0001fad0: 726c 6f70 6572 2072 6567 696f 6e73 2074  rloper regions t
-0001fae0: 6f20 7265 6d6f 7665 2066 726f 6d20 7468  o remove from th
-0001faf0: 6520 736f 7572 6365 2072 6567 696f 6e2c  e source region,
-0001fb00: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-0001fb10: 6175 6c74 2069 7320 4e6f 6e65 2c20 696e  ault is None, in
-0001fb20: 2077 6869 6368 2063 6173 6520 7468 6520   which case the 
-0001fb30: 6675 6e63 7469 6f6e 2077 696c 6c20 7275  function will ru
-0001fb40: 6e20 7365 6c66 2e72 6567 696f 6e73 5f77  n self.regions_w
-0001fb50: 6974 6869 6e5f 7261 6469 692e 0a20 2020  ithin_radii..   
-0001fb60: 2020 2020 203a 7061 7261 6d20 5175 616e       :param Quan
-0001fb70: 7469 7479 2072 6f74 5f61 6e67 6c65 3a20  tity rot_angle: 
-0001fb80: 5468 6520 726f 7461 7469 6f6e 2061 6e67  The rotation ang
-0001fb90: 6c65 206f 6620 7468 6520 736f 7572 6365  le of the source
-0001fba0: 2072 6567 696f 6e2c 2064 6566 6175 6c74   region, default
-0001fbb0: 2069 7320 7a65 726f 2064 6567 7265 6573   is zero degrees
-0001fbc0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001fbd0: 2051 7561 6e74 6974 7920 6365 6e74 7261   Quantity centra
-0001fbe0: 6c5f 636f 6f72 643a 2054 6865 2063 6f6f  l_coord: The coo
-0001fbf0: 7264 696e 6174 6520 6f6e 2077 6869 6368  rdinate on which
-0001fc00: 2074 6f20 6365 6e74 7265 2074 6865 2073   to centre the s
-0001fc10: 6f75 7263 6520 7265 6769 6f6e 2c20 6465  ource region, de
-0001fc20: 6661 756c 7420 6973 0a20 2020 2020 2020  fault is.       
-0001fc30: 2020 2020 204e 6f6e 6520 696e 2077 6869       None in whi
-0001fc40: 6368 2063 6173 6520 7468 6520 6675 6e63  ch case the func
-0001fc50: 7469 6f6e 2077 696c 6c20 7573 6520 7468  tion will use th
-0001fc60: 6520 6465 6661 756c 745f 636f 6f72 6420  e default_coord 
-0001fc70: 6f66 2074 6865 2073 6f75 7263 6520 6f62  of the source ob
-0001fc80: 6a65 6374 2e0a 2020 2020 2020 2020 3a72  ject..        :r
-0001fc90: 6574 7572 6e3a 2041 2073 7472 696e 6720  eturn: A string 
-0001fca0: 666f 7220 7573 6520 696e 2061 2053 4153  for use in a SAS
-0001fcb0: 2072 6f75 7469 6e65 2074 6861 7420 6465   routine that de
-0001fcc0: 7363 7269 6265 7320 7468 6520 736f 7572  scribes the sour
-0001fcd0: 6365 2072 6567 696f 6e2c 2061 6e64 2074  ce region, and t
-0001fce0: 6865 2072 6567 696f 6e73 0a20 2020 2020  he regions.     
-0001fcf0: 2020 2020 2020 2074 6f20 6375 7420 6f75         to cut ou
-0001fd00: 7420 6f66 2069 742e 0a20 2020 2020 2020  t of it..       
-0001fd10: 203a 7274 7970 653a 2073 7472 0a20 2020   :rtype: str.   
-0001fd20: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0001fd30: 2020 6966 2063 656e 7472 616c 5f63 6f6f    if central_coo
-0001fd40: 7264 2069 7320 4e6f 6e65 3a0a 2020 2020  rd is None:.    
-0001fd50: 2020 2020 2020 2020 6365 6e74 7261 6c5f          central_
-0001fd60: 636f 6f72 6420 3d20 7365 6c66 2e5f 6465  coord = self._de
-0001fd70: 6661 756c 745f 636f 6f72 640a 0a20 2020  fault_coord..   
-0001fd80: 2020 2020 2023 2054 6865 7365 2063 6865       # These che
-0001fd90: 636b 732f 636f 6e76 6572 7369 6f6e 7320  cks/conversions 
-0001fda0: 6172 6520 616c 7265 6164 7920 646f 6e65  are already done
-0001fdb0: 2062 7920 7468 6520 6576 7365 6c65 6374   by the evselect
-0001fdc0: 5f73 7065 6374 7275 6d20 636f 6d6d 616e  _spectrum comman
-0001fdd0: 642c 2062 7574 2049 2064 6f6e 2774 0a20  d, but I don't. 
-0001fde0: 2020 2020 2020 2023 2020 6d69 6e64 2064         #  mind d
-0001fdf0: 6f69 6e67 2074 6865 6d20 6167 6169 6e0a  oing them again.
-0001fe00: 2020 2020 2020 2020 696e 6e65 725f 7261          inner_ra
-0001fe10: 6469 7573 203d 2073 656c 662e 636f 6e76  dius = self.conv
-0001fe20: 6572 745f 7261 6469 7573 2869 6e6e 6572  ert_radius(inner
-0001fe30: 5f72 6164 6975 732c 2027 6465 6727 290a  _radius, 'deg').
-0001fe40: 2020 2020 2020 2020 6f75 7465 725f 7261          outer_ra
-0001fe50: 6469 7573 203d 2073 656c 662e 636f 6e76  dius = self.conv
-0001fe60: 6572 745f 7261 6469 7573 286f 7574 6572  ert_radius(outer
-0001fe70: 5f72 6164 6975 732c 2027 6465 6727 290a  _radius, 'deg').
-0001fe80: 0a20 2020 2020 2020 2023 2054 6865 6e20  .        # Then 
-0001fe90: 7765 2063 616e 2063 6865 636b 2074 6f20  we can check to 
-0001fea0: 6d61 6b65 2073 7572 6520 7468 6174 2074  make sure that t
-0001feb0: 6865 206f 7574 6572 2072 6164 6975 7320  he outer radius 
-0001fec0: 6973 206c 6172 6765 7220 7468 616e 2074  is larger than t
-0001fed0: 6865 2069 6e6e 6572 2072 6164 6975 730a  he inner radius.
-0001fee0: 2020 2020 2020 2020 6966 2069 6e6e 6572          if inner
-0001fef0: 5f72 6164 6975 732e 6973 7363 616c 6172  _radius.isscalar
-0001ff00: 2061 6e64 2069 6e6e 6572 5f72 6164 6975   and inner_radiu
-0001ff10: 7320 3e3d 206f 7574 6572 5f72 6164 6975  s >= outer_radiu
-0001ff20: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0001ff30: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0001ff40: 2241 2053 4153 2063 6972 6375 6c61 7220  "A SAS circular 
-0001ff50: 7265 6769 6f6e 2066 6f72 207b 737d 2063  region for {s} c
-0001ff60: 616e 6e6f 7420 6861 7665 2061 6e20 696e  annot have an in
-0001ff70: 6e65 725f 7261 6469 7573 206c 6172 6765  ner_radius large
-0001ff80: 7220 7468 616e 206f 7220 6571 7561 6c20  r than or equal 
-0001ff90: 746f 2069 7473 2022 0a20 2020 2020 2020  to its ".       
-0001ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ffb0: 2020 2020 2020 226f 7574 6572 5f72 6164        "outer_rad
-0001ffc0: 6975 7322 2e66 6f72 6d61 7428 733d 7365  ius".format(s=se
-0001ffd0: 6c66 2e6e 616d 6529 290a 2020 2020 2020  lf.name)).      
-0001ffe0: 2020 656c 6966 206e 6f74 2069 6e6e 6572    elif not inner
-0001fff0: 5f72 6164 6975 732e 6973 7363 616c 6172  _radius.isscalar
-00020000: 2061 6e64 2028 696e 6e65 725f 7261 6469   and (inner_radi
-00020010: 7573 5b30 5d20 3e3d 206f 7574 6572 5f72  us[0] >= outer_r
-00020020: 6164 6975 735b 305d 206f 7220 696e 6e65  adius[0] or inne
-00020030: 725f 7261 6469 7573 5b31 5d20 3e3d 206f  r_radius[1] >= o
-00020040: 7574 6572 5f72 6164 6975 735b 315d 293a  uter_radius[1]):
-00020050: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00020060: 7365 2056 616c 7565 4572 726f 7228 2241  se ValueError("A
-00020070: 2053 4153 2065 6c6c 6970 7469 6361 6c20   SAS elliptical 
-00020080: 7265 6769 6f6e 2066 6f72 207b 737d 2063  region for {s} c
-00020090: 616e 6e6f 7420 6861 7665 2069 6e6e 6572  annot have inner
-000200a0: 2072 6164 6969 206c 6172 6765 7220 7468   radii larger th
-000200b0: 616e 206f 7220 6571 7561 6c20 746f 2069  an or equal to i
-000200c0: 7473 2022 0a20 2020 2020 2020 2020 2020  ts ".           
-000200d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200e0: 2020 226f 7574 6572 2072 6164 6969 222e    "outer radii".
-000200f0: 666f 726d 6174 2873 3d73 656c 662e 6e61  format(s=self.na
-00020100: 6d65 2929 0a0a 2020 2020 2020 2020 6966  me))..        if
-00020110: 206f 7574 7075 745f 756e 6974 203d 3d20   output_unit == 
-00020120: 786d 6d5f 6465 743a 0a20 2020 2020 2020  xmm_det:.       
-00020130: 2020 2020 2063 5f73 7472 203d 2022 4445       c_str = "DE
-00020140: 5458 2c44 4554 5922 0a20 2020 2020 2020  TX,DETY".       
-00020150: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
-00020160: 706c 656d 656e 7465 6445 7272 6f72 2822  plementedError("
-00020170: 5468 6973 2063 6f6f 7264 696e 6174 6520  This coordinate 
-00020180: 7379 7374 656d 2069 7320 6e6f 7420 7965  system is not ye
-00020190: 7420 7375 7070 6f72 7465 642c 2061 6e64  t supported, and
-000201a0: 2069 736e 2774 2061 2070 7269 6f72 6974   isn't a priorit
-000201b0: 792e 2050 6c65 6173 6520 220a 2020 2020  y. Please ".    
-000201c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201e0: 2020 2273 7562 6d69 7420 616e 2069 7373    "submit an iss
-000201f0: 7565 206f 6e20 6874 7470 733a 2f2f 6769  ue on https://gi
-00020200: 7468 7562 2e63 6f6d 2f44 6176 6964 5433  thub.com/DavidT3
-00020210: 2f58 4741 2f69 7373 7565 7320 6966 2079  /XGA/issues if y
-00020220: 6f75 2070 6172 7469 6375 6c61 726c 7920  ou particularly 
-00020230: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00020240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020250: 2020 2020 2020 2020 2277 616e 7420 7468          "want th
-00020260: 6973 2e22 290a 2020 2020 2020 2020 656c  is.").        el
-00020270: 6966 206f 7574 7075 745f 756e 6974 203d  if output_unit =
-00020280: 3d20 786d 6d5f 736b 793a 0a20 2020 2020  = xmm_sky:.     
-00020290: 2020 2020 2020 2063 5f73 7472 203d 2022         c_str = "
-000202a0: 582c 5922 0a20 2020 2020 2020 2065 6c73  X,Y".        els
-000202b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000202c0: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-000202d0: 7465 6445 7272 6f72 2822 4f6e 6c79 2064  tedError("Only d
-000202e0: 6574 6563 746f 7220 616e 6420 736b 7920  etector and sky 
-000202f0: 636f 6f72 6469 6e61 7465 7320 6172 6520  coordinates are 
-00020300: 6375 7272 656e 746c 7920 220a 2020 2020  currently ".    
-00020310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020330: 2020 2273 7570 706f 7274 6564 2066 6f72    "supported for
-00020340: 2067 656e 6572 6174 696e 6720 5341 5320   generating SAS 
-00020350: 7265 6769 6f6e 2073 7472 696e 6773 2e22  region strings."
-00020360: 290a 0a20 2020 2020 2020 2023 2057 6520  )..        # We 
-00020370: 6e65 6564 2061 206d 6174 6368 696e 6720  need a matching 
-00020380: 696d 6167 6520 746f 2070 6572 666f 726d  image to perform
-00020390: 2074 6865 2063 6f6f 7264 696e 6174 6520   the coordinate 
-000203a0: 636f 6e76 6572 7369 6f6e 2077 6520 7265  conversion we re
-000203b0: 7175 6972 650a 2020 2020 2020 2020 7265  quire.        re
-000203c0: 6c5f 696d 203d 2073 656c 662e 6765 745f  l_im = self.get_
-000203d0: 7072 6f64 7563 7473 2822 696d 6167 6522  products("image"
-000203e0: 2c20 6f62 735f 6964 2c20 696e 7374 295b  , obs_id, inst)[
-000203f0: 305d 0a20 2020 2020 2020 2023 2057 6520  0].        # We 
-00020400: 6361 6e20 7365 7420 6f75 7220 6f77 6e20  can set our own 
-00020410: 6f66 6673 6574 2076 616c 7565 2077 6865  offset value whe
-00020420: 6e20 7765 2063 616c 6c20 7468 6973 2066  n we call this f
-00020430: 756e 6374 696f 6e2c 2062 7574 2049 2064  unction, but I d
-00020440: 6f6e 2774 2074 6869 6e6b 2049 206e 6565  on't think I nee
-00020450: 6420 746f 0a20 2020 2020 2020 2073 6b79  d to.        sky
-00020460: 5f74 6f5f 6465 6720 3d20 736b 795f 6465  _to_deg = sky_de
-00020470: 675f 7363 616c 6528 7265 6c5f 696d 2c20  g_scale(rel_im, 
-00020480: 6365 6e74 7261 6c5f 636f 6f72 6429 2e76  central_coord).v
-00020490: 616c 7565 0a0a 2020 2020 2020 2020 2320  alue..        # 
-000204a0: 5765 206e 6565 6420 6f75 7220 6368 6f73  We need our chos
-000204b0: 656e 2063 656e 7472 616c 2063 6f6f 7264  en central coord
-000204c0: 696e 6174 6573 2069 6e20 7468 6520 7269  inates in the ri
-000204d0: 6768 7420 756e 6974 7320 6f66 2063 6f75  ght units of cou
-000204e0: 7273 650a 2020 2020 2020 2020 786d 6d5f  rse.        xmm_
-000204f0: 6365 6e74 7261 6c5f 636f 6f72 6420 3d20  central_coord = 
-00020500: 7265 6c5f 696d 2e63 6f6f 7264 5f63 6f6e  rel_im.coord_con
-00020510: 7628 6365 6e74 7261 6c5f 636f 6f72 642c  v(central_coord,
-00020520: 206f 7574 7075 745f 756e 6974 290a 2020   output_unit).  
-00020530: 2020 2020 2020 2320 416e 6420 6a75 7374        # And just
-00020540: 2074 6f20 6d61 6b65 2073 7572 6520 7468   to make sure th
-00020550: 6520 6365 6e74 7261 6c20 636f 6f72 6469  e central coordi
-00020560: 6e61 7465 7320 6172 6520 696e 2064 6567  nates are in deg
-00020570: 7265 6573 0a20 2020 2020 2020 2064 6567  rees.        deg
-00020580: 5f63 656e 7472 616c 5f63 6f6f 7264 203d  _central_coord =
-00020590: 2072 656c 5f69 6d2e 636f 6f72 645f 636f   rel_im.coord_co
-000205a0: 6e76 2863 656e 7472 616c 5f63 6f6f 7264  nv(central_coord
-000205b0: 2c20 6465 6729 0a0a 2020 2020 2020 2020  , deg)..        
-000205c0: 2320 4966 2074 6865 2075 7365 7220 646f  # If the user do
-000205d0: 6573 6e27 7420 7061 7373 2061 6e79 2072  esn't pass any r
-000205e0: 6567 696f 6e73 2c20 7468 656e 2077 6520  egions, then we 
-000205f0: 6861 7665 2074 6f20 6669 6e64 2074 6865  have to find the
-00020600: 6d20 6f75 7273 656c 7665 732e 2049 2064  m ourselves. I d
-00020610: 6563 6964 6564 2074 6f20 616c 6c6f 7720  ecided to allow 
-00020620: 7468 6973 0a20 2020 2020 2020 2023 2020  this.        #  
-00020630: 736f 2074 6861 7420 7769 7468 696e 5f72  so that within_r
-00020640: 6164 6969 2063 616e 206a 7573 7420 6265  adii can just be
-00020650: 2063 616c 6c65 6420 6f6e 6365 2065 7874   called once ext
-00020660: 6572 6e61 6c6c 7920 666f 7220 6120 7365  ernally for a se
-00020670: 7420 6f66 204f 6273 4944 2d69 6e73 7472  t of ObsID-instr
-00020680: 756d 656e 7420 636f 6d62 696e 6174 696f  ument combinatio
-00020690: 6e73 2c0a 2020 2020 2020 2020 2320 206c  ns,.        #  l
-000206a0: 696b 6520 696e 2065 7673 656c 6563 745f  ike in evselect_
-000206b0: 7370 6563 7472 756d 2066 6f72 2069 6e73  spectrum for ins
-000206c0: 7461 6e63 652e 0a20 2020 2020 2020 2069  tance..        i
-000206d0: 6620 696e 7465 726c 6f70 6572 5f72 6567  f interloper_reg
-000206e0: 696f 6e73 2069 7320 4e6f 6e65 2061 6e64  ions is None and
-000206f0: 2069 6e6e 6572 5f72 6164 6975 732e 6973   inner_radius.is
-00020700: 7363 616c 6172 3a0a 2020 2020 2020 2020  scalar:.        
-00020710: 2020 2020 696e 7465 726c 6f70 6572 5f72      interloper_r
-00020720: 6567 696f 6e73 203d 2073 656c 662e 7265  egions = self.re
-00020730: 6769 6f6e 735f 7769 7468 696e 5f72 6164  gions_within_rad
-00020740: 6969 2869 6e6e 6572 5f72 6164 6975 732c  ii(inner_radius,
-00020750: 206f 7574 6572 5f72 6164 6975 732c 2064   outer_radius, d
-00020760: 6567 5f63 656e 7472 616c 5f63 6f6f 7264  eg_central_coord
-00020770: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
-00020780: 6e74 6572 6c6f 7065 725f 7265 6769 6f6e  nterloper_region
-00020790: 7320 6973 204e 6f6e 6520 616e 6420 6e6f  s is None and no
-000207a0: 7420 696e 6e65 725f 7261 6469 7573 2e69  t inner_radius.i
-000207b0: 7373 6361 6c61 723a 0a20 2020 2020 2020  sscalar:.       
-000207c0: 2020 2020 2069 6e74 6572 6c6f 7065 725f       interloper_
-000207d0: 7265 6769 6f6e 7320 3d20 7365 6c66 2e72  regions = self.r
-000207e0: 6567 696f 6e73 5f77 6974 6869 6e5f 7261  egions_within_ra
-000207f0: 6469 6928 6d69 6e28 696e 6e65 725f 7261  dii(min(inner_ra
-00020800: 6469 7573 292c 206d 6178 286f 7574 6572  dius), max(outer
-00020810: 5f72 6164 6975 7329 2c20 6465 675f 6365  _radius), deg_ce
-00020820: 6e74 7261 6c5f 636f 6f72 6429 0a0a 2020  ntral_coord)..  
-00020830: 2020 2020 2020 2320 536f 206e 6f77 2077        # So now w
-00020840: 6520 636f 6e76 6572 7420 6f75 7220 696e  e convert our in
-00020850: 7465 726c 6f70 6572 2072 6567 696f 6e73  terloper regions
-00020860: 2069 6e74 6f20 7468 6569 7220 5341 5320   into their SAS 
-00020870: 6571 7569 7661 6c65 6e74 730a 2020 2020  equivalents.    
-00020880: 2020 2020 7361 735f 696e 7465 726c 6f70      sas_interlop
-00020890: 6572 203d 205b 7365 6c66 2e5f 696e 7465  er = [self._inte
-000208a0: 726c 6f70 6572 5f73 6173 5f73 7472 696e  rloper_sas_strin
-000208b0: 6728 692c 2072 656c 5f69 6d2c 206f 7574  g(i, rel_im, out
-000208c0: 7075 745f 756e 6974 2920 666f 7220 6920  put_unit) for i 
-000208d0: 696e 2069 6e74 6572 6c6f 7065 725f 7265  in interloper_re
-000208e0: 6769 6f6e 735d 0a0a 2020 2020 2020 2020  gions]..        
-000208f0: 6966 2069 6e6e 6572 5f72 6164 6975 732e  if inner_radius.
-00020900: 6973 7363 616c 6172 2061 6e64 2069 6e6e  isscalar and inn
-00020910: 6572 5f72 6164 6975 732e 7661 6c75 6520  er_radius.value 
-00020920: 213d 2030 3a0a 2020 2020 2020 2020 2020  != 0:.          
-00020930: 2020 2320 416e 6420 7765 206e 6565 6420    # And we need 
-00020940: 746f 2064 6566 696e 6520 6120 5341 5320  to define a SAS 
-00020950: 7374 7269 6e67 2066 6f72 2074 6865 2061  string for the a
-00020960: 6374 7561 6c20 7265 6769 6f6e 206f 6620  ctual region of 
-00020970: 696e 7465 7265 7374 0a20 2020 2020 2020  interest.       
-00020980: 2020 2020 2073 6173 5f73 6f75 7263 655f       sas_source_
-00020990: 6172 6561 203d 2022 2828 7b74 7d29 2049  area = "(({t}) I
-000209a0: 4e20 616e 6e75 6c75 7328 7b63 787d 2c7b  N annulus({cx},{
-000209b0: 6379 7d2c 7b72 697d 2c7b 726f 7d29 2922  cy},{ri},{ro}))"
-000209c0: 0a20 2020 2020 2020 2020 2020 2073 6173  .            sas
-000209d0: 5f73 6f75 7263 655f 6172 6561 203d 2073  _source_area = s
-000209e0: 6173 5f73 6f75 7263 655f 6172 6561 2e66  as_source_area.f
-000209f0: 6f72 6d61 7428 743d 635f 7374 722c 2063  ormat(t=c_str, c
-00020a00: 783d 786d 6d5f 6365 6e74 7261 6c5f 636f  x=xmm_central_co
-00020a10: 6f72 645b 305d 2e76 616c 7565 2c0a 2020  ord[0].value,.  
-00020a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a50: 2020 2063 793d 786d 6d5f 6365 6e74 7261     cy=xmm_centra
-00020a60: 6c5f 636f 6f72 645b 315d 2e76 616c 7565  l_coord[1].value
-00020a70: 2c20 7269 3d69 6e6e 6572 5f72 6164 6975  , ri=inner_radiu
-00020a80: 732e 7661 6c75 652f 736b 795f 746f 5f64  s.value/sky_to_d
-00020a90: 6567 2c0a 2020 2020 2020 2020 2020 2020  eg,.            
-00020aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ac0: 2020 2020 2020 2020 2072 6f3d 6f75 7465           ro=oute
-00020ad0: 725f 7261 6469 7573 2e76 616c 7565 2f73  r_radius.value/s
-00020ae0: 6b79 5f74 6f5f 6465 6729 0a20 2020 2020  ky_to_deg).     
-00020af0: 2020 2023 2049 6620 7468 6520 696e 6e65     # If the inne
-00020b00: 7220 7261 6469 7573 2069 7320 7a65 726f  r radius is zero
-00020b10: 2074 6865 6e20 7765 2077 7269 7465 2061   then we write a
-00020b20: 2063 6972 636c 6520 7265 6769 6f6e 2c20   circle region, 
-00020b30: 6265 6361 7573 6520 6974 2073 6565 6d73  because it seems
-00020b40: 2074 6861 7427 7320 6120 4c4f 5420 6661   that's a LOT fa
-00020b50: 7374 6572 2069 6e20 5341 530a 2020 2020  ster in SAS.    
-00020b60: 2020 2020 656c 6966 2069 6e6e 6572 5f72      elif inner_r
-00020b70: 6164 6975 732e 6973 7363 616c 6172 2061  adius.isscalar a
-00020b80: 6e64 2069 6e6e 6572 5f72 6164 6975 732e  nd inner_radius.
-00020b90: 7661 6c75 6520 3d3d 2030 3a0a 2020 2020  value == 0:.    
-00020ba0: 2020 2020 2020 2020 7361 735f 736f 7572          sas_sour
-00020bb0: 6365 5f61 7265 6120 3d20 2228 287b 747d  ce_area = "(({t}
-00020bc0: 2920 494e 2063 6972 636c 6528 7b63 787d  ) IN circle({cx}
-00020bd0: 2c7b 6379 7d2c 7b72 7d29 2922 0a20 2020  ,{cy},{r}))".   
-00020be0: 2020 2020 2020 2020 2073 6173 5f73 6f75           sas_sou
-00020bf0: 7263 655f 6172 6561 203d 2073 6173 5f73  rce_area = sas_s
-00020c00: 6f75 7263 655f 6172 6561 2e66 6f72 6d61  ource_area.forma
-00020c10: 7428 743d 635f 7374 722c 2063 783d 786d  t(t=c_str, cx=xm
-00020c20: 6d5f 6365 6e74 7261 6c5f 636f 6f72 645b  m_central_coord[
-00020c30: 305d 2e76 616c 7565 2c0a 2020 2020 2020  0].value,.      
-00020c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c60: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00020c70: 793d 786d 6d5f 6365 6e74 7261 6c5f 636f  y=xmm_central_co
-00020c80: 6f72 645b 315d 2e76 616c 7565 2c0a 2020  ord[1].value,.  
-00020c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020cc0: 2020 2072 3d6f 7574 6572 5f72 6164 6975     r=outer_radiu
-00020cd0: 732e 7661 6c75 652f 736b 795f 746f 5f64  s.value/sky_to_d
-00020ce0: 6567 290a 2020 2020 2020 2020 656c 6966  eg).        elif
-00020cf0: 206e 6f74 2069 6e6e 6572 5f72 6164 6975   not inner_radiu
-00020d00: 732e 6973 7363 616c 6172 2061 6e64 2069  s.isscalar and i
-00020d10: 6e6e 6572 5f72 6164 6975 735b 305d 2e76  nner_radius[0].v
-00020d20: 616c 7565 2021 3d20 303a 0a20 2020 2020  alue != 0:.     
-00020d30: 2020 2020 2020 2073 6173 5f73 6f75 7263         sas_sourc
-00020d40: 655f 6172 6561 203d 2022 2828 7b74 7d29  e_area = "(({t})
-00020d50: 2049 4e20 656c 6c69 7074 616e 6e75 6c75   IN elliptannulu
-00020d60: 7328 7b63 787d 2c7b 6379 7d2c 7b77 697d  s({cx},{cy},{wi}
-00020d70: 2c7b 6869 7d2c 7b77 6f7d 2c7b 686f 7d2c  ,{hi},{wo},{ho},
-00020d80: 7b72 6f74 7d2c 7b72 6f74 7d29 2922 0a20  {rot},{rot}))". 
-00020d90: 2020 2020 2020 2020 2020 2073 6173 5f73             sas_s
-00020da0: 6f75 7263 655f 6172 6561 203d 2073 6173  ource_area = sas
-00020db0: 5f73 6f75 7263 655f 6172 6561 2e66 6f72  _source_area.for
-00020dc0: 6d61 7428 743d 635f 7374 722c 2063 783d  mat(t=c_str, cx=
-00020dd0: 786d 6d5f 6365 6e74 7261 6c5f 636f 6f72  xmm_central_coor
-00020de0: 645b 305d 2e76 616c 7565 2c0a 2020 2020  d[0].value,.    
-00020df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e20: 2063 793d 786d 6d5f 6365 6e74 7261 6c5f   cy=xmm_central_
-00020e30: 636f 6f72 645b 315d 2e76 616c 7565 2c0a  coord[1].value,.
-00020e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e70: 2020 2020 2077 693d 696e 6e65 725f 7261       wi=inner_ra
-00020e80: 6469 7573 5b30 5d2e 7661 6c75 652f 736b  dius[0].value/sk
-00020e90: 795f 746f 5f64 6567 2c0a 2020 2020 2020  y_to_deg,.      
-00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ec0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00020ed0: 693d 696e 6e65 725f 7261 6469 7573 5b31  i=inner_radius[1
-00020ee0: 5d2e 7661 6c75 652f 736b 795f 746f 5f64  ].value/sky_to_d
-00020ef0: 6567 2c0a 2020 2020 2020 2020 2020 2020  eg,.            
-00020f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f490: 6379 3d63 6f6e 765f 6365 6e5b 315d 2e72  cy=conv_cen[1].r
+0001f4a0: 6f75 6e64 2834 292e 7661 6c75 652c 2077  ound(4).value, w
+0001f4b0: 3d77 2c20 683d 682c 0a20 2020 2020 2020  =w, h=h,.       
+0001f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f500: 2020 2020 2020 726f 743d 7265 672e 616e        rot=reg.an
+0001f510: 676c 652e 726f 756e 6428 3429 2e76 616c  gle.round(4).val
+0001f520: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
+0001f530: 726e 2073 6861 7065 5f73 7472 0a0a 2020  rn shape_str..  
+0001f540: 2020 6465 6620 6765 745f 616e 6e75 6c61    def get_annula
+0001f550: 725f 7361 735f 7265 6769 6f6e 2873 656c  r_sas_region(sel
+0001f560: 662c 2069 6e6e 6572 5f72 6164 6975 733a  f, inner_radius:
+0001f570: 2051 7561 6e74 6974 792c 206f 7574 6572   Quantity, outer
+0001f580: 5f72 6164 6975 733a 2051 7561 6e74 6974  _radius: Quantit
+0001f590: 792c 206f 6273 5f69 643a 2073 7472 2c20  y, obs_id: str, 
+0001f5a0: 696e 7374 3a20 7374 722c 0a20 2020 2020  inst: str,.     
+0001f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f5c0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+0001f5d0: 5f75 6e69 743a 2055 6e69 6f6e 5b55 6e69  _unit: Union[Uni
+0001f5e0: 7442 6173 652c 2073 7472 5d20 3d20 786d  tBase, str] = xm
+0001f5f0: 6d5f 736b 792c 2072 6f74 5f61 6e67 6c65  m_sky, rot_angle
+0001f600: 3a20 5175 616e 7469 7479 203d 2051 7561  : Quantity = Qua
+0001f610: 6e74 6974 7928 302c 2027 6465 6727 292c  ntity(0, 'deg'),
+0001f620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f640: 696e 7465 726c 6f70 6572 5f72 6567 696f  interloper_regio
+0001f650: 6e73 3a20 6e70 2e6e 6461 7272 6179 203d  ns: np.ndarray =
+0001f660: 204e 6f6e 652c 2063 656e 7472 616c 5f63   None, central_c
+0001f670: 6f6f 7264 3a20 5175 616e 7469 7479 203d  oord: Quantity =
+0001f680: 204e 6f6e 6529 202d 3e20 7374 723a 0a20   None) -> str:. 
+0001f690: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001f6a0: 2020 2041 206d 6574 686f 6420 746f 2067     A method to g
+0001f6b0: 656e 6572 6174 6520 6120 5341 5320 7265  enerate a SAS re
+0001f6c0: 6769 6f6e 2073 7472 696e 6720 666f 7220  gion string for 
+0001f6d0: 616e 2061 7262 6974 7261 7279 2063 6972  an arbitrary cir
+0001f6e0: 6375 6c61 7220 6f72 2065 6c6c 6970 7469  cular or ellipti
+0001f6f0: 6361 6c20 616e 6e75 6c61 7220 7265 6769  cal annular regi
+0001f700: 6f6e 2c20 7769 7468 0a20 2020 2020 2020  on, with.       
+0001f710: 2069 6e74 6572 6c6f 7065 7220 736f 7572   interloper sour
+0001f720: 6365 7320 7265 6d6f 7665 642e 0a0a 2020  ces removed...  
+0001f730: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
+0001f740: 6e74 6974 7920 696e 6e65 725f 7261 6469  ntity inner_radi
+0001f750: 7573 3a20 5468 6520 696e 6e65 7220 7261  us: The inner ra
+0001f760: 6469 7573 2f72 6164 6969 206f 6620 7468  dius/radii of th
+0001f770: 6520 7265 6769 6f6e 2079 6f75 2077 6973  e region you wis
+0001f780: 6820 746f 2067 656e 6572 6174 6520 696e  h to generate in
+0001f790: 2053 4153 2c20 6966 2074 6865 0a20 2020   SAS, if the.   
+0001f7a0: 2020 2020 2020 2020 2071 7561 6e74 6974           quantit
+0001f7b0: 7920 6861 7320 6d75 6c74 6970 6c65 2065  y has multiple e
+0001f7c0: 6c65 6d65 6e74 7320 7468 656e 2061 6e20  lements then an 
+0001f7d0: 656c 6c69 7074 6963 616c 2072 6567 696f  elliptical regio
+0001f7e0: 6e20 7769 6c6c 2062 6520 6765 6e65 7261  n will be genera
+0001f7f0: 7465 642c 2077 6974 6820 7468 6520 6669  ted, with the fi
+0001f800: 7273 7420 656c 656d 656e 740a 2020 2020  rst element.    
+0001f810: 2020 2020 2020 2020 6265 696e 6720 7468          being th
+0001f820: 6520 696e 6e65 7220 7261 6469 7573 206f  e inner radius o
+0001f830: 6e20 7468 6520 7365 6d69 2d6d 616a 6f72  n the semi-major
+0001f840: 2061 7869 732c 2061 6e64 2074 6865 2073   axis, and the s
+0001f850: 6563 6f6e 6420 6f6e 2074 6865 2073 656d  econd on the sem
+0001f860: 692d 6d69 6e6f 7220 6178 6973 2e0a 2020  i-minor axis..  
+0001f870: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
+0001f880: 6e74 6974 7920 6f75 7465 725f 7261 6469  ntity outer_radi
+0001f890: 7573 3a20 5468 6520 696e 6e65 7220 6f75  us: The inner ou
+0001f8a0: 7465 725f 7261 6469 7573 2f72 6164 6969  ter_radius/radii
+0001f8b0: 206f 6620 7468 6520 7265 6769 6f6e 2079   of the region y
+0001f8c0: 6f75 2077 6973 6820 746f 2067 656e 6572  ou wish to gener
+0001f8d0: 6174 6520 696e 2053 4153 2c20 6966 2074  ate in SAS, if t
+0001f8e0: 6865 0a20 2020 2020 2020 2020 2020 2071  he.            q
+0001f8f0: 7561 6e74 6974 7920 6861 7320 6d75 6c74  uantity has mult
+0001f900: 6970 6c65 2065 6c65 6d65 6e74 7320 7468  iple elements th
+0001f910: 656e 2061 6e20 656c 6c69 7074 6963 616c  en an elliptical
+0001f920: 2072 6567 696f 6e20 7769 6c6c 2062 6520   region will be 
+0001f930: 6765 6e65 7261 7465 642c 2077 6974 6820  generated, with 
+0001f940: 7468 6520 6669 7273 7420 656c 656d 656e  the first elemen
+0001f950: 740a 2020 2020 2020 2020 2020 2020 6265  t.            be
+0001f960: 696e 6720 7468 6520 6f75 7465 7220 7261  ing the outer ra
+0001f970: 6469 7573 206f 6e20 7468 6520 7365 6d69  dius on the semi
+0001f980: 2d6d 616a 6f72 2061 7869 732c 2061 6e64  -major axis, and
+0001f990: 2074 6865 2073 6563 6f6e 6420 6f6e 2074   the second on t
+0001f9a0: 6865 2073 656d 692d 6d69 6e6f 7220 6178  he semi-minor ax
+0001f9b0: 6973 2e0a 2020 2020 2020 2020 3a70 6172  is..        :par
+0001f9c0: 616d 2073 7472 206f 6273 5f69 643a 2054  am str obs_id: T
+0001f9d0: 6865 204f 6273 4944 206f 6620 7468 6520  he ObsID of the 
+0001f9e0: 6f62 7365 7276 6174 696f 6e20 796f 7520  observation you 
+0001f9f0: 7769 7368 2074 6f20 6765 6e65 7261 7465  wish to generate
+0001fa00: 2074 6865 2053 4153 2072 6567 696f 6e20   the SAS region 
+0001fa10: 666f 722e 0a20 2020 2020 2020 203a 7061  for..        :pa
+0001fa20: 7261 6d20 7374 7220 696e 7374 3a20 5468  ram str inst: Th
+0001fa30: 6520 696e 7374 7275 6d65 6e74 206f 6620  e instrument of 
+0001fa40: 7468 6520 6f62 7365 7276 6174 696f 6e20  the observation 
+0001fa50: 796f 7520 746f 2067 656e 6572 6174 6520  you to generate 
+0001fa60: 7468 6520 5341 5320 7265 6769 6f6e 2066  the SAS region f
+0001fa70: 6f72 2e0a 2020 2020 2020 2020 3a70 6172  or..        :par
+0001fa80: 616d 2055 6e69 7442 6173 652f 7374 7220  am UnitBase/str 
+0001fa90: 6f75 7470 7574 5f75 6e69 743a 2054 6865  output_unit: The
+0001faa0: 206f 7574 7075 7420 756e 6974 2066 6f72   output unit for
+0001fab0: 2074 6869 7320 5341 5320 7265 6769 6f6e   this SAS region
+0001fac0: 2c20 6569 7468 6572 2078 6d6d 5f73 6b79  , either xmm_sky
+0001fad0: 206f 7220 786d 6d5f 6465 742e 0a20 2020   or xmm_det..   
+0001fae0: 2020 2020 203a 7061 7261 6d20 6e70 2e6e       :param np.n
+0001faf0: 6461 7272 6179 2069 6e74 6572 6c6f 7065  darray interlope
+0001fb00: 725f 7265 6769 6f6e 733a 2054 6865 2069  r_regions: The i
+0001fb10: 6e74 6572 6c6f 7065 7220 7265 6769 6f6e  nterloper region
+0001fb20: 7320 746f 2072 656d 6f76 6520 6672 6f6d  s to remove from
+0001fb30: 2074 6865 2073 6f75 7263 6520 7265 6769   the source regi
+0001fb40: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0001fb50: 6465 6661 756c 7420 6973 204e 6f6e 652c  default is None,
+0001fb60: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
+0001fb70: 6865 2066 756e 6374 696f 6e20 7769 6c6c  he function will
+0001fb80: 2072 756e 2073 656c 662e 7265 6769 6f6e   run self.region
+0001fb90: 735f 7769 7468 696e 5f72 6164 6969 2e0a  s_within_radii..
+0001fba0: 2020 2020 2020 2020 3a70 6172 616d 2051          :param Q
+0001fbb0: 7561 6e74 6974 7920 726f 745f 616e 676c  uantity rot_angl
+0001fbc0: 653a 2054 6865 2072 6f74 6174 696f 6e20  e: The rotation 
+0001fbd0: 616e 676c 6520 6f66 2074 6865 2073 6f75  angle of the sou
+0001fbe0: 7263 6520 7265 6769 6f6e 2c20 6465 6661  rce region, defa
+0001fbf0: 756c 7420 6973 207a 6572 6f20 6465 6772  ult is zero degr
+0001fc00: 6565 732e 0a20 2020 2020 2020 203a 7061  ees..        :pa
+0001fc10: 7261 6d20 5175 616e 7469 7479 2063 656e  ram Quantity cen
+0001fc20: 7472 616c 5f63 6f6f 7264 3a20 5468 6520  tral_coord: The 
+0001fc30: 636f 6f72 6469 6e61 7465 206f 6e20 7768  coordinate on wh
+0001fc40: 6963 6820 746f 2063 656e 7472 6520 7468  ich to centre th
+0001fc50: 6520 736f 7572 6365 2072 6567 696f 6e2c  e source region,
+0001fc60: 2064 6566 6175 6c74 2069 730a 2020 2020   default is.    
+0001fc70: 2020 2020 2020 2020 4e6f 6e65 2069 6e20          None in 
+0001fc80: 7768 6963 6820 6361 7365 2074 6865 2066  which case the f
+0001fc90: 756e 6374 696f 6e20 7769 6c6c 2075 7365  unction will use
+0001fca0: 2074 6865 2064 6566 6175 6c74 5f63 6f6f   the default_coo
+0001fcb0: 7264 206f 6620 7468 6520 736f 7572 6365  rd of the source
+0001fcc0: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
+0001fcd0: 203a 7265 7475 726e 3a20 4120 7374 7269   :return: A stri
+0001fce0: 6e67 2066 6f72 2075 7365 2069 6e20 6120  ng for use in a 
+0001fcf0: 5341 5320 726f 7574 696e 6520 7468 6174  SAS routine that
+0001fd00: 2064 6573 6372 6962 6573 2074 6865 2073   describes the s
+0001fd10: 6f75 7263 6520 7265 6769 6f6e 2c20 616e  ource region, an
+0001fd20: 6420 7468 6520 7265 6769 6f6e 730a 2020  d the regions.  
+0001fd30: 2020 2020 2020 2020 2020 746f 2063 7574            to cut
+0001fd40: 206f 7574 206f 6620 6974 2e0a 2020 2020   out of it..    
+0001fd50: 2020 2020 3a72 7479 7065 3a20 7374 720a      :rtype: str.
+0001fd60: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0001fd70: 2020 2020 2069 6620 6365 6e74 7261 6c5f       if central_
+0001fd80: 636f 6f72 6420 6973 204e 6f6e 653a 0a20  coord is None:. 
+0001fd90: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+0001fda0: 616c 5f63 6f6f 7264 203d 2073 656c 662e  al_coord = self.
+0001fdb0: 5f64 6566 6175 6c74 5f63 6f6f 7264 0a0a  _default_coord..
+0001fdc0: 2020 2020 2020 2020 2320 5468 6573 6520          # These 
+0001fdd0: 6368 6563 6b73 2f63 6f6e 7665 7273 696f  checks/conversio
+0001fde0: 6e73 2061 7265 2061 6c72 6561 6479 2064  ns are already d
+0001fdf0: 6f6e 6520 6279 2074 6865 2065 7673 656c  one by the evsel
+0001fe00: 6563 745f 7370 6563 7472 756d 2063 6f6d  ect_spectrum com
+0001fe10: 6d61 6e64 2c20 6275 7420 4920 646f 6e27  mand, but I don'
+0001fe20: 740a 2020 2020 2020 2020 2320 206d 696e  t.        #  min
+0001fe30: 6420 646f 696e 6720 7468 656d 2061 6761  d doing them aga
+0001fe40: 696e 0a20 2020 2020 2020 2069 6e6e 6572  in.        inner
+0001fe50: 5f72 6164 6975 7320 3d20 7365 6c66 2e63  _radius = self.c
+0001fe60: 6f6e 7665 7274 5f72 6164 6975 7328 696e  onvert_radius(in
+0001fe70: 6e65 725f 7261 6469 7573 2c20 2764 6567  ner_radius, 'deg
+0001fe80: 2729 0a20 2020 2020 2020 206f 7574 6572  ').        outer
+0001fe90: 5f72 6164 6975 7320 3d20 7365 6c66 2e63  _radius = self.c
+0001fea0: 6f6e 7665 7274 5f72 6164 6975 7328 6f75  onvert_radius(ou
+0001feb0: 7465 725f 7261 6469 7573 2c20 2764 6567  ter_radius, 'deg
+0001fec0: 2729 0a0a 2020 2020 2020 2020 2320 5468  ')..        # Th
+0001fed0: 656e 2077 6520 6361 6e20 6368 6563 6b20  en we can check 
+0001fee0: 746f 206d 616b 6520 7375 7265 2074 6861  to make sure tha
+0001fef0: 7420 7468 6520 6f75 7465 7220 7261 6469  t the outer radi
+0001ff00: 7573 2069 7320 6c61 7267 6572 2074 6861  us is larger tha
+0001ff10: 6e20 7468 6520 696e 6e65 7220 7261 6469  n the inner radi
+0001ff20: 7573 0a20 2020 2020 2020 2069 6620 696e  us.        if in
+0001ff30: 6e65 725f 7261 6469 7573 2e69 7373 6361  ner_radius.issca
+0001ff40: 6c61 7220 616e 6420 696e 6e65 725f 7261  lar and inner_ra
+0001ff50: 6469 7573 203e 3d20 6f75 7465 725f 7261  dius >= outer_ra
+0001ff60: 6469 7573 3a0a 2020 2020 2020 2020 2020  dius:.          
+0001ff70: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0001ff80: 6f72 2822 4120 5341 5320 6369 7263 756c  or("A SAS circul
+0001ff90: 6172 2072 6567 696f 6e20 666f 7220 7b73  ar region for {s
+0001ffa0: 7d20 6361 6e6e 6f74 2068 6176 6520 616e  } cannot have an
+0001ffb0: 2069 6e6e 6572 5f72 6164 6975 7320 6c61   inner_radius la
+0001ffc0: 7267 6572 2074 6861 6e20 6f72 2065 7175  rger than or equ
+0001ffd0: 616c 2074 6f20 6974 7320 220a 2020 2020  al to its ".    
+0001ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fff0: 2020 2020 2020 2020 2022 6f75 7465 725f           "outer_
+00020000: 7261 6469 7573 222e 666f 726d 6174 2873  radius".format(s
+00020010: 3d73 656c 662e 6e61 6d65 2929 0a20 2020  =self.name)).   
+00020020: 2020 2020 2065 6c69 6620 6e6f 7420 696e       elif not in
+00020030: 6e65 725f 7261 6469 7573 2e69 7373 6361  ner_radius.issca
+00020040: 6c61 7220 616e 6420 2869 6e6e 6572 5f72  lar and (inner_r
+00020050: 6164 6975 735b 305d 203e 3d20 6f75 7465  adius[0] >= oute
+00020060: 725f 7261 6469 7573 5b30 5d20 6f72 2069  r_radius[0] or i
+00020070: 6e6e 6572 5f72 6164 6975 735b 315d 203e  nner_radius[1] >
+00020080: 3d20 6f75 7465 725f 7261 6469 7573 5b31  = outer_radius[1
+00020090: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+000200a0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000200b0: 2822 4120 5341 5320 656c 6c69 7074 6963  ("A SAS elliptic
+000200c0: 616c 2072 6567 696f 6e20 666f 7220 7b73  al region for {s
+000200d0: 7d20 6361 6e6e 6f74 2068 6176 6520 696e  } cannot have in
+000200e0: 6e65 7220 7261 6469 6920 6c61 7267 6572  ner radii larger
+000200f0: 2074 6861 6e20 6f72 2065 7175 616c 2074   than or equal t
+00020100: 6f20 6974 7320 220a 2020 2020 2020 2020  o its ".        
+00020110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020120: 2020 2020 2022 6f75 7465 7220 7261 6469       "outer radi
+00020130: 6922 2e66 6f72 6d61 7428 733d 7365 6c66  i".format(s=self
+00020140: 2e6e 616d 6529 290a 0a20 2020 2020 2020  .name))..       
+00020150: 2069 6620 6f75 7470 7574 5f75 6e69 7420   if output_unit 
+00020160: 3d3d 2078 6d6d 5f64 6574 3a0a 2020 2020  == xmm_det:.    
+00020170: 2020 2020 2020 2020 635f 7374 7220 3d20          c_str = 
+00020180: 2244 4554 582c 4445 5459 220a 2020 2020  "DETX,DETY".    
+00020190: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
+000201a0: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
+000201b0: 7228 2254 6869 7320 636f 6f72 6469 6e61  r("This coordina
+000201c0: 7465 2073 7973 7465 6d20 6973 206e 6f74  te system is not
+000201d0: 2079 6574 2073 7570 706f 7274 6564 2c20   yet supported, 
+000201e0: 616e 6420 6973 6e27 7420 6120 7072 696f  and isn't a prio
+000201f0: 7269 7479 2e20 506c 6561 7365 2022 0a20  rity. Please ". 
+00020200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020220: 2020 2020 2022 7375 626d 6974 2061 6e20       "submit an 
+00020230: 6973 7375 6520 6f6e 2068 7474 7073 3a2f  issue on https:/
+00020240: 2f67 6974 6875 622e 636f 6d2f 4461 7669  /github.com/Davi
+00020250: 6454 332f 5847 412f 6973 7375 6573 2069  dT3/XGA/issues i
+00020260: 6620 796f 7520 7061 7274 6963 756c 6172  f you particular
+00020270: 6c79 2022 0a20 2020 2020 2020 2020 2020  ly ".           
+00020280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020290: 2020 2020 2020 2020 2020 2022 7761 6e74             "want
+000202a0: 2074 6869 732e 2229 0a20 2020 2020 2020   this.").       
+000202b0: 2065 6c69 6620 6f75 7470 7574 5f75 6e69   elif output_uni
+000202c0: 7420 3d3d 2078 6d6d 5f73 6b79 3a0a 2020  t == xmm_sky:.  
+000202d0: 2020 2020 2020 2020 2020 635f 7374 7220            c_str 
+000202e0: 3d20 2258 2c59 220a 2020 2020 2020 2020  = "X,Y".        
+000202f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00020300: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00020310: 6d65 6e74 6564 4572 726f 7228 224f 6e6c  mentedError("Onl
+00020320: 7920 6465 7465 6374 6f72 2061 6e64 2073  y detector and s
+00020330: 6b79 2063 6f6f 7264 696e 6174 6573 2061  ky coordinates a
+00020340: 7265 2063 7572 7265 6e74 6c79 2022 0a20  re currently ". 
+00020350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020370: 2020 2020 2022 7375 7070 6f72 7465 6420       "supported 
+00020380: 666f 7220 6765 6e65 7261 7469 6e67 2053  for generating S
+00020390: 4153 2072 6567 696f 6e20 7374 7269 6e67  AS region string
+000203a0: 732e 2229 0a0a 2020 2020 2020 2020 2320  s.")..        # 
+000203b0: 5765 206e 6565 6420 6120 6d61 7463 6869  We need a matchi
+000203c0: 6e67 2069 6d61 6765 2074 6f20 7065 7266  ng image to perf
+000203d0: 6f72 6d20 7468 6520 636f 6f72 6469 6e61  orm the coordina
+000203e0: 7465 2063 6f6e 7665 7273 696f 6e20 7765  te conversion we
+000203f0: 2072 6571 7569 7265 0a20 2020 2020 2020   require.       
+00020400: 2072 656c 5f69 6d20 3d20 7365 6c66 2e67   rel_im = self.g
+00020410: 6574 5f70 726f 6475 6374 7328 2269 6d61  et_products("ima
+00020420: 6765 222c 206f 6273 5f69 642c 2069 6e73  ge", obs_id, ins
+00020430: 7429 5b30 5d0a 2020 2020 2020 2020 2320  t)[0].        # 
+00020440: 5765 2063 616e 2073 6574 206f 7572 206f  We can set our o
+00020450: 776e 206f 6666 7365 7420 7661 6c75 6520  wn offset value 
+00020460: 7768 656e 2077 6520 6361 6c6c 2074 6869  when we call thi
+00020470: 7320 6675 6e63 7469 6f6e 2c20 6275 7420  s function, but 
+00020480: 4920 646f 6e27 7420 7468 696e 6b20 4920  I don't think I 
+00020490: 6e65 6564 2074 6f0a 2020 2020 2020 2020  need to.        
+000204a0: 736b 795f 746f 5f64 6567 203d 2073 6b79  sky_to_deg = sky
+000204b0: 5f64 6567 5f73 6361 6c65 2872 656c 5f69  _deg_scale(rel_i
+000204c0: 6d2c 2063 656e 7472 616c 5f63 6f6f 7264  m, central_coord
+000204d0: 292e 7661 6c75 650a 0a20 2020 2020 2020  ).value..       
+000204e0: 2023 2057 6520 6e65 6564 206f 7572 2063   # We need our c
+000204f0: 686f 7365 6e20 6365 6e74 7261 6c20 636f  hosen central co
+00020500: 6f72 6469 6e61 7465 7320 696e 2074 6865  ordinates in the
+00020510: 2072 6967 6874 2075 6e69 7473 206f 6620   right units of 
+00020520: 636f 7572 7365 0a20 2020 2020 2020 2078  course.        x
+00020530: 6d6d 5f63 656e 7472 616c 5f63 6f6f 7264  mm_central_coord
+00020540: 203d 2072 656c 5f69 6d2e 636f 6f72 645f   = rel_im.coord_
+00020550: 636f 6e76 2863 656e 7472 616c 5f63 6f6f  conv(central_coo
+00020560: 7264 2c20 6f75 7470 7574 5f75 6e69 7429  rd, output_unit)
+00020570: 0a20 2020 2020 2020 2023 2041 6e64 206a  .        # And j
+00020580: 7573 7420 746f 206d 616b 6520 7375 7265  ust to make sure
+00020590: 2074 6865 2063 656e 7472 616c 2063 6f6f   the central coo
+000205a0: 7264 696e 6174 6573 2061 7265 2069 6e20  rdinates are in 
+000205b0: 6465 6772 6565 730a 2020 2020 2020 2020  degrees.        
+000205c0: 6465 675f 6365 6e74 7261 6c5f 636f 6f72  deg_central_coor
+000205d0: 6420 3d20 7265 6c5f 696d 2e63 6f6f 7264  d = rel_im.coord
+000205e0: 5f63 6f6e 7628 6365 6e74 7261 6c5f 636f  _conv(central_co
+000205f0: 6f72 642c 2064 6567 290a 0a20 2020 2020  ord, deg)..     
+00020600: 2020 2023 2049 6620 7468 6520 7573 6572     # If the user
+00020610: 2064 6f65 736e 2774 2070 6173 7320 616e   doesn't pass an
+00020620: 7920 7265 6769 6f6e 732c 2074 6865 6e20  y regions, then 
+00020630: 7765 2068 6176 6520 746f 2066 696e 6420  we have to find 
+00020640: 7468 656d 206f 7572 7365 6c76 6573 2e20  them ourselves. 
+00020650: 4920 6465 6369 6465 6420 746f 2061 6c6c  I decided to all
+00020660: 6f77 2074 6869 730a 2020 2020 2020 2020  ow this.        
+00020670: 2320 2073 6f20 7468 6174 2077 6974 6869  #  so that withi
+00020680: 6e5f 7261 6469 6920 6361 6e20 6a75 7374  n_radii can just
+00020690: 2062 6520 6361 6c6c 6564 206f 6e63 6520   be called once 
+000206a0: 6578 7465 726e 616c 6c79 2066 6f72 2061  externally for a
+000206b0: 2073 6574 206f 6620 4f62 7349 442d 696e   set of ObsID-in
+000206c0: 7374 7275 6d65 6e74 2063 6f6d 6269 6e61  strument combina
+000206d0: 7469 6f6e 732c 0a20 2020 2020 2020 2023  tions,.        #
+000206e0: 2020 6c69 6b65 2069 6e20 6576 7365 6c65    like in evsele
+000206f0: 6374 5f73 7065 6374 7275 6d20 666f 7220  ct_spectrum for 
+00020700: 696e 7374 616e 6365 2e0a 2020 2020 2020  instance..      
+00020710: 2020 6966 2069 6e74 6572 6c6f 7065 725f    if interloper_
+00020720: 7265 6769 6f6e 7320 6973 204e 6f6e 6520  regions is None 
+00020730: 616e 6420 696e 6e65 725f 7261 6469 7573  and inner_radius
+00020740: 2e69 7373 6361 6c61 723a 0a20 2020 2020  .isscalar:.     
+00020750: 2020 2020 2020 2069 6e74 6572 6c6f 7065         interlope
+00020760: 725f 7265 6769 6f6e 7320 3d20 7365 6c66  r_regions = self
+00020770: 2e72 6567 696f 6e73 5f77 6974 6869 6e5f  .regions_within_
+00020780: 7261 6469 6928 696e 6e65 725f 7261 6469  radii(inner_radi
+00020790: 7573 2c20 6f75 7465 725f 7261 6469 7573  us, outer_radius
+000207a0: 2c20 6465 675f 6365 6e74 7261 6c5f 636f  , deg_central_co
+000207b0: 6f72 6429 0a20 2020 2020 2020 2065 6c69  ord).        eli
+000207c0: 6620 696e 7465 726c 6f70 6572 5f72 6567  f interloper_reg
+000207d0: 696f 6e73 2069 7320 4e6f 6e65 2061 6e64  ions is None and
+000207e0: 206e 6f74 2069 6e6e 6572 5f72 6164 6975   not inner_radiu
+000207f0: 732e 6973 7363 616c 6172 3a0a 2020 2020  s.isscalar:.    
+00020800: 2020 2020 2020 2020 696e 7465 726c 6f70          interlop
+00020810: 6572 5f72 6567 696f 6e73 203d 2073 656c  er_regions = sel
+00020820: 662e 7265 6769 6f6e 735f 7769 7468 696e  f.regions_within
+00020830: 5f72 6164 6969 286d 696e 2869 6e6e 6572  _radii(min(inner
+00020840: 5f72 6164 6975 7329 2c20 6d61 7828 6f75  _radius), max(ou
+00020850: 7465 725f 7261 6469 7573 292c 2064 6567  ter_radius), deg
+00020860: 5f63 656e 7472 616c 5f63 6f6f 7264 290a  _central_coord).
+00020870: 0a20 2020 2020 2020 2023 2053 6f20 6e6f  .        # So no
+00020880: 7720 7765 2063 6f6e 7665 7274 206f 7572  w we convert our
+00020890: 2069 6e74 6572 6c6f 7065 7220 7265 6769   interloper regi
+000208a0: 6f6e 7320 696e 746f 2074 6865 6972 2053  ons into their S
+000208b0: 4153 2065 7175 6976 616c 656e 7473 0a20  AS equivalents. 
+000208c0: 2020 2020 2020 2073 6173 5f69 6e74 6572         sas_inter
+000208d0: 6c6f 7065 7220 3d20 5b73 656c 662e 5f69  loper = [self._i
+000208e0: 6e74 6572 6c6f 7065 725f 7361 735f 7374  nterloper_sas_st
+000208f0: 7269 6e67 2869 2c20 7265 6c5f 696d 2c20  ring(i, rel_im, 
+00020900: 6f75 7470 7574 5f75 6e69 7429 2066 6f72  output_unit) for
+00020910: 2069 2069 6e20 696e 7465 726c 6f70 6572   i in interloper
+00020920: 5f72 6567 696f 6e73 5d0a 0a20 2020 2020  _regions]..     
+00020930: 2020 2069 6620 696e 6e65 725f 7261 6469     if inner_radi
+00020940: 7573 2e69 7373 6361 6c61 7220 616e 6420  us.isscalar and 
+00020950: 696e 6e65 725f 7261 6469 7573 2e76 616c  inner_radius.val
+00020960: 7565 2021 3d20 303a 0a20 2020 2020 2020  ue != 0:.       
+00020970: 2020 2020 2023 2041 6e64 2077 6520 6e65       # And we ne
+00020980: 6564 2074 6f20 6465 6669 6e65 2061 2053  ed to define a S
+00020990: 4153 2073 7472 696e 6720 666f 7220 7468  AS string for th
+000209a0: 6520 6163 7475 616c 2072 6567 696f 6e20  e actual region 
+000209b0: 6f66 2069 6e74 6572 6573 740a 2020 2020  of interest.    
+000209c0: 2020 2020 2020 2020 7361 735f 736f 7572          sas_sour
+000209d0: 6365 5f61 7265 6120 3d20 2228 287b 747d  ce_area = "(({t}
+000209e0: 2920 494e 2061 6e6e 756c 7573 287b 6378  ) IN annulus({cx
+000209f0: 7d2c 7b63 797d 2c7b 7269 7d2c 7b72 6f7d  },{cy},{ri},{ro}
+00020a00: 2929 220a 2020 2020 2020 2020 2020 2020  ))".            
+00020a10: 7361 735f 736f 7572 6365 5f61 7265 6120  sas_source_area 
+00020a20: 3d20 7361 735f 736f 7572 6365 5f61 7265  = sas_source_are
+00020a30: 612e 666f 726d 6174 2874 3d63 5f73 7472  a.format(t=c_str
+00020a40: 2c20 6378 3d78 6d6d 5f63 656e 7472 616c  , cx=xmm_central
+00020a50: 5f63 6f6f 7264 5b30 5d2e 726f 756e 6428  _coord[0].round(
+00020a60: 3429 2e76 616c 7565 2c0a 2020 2020 2020  4).value,.      
+00020a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00020aa0: 793d 786d 6d5f 6365 6e74 7261 6c5f 636f  y=xmm_central_co
+00020ab0: 6f72 645b 315d 2e72 6f75 6e64 2834 292e  ord[1].round(4).
+00020ac0: 7661 6c75 652c 0a20 2020 2020 2020 2020  value,.         
+00020ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020af0: 2020 2020 2020 2020 2020 2020 7269 3d28              ri=(
+00020b00: 696e 6e65 725f 7261 6469 7573 2e76 616c  inner_radius.val
+00020b10: 7565 2f73 6b79 5f74 6f5f 6465 6729 2e72  ue/sky_to_deg).r
+00020b20: 6f75 6e64 2834 292c 0a20 2020 2020 2020  ound(4),.       
+00020b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b50: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00020b60: 3d28 6f75 7465 725f 7261 6469 7573 2e76  =(outer_radius.v
+00020b70: 616c 7565 2f73 6b79 5f74 6f5f 6465 6729  alue/sky_to_deg)
+00020b80: 2e72 6f75 6e64 2834 2929 0a20 2020 2020  .round(4)).     
+00020b90: 2020 2023 2049 6620 7468 6520 696e 6e65     # If the inne
+00020ba0: 7220 7261 6469 7573 2069 7320 7a65 726f  r radius is zero
+00020bb0: 2074 6865 6e20 7765 2077 7269 7465 2061   then we write a
+00020bc0: 2063 6972 636c 6520 7265 6769 6f6e 2c20   circle region, 
+00020bd0: 6265 6361 7573 6520 6974 2073 6565 6d73  because it seems
+00020be0: 2074 6861 7427 7320 6120 4c4f 5420 6661   that's a LOT fa
+00020bf0: 7374 6572 2069 6e20 5341 530a 2020 2020  ster in SAS.    
+00020c00: 2020 2020 656c 6966 2069 6e6e 6572 5f72      elif inner_r
+00020c10: 6164 6975 732e 6973 7363 616c 6172 2061  adius.isscalar a
+00020c20: 6e64 2069 6e6e 6572 5f72 6164 6975 732e  nd inner_radius.
+00020c30: 7661 6c75 6520 3d3d 2030 3a0a 2020 2020  value == 0:.    
+00020c40: 2020 2020 2020 2020 7361 735f 736f 7572          sas_sour
+00020c50: 6365 5f61 7265 6120 3d20 2228 287b 747d  ce_area = "(({t}
+00020c60: 2920 494e 2063 6972 636c 6528 7b63 787d  ) IN circle({cx}
+00020c70: 2c7b 6379 7d2c 7b72 7d29 2922 0a20 2020  ,{cy},{r}))".   
+00020c80: 2020 2020 2020 2020 2073 6173 5f73 6f75           sas_sou
+00020c90: 7263 655f 6172 6561 203d 2073 6173 5f73  rce_area = sas_s
+00020ca0: 6f75 7263 655f 6172 6561 2e66 6f72 6d61  ource_area.forma
+00020cb0: 7428 743d 635f 7374 722c 2063 783d 786d  t(t=c_str, cx=xm
+00020cc0: 6d5f 6365 6e74 7261 6c5f 636f 6f72 645b  m_central_coord[
+00020cd0: 305d 2e72 6f75 6e64 2834 292e 7661 6c75  0].round(4).valu
+00020ce0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00020cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d10: 2020 2020 2020 2020 6379 3d78 6d6d 5f63          cy=xmm_c
+00020d20: 656e 7472 616c 5f63 6f6f 7264 5b31 5d2e  entral_coord[1].
+00020d30: 726f 756e 6428 3429 2e76 616c 7565 2c0a  round(4).value,.
+00020d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d70: 2020 2020 2072 3d28 6f75 7465 725f 7261       r=(outer_ra
+00020d80: 6469 7573 2e76 616c 7565 2f73 6b79 5f74  dius.value/sky_t
+00020d90: 6f5f 6465 6729 2e72 6f75 6e64 2834 2929  o_deg).round(4))
+00020da0: 0a20 2020 2020 2020 2065 6c69 6620 6e6f  .        elif no
+00020db0: 7420 696e 6e65 725f 7261 6469 7573 2e69  t inner_radius.i
+00020dc0: 7373 6361 6c61 7220 616e 6420 696e 6e65  sscalar and inne
+00020dd0: 725f 7261 6469 7573 5b30 5d2e 7661 6c75  r_radius[0].valu
+00020de0: 6520 213d 2030 3a0a 2020 2020 2020 2020  e != 0:.        
+00020df0: 2020 2020 7361 735f 736f 7572 6365 5f61      sas_source_a
+00020e00: 7265 6120 3d20 2228 287b 747d 2920 494e  rea = "(({t}) IN
+00020e10: 2065 6c6c 6970 7461 6e6e 756c 7573 287b   elliptannulus({
+00020e20: 6378 7d2c 7b63 797d 2c7b 7769 7d2c 7b68  cx},{cy},{wi},{h
+00020e30: 697d 2c7b 776f 7d2c 7b68 6f7d 2c7b 726f  i},{wo},{ho},{ro
+00020e40: 747d 2c7b 726f 747d 2929 220a 2020 2020  t},{rot}))".    
+00020e50: 2020 2020 2020 2020 7361 735f 736f 7572          sas_sour
+00020e60: 6365 5f61 7265 6120 3d20 7361 735f 736f  ce_area = sas_so
+00020e70: 7572 6365 5f61 7265 612e 666f 726d 6174  urce_area.format
+00020e80: 2874 3d63 5f73 7472 2c20 6378 3d78 6d6d  (t=c_str, cx=xmm
+00020e90: 5f63 656e 7472 616c 5f63 6f6f 7264 5b30  _central_coord[0
+00020ea0: 5d2e 726f 756e 6428 3429 2e76 616c 7565  ].round(4).value
+00020eb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00020ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ee0: 2020 2020 2020 2063 793d 786d 6d5f 6365         cy=xmm_ce
+00020ef0: 6e74 7261 6c5f 636f 6f72 645b 315d 2e72  ntral_coord[1].r
+00020f00: 6f75 6e64 2834 292e 7661 6c75 652c 0a20  ound(4).value,. 
 00020f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f20: 2020 2020 2020 2020 2077 6f3d 6f75 7465           wo=oute
-00020f30: 725f 7261 6469 7573 5b30 5d2e 7661 6c75  r_radius[0].valu
-00020f40: 652f 736b 795f 746f 5f64 6567 2c0a 2020  e/sky_to_deg,.  
-00020f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f80: 2020 2068 6f3d 6f75 7465 725f 7261 6469     ho=outer_radi
-00020f90: 7573 5b31 5d2e 7661 6c75 652f 736b 795f  us[1].value/sky_
-00020fa0: 746f 5f64 6567 2c20 726f 743d 726f 745f  to_deg, rot=rot_
-00020fb0: 616e 676c 652e 746f 2827 6465 6727 292e  angle.to('deg').
-00020fc0: 7661 6c75 6529 0a20 2020 2020 2020 2065  value).        e
-00020fd0: 6c69 6620 6e6f 7420 696e 6e65 725f 7261  lif not inner_ra
-00020fe0: 6469 7573 2e69 7373 6361 6c61 7220 616e  dius.isscalar an
-00020ff0: 6420 696e 6e65 725f 7261 6469 7573 5b30  d inner_radius[0
-00021000: 5d2e 7661 6c75 6520 3d3d 2030 3a0a 2020  ].value == 0:.  
-00021010: 2020 2020 2020 2020 2020 7361 735f 736f            sas_so
-00021020: 7572 6365 5f61 7265 6120 3d20 2228 287b  urce_area = "(({
-00021030: 747d 2920 494e 2065 6c6c 6970 7365 287b  t}) IN ellipse({
-00021040: 6378 7d2c 7b63 797d 2c7b 777d 2c7b 687d  cx},{cy},{w},{h}
-00021050: 2c7b 726f 747d 2929 220a 2020 2020 2020  ,{rot}))".      
-00021060: 2020 2020 2020 7361 735f 736f 7572 6365        sas_source
-00021070: 5f61 7265 6120 3d20 7361 735f 736f 7572  _area = sas_sour
-00021080: 6365 5f61 7265 612e 666f 726d 6174 2874  ce_area.format(t
-00021090: 3d63 5f73 7472 2c20 6378 3d78 6d6d 5f63  =c_str, cx=xmm_c
-000210a0: 656e 7472 616c 5f63 6f6f 7264 5b30 5d2e  entral_coord[0].
-000210b0: 7661 6c75 652c 0a20 2020 2020 2020 2020  value,.         
+00020f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f40: 2020 2020 7769 3d28 696e 6e65 725f 7261      wi=(inner_ra
+00020f50: 6469 7573 5b30 5d2e 7661 6c75 652f 736b  dius[0].value/sk
+00020f60: 795f 746f 5f64 6567 292e 726f 756e 6428  y_to_deg).round(
+00020f70: 3429 2c0a 2020 2020 2020 2020 2020 2020  4),.            
+00020f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fa0: 2020 2020 2020 2020 2068 693d 2869 6e6e           hi=(inn
+00020fb0: 6572 5f72 6164 6975 735b 315d 2e76 616c  er_radius[1].val
+00020fc0: 7565 2f73 6b79 5f74 6f5f 6465 6729 2e72  ue/sky_to_deg).r
+00020fd0: 6f75 6e64 2834 292c 0a20 2020 2020 2020  ound(4),.       
+00020fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021000: 2020 2020 2020 2020 2020 2020 2020 776f                wo
+00021010: 3d28 6f75 7465 725f 7261 6469 7573 5b30  =(outer_radius[0
+00021020: 5d2e 7661 6c75 652f 736b 795f 746f 5f64  ].value/sky_to_d
+00021030: 6567 292e 726f 756e 6428 3429 2c0a 2020  eg).round(4),.  
+00021040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021070: 2020 2068 6f3d 286f 7574 6572 5f72 6164     ho=(outer_rad
+00021080: 6975 735b 315d 2e76 616c 7565 2f73 6b79  ius[1].value/sky
+00021090: 5f74 6f5f 6465 6729 2e72 6f75 6e64 2834  _to_deg).round(4
+000210a0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+000210b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000210c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210e0: 2020 2020 2020 2020 2020 2020 6379 3d78              cy=x
-000210f0: 6d6d 5f63 656e 7472 616c 5f63 6f6f 7264  mm_central_coord
-00021100: 5b31 5d2e 7661 6c75 652c 0a20 2020 2020  [1].value,.     
-00021110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021140: 773d 6f75 7465 725f 7261 6469 7573 5b30  w=outer_radius[0
-00021150: 5d2e 7661 6c75 6520 2f20 736b 795f 746f  ].value / sky_to
-00021160: 5f64 6567 2c0a 2020 2020 2020 2020 2020  _deg,.          
-00021170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021190: 2020 2020 2020 2020 2020 2068 3d6f 7574             h=out
-000211a0: 6572 5f72 6164 6975 735b 315d 2e76 616c  er_radius[1].val
-000211b0: 7565 202f 2073 6b79 5f74 6f5f 6465 672c  ue / sky_to_deg,
-000211c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000211d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211f0: 2020 2020 2020 726f 743d 726f 745f 616e        rot=rot_an
-00021200: 676c 652e 746f 2827 6465 6727 292e 7661  gle.to('deg').va
-00021210: 6c75 6529 0a0a 2020 2020 2020 2020 2320  lue)..        # 
-00021220: 436f 6d62 696e 696e 6720 7468 6520 736f  Combining the so
-00021230: 7572 6365 2072 6567 696f 6e20 7769 7468  urce region with
-00021240: 2074 6865 2072 6567 696f 6e73 2077 6520   the regions we 
-00021250: 6e65 6564 2074 6f20 6375 7420 6f75 740a  need to cut out.
-00021260: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00021270: 6173 5f69 6e74 6572 6c6f 7065 7229 203d  as_interloper) =
-00021280: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00021290: 2066 696e 616c 5f73 7263 203d 2073 6173   final_src = sas
-000212a0: 5f73 6f75 7263 655f 6172 6561 0a20 2020  _source_area.   
-000212b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000212c0: 2020 2020 2020 2066 696e 616c 5f73 7263         final_src
-000212d0: 203d 2073 6173 5f73 6f75 7263 655f 6172   = sas_source_ar
-000212e0: 6561 202b 2022 2026 2621 2022 202b 2022  ea + " &&! " + "
-000212f0: 2026 2621 2022 2e6a 6f69 6e28 7361 735f   &&! ".join(sas_
-00021300: 696e 7465 726c 6f70 6572 290a 0a20 2020  interloper)..   
-00021310: 2020 2020 2072 6574 7572 6e20 6669 6e61       return fina
-00021320: 6c5f 7372 630a 0a20 2020 2040 7072 6f70  l_src..    @prop
-00021330: 6572 7479 0a20 2020 2064 6566 206e 4828  erty.    def nH(
-00021340: 7365 6c66 2920 2d3e 2051 7561 6e74 6974  self) -> Quantit
-00021350: 793a 0a20 2020 2020 2020 2022 2222 0a20  y:.        """. 
-00021360: 2020 2020 2020 2050 726f 7065 7274 7920         Property 
-00021370: 6765 7474 6572 2066 6f72 206e 6575 7472  getter for neutr
-00021380: 616c 2068 7964 726f 6765 6e20 636f 6c75  al hydrogen colu
-00021390: 6d6e 2061 7474 7269 6275 7465 2e0a 0a20  mn attribute... 
-000213a0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-000213b0: 4e65 7574 7261 6c20 6879 6472 6f67 656e  Neutral hydrogen
-000213c0: 2063 6f6c 756d 6e20 7375 7266 6163 6520   column surface 
-000213d0: 6465 6e73 6974 792e 0a20 2020 2020 2020  density..       
-000213e0: 203a 7274 7970 653a 2051 7561 6e74 6974   :rtype: Quantit
-000213f0: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
-00021400: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00021410: 662e 5f6e 480a 0a20 2020 2040 7072 6f70  f._nH..    @prop
-00021420: 6572 7479 0a20 2020 2064 6566 2072 6564  erty.    def red
-00021430: 7368 6966 7428 7365 6c66 2920 2d3e 2066  shift(self) -> f
-00021440: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
-00021450: 220a 2020 2020 2020 2020 5072 6f70 6572  ".        Proper
-00021460: 7479 2067 6574 7465 7220 666f 7220 7468  ty getter for th
-00021470: 6520 7265 6473 6869 6674 206f 6620 7468  e redshift of th
-00021480: 6973 2073 6f75 7263 6520 6f62 6a65 6374  is source object
-00021490: 2e0a 0a20 2020 2020 2020 203a 7265 7475  ...        :retu
-000214a0: 726e 3a20 5265 6473 6869 6674 2076 616c  rn: Redshift val
-000214b0: 7565 0a20 2020 2020 2020 203a 7274 7970  ue.        :rtyp
-000214c0: 653a 2066 6c6f 6174 0a20 2020 2020 2020  e: float.       
-000214d0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-000214e0: 7572 6e20 7365 6c66 2e5f 7265 6473 6869  urn self._redshi
-000214f0: 6674 0a0a 2020 2020 4070 726f 7065 7274  ft..    @propert
-00021500: 790a 2020 2020 6465 6620 6f6e 5f61 7869  y.    def on_axi
-00021510: 735f 6f62 735f 6964 7328 7365 6c66 2920  s_obs_ids(self) 
-00021520: 2d3e 206c 6973 743a 0a20 2020 2020 2020  -> list:.       
-00021530: 2022 2222 0a20 2020 2020 2020 2054 6869   """.        Thi
-00021540: 7320 6d65 7468 6f64 2072 6574 7572 6e73  s method returns
-00021550: 2061 6e20 6172 7261 7920 6f66 204f 6273   an array of Obs
-00021560: 4944 7320 7468 6174 2074 6869 7320 736f  IDs that this so
-00021570: 7572 6365 2069 7320 6170 7072 6f78 696d  urce is approxim
-00021580: 6174 656c 7920 6f6e 2061 7869 7320 696e  ately on axis in
-00021590: 2e0a 0a20 2020 2020 2020 203a 7265 7475  ...        :retu
-000215a0: 726e 3a20 4f62 7349 4473 2066 6f72 2077  rn: ObsIDs for w
-000215b0: 6869 6368 2074 6865 2073 6f75 7263 6520  hich the source 
-000215c0: 6973 2061 7070 726f 7869 6d61 7465 6c79  is approximately
-000215d0: 206f 6e20 6178 6973 2e0a 2020 2020 2020   on axis..      
-000215e0: 2020 3a72 7479 7065 3a20 6c69 7374 0a20    :rtype: list. 
-000215f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00021600: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00021610: 6f6e 6178 6973 0a0a 2020 2020 4070 726f  onaxis..    @pro
-00021620: 7065 7274 790a 2020 2020 6465 6620 636f  perty.    def co
-00021630: 736d 6f28 7365 6c66 2920 2d3e 2043 6f73  smo(self) -> Cos
-00021640: 6d6f 6c6f 6779 3a0a 2020 2020 2020 2020  mology:.        
-00021650: 2222 220a 2020 2020 2020 2020 5468 6973  """.        This
-00021660: 206d 6574 686f 6420 7265 7475 726e 7320   method returns 
-00021670: 7768 6174 6576 6572 2063 6f73 6d6f 6c6f  whatever cosmolo
-00021680: 6779 206f 626a 6563 7420 6973 2061 7373  gy object is ass
-00021690: 6f63 6961 7465 6420 7769 7468 2074 6869  ociated with thi
-000216a0: 7320 736f 7572 6365 206f 626a 6563 742e  s source object.
-000216b0: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-000216c0: 6e3a 2041 6e20 6173 7472 6f70 7920 636f  n: An astropy co
-000216d0: 736d 6f6c 6f67 7920 6f62 6a65 6374 2073  smology object s
-000216e0: 7065 6369 6669 6564 2066 6f72 2074 6869  pecified for thi
-000216f0: 7320 736f 7572 6365 206f 6e20 696e 6974  s source on init
-00021700: 6961 6c69 7a61 7469 6f6e 2e0a 2020 2020  ialization..    
-00021710: 2020 2020 3a72 7479 7065 3a20 436f 736d      :rtype: Cosm
-00021720: 6f6c 6f67 790a 2020 2020 2020 2020 2222  ology.        ""
-00021730: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00021740: 2073 656c 662e 5f63 6f73 6d6f 0a0a 2020   self._cosmo..  
-00021750: 2020 2320 5468 6973 2069 7320 7573 6564    # This is used
-00021760: 2074 6f20 6e61 6d65 2066 696c 6573 2061   to name files a
-00021770: 6e64 2064 6972 6563 746f 7269 6573 2073  nd directories s
-00021780: 6f20 7468 6973 2069 7320 6e6f 7420 616c  o this is not al
-00021790: 6c6f 7765 6420 746f 2063 6861 6e67 652e  lowed to change.
-000217a0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-000217b0: 2020 2064 6566 206e 616d 6528 7365 6c66     def name(self
-000217c0: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
-000217d0: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
-000217e0: 6520 6e61 6d65 206f 6620 7468 6520 736f  e name of the so
-000217f0: 7572 6365 2c20 6569 7468 6572 2067 6976  urce, either giv
-00021800: 656e 2061 7420 696e 6974 6961 6c69 7361  en at initialisa
-00021810: 7469 6f6e 206f 7220 6765 6e65 7261 7465  tion or generate
-00021820: 6420 6672 6f6d 2074 6865 2075 7365 722d  d from the user-
-00021830: 7375 7070 6c69 6564 2063 6f6f 7264 696e  supplied coordin
-00021840: 6174 6573 2e0a 0a20 2020 2020 2020 203a  ates...        :
-00021850: 7265 7475 726e 3a20 5468 6520 6e61 6d65  return: The name
-00021860: 206f 6620 7468 6520 736f 7572 6365 2e0a   of the source..
-00021870: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-00021880: 7374 720a 2020 2020 2020 2020 2222 220a  str.        """.
-00021890: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000218a0: 656c 662e 5f6e 616d 650a 0a20 2020 2064  elf._name..    d
-000218b0: 6566 2061 6464 5f66 6974 5f64 6174 6128  ef add_fit_data(
-000218c0: 7365 6c66 2c20 6d6f 6465 6c3a 2073 7472  self, model: str
-000218d0: 2c20 7461 625f 6c69 6e65 2c20 6c75 6d73  , tab_line, lums
-000218e0: 3a20 6469 6374 2c20 7370 6563 5f73 746f  : dict, spec_sto
-000218f0: 7261 6765 5f6b 6579 3a20 7374 7229 3a0a  rage_key: str):.
-00021900: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00021910: 2020 2020 4120 6d65 7468 6f64 2074 6861      A method tha
-00021920: 7420 7374 6f72 6573 2066 6974 2072 6573  t stores fit res
-00021930: 756c 7473 2061 6e64 2067 6c6f 6261 6c20  ults and global 
-00021940: 696e 666f 726d 6174 696f 6e20 6162 6f75  information abou
-00021950: 7420 6120 7468 6520 7365 7420 6f66 2073  t a the set of s
-00021960: 7065 6374 7261 2069 6e20 6120 736f 7572  pectra in a sour
-00021970: 6365 206f 626a 6563 742e 0a20 2020 2020  ce object..     
-00021980: 2020 2041 6e79 2076 6172 6961 626c 6520     Any variable 
-00021990: 7061 7261 6d65 7465 7273 2069 6e20 7468  parameters in th
-000219a0: 6520 6669 7420 6172 6520 7374 6f72 6564  e fit are stored
-000219b0: 2069 6e20 616e 2069 6e74 6572 6e61 6c20   in an internal 
-000219c0: 6469 6374 696f 6e61 7279 2073 7472 7563  dictionary struc
-000219d0: 7475 7265 2c20 6173 2061 7265 2061 6e79  ture, as are any
-000219e0: 206c 756d 696e 6f73 6974 6965 730a 2020   luminosities.  
-000219f0: 2020 2020 2020 6361 6c63 756c 6174 6564        calculated
-00021a00: 2e20 4f74 6865 7220 7061 7261 6d65 7465  . Other paramete
-00021a10: 7273 206f 6620 696e 7465 7265 7374 2061  rs of interest a
-00021a20: 7265 2073 746f 7265 2069 6e20 6f74 6865  re store in othe
-00021a30: 7220 696e 7465 726e 616c 2061 7474 7269  r internal attri
-00021a40: 6275 7465 732e 2054 6869 7320 7072 6f62  butes. This prob
-00021a50: 6162 6c79 2073 686f 756c 646e 2774 0a20  ably shouldn't. 
-00021a60: 2020 2020 2020 2065 7665 7220 6265 2075         ever be u
-00021a70: 7365 6420 6279 2074 6865 2075 7365 722c  sed by the user,
-00021a80: 206a 7573 7420 6f74 6865 7220 7061 7274   just other part
-00021a90: 7320 6f66 2058 4741 2c20 6865 6e63 6520  s of XGA, hence 
-00021aa0: 7768 7920 4927 7665 2061 736b 6564 2066  why I've asked f
-00021ab0: 6f72 2061 2073 7065 635f 7374 6f72 6167  or a spec_storag
-00021ac0: 655f 6b65 7920 746f 2062 6520 7061 7373  e_key to be pass
-00021ad0: 6564 0a20 2020 2020 2020 2069 6e20 7261  ed.        in ra
-00021ae0: 7468 6572 2074 6861 6e20 616c 6c20 7468  ther than all th
-00021af0: 6520 7370 6563 7472 756d 2063 6f6e 6669  e spectrum confi
-00021b00: 6775 7261 7469 6f6e 206f 7074 696f 6e73  guration options
-00021b10: 2069 6e64 6976 6964 7561 6c6c 792e 0a0a   individually...
-00021b20: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-00021b30: 7472 206d 6f64 656c 3a20 5468 6520 5853  tr model: The XS
-00021b40: 5045 4320 6465 6669 6e69 7469 6f6e 206f  PEC definition o
-00021b50: 6620 7468 6520 6d6f 6465 6c20 7573 6564  f the model used
-00021b60: 2074 6f20 7065 7266 6f72 6d20 7468 6520   to perform the 
-00021b70: 6669 742e 2065 2e67 2e20 636f 6e73 7461  fit. e.g. consta
-00021b80: 6e74 2a74 6261 6273 2a61 7065 630a 2020  nt*tbabs*apec.  
-00021b90: 2020 2020 2020 3a70 6172 616d 2074 6162        :param tab
-00021ba0: 5f6c 696e 653a 2054 6865 2074 6162 6c65  _line: The table
-00021bb0: 206c 696e 6520 7769 7468 2074 6865 2066   line with the f
-00021bc0: 6974 2064 6174 612e 0a20 2020 2020 2020  it data..       
-00021bd0: 203a 7061 7261 6d20 6469 6374 206c 756d   :param dict lum
-00021be0: 733a 2054 6865 2076 6172 696f 7573 206c  s: The various l
-00021bf0: 756d 696e 6f73 6974 6965 7320 6d65 6173  uminosities meas
-00021c00: 7572 6564 2064 7572 696e 6720 7468 6520  ured during the 
-00021c10: 6669 742e 0a20 2020 2020 2020 203a 7061  fit..        :pa
-00021c20: 7261 6d20 7374 7220 7370 6563 5f73 746f  ram str spec_sto
-00021c30: 7261 6765 5f6b 6579 3a20 5468 6520 7374  rage_key: The st
-00021c40: 6f72 6167 6520 6b65 7920 6f66 2061 6e79  orage key of any
-00021c50: 2073 7065 6374 7275 6d20 7468 6174 2077   spectrum that w
-00021c60: 6173 2075 7365 6420 696e 2074 6869 7320  as used in this 
-00021c70: 7061 7274 6963 756c 6172 2066 6974 2e20  particular fit. 
-00021c80: 5468 650a 2020 2020 2020 2020 2020 2020  The.            
-00021c90: 4f62 7349 4420 616e 6420 696e 7374 7275  ObsID and instru
-00021ca0: 6d65 6e74 2075 7365 6420 646f 6e27 7420  ment used don't 
-00021cb0: 6d61 7474 6572 2c20 6173 2074 6865 2073  matter, as the s
-00021cc0: 746f 7261 6765 206b 6579 2077 696c 6c20  torage key will 
-00021cd0: 6265 2074 6865 2073 616d 6520 616e 6420  be the same and 
-00021ce0: 6973 2062 6173 6564 206f 6666 206f 6620  is based off of 
-00021cf0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-00021d00: 7365 7474 696e 6773 2077 6865 6e20 7468  settings when th
-00021d10: 6520 7370 6563 7472 6120 7765 7265 2067  e spectra were g
-00021d20: 656e 6572 6174 6564 2e0a 2020 2020 2020  enerated..      
-00021d30: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-00021d40: 4a75 7374 2068 6561 6465 7273 2074 6861  Just headers tha
-00021d50: 7420 7769 6c6c 2061 6c77 6179 7320 6265  t will always be
-00021d60: 2070 7265 7365 6e74 2069 6e20 7461 625f   present in tab_
-00021d70: 6c69 6e65 2074 6861 7420 6172 6520 6e6f  line that are no
-00021d80: 7420 6669 7420 7061 7261 6d65 7465 7273  t fit parameters
-00021d90: 0a20 2020 2020 2020 206e 6f74 5f70 6172  .        not_par
-00021da0: 203d 205b 274d 4f44 454c 272c 2027 544f   = ['MODEL', 'TO
-00021db0: 5441 4c5f 4558 504f 5355 5245 272c 2027  TAL_EXPOSURE', '
-00021dc0: 544f 5441 4c5f 434f 554e 545f 5241 5445  TOTAL_COUNT_RATE
-00021dd0: 272c 2027 544f 5441 4c5f 434f 554e 545f  ', 'TOTAL_COUNT_
-00021de0: 5241 5445 5f45 5252 272c 0a20 2020 2020  RATE_ERR',.     
-00021df0: 2020 2020 2020 2020 2020 2020 2020 274e                'N
-00021e00: 554d 5f55 4e4c 494e 4b45 445f 5448 4157  UM_UNLINKED_THAW
-00021e10: 4544 5f56 4152 5327 2c20 2746 4954 5f53  ED_VARS', 'FIT_S
-00021e20: 5441 5449 5354 4943 272c 2027 5445 5354  TATISTIC', 'TEST
-00021e30: 5f53 5441 5449 5354 4943 272c 2027 444f  _STATISTIC', 'DO
-00021e40: 4627 5d0a 0a20 2020 2020 2020 2023 2056  F']..        # V
-00021e50: 6172 696f 7573 2067 6c6f 6261 6c20 7661  arious global va
-00021e60: 6c75 6573 206f 6620 696e 7465 7265 7374  lues of interest
-00021e70: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
-00021e80: 6f74 616c 5f65 7870 5b73 7065 635f 7374  otal_exp[spec_st
-00021e90: 6f72 6167 655f 6b65 795d 203d 2066 6c6f  orage_key] = flo
-00021ea0: 6174 2874 6162 5f6c 696e 655b 2254 4f54  at(tab_line["TOT
-00021eb0: 414c 5f45 5850 4f53 5552 4522 5d29 0a20  AL_EXPOSURE"]). 
-00021ec0: 2020 2020 2020 2069 6620 7370 6563 5f73         if spec_s
-00021ed0: 746f 7261 6765 5f6b 6579 206e 6f74 2069  torage_key not i
-00021ee0: 6e20 7365 6c66 2e5f 746f 7461 6c5f 636f  n self._total_co
-00021ef0: 756e 745f 7261 7465 3a0a 2020 2020 2020  unt_rate:.      
-00021f00: 2020 2020 2020 7365 6c66 2e5f 746f 7461        self._tota
-00021f10: 6c5f 636f 756e 745f 7261 7465 5b73 7065  l_count_rate[spe
-00021f20: 635f 7374 6f72 6167 655f 6b65 795d 203d  c_storage_key] =
-00021f30: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-00021f40: 7365 6c66 2e5f 7465 7374 5f73 7461 745b  self._test_stat[
-00021f50: 7370 6563 5f73 746f 7261 6765 5f6b 6579  spec_storage_key
-00021f60: 5d20 3d20 7b7d 0a20 2020 2020 2020 2020  ] = {}.         
-00021f70: 2020 2073 656c 662e 5f64 6f66 5b73 7065     self._dof[spe
-00021f80: 635f 7374 6f72 6167 655f 6b65 795d 203d  c_storage_key] =
-00021f90: 207b 7d0a 2020 2020 2020 2020 7365 6c66   {}.        self
-00021fa0: 2e5f 746f 7461 6c5f 636f 756e 745f 7261  ._total_count_ra
-00021fb0: 7465 5b73 7065 635f 7374 6f72 6167 655f  te[spec_storage_
-00021fc0: 6b65 795d 5b6d 6f64 656c 5d20 3d20 5b66  key][model] = [f
-00021fd0: 6c6f 6174 2874 6162 5f6c 696e 655b 2254  loat(tab_line["T
-00021fe0: 4f54 414c 5f43 4f55 4e54 5f52 4154 4522  OTAL_COUNT_RATE"
-00021ff0: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
-00022000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022020: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00022030: 6c6f 6174 2874 6162 5f6c 696e 655b 2254  loat(tab_line["T
-00022040: 4f54 414c 5f43 4f55 4e54 5f52 4154 455f  OTAL_COUNT_RATE_
-00022050: 4552 5222 5d29 5d0a 2020 2020 2020 2020  ERR"])].        
-00022060: 7365 6c66 2e5f 7465 7374 5f73 7461 745b  self._test_stat[
-00022070: 7370 6563 5f73 746f 7261 6765 5f6b 6579  spec_storage_key
-00022080: 5d5b 6d6f 6465 6c5d 203d 2066 6c6f 6174  ][model] = float
-00022090: 2874 6162 5f6c 696e 655b 2254 4553 545f  (tab_line["TEST_
-000220a0: 5354 4154 4953 5449 4322 5d29 0a20 2020  STATISTIC"]).   
-000220b0: 2020 2020 2073 656c 662e 5f64 6f66 5b73       self._dof[s
-000220c0: 7065 635f 7374 6f72 6167 655f 6b65 795d  pec_storage_key]
-000220d0: 5b6d 6f64 656c 5d20 3d20 666c 6f61 7428  [model] = float(
-000220e0: 7461 625f 6c69 6e65 5b22 444f 4622 5d29  tab_line["DOF"])
-000220f0: 0a0a 2020 2020 2020 2020 2320 5468 6520  ..        # The 
-00022100: 7061 7261 6d65 7465 7273 2061 7661 696c  parameters avail
-00022110: 6162 6c65 2077 696c 6c20 6f62 7669 6f75  able will obviou
-00022120: 736c 7920 6265 2064 796e 616d 6963 2c20  sly be dynamic, 
-00022130: 736f 2068 6176 6520 746f 2066 696e 6420  so have to find 
-00022140: 6f75 7420 7768 6174 2074 6865 7920 6172  out what they ar
-00022150: 6520 616e 6420 7468 656e 0a20 2020 2020  e and then.     
-00022160: 2020 2023 2020 7468 656e 2066 6f72 2065     #  then for e
-00022170: 6163 6820 7265 7375 6c74 2066 696e 6420  ach result find 
-00022180: 7468 6520 2b2d 2065 7272 6f72 730a 2020  the +- errors.  
-00022190: 2020 2020 2020 7061 725f 6865 6164 6572        par_header
-000221a0: 7320 3d20 5b6e 2066 6f72 206e 2069 6e20  s = [n for n in 
-000221b0: 7461 625f 6c69 6e65 2e64 7479 7065 2e6e  tab_line.dtype.n
-000221c0: 616d 6573 2069 6620 6e20 6e6f 7420 696e  ames if n not in
-000221d0: 206e 6f74 5f70 6172 5d0a 2020 2020 2020   not_par].      
-000221e0: 2020 6d6f 645f 7265 7320 3d20 7b7d 0a20    mod_res = {}. 
-000221f0: 2020 2020 2020 2066 6f72 2070 6172 2069         for par i
-00022200: 6e20 7061 725f 6865 6164 6572 733a 0a20  n par_headers:. 
-00022210: 2020 2020 2020 2020 2020 2023 2054 6865             # The
-00022220: 2070 6172 616d 6574 6572 206e 616d 6520   parameter name 
-00022230: 616e 6420 7468 6520 7061 7261 6d65 7465  and the paramete
-00022240: 7220 696e 6465 7820 7573 6564 2062 7920  r index used by 
-00022250: 5853 5045 4320 6172 6520 7365 7061 7261  XSPEC are separa
-00022260: 7465 6420 6279 207c 0a20 2020 2020 2020  ted by |.       
-00022270: 2020 2020 2070 6172 5f69 6e66 6f20 3d20       par_info = 
-00022280: 7061 722e 7370 6c69 7428 227c 2229 0a20  par.split("|"). 
-00022290: 2020 2020 2020 2020 2020 2070 6172 5f6e             par_n
-000222a0: 616d 6520 3d20 7061 725f 696e 666f 5b30  ame = par_info[0
-000222b0: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
-000222c0: 2054 6865 2070 6172 616d 6574 6572 2069   The parameter i
-000222d0: 6e64 6578 2063 616e 2061 6c73 6f20 6861  ndex can also ha
-000222e0: 7665 2061 6e20 2d20 6f72 202b 2061 6674  ve an - or + aft
-000222f0: 6572 2069 7420 6966 2074 6865 2065 6e74  er it if the ent
-00022300: 7279 2069 6e20 7175 6573 7469 6f6e 2069  ry in question i
-00022310: 7320 616e 2075 6e63 6572 7461 696e 7479  s an uncertainty
-00022320: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00022330: 7061 725f 696e 666f 5b31 5d5b 2d31 5d20  par_info[1][-1] 
-00022340: 3d3d 2022 2d22 3a0a 2020 2020 2020 2020  == "-":.        
-00022350: 2020 2020 2020 2020 6964 656e 7420 3d20          ident = 
-00022360: 7061 725f 696e 666f 5b31 5d5b 3a2d 315d  par_info[1][:-1]
-00022370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022380: 2070 6f73 203d 2031 0a20 2020 2020 2020   pos = 1.       
-00022390: 2020 2020 2065 6c69 6620 7061 725f 696e       elif par_in
-000223a0: 666f 5b31 5d5b 2d31 5d20 3d3d 2022 2b22  fo[1][-1] == "+"
-000223b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000223c0: 2020 6964 656e 7420 3d20 7061 725f 696e    ident = par_in
-000223d0: 666f 5b31 5d5b 3a2d 315d 0a20 2020 2020  fo[1][:-1].     
-000223e0: 2020 2020 2020 2020 2020 2070 6f73 203d             pos =
-000223f0: 2032 0a20 2020 2020 2020 2020 2020 2065   2.            e
-00022400: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00022410: 2020 2020 2069 6465 6e74 203d 2070 6172       ident = par
-00022420: 5f69 6e66 6f5b 315d 0a20 2020 2020 2020  _info[1].       
-00022430: 2020 2020 2020 2020 2070 6f73 203d 2030           pos = 0
-00022440: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00022450: 5365 7473 2075 7020 7468 6520 6469 6374  Sets up the dict
-00022460: 696f 6e61 7279 2073 7472 7563 7475 7265  ionary structure
-00022470: 2066 6f72 2074 6865 2072 6573 756c 7473   for the results
-00022480: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00022490: 7061 725f 6e61 6d65 206e 6f74 2069 6e20  par_name not in 
-000224a0: 6d6f 645f 7265 733a 0a20 2020 2020 2020  mod_res:.       
-000224b0: 2020 2020 2020 2020 206d 6f64 5f72 6573           mod_res
-000224c0: 5b70 6172 5f6e 616d 655d 203d 207b 6964  [par_name] = {id
-000224d0: 656e 743a 205b 302c 2030 2c20 305d 7d0a  ent: [0, 0, 0]}.
-000224e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000224f0: 2069 6465 6e74 206e 6f74 2069 6e20 6d6f   ident not in mo
-00022500: 645f 7265 735b 7061 725f 6e61 6d65 5d3a  d_res[par_name]:
-00022510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022520: 206d 6f64 5f72 6573 5b70 6172 5f6e 616d   mod_res[par_nam
-00022530: 655d 5b69 6465 6e74 5d20 3d20 5b30 2c20  e][ident] = [0, 
-00022540: 302c 2030 5d0a 0a20 2020 2020 2020 2020  0, 0]..         
-00022550: 2020 206d 6f64 5f72 6573 5b70 6172 5f6e     mod_res[par_n
-00022560: 616d 655d 5b69 6465 6e74 5d5b 706f 735d  ame][ident][pos]
-00022570: 203d 2066 6c6f 6174 2874 6162 5f6c 696e   = float(tab_lin
-00022580: 655b 7061 725d 290a 0a20 2020 2020 2020  e[par])..       
-00022590: 2023 2053 746f 7269 6e67 2074 6865 2066   # Storing the f
-000225a0: 6974 2072 6573 756c 7473 0a20 2020 2020  it results.     
-000225b0: 2020 2069 6620 7370 6563 5f73 746f 7261     if spec_stora
-000225c0: 6765 5f6b 6579 206e 6f74 2069 6e20 7365  ge_key not in se
-000225d0: 6c66 2e5f 6669 745f 7265 7375 6c74 733a  lf._fit_results:
-000225e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000225f0: 662e 5f66 6974 5f72 6573 756c 7473 5b73  f._fit_results[s
-00022600: 7065 635f 7374 6f72 6167 655f 6b65 795d  pec_storage_key]
-00022610: 203d 207b 7d0a 2020 2020 2020 2020 7365   = {}.        se
-00022620: 6c66 2e5f 6669 745f 7265 7375 6c74 735b  lf._fit_results[
-00022630: 7370 6563 5f73 746f 7261 6765 5f6b 6579  spec_storage_key
-00022640: 5d5b 6d6f 6465 6c5d 203d 206d 6f64 5f72  ][model] = mod_r
-00022650: 6573 0a0a 2020 2020 2020 2020 2320 416e  es..        # An
-00022660: 6420 6e6f 7720 7374 6f72 696e 6720 7468  d now storing th
-00022670: 6520 6c75 6d69 6e6f 7369 7479 2072 6573  e luminosity res
-00022680: 756c 7473 0a20 2020 2020 2020 2069 6620  ults.        if 
-00022690: 7370 6563 5f73 746f 7261 6765 5f6b 6579  spec_storage_key
-000226a0: 206e 6f74 2069 6e20 7365 6c66 2e5f 6c75   not in self._lu
-000226b0: 6d69 6e6f 7369 7469 6573 3a0a 2020 2020  minosities:.    
-000226c0: 2020 2020 2020 2020 7365 6c66 2e5f 6c75          self._lu
-000226d0: 6d69 6e6f 7369 7469 6573 5b73 7065 635f  minosities[spec_
-000226e0: 7374 6f72 6167 655f 6b65 795d 203d 207b  storage_key] = {
-000226f0: 7d0a 2020 2020 2020 2020 7365 6c66 2e5f  }.        self._
-00022700: 6c75 6d69 6e6f 7369 7469 6573 5b73 7065  luminosities[spe
-00022710: 635f 7374 6f72 6167 655f 6b65 795d 5b6d  c_storage_key][m
-00022720: 6f64 656c 5d20 3d20 6c75 6d73 0a0a 2020  odel] = lums..  
-00022730: 2020 6465 6620 6765 745f 7265 7375 6c74    def get_result
-00022740: 7328 7365 6c66 2c20 6f75 7465 725f 7261  s(self, outer_ra
-00022750: 6469 7573 3a20 556e 696f 6e5b 7374 722c  dius: Union[str,
-00022760: 2051 7561 6e74 6974 795d 2c20 6d6f 6465   Quantity], mode
-00022770: 6c3a 2073 7472 2c0a 2020 2020 2020 2020  l: str,.        
-00022780: 2020 2020 2020 2020 2020 2020 696e 6e65              inne
-00022790: 725f 7261 6469 7573 3a20 556e 696f 6e5b  r_radius: Union[
-000227a0: 7374 722c 2051 7561 6e74 6974 795d 203d  str, Quantity] =
-000227b0: 2051 7561 6e74 6974 7928 302c 2027 6172   Quantity(0, 'ar
-000227c0: 6373 6563 2729 2c20 7061 723a 2073 7472  csec'), par: str
-000227d0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-000227e0: 2020 2020 2020 2020 2020 2020 2067 726f               gro
-000227f0: 7570 5f73 7065 633a 2062 6f6f 6c20 3d20  up_spec: bool = 
-00022800: 5472 7565 2c20 6d69 6e5f 636f 756e 7473  True, min_counts
-00022810: 3a20 696e 7420 3d20 352c 206d 696e 5f73  : int = 5, min_s
-00022820: 6e3a 2066 6c6f 6174 203d 204e 6f6e 652c  n: float = None,
-00022830: 206f 7665 725f 7361 6d70 6c65 3a20 666c   over_sample: fl
-00022840: 6f61 7420 3d20 4e6f 6e65 293a 0a20 2020  oat = None):.   
-00022850: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00022860: 2049 6d70 6f72 7461 6e74 206d 6574 686f   Important metho
-00022870: 6420 7468 6174 2077 696c 6c20 7265 7472  d that will retr
-00022880: 6965 7665 2066 6974 2072 6573 756c 7473  ieve fit results
-00022890: 2066 726f 6d20 7468 6520 736f 7572 6365   from the source
-000228a0: 206f 626a 6563 742e 2045 6974 6865 7220   object. Either 
-000228b0: 666f 7220 6120 7370 6563 6966 6963 0a20  for a specific. 
-000228c0: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
-000228d0: 206f 6620 6120 6769 7665 6e20 7265 6769   of a given regi
-000228e0: 6f6e 2d6d 6f64 656c 2063 6f6d 6269 6e61  on-model combina
-000228f0: 7469 6f6e 2c20 6f72 2066 6f72 2061 6c6c  tion, or for all
-00022900: 206f 6620 7468 656d 2e20 4966 2061 2073   of them. If a s
-00022910: 7065 6369 6669 6320 7061 7261 6d65 7465  pecific paramete
-00022920: 7220 6973 2072 6571 7565 7374 6564 2c0a  r is requested,.
-00022930: 2020 2020 2020 2020 616c 6c20 6d61 7463          all matc
-00022940: 6869 6e67 2076 616c 7565 7320 6672 6f6d  hing values from
-00022950: 2074 6865 2066 6974 2077 696c 6c20 6265   the fit will be
-00022960: 2072 6574 7572 6e65 6420 696e 2061 6e20   returned in an 
-00022970: 4e20 726f 772c 2033 2063 6f6c 756d 6e20  N row, 3 column 
-00022980: 6e75 6d70 7920 6172 7261 7920 2863 6f6c  numpy array (col
-00022990: 756d 6e20 3020 6973 2074 6865 2076 616c  umn 0 is the val
-000229a0: 7565 2c0a 2020 2020 2020 2020 636f 6c75  ue,.        colu
-000229b0: 6d6e 2031 2069 7320 6572 722d 2c20 616e  mn 1 is err-, an
-000229c0: 6420 636f 6c75 6d6e 2032 2069 7320 6572  d column 2 is er
-000229d0: 722b 292e 2049 6620 6e6f 2070 6172 616d  r+). If no param
-000229e0: 6574 6572 2069 7320 7370 6563 6966 6965  eter is specifie
-000229f0: 642c 2074 6865 2072 6574 7572 6e20 7769  d, the return wi
-00022a00: 6c6c 2062 6520 6120 6469 6374 696f 6e61  ll be a dictiona
-00022a10: 7279 0a20 2020 2020 2020 206f 6620 7375  ry.        of su
-00022a20: 6368 206e 756d 7079 2061 7272 6179 732c  ch numpy arrays,
-00022a30: 2077 6974 6820 7468 6520 6b65 7973 2063   with the keys c
-00022a40: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
-00022a50: 7061 7261 6d65 7465 7220 6e61 6d65 732e  parameter names.
-00022a60: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00022a70: 2073 7472 2f51 7561 6e74 6974 7920 6f75   str/Quantity ou
-00022a80: 7465 725f 7261 6469 7573 3a20 5468 6520  ter_radius: The 
-00022a90: 6e61 6d65 206f 7220 7661 6c75 6520 6f66  name or value of
-00022aa0: 2074 6865 206f 7574 6572 2072 6164 6975   the outer radiu
-00022ab0: 7320 7468 6174 2077 6173 2075 7365 6420  s that was used 
-00022ac0: 666f 7220 7468 6520 6765 6e65 7261 7469  for the generati
-00022ad0: 6f6e 206f 660a 2020 2020 2020 2020 2020  on of.          
-00022ae0: 2020 7468 6520 7370 6563 7472 6120 7768    the spectra wh
-00022af0: 6963 6820 7765 7265 2066 6974 7465 6420  ich were fitted 
-00022b00: 746f 2070 726f 6475 6365 2074 6865 2064  to produce the d
-00022b10: 6573 6972 6564 2072 6573 756c 7420 2866  esired result (f
-00022b20: 6f72 2069 6e73 7461 6e63 6520 2772 3230  or instance 'r20
-00022b30: 3027 2077 6f75 6c64 2062 6520 6163 6365  0' would be acce
-00022b40: 7074 6162 6c65 0a20 2020 2020 2020 2020  ptable.         
-00022b50: 2020 2066 6f72 2061 2047 616c 6178 7943     for a GalaxyC
-00022b60: 6c75 7374 6572 2c20 6f72 2051 7561 6e74  luster, or Quant
-00022b70: 6974 7928 3130 3030 2c20 276b 7063 2729  ity(1000, 'kpc')
-00022b80: 292e 2049 6620 2772 6567 696f 6e27 2069  ). If 'region' i
-00022b90: 7320 6368 6f73 656e 2028 746f 2075 7365  s chosen (to use
-00022ba0: 2074 6865 2072 6567 696f 6e73 2069 6e0a   the regions in.
-00022bb0: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-00022bc0: 6f6e 2066 696c 6573 292c 2074 6865 6e20  on files), then 
-00022bd0: 616e 7920 696e 6e65 7220 7261 6469 7573  any inner radius
-00022be0: 2077 696c 6c20 6265 2069 676e 6f72 6564   will be ignored
-00022bf0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00022c00: 2073 7472 206d 6f64 656c 3a20 5468 6520   str model: The 
-00022c10: 6e61 6d65 206f 6620 7468 6520 6669 7474  name of the fitt
-00022c20: 6564 206d 6f64 656c 2074 6861 7420 796f  ed model that yo
-00022c30: 7527 7265 2072 6571 7565 7374 696e 6720  u're requesting 
-00022c40: 7468 6520 7265 7375 6c74 730a 2020 2020  the results.    
-00022c50: 2020 2020 2020 2020 6672 6f6d 2028 652e          from (e.
-00022c60: 672e 2063 6f6e 7374 616e 742a 7462 6162  g. constant*tbab
-00022c70: 732a 6170 6563 292e 0a20 2020 2020 2020  s*apec)..       
-00022c80: 203a 7061 7261 6d20 7374 722f 5175 616e   :param str/Quan
-00022c90: 7469 7479 2069 6e6e 6572 5f72 6164 6975  tity inner_radiu
-00022ca0: 733a 2054 6865 206e 616d 6520 6f72 2076  s: The name or v
-00022cb0: 616c 7565 206f 6620 7468 6520 696e 6e65  alue of the inne
-00022cc0: 7220 7261 6469 7573 2074 6861 7420 7761  r radius that wa
-00022cd0: 7320 7573 6564 2066 6f72 2074 6865 2067  s used for the g
-00022ce0: 656e 6572 6174 696f 6e20 6f66 0a20 2020  eneration of.   
-00022cf0: 2020 2020 2020 2020 2074 6865 2073 7065           the spe
-00022d00: 6374 7261 2077 6869 6368 2077 6572 6520  ctra which were 
-00022d10: 6669 7474 6564 2074 6f20 7072 6f64 7563  fitted to produc
-00022d20: 6520 7468 6520 6465 7369 7265 6420 7265  e the desired re
-00022d30: 7375 6c74 2028 666f 7220 696e 7374 616e  sult (for instan
-00022d40: 6365 2027 7235 3030 2720 776f 756c 6420  ce 'r500' would 
-00022d50: 6265 2061 6363 6570 7461 626c 650a 2020  be acceptable.  
-00022d60: 2020 2020 2020 2020 2020 666f 7220 6120            for a 
-00022d70: 4761 6c61 7879 436c 7573 7465 722c 206f  GalaxyCluster, o
-00022d80: 7220 5175 616e 7469 7479 2833 3030 2c20  r Quantity(300, 
-00022d90: 276b 7063 2729 292e 2042 7920 6465 6661  'kpc')). By defa
-00022da0: 756c 7420 7468 6973 2069 7320 7a65 726f  ult this is zero
-00022db0: 2061 7263 7365 636f 6e64 732c 2072 6573   arcseconds, res
-00022dc0: 756c 7469 6e67 2069 6e20 610a 2020 2020  ulting in a.    
-00022dd0: 2020 2020 2020 2020 6369 7263 756c 6172          circular
-00022de0: 2073 7065 6374 7275 6d2e 0a20 2020 2020   spectrum..     
-00022df0: 2020 203a 7061 7261 6d20 7374 7220 7061     :param str pa
-00022e00: 723a 2054 6865 206e 616d 6520 6f66 2074  r: The name of t
-00022e10: 6865 2070 6172 616d 6574 6572 2079 6f75  he parameter you
-00022e20: 2077 616e 7420 6120 7265 7375 6c74 2066   want a result f
-00022e30: 6f72 2e0a 2020 2020 2020 2020 3a70 6172  or..        :par
-00022e40: 616d 2062 6f6f 6c20 6772 6f75 705f 7370  am bool group_sp
-00022e50: 6563 3a20 5768 6574 6865 7220 7468 6520  ec: Whether the 
-00022e60: 7370 6563 7472 6120 7468 6174 2077 6572  spectra that wer
-00022e70: 6520 6669 7474 6564 2066 6f72 2074 6865  e fitted for the
-00022e80: 2064 6573 6972 6564 2072 6573 756c 7420   desired result 
-00022e90: 7765 7265 2067 726f 7570 6564 2e0a 2020  were grouped..  
-00022ea0: 2020 2020 2020 3a70 6172 616d 2066 6c6f        :param flo
-00022eb0: 6174 206d 696e 5f63 6f75 6e74 733a 2054  at min_counts: T
-00022ec0: 6865 206d 696e 696d 756d 2063 6f75 6e74  he minimum count
-00022ed0: 7320 7065 7220 6368 616e 6e65 6c2c 2069  s per channel, i
-00022ee0: 6620 7468 6520 7370 6563 7472 6120 7468  f the spectra th
-00022ef0: 6174 2077 6572 6520 6669 7474 6564 2066  at were fitted f
-00022f00: 6f72 2074 6865 0a20 2020 2020 2020 2020  or the.         
-00022f10: 2020 2064 6573 6972 6564 2072 6573 756c     desired resul
-00022f20: 7420 7765 7265 2067 726f 7570 6564 2062  t were grouped b
-00022f30: 7920 6d69 6e69 6d75 6d20 636f 756e 7473  y minimum counts
-00022f40: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00022f50: 2066 6c6f 6174 206d 696e 5f73 6e3a 2054   float min_sn: T
-00022f60: 6865 206d 696e 696d 756d 2073 6967 6e61  he minimum signa
-00022f70: 6c20 746f 206e 6f69 7365 2070 6572 2063  l to noise per c
-00022f80: 6861 6e6e 656c 2c20 6966 2074 6865 2073  hannel, if the s
-00022f90: 7065 6374 7261 2074 6861 7420 7765 7265  pectra that were
-00022fa0: 2066 6974 7465 6420 666f 7220 7468 650a   fitted for the.
-00022fb0: 2020 2020 2020 2020 2020 2020 6465 7369              desi
-00022fc0: 7265 6420 7265 7375 6c74 2077 6572 6520  red result were 
-00022fd0: 6772 6f75 7065 6420 6279 206d 696e 696d  grouped by minim
-00022fe0: 756d 2073 6967 6e61 6c20 746f 206e 6f69  um signal to noi
-00022ff0: 7365 2e0a 2020 2020 2020 2020 3a70 6172  se..        :par
-00023000: 616d 2066 6c6f 6174 206f 7665 725f 7361  am float over_sa
-00023010: 6d70 6c65 3a20 5468 6520 6c65 7665 6c20  mple: The level 
-00023020: 6f66 206f 7665 7273 616d 706c 696e 6720  of oversampling 
-00023030: 6170 706c 6965 6420 6f6e 2074 6865 2073  applied on the s
-00023040: 7065 6374 7261 2074 6861 7420 7765 7265  pectra that were
-00023050: 2066 6974 7465 642e 0a20 2020 2020 2020   fitted..       
-00023060: 203a 7265 7475 726e 3a20 5468 6520 7265   :return: The re
-00023070: 7175 6573 7465 6420 7265 7375 6c74 2076  quested result v
-00023080: 616c 7565 2c20 616e 6420 756e 6365 7274  alue, and uncert
-00023090: 6169 6e74 6965 732e 0a20 2020 2020 2020  ainties..       
-000230a0: 2022 2222 0a20 2020 2020 2020 2023 2046   """.        # F
-000230b0: 6972 7374 2049 2077 616e 7420 746f 2072  irst I want to r
-000230c0: 6574 7269 6576 6520 7468 6520 7370 6563  etrieve the spec
-000230d0: 7472 6120 7468 6174 2077 6572 6520 6669  tra that were fi
-000230e0: 7474 6564 2074 6f20 7072 6f64 7563 6520  tted to produce 
-000230f0: 7468 6520 7265 7375 6c74 2074 6865 7927  the result they'
-00023100: 7265 206c 6f6f 6b69 6e67 2066 6f72 2c0a  re looking for,.
-00023110: 2020 2020 2020 2020 2320 2062 6563 6175          #  becau
-00023120: 7365 2074 6865 6e20 4920 6361 6e20 6a75  se then I can ju
-00023130: 7374 2067 7261 6220 7468 6520 7374 6f72  st grab the stor
-00023140: 6167 6520 6b65 7920 6672 6f6d 206f 6e65  age key from one
-00023150: 206f 6620 7468 656d 0a20 2020 2020 2020   of them.       
-00023160: 2073 7065 6373 203d 2073 656c 662e 6765   specs = self.ge
-00023170: 745f 7370 6563 7472 6128 6f75 7465 725f  t_spectra(outer_
-00023180: 7261 6469 7573 2c20 4e6f 6e65 2c20 4e6f  radius, None, No
-00023190: 6e65 2c20 696e 6e65 725f 7261 6469 7573  ne, inner_radius
-000231a0: 2c20 6772 6f75 705f 7370 6563 2c20 6d69  , group_spec, mi
-000231b0: 6e5f 636f 756e 7473 2c20 6d69 6e5f 736e  n_counts, min_sn
-000231c0: 2c20 6f76 6572 5f73 616d 706c 6529 0a20  , over_sample). 
-000231d0: 2020 2020 2020 2023 2049 206a 7573 7420         # I just 
-000231e0: 7461 6b65 2074 6865 2066 6972 7374 2073  take the first s
-000231f0: 7065 6374 7275 6d20 696e 2074 6865 206c  pectrum in the l
-00023200: 6973 7420 6265 6361 7573 6520 7468 6520  ist because the 
-00023210: 7374 6f72 6167 6520 6b65 7920 7769 6c6c  storage key will
-00023220: 2062 6520 7468 6520 7361 6d65 2066 6f72   be the same for
-00023230: 2061 6c6c 206f 6620 7468 656d 0a20 2020   all of them.   
-00023240: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00023250: 6365 2873 7065 6373 2c20 6c69 7374 293a  ce(specs, list):
-00023260: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
-00023270: 7261 6765 5f6b 6579 203d 2073 7065 6373  rage_key = specs
-00023280: 5b30 5d2e 7374 6f72 6167 655f 6b65 790a  [0].storage_key.
-00023290: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000232a0: 2020 2020 2020 2020 2020 7374 6f72 6167            storag
-000232b0: 655f 6b65 7920 3d20 7370 6563 732e 7374  e_key = specs.st
-000232c0: 6f72 6167 655f 6b65 790a 0a20 2020 2020  orage_key..     
-000232d0: 2020 2023 2042 756e 6368 206f 6620 6368     # Bunch of ch
-000232e0: 6563 6b73 2074 6f20 6d61 6b65 2073 7572  ecks to make sur
-000232f0: 6520 7468 6520 7265 7175 6573 7465 6420  e the requested 
-00023300: 7265 7375 6c74 7320 6163 7475 616c 6c79  results actually
-00023310: 2065 7869 7374 0a20 2020 2020 2020 2069   exist.        i
-00023320: 6620 6c65 6e28 7365 6c66 2e5f 6669 745f  f len(self._fit_
-00023330: 7265 7375 6c74 7329 203d 3d20 303a 0a20  results) == 0:. 
-00023340: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00023350: 204d 6f64 656c 4e6f 7441 7373 6f63 6961   ModelNotAssocia
-00023360: 7465 6445 7272 6f72 2822 5468 6572 6520  tedError("There 
-00023370: 6172 6520 6e6f 2058 5350 4543 2066 6974  are no XSPEC fit
-00023380: 7320 6173 736f 6369 6174 6564 2077 6974  s associated wit
-00023390: 6820 7b73 7d22 2e66 6f72 6d61 7428 733d  h {s}".format(s=
-000233a0: 7365 6c66 2e6e 616d 6529 290a 2020 2020  self.name)).    
-000233b0: 2020 2020 656c 6966 2073 746f 7261 6765      elif storage
-000233c0: 5f6b 6579 206e 6f74 2069 6e20 7365 6c66  _key not in self
-000233d0: 2e5f 6669 745f 7265 7375 6c74 733a 0a20  ._fit_results:. 
-000233e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000233f0: 204d 6f64 656c 4e6f 7441 7373 6f63 6961   ModelNotAssocia
-00023400: 7465 6445 7272 6f72 2822 5468 6f73 6520  tedError("Those 
-00023410: 7370 6563 7472 6120 6861 7665 206e 6f20  spectra have no 
-00023420: 6173 736f 6369 6174 6564 2058 5350 4543  associated XSPEC
-00023430: 2066 6974 2074 6f20 7b73 7d22 2e66 6f72   fit to {s}".for
-00023440: 6d61 7428 733d 7365 6c66 2e6e 616d 6529  mat(s=self.name)
-00023450: 290a 2020 2020 2020 2020 656c 6966 206d  ).        elif m
-00023460: 6f64 656c 206e 6f74 2069 6e20 7365 6c66  odel not in self
-00023470: 2e5f 6669 745f 7265 7375 6c74 735b 7374  ._fit_results[st
-00023480: 6f72 6167 655f 6b65 795d 3a0a 2020 2020  orage_key]:.    
-00023490: 2020 2020 2020 2020 6176 5f6d 6f64 7320          av_mods 
-000234a0: 3d20 222c 2022 2e6a 6f69 6e28 7365 6c66  = ", ".join(self
-000234b0: 2e5f 6669 745f 7265 7375 6c74 735b 7374  ._fit_results[st
-000234c0: 6f72 6167 655f 6b65 795d 2e6b 6579 7328  orage_key].keys(
-000234d0: 2929 0a20 2020 2020 2020 2020 2020 2072  )).            r
-000234e0: 6169 7365 204d 6f64 656c 4e6f 7441 7373  aise ModelNotAss
-000234f0: 6f63 6961 7465 6445 7272 6f72 2822 7b6d  ociatedError("{m
-00023500: 7d20 6861 7320 6e6f 7420 6265 656e 2066  } has not been f
-00023510: 6974 7465 6420 746f 2074 686f 7365 2073  itted to those s
-00023520: 7065 6374 7261 206f 6620 7b73 7d3b 2061  pectra of {s}; a
-00023530: 7661 696c 6162 6c65 2022 0a20 2020 2020  vailable ".     
-00023540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023560: 2020 2020 2022 6d6f 6465 6c73 2061 7265       "models are
-00023570: 207b 617d 222e 666f 726d 6174 286d 3d6d   {a}".format(m=m
-00023580: 6f64 656c 2c20 733d 7365 6c66 2e6e 616d  odel, s=self.nam
-00023590: 652c 2061 3d61 765f 6d6f 6473 2929 0a20  e, a=av_mods)). 
-000235a0: 2020 2020 2020 2065 6c69 6620 7061 7220         elif par 
-000235b0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-000235c0: 7061 7220 6e6f 7420 696e 2073 656c 662e  par not in self.
-000235d0: 5f66 6974 5f72 6573 756c 7473 5b73 746f  _fit_results[sto
-000235e0: 7261 6765 5f6b 6579 5d5b 6d6f 6465 6c5d  rage_key][model]
-000235f0: 3a0a 2020 2020 2020 2020 2020 2020 6176  :.            av
-00023600: 5f70 6172 7320 3d20 222c 2022 2e6a 6f69  _pars = ", ".joi
-00023610: 6e28 7365 6c66 2e5f 6669 745f 7265 7375  n(self._fit_resu
-00023620: 6c74 735b 7374 6f72 6167 655f 6b65 795d  lts[storage_key]
-00023630: 5b6d 6f64 656c 5d2e 6b65 7973 2829 290a  [model].keys()).
-00023640: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00023650: 6520 5061 7261 6d65 7465 724e 6f74 4173  e ParameterNotAs
-00023660: 736f 6369 6174 6564 4572 726f 7228 227b  sociatedError("{
-00023670: 707d 2077 6173 206e 6f74 2061 2066 7265  p} was not a fre
-00023680: 6520 7061 7261 6d65 7465 7220 696e 2074  e parameter in t
-00023690: 6865 207b 6d7d 2066 6974 2074 6f20 7b73  he {m} fit to {s
-000236a0: 7d2c 2022 0a20 2020 2020 2020 2020 2020  }, ".           
+000210d0: 2020 2020 2020 2020 726f 743d 726f 745f          rot=rot_
+000210e0: 616e 676c 652e 746f 2827 6465 6727 292e  angle.to('deg').
+000210f0: 726f 756e 6428 3429 2e76 616c 7565 290a  round(4).value).
+00021100: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+00021110: 2069 6e6e 6572 5f72 6164 6975 732e 6973   inner_radius.is
+00021120: 7363 616c 6172 2061 6e64 2069 6e6e 6572  scalar and inner
+00021130: 5f72 6164 6975 735b 305d 2e76 616c 7565  _radius[0].value
+00021140: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00021150: 2020 2073 6173 5f73 6f75 7263 655f 6172     sas_source_ar
+00021160: 6561 203d 2022 2828 7b74 7d29 2049 4e20  ea = "(({t}) IN 
+00021170: 656c 6c69 7073 6528 7b63 787d 2c7b 6379  ellipse({cx},{cy
+00021180: 7d2c 7b77 7d2c 7b68 7d2c 7b72 6f74 7d29  },{w},{h},{rot})
+00021190: 2922 0a20 2020 2020 2020 2020 2020 2073  )".            s
+000211a0: 6173 5f73 6f75 7263 655f 6172 6561 203d  as_source_area =
+000211b0: 2073 6173 5f73 6f75 7263 655f 6172 6561   sas_source_area
+000211c0: 2e66 6f72 6d61 7428 743d 635f 7374 722c  .format(t=c_str,
+000211d0: 2063 783d 786d 6d5f 6365 6e74 7261 6c5f   cx=xmm_central_
+000211e0: 636f 6f72 645b 305d 2e72 6f75 6e64 2834  coord[0].round(4
+000211f0: 292e 7661 6c75 652c 0a20 2020 2020 2020  ).value,.       
+00021200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021220: 2020 2020 2020 2020 2020 2020 2020 6379                cy
+00021230: 3d78 6d6d 5f63 656e 7472 616c 5f63 6f6f  =xmm_central_coo
+00021240: 7264 5b31 5d2e 726f 756e 6428 3429 2e76  rd[1].round(4).v
+00021250: 616c 7565 2c0a 2020 2020 2020 2020 2020  alue,.          
+00021260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021280: 2020 2020 2020 2020 2020 2077 3d28 6f75             w=(ou
+00021290: 7465 725f 7261 6469 7573 5b30 5d2e 7661  ter_radius[0].va
+000212a0: 6c75 6520 2f20 736b 795f 746f 5f64 6567  lue / sky_to_deg
+000212b0: 292e 726f 756e 6428 3429 2c0a 2020 2020  ).round(4),.    
+000212c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212f0: 2068 3d28 6f75 7465 725f 7261 6469 7573   h=(outer_radius
+00021300: 5b31 5d2e 7661 6c75 6520 2f20 736b 795f  [1].value / sky_
+00021310: 746f 5f64 6567 292e 726f 756e 6428 3429  to_deg).round(4)
+00021320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00021330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021350: 2020 2020 2020 2072 6f74 3d72 6f74 5f61         rot=rot_a
+00021360: 6e67 6c65 2e74 6f28 2764 6567 2729 2e72  ngle.to('deg').r
+00021370: 6f75 6e64 2834 292e 7661 6c75 6529 0a0a  ound(4).value)..
+00021380: 2020 2020 2020 2020 2320 436f 6d62 696e          # Combin
+00021390: 696e 6720 7468 6520 736f 7572 6365 2072  ing the source r
+000213a0: 6567 696f 6e20 7769 7468 2074 6865 2072  egion with the r
+000213b0: 6567 696f 6e73 2077 6520 6e65 6564 2074  egions we need t
+000213c0: 6f20 6375 7420 6f75 740a 2020 2020 2020  o cut out.      
+000213d0: 2020 6966 206c 656e 2873 6173 5f69 6e74    if len(sas_int
+000213e0: 6572 6c6f 7065 7229 203d 3d20 303a 0a20  erloper) == 0:. 
+000213f0: 2020 2020 2020 2020 2020 2066 696e 616c             final
+00021400: 5f73 7263 203d 2073 6173 5f73 6f75 7263  _src = sas_sourc
+00021410: 655f 6172 6561 0a20 2020 2020 2020 2065  e_area.        e
+00021420: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00021430: 2066 696e 616c 5f73 7263 203d 2073 6173   final_src = sas
+00021440: 5f73 6f75 7263 655f 6172 6561 202b 2022  _source_area + "
+00021450: 2026 2621 2022 202b 2022 2026 2621 2022   &&! " + " &&! "
+00021460: 2e6a 6f69 6e28 7361 735f 696e 7465 726c  .join(sas_interl
+00021470: 6f70 6572 290a 0a20 2020 2020 2020 2072  oper)..        r
+00021480: 6574 7572 6e20 6669 6e61 6c5f 7372 630a  eturn final_src.
+00021490: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+000214a0: 2020 2064 6566 206e 4828 7365 6c66 2920     def nH(self) 
+000214b0: 2d3e 2051 7561 6e74 6974 793a 0a20 2020  -> Quantity:.   
+000214c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000214d0: 2050 726f 7065 7274 7920 6765 7474 6572   Property getter
+000214e0: 2066 6f72 206e 6575 7472 616c 2068 7964   for neutral hyd
+000214f0: 726f 6765 6e20 636f 6c75 6d6e 2061 7474  rogen column att
+00021500: 7269 6275 7465 2e0a 0a20 2020 2020 2020  ribute...       
+00021510: 203a 7265 7475 726e 3a20 4e65 7574 7261   :return: Neutra
+00021520: 6c20 6879 6472 6f67 656e 2063 6f6c 756d  l hydrogen colum
+00021530: 6e20 7375 7266 6163 6520 6465 6e73 6974  n surface densit
+00021540: 792e 0a20 2020 2020 2020 203a 7274 7970  y..        :rtyp
+00021550: 653a 2051 7561 6e74 6974 790a 2020 2020  e: Quantity.    
+00021560: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00021570: 7265 7475 726e 2073 656c 662e 5f6e 480a  return self._nH.
+00021580: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00021590: 2020 2064 6566 2072 6564 7368 6966 7428     def redshift(
+000215a0: 7365 6c66 2920 2d3e 2066 6c6f 6174 3a0a  self) -> float:.
+000215b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000215c0: 2020 2020 5072 6f70 6572 7479 2067 6574      Property get
+000215d0: 7465 7220 666f 7220 7468 6520 7265 6473  ter for the reds
+000215e0: 6869 6674 206f 6620 7468 6973 2073 6f75  hift of this sou
+000215f0: 7263 6520 6f62 6a65 6374 2e0a 0a20 2020  rce object...   
+00021600: 2020 2020 203a 7265 7475 726e 3a20 5265       :return: Re
+00021610: 6473 6869 6674 2076 616c 7565 0a20 2020  dshift value.   
+00021620: 2020 2020 203a 7274 7970 653a 2066 6c6f       :rtype: flo
+00021630: 6174 0a20 2020 2020 2020 2022 2222 0a20  at.        """. 
+00021640: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00021650: 6c66 2e5f 7265 6473 6869 6674 0a0a 2020  lf._redshift..  
+00021660: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00021670: 6465 6620 6f6e 5f61 7869 735f 6f62 735f  def on_axis_obs_
+00021680: 6964 7328 7365 6c66 2920 2d3e 206c 6973  ids(self) -> lis
+00021690: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+000216a0: 2020 2020 2020 2054 6869 7320 6d65 7468         This meth
+000216b0: 6f64 2072 6574 7572 6e73 2061 6e20 6172  od returns an ar
+000216c0: 7261 7920 6f66 204f 6273 4944 7320 7468  ray of ObsIDs th
+000216d0: 6174 2074 6869 7320 736f 7572 6365 2069  at this source i
+000216e0: 7320 6170 7072 6f78 696d 6174 656c 7920  s approximately 
+000216f0: 6f6e 2061 7869 7320 696e 2e0a 0a20 2020  on axis in...   
+00021700: 2020 2020 203a 7265 7475 726e 3a20 4f62       :return: Ob
+00021710: 7349 4473 2066 6f72 2077 6869 6368 2074  sIDs for which t
+00021720: 6865 2073 6f75 7263 6520 6973 2061 7070  he source is app
+00021730: 726f 7869 6d61 7465 6c79 206f 6e20 6178  roximately on ax
+00021740: 6973 2e0a 2020 2020 2020 2020 3a72 7479  is..        :rty
+00021750: 7065 3a20 6c69 7374 0a20 2020 2020 2020  pe: list.       
+00021760: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00021770: 7572 6e20 7365 6c66 2e5f 6f6e 6178 6973  urn self._onaxis
+00021780: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+00021790: 2020 2020 6465 6620 636f 736d 6f28 7365      def cosmo(se
+000217a0: 6c66 2920 2d3e 2043 6f73 6d6f 6c6f 6779  lf) -> Cosmology
+000217b0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000217c0: 2020 2020 2020 5468 6973 206d 6574 686f        This metho
+000217d0: 6420 7265 7475 726e 7320 7768 6174 6576  d returns whatev
+000217e0: 6572 2063 6f73 6d6f 6c6f 6779 206f 626a  er cosmology obj
+000217f0: 6563 7420 6973 2061 7373 6f63 6961 7465  ect is associate
+00021800: 6420 7769 7468 2074 6869 7320 736f 7572  d with this sour
+00021810: 6365 206f 626a 6563 742e 0a0a 2020 2020  ce object...    
+00021820: 2020 2020 3a72 6574 7572 6e3a 2041 6e20      :return: An 
+00021830: 6173 7472 6f70 7920 636f 736d 6f6c 6f67  astropy cosmolog
+00021840: 7920 6f62 6a65 6374 2073 7065 6369 6669  y object specifi
+00021850: 6564 2066 6f72 2074 6869 7320 736f 7572  ed for this sour
+00021860: 6365 206f 6e20 696e 6974 6961 6c69 7a61  ce on initializa
+00021870: 7469 6f6e 2e0a 2020 2020 2020 2020 3a72  tion..        :r
+00021880: 7479 7065 3a20 436f 736d 6f6c 6f67 790a  type: Cosmology.
+00021890: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000218a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000218b0: 5f63 6f73 6d6f 0a0a 2020 2020 2320 5468  _cosmo..    # Th
+000218c0: 6973 2069 7320 7573 6564 2074 6f20 6e61  is is used to na
+000218d0: 6d65 2066 696c 6573 2061 6e64 2064 6972  me files and dir
+000218e0: 6563 746f 7269 6573 2073 6f20 7468 6973  ectories so this
+000218f0: 2069 7320 6e6f 7420 616c 6c6f 7765 6420   is not allowed 
+00021900: 746f 2063 6861 6e67 652e 0a20 2020 2040  to change..    @
+00021910: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00021920: 206e 616d 6528 7365 6c66 2920 2d3e 2073   name(self) -> s
+00021930: 7472 3a0a 2020 2020 2020 2020 2222 220a  tr:.        """.
+00021940: 2020 2020 2020 2020 5468 6520 6e61 6d65          The name
+00021950: 206f 6620 7468 6520 736f 7572 6365 2c20   of the source, 
+00021960: 6569 7468 6572 2067 6976 656e 2061 7420  either given at 
+00021970: 696e 6974 6961 6c69 7361 7469 6f6e 206f  initialisation o
+00021980: 7220 6765 6e65 7261 7465 6420 6672 6f6d  r generated from
+00021990: 2074 6865 2075 7365 722d 7375 7070 6c69   the user-suppli
+000219a0: 6564 2063 6f6f 7264 696e 6174 6573 2e0a  ed coordinates..
+000219b0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+000219c0: 3a20 5468 6520 6e61 6d65 206f 6620 7468  : The name of th
+000219d0: 6520 736f 7572 6365 2e0a 2020 2020 2020  e source..      
+000219e0: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
+000219f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00021a00: 2020 7265 7475 726e 2073 656c 662e 5f6e    return self._n
+00021a10: 616d 650a 0a20 2020 2064 6566 2061 6464  ame..    def add
+00021a20: 5f66 6974 5f64 6174 6128 7365 6c66 2c20  _fit_data(self, 
+00021a30: 6d6f 6465 6c3a 2073 7472 2c20 7461 625f  model: str, tab_
+00021a40: 6c69 6e65 2c20 6c75 6d73 3a20 6469 6374  line, lums: dict
+00021a50: 2c20 7370 6563 5f73 746f 7261 6765 5f6b  , spec_storage_k
+00021a60: 6579 3a20 7374 7229 3a0a 2020 2020 2020  ey: str):.      
+00021a70: 2020 2222 220a 2020 2020 2020 2020 4120    """.        A 
+00021a80: 6d65 7468 6f64 2074 6861 7420 7374 6f72  method that stor
+00021a90: 6573 2066 6974 2072 6573 756c 7473 2061  es fit results a
+00021aa0: 6e64 2067 6c6f 6261 6c20 696e 666f 726d  nd global inform
+00021ab0: 6174 696f 6e20 6162 6f75 7420 6120 7468  ation about a th
+00021ac0: 6520 7365 7420 6f66 2073 7065 6374 7261  e set of spectra
+00021ad0: 2069 6e20 6120 736f 7572 6365 206f 626a   in a source obj
+00021ae0: 6563 742e 0a20 2020 2020 2020 2041 6e79  ect..        Any
+00021af0: 2076 6172 6961 626c 6520 7061 7261 6d65   variable parame
+00021b00: 7465 7273 2069 6e20 7468 6520 6669 7420  ters in the fit 
+00021b10: 6172 6520 7374 6f72 6564 2069 6e20 616e  are stored in an
+00021b20: 2069 6e74 6572 6e61 6c20 6469 6374 696f   internal dictio
+00021b30: 6e61 7279 2073 7472 7563 7475 7265 2c20  nary structure, 
+00021b40: 6173 2061 7265 2061 6e79 206c 756d 696e  as are any lumin
+00021b50: 6f73 6974 6965 730a 2020 2020 2020 2020  osities.        
+00021b60: 6361 6c63 756c 6174 6564 2e20 4f74 6865  calculated. Othe
+00021b70: 7220 7061 7261 6d65 7465 7273 206f 6620  r parameters of 
+00021b80: 696e 7465 7265 7374 2061 7265 2073 746f  interest are sto
+00021b90: 7265 2069 6e20 6f74 6865 7220 696e 7465  re in other inte
+00021ba0: 726e 616c 2061 7474 7269 6275 7465 732e  rnal attributes.
+00021bb0: 2054 6869 7320 7072 6f62 6162 6c79 2073   This probably s
+00021bc0: 686f 756c 646e 2774 0a20 2020 2020 2020  houldn't.       
+00021bd0: 2065 7665 7220 6265 2075 7365 6420 6279   ever be used by
+00021be0: 2074 6865 2075 7365 722c 206a 7573 7420   the user, just 
+00021bf0: 6f74 6865 7220 7061 7274 7320 6f66 2058  other parts of X
+00021c00: 4741 2c20 6865 6e63 6520 7768 7920 4927  GA, hence why I'
+00021c10: 7665 2061 736b 6564 2066 6f72 2061 2073  ve asked for a s
+00021c20: 7065 635f 7374 6f72 6167 655f 6b65 7920  pec_storage_key 
+00021c30: 746f 2062 6520 7061 7373 6564 0a20 2020  to be passed.   
+00021c40: 2020 2020 2069 6e20 7261 7468 6572 2074       in rather t
+00021c50: 6861 6e20 616c 6c20 7468 6520 7370 6563  han all the spec
+00021c60: 7472 756d 2063 6f6e 6669 6775 7261 7469  trum configurati
+00021c70: 6f6e 206f 7074 696f 6e73 2069 6e64 6976  on options indiv
+00021c80: 6964 7561 6c6c 792e 0a0a 2020 2020 2020  idually...      
+00021c90: 2020 3a70 6172 616d 2073 7472 206d 6f64    :param str mod
+00021ca0: 656c 3a20 5468 6520 5853 5045 4320 6465  el: The XSPEC de
+00021cb0: 6669 6e69 7469 6f6e 206f 6620 7468 6520  finition of the 
+00021cc0: 6d6f 6465 6c20 7573 6564 2074 6f20 7065  model used to pe
+00021cd0: 7266 6f72 6d20 7468 6520 6669 742e 2065  rform the fit. e
+00021ce0: 2e67 2e20 636f 6e73 7461 6e74 2a74 6261  .g. constant*tba
+00021cf0: 6273 2a61 7065 630a 2020 2020 2020 2020  bs*apec.        
+00021d00: 3a70 6172 616d 2074 6162 5f6c 696e 653a  :param tab_line:
+00021d10: 2054 6865 2074 6162 6c65 206c 696e 6520   The table line 
+00021d20: 7769 7468 2074 6865 2066 6974 2064 6174  with the fit dat
+00021d30: 612e 0a20 2020 2020 2020 203a 7061 7261  a..        :para
+00021d40: 6d20 6469 6374 206c 756d 733a 2054 6865  m dict lums: The
+00021d50: 2076 6172 696f 7573 206c 756d 696e 6f73   various luminos
+00021d60: 6974 6965 7320 6d65 6173 7572 6564 2064  ities measured d
+00021d70: 7572 696e 6720 7468 6520 6669 742e 0a20  uring the fit.. 
+00021d80: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+00021d90: 7220 7370 6563 5f73 746f 7261 6765 5f6b  r spec_storage_k
+00021da0: 6579 3a20 5468 6520 7374 6f72 6167 6520  ey: The storage 
+00021db0: 6b65 7920 6f66 2061 6e79 2073 7065 6374  key of any spect
+00021dc0: 7275 6d20 7468 6174 2077 6173 2075 7365  rum that was use
+00021dd0: 6420 696e 2074 6869 7320 7061 7274 6963  d in this partic
+00021de0: 756c 6172 2066 6974 2e20 5468 650a 2020  ular fit. The.  
+00021df0: 2020 2020 2020 2020 2020 4f62 7349 4420            ObsID 
+00021e00: 616e 6420 696e 7374 7275 6d65 6e74 2075  and instrument u
+00021e10: 7365 6420 646f 6e27 7420 6d61 7474 6572  sed don't matter
+00021e20: 2c20 6173 2074 6865 2073 746f 7261 6765  , as the storage
+00021e30: 206b 6579 2077 696c 6c20 6265 2074 6865   key will be the
+00021e40: 2073 616d 6520 616e 6420 6973 2062 6173   same and is bas
+00021e50: 6564 206f 6666 206f 6620 7468 650a 2020  ed off of the.  
+00021e60: 2020 2020 2020 2020 2020 7365 7474 696e            settin
+00021e70: 6773 2077 6865 6e20 7468 6520 7370 6563  gs when the spec
+00021e80: 7472 6120 7765 7265 2067 656e 6572 6174  tra were generat
+00021e90: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
+00021ea0: 2020 2020 2020 2020 2320 4a75 7374 2068          # Just h
+00021eb0: 6561 6465 7273 2074 6861 7420 7769 6c6c  eaders that will
+00021ec0: 2061 6c77 6179 7320 6265 2070 7265 7365   always be prese
+00021ed0: 6e74 2069 6e20 7461 625f 6c69 6e65 2074  nt in tab_line t
+00021ee0: 6861 7420 6172 6520 6e6f 7420 6669 7420  hat are not fit 
+00021ef0: 7061 7261 6d65 7465 7273 0a20 2020 2020  parameters.     
+00021f00: 2020 206e 6f74 5f70 6172 203d 205b 274d     not_par = ['M
+00021f10: 4f44 454c 272c 2027 544f 5441 4c5f 4558  ODEL', 'TOTAL_EX
+00021f20: 504f 5355 5245 272c 2027 544f 5441 4c5f  POSURE', 'TOTAL_
+00021f30: 434f 554e 545f 5241 5445 272c 2027 544f  COUNT_RATE', 'TO
+00021f40: 5441 4c5f 434f 554e 545f 5241 5445 5f45  TAL_COUNT_RATE_E
+00021f50: 5252 272c 0a20 2020 2020 2020 2020 2020  RR',.           
+00021f60: 2020 2020 2020 2020 274e 554d 5f55 4e4c          'NUM_UNL
+00021f70: 494e 4b45 445f 5448 4157 4544 5f56 4152  INKED_THAWED_VAR
+00021f80: 5327 2c20 2746 4954 5f53 5441 5449 5354  S', 'FIT_STATIST
+00021f90: 4943 272c 2027 5445 5354 5f53 5441 5449  IC', 'TEST_STATI
+00021fa0: 5354 4943 272c 2027 444f 4627 5d0a 0a20  STIC', 'DOF'].. 
+00021fb0: 2020 2020 2020 2023 2056 6172 696f 7573         # Various
+00021fc0: 2067 6c6f 6261 6c20 7661 6c75 6573 206f   global values o
+00021fd0: 6620 696e 7465 7265 7374 0a20 2020 2020  f interest.     
+00021fe0: 2020 2073 656c 662e 5f74 6f74 616c 5f65     self._total_e
+00021ff0: 7870 5b73 7065 635f 7374 6f72 6167 655f  xp[spec_storage_
+00022000: 6b65 795d 203d 2066 6c6f 6174 2874 6162  key] = float(tab
+00022010: 5f6c 696e 655b 2254 4f54 414c 5f45 5850  _line["TOTAL_EXP
+00022020: 4f53 5552 4522 5d29 0a20 2020 2020 2020  OSURE"]).       
+00022030: 2069 6620 7370 6563 5f73 746f 7261 6765   if spec_storage
+00022040: 5f6b 6579 206e 6f74 2069 6e20 7365 6c66  _key not in self
+00022050: 2e5f 746f 7461 6c5f 636f 756e 745f 7261  ._total_count_ra
+00022060: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
+00022070: 7365 6c66 2e5f 746f 7461 6c5f 636f 756e  self._total_coun
+00022080: 745f 7261 7465 5b73 7065 635f 7374 6f72  t_rate[spec_stor
+00022090: 6167 655f 6b65 795d 203d 207b 7d0a 2020  age_key] = {}.  
+000220a0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000220b0: 7465 7374 5f73 7461 745b 7370 6563 5f73  test_stat[spec_s
+000220c0: 746f 7261 6765 5f6b 6579 5d20 3d20 7b7d  torage_key] = {}
+000220d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000220e0: 662e 5f64 6f66 5b73 7065 635f 7374 6f72  f._dof[spec_stor
+000220f0: 6167 655f 6b65 795d 203d 207b 7d0a 2020  age_key] = {}.  
+00022100: 2020 2020 2020 7365 6c66 2e5f 746f 7461        self._tota
+00022110: 6c5f 636f 756e 745f 7261 7465 5b73 7065  l_count_rate[spe
+00022120: 635f 7374 6f72 6167 655f 6b65 795d 5b6d  c_storage_key][m
+00022130: 6f64 656c 5d20 3d20 5b66 6c6f 6174 2874  odel] = [float(t
+00022140: 6162 5f6c 696e 655b 2254 4f54 414c 5f43  ab_line["TOTAL_C
+00022150: 4f55 4e54 5f52 4154 4522 5d29 2c0a 2020  OUNT_RATE"]),.  
+00022160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022190: 2020 2020 2020 2020 2066 6c6f 6174 2874           float(t
+000221a0: 6162 5f6c 696e 655b 2254 4f54 414c 5f43  ab_line["TOTAL_C
+000221b0: 4f55 4e54 5f52 4154 455f 4552 5222 5d29  OUNT_RATE_ERR"])
+000221c0: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
+000221d0: 7465 7374 5f73 7461 745b 7370 6563 5f73  test_stat[spec_s
+000221e0: 746f 7261 6765 5f6b 6579 5d5b 6d6f 6465  torage_key][mode
+000221f0: 6c5d 203d 2066 6c6f 6174 2874 6162 5f6c  l] = float(tab_l
+00022200: 696e 655b 2254 4553 545f 5354 4154 4953  ine["TEST_STATIS
+00022210: 5449 4322 5d29 0a20 2020 2020 2020 2073  TIC"]).        s
+00022220: 656c 662e 5f64 6f66 5b73 7065 635f 7374  elf._dof[spec_st
+00022230: 6f72 6167 655f 6b65 795d 5b6d 6f64 656c  orage_key][model
+00022240: 5d20 3d20 666c 6f61 7428 7461 625f 6c69  ] = float(tab_li
+00022250: 6e65 5b22 444f 4622 5d29 0a0a 2020 2020  ne["DOF"])..    
+00022260: 2020 2020 2320 5468 6520 7061 7261 6d65      # The parame
+00022270: 7465 7273 2061 7661 696c 6162 6c65 2077  ters available w
+00022280: 696c 6c20 6f62 7669 6f75 736c 7920 6265  ill obviously be
+00022290: 2064 796e 616d 6963 2c20 736f 2068 6176   dynamic, so hav
+000222a0: 6520 746f 2066 696e 6420 6f75 7420 7768  e to find out wh
+000222b0: 6174 2074 6865 7920 6172 6520 616e 6420  at they are and 
+000222c0: 7468 656e 0a20 2020 2020 2020 2023 2020  then.        #  
+000222d0: 7468 656e 2066 6f72 2065 6163 6820 7265  then for each re
+000222e0: 7375 6c74 2066 696e 6420 7468 6520 2b2d  sult find the +-
+000222f0: 2065 7272 6f72 730a 2020 2020 2020 2020   errors.        
+00022300: 7061 725f 6865 6164 6572 7320 3d20 5b6e  par_headers = [n
+00022310: 2066 6f72 206e 2069 6e20 7461 625f 6c69   for n in tab_li
+00022320: 6e65 2e64 7479 7065 2e6e 616d 6573 2069  ne.dtype.names i
+00022330: 6620 6e20 6e6f 7420 696e 206e 6f74 5f70  f n not in not_p
+00022340: 6172 5d0a 2020 2020 2020 2020 6d6f 645f  ar].        mod_
+00022350: 7265 7320 3d20 7b7d 0a20 2020 2020 2020  res = {}.       
+00022360: 2066 6f72 2070 6172 2069 6e20 7061 725f   for par in par_
+00022370: 6865 6164 6572 733a 0a20 2020 2020 2020  headers:.       
+00022380: 2020 2020 2023 2054 6865 2070 6172 616d       # The param
+00022390: 6574 6572 206e 616d 6520 616e 6420 7468  eter name and th
+000223a0: 6520 7061 7261 6d65 7465 7220 696e 6465  e parameter inde
+000223b0: 7820 7573 6564 2062 7920 5853 5045 4320  x used by XSPEC 
+000223c0: 6172 6520 7365 7061 7261 7465 6420 6279  are separated by
+000223d0: 207c 0a20 2020 2020 2020 2020 2020 2070   |.            p
+000223e0: 6172 5f69 6e66 6f20 3d20 7061 722e 7370  ar_info = par.sp
+000223f0: 6c69 7428 227c 2229 0a20 2020 2020 2020  lit("|").       
+00022400: 2020 2020 2070 6172 5f6e 616d 6520 3d20       par_name = 
+00022410: 7061 725f 696e 666f 5b30 5d0a 0a20 2020  par_info[0]..   
+00022420: 2020 2020 2020 2020 2023 2054 6865 2070           # The p
+00022430: 6172 616d 6574 6572 2069 6e64 6578 2063  arameter index c
+00022440: 616e 2061 6c73 6f20 6861 7665 2061 6e20  an also have an 
+00022450: 2d20 6f72 202b 2061 6674 6572 2069 7420  - or + after it 
+00022460: 6966 2074 6865 2065 6e74 7279 2069 6e20  if the entry in 
+00022470: 7175 6573 7469 6f6e 2069 7320 616e 2075  question is an u
+00022480: 6e63 6572 7461 696e 7479 0a20 2020 2020  ncertainty.     
+00022490: 2020 2020 2020 2069 6620 7061 725f 696e         if par_in
+000224a0: 666f 5b31 5d5b 2d31 5d20 3d3d 2022 2d22  fo[1][-1] == "-"
+000224b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000224c0: 2020 6964 656e 7420 3d20 7061 725f 696e    ident = par_in
+000224d0: 666f 5b31 5d5b 3a2d 315d 0a20 2020 2020  fo[1][:-1].     
+000224e0: 2020 2020 2020 2020 2020 2070 6f73 203d             pos =
+000224f0: 2031 0a20 2020 2020 2020 2020 2020 2065   1.            e
+00022500: 6c69 6620 7061 725f 696e 666f 5b31 5d5b  lif par_info[1][
+00022510: 2d31 5d20 3d3d 2022 2b22 3a0a 2020 2020  -1] == "+":.    
+00022520: 2020 2020 2020 2020 2020 2020 6964 656e              iden
+00022530: 7420 3d20 7061 725f 696e 666f 5b31 5d5b  t = par_info[1][
+00022540: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
+00022550: 2020 2020 2070 6f73 203d 2032 0a20 2020       pos = 2.   
+00022560: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00022570: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00022580: 6465 6e74 203d 2070 6172 5f69 6e66 6f5b  dent = par_info[
+00022590: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+000225a0: 2020 2070 6f73 203d 2030 0a0a 2020 2020     pos = 0..    
+000225b0: 2020 2020 2020 2020 2320 5365 7473 2075          # Sets u
+000225c0: 7020 7468 6520 6469 6374 696f 6e61 7279  p the dictionary
+000225d0: 2073 7472 7563 7475 7265 2066 6f72 2074   structure for t
+000225e0: 6865 2072 6573 756c 7473 0a20 2020 2020  he results.     
+000225f0: 2020 2020 2020 2069 6620 7061 725f 6e61         if par_na
+00022600: 6d65 206e 6f74 2069 6e20 6d6f 645f 7265  me not in mod_re
+00022610: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00022620: 2020 206d 6f64 5f72 6573 5b70 6172 5f6e     mod_res[par_n
+00022630: 616d 655d 203d 207b 6964 656e 743a 205b  ame] = {ident: [
+00022640: 302c 2030 2c20 305d 7d0a 2020 2020 2020  0, 0, 0]}.      
+00022650: 2020 2020 2020 656c 6966 2069 6465 6e74        elif ident
+00022660: 206e 6f74 2069 6e20 6d6f 645f 7265 735b   not in mod_res[
+00022670: 7061 725f 6e61 6d65 5d3a 0a20 2020 2020  par_name]:.     
+00022680: 2020 2020 2020 2020 2020 206d 6f64 5f72             mod_r
+00022690: 6573 5b70 6172 5f6e 616d 655d 5b69 6465  es[par_name][ide
+000226a0: 6e74 5d20 3d20 5b30 2c20 302c 2030 5d0a  nt] = [0, 0, 0].
+000226b0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+000226c0: 5f72 6573 5b70 6172 5f6e 616d 655d 5b69  _res[par_name][i
+000226d0: 6465 6e74 5d5b 706f 735d 203d 2066 6c6f  dent][pos] = flo
+000226e0: 6174 2874 6162 5f6c 696e 655b 7061 725d  at(tab_line[par]
+000226f0: 290a 0a20 2020 2020 2020 2023 2053 746f  )..        # Sto
+00022700: 7269 6e67 2074 6865 2066 6974 2072 6573  ring the fit res
+00022710: 756c 7473 0a20 2020 2020 2020 2069 6620  ults.        if 
+00022720: 7370 6563 5f73 746f 7261 6765 5f6b 6579  spec_storage_key
+00022730: 206e 6f74 2069 6e20 7365 6c66 2e5f 6669   not in self._fi
+00022740: 745f 7265 7375 6c74 733a 0a20 2020 2020  t_results:.     
+00022750: 2020 2020 2020 2073 656c 662e 5f66 6974         self._fit
+00022760: 5f72 6573 756c 7473 5b73 7065 635f 7374  _results[spec_st
+00022770: 6f72 6167 655f 6b65 795d 203d 207b 7d0a  orage_key] = {}.
+00022780: 2020 2020 2020 2020 7365 6c66 2e5f 6669          self._fi
+00022790: 745f 7265 7375 6c74 735b 7370 6563 5f73  t_results[spec_s
+000227a0: 746f 7261 6765 5f6b 6579 5d5b 6d6f 6465  torage_key][mode
+000227b0: 6c5d 203d 206d 6f64 5f72 6573 0a0a 2020  l] = mod_res..  
+000227c0: 2020 2020 2020 2320 416e 6420 6e6f 7720        # And now 
+000227d0: 7374 6f72 696e 6720 7468 6520 6c75 6d69  storing the lumi
+000227e0: 6e6f 7369 7479 2072 6573 756c 7473 0a20  nosity results. 
+000227f0: 2020 2020 2020 2069 6620 7370 6563 5f73         if spec_s
+00022800: 746f 7261 6765 5f6b 6579 206e 6f74 2069  torage_key not i
+00022810: 6e20 7365 6c66 2e5f 6c75 6d69 6e6f 7369  n self._luminosi
+00022820: 7469 6573 3a0a 2020 2020 2020 2020 2020  ties:.          
+00022830: 2020 7365 6c66 2e5f 6c75 6d69 6e6f 7369    self._luminosi
+00022840: 7469 6573 5b73 7065 635f 7374 6f72 6167  ties[spec_storag
+00022850: 655f 6b65 795d 203d 207b 7d0a 2020 2020  e_key] = {}.    
+00022860: 2020 2020 7365 6c66 2e5f 6c75 6d69 6e6f      self._lumino
+00022870: 7369 7469 6573 5b73 7065 635f 7374 6f72  sities[spec_stor
+00022880: 6167 655f 6b65 795d 5b6d 6f64 656c 5d20  age_key][model] 
+00022890: 3d20 6c75 6d73 0a0a 2020 2020 6465 6620  = lums..    def 
+000228a0: 6765 745f 7265 7375 6c74 7328 7365 6c66  get_results(self
+000228b0: 2c20 6f75 7465 725f 7261 6469 7573 3a20  , outer_radius: 
+000228c0: 556e 696f 6e5b 7374 722c 2051 7561 6e74  Union[str, Quant
+000228d0: 6974 795d 2c20 6d6f 6465 6c3a 2073 7472  ity], model: str
+000228e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000228f0: 2020 2020 2020 696e 6e65 725f 7261 6469        inner_radi
+00022900: 7573 3a20 556e 696f 6e5b 7374 722c 2051  us: Union[str, Q
+00022910: 7561 6e74 6974 795d 203d 2051 7561 6e74  uantity] = Quant
+00022920: 6974 7928 302c 2027 6172 6373 6563 2729  ity(0, 'arcsec')
+00022930: 2c20 7061 723a 2073 7472 203d 204e 6f6e  , par: str = Non
+00022940: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00022950: 2020 2020 2020 2067 726f 7570 5f73 7065         group_spe
+00022960: 633a 2062 6f6f 6c20 3d20 5472 7565 2c20  c: bool = True, 
+00022970: 6d69 6e5f 636f 756e 7473 3a20 696e 7420  min_counts: int 
+00022980: 3d20 352c 206d 696e 5f73 6e3a 2066 6c6f  = 5, min_sn: flo
+00022990: 6174 203d 204e 6f6e 652c 206f 7665 725f  at = None, over_
+000229a0: 7361 6d70 6c65 3a20 666c 6f61 7420 3d20  sample: float = 
+000229b0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+000229c0: 2222 0a20 2020 2020 2020 2049 6d70 6f72  "".        Impor
+000229d0: 7461 6e74 206d 6574 686f 6420 7468 6174  tant method that
+000229e0: 2077 696c 6c20 7265 7472 6965 7665 2066   will retrieve f
+000229f0: 6974 2072 6573 756c 7473 2066 726f 6d20  it results from 
+00022a00: 7468 6520 736f 7572 6365 206f 626a 6563  the source objec
+00022a10: 742e 2045 6974 6865 7220 666f 7220 6120  t. Either for a 
+00022a20: 7370 6563 6966 6963 0a20 2020 2020 2020  specific.       
+00022a30: 2070 6172 616d 6574 6572 206f 6620 6120   parameter of a 
+00022a40: 6769 7665 6e20 7265 6769 6f6e 2d6d 6f64  given region-mod
+00022a50: 656c 2063 6f6d 6269 6e61 7469 6f6e 2c20  el combination, 
+00022a60: 6f72 2066 6f72 2061 6c6c 206f 6620 7468  or for all of th
+00022a70: 656d 2e20 4966 2061 2073 7065 6369 6669  em. If a specifi
+00022a80: 6320 7061 7261 6d65 7465 7220 6973 2072  c parameter is r
+00022a90: 6571 7565 7374 6564 2c0a 2020 2020 2020  equested,.      
+00022aa0: 2020 616c 6c20 6d61 7463 6869 6e67 2076    all matching v
+00022ab0: 616c 7565 7320 6672 6f6d 2074 6865 2066  alues from the f
+00022ac0: 6974 2077 696c 6c20 6265 2072 6574 7572  it will be retur
+00022ad0: 6e65 6420 696e 2061 6e20 4e20 726f 772c  ned in an N row,
+00022ae0: 2033 2063 6f6c 756d 6e20 6e75 6d70 7920   3 column numpy 
+00022af0: 6172 7261 7920 2863 6f6c 756d 6e20 3020  array (column 0 
+00022b00: 6973 2074 6865 2076 616c 7565 2c0a 2020  is the value,.  
+00022b10: 2020 2020 2020 636f 6c75 6d6e 2031 2069        column 1 i
+00022b20: 7320 6572 722d 2c20 616e 6420 636f 6c75  s err-, and colu
+00022b30: 6d6e 2032 2069 7320 6572 722b 292e 2049  mn 2 is err+). I
+00022b40: 6620 6e6f 2070 6172 616d 6574 6572 2069  f no parameter i
+00022b50: 7320 7370 6563 6966 6965 642c 2074 6865  s specified, the
+00022b60: 2072 6574 7572 6e20 7769 6c6c 2062 6520   return will be 
+00022b70: 6120 6469 6374 696f 6e61 7279 0a20 2020  a dictionary.   
+00022b80: 2020 2020 206f 6620 7375 6368 206e 756d       of such num
+00022b90: 7079 2061 7272 6179 732c 2077 6974 6820  py arrays, with 
+00022ba0: 7468 6520 6b65 7973 2063 6f72 7265 7370  the keys corresp
+00022bb0: 6f6e 6469 6e67 2074 6f20 7061 7261 6d65  onding to parame
+00022bc0: 7465 7220 6e61 6d65 732e 0a0a 2020 2020  ter names...    
+00022bd0: 2020 2020 3a70 6172 616d 2073 7472 2f51      :param str/Q
+00022be0: 7561 6e74 6974 7920 6f75 7465 725f 7261  uantity outer_ra
+00022bf0: 6469 7573 3a20 5468 6520 6e61 6d65 206f  dius: The name o
+00022c00: 7220 7661 6c75 6520 6f66 2074 6865 206f  r value of the o
+00022c10: 7574 6572 2072 6164 6975 7320 7468 6174  uter radius that
+00022c20: 2077 6173 2075 7365 6420 666f 7220 7468   was used for th
+00022c30: 6520 6765 6e65 7261 7469 6f6e 206f 660a  e generation of.
+00022c40: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00022c50: 7370 6563 7472 6120 7768 6963 6820 7765  spectra which we
+00022c60: 7265 2066 6974 7465 6420 746f 2070 726f  re fitted to pro
+00022c70: 6475 6365 2074 6865 2064 6573 6972 6564  duce the desired
+00022c80: 2072 6573 756c 7420 2866 6f72 2069 6e73   result (for ins
+00022c90: 7461 6e63 6520 2772 3230 3027 2077 6f75  tance 'r200' wou
+00022ca0: 6c64 2062 6520 6163 6365 7074 6162 6c65  ld be acceptable
+00022cb0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00022cc0: 2061 2047 616c 6178 7943 6c75 7374 6572   a GalaxyCluster
+00022cd0: 2c20 6f72 2051 7561 6e74 6974 7928 3130  , or Quantity(10
+00022ce0: 3030 2c20 276b 7063 2729 292e 2049 6620  00, 'kpc')). If 
+00022cf0: 2772 6567 696f 6e27 2069 7320 6368 6f73  'region' is chos
+00022d00: 656e 2028 746f 2075 7365 2074 6865 2072  en (to use the r
+00022d10: 6567 696f 6e73 2069 6e0a 2020 2020 2020  egions in.      
+00022d20: 2020 2020 2020 7265 6769 6f6e 2066 696c        region fil
+00022d30: 6573 292c 2074 6865 6e20 616e 7920 696e  es), then any in
+00022d40: 6e65 7220 7261 6469 7573 2077 696c 6c20  ner radius will 
+00022d50: 6265 2069 676e 6f72 6564 2e0a 2020 2020  be ignored..    
+00022d60: 2020 2020 3a70 6172 616d 2073 7472 206d      :param str m
+00022d70: 6f64 656c 3a20 5468 6520 6e61 6d65 206f  odel: The name o
+00022d80: 6620 7468 6520 6669 7474 6564 206d 6f64  f the fitted mod
+00022d90: 656c 2074 6861 7420 796f 7527 7265 2072  el that you're r
+00022da0: 6571 7565 7374 696e 6720 7468 6520 7265  equesting the re
+00022db0: 7375 6c74 730a 2020 2020 2020 2020 2020  sults.          
+00022dc0: 2020 6672 6f6d 2028 652e 672e 2063 6f6e    from (e.g. con
+00022dd0: 7374 616e 742a 7462 6162 732a 6170 6563  stant*tbabs*apec
+00022de0: 292e 0a20 2020 2020 2020 203a 7061 7261  )..        :para
+00022df0: 6d20 7374 722f 5175 616e 7469 7479 2069  m str/Quantity i
+00022e00: 6e6e 6572 5f72 6164 6975 733a 2054 6865  nner_radius: The
+00022e10: 206e 616d 6520 6f72 2076 616c 7565 206f   name or value o
+00022e20: 6620 7468 6520 696e 6e65 7220 7261 6469  f the inner radi
+00022e30: 7573 2074 6861 7420 7761 7320 7573 6564  us that was used
+00022e40: 2066 6f72 2074 6865 2067 656e 6572 6174   for the generat
+00022e50: 696f 6e20 6f66 0a20 2020 2020 2020 2020  ion of.         
+00022e60: 2020 2074 6865 2073 7065 6374 7261 2077     the spectra w
+00022e70: 6869 6368 2077 6572 6520 6669 7474 6564  hich were fitted
+00022e80: 2074 6f20 7072 6f64 7563 6520 7468 6520   to produce the 
+00022e90: 6465 7369 7265 6420 7265 7375 6c74 2028  desired result (
+00022ea0: 666f 7220 696e 7374 616e 6365 2027 7235  for instance 'r5
+00022eb0: 3030 2720 776f 756c 6420 6265 2061 6363  00' would be acc
+00022ec0: 6570 7461 626c 650a 2020 2020 2020 2020  eptable.        
+00022ed0: 2020 2020 666f 7220 6120 4761 6c61 7879      for a Galaxy
+00022ee0: 436c 7573 7465 722c 206f 7220 5175 616e  Cluster, or Quan
+00022ef0: 7469 7479 2833 3030 2c20 276b 7063 2729  tity(300, 'kpc')
+00022f00: 292e 2042 7920 6465 6661 756c 7420 7468  ). By default th
+00022f10: 6973 2069 7320 7a65 726f 2061 7263 7365  is is zero arcse
+00022f20: 636f 6e64 732c 2072 6573 756c 7469 6e67  conds, resulting
+00022f30: 2069 6e20 610a 2020 2020 2020 2020 2020   in a.          
+00022f40: 2020 6369 7263 756c 6172 2073 7065 6374    circular spect
+00022f50: 7275 6d2e 0a20 2020 2020 2020 203a 7061  rum..        :pa
+00022f60: 7261 6d20 7374 7220 7061 723a 2054 6865  ram str par: The
+00022f70: 206e 616d 6520 6f66 2074 6865 2070 6172   name of the par
+00022f80: 616d 6574 6572 2079 6f75 2077 616e 7420  ameter you want 
+00022f90: 6120 7265 7375 6c74 2066 6f72 2e0a 2020  a result for..  
+00022fa0: 2020 2020 2020 3a70 6172 616d 2062 6f6f        :param boo
+00022fb0: 6c20 6772 6f75 705f 7370 6563 3a20 5768  l group_spec: Wh
+00022fc0: 6574 6865 7220 7468 6520 7370 6563 7472  ether the spectr
+00022fd0: 6120 7468 6174 2077 6572 6520 6669 7474  a that were fitt
+00022fe0: 6564 2066 6f72 2074 6865 2064 6573 6972  ed for the desir
+00022ff0: 6564 2072 6573 756c 7420 7765 7265 2067  ed result were g
+00023000: 726f 7570 6564 2e0a 2020 2020 2020 2020  rouped..        
+00023010: 3a70 6172 616d 2066 6c6f 6174 206d 696e  :param float min
+00023020: 5f63 6f75 6e74 733a 2054 6865 206d 696e  _counts: The min
+00023030: 696d 756d 2063 6f75 6e74 7320 7065 7220  imum counts per 
+00023040: 6368 616e 6e65 6c2c 2069 6620 7468 6520  channel, if the 
+00023050: 7370 6563 7472 6120 7468 6174 2077 6572  spectra that wer
+00023060: 6520 6669 7474 6564 2066 6f72 2074 6865  e fitted for the
+00023070: 0a20 2020 2020 2020 2020 2020 2064 6573  .            des
+00023080: 6972 6564 2072 6573 756c 7420 7765 7265  ired result were
+00023090: 2067 726f 7570 6564 2062 7920 6d69 6e69   grouped by mini
+000230a0: 6d75 6d20 636f 756e 7473 2e0a 2020 2020  mum counts..    
+000230b0: 2020 2020 3a70 6172 616d 2066 6c6f 6174      :param float
+000230c0: 206d 696e 5f73 6e3a 2054 6865 206d 696e   min_sn: The min
+000230d0: 696d 756d 2073 6967 6e61 6c20 746f 206e  imum signal to n
+000230e0: 6f69 7365 2070 6572 2063 6861 6e6e 656c  oise per channel
+000230f0: 2c20 6966 2074 6865 2073 7065 6374 7261  , if the spectra
+00023100: 2074 6861 7420 7765 7265 2066 6974 7465   that were fitte
+00023110: 6420 666f 7220 7468 650a 2020 2020 2020  d for the.      
+00023120: 2020 2020 2020 6465 7369 7265 6420 7265        desired re
+00023130: 7375 6c74 2077 6572 6520 6772 6f75 7065  sult were groupe
+00023140: 6420 6279 206d 696e 696d 756d 2073 6967  d by minimum sig
+00023150: 6e61 6c20 746f 206e 6f69 7365 2e0a 2020  nal to noise..  
+00023160: 2020 2020 2020 3a70 6172 616d 2066 6c6f        :param flo
+00023170: 6174 206f 7665 725f 7361 6d70 6c65 3a20  at over_sample: 
+00023180: 5468 6520 6c65 7665 6c20 6f66 206f 7665  The level of ove
+00023190: 7273 616d 706c 696e 6720 6170 706c 6965  rsampling applie
+000231a0: 6420 6f6e 2074 6865 2073 7065 6374 7261  d on the spectra
+000231b0: 2074 6861 7420 7765 7265 2066 6974 7465   that were fitte
+000231c0: 642e 0a20 2020 2020 2020 203a 7265 7475  d..        :retu
+000231d0: 726e 3a20 5468 6520 7265 7175 6573 7465  rn: The requeste
+000231e0: 6420 7265 7375 6c74 2076 616c 7565 2c20  d result value, 
+000231f0: 616e 6420 756e 6365 7274 6169 6e74 6965  and uncertaintie
+00023200: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00023210: 2020 2020 2020 2023 2046 6972 7374 2049         # First I
+00023220: 2077 616e 7420 746f 2072 6574 7269 6576   want to retriev
+00023230: 6520 7468 6520 7370 6563 7472 6120 7468  e the spectra th
+00023240: 6174 2077 6572 6520 6669 7474 6564 2074  at were fitted t
+00023250: 6f20 7072 6f64 7563 6520 7468 6520 7265  o produce the re
+00023260: 7375 6c74 2074 6865 7927 7265 206c 6f6f  sult they're loo
+00023270: 6b69 6e67 2066 6f72 2c0a 2020 2020 2020  king for,.      
+00023280: 2020 2320 2062 6563 6175 7365 2074 6865    #  because the
+00023290: 6e20 4920 6361 6e20 6a75 7374 2067 7261  n I can just gra
+000232a0: 6220 7468 6520 7374 6f72 6167 6520 6b65  b the storage ke
+000232b0: 7920 6672 6f6d 206f 6e65 206f 6620 7468  y from one of th
+000232c0: 656d 0a20 2020 2020 2020 2073 7065 6373  em.        specs
+000232d0: 203d 2073 656c 662e 6765 745f 7370 6563   = self.get_spec
+000232e0: 7472 6128 6f75 7465 725f 7261 6469 7573  tra(outer_radius
+000232f0: 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20 696e  , None, None, in
+00023300: 6e65 725f 7261 6469 7573 2c20 6772 6f75  ner_radius, grou
+00023310: 705f 7370 6563 2c20 6d69 6e5f 636f 756e  p_spec, min_coun
+00023320: 7473 2c20 6d69 6e5f 736e 2c20 6f76 6572  ts, min_sn, over
+00023330: 5f73 616d 706c 6529 0a20 2020 2020 2020  _sample).       
+00023340: 2023 2049 206a 7573 7420 7461 6b65 2074   # I just take t
+00023350: 6865 2066 6972 7374 2073 7065 6374 7275  he first spectru
+00023360: 6d20 696e 2074 6865 206c 6973 7420 6265  m in the list be
+00023370: 6361 7573 6520 7468 6520 7374 6f72 6167  cause the storag
+00023380: 6520 6b65 7920 7769 6c6c 2062 6520 7468  e key will be th
+00023390: 6520 7361 6d65 2066 6f72 2061 6c6c 206f  e same for all o
+000233a0: 6620 7468 656d 0a20 2020 2020 2020 2069  f them.        i
+000233b0: 6620 6973 696e 7374 616e 6365 2873 7065  f isinstance(spe
+000233c0: 6373 2c20 6c69 7374 293a 0a20 2020 2020  cs, list):.     
+000233d0: 2020 2020 2020 2073 746f 7261 6765 5f6b         storage_k
+000233e0: 6579 203d 2073 7065 6373 5b30 5d2e 7374  ey = specs[0].st
+000233f0: 6f72 6167 655f 6b65 790a 2020 2020 2020  orage_key.      
+00023400: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00023410: 2020 2020 7374 6f72 6167 655f 6b65 7920      storage_key 
+00023420: 3d20 7370 6563 732e 7374 6f72 6167 655f  = specs.storage_
+00023430: 6b65 790a 0a20 2020 2020 2020 2023 2042  key..        # B
+00023440: 756e 6368 206f 6620 6368 6563 6b73 2074  unch of checks t
+00023450: 6f20 6d61 6b65 2073 7572 6520 7468 6520  o make sure the 
+00023460: 7265 7175 6573 7465 6420 7265 7375 6c74  requested result
+00023470: 7320 6163 7475 616c 6c79 2065 7869 7374  s actually exist
+00023480: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00023490: 7365 6c66 2e5f 6669 745f 7265 7375 6c74  self._fit_result
+000234a0: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
+000234b0: 2020 2020 2072 6169 7365 204d 6f64 656c       raise Model
+000234c0: 4e6f 7441 7373 6f63 6961 7465 6445 7272  NotAssociatedErr
+000234d0: 6f72 2822 5468 6572 6520 6172 6520 6e6f  or("There are no
+000234e0: 2058 5350 4543 2066 6974 7320 6173 736f   XSPEC fits asso
+000234f0: 6369 6174 6564 2077 6974 6820 7b73 7d22  ciated with {s}"
+00023500: 2e66 6f72 6d61 7428 733d 7365 6c66 2e6e  .format(s=self.n
+00023510: 616d 6529 290a 2020 2020 2020 2020 656c  ame)).        el
+00023520: 6966 2073 746f 7261 6765 5f6b 6579 206e  if storage_key n
+00023530: 6f74 2069 6e20 7365 6c66 2e5f 6669 745f  ot in self._fit_
+00023540: 7265 7375 6c74 733a 0a20 2020 2020 2020  results:.       
+00023550: 2020 2020 2072 6169 7365 204d 6f64 656c       raise Model
+00023560: 4e6f 7441 7373 6f63 6961 7465 6445 7272  NotAssociatedErr
+00023570: 6f72 2822 5468 6f73 6520 7370 6563 7472  or("Those spectr
+00023580: 6120 6861 7665 206e 6f20 6173 736f 6369  a have no associ
+00023590: 6174 6564 2058 5350 4543 2066 6974 2074  ated XSPEC fit t
+000235a0: 6f20 7b73 7d22 2e66 6f72 6d61 7428 733d  o {s}".format(s=
+000235b0: 7365 6c66 2e6e 616d 6529 290a 2020 2020  self.name)).    
+000235c0: 2020 2020 656c 6966 206d 6f64 656c 206e      elif model n
+000235d0: 6f74 2069 6e20 7365 6c66 2e5f 6669 745f  ot in self._fit_
+000235e0: 7265 7375 6c74 735b 7374 6f72 6167 655f  results[storage_
+000235f0: 6b65 795d 3a0a 2020 2020 2020 2020 2020  key]:.          
+00023600: 2020 6176 5f6d 6f64 7320 3d20 222c 2022    av_mods = ", "
+00023610: 2e6a 6f69 6e28 7365 6c66 2e5f 6669 745f  .join(self._fit_
+00023620: 7265 7375 6c74 735b 7374 6f72 6167 655f  results[storage_
+00023630: 6b65 795d 2e6b 6579 7328 2929 0a20 2020  key].keys()).   
+00023640: 2020 2020 2020 2020 2072 6169 7365 204d           raise M
+00023650: 6f64 656c 4e6f 7441 7373 6f63 6961 7465  odelNotAssociate
+00023660: 6445 7272 6f72 2822 7b6d 7d20 6861 7320  dError("{m} has 
+00023670: 6e6f 7420 6265 656e 2066 6974 7465 6420  not been fitted 
+00023680: 746f 2074 686f 7365 2073 7065 6374 7261  to those spectra
+00023690: 206f 6620 7b73 7d3b 2061 7661 696c 6162   of {s}; availab
+000236a0: 6c65 2022 0a20 2020 2020 2020 2020 2020  le ".           
 000236b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000236c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000236d0: 2020 2022 7468 6520 6f70 7469 6f6e 7320     "the options 
-000236e0: 6172 6520 7b61 7d22 2e66 6f72 6d61 7428  are {a}".format(
-000236f0: 703d 7061 722c 206d 3d6d 6f64 656c 2c20  p=par, m=model, 
-00023700: 733d 7365 6c66 2e6e 616d 652c 2061 3d61  s=self.name, a=a
-00023710: 765f 7061 7273 2929 0a0a 2020 2020 2020  v_pars))..      
-00023720: 2020 2320 5265 6164 206f 7574 2069 6e74    # Read out int
-00023730: 6f20 7661 7269 6162 6c65 2066 6f72 2072  o variable for r
-00023740: 6561 6461 6269 6c69 7469 6573 2073 616b  eadabilities sak
-00023750: 650a 2020 2020 2020 2020 6669 745f 6461  e.        fit_da
-00023760: 7461 203d 2073 656c 662e 5f66 6974 5f72  ta = self._fit_r
-00023770: 6573 756c 7473 5b73 746f 7261 6765 5f6b  esults[storage_k
-00023780: 6579 5d5b 6d6f 6465 6c5d 0a20 2020 2020  ey][model].     
-00023790: 2020 2070 726f 635f 6461 7461 203d 207b     proc_data = {
-000237a0: 7d20 2023 2057 6865 7265 2074 6865 206f  }  # Where the o
-000237b0: 7574 7075 7420 7769 6c6c 2069 7665 0a20  utput will ive. 
-000237c0: 2020 2020 2020 2066 6f72 2070 5f6b 6579         for p_key
-000237d0: 2069 6e20 6669 745f 6461 7461 3a0a 2020   in fit_data:.  
-000237e0: 2020 2020 2020 2020 2020 2320 5573 6564            # Used
-000237f0: 2074 6f20 7368 6170 6520 7468 6520 6e75   to shape the nu
-00023800: 6d70 7920 6172 7261 7920 7468 6520 6461  mpy array the da
-00023810: 7461 2069 7320 7472 616e 7366 6572 7265  ta is transferre
-00023820: 6420 696e 746f 0a20 2020 2020 2020 2020  d into.         
-00023830: 2020 206e 756d 5f65 6e74 7269 6573 203d     num_entries =
-00023840: 206c 656e 2866 6974 5f64 6174 615b 705f   len(fit_data[p_
-00023850: 6b65 795d 290a 2020 2020 2020 2020 2020  key]).          
-00023860: 2020 2320 2745 6d70 7479 2720 6e65 7720    # 'Empty' new 
-00023870: 6172 7261 7920 746f 2077 7269 7465 206f  array to write o
-00023880: 7574 2074 6865 2072 6573 756c 7473 2069  ut the results i
-00023890: 6e74 6f2c 2064 6f6e 6520 6c69 6b65 2074  nto, done like t
-000238a0: 6869 7320 6265 6361 7573 6520 7265 7375  his because resu
-000238b0: 6c74 7320 6172 6520 7374 6f72 6564 0a20  lts are stored. 
-000238c0: 2020 2020 2020 2020 2020 2023 2020 696e             #  in
-000238d0: 206e 6573 7465 6420 6469 6374 696f 6e61   nested dictiona
-000238e0: 7269 6573 2077 6974 6820 7468 6569 7220  ries with their 
-000238f0: 5853 5045 4320 7061 7261 6d65 7465 7220  XSPEC parameter 
-00023900: 6e75 6d62 6572 2061 7320 616e 2065 7874  number as an ext
-00023910: 7261 206b 6579 0a20 2020 2020 2020 2020  ra key.         
-00023920: 2020 206e 6577 5f64 6174 6120 3d20 6e70     new_data = np
-00023930: 2e7a 6572 6f73 2828 6e75 6d5f 656e 7472  .zeros((num_entr
-00023940: 6965 732c 2033 2929 0a0a 2020 2020 2020  ies, 3))..      
-00023950: 2020 2020 2020 2320 4966 2061 2070 6172        # If a par
-00023960: 616d 6574 6572 2069 7320 756e 6c69 6e6b  ameter is unlink
-00023970: 6564 2069 6e20 6120 6669 7420 7769 7468  ed in a fit with
-00023980: 206d 756c 7469 706c 6520 7370 6563 7472   multiple spectr
-00023990: 6120 286c 696b 6520 6e6f 726d 616c 6973  a (like normalis
-000239a0: 6174 696f 6e20 666f 7220 696e 7374 616e  ation for instan
-000239b0: 6365 292c 0a20 2020 2020 2020 2020 2020  ce),.           
-000239c0: 2023 2020 7468 6572 6520 6361 6e20 6265   #  there can be
-000239d0: 204e 2065 6e74 7269 6573 2066 6f72 2074   N entries for t
-000239e0: 6865 2073 616d 6520 7061 7261 6d65 7465  he same paramete
-000239f0: 722c 2077 7269 7469 6e67 2074 6865 6d20  r, writing them 
-00023a00: 6f75 7420 696e 206f 7264 6572 2074 6f20  out in order to 
-00023a10: 6120 6e75 6d70 7920 6172 7261 790a 2020  a numpy array.  
-00023a20: 2020 2020 2020 2020 2020 666f 7220 696e            for in
-00023a30: 6372 2c20 7061 725f 696e 6465 7820 696e  cr, par_index in
-00023a40: 2065 6e75 6d65 7261 7465 2866 6974 5f64   enumerate(fit_d
-00023a50: 6174 615b 705f 6b65 795d 293a 0a20 2020  ata[p_key]):.   
-00023a60: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00023a70: 5f64 6174 615b 696e 6372 2c20 3a5d 203d  _data[incr, :] =
-00023a80: 2066 6974 5f64 6174 615b 705f 6b65 795d   fit_data[p_key]
-00023a90: 5b70 6172 5f69 6e64 6578 5d0a 0a20 2020  [par_index]..   
-00023aa0: 2020 2020 2020 2020 2023 204a 7573 7420           # Just 
-00023ab0: 6d61 6b65 7320 7468 6520 6f75 7470 7574  makes the output
-00023ac0: 2061 206c 6974 746c 6520 6e69 6365 7220   a little nicer 
-00023ad0: 6966 2074 6865 7265 2069 7320 6f6e 6c79  if there is only
-00023ae0: 206f 6e65 2065 6e74 7279 0a20 2020 2020   one entry.     
-00023af0: 2020 2020 2020 2069 6620 6e65 775f 6461         if new_da
-00023b00: 7461 2e73 6861 7065 5b30 5d20 3d3d 2031  ta.shape[0] == 1
-00023b10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023b20: 2020 7072 6f63 5f64 6174 615b 705f 6b65    proc_data[p_ke
-00023b30: 795d 203d 206e 6577 5f64 6174 615b 305d  y] = new_data[0]
-00023b40: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00023b50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00023b60: 2020 2070 726f 635f 6461 7461 5b70 5f6b     proc_data[p_k
-00023b70: 6579 5d20 3d20 6e65 775f 6461 7461 0a0a  ey] = new_data..
-00023b80: 2020 2020 2020 2020 2320 4966 206e 6f20          # If no 
-00023b90: 7370 6563 6966 6963 2070 6172 616d 6574  specific paramet
-00023ba0: 6572 2077 6173 2072 6571 7565 7374 6564  er was requested
-00023bb0: 2c20 7468 6520 7573 6572 2067 6574 7320  , the user gets 
-00023bc0: 616c 6c20 6f66 2074 6865 6d0a 2020 2020  all of them.    
-00023bd0: 2020 2020 6966 2070 6172 2069 7320 4e6f      if par is No
-00023be0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00023bf0: 7265 7475 726e 2070 726f 635f 6461 7461  return proc_data
-00023c00: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00023c10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00023c20: 6e20 7072 6f63 5f64 6174 615b 7061 725d  n proc_data[par]
-00023c30: 0a0a 2020 2020 6465 6620 6765 745f 6c75  ..    def get_lu
-00023c40: 6d69 6e6f 7369 7469 6573 2873 656c 662c  minosities(self,
-00023c50: 206f 7574 6572 5f72 6164 6975 733a 2055   outer_radius: U
-00023c60: 6e69 6f6e 5b73 7472 2c20 5175 616e 7469  nion[str, Quanti
-00023c70: 7479 5d2c 206d 6f64 656c 3a20 7374 722c  ty], model: str,
-00023c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023c90: 2020 2020 2020 2020 2020 696e 6e65 725f            inner_
-00023ca0: 7261 6469 7573 3a20 556e 696f 6e5b 7374  radius: Union[st
-00023cb0: 722c 2051 7561 6e74 6974 795d 203d 2051  r, Quantity] = Q
-00023cc0: 7561 6e74 6974 7928 302c 2027 6172 6373  uantity(0, 'arcs
-00023cd0: 6563 2729 2c20 6c6f 5f65 6e3a 2051 7561  ec'), lo_en: Qua
-00023ce0: 6e74 6974 7920 3d20 4e6f 6e65 2c0a 2020  ntity = None,.  
-00023cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d00: 2020 2020 2020 2068 695f 656e 3a20 5175         hi_en: Qu
-00023d10: 616e 7469 7479 203d 204e 6f6e 652c 2067  antity = None, g
-00023d20: 726f 7570 5f73 7065 633a 2062 6f6f 6c20  roup_spec: bool 
-00023d30: 3d20 5472 7565 2c20 6d69 6e5f 636f 756e  = True, min_coun
-00023d40: 7473 3a20 696e 7420 3d20 352c 206d 696e  ts: int = 5, min
-00023d50: 5f73 6e3a 2066 6c6f 6174 203d 204e 6f6e  _sn: float = Non
-00023d60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00023d70: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-00023d80: 5f73 616d 706c 653a 2066 6c6f 6174 203d  _sample: float =
-00023d90: 204e 6f6e 6529 3a0a 2020 2020 2020 2020   None):.        
-00023da0: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-00023db0: 6d65 7468 6f64 2066 6f72 206c 756d 696e  method for lumin
-00023dc0: 6f73 6974 6965 7320 6361 6c63 756c 6174  osities calculat
-00023dd0: 6564 2066 726f 6d20 6d6f 6465 6c20 6669  ed from model fi
-00023de0: 7473 2074 6f20 7370 6563 7472 6120 6173  ts to spectra as
-00023df0: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
-00023e00: 6973 2073 6f75 7263 652e 0a20 2020 2020  is source..     
-00023e10: 2020 2045 6974 6865 7220 666f 7220 6769     Either for gi
-00023e20: 7665 6e20 656e 6572 6779 206c 696d 6974  ven energy limit
-00023e30: 7320 2874 6861 7420 6d75 7374 2068 6176  s (that must hav
-00023e40: 6520 6265 656e 2073 7065 6369 6669 6564  e been specified
-00023e50: 2077 6865 6e20 7468 6520 6669 7420 7761   when the fit wa
-00023e60: 7320 6669 7273 7420 7065 7266 6f72 6d65  s first performe
-00023e70: 6429 2c20 6f72 0a20 2020 2020 2020 2066  d), or.        f
-00023e80: 6f72 2061 6c6c 206c 756d 696e 6f73 6974  or all luminosit
-00023e90: 6965 7320 6173 736f 6369 6174 6564 2077  ies associated w
-00023ea0: 6974 6820 7468 6174 206d 6f64 656c 2e20  ith that model. 
-00023eb0: 4c75 6d69 6e6f 7369 7469 6573 2061 7265  Luminosities are
-00023ec0: 2072 6574 7572 6e65 6420 6173 2061 2033   returned as a 3
-00023ed0: 2063 6f6c 756d 6e20 6e75 6d70 7920 6172   column numpy ar
-00023ee0: 7261 793b 0a20 2020 2020 2020 2074 6865  ray;.        the
-00023ef0: 2030 7468 2063 6f6c 756d 6e20 6973 2074   0th column is t
-00023f00: 6865 2076 616c 7565 2c20 7468 6520 3173  he value, the 1s
-00023f10: 7420 636f 6c75 6d6e 2069 7320 7468 6520  t column is the 
-00023f20: 6572 722d 2c20 616e 6420 7468 6520 326e  err-, and the 2n
-00023f30: 6420 6973 2065 7272 2b2e 0a0a 2020 2020  d is err+...    
-00023f40: 2020 2020 3a70 6172 616d 2073 7472 2f51      :param str/Q
-00023f50: 7561 6e74 6974 7920 6f75 7465 725f 7261  uantity outer_ra
-00023f60: 6469 7573 3a20 5468 6520 6e61 6d65 206f  dius: The name o
-00023f70: 7220 7661 6c75 6520 6f66 2074 6865 206f  r value of the o
-00023f80: 7574 6572 2072 6164 6975 7320 7468 6174  uter radius that
-00023f90: 2077 6173 2075 7365 6420 666f 7220 7468   was used for th
-00023fa0: 6520 6765 6e65 7261 7469 6f6e 206f 660a  e generation of.
-00023fb0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00023fc0: 7370 6563 7472 6120 7768 6963 6820 7765  spectra which we
-00023fd0: 7265 2066 6974 7465 6420 746f 2070 726f  re fitted to pro
-00023fe0: 6475 6365 2074 6865 2064 6573 6972 6564  duce the desired
-00023ff0: 2072 6573 756c 7420 2866 6f72 2069 6e73   result (for ins
-00024000: 7461 6e63 6520 2772 3230 3027 2077 6f75  tance 'r200' wou
-00024010: 6c64 2062 6520 6163 6365 7074 6162 6c65  ld be acceptable
-00024020: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00024030: 2061 2047 616c 6178 7943 6c75 7374 6572   a GalaxyCluster
-00024040: 2c20 6f72 2051 7561 6e74 6974 7928 3130  , or Quantity(10
-00024050: 3030 2c20 276b 7063 2729 292e 2049 6620  00, 'kpc')). If 
-00024060: 2772 6567 696f 6e27 2069 7320 6368 6f73  'region' is chos
-00024070: 656e 2028 746f 2075 7365 2074 6865 2072  en (to use the r
-00024080: 6567 696f 6e73 2069 6e0a 2020 2020 2020  egions in.      
-00024090: 2020 2020 2020 7265 6769 6f6e 2066 696c        region fil
-000240a0: 6573 292c 2074 6865 6e20 616e 7920 696e  es), then any in
-000240b0: 6e65 7220 7261 6469 7573 2077 696c 6c20  ner radius will 
-000240c0: 6265 2069 676e 6f72 6564 2e0a 2020 2020  be ignored..    
-000240d0: 2020 2020 3a70 6172 616d 2073 7472 206d      :param str m
-000240e0: 6f64 656c 3a20 5468 6520 6e61 6d65 206f  odel: The name o
-000240f0: 6620 7468 6520 6669 7474 6564 206d 6f64  f the fitted mod
-00024100: 656c 2074 6861 7420 796f 7527 7265 2072  el that you're r
-00024110: 6571 7565 7374 696e 6720 7468 6520 6c75  equesting the lu
-00024120: 6d69 6e6f 7369 7469 6573 0a20 2020 2020  minosities.     
-00024130: 2020 2020 2020 2066 726f 6d20 2865 2e67         from (e.g
-00024140: 2e20 636f 6e73 7461 6e74 2a74 6261 6273  . constant*tbabs
-00024150: 2a61 7065 6329 2e0a 2020 2020 2020 2020  *apec)..        
-00024160: 3a70 6172 616d 2073 7472 2f51 7561 6e74  :param str/Quant
-00024170: 6974 7920 696e 6e65 725f 7261 6469 7573  ity inner_radius
-00024180: 3a20 5468 6520 6e61 6d65 206f 7220 7661  : The name or va
-00024190: 6c75 6520 6f66 2074 6865 2069 6e6e 6572  lue of the inner
-000241a0: 2072 6164 6975 7320 7468 6174 2077 6173   radius that was
-000241b0: 2075 7365 6420 666f 7220 7468 6520 6765   used for the ge
-000241c0: 6e65 7261 7469 6f6e 206f 660a 2020 2020  neration of.    
-000241d0: 2020 2020 2020 2020 7468 6520 7370 6563          the spec
-000241e0: 7472 6120 7768 6963 6820 7765 7265 2066  tra which were f
-000241f0: 6974 7465 6420 746f 2070 726f 6475 6365  itted to produce
-00024200: 2074 6865 2064 6573 6972 6564 2072 6573   the desired res
-00024210: 756c 7420 2866 6f72 2069 6e73 7461 6e63  ult (for instanc
-00024220: 6520 2772 3530 3027 2077 6f75 6c64 2062  e 'r500' would b
-00024230: 6520 6163 6365 7074 6162 6c65 0a20 2020  e acceptable.   
-00024240: 2020 2020 2020 2020 2066 6f72 2061 2047           for a G
-00024250: 616c 6178 7943 6c75 7374 6572 2c20 6f72  alaxyCluster, or
-00024260: 2051 7561 6e74 6974 7928 3330 302c 2027   Quantity(300, '
-00024270: 6b70 6327 2929 2e20 4279 2064 6566 6175  kpc')). By defau
-00024280: 6c74 2074 6869 7320 6973 207a 6572 6f20  lt this is zero 
-00024290: 6172 6373 6563 6f6e 6473 2c20 7265 7375  arcseconds, resu
-000242a0: 6c74 696e 6720 696e 2061 0a20 2020 2020  lting in a.     
-000242b0: 2020 2020 2020 2063 6972 6375 6c61 7220         circular 
-000242c0: 7370 6563 7472 756d 2e0a 2020 2020 2020  spectrum..      
-000242d0: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
-000242e0: 7920 6c6f 5f65 6e3a 2054 6865 206c 6f77  y lo_en: The low
-000242f0: 6572 2065 6e65 7267 7920 6c69 6d69 7420  er energy limit 
-00024300: 666f 7220 7468 6520 6465 7369 7265 6420  for the desired 
-00024310: 6c75 6d69 6e6f 7369 7479 206d 6561 7375  luminosity measu
-00024320: 7265 6d65 6e74 2e0a 2020 2020 2020 2020  rement..        
-00024330: 3a70 6172 616d 2051 7561 6e74 6974 7920  :param Quantity 
-00024340: 6869 5f65 6e3a 2054 6865 2075 7070 6572  hi_en: The upper
-00024350: 2065 6e65 7267 7920 6c69 6d69 7420 666f   energy limit fo
-00024360: 7220 7468 6520 6465 7369 7265 6420 6c75  r the desired lu
-00024370: 6d69 6e6f 7369 7479 206d 6561 7375 7265  minosity measure
-00024380: 6d65 6e74 2e0a 2020 2020 2020 2020 3a70  ment..        :p
-00024390: 6172 616d 2062 6f6f 6c20 6772 6f75 705f  aram bool group_
-000243a0: 7370 6563 3a20 5768 6574 6865 7220 7468  spec: Whether th
-000243b0: 6520 7370 6563 7472 6120 7468 6174 2077  e spectra that w
-000243c0: 6572 6520 6669 7474 6564 2066 6f72 2074  ere fitted for t
-000243d0: 6865 2064 6573 6972 6564 2072 6573 756c  he desired resul
-000243e0: 7420 7765 7265 2067 726f 7570 6564 2e0a  t were grouped..
-000243f0: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-00024400: 6c6f 6174 206d 696e 5f63 6f75 6e74 733a  loat min_counts:
-00024410: 2054 6865 206d 696e 696d 756d 2063 6f75   The minimum cou
-00024420: 6e74 7320 7065 7220 6368 616e 6e65 6c2c  nts per channel,
-00024430: 2069 6620 7468 6520 7370 6563 7472 6120   if the spectra 
-00024440: 7468 6174 2077 6572 6520 6669 7474 6564  that were fitted
-00024450: 2066 6f72 2074 6865 0a20 2020 2020 2020   for the.       
-00024460: 2020 2020 2064 6573 6972 6564 2072 6573       desired res
-00024470: 756c 7420 7765 7265 2067 726f 7570 6564  ult were grouped
-00024480: 2062 7920 6d69 6e69 6d75 6d20 636f 756e   by minimum coun
-00024490: 7473 2e0a 2020 2020 2020 2020 3a70 6172  ts..        :par
-000244a0: 616d 2066 6c6f 6174 206d 696e 5f73 6e3a  am float min_sn:
-000244b0: 2054 6865 206d 696e 696d 756d 2073 6967   The minimum sig
-000244c0: 6e61 6c20 746f 206e 6f69 7365 2070 6572  nal to noise per
-000244d0: 2063 6861 6e6e 656c 2c20 6966 2074 6865   channel, if the
-000244e0: 2073 7065 6374 7261 2074 6861 7420 7765   spectra that we
-000244f0: 7265 2066 6974 7465 6420 666f 7220 7468  re fitted for th
-00024500: 650a 2020 2020 2020 2020 2020 2020 6465  e.            de
-00024510: 7369 7265 6420 7265 7375 6c74 2077 6572  sired result wer
-00024520: 6520 6772 6f75 7065 6420 6279 206d 696e  e grouped by min
-00024530: 696d 756d 2073 6967 6e61 6c20 746f 206e  imum signal to n
-00024540: 6f69 7365 2e0a 2020 2020 2020 2020 3a70  oise..        :p
-00024550: 6172 616d 2066 6c6f 6174 206f 7665 725f  aram float over_
-00024560: 7361 6d70 6c65 3a20 5468 6520 6c65 7665  sample: The leve
-00024570: 6c20 6f66 206f 7665 7273 616d 706c 696e  l of oversamplin
-00024580: 6720 6170 706c 6965 6420 6f6e 2074 6865  g applied on the
-00024590: 2073 7065 6374 7261 2074 6861 7420 7765   spectra that we
-000245a0: 7265 2066 6974 7465 642e 0a20 2020 2020  re fitted..     
-000245b0: 2020 203a 7265 7475 726e 3a20 5468 6520     :return: The 
-000245c0: 7265 7175 6573 7465 6420 6c75 6d69 6e6f  requested lumino
-000245d0: 7369 7479 2076 616c 7565 2c20 616e 6420  sity value, and 
-000245e0: 756e 6365 7274 6169 6e74 6965 732e 0a20  uncertainties.. 
-000245f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00024600: 2020 2023 2046 6972 7374 2049 2077 616e     # First I wan
-00024610: 7420 746f 2072 6574 7269 6576 6520 7468  t to retrieve th
-00024620: 6520 7370 6563 7472 6120 7468 6174 2077  e spectra that w
-00024630: 6572 6520 6669 7474 6564 2074 6f20 7072  ere fitted to pr
-00024640: 6f64 7563 6520 7468 6520 7265 7375 6c74  oduce the result
-00024650: 2074 6865 7927 7265 206c 6f6f 6b69 6e67   they're looking
-00024660: 2066 6f72 2c0a 2020 2020 2020 2020 2320   for,.        # 
-00024670: 2062 6563 6175 7365 2074 6865 6e20 4920   because then I 
-00024680: 6361 6e20 6a75 7374 2067 7261 6220 7468  can just grab th
-00024690: 6520 7374 6f72 6167 6520 6b65 7920 6672  e storage key fr
-000246a0: 6f6d 206f 6e65 206f 6620 7468 656d 0a20  om one of them. 
-000246b0: 2020 2020 2020 2073 7065 6373 203d 2073         specs = s
-000246c0: 656c 662e 6765 745f 7370 6563 7472 6128  elf.get_spectra(
-000246d0: 6f75 7465 725f 7261 6469 7573 2c20 4e6f  outer_radius, No
-000246e0: 6e65 2c20 4e6f 6e65 2c20 696e 6e65 725f  ne, None, inner_
-000246f0: 7261 6469 7573 2c20 6772 6f75 705f 7370  radius, group_sp
-00024700: 6563 2c20 6d69 6e5f 636f 756e 7473 2c20  ec, min_counts, 
-00024710: 6d69 6e5f 736e 2c20 6f76 6572 5f73 616d  min_sn, over_sam
-00024720: 706c 6529 0a20 2020 2020 2020 2023 2049  ple).        # I
-00024730: 206a 7573 7420 7461 6b65 2074 6865 2066   just take the f
-00024740: 6972 7374 2073 7065 6374 7275 6d20 696e  irst spectrum in
-00024750: 2074 6865 206c 6973 7420 6265 6361 7573   the list becaus
-00024760: 6520 7468 6520 7374 6f72 6167 6520 6b65  e the storage ke
-00024770: 7920 7769 6c6c 2062 6520 7468 6520 7361  y will be the sa
-00024780: 6d65 2066 6f72 2061 6c6c 206f 6620 7468  me for all of th
-00024790: 656d 0a20 2020 2020 2020 2069 6620 6973  em.        if is
-000247a0: 696e 7374 616e 6365 2873 7065 6373 2c20  instance(specs, 
-000247b0: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-000247c0: 2020 2073 746f 7261 6765 5f6b 6579 203d     storage_key =
-000247d0: 2073 7065 6373 5b30 5d2e 7374 6f72 6167   specs[0].storag
-000247e0: 655f 6b65 790a 2020 2020 2020 2020 656c  e_key.        el
-000247f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00024800: 7374 6f72 6167 655f 6b65 7920 3d20 7370  storage_key = sp
-00024810: 6563 732e 7374 6f72 6167 655f 6b65 790a  ecs.storage_key.
-00024820: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-00024830: 696e 6720 7468 6520 696e 7075 7420 656e  ing the input en
-00024840: 6572 6779 206c 696d 6974 7320 6172 6520  ergy limits are 
-00024850: 7661 6c69 642c 2061 6e64 2061 7373 656d  valid, and assem
-00024860: 626c 6573 2074 6865 206b 6579 2074 6f20  bles the key to 
-00024870: 6c6f 6f6b 2066 6f72 206c 756d 7320 696e  look for lums in
-00024880: 2074 686f 7365 2065 6e65 7267 790a 2020   those energy.  
-00024890: 2020 2020 2020 2320 2062 6f75 6e64 732e        #  bounds.
-000248a0: 2049 6620 7468 6520 6c69 6d69 7473 2061   If the limits a
-000248b0: 7265 206e 6f6e 6520 7468 656e 2073 6f20  re none then so 
-000248c0: 6973 2074 6865 2065 6e65 7267 7920 6b65  is the energy ke
-000248d0: 790a 2020 2020 2020 2020 6966 206c 6f5f  y.        if lo_
-000248e0: 656e 2069 7320 6e6f 7420 4e6f 6e65 2061  en is not None a
-000248f0: 6e64 2068 695f 656e 2069 7320 6e6f 7420  nd hi_en is not 
-00024900: 4e6f 6e65 2061 6e64 206c 6f5f 656e 203e  None and lo_en >
-00024910: 2068 695f 656e 3a0a 2020 2020 2020 2020   hi_en:.        
-00024920: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00024930: 7272 6f72 2822 5468 6520 6c6f 7720 656e  rror("The low en
-00024940: 6572 6779 206c 696d 6974 2063 616e 6e6f  ergy limit canno
-00024950: 7420 6265 2067 7265 6174 6572 2074 6861  t be greater tha
-00024960: 6e20 7468 6520 6869 6768 2065 6e65 7267  n the high energ
-00024970: 7920 6c69 6d69 7422 290a 2020 2020 2020  y limit").      
-00024980: 2020 656c 6966 206c 6f5f 656e 2069 7320    elif lo_en is 
-00024990: 6e6f 7420 4e6f 6e65 2061 6e64 2068 695f  not None and hi_
-000249a0: 656e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  en is not None:.
-000249b0: 2020 2020 2020 2020 2020 2020 656e 5f6b              en_k
-000249c0: 6579 203d 2022 626f 756e 645f 7b6c 7d2d  ey = "bound_{l}-
-000249d0: 7b75 7d22 2e66 6f72 6d61 7428 6c3d 6c6f  {u}".format(l=lo
-000249e0: 5f65 6e2e 746f 2822 6b65 5622 292e 7661  _en.to("keV").va
-000249f0: 6c75 652c 2075 3d68 695f 656e 2e74 6f28  lue, u=hi_en.to(
-00024a00: 226b 6556 2229 2e76 616c 7565 290a 2020  "keV").value).  
-00024a10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00024a20: 2020 2020 2020 2020 656e 5f6b 6579 203d          en_key =
-00024a30: 204e 6f6e 650a 0a20 2020 2020 2020 2023   None..        #
-00024a40: 2043 6865 636b 7320 7468 6174 2074 6865   Checks that the
-00024a50: 2072 6571 7565 7374 6564 2072 6567 696f   requested regio
-00024a60: 6e2c 206d 6f64 656c 2061 6e64 2065 6e65  n, model and ene
-00024a70: 7267 7920 6261 6e64 2061 6374 7561 6c6c  rgy band actuall
-00024a80: 7920 6578 6973 740a 2020 2020 2020 2020  y exist.        
-00024a90: 6966 206c 656e 2873 656c 662e 5f6c 756d  if len(self._lum
-00024aa0: 696e 6f73 6974 6965 7329 203d 3d20 303a  inosities) == 0:
-00024ab0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00024ac0: 7365 204d 6f64 656c 4e6f 7441 7373 6f63  se ModelNotAssoc
-00024ad0: 6961 7465 6445 7272 6f72 2822 5468 6572  iatedError("Ther
-00024ae0: 6520 6172 6520 6e6f 2058 5350 4543 2066  e are no XSPEC f
-00024af0: 6974 7320 6173 736f 6369 6174 6564 2077  its associated w
-00024b00: 6974 6820 7b73 7d22 2e66 6f72 6d61 7428  ith {s}".format(
-00024b10: 733d 7365 6c66 2e6e 616d 6529 290a 2020  s=self.name)).  
-00024b20: 2020 2020 2020 656c 6966 2073 746f 7261        elif stora
-00024b30: 6765 5f6b 6579 206e 6f74 2069 6e20 7365  ge_key not in se
-00024b40: 6c66 2e5f 6c75 6d69 6e6f 7369 7469 6573  lf._luminosities
-00024b50: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00024b60: 6973 6520 4d6f 6465 6c4e 6f74 4173 736f  ise ModelNotAsso
-00024b70: 6369 6174 6564 4572 726f 7228 2254 6865  ciatedError("The
-00024b80: 7365 2073 7065 6374 7261 2068 6176 6520  se spectra have 
-00024b90: 6e6f 2061 7373 6f63 6961 7465 6420 5853  no associated XS
-00024ba0: 5045 4320 6669 7420 746f 207b 737d 2e22  PEC fit to {s}."
-00024bb0: 2e66 6f72 6d61 7428 733d 7365 6c66 2e6e  .format(s=self.n
-00024bc0: 616d 6529 290a 2020 2020 2020 2020 656c  ame)).        el
-00024bd0: 6966 206d 6f64 656c 206e 6f74 2069 6e20  if model not in 
-00024be0: 7365 6c66 2e5f 6c75 6d69 6e6f 7369 7469  self._luminositi
-00024bf0: 6573 5b73 746f 7261 6765 5f6b 6579 5d3a  es[storage_key]:
-00024c00: 0a20 2020 2020 2020 2020 2020 2061 765f  .            av_
-00024c10: 6d6f 6473 203d 2022 2c20 222e 6a6f 696e  mods = ", ".join
-00024c20: 2873 656c 662e 5f6c 756d 696e 6f73 6974  (self._luminosit
-00024c30: 6965 735b 7374 6f72 6167 655f 6b65 795d  ies[storage_key]
-00024c40: 2e6b 6579 7328 2929 0a20 2020 2020 2020  .keys()).       
-00024c50: 2020 2020 2072 6169 7365 204d 6f64 656c       raise Model
-00024c60: 4e6f 7441 7373 6f63 6961 7465 6445 7272  NotAssociatedErr
-00024c70: 6f72 2822 7b6d 7d20 6861 7320 6e6f 7420  or("{m} has not 
-00024c80: 6265 656e 2066 6974 7465 6420 746f 2074  been fitted to t
-00024c90: 6865 7365 2073 7065 6374 7261 206f 6620  hese spectra of 
-00024ca0: 7b73 7d3b 2022 0a20 2020 2020 2020 2020  {s}; ".         
-00024cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024cd0: 2022 6176 6169 6c61 626c 6520 6d6f 6465   "available mode
-00024ce0: 6c73 2061 7265 207b 617d 222e 666f 726d  ls are {a}".form
-00024cf0: 6174 286d 3d6d 6f64 656c 2c20 733d 7365  at(m=model, s=se
-00024d00: 6c66 2e6e 616d 652c 2061 3d61 765f 6d6f  lf.name, a=av_mo
-00024d10: 6473 2929 0a20 2020 2020 2020 2065 6c69  ds)).        eli
-00024d20: 6620 656e 5f6b 6579 2069 7320 6e6f 7420  f en_key is not 
-00024d30: 4e6f 6e65 2061 6e64 2065 6e5f 6b65 7920  None and en_key 
-00024d40: 6e6f 7420 696e 2073 656c 662e 5f6c 756d  not in self._lum
-00024d50: 696e 6f73 6974 6965 735b 7374 6f72 6167  inosities[storag
-00024d60: 655f 6b65 795d 5b6d 6f64 656c 5d3a 0a20  e_key][model]:. 
-00024d70: 2020 2020 2020 2020 2020 2061 765f 6261             av_ba
-00024d80: 6e64 7320 3d20 222c 2022 2e6a 6f69 6e28  nds = ", ".join(
-00024d90: 5b65 6e2e 7370 6c69 7428 225f 2229 5b2d  [en.split("_")[-
-00024da0: 315d 202b 2022 6b65 5622 2066 6f72 2065  1] + "keV" for e
-00024db0: 6e20 696e 2073 656c 662e 5f6c 756d 696e  n in self._lumin
-00024dc0: 6f73 6974 6965 735b 7374 6f72 6167 655f  osities[storage_
-00024dd0: 6b65 795d 5b6d 6f64 656c 5d2e 6b65 7973  key][model].keys
-00024de0: 2829 5d29 0a20 2020 2020 2020 2020 2020  ()]).           
-00024df0: 2072 6169 7365 2050 6172 616d 6574 6572   raise Parameter
-00024e00: 4e6f 7441 7373 6f63 6961 7465 6445 7272  NotAssociatedErr
-00024e10: 6f72 2822 7b6c 7d2d 7b75 7d6b 6556 2077  or("{l}-{u}keV w
-00024e20: 6173 206e 6f74 2061 6e20 656e 6572 6779  as not an energy
-00024e30: 2062 616e 6420 666f 7220 7468 6520 6669   band for the fi
-00024e40: 7420 7769 7468 207b 6d7d 3b20 6176 6169  t with {m}; avai
-00024e50: 6c61 626c 6520 220a 2020 2020 2020 2020  lable ".        
-00024e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e80: 2020 2020 2020 2265 6e65 7267 7920 6261        "energy ba
-00024e90: 6e64 7320 6172 6520 7b62 7d22 2e66 6f72  nds are {b}".for
-00024ea0: 6d61 7428 6c3d 6c6f 5f65 6e2e 746f 2822  mat(l=lo_en.to("
-00024eb0: 6b65 5622 292e 7661 6c75 652c 0a20 2020  keV").value,.   
-00024ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f00: 2020 2020 2020 2020 2075 3d68 695f 656e           u=hi_en
-00024f10: 2e74 6f28 226b 6556 2229 2e76 616c 7565  .to("keV").value
-00024f20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00024f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f60: 2020 2020 2020 2020 2020 2020 2020 6d3d                m=
-00024f70: 6d6f 6465 6c2c 2062 3d61 765f 6261 6e64  model, b=av_band
-00024f80: 7329 290a 0a20 2020 2020 2020 2023 2049  s))..        # I
-00024f90: 6620 6e6f 206c 696d 6974 7320 7370 6563  f no limits spec
-00024fa0: 6966 6965 642c 7468 6520 7573 6572 2067  ified,the user g
-00024fb0: 6574 7320 616c 6c20 7468 6520 6c75 6d69  ets all the lumi
-00024fc0: 6e6f 7369 7469 6573 2c20 6f74 6865 7277  nosities, otherw
-00024fd0: 6973 6520 7468 6579 2067 6574 2074 6865  ise they get the
-00024fe0: 206f 6e65 2074 6865 7920 6173 6b65 6420   one they asked 
-00024ff0: 666f 720a 2020 2020 2020 2020 6966 2065  for.        if e
-00025000: 6e5f 6b65 7920 6973 204e 6f6e 653a 0a20  n_key is None:. 
-00025010: 2020 2020 2020 2020 2020 2070 6172 7365             parse
-00025020: 645f 6c75 6d73 203d 207b 7d0a 2020 2020  d_lums = {}.    
-00025030: 2020 2020 2020 2020 666f 7220 6c75 6d5f          for lum_
-00025040: 6b65 7920 696e 2073 656c 662e 5f6c 756d  key in self._lum
-00025050: 696e 6f73 6974 6965 735b 7374 6f72 6167  inosities[storag
-00025060: 655f 6b65 795d 5b6d 6f64 656c 5d3a 0a20  e_key][model]:. 
-00025070: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00025080: 756d 5f76 616c 7565 203d 2073 656c 662e  um_value = self.
-00025090: 5f6c 756d 696e 6f73 6974 6965 735b 7374  _luminosities[st
-000250a0: 6f72 6167 655f 6b65 795d 5b6d 6f64 656c  orage_key][model
-000250b0: 5d5b 6c75 6d5f 6b65 795d 0a20 2020 2020  ][lum_key].     
-000250c0: 2020 2020 2020 2020 2020 2070 6172 7365             parse
-000250d0: 645f 6c75 6d20 3d20 5175 616e 7469 7479  d_lum = Quantity
-000250e0: 285b 6c75 6d2e 7661 6c75 6520 666f 7220  ([lum.value for 
-000250f0: 6c75 6d20 696e 206c 756d 5f76 616c 7565  lum in lum_value
-00025100: 5d2c 206c 756d 5f76 616c 7565 5b30 5d2e  ], lum_value[0].
-00025110: 756e 6974 290a 2020 2020 2020 2020 2020  unit).          
-00025120: 2020 2020 2020 7061 7273 6564 5f6c 756d        parsed_lum
-00025130: 735b 6c75 6d5f 6b65 795d 203d 2070 6172  s[lum_key] = par
-00025140: 7365 645f 6c75 6d0a 2020 2020 2020 2020  sed_lum.        
-00025150: 2020 2020 7265 7475 726e 2070 6172 7365      return parse
-00025160: 645f 6c75 6d73 0a20 2020 2020 2020 2065  d_lums.        e
-00025170: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00025180: 206c 756d 5f76 616c 7565 203d 2073 656c   lum_value = sel
-00025190: 662e 5f6c 756d 696e 6f73 6974 6965 735b  f._luminosities[
-000251a0: 7374 6f72 6167 655f 6b65 795d 5b6d 6f64  storage_key][mod
-000251b0: 656c 5d5b 656e 5f6b 6579 5d0a 2020 2020  el][en_key].    
-000251c0: 2020 2020 2020 2020 7061 7273 6564 5f6c          parsed_l
-000251d0: 756d 203d 2051 7561 6e74 6974 7928 5b6c  um = Quantity([l
-000251e0: 756d 2e76 616c 7565 2066 6f72 206c 756d  um.value for lum
-000251f0: 2069 6e20 6c75 6d5f 7661 6c75 655d 2c20   in lum_value], 
-00025200: 6c75 6d5f 7661 6c75 655b 305d 2e75 6e69  lum_value[0].uni
-00025210: 7429 0a20 2020 2020 2020 2020 2020 2072  t).            r
-00025220: 6574 7572 6e20 7061 7273 6564 5f6c 756d  eturn parsed_lum
-00025230: 0a0a 2020 2020 6465 6620 636f 6e76 6572  ..    def conver
-00025240: 745f 7261 6469 7573 2873 656c 662c 2072  t_radius(self, r
-00025250: 6164 6975 733a 2051 7561 6e74 6974 792c  adius: Quantity,
-00025260: 206f 7574 5f75 6e69 743a 2055 6e69 6f6e   out_unit: Union
-00025270: 5b55 6e69 742c 2073 7472 5d20 3d20 2764  [Unit, str] = 'd
-00025280: 6567 2729 202d 3e20 5175 616e 7469 7479  eg') -> Quantity
-00025290: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000252a0: 2020 2020 2020 4120 7369 6d70 6c65 206d        A simple m
-000252b0: 6574 686f 6420 746f 2063 6f6e 7665 7274  ethod to convert
-000252c0: 2072 6164 6969 2062 6574 7765 656e 2064   radii between d
-000252d0: 6966 6665 7265 6e74 2064 6973 7461 6e63  ifferent distanc
-000252e0: 6520 756e 6974 732c 2069 7420 6175 746f  e units, it auto
-000252f0: 6d61 7469 6361 6c6c 7920 6368 6563 6b73  matically checks
-00025300: 2077 6865 7468 6572 0a20 2020 2020 2020   whether.       
-00025310: 2074 6865 2072 6571 7565 7374 6564 2063   the requested c
-00025320: 6f6e 7665 7273 696f 6e20 6973 2070 6f73  onversion is pos
-00025330: 7369 626c 652c 2067 6976 656e 2061 7661  sible, given ava
-00025340: 696c 6162 6c65 2069 6e66 6f72 6d61 7469  ilable informati
-00025350: 6f6e 2e20 466f 7220 696e 7374 616e 6365  on. For instance
-00025360: 2069 7420 776f 756c 6420 6661 696c 2069   it would fail i
-00025370: 6620 796f 750a 2020 2020 2020 2020 7265  f you.        re
-00025380: 7175 6573 7465 6420 6120 636f 6e76 6572  quested a conver
-00025390: 7369 6f6e 2066 726f 6d20 6172 6373 6563  sion from arcsec
-000253a0: 6f6e 6473 2074 6f20 6120 7072 6f70 6572  onds to a proper
-000253b0: 2064 6973 7461 6e63 6520 6966 206e 6f20   distance if no 
-000253c0: 7265 6473 6869 6674 2069 6e66 6f72 6d61  redshift informa
-000253d0: 7469 6f6e 2077 6572 6520 6176 6169 6c61  tion were availa
-000253e0: 626c 652e 0a0a 2020 2020 2020 2020 3a70  ble...        :p
-000253f0: 6172 616d 2051 7561 6e74 6974 7920 7261  aram Quantity ra
-00025400: 6469 7573 3a20 5468 6520 7261 6469 7573  dius: The radius
-00025410: 2074 6f20 636f 6e76 6572 7420 746f 2061   to convert to a
-00025420: 206e 6577 2075 6e69 742e 0a20 2020 2020   new unit..     
-00025430: 2020 203a 7061 7261 6d20 556e 6974 2f73     :param Unit/s
-00025440: 7472 206f 7574 5f75 6e69 743a 2054 6865  tr out_unit: The
-00025450: 2075 6e69 7420 746f 2063 6f6e 7665 7274   unit to convert
-00025460: 2074 6865 2069 6e70 7574 2072 6164 6975   the input radiu
-00025470: 7320 746f 2e0a 2020 2020 2020 2020 3a72  s to..        :r
-00025480: 6574 7572 6e3a 2054 6865 2063 6f6e 7665  eturn: The conve
-00025490: 7274 6564 2072 6164 6975 730a 2020 2020  rted radius.    
-000254a0: 2020 2020 3a72 7479 7065 3a20 5175 616e      :rtype: Quan
-000254b0: 7469 7479 0a20 2020 2020 2020 2022 2222  tity.        """
-000254c0: 0a20 2020 2020 2020 2023 2049 6620 6120  .        # If a 
-000254d0: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
-000254e0: 6174 696f 6e20 7761 7320 7061 7373 6564  ation was passed
-000254f0: 2c20 7765 206d 616b 6520 6974 2061 6e20  , we make it an 
-00025500: 6173 7472 6f70 7920 756e 6974 0a20 2020  astropy unit.   
-00025510: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00025520: 6365 286f 7574 5f75 6e69 742c 2073 7472  ce(out_unit, str
-00025530: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
-00025540: 7574 5f75 6e69 7420 3d20 556e 6974 286f  ut_unit = Unit(o
-00025550: 7574 5f75 6e69 7429 0a0a 2020 2020 2020  ut_unit)..      
-00025560: 2020 6966 206f 7574 5f75 6e69 742e 6973    if out_unit.is
-00025570: 5f65 7175 6976 616c 656e 7428 276b 7063  _equivalent('kpc
-00025580: 2729 2061 6e64 2073 656c 662e 5f72 6564  ') and self._red
-00025590: 7368 6966 7420 6973 204e 6f6e 653a 0a20  shift is None:. 
-000255a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000255b0: 2055 6e69 7443 6f6e 7665 7273 696f 6e45   UnitConversionE
-000255c0: 7272 6f72 2822 596f 7520 6361 6e6e 6f74  rror("You cannot
-000255d0: 2063 6f6e 7665 7274 2074 6f20 7468 6973   convert to this
-000255e0: 2075 6e69 7420 7769 7468 6f75 7420 7265   unit without re
-000255f0: 6473 6869 6674 2069 6e66 6f72 6d61 7469  dshift informati
-00025600: 6f6e 2e22 290a 0a20 2020 2020 2020 2069  on.")..        i
-00025610: 6620 7261 6469 7573 2e75 6e69 742e 6973  f radius.unit.is
-00025620: 5f65 7175 6976 616c 656e 7428 2764 6567  _equivalent('deg
-00025630: 2729 2061 6e64 206f 7574 5f75 6e69 742e  ') and out_unit.
-00025640: 6973 5f65 7175 6976 616c 656e 7428 2764  is_equivalent('d
-00025650: 6567 2729 3a0a 2020 2020 2020 2020 2020  eg'):.          
-00025660: 2020 6f75 745f 7261 6420 3d20 7261 6469    out_rad = radi
-00025670: 7573 2e74 6f28 6f75 745f 756e 6974 290a  us.to(out_unit).
-00025680: 2020 2020 2020 2020 656c 6966 2072 6164          elif rad
-00025690: 6975 732e 756e 6974 2e69 735f 6571 7569  ius.unit.is_equi
-000256a0: 7661 6c65 6e74 2827 6465 6727 2920 616e  valent('deg') an
-000256b0: 6420 6f75 745f 756e 6974 2e69 735f 6571  d out_unit.is_eq
-000256c0: 7569 7661 6c65 6e74 2827 6b70 6327 293a  uivalent('kpc'):
-000256d0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-000256e0: 5f72 6164 203d 2061 6e67 5f74 6f5f 7261  _rad = ang_to_ra
-000256f0: 6428 7261 6469 7573 2c20 7365 6c66 2e5f  d(radius, self._
-00025700: 7265 6473 6869 6674 2c20 7365 6c66 2e5f  redshift, self._
-00025710: 636f 736d 6f29 2e74 6f28 6f75 745f 756e  cosmo).to(out_un
-00025720: 6974 290a 2020 2020 2020 2020 656c 6966  it).        elif
-00025730: 2072 6164 6975 732e 756e 6974 2e69 735f   radius.unit.is_
-00025740: 6571 7569 7661 6c65 6e74 2827 6b70 6327  equivalent('kpc'
-00025750: 2920 616e 6420 6f75 745f 756e 6974 2e69  ) and out_unit.i
-00025760: 735f 6571 7569 7661 6c65 6e74 2827 6b70  s_equivalent('kp
-00025770: 6327 293a 0a20 2020 2020 2020 2020 2020  c'):.           
-00025780: 206f 7574 5f72 6164 203d 2072 6164 6975   out_rad = radiu
-00025790: 732e 746f 286f 7574 5f75 6e69 7429 0a20  s.to(out_unit). 
-000257a0: 2020 2020 2020 2065 6c69 6620 7261 6469         elif radi
-000257b0: 7573 2e75 6e69 742e 6973 5f65 7175 6976  us.unit.is_equiv
-000257c0: 616c 656e 7428 276b 7063 2729 2061 6e64  alent('kpc') and
-000257d0: 206f 7574 5f75 6e69 742e 6973 5f65 7175   out_unit.is_equ
-000257e0: 6976 616c 656e 7428 2764 6567 2729 3a0a  ivalent('deg'):.
-000257f0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-00025800: 7261 6420 3d20 7261 645f 746f 5f61 6e67  rad = rad_to_ang
-00025810: 2872 6164 6975 732c 2073 656c 662e 5f72  (radius, self._r
-00025820: 6564 7368 6966 742c 2073 656c 662e 5f63  edshift, self._c
-00025830: 6f73 6d6f 292e 746f 286f 7574 5f75 6e69  osmo).to(out_uni
-00025840: 7429 0a20 2020 2020 2020 2065 6c73 653a  t).        else:
-00025850: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00025860: 7365 2055 6e69 7443 6f6e 7665 7273 696f  se UnitConversio
-00025870: 6e45 7272 6f72 2822 4361 6e6e 6f74 2075  nError("Cannot u
-00025880: 6e64 6572 7374 616e 6420 7b7d 2061 7320  nderstand {} as 
-00025890: 6120 6469 7374 616e 6365 2075 6e69 7422  a distance unit"
-000258a0: 2e66 6f72 6d61 7428 7374 7228 6f75 745f  .format(str(out_
-000258b0: 756e 6974 2929 290a 0a20 2020 2020 2020  unit)))..       
-000258c0: 2072 6574 7572 6e20 6f75 745f 7261 640a   return out_rad.
-000258d0: 0a20 2020 2064 6566 2067 6574 5f72 6164  .    def get_rad
-000258e0: 6975 7328 7365 6c66 2c20 7261 645f 6e61  ius(self, rad_na
-000258f0: 6d65 3a20 7374 722c 206f 7574 5f75 6e69  me: str, out_uni
-00025900: 743a 2055 6e69 6f6e 5b55 6e69 742c 2073  t: Union[Unit, s
-00025910: 7472 5d20 3d20 2764 6567 2729 202d 3e20  tr] = 'deg') -> 
-00025920: 5175 616e 7469 7479 3a0a 2020 2020 2020  Quantity:.      
-00025930: 2020 2222 220a 2020 2020 2020 2020 416c    """.        Al
-00025940: 6c6f 7773 2061 2072 6164 6975 7320 6173  lows a radius as
-00025950: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
-00025960: 6973 2073 6f75 7263 6520 746f 2062 6520  is source to be 
-00025970: 7265 7472 6965 7665 6420 696e 2073 7065  retrieved in spe
-00025980: 6369 6669 6564 2064 6973 7461 6e63 6520  cified distance 
-00025990: 756e 6974 732e 204e 6f74 650a 2020 2020  units. Note.    
-000259a0: 2020 2020 7468 6174 2070 6879 7369 6361      that physica
-000259b0: 6c20 6469 7374 616e 6365 2075 6e69 7473  l distance units
-000259c0: 2073 7563 6820 6173 206b 696c 6f70 6172   such as kilopar
-000259d0: 7365 6373 206d 6179 206f 6e6c 7920 6265  secs may only be
-000259e0: 2075 7365 6420 6966 2074 6865 2073 6f75   used if the sou
-000259f0: 7263 6520 6861 730a 2020 2020 2020 2020  rce has.        
-00025a00: 7265 6473 6869 6674 2069 6e66 6f72 6d61  redshift informa
-00025a10: 7469 6f6e 2e0a 0a20 2020 2020 2020 203a  tion...        :
-00025a20: 7061 7261 6d20 7374 7220 7261 645f 6e61  param str rad_na
-00025a30: 6d65 3a20 5468 6520 6e61 6d65 206f 6620  me: The name of 
-00025a40: 7468 6520 6465 7369 7265 6420 7261 6469  the desired radi
-00025a50: 7573 2c20 7232 3030 2066 6f72 2069 6e73  us, r200 for ins
-00025a60: 7461 6e63 652e 0a20 2020 2020 2020 203a  tance..        :
-00025a70: 7061 7261 6d20 556e 6974 2f73 7472 206f  param Unit/str o
-00025a80: 7574 5f75 6e69 743a 2041 6e20 6173 7472  ut_unit: An astr
-00025a90: 6f70 7920 756e 6974 2c20 6569 7468 6572  opy unit, either
-00025aa0: 2061 2055 6e69 7420 696e 7374 616e 6365   a Unit instance
-00025ab0: 206f 7220 6120 7374 7269 6e67 0a20 2020   or a string.   
-00025ac0: 2020 2020 2020 2020 2072 6570 7265 7365           represe
-00025ad0: 6e74 6174 696f 6e2e 2044 6566 6175 6c74  ntation. Default
-00025ae0: 2069 7320 6465 6772 6565 732e 0a20 2020   is degrees..   
-00025af0: 2020 2020 203a 7265 7475 726e 3a20 5468       :return: Th
-00025b00: 6520 6465 7369 7265 6420 7261 6469 7573  e desired radius
-00025b10: 2069 6e20 7468 6520 6465 7369 7265 6420   in the desired 
-00025b20: 756e 6974 732e 0a20 2020 2020 2020 203a  units..        :
-00025b30: 7274 7970 653a 2051 7561 6e74 6974 790a  rtype: Quantity.
-00025b40: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00025b50: 2020 2020 2023 2049 6e20 6361 7365 2073       # In case s
-00025b60: 6f6d 6562 6f64 7920 7479 7065 7320 696e  omebody types in
-00025b70: 2052 3530 3020 7261 7468 6572 2074 6861   R500 rather tha
-00025b80: 6e20 7235 3030 2066 6f72 2069 6e73 7461  n r500 for insta
-00025b90: 6e63 652e 0a20 2020 2020 2020 2072 6164  nce..        rad
-00025ba0: 5f6e 616d 6520 3d20 7261 645f 6e61 6d65  _name = rad_name
-00025bb0: 2e6c 6f77 6572 2829 0a20 2020 2020 2020  .lower().       
-00025bc0: 2069 6620 7261 645f 6e61 6d65 206e 6f74   if rad_name not
-00025bd0: 2069 6e20 7365 6c66 2e5f 7261 6469 693a   in self._radii:
-00025be0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00025bf0: 7365 2056 616c 7565 4572 726f 7228 2254  se ValueError("T
-00025c00: 6865 7265 2069 7320 6e6f 207b 727d 2072  here is no {r} r
-00025c10: 6164 6975 7320 6173 736f 6369 6174 6564  adius associated
-00025c20: 2077 6974 6820 7468 6973 206f 626a 6563   with this objec
-00025c30: 742e 222e 666f 726d 6174 2872 3d72 6164  t.".format(r=rad
-00025c40: 5f6e 616d 6529 290a 0a20 2020 2020 2020  _name))..       
-00025c50: 206f 7574 5f72 6164 203d 2073 656c 662e   out_rad = self.
-00025c60: 636f 6e76 6572 745f 7261 6469 7573 2873  convert_radius(s
-00025c70: 656c 662e 5f72 6164 6969 5b72 6164 5f6e  elf._radii[rad_n
-00025c80: 616d 655d 2c20 6f75 745f 756e 6974 290a  ame], out_unit).
-00025c90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00025ca0: 6f75 745f 7261 640a 0a20 2020 2040 7072  out_rad..    @pr
-00025cb0: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
-00025cc0: 756d 5f70 6e5f 6f62 7328 7365 6c66 2920  um_pn_obs(self) 
-00025cd0: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-00025ce0: 2222 220a 2020 2020 2020 2020 4765 7474  """.        Gett
-00025cf0: 6572 206d 6574 686f 6420 7468 6174 2067  er method that g
-00025d00: 6976 6573 2074 6865 206e 756d 6265 7220  ives the number 
-00025d10: 6f66 2050 4e20 6f62 7365 7276 6174 696f  of PN observatio
-00025d20: 6e73 2e0a 0a20 2020 2020 2020 203a 7265  ns...        :re
-00025d30: 7475 726e 3a20 496e 7465 6765 7220 6e75  turn: Integer nu
-00025d40: 6d62 6572 206f 6620 504e 206f 6273 6572  mber of PN obser
-00025d50: 7661 7469 6f6e 7320 6173 736f 6369 6174  vations associat
-00025d60: 6564 2077 6974 6820 7468 6973 2073 6f75  ed with this sou
-00025d70: 7263 650a 2020 2020 2020 2020 3a72 7479  rce.        :rty
-00025d80: 7065 3a20 696e 740a 2020 2020 2020 2020  pe: int.        
-00025d90: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00025da0: 726e 206c 656e 285b 6f20 666f 7220 6f20  rn len([o for o 
-00025db0: 696e 2073 656c 662e 6f62 735f 6964 7320  in self.obs_ids 
-00025dc0: 6966 2027 706e 2720 696e 2073 656c 662e  if 'pn' in self.
-00025dd0: 5f70 726f 6475 6374 735b 6f5d 5d29 0a0a  _products[o]])..
-00025de0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00025df0: 2020 6465 6620 6e75 6d5f 6d6f 7331 5f6f    def num_mos1_o
-00025e00: 6273 2873 656c 6629 202d 3e20 696e 743a  bs(self) -> int:
-00025e10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00025e20: 2020 2020 2047 6574 7465 7220 6d65 7468       Getter meth
-00025e30: 6f64 2074 6861 7420 6769 7665 7320 7468  od that gives th
-00025e40: 6520 6e75 6d62 6572 206f 6620 4d4f 5331  e number of MOS1
-00025e50: 206f 6273 6572 7661 7469 6f6e 732e 0a0a   observations...
-00025e60: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00025e70: 2049 6e74 6567 6572 206e 756d 6265 7220   Integer number 
-00025e80: 6f66 204d 4f53 3120 6f62 7365 7276 6174  of MOS1 observat
-00025e90: 696f 6e73 2061 7373 6f63 6961 7465 6420  ions associated 
-00025ea0: 7769 7468 2074 6869 7320 736f 7572 6365  with this source
-00025eb0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-00025ec0: 2069 6e74 0a20 2020 2020 2020 2022 2222   int.        """
-00025ed0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00025ee0: 6c65 6e28 5b6f 2066 6f72 206f 2069 6e20  len([o for o in 
-00025ef0: 7365 6c66 2e6f 6273 5f69 6473 2069 6620  self.obs_ids if 
-00025f00: 276d 6f73 3127 2069 6e20 7365 6c66 2e5f  'mos1' in self._
-00025f10: 7072 6f64 7563 7473 5b6f 5d5d 290a 0a20  products[o]]).. 
-00025f20: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00025f30: 2064 6566 206e 756d 5f6d 6f73 325f 6f62   def num_mos2_ob
-00025f40: 7328 7365 6c66 2920 2d3e 2069 6e74 3a0a  s(self) -> int:.
-00025f50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00025f60: 2020 2020 4765 7474 6572 206d 6574 686f      Getter metho
-00025f70: 6420 7468 6174 2067 6976 6573 2074 6865  d that gives the
-00025f80: 206e 756d 6265 7220 6f66 204d 4f53 3220   number of MOS2 
-00025f90: 6f62 7365 7276 6174 696f 6e73 2e0a 0a20  observations... 
-00025fa0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-00025fb0: 496e 7465 6765 7220 6e75 6d62 6572 206f  Integer number o
-00025fc0: 6620 4d4f 5332 206f 6273 6572 7661 7469  f MOS2 observati
-00025fd0: 6f6e 7320 6173 736f 6369 6174 6564 2077  ons associated w
-00025fe0: 6974 6820 7468 6973 2073 6f75 7263 650a  ith this source.
-00025ff0: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-00026000: 696e 740a 2020 2020 2020 2020 2222 220a  int.        """.
-00026010: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-00026020: 656e 285b 6f20 666f 7220 6f20 696e 2073  en([o for o in s
-00026030: 656c 662e 6f62 735f 6964 7320 6966 2027  elf.obs_ids if '
-00026040: 6d6f 7332 2720 696e 2073 656c 662e 5f70  mos2' in self._p
-00026050: 726f 6475 6374 735b 6f5d 5d29 0a0a 2020  roducts[o]])..  
-00026060: 2020 2320 4173 2074 6869 7320 6973 2061    # As this is a
-00026070: 6e20 696e 7472 696e 7369 6320 7072 6f70  n intrinsic prop
-00026080: 6572 7479 206f 6620 7768 6963 6820 6d61  erty of which ma
-00026090: 7463 6865 6420 6f62 7365 7276 6174 696f  tched observatio
-000260a0: 6e73 2061 7265 2076 616c 6964 2c20 7468  ns are valid, th
-000260b0: 6572 6520 7769 6c6c 2062 6520 6e6f 2073  ere will be no s
-000260c0: 6574 7465 720a 2020 2020 4070 726f 7065  etter.    @prope
-000260d0: 7274 790a 2020 2020 6465 6620 696e 7374  rty.    def inst
-000260e0: 7275 6d65 6e74 7328 7365 6c66 2920 2d3e  ruments(self) ->
-000260f0: 2044 6963 743a 0a20 2020 2020 2020 2022   Dict:.        "
-00026100: 2222 0a20 2020 2020 2020 2041 2070 726f  "".        A pro
-00026110: 7065 7274 7920 6f66 2061 2073 6f75 7263  perty of a sourc
-00026120: 6520 7468 6174 2064 6574 6169 6c73 2077  e that details w
-00026130: 6869 6368 2069 6e73 7472 756d 656e 7473  hich instruments
-00026140: 2068 6176 6520 7661 6c69 6420 6461 7461   have valid data
-00026150: 2066 6f72 2077 6869 6368 206f 6273 6572   for which obser
-00026160: 7661 7469 6f6e 732e 0a0a 2020 2020 2020  vations...      
-00026170: 2020 3a72 6574 7572 6e3a 2041 2064 6963    :return: A dic
-00026180: 7469 6f6e 6172 7920 6f66 204f 6273 4944  tionary of ObsID
-00026190: 7320 616e 6420 7468 6569 7220 6173 736f  s and their asso
-000261a0: 6369 6174 6564 2076 616c 6964 2069 6e73  ciated valid ins
-000261b0: 7472 756d 656e 7473 2e0a 2020 2020 2020  truments..      
-000261c0: 2020 3a72 7479 7065 3a20 4469 6374 0a20    :rtype: Dict. 
-000261d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000261e0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000261f0: 696e 7374 7275 6d65 6e74 730a 0a20 2020  instruments..   
-00026200: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00026210: 6566 2064 6973 6173 736f 6369 6174 6564  ef disassociated
-00026220: 2873 656c 6629 202d 3e20 626f 6f6c 3a0a  (self) -> bool:.
-00026230: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00026240: 2020 2020 5072 6f70 6572 7479 2074 6861      Property tha
-00026250: 7420 6465 7363 7269 6265 7320 7768 6574  t describes whet
-00026260: 6865 7220 7468 6973 2073 6f75 7263 6520  her this source 
-00026270: 6861 7320 6861 6420 4f62 7349 4473 2064  has had ObsIDs d
-00026280: 6973 6173 736f 6369 6174 6564 2066 726f  isassociated fro
-00026290: 6d20 6974 2e0a 0a20 2020 2020 2020 203a  m it...        :
-000262a0: 7265 7475 726e 3a20 4120 626f 6f6c 6561  return: A boolea
-000262b0: 6e20 666c 6167 2c20 5472 7565 206d 6561  n flag, True mea
-000262c0: 6e73 2074 6861 7420 4f62 7349 4473 2f69  ns that ObsIDs/i
-000262d0: 6e73 7472 756d 656e 7473 2068 6176 6520  nstruments have 
-000262e0: 6265 656e 2072 656d 6f76 6564 2c20 4661  been removed, Fa
-000262f0: 6c73 6520 6d65 616e 7320 7468 6579 2068  lse means they h
-00026300: 6176 656e 2774 2e0a 2020 2020 2020 2020  aven't..        
-00026310: 3a72 7479 7065 3a20 626f 6f6c 0a20 2020  :rtype: bool.   
-00026320: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00026330: 2072 6574 7572 6e20 7365 6c66 2e5f 6469   return self._di
-00026340: 7361 7373 6f63 6961 7465 640a 0a20 2020  sassociated..   
-00026350: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00026360: 6566 2064 6973 6173 736f 6369 6174 6564  ef disassociated
-00026370: 5f6f 6273 2873 656c 6629 202d 3e20 6469  _obs(self) -> di
-00026380: 6374 3a0a 2020 2020 2020 2020 2222 220a  ct:.        """.
-00026390: 2020 2020 2020 2020 5072 6f70 6572 7479          Property
-000263a0: 2074 6861 7420 6465 7461 696c 7320 6578   that details ex
-000263b0: 6163 746c 7920 7768 6174 2064 6174 6120  actly what data 
-000263c0: 6861 7320 6265 656e 2064 6973 6173 736f  has been disasso
-000263d0: 6369 6174 6564 2066 726f 6d20 7468 6973  ciated from this
-000263e0: 2073 6f75 7263 652c 2069 6620 616e 792e   source, if any.
-000263f0: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-00026400: 6e3a 2044 6963 7469 6f6e 6172 7920 6465  n: Dictionary de
-00026410: 7363 7269 6269 6e67 2077 6869 6368 2069  scribing which i
-00026420: 6e73 7472 756d 656e 7473 206f 6620 7768  nstruments of wh
-00026430: 6963 6820 4f62 7349 4473 2068 6176 6520  ich ObsIDs have 
-00026440: 6265 656e 2064 6973 6173 736f 6369 6174  been disassociat
-00026450: 6564 2066 726f 6d20 7468 6973 2073 6f75  ed from this sou
-00026460: 7263 652e 0a20 2020 2020 2020 203a 7274  rce..        :rt
-00026470: 7970 653a 2064 6963 740a 2020 2020 2020  ype: dict.      
-00026480: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00026490: 7475 726e 2073 656c 662e 5f64 6973 6173  turn self._disas
-000264a0: 736f 6369 6174 6564 5f6f 6273 0a0a 2020  sociated_obs..  
-000264b0: 2020 6465 6620 6469 7361 7373 6f63 6961    def disassocia
-000264c0: 7465 5f6f 6273 2873 656c 662c 2074 6f5f  te_obs(self, to_
-000264d0: 7265 6d6f 7665 3a20 556e 696f 6e5b 6469  remove: Union[di
-000264e0: 6374 2c20 7374 722c 206c 6973 745d 293a  ct, str, list]):
-000264f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00026500: 2020 2020 204d 6574 686f 6420 7468 6174       Method that
-00026510: 2075 7365 7320 7468 6520 7375 7070 6c69   uses the suppli
-00026520: 6564 2064 6963 7469 6f6e 6172 7920 746f  ed dictionary to
-00026530: 2073 6166 656c 7920 7265 6d6f 7665 2064   safely remove d
-00026540: 6174 6120 6672 6f6d 2074 6865 2073 6f75  ata from the sou
-00026550: 7263 652e 2054 6869 7320 6461 7461 2077  rce. This data w
-00026560: 696c 6c20 6e6f 206c 6f6e 6765 720a 2020  ill no longer.  
-00026570: 2020 2020 2020 6265 2075 7365 6420 696e        be used in
-00026580: 2061 6e79 2061 6e61 6c79 7365 732c 2061   any analyses, a
-00026590: 6e64 2077 6f75 6c64 2074 7970 6963 616c  nd would typical
-000265a0: 6c79 2062 6520 7265 6d6f 7665 6420 6265  ly be removed be
-000265b0: 6361 7573 6520 6974 2069 7320 6f66 2070  cause it is of p
-000265c0: 6f6f 7220 7175 616c 6974 792c 206f 7220  oor quality, or 
-000265d0: 646f 6573 6e27 7420 636f 6e74 7269 6275  doesn't contribu
-000265e0: 7465 0a20 2020 2020 2020 2065 6e6f 7567  te.        enoug
-000265f0: 6820 746f 206a 7573 7469 6679 2069 7473  h to justify its
-00026600: 2070 7265 7365 6e63 652e 0a0a 2020 2020   presence...    
-00026610: 2020 2020 3a70 6172 616d 2064 6963 742f      :param dict/
-00026620: 7374 722f 6c69 7374 2074 6f5f 7265 6d6f  str/list to_remo
-00026630: 7665 3a20 4569 7468 6572 2061 2064 6963  ve: Either a dic
-00026640: 7469 6f6e 6172 7920 6f66 206f 6273 6572  tionary of obser
-00026650: 7661 7469 6f6e 7320 746f 2072 656d 6f76  vations to remov
-00026660: 652c 2028 696e 2074 6865 2073 7479 6c65  e, (in the style
-00026670: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
-00026680: 7468 6520 736f 7572 6365 2e69 6e73 7472  the source.instr
-00026690: 756d 656e 7473 2064 6963 7469 6f6e 6172  uments dictionar
-000266a0: 7920 7769 7468 2074 6865 2074 6f70 206c  y with the top l
-000266b0: 6576 656c 206b 6579 7320 6265 696e 6720  evel keys being 
-000266c0: 4f62 7349 4473 2c20 616e 6420 7468 6520  ObsIDs, and the 
-000266d0: 6c6f 7765 7220 6c65 7665 6c73 0a20 2020  lower levels.   
-000266e0: 2020 2020 2020 2020 2062 6569 6e67 2069           being i
-000266f0: 6e73 7472 756d 656e 7420 6e61 6d65 7329  nstrument names)
-00026700: 2c20 6120 7374 7269 6e67 2063 6f6e 7461  , a string conta
-00026710: 696e 696e 6720 616e 204f 6273 4944 2c20  ining an ObsID, 
-00026720: 6f72 2061 206c 6973 7420 6f66 204f 6273  or a list of Obs
-00026730: 4944 732e 0a20 2020 2020 2020 2022 2222  IDs..        """
-00026740: 0a20 2020 2020 2020 2023 2055 7365 7273  .        # Users
-00026750: 2063 616e 2070 6173 7320 6a75 7374 2061   can pass just a
-00026760: 6e20 4f62 7349 4420 7374 7269 6e67 2c20  n ObsID string, 
-00026770: 6275 7420 7765 2074 6865 6e20 6e65 6564  but we then need
-00026780: 2074 6f20 636f 6e76 6572 7420 6974 2074   to convert it t
-00026790: 6f20 7468 6520 666f 726d 0a20 2020 2020  o the form.     
-000267a0: 2020 2023 2020 7468 6174 2074 6865 2072     #  that the r
-000267b0: 6573 7420 6f66 2074 6865 2066 756e 6374  est of the funct
-000267c0: 696f 6e20 7265 7175 6972 6573 0a20 2020  ion requires.   
-000267d0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-000267e0: 6365 2874 6f5f 7265 6d6f 7665 2c20 7374  ce(to_remove, st
-000267f0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00026800: 746f 5f72 656d 6f76 6520 3d20 7b74 6f5f  to_remove = {to_
-00026810: 7265 6d6f 7665 3a20 6465 6570 636f 7079  remove: deepcopy
-00026820: 2873 656c 662e 696e 7374 7275 6d65 6e74  (self.instrument
-00026830: 735b 746f 5f72 656d 6f76 655d 297d 0a20  s[to_remove])}. 
-00026840: 2020 2020 2020 2023 2048 6572 6520 6973         # Here is
-00026850: 2077 6865 7265 2074 6865 7920 6861 7665   where they have
-00026860: 206a 7573 7420 7061 7373 6564 2061 206c   just passed a l
-00026870: 6973 7420 6f66 204f 6273 4944 732c 2061  ist of ObsIDs, a
-00026880: 6e64 2077 6520 6e65 6564 2074 6f20 6669  nd we need to fi
-00026890: 6c6c 2069 6e20 7468 6520 626c 616e 6b73  ll in the blanks
-000268a0: 2077 6974 6820 7468 6520 696e 7374 7275   with the instru
-000268b0: 6d65 6e74 730a 2020 2020 2020 2020 2320  ments.        # 
-000268c0: 2063 7572 7265 6e74 6c79 206c 6f61 6465   currently loade
-000268d0: 6420 666f 7220 7468 6f73 6520 4f62 7349  d for those ObsI
-000268e0: 4473 0a20 2020 2020 2020 2065 6c69 6620  Ds.        elif 
-000268f0: 6973 696e 7374 616e 6365 2874 6f5f 7265  isinstance(to_re
-00026900: 6d6f 7665 2c20 6c69 7374 293a 0a20 2020  move, list):.   
-00026910: 2020 2020 2020 2020 2074 6f5f 7265 6d6f           to_remo
-00026920: 7665 203d 207b 6f3a 2064 6565 7063 6f70  ve = {o: deepcop
-00026930: 7928 7365 6c66 2e69 6e73 7472 756d 656e  y(self.instrumen
-00026940: 7473 5b6f 5d29 2066 6f72 206f 2069 6e20  ts[o]) for o in 
-00026950: 746f 5f72 656d 6f76 657d 0a20 2020 2020  to_remove}.     
-00026960: 2020 2023 2048 6572 6520 6465 616c 7320     # Here deals 
-00026970: 7769 7468 2077 6865 6e20 736f 6d65 6f6e  with when someon
-00026980: 6520 6d69 6768 7420 6861 7665 2070 6173  e might have pas
-00026990: 7365 6420 6120 6469 6374 696f 6e61 7279  sed a dictionary
-000269a0: 2077 6865 7265 2074 6865 7265 2069 7320   where there is 
-000269b0: 6120 7369 6e67 6c65 2069 6e73 7472 756d  a single instrum
-000269c0: 656e 742c 2061 6e64 0a20 2020 2020 2020  ent, and.       
-000269d0: 2023 2020 7468 6579 2068 6176 656e 2774   #  they haven't
-000269e0: 2070 7574 2069 7420 696e 2061 206c 6973   put it in a lis
-000269f0: 743b 2065 2e67 2e20 7b27 3032 3031 3930  t; e.g. {'020190
-00026a00: 3335 3031 273a 2027 706e 277d 2e20 5468  3501': 'pn'}. Th
-00026a10: 6973 2064 6574 6563 7473 2069 6e73 7461  is detects insta
-00026a20: 6e63 6573 206c 696b 6520 7468 6174 2061  nces like that a
-00026a30: 6e64 2074 6865 6e0a 2020 2020 2020 2020  nd then.        
-00026a40: 2320 2070 7574 7320 7468 6520 696e 6469  #  puts the indi
-00026a50: 7669 6475 616c 2069 6e73 7472 756d 656e  vidual instrumen
-00026a60: 7420 696e 2061 206c 6973 7420 6173 2069  t in a list as i
-00026a70: 7320 6578 7065 6374 6564 2062 7920 7468  s expected by th
-00026a80: 6520 7265 7374 206f 6620 7468 6520 6675  e rest of the fu
-00026a90: 6e63 7469 6f6e 0a20 2020 2020 2020 2065  nction.        e
-00026aa0: 6c69 6620 6973 696e 7374 616e 6365 2874  lif isinstance(t
-00026ab0: 6f5f 7265 6d6f 7665 2c20 6469 6374 2920  o_remove, dict) 
-00026ac0: 616e 6420 6e6f 7420 616c 6c28 5b69 7369  and not all([isi
-00026ad0: 6e73 7461 6e63 6528 762c 206c 6973 7429  nstance(v, list)
-00026ae0: 2066 6f72 2076 2069 6e20 746f 5f72 656d   for v in to_rem
-00026af0: 6f76 652e 7661 6c75 6573 2829 5d29 3a0a  ove.values()]):.
-00026b00: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00026b10: 746f 5f72 656d 6f76 6520 3d20 7b7d 0a20  to_remove = {}. 
-00026b20: 2020 2020 2020 2020 2020 2066 6f72 206f             for o
-00026b30: 2069 6e20 746f 5f72 656d 6f76 653a 0a20   in to_remove:. 
-00026b40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00026b50: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00026b60: 2874 6f5f 7265 6d6f 7665 5b6f 5d2c 206c  (to_remove[o], l
-00026b70: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
-00026b80: 2020 2020 2020 2020 2020 6e65 775f 746f            new_to
-00026b90: 5f72 656d 6f76 655b 6f5d 203d 205b 6465  _remove[o] = [de
-00026ba0: 6570 636f 7079 2874 6f5f 7265 6d6f 7665  epcopy(to_remove
-00026bb0: 5b6f 5d29 5d0a 2020 2020 2020 2020 2020  [o])].          
-00026bc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00026bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026be0: 6e65 775f 746f 5f72 656d 6f76 655b 6f5d  new_to_remove[o]
-00026bf0: 203d 2064 6565 7063 6f70 7928 746f 5f72   = deepcopy(to_r
-00026c00: 656d 6f76 655b 6f5d 290a 0a20 2020 2020  emove[o])..     
-00026c10: 2020 2020 2020 2023 2049 2075 7365 2064         # I use d
-00026c20: 6565 7063 6f70 7920 6167 6169 6e20 6265  eepcopy again be
-00026c30: 6361 7573 6520 7468 6572 6520 6861 7665  cause there have
-00026c40: 2062 6565 6e20 6973 7375 6573 2077 6974   been issues wit
-00026c50: 6820 7468 6973 2066 756e 6374 696f 6e20  h this function 
-00026c60: 7374 696c 6c20 706f 696e 7469 6e67 2074  still pointing t
-00026c70: 6f20 6f6c 6420 6d65 6d6f 7279 0a20 2020  o old memory.   
-00026c80: 2020 2020 2020 2020 2023 2020 6164 6472           #  addr
-00026c90: 6573 7365 732c 2073 6f20 4927 6d20 7175  esses, so I'm qu
-00026ca0: 6974 6520 7061 7261 6e6f 6964 2069 6e20  ite paranoid in 
-00026cb0: 7468 6973 2062 6974 206f 6620 636f 6465  this bit of code
-00026cc0: 0a20 2020 2020 2020 2020 2020 2074 6f5f  .            to_
-00026cd0: 7265 6d6f 7665 203d 2064 6565 7063 6f70  remove = deepcop
-00026ce0: 7928 6e65 775f 746f 5f72 656d 6f76 6529  y(new_to_remove)
-00026cf0: 0a0a 2020 2020 2020 2020 2320 5765 2061  ..        # We a
-00026d00: 6c73 6f20 6368 6563 6b20 746f 206d 616b  lso check to mak
-00026d10: 6520 7375 7265 2074 6861 7420 7468 6520  e sure that the 
-00026d20: 6461 7461 2077 6527 7265 2062 6569 6e67  data we're being
-00026d30: 2061 736b 6564 2074 6f20 7265 6d6f 7665   asked to remove
-00026d40: 2061 6374 7561 6c6c 7920 6973 2061 7373   actually is ass
-00026d50: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
-00026d60: 0a20 2020 2020 2020 2023 2020 736f 7572  .        #  sour
-00026d70: 6365 2e20 5765 2073 6861 6c6c 2062 6520  ce. We shall be 
-00026d80: 666f 7267 6976 696e 6720 6966 2069 7420  forgiving if it 
-00026d90: 6973 6e27 742c 2061 6e64 206a 7573 7420  isn't, and just 
-00026da0: 6973 7375 6520 6120 7761 726e 696e 6720  issue a warning 
-00026db0: 746f 206c 6574 2074 6865 2075 7365 7220  to let the user 
-00026dc0: 6b6e 6f77 2074 6861 7420 7468 6579 2061  know that they a
-00026dd0: 7265 0a20 2020 2020 2020 2023 2020 6173  re.        #  as
-00026de0: 7375 6d69 6e67 2064 6174 6120 7761 7320  suming data was 
-00026df0: 6865 7265 2074 6861 7420 6163 7475 616c  here that actual
-00026e00: 6c79 2069 736e 2774 2070 7265 7365 6e74  ly isn't present
-00026e10: 0a20 2020 2020 2020 2023 2049 7465 7261  .        # Itera
-00026e20: 7469 6e67 2074 6872 6f75 6768 2074 6865  ting through the
-00026e30: 206b 6579 7320 284f 6273 4944 7329 2069   keys (ObsIDs) i
-00026e40: 6e20 746f 5f72 656d 6f76 650a 2020 2020  n to_remove.    
-00026e50: 2020 2020 666f 7220 6f20 696e 2074 6f5f      for o in to_
-00026e60: 7265 6d6f 7665 3a0a 2020 2020 2020 2020  remove:.        
-00026e70: 2020 2020 6966 206f 206e 6f74 2069 6e20      if o not in 
-00026e80: 7365 6c66 2e6f 6273 5f69 6473 3a0a 2020  self.obs_ids:.  
-00026e90: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-00026ea0: 726e 2822 7b6f 7d20 6461 7461 2063 616e  rn("{o} data can
-00026eb0: 6e6f 7420 6265 2072 656d 6f76 6564 2066  not be removed f
-00026ec0: 726f 6d20 7b73 7d20 6173 2074 6865 7920  rom {s} as they 
-00026ed0: 6172 6520 6e6f 7420 6173 736f 6369 6174  are not associat
-00026ee0: 6564 2077 6974 6820 220a 2020 2020 2020  ed with ".      
-00026ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026f00: 2020 2020 2020 2020 2269 742e 222e 666f          "it.".fo
-00026f10: 726d 6174 286f 3d6f 2c20 733d 7365 6c66  rmat(o=o, s=self
-00026f20: 2e6e 616d 6529 2c20 7374 6163 6b6c 6576  .name), stacklev
-00026f30: 656c 3d32 290a 2020 2020 2020 2020 2020  el=2).          
-00026f40: 2020 2320 4368 6563 6b20 746f 2073 6565    # Check to see
-00026f50: 2077 6865 7468 6572 2061 6e79 206f 6620   whether any of 
-00026f60: 7468 6520 696e 7374 7275 6d65 6e74 7320  the instruments 
-00026f70: 666f 7220 6f20 6172 6520 6e6f 7420 6163  for o are not ac
-00026f80: 7475 616c 6c79 2061 7373 6f63 6961 7465  tually associate
-00026f90: 6420 7769 7468 2074 6865 2073 6f75 7263  d with the sourc
-00026fa0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-00026fb0: 6966 2061 6e79 285b 6920 6e6f 7420 696e  if any([i not in
-00026fc0: 2073 656c 662e 696e 7374 7275 6d65 6e74   self.instrument
-00026fd0: 735b 6f5d 2066 6f72 2069 2069 6e20 746f  s[o] for i in to
-00026fe0: 5f72 656d 6f76 655b 6f5d 5d29 3a0a 2020  _remove[o]]):.  
-00026ff0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-00027000: 645f 6c69 7374 203d 205b 6920 666f 7220  d_list = [i for 
-00027010: 6920 696e 2074 6f5f 7265 6d6f 7665 5b6f  i in to_remove[o
-00027020: 5d20 6966 2069 206e 6f74 2069 6e20 7365  ] if i not in se
-00027030: 6c66 2e69 6e73 7472 756d 656e 7473 5b6f  lf.instruments[o
-00027040: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-00027050: 2020 2062 6164 5f73 7472 203d 2022 2f22     bad_str = "/"
-00027060: 2e6a 6f69 6e28 6261 645f 6c69 7374 290a  .join(bad_list).
-00027070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027080: 7761 726e 2822 7b6f 7d2d 7b69 627d 2064  warn("{o}-{ib} d
-00027090: 6174 6120 6361 6e6e 6f74 2062 6520 7265  ata cannot be re
-000270a0: 6d6f 7665 6420 6672 6f6d 207b 737d 2061  moved from {s} a
-000270b0: 7320 7468 6579 2061 7265 206e 6f74 2061  s they are not a
-000270c0: 7373 6f63 6961 7465 6420 220a 2020 2020  ssociated ".    
-000270d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000270e0: 2020 2020 2020 2020 2020 2277 6974 6820            "with 
-000270f0: 6974 2e22 2e66 6f72 6d61 7428 6f3d 6f2c  it.".format(o=o,
-00027100: 2069 623d 6261 645f 7374 722c 2073 3d73   ib=bad_str, s=s
-00027110: 656c 662e 6e61 6d65 292c 2073 7461 636b  elf.name), stack
-00027120: 6c65 7665 6c3d 3229 0a0a 2020 2020 2020  level=2)..      
-00027130: 2020 2320 5365 7473 2074 6865 2061 7474    # Sets the att
-00027140: 7269 6275 7465 2074 6861 7420 7465 6c6c  ribute that tell
-00027150: 7320 7573 2077 6865 7468 6572 2061 6e79  s us whether any
-00027160: 2064 6174 6120 6861 7320 6265 656e 2072   data has been r
-00027170: 656d 6f76 6564 0a20 2020 2020 2020 2069  emoved.        i
-00027180: 6620 6e6f 7420 7365 6c66 2e5f 6469 7361  f not self._disa
-00027190: 7373 6f63 6961 7465 643a 0a20 2020 2020  ssociated:.     
-000271a0: 2020 2020 2020 2073 656c 662e 5f64 6973         self._dis
-000271b0: 6173 736f 6369 6174 6564 203d 2054 7275  associated = Tru
-000271c0: 650a 0a20 2020 2020 2020 2023 2057 6520  e..        # We 
-000271d0: 7761 6e74 2074 6f20 7374 6f72 6520 6b6e  want to store kn
-000271e0: 6f77 6c65 6467 6520 6f66 2077 6861 7420  owledge of what 
-000271f0: 6461 7461 2068 6173 2062 6565 6e20 7265  data has been re
-00027200: 6d6f 7665 642c 2069 6620 7468 6572 6520  moved, if there 
-00027210: 6861 736e 2774 2062 6565 6e20 616e 7974  hasn't been anyt
-00027220: 6869 6e67 2074 616b 656e 2061 7761 7920  hing taken away 
-00027230: 7965 740a 2020 2020 2020 2020 2320 2074  yet.        #  t
-00027240: 6865 6e20 7765 2063 616e 206a 7573 7420  hen we can just 
-00027250: 7365 7420 6974 2065 7175 616c 2074 6f20  set it equal to 
-00027260: 7468 6520 746f 5f72 656d 6f76 6520 6469  the to_remove di
-00027270: 6374 696f 6e61 7279 0a20 2020 2020 2020  ctionary.       
-00027280: 2069 6620 6c65 6e28 7365 6c66 2e5f 6469   if len(self._di
-00027290: 7361 7373 6f63 6961 7465 645f 6f62 7329  sassociated_obs)
-000272a0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-000272b0: 2020 2073 656c 662e 5f64 6973 6173 736f     self._disasso
-000272c0: 6369 6174 6564 5f6f 6273 203d 2074 6f5f  ciated_obs = to_
-000272d0: 7265 6d6f 7665 0a20 2020 2020 2020 2023  remove.        #
-000272e0: 204f 7468 6572 7769 7365 2077 6520 6861   Otherwise we ha
-000272f0: 7665 2074 6f20 6164 6420 7468 6520 6461  ve to add the da
-00027300: 7461 2074 6f20 7468 6520 6578 6973 7469  ta to the existi
-00027310: 6e67 2064 6963 7469 6f6e 6172 7920 7374  ng dictionary st
-00027320: 7275 6374 7572 650a 2020 2020 2020 2020  ructure.        
-00027330: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00027340: 2020 666f 7220 6f20 696e 2074 6f5f 7265    for o in to_re
-00027350: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
-00027360: 2020 2020 2020 6966 206f 206e 6f74 2069        if o not i
-00027370: 6e20 7365 6c66 2e5f 6469 7361 7373 6f63  n self._disassoc
-00027380: 6961 7465 645f 6f62 733a 0a20 2020 2020  iated_obs:.     
-00027390: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000273a0: 656c 662e 5f64 6973 6173 736f 6369 6174  elf._disassociat
-000273b0: 6564 5f6f 6273 5b6f 5d20 3d20 746f 5f72  ed_obs[o] = to_r
-000273c0: 656d 6f76 655b 6f5d 0a20 2020 2020 2020  emove[o].       
-000273d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000273e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000273f0: 2020 2073 656c 662e 5f64 6973 6173 736f     self._disasso
-00027400: 6369 6174 6564 5f6f 6273 5b6f 5d20 2b3d  ciated_obs[o] +=
-00027410: 2074 6f5f 7265 6d6f 7665 5b6f 5d0a 0a20   to_remove[o].. 
-00027420: 2020 2020 2020 2023 2049 6620 7765 2772         # If we'r
-00027430: 6520 756e 2d61 7373 6f63 6961 7469 6e67  e un-associating
-00027440: 2063 6572 7461 696e 206f 6273 6572 7661   certain observa
-00027450: 7469 6f6e 732c 206f 6464 7320 6f6e 2074  tions, odds on t
-00027460: 6865 2063 6f6d 6269 6e65 6420 7072 6f64  he combined prod
-00027470: 7563 7473 2061 7265 206e 6f20 6c6f 6e67  ucts are no long
-00027480: 6572 2076 616c 6964 0a20 2020 2020 2020  er valid.       
-00027490: 2069 6620 2263 6f6d 6269 6e65 6422 2069   if "combined" i
-000274a0: 6e20 7365 6c66 2e5f 7072 6f64 7563 7473  n self._products
-000274b0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-000274c0: 6c20 7365 6c66 2e5f 7072 6f64 7563 7473  l self._products
-000274d0: 5b22 636f 6d62 696e 6564 225d 0a20 2020  ["combined"].   
-000274e0: 2020 2020 2020 2020 2069 6620 2263 6f6d           if "com
-000274f0: 6269 6e65 6422 2069 6e20 7365 6c66 2e5f  bined" in self._
-00027500: 696e 7465 726c 6f70 6572 5f6d 6173 6b73  interloper_masks
-00027510: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027520: 2020 6465 6c20 7365 6c66 2e5f 696e 7465    del self._inte
-00027530: 726c 6f70 6572 5f6d 6173 6b73 5b22 636f  rloper_masks["co
-00027540: 6d62 696e 6564 225d 0a20 2020 2020 2020  mbined"].       
-00027550: 2020 2020 2073 656c 662e 5f66 6974 5f72       self._fit_r
-00027560: 6573 756c 7473 203d 207b 7d0a 2020 2020  esults = {}.    
-00027570: 2020 2020 2020 2020 7365 6c66 2e5f 7465          self._te
-00027580: 7374 5f73 7461 7420 3d20 7b7d 0a20 2020  st_stat = {}.   
-00027590: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
-000275a0: 6f66 203d 207b 7d0a 2020 2020 2020 2020  of = {}.        
-000275b0: 2020 2020 7365 6c66 2e5f 746f 7461 6c5f      self._total_
-000275c0: 636f 756e 745f 7261 7465 203d 207b 7d0a  count_rate = {}.
-000275d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000275e0: 2e5f 746f 7461 6c5f 6578 7020 3d20 7b7d  ._total_exp = {}
-000275f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00027600: 662e 5f6c 756d 696e 6f73 6974 6965 7320  f._luminosities 
-00027610: 3d20 7b7d 0a0a 2020 2020 2020 2020 666f  = {}..        fo
-00027620: 7220 6f20 696e 2074 6f5f 7265 6d6f 7665  r o in to_remove
-00027630: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00027640: 7220 6920 696e 2074 6f5f 7265 6d6f 7665  r i in to_remove
-00027650: 5b6f 5d3a 0a20 2020 2020 2020 2020 2020  [o]:.           
-00027660: 2020 2020 2064 656c 2073 656c 662e 5f70       del self._p
-00027670: 726f 6475 6374 735b 6f5d 5b69 5d0a 2020  roducts[o][i].  
-00027680: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00027690: 6c20 7365 6c66 2e5f 696e 7374 7275 6d65  l self._instrume
-000276a0: 6e74 735b 6f5d 5b73 656c 662e 5f69 6e73  nts[o][self._ins
-000276b0: 7472 756d 656e 7473 5b6f 5d2e 696e 6465  truments[o].inde
-000276c0: 7828 6929 5d0a 0a20 2020 2020 2020 2020  x(i)]..         
-000276d0: 2020 2069 6620 6c65 6e28 7365 6c66 2e5f     if len(self._
-000276e0: 696e 7374 7275 6d65 6e74 735b 6f5d 2920  instruments[o]) 
-000276f0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00027700: 2020 2020 2020 6465 6c20 7365 6c66 2e5f        del self._
-00027710: 7072 6f64 7563 7473 5b6f 5d0a 2020 2020  products[o].    
-00027720: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-00027730: 7365 6c66 2e5f 6465 7465 6374 6564 5b6f  self._detected[o
-00027740: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00027750: 2020 6465 6c20 7365 6c66 2e5f 696e 6974    del self._init
-00027760: 6961 6c5f 7265 6769 6f6e 735b 6f5d 0a20  ial_regions[o]. 
-00027770: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00027780: 656c 2073 656c 662e 5f69 6e69 7469 616c  el self._initial
-00027790: 5f72 6567 696f 6e5f 6d61 7463 6865 735b  _region_matches[
-000277a0: 6f5d 0a20 2020 2020 2020 2020 2020 2020  o].             
-000277b0: 2020 2064 656c 2073 656c 662e 5f72 6567     del self._reg
-000277c0: 696f 6e73 5b6f 5d0a 2020 2020 2020 2020  ions[o].        
-000277d0: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
-000277e0: 2e5f 6f74 6865 725f 7265 6769 6f6e 735b  ._other_regions[
-000277f0: 6f5d 0a20 2020 2020 2020 2020 2020 2020  o].             
-00027800: 2020 2064 656c 2073 656c 662e 5f61 6c74     del self._alt
-00027810: 5f6d 6174 6368 5f72 6567 696f 6e73 5b6f  _match_regions[o
-00027820: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00027830: 2020 2320 5468 6573 6520 6172 6520 6d61    # These are ma
-00027840: 6465 206f 6e20 6465 6d61 6e64 2c20 736f  de on demand, so
-00027850: 206e 6565 6420 746f 2063 6865 636b 2069   need to check i
-00027860: 6620 6974 7320 6163 7475 616c 6c79 2070  f its actually p
-00027870: 7265 7365 6e74 2066 6972 7374 0a20 2020  resent first.   
-00027880: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00027890: 6f20 696e 2073 656c 662e 5f69 6e74 6572  o in self._inter
-000278a0: 6c6f 7065 725f 6d61 736b 733a 0a20 2020  loper_masks:.   
-000278b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278c0: 2064 656c 2073 656c 662e 5f69 6e74 6572   del self._inter
-000278d0: 6c6f 7065 725f 6d61 736b 735b 6f5d 0a20  loper_masks[o]. 
-000278e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000278f0: 6620 7365 6c66 2e5f 7065 616b 7320 6973  f self._peaks is
-00027900: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00027910: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00027920: 656c 2073 656c 662e 5f70 6561 6b73 5b6f  el self._peaks[o
-00027930: 5d0a 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00027940: 2020 2064 656c 2073 656c 662e 5f6f 6273     del self._obs
-00027950: 5b73 656c 662e 5f6f 6273 2e69 6e64 6578  [self._obs.index
-00027960: 286f 295d 0a20 2020 2020 2020 2020 2020  (o)].           
-00027970: 2020 2020 2069 6620 6f20 696e 2073 656c       if o in sel
-00027980: 662e 5f6f 6e61 7869 733a 0a20 2020 2020  f._onaxis:.     
-00027990: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000279a0: 656c 2073 656c 662e 5f6f 6e61 7869 735b  el self._onaxis[
-000279b0: 7365 6c66 2e5f 6f6e 6178 6973 2e69 6e64  self._onaxis.ind
-000279c0: 6578 286f 295d 0a20 2020 2020 2020 2020  ex(o)].         
-000279d0: 2020 2020 2020 2064 656c 2073 656c 662e         del self.
-000279e0: 5f69 6e73 7472 756d 656e 7473 5b6f 5d0a  _instruments[o].
-000279f0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00027a00: 7365 6c66 2e5f 6f62 7329 203d 3d20 303a  self._obs) == 0:
-00027a10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00027a20: 7365 204e 6f56 616c 6964 4f62 7365 7276  se NoValidObserv
-00027a30: 6174 696f 6e73 4572 726f 7228 224e 6f20  ationsError("No 
-00027a40: 6f62 7365 7276 6174 696f 6e73 2072 656d  observations rem
-00027a50: 6169 6e20 6173 736f 6369 6174 6564 2077  ain associated w
-00027a60: 6974 6820 7b7d 2061 6674 6572 2063 6c65  ith {} after cle
-00027a70: 616e 696e 6722 2e66 6f72 6d61 7428 7365  aning".format(se
-00027a80: 6c66 2e6e 616d 6529 290a 0a20 2020 2020  lf.name))..     
-00027a90: 2020 2023 2057 6520 6174 7465 6d70 7420     # We attempt 
-00027aa0: 746f 206c 6f61 6420 696e 206d 6174 6368  to load in match
-00027ab0: 696e 6720 5847 4120 7072 6f64 7563 7473  ing XGA products
-00027ac0: 2069 6620 7468 6174 2077 6173 2074 6865   if that was the
-00027ad0: 2062 6568 6176 696f 7572 2073 6574 2062   behaviour set b
-00027ae0: 7920 6c6f 6164 5f70 726f 6475 6374 7320  y load_products 
-00027af0: 6f6e 2069 6e69 740a 2020 2020 2020 2020  on init.        
-00027b00: 6966 2073 656c 662e 5f6c 6f61 645f 7072  if self._load_pr
-00027b10: 6f64 7563 7473 3a0a 2020 2020 2020 2020  oducts:.        
-00027b20: 2020 2020 7365 6c66 2e5f 6578 6973 7469      self._existi
-00027b30: 6e67 5f78 6761 5f70 726f 6475 6374 7328  ng_xga_products(
-00027b40: 7365 6c66 2e5f 6c6f 6164 5f66 6974 7329  self._load_fits)
-00027b50: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00027b60: 2020 2020 6465 6620 6c75 6d69 6e6f 7369      def luminosi
-00027b70: 7479 5f64 6973 7461 6e63 6528 7365 6c66  ty_distance(self
-00027b80: 2920 2d3e 2051 7561 6e74 6974 793a 0a20  ) -> Quantity:. 
-00027b90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00027ba0: 2020 2054 656c 6c73 2074 6865 2075 7365     Tells the use
-00027bb0: 7220 7468 6520 6c75 6d69 6e6f 7369 7479  r the luminosity
-00027bc0: 2064 6973 7461 6e63 6520 746f 2074 6865   distance to the
-00027bd0: 2073 6f75 7263 6520 6966 2061 2072 6564   source if a red
-00027be0: 7368 6966 7420 7761 7320 7375 7070 6c69  shift was suppli
-00027bf0: 6564 2c20 6966 206e 6f74 2072 6574 7572  ed, if not retur
-00027c00: 6e73 204e 6f6e 652e 0a0a 2020 2020 2020  ns None...      
-00027c10: 2020 3a72 6574 7572 6e3a 2054 6865 206c    :return: The l
-00027c20: 756d 696e 6f73 6974 7920 6469 7374 616e  uminosity distan
-00027c30: 6365 2074 6f20 7468 6520 736f 7572 6365  ce to the source
-00027c40: 2c20 6361 6c63 756c 6174 6564 2075 7369  , calculated usi
-00027c50: 6e67 2074 6865 2063 6f73 6d6f 6c6f 6779  ng the cosmology
-00027c60: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-00027c70: 2074 6869 7320 736f 7572 6365 2e0a 2020   this source..  
-00027c80: 2020 2020 2020 3a72 7479 7065 3a20 5175        :rtype: Qu
-00027c90: 616e 7469 7479 0a20 2020 2020 2020 2022  antity.        "
-00027ca0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00027cb0: 6e20 7365 6c66 2e5f 6c75 6d5f 6469 7374  n self._lum_dist
-00027cc0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00027cd0: 2020 2020 6465 6620 616e 6775 6c61 725f      def angular_
-00027ce0: 6469 616d 6574 6572 5f64 6973 7461 6e63  diameter_distanc
-00027cf0: 6528 7365 6c66 2920 2d3e 2051 7561 6e74  e(self) -> Quant
-00027d00: 6974 793a 0a20 2020 2020 2020 2022 2222  ity:.        """
-00027d10: 0a20 2020 2020 2020 2054 656c 6c73 2074  .        Tells t
-00027d20: 6865 2075 7365 7220 7468 6520 616e 6775  he user the angu
-00027d30: 6c61 7220 6469 616d 6574 6572 2064 6973  lar diameter dis
-00027d40: 7461 6e63 6520 746f 2074 6865 2073 6f75  tance to the sou
-00027d50: 7263 6520 6966 2061 2072 6564 7368 6966  rce if a redshif
-00027d60: 7420 7761 7320 7375 7070 6c69 6564 2c20  t was supplied, 
-00027d70: 6966 206e 6f74 2072 6574 7572 6e73 204e  if not returns N
-00027d80: 6f6e 652e 0a0a 2020 2020 2020 2020 3a72  one...        :r
-00027d90: 6574 7572 6e3a 2054 6865 2061 6e67 756c  eturn: The angul
-00027da0: 6172 2064 6961 6d65 7465 7220 6469 7374  ar diameter dist
-00027db0: 616e 6365 2074 6f20 7468 6520 736f 7572  ance to the sour
-00027dc0: 6365 2c20 6361 6c63 756c 6174 6564 2075  ce, calculated u
-00027dd0: 7369 6e67 2074 6865 2063 6f73 6d6f 6c6f  sing the cosmolo
-00027de0: 6779 0a20 2020 2020 2020 2020 2020 2061  gy.            a
-00027df0: 7373 6f63 6961 7465 6420 7769 7468 2074  ssociated with t
-00027e00: 6869 7320 736f 7572 6365 2e0a 2020 2020  his source..    
-00027e10: 2020 2020 3a72 7479 7065 3a20 5175 616e      :rtype: Quan
-00027e20: 7469 7479 0a20 2020 2020 2020 2022 2222  tity.        """
-00027e30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00027e40: 7365 6c66 2e5f 616e 675f 6469 616d 5f64  self._ang_diam_d
-00027e50: 6973 740a 0a20 2020 2040 7072 6f70 6572  ist..    @proper
-00027e60: 7479 0a20 2020 2064 6566 2062 6163 6b67  ty.    def backg
-00027e70: 726f 756e 645f 7261 6469 7573 5f66 6163  round_radius_fac
-00027e80: 746f 7273 2873 656c 6629 202d 3e20 6e64  tors(self) -> nd
-00027e90: 6172 7261 793a 0a20 2020 2020 2020 2022  array:.        "
-00027ea0: 2222 0a20 2020 2020 2020 2054 6865 2066  "".        The f
-00027eb0: 6163 746f 7273 2062 7920 7768 6963 6820  actors by which 
-00027ec0: 746f 206d 756c 7469 706c 7920 6f75 7465  to multiply oute
-00027ed0: 7220 7261 6469 7573 2062 7920 746f 2067  r radius by to g
-00027ee0: 6574 2069 6e6e 6572 2061 6e64 206f 7574  et inner and out
-00027ef0: 6572 2072 6164 6969 2066 6f72 2062 6163  er radii for bac
-00027f00: 6b67 726f 756e 6420 7265 6769 6f6e 732e  kground regions.
-00027f10: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-00027f20: 6e3a 2041 6e20 6172 7261 7920 6f66 2074  n: An array of t
-00027f30: 6865 2074 776f 2066 6163 746f 7273 2e0a  he two factors..
-00027f40: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-00027f50: 6e64 6172 7261 790a 2020 2020 2020 2020  ndarray.        
-00027f60: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00027f70: 726e 206e 702e 6172 7261 7928 5b73 656c  rn np.array([sel
-00027f80: 662e 5f62 6163 6b5f 696e 6e5f 6661 6374  f._back_inn_fact
-00027f90: 6f72 2c20 7365 6c66 2e5f 6261 636b 5f6f  or, self._back_o
-00027fa0: 7574 5f66 6163 746f 725d 290a 0a20 2020  ut_factor])..   
-00027fb0: 2064 6566 206f 6273 5f63 6865 636b 2873   def obs_check(s
-00027fc0: 656c 662c 2072 6567 5f74 7970 653a 2073  elf, reg_type: s
-00027fd0: 7472 2c20 7468 7265 7368 6f6c 645f 6672  tr, threshold_fr
-00027fe0: 6163 7469 6f6e 3a20 666c 6f61 7420 3d20  action: float = 
-00027ff0: 302e 3529 202d 3e20 4469 6374 3a0a 2020  0.5) -> Dict:.  
-00028000: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00028010: 2020 5468 6973 206d 6574 686f 6420 7573    This method us
-00028020: 6573 2065 7870 6f73 7572 6520 6d61 7073  es exposure maps
-00028030: 2061 6e64 2072 6567 696f 6e20 6d61 736b   and region mask
-00028040: 7320 746f 2064 6574 6572 6d69 6e65 2077  s to determine w
-00028050: 6869 6368 204f 6273 4944 2f69 6e73 7472  hich ObsID/instr
-00028060: 756d 656e 7420 636f 6d62 696e 6174 696f  ument combinatio
-00028070: 6e73 0a20 2020 2020 2020 2061 7265 206e  ns.        are n
-00028080: 6f74 2063 6f6e 7472 6962 7574 696e 6720  ot contributing 
-00028090: 746f 2074 6865 2061 6e61 6c79 7369 732e  to the analysis.
-000280a0: 2049 7420 6361 6c63 756c 6174 6573 2074   It calculates t
-000280b0: 6865 2061 7265 6120 696e 7465 7273 6563  he area intersec
-000280c0: 7469 6f6e 206f 6620 7468 6520 6d61 736b  tion of the mask
-000280d0: 2061 6e64 2065 7870 6f73 7572 650a 2020   and exposure.  
-000280e0: 2020 2020 2020 6d61 7073 2c20 616e 6420        maps, and 
-000280f0: 6966 2028 666f 7220 6120 6769 7665 6e20  if (for a given 
-00028100: 4f62 7349 442d 496e 7374 7275 6d65 6e74  ObsID-Instrument
-00028110: 2920 7468 6520 7261 7469 6f20 6f66 2074  ) the ratio of t
-00028120: 6861 7420 6172 6561 2074 6f20 7468 6520  hat area to the 
-00028130: 6675 6c6c 2061 7265 6120 6f66 2074 6865  full area of the
-00028140: 2072 6567 696f 6e0a 2020 2020 2020 2020   region.        
-00028150: 6361 6c63 756c 6174 6564 2069 7320 6c65  calculated is le
-00028160: 7373 2074 6861 6e20 7468 6520 7468 7265  ss than the thre
-00028170: 7368 6f6c 6420 6672 6163 7469 6f6e 2c20  shold fraction, 
-00028180: 7468 6174 204f 6273 4944 2d69 6e73 7472  that ObsID-instr
-00028190: 756d 656e 7420 7769 6c6c 2062 6520 696e  ument will be in
-000281a0: 636c 7564 6564 2069 6e20 7468 6520 7265  cluded in the re
-000281b0: 7475 726e 6564 0a20 2020 2020 2020 2072  turned.        r
-000281c0: 656a 6563 7469 6f6e 2064 6963 7469 6f6e  ejection diction
-000281d0: 6172 792e 0a0a 2020 2020 2020 2020 3a70  ary...        :p
-000281e0: 6172 616d 2073 7472 2072 6567 5f74 7970  aram str reg_typ
-000281f0: 653a 2054 6865 2072 6567 696f 6e20 7479  e: The region ty
-00028200: 7065 2066 6f72 2077 6869 6368 2074 6f20  pe for which to 
-00028210: 6361 6c63 756c 6174 6520 7468 6520 6172  calculate the ar
-00028220: 6561 2069 6e74 6572 7365 6374 696f 6e2e  ea intersection.
-00028230: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00028240: 666c 6f61 7420 7468 7265 7368 6f6c 645f  float threshold_
-00028250: 6672 6163 7469 6f6e 3a20 496e 7465 7273  fraction: Inters
-00028260: 6563 7469 6f6e 2061 7265 612f 2066 756c  ection area/ ful
-00028270: 6c20 7265 6769 6f6e 2061 7265 6120 7261  l region area ra
-00028280: 7469 6f73 2062 656c 6f77 2074 6869 7320  tios below this 
-00028290: 7661 6c75 6520 7769 6c6c 206d 6561 6e20  value will mean 
-000282a0: 616e 0a20 2020 2020 2020 2020 2020 204f  an.            O
-000282b0: 6273 4944 2d49 6e73 7472 756d 656e 7420  bsID-Instrument 
-000282c0: 6973 2072 656a 6563 7465 642e 0a20 2020  is rejected..   
-000282d0: 2020 2020 203a 7265 7475 726e 3a20 4120       :return: A 
-000282e0: 6469 6374 696f 6e61 7279 206f 6620 4f62  dictionary of Ob
-000282f0: 7349 4420 6b65 7973 206f 6e20 7468 6520  sID keys on the 
-00028300: 746f 7020 6c65 7665 6c2c 2074 6865 6e20  top level, then 
-00028310: 696e 7374 7275 6d65 6e74 7320 6120 6c65  instruments a le
-00028320: 7665 6c20 646f 776e 2c20 7468 6174 0a20  vel down, that. 
-00028330: 2020 2020 2020 2020 2020 2073 686f 756c             shoul
-00028340: 6420 6265 2072 656a 6563 7465 6420 6163  d be rejected ac
-00028350: 636f 7264 696e 6720 746f 2074 6865 2063  cording to the c
-00028360: 7269 7465 7269 6120 7375 7070 6c69 6564  riteria supplied
-00028370: 2074 6f20 7468 6973 206d 6574 686f 642e   to this method.
-00028380: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-00028390: 2044 6963 740a 2020 2020 2020 2020 2222   Dict.        ""
-000283a0: 220a 2020 2020 2020 2020 2320 4167 6169  ".        # Agai
-000283b0: 6e20 646f 6e27 7420 7061 7274 6963 756c  n don't particul
-000283c0: 6172 6c79 2077 616e 7420 746f 2064 6f20  arly want to do 
-000283d0: 7468 6973 206c 6f63 616c 2069 6d70 6f72  this local impor
-000283e0: 742c 2062 7574 2069 7473 206a 7573 7420  t, but its just 
-000283f0: 6561 7369 6572 0a20 2020 2020 2020 2066  easier.        f
-00028400: 726f 6d20 7867 612e 7361 7320 696d 706f  rom xga.sas impo
-00028410: 7274 2065 6578 706d 6170 0a0a 2020 2020  rt eexpmap..    
-00028420: 2020 2020 2320 476f 696e 6720 746f 2065      # Going to e
-00028430: 6e73 7572 6520 7468 6174 2069 6e64 6976  nsure that indiv
-00028440: 6964 7561 6c20 6578 706f 7375 7265 206d  idual exposure m
-00028450: 6170 7320 6578 6973 7420 666f 7220 6561  aps exist for ea
-00028460: 6368 206f 6620 7468 6520 4f62 7349 442f  ch of the ObsID/
-00028470: 696e 7374 7275 6d65 6e74 2063 6f6d 6269  instrument combi
-00028480: 6e61 7469 6f6e 730a 2020 2020 2020 2020  nations.        
-00028490: 2320 2066 6972 7374 2c20 7468 656e 2063  #  first, then c
-000284a0: 6865 636b 696e 6720 7768 6572 6520 7468  hecking where th
-000284b0: 6520 736f 7572 6365 206c 6965 7320 6f6e  e source lies on
-000284c0: 2074 6865 2065 7870 6f73 7572 6520 6d61   the exposure ma
-000284d0: 700a 2020 2020 2020 2020 6565 7870 6d61  p.        eexpma
-000284e0: 7028 7365 6c66 2c20 7365 6c66 2e5f 7065  p(self, self._pe
-000284f0: 616b 5f6c 6f5f 656e 2c20 7365 6c66 2e5f  ak_lo_en, self._
-00028500: 7065 616b 5f68 695f 656e 290a 0a20 2020  peak_hi_en)..   
-00028510: 2020 2020 2065 7874 7261 5f6b 6579 203d       extra_key =
-00028520: 2022 626f 756e 645f 7b6c 7d2d 7b75 7d22   "bound_{l}-{u}"
-00028530: 2e66 6f72 6d61 7428 6c3d 7365 6c66 2e5f  .format(l=self._
-00028540: 7065 616b 5f6c 6f5f 656e 2e74 6f28 226b  peak_lo_en.to("k
-00028550: 6556 2229 2e76 616c 7565 2c20 753d 7365  eV").value, u=se
-00028560: 6c66 2e5f 7065 616b 5f68 695f 656e 2e74  lf._peak_hi_en.t
-00028570: 6f28 226b 6556 2229 2e76 616c 7565 290a  o("keV").value).
-00028580: 0a20 2020 2020 2020 2061 7265 6120 3d20  .        area = 
-00028590: 7b6f 3a20 7b7d 2066 6f72 206f 2069 6e20  {o: {} for o in 
-000285a0: 7365 6c66 2e6f 6273 5f69 6473 7d0a 2020  self.obs_ids}.  
-000285b0: 2020 2020 2020 6675 6c6c 5f61 7265 6120        full_area 
-000285c0: 3d20 7b6f 3a20 7b7d 2066 6f72 206f 2069  = {o: {} for o i
-000285d0: 6e20 7365 6c66 2e6f 6273 5f69 6473 7d0a  n self.obs_ids}.
-000285e0: 2020 2020 2020 2020 666f 7220 6f20 696e          for o in
-000285f0: 2073 656c 662e 6f62 735f 6964 733a 0a20   self.obs_ids:. 
-00028600: 2020 2020 2020 2020 2020 2023 2045 7870             # Exp
-00028610: 6f73 7572 6520 6d61 7073 206f 6620 7468  osure maps of th
-00028620: 6520 7065 616b 2066 696e 6469 6e67 2065  e peak finding e
-00028630: 6e65 7267 7920 7261 6e67 6520 666f 7220  nergy range for 
-00028640: 7468 6973 204f 6273 4944 0a20 2020 2020  this ObsID.     
-00028650: 2020 2020 2020 2065 7870 5f6d 6170 7320         exp_maps 
-00028660: 3d20 7365 6c66 2e67 6574 5f70 726f 6475  = self.get_produ
-00028670: 6374 7328 2265 7870 6d61 7022 2c20 6f2c  cts("expmap", o,
-00028680: 2065 7874 7261 5f6b 6579 3d65 7874 7261   extra_key=extra
-00028690: 5f6b 6579 290a 2020 2020 2020 2020 2020  _key).          
-000286a0: 2020 6d20 3d20 7365 6c66 2e67 6574 5f73    m = self.get_s
-000286b0: 6f75 7263 655f 6d61 736b 2872 6567 5f74  ource_mask(reg_t
-000286c0: 7970 652c 206f 2c20 6365 6e74 7261 6c5f  ype, o, central_
-000286d0: 636f 6f72 643d 7365 6c66 2e5f 6465 6661  coord=self._defa
-000286e0: 756c 745f 636f 6f72 6429 5b30 5d0a 2020  ult_coord)[0].  
-000286f0: 2020 2020 2020 2020 2020 6675 6c6c 5f61            full_a
-00028700: 7265 615b 6f5d 203d 206d 2e73 756d 2829  rea[o] = m.sum()
-00028710: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00028720: 7220 6578 2069 6e20 6578 705f 6d61 7073  r ex in exp_maps
-00028730: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00028740: 2020 2320 4772 6162 7320 6578 706f 7375    # Grabs exposu
-00028750: 7265 206d 6170 2064 6174 612c 2074 6865  re map data, the
-00028760: 6e20 616c 7465 7273 2069 7420 736f 2061  n alters it so a
-00028770: 6e79 7468 696e 6720 7468 6174 2069 736e  nything that isn
-00028780: 2774 207a 6572 6f20 6973 2061 206f 6e65  't zero is a one
-00028790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000287a0: 2065 785f 6461 7461 203d 2065 782e 6461   ex_data = ex.da
-000287b0: 7461 2e63 6f70 7928 290a 2020 2020 2020  ta.copy().      
-000287c0: 2020 2020 2020 2020 2020 6578 5f64 6174            ex_dat
-000287d0: 615b 6578 5f64 6174 6120 3e20 305d 203d  a[ex_data > 0] =
-000287e0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-000287f0: 2020 2023 2057 6520 646f 2074 6869 7320     # We do this 
-00028800: 6265 6361 7573 6520 6974 2074 6865 6e20  because it then 
-00028810: 6265 636f 6d65 7320 7665 7279 2065 6173  becomes very eas
-00028820: 7920 746f 2063 616c 6375 6c61 7465 2074  y to calculate t
-00028830: 6865 2069 6e74 6572 7365 6374 696f 6e20  he intersection 
-00028840: 6172 6561 206f 6620 7468 6520 6d61 736b  area of the mask
-00028850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028860: 2023 2020 7769 7468 2074 6865 2058 4d4d   #  with the XMM
-00028870: 2063 6869 7073 2e20 4a75 7374 206d 6173   chips. Just mas
-00028880: 6b20 7468 6520 6d6f 6469 6669 6564 2065  k the modified e
-00028890: 7870 6d61 702c 2074 6865 6e20 7375 6d2e  xpmap, then sum.
-000288a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000288b0: 2061 7265 615b 6f5d 5b65 782e 696e 7374   area[o][ex.inst
-000288c0: 7275 6d65 6e74 5d20 3d20 2865 785f 6461  rument] = (ex_da
-000288d0: 7461 202a 206d 292e 7375 6d28 290a 0a20  ta * m).sum().. 
-000288e0: 2020 2020 2020 2069 6620 6d61 7828 6c69         if max(li
-000288f0: 7374 2866 756c 6c5f 6172 6561 2e76 616c  st(full_area.val
-00028900: 7565 7328 2929 2920 3d3d 2030 3a0a 2020  ues())) == 0:.  
-00028910: 2020 2020 2020 2020 2020 2320 4576 6572            # Ever
-00028920: 7974 6869 6e67 2068 6173 2074 6f20 6265  ything has to be
-00028930: 2072 656a 6563 7465 6420 696e 2074 6869   rejected in thi
-00028940: 7320 6361 7365 0a20 2020 2020 2020 2020  s case.         
-00028950: 2020 2072 656a 6563 745f 6469 6374 203d     reject_dict =
-00028960: 2064 6565 7063 6f70 7928 7365 6c66 2e5f   deepcopy(self._
-00028970: 696e 7374 7275 6d65 6e74 7329 0a20 2020  instruments).   
-00028980: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00028990: 2020 2020 2020 2072 656a 6563 745f 6469         reject_di
-000289a0: 6374 203d 207b 7d0a 2020 2020 2020 2020  ct = {}.        
-000289b0: 2020 2020 666f 7220 6f20 696e 2061 7265      for o in are
-000289c0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-000289d0: 2020 2066 6f72 2069 2069 6e20 6172 6561     for i in area
-000289e0: 5b6f 5d3a 0a20 2020 2020 2020 2020 2020  [o]:.           
-000289f0: 2020 2020 2020 2020 2069 6620 6675 6c6c           if full
-00028a00: 5f61 7265 615b 6f5d 2021 3d20 303a 0a20  _area[o] != 0:. 
-00028a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a20: 2020 2020 2020 2066 7261 6320 3d20 2861         frac = (a
-00028a30: 7265 615b 6f5d 5b69 5d20 2f20 6675 6c6c  rea[o][i] / full
-00028a40: 5f61 7265 615b 6f5d 290a 2020 2020 2020  _area[o]).      
-00028a50: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00028a60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00028a70: 2020 2020 2020 2020 2020 2020 6672 6163              frac
-00028a80: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00028a90: 2020 2020 2020 2020 2069 6620 6672 6163           if frac
-00028aa0: 203c 3d20 7468 7265 7368 6f6c 645f 6672   <= threshold_fr
-00028ab0: 6163 7469 6f6e 2061 6e64 206f 206e 6f74  action and o not
-00028ac0: 2069 6e20 7265 6a65 6374 5f64 6963 743a   in reject_dict:
-00028ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028ae0: 2020 2020 2020 2020 2072 656a 6563 745f           reject_
-00028af0: 6469 6374 5b6f 5d20 3d20 5b69 5d0a 2020  dict[o] = [i].  
-00028b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b10: 2020 656c 6966 2066 7261 6320 3c3d 2074    elif frac <= t
-00028b20: 6872 6573 686f 6c64 5f66 7261 6374 696f  hreshold_fractio
-00028b30: 6e20 616e 6420 6f20 696e 2072 656a 6563  n and o in rejec
-00028b40: 745f 6469 6374 3a0a 2020 2020 2020 2020  t_dict:.        
+000236c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000236d0: 6d6f 6465 6c73 2061 7265 207b 617d 222e  models are {a}".
+000236e0: 666f 726d 6174 286d 3d6d 6f64 656c 2c20  format(m=model, 
+000236f0: 733d 7365 6c66 2e6e 616d 652c 2061 3d61  s=self.name, a=a
+00023700: 765f 6d6f 6473 2929 0a20 2020 2020 2020  v_mods)).       
+00023710: 2065 6c69 6620 7061 7220 6973 206e 6f74   elif par is not
+00023720: 204e 6f6e 6520 616e 6420 7061 7220 6e6f   None and par no
+00023730: 7420 696e 2073 656c 662e 5f66 6974 5f72  t in self._fit_r
+00023740: 6573 756c 7473 5b73 746f 7261 6765 5f6b  esults[storage_k
+00023750: 6579 5d5b 6d6f 6465 6c5d 3a0a 2020 2020  ey][model]:.    
+00023760: 2020 2020 2020 2020 6176 5f70 6172 7320          av_pars 
+00023770: 3d20 222c 2022 2e6a 6f69 6e28 7365 6c66  = ", ".join(self
+00023780: 2e5f 6669 745f 7265 7375 6c74 735b 7374  ._fit_results[st
+00023790: 6f72 6167 655f 6b65 795d 5b6d 6f64 656c  orage_key][model
+000237a0: 5d2e 6b65 7973 2829 290a 2020 2020 2020  ].keys()).      
+000237b0: 2020 2020 2020 7261 6973 6520 5061 7261        raise Para
+000237c0: 6d65 7465 724e 6f74 4173 736f 6369 6174  meterNotAssociat
+000237d0: 6564 4572 726f 7228 227b 707d 2077 6173  edError("{p} was
+000237e0: 206e 6f74 2061 2066 7265 6520 7061 7261   not a free para
+000237f0: 6d65 7465 7220 696e 2074 6865 207b 6d7d  meter in the {m}
+00023800: 2066 6974 2074 6f20 7b73 7d2c 2022 0a20   fit to {s}, ". 
+00023810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023830: 2020 2020 2020 2020 2020 2020 2022 7468               "th
+00023840: 6520 6f70 7469 6f6e 7320 6172 6520 7b61  e options are {a
+00023850: 7d22 2e66 6f72 6d61 7428 703d 7061 722c  }".format(p=par,
+00023860: 206d 3d6d 6f64 656c 2c20 733d 7365 6c66   m=model, s=self
+00023870: 2e6e 616d 652c 2061 3d61 765f 7061 7273  .name, a=av_pars
+00023880: 2929 0a0a 2020 2020 2020 2020 2320 5265  ))..        # Re
+00023890: 6164 206f 7574 2069 6e74 6f20 7661 7269  ad out into vari
+000238a0: 6162 6c65 2066 6f72 2072 6561 6461 6269  able for readabi
+000238b0: 6c69 7469 6573 2073 616b 650a 2020 2020  lities sake.    
+000238c0: 2020 2020 6669 745f 6461 7461 203d 2073      fit_data = s
+000238d0: 656c 662e 5f66 6974 5f72 6573 756c 7473  elf._fit_results
+000238e0: 5b73 746f 7261 6765 5f6b 6579 5d5b 6d6f  [storage_key][mo
+000238f0: 6465 6c5d 0a20 2020 2020 2020 2070 726f  del].        pro
+00023900: 635f 6461 7461 203d 207b 7d20 2023 2057  c_data = {}  # W
+00023910: 6865 7265 2074 6865 206f 7574 7075 7420  here the output 
+00023920: 7769 6c6c 2069 7665 0a20 2020 2020 2020  will ive.       
+00023930: 2066 6f72 2070 5f6b 6579 2069 6e20 6669   for p_key in fi
+00023940: 745f 6461 7461 3a0a 2020 2020 2020 2020  t_data:.        
+00023950: 2020 2020 2320 5573 6564 2074 6f20 7368      # Used to sh
+00023960: 6170 6520 7468 6520 6e75 6d70 7920 6172  ape the numpy ar
+00023970: 7261 7920 7468 6520 6461 7461 2069 7320  ray the data is 
+00023980: 7472 616e 7366 6572 7265 6420 696e 746f  transferred into
+00023990: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+000239a0: 5f65 6e74 7269 6573 203d 206c 656e 2866  _entries = len(f
+000239b0: 6974 5f64 6174 615b 705f 6b65 795d 290a  it_data[p_key]).
+000239c0: 2020 2020 2020 2020 2020 2020 2320 2745              # 'E
+000239d0: 6d70 7479 2720 6e65 7720 6172 7261 7920  mpty' new array 
+000239e0: 746f 2077 7269 7465 206f 7574 2074 6865  to write out the
+000239f0: 2072 6573 756c 7473 2069 6e74 6f2c 2064   results into, d
+00023a00: 6f6e 6520 6c69 6b65 2074 6869 7320 6265  one like this be
+00023a10: 6361 7573 6520 7265 7375 6c74 7320 6172  cause results ar
+00023a20: 6520 7374 6f72 6564 0a20 2020 2020 2020  e stored.       
+00023a30: 2020 2020 2023 2020 696e 206e 6573 7465       #  in neste
+00023a40: 6420 6469 6374 696f 6e61 7269 6573 2077  d dictionaries w
+00023a50: 6974 6820 7468 6569 7220 5853 5045 4320  ith their XSPEC 
+00023a60: 7061 7261 6d65 7465 7220 6e75 6d62 6572  parameter number
+00023a70: 2061 7320 616e 2065 7874 7261 206b 6579   as an extra key
+00023a80: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00023a90: 5f64 6174 6120 3d20 6e70 2e7a 6572 6f73  _data = np.zeros
+00023aa0: 2828 6e75 6d5f 656e 7472 6965 732c 2033  ((num_entries, 3
+00023ab0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+00023ac0: 2320 4966 2061 2070 6172 616d 6574 6572  # If a parameter
+00023ad0: 2069 7320 756e 6c69 6e6b 6564 2069 6e20   is unlinked in 
+00023ae0: 6120 6669 7420 7769 7468 206d 756c 7469  a fit with multi
+00023af0: 706c 6520 7370 6563 7472 6120 286c 696b  ple spectra (lik
+00023b00: 6520 6e6f 726d 616c 6973 6174 696f 6e20  e normalisation 
+00023b10: 666f 7220 696e 7374 616e 6365 292c 0a20  for instance),. 
+00023b20: 2020 2020 2020 2020 2020 2023 2020 7468             #  th
+00023b30: 6572 6520 6361 6e20 6265 204e 2065 6e74  ere can be N ent
+00023b40: 7269 6573 2066 6f72 2074 6865 2073 616d  ries for the sam
+00023b50: 6520 7061 7261 6d65 7465 722c 2077 7269  e parameter, wri
+00023b60: 7469 6e67 2074 6865 6d20 6f75 7420 696e  ting them out in
+00023b70: 206f 7264 6572 2074 6f20 6120 6e75 6d70   order to a nump
+00023b80: 7920 6172 7261 790a 2020 2020 2020 2020  y array.        
+00023b90: 2020 2020 666f 7220 696e 6372 2c20 7061      for incr, pa
+00023ba0: 725f 696e 6465 7820 696e 2065 6e75 6d65  r_index in enume
+00023bb0: 7261 7465 2866 6974 5f64 6174 615b 705f  rate(fit_data[p_
+00023bc0: 6b65 795d 293a 0a20 2020 2020 2020 2020  key]):.         
+00023bd0: 2020 2020 2020 206e 6577 5f64 6174 615b         new_data[
+00023be0: 696e 6372 2c20 3a5d 203d 2066 6974 5f64  incr, :] = fit_d
+00023bf0: 6174 615b 705f 6b65 795d 5b70 6172 5f69  ata[p_key][par_i
+00023c00: 6e64 6578 5d0a 0a20 2020 2020 2020 2020  ndex]..         
+00023c10: 2020 2023 204a 7573 7420 6d61 6b65 7320     # Just makes 
+00023c20: 7468 6520 6f75 7470 7574 2061 206c 6974  the output a lit
+00023c30: 746c 6520 6e69 6365 7220 6966 2074 6865  tle nicer if the
+00023c40: 7265 2069 7320 6f6e 6c79 206f 6e65 2065  re is only one e
+00023c50: 6e74 7279 0a20 2020 2020 2020 2020 2020  ntry.           
+00023c60: 2069 6620 6e65 775f 6461 7461 2e73 6861   if new_data.sha
+00023c70: 7065 5b30 5d20 3d3d 2031 3a0a 2020 2020  pe[0] == 1:.    
+00023c80: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+00023c90: 5f64 6174 615b 705f 6b65 795d 203d 206e  _data[p_key] = n
+00023ca0: 6577 5f64 6174 615b 305d 0a20 2020 2020  ew_data[0].     
+00023cb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00023cc0: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+00023cd0: 635f 6461 7461 5b70 5f6b 6579 5d20 3d20  c_data[p_key] = 
+00023ce0: 6e65 775f 6461 7461 0a0a 2020 2020 2020  new_data..      
+00023cf0: 2020 2320 4966 206e 6f20 7370 6563 6966    # If no specif
+00023d00: 6963 2070 6172 616d 6574 6572 2077 6173  ic parameter was
+00023d10: 2072 6571 7565 7374 6564 2c20 7468 6520   requested, the 
+00023d20: 7573 6572 2067 6574 7320 616c 6c20 6f66  user gets all of
+00023d30: 2074 6865 6d0a 2020 2020 2020 2020 6966   them.        if
+00023d40: 2070 6172 2069 7320 4e6f 6e65 3a0a 2020   par is None:.  
+00023d50: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00023d60: 2070 726f 635f 6461 7461 0a20 2020 2020   proc_data.     
+00023d70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00023d80: 2020 2020 2072 6574 7572 6e20 7072 6f63       return proc
+00023d90: 5f64 6174 615b 7061 725d 0a0a 2020 2020  _data[par]..    
+00023da0: 6465 6620 6765 745f 6c75 6d69 6e6f 7369  def get_luminosi
+00023db0: 7469 6573 2873 656c 662c 206f 7574 6572  ties(self, outer
+00023dc0: 5f72 6164 6975 733a 2055 6e69 6f6e 5b73  _radius: Union[s
+00023dd0: 7472 2c20 5175 616e 7469 7479 5d2c 206d  tr, Quantity], m
+00023de0: 6f64 656c 3a20 7374 722c 0a20 2020 2020  odel: str,.     
+00023df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e00: 2020 2020 696e 6e65 725f 7261 6469 7573      inner_radius
+00023e10: 3a20 556e 696f 6e5b 7374 722c 2051 7561  : Union[str, Qua
+00023e20: 6e74 6974 795d 203d 2051 7561 6e74 6974  ntity] = Quantit
+00023e30: 7928 302c 2027 6172 6373 6563 2729 2c20  y(0, 'arcsec'), 
+00023e40: 6c6f 5f65 6e3a 2051 7561 6e74 6974 7920  lo_en: Quantity 
+00023e50: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00023e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e70: 2068 695f 656e 3a20 5175 616e 7469 7479   hi_en: Quantity
+00023e80: 203d 204e 6f6e 652c 2067 726f 7570 5f73   = None, group_s
+00023e90: 7065 633a 2062 6f6f 6c20 3d20 5472 7565  pec: bool = True
+00023ea0: 2c20 6d69 6e5f 636f 756e 7473 3a20 696e  , min_counts: in
+00023eb0: 7420 3d20 352c 206d 696e 5f73 6e3a 2066  t = 5, min_sn: f
+00023ec0: 6c6f 6174 203d 204e 6f6e 652c 0a20 2020  loat = None,.   
+00023ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ee0: 2020 2020 2020 6f76 6572 5f73 616d 706c        over_sampl
+00023ef0: 653a 2066 6c6f 6174 203d 204e 6f6e 6529  e: float = None)
+00023f00: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00023f10: 2020 2020 2020 4765 7420 6d65 7468 6f64        Get method
+00023f20: 2066 6f72 206c 756d 696e 6f73 6974 6965   for luminositie
+00023f30: 7320 6361 6c63 756c 6174 6564 2066 726f  s calculated fro
+00023f40: 6d20 6d6f 6465 6c20 6669 7473 2074 6f20  m model fits to 
+00023f50: 7370 6563 7472 6120 6173 736f 6369 6174  spectra associat
+00023f60: 6564 2077 6974 6820 7468 6973 2073 6f75  ed with this sou
+00023f70: 7263 652e 0a20 2020 2020 2020 2045 6974  rce..        Eit
+00023f80: 6865 7220 666f 7220 6769 7665 6e20 656e  her for given en
+00023f90: 6572 6779 206c 696d 6974 7320 2874 6861  ergy limits (tha
+00023fa0: 7420 6d75 7374 2068 6176 6520 6265 656e  t must have been
+00023fb0: 2073 7065 6369 6669 6564 2077 6865 6e20   specified when 
+00023fc0: 7468 6520 6669 7420 7761 7320 6669 7273  the fit was firs
+00023fd0: 7420 7065 7266 6f72 6d65 6429 2c20 6f72  t performed), or
+00023fe0: 0a20 2020 2020 2020 2066 6f72 2061 6c6c  .        for all
+00023ff0: 206c 756d 696e 6f73 6974 6965 7320 6173   luminosities as
+00024000: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
+00024010: 6174 206d 6f64 656c 2e20 4c75 6d69 6e6f  at model. Lumino
+00024020: 7369 7469 6573 2061 7265 2072 6574 7572  sities are retur
+00024030: 6e65 6420 6173 2061 2033 2063 6f6c 756d  ned as a 3 colum
+00024040: 6e20 6e75 6d70 7920 6172 7261 793b 0a20  n numpy array;. 
+00024050: 2020 2020 2020 2074 6865 2030 7468 2063         the 0th c
+00024060: 6f6c 756d 6e20 6973 2074 6865 2076 616c  olumn is the val
+00024070: 7565 2c20 7468 6520 3173 7420 636f 6c75  ue, the 1st colu
+00024080: 6d6e 2069 7320 7468 6520 6572 722d 2c20  mn is the err-, 
+00024090: 616e 6420 7468 6520 326e 6420 6973 2065  and the 2nd is e
+000240a0: 7272 2b2e 0a0a 2020 2020 2020 2020 3a70  rr+...        :p
+000240b0: 6172 616d 2073 7472 2f51 7561 6e74 6974  aram str/Quantit
+000240c0: 7920 6f75 7465 725f 7261 6469 7573 3a20  y outer_radius: 
+000240d0: 5468 6520 6e61 6d65 206f 7220 7661 6c75  The name or valu
+000240e0: 6520 6f66 2074 6865 206f 7574 6572 2072  e of the outer r
+000240f0: 6164 6975 7320 7468 6174 2077 6173 2075  adius that was u
+00024100: 7365 6420 666f 7220 7468 6520 6765 6e65  sed for the gene
+00024110: 7261 7469 6f6e 206f 660a 2020 2020 2020  ration of.      
+00024120: 2020 2020 2020 7468 6520 7370 6563 7472        the spectr
+00024130: 6120 7768 6963 6820 7765 7265 2066 6974  a which were fit
+00024140: 7465 6420 746f 2070 726f 6475 6365 2074  ted to produce t
+00024150: 6865 2064 6573 6972 6564 2072 6573 756c  he desired resul
+00024160: 7420 2866 6f72 2069 6e73 7461 6e63 6520  t (for instance 
+00024170: 2772 3230 3027 2077 6f75 6c64 2062 6520  'r200' would be 
+00024180: 6163 6365 7074 6162 6c65 0a20 2020 2020  acceptable.     
+00024190: 2020 2020 2020 2066 6f72 2061 2047 616c         for a Gal
+000241a0: 6178 7943 6c75 7374 6572 2c20 6f72 2051  axyCluster, or Q
+000241b0: 7561 6e74 6974 7928 3130 3030 2c20 276b  uantity(1000, 'k
+000241c0: 7063 2729 292e 2049 6620 2772 6567 696f  pc')). If 'regio
+000241d0: 6e27 2069 7320 6368 6f73 656e 2028 746f  n' is chosen (to
+000241e0: 2075 7365 2074 6865 2072 6567 696f 6e73   use the regions
+000241f0: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
+00024200: 7265 6769 6f6e 2066 696c 6573 292c 2074  region files), t
+00024210: 6865 6e20 616e 7920 696e 6e65 7220 7261  hen any inner ra
+00024220: 6469 7573 2077 696c 6c20 6265 2069 676e  dius will be ign
+00024230: 6f72 6564 2e0a 2020 2020 2020 2020 3a70  ored..        :p
+00024240: 6172 616d 2073 7472 206d 6f64 656c 3a20  aram str model: 
+00024250: 5468 6520 6e61 6d65 206f 6620 7468 6520  The name of the 
+00024260: 6669 7474 6564 206d 6f64 656c 2074 6861  fitted model tha
+00024270: 7420 796f 7527 7265 2072 6571 7565 7374  t you're request
+00024280: 696e 6720 7468 6520 6c75 6d69 6e6f 7369  ing the luminosi
+00024290: 7469 6573 0a20 2020 2020 2020 2020 2020  ties.           
+000242a0: 2066 726f 6d20 2865 2e67 2e20 636f 6e73   from (e.g. cons
+000242b0: 7461 6e74 2a74 6261 6273 2a61 7065 6329  tant*tbabs*apec)
+000242c0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+000242d0: 2073 7472 2f51 7561 6e74 6974 7920 696e   str/Quantity in
+000242e0: 6e65 725f 7261 6469 7573 3a20 5468 6520  ner_radius: The 
+000242f0: 6e61 6d65 206f 7220 7661 6c75 6520 6f66  name or value of
+00024300: 2074 6865 2069 6e6e 6572 2072 6164 6975   the inner radiu
+00024310: 7320 7468 6174 2077 6173 2075 7365 6420  s that was used 
+00024320: 666f 7220 7468 6520 6765 6e65 7261 7469  for the generati
+00024330: 6f6e 206f 660a 2020 2020 2020 2020 2020  on of.          
+00024340: 2020 7468 6520 7370 6563 7472 6120 7768    the spectra wh
+00024350: 6963 6820 7765 7265 2066 6974 7465 6420  ich were fitted 
+00024360: 746f 2070 726f 6475 6365 2074 6865 2064  to produce the d
+00024370: 6573 6972 6564 2072 6573 756c 7420 2866  esired result (f
+00024380: 6f72 2069 6e73 7461 6e63 6520 2772 3530  or instance 'r50
+00024390: 3027 2077 6f75 6c64 2062 6520 6163 6365  0' would be acce
+000243a0: 7074 6162 6c65 0a20 2020 2020 2020 2020  ptable.         
+000243b0: 2020 2066 6f72 2061 2047 616c 6178 7943     for a GalaxyC
+000243c0: 6c75 7374 6572 2c20 6f72 2051 7561 6e74  luster, or Quant
+000243d0: 6974 7928 3330 302c 2027 6b70 6327 2929  ity(300, 'kpc'))
+000243e0: 2e20 4279 2064 6566 6175 6c74 2074 6869  . By default thi
+000243f0: 7320 6973 207a 6572 6f20 6172 6373 6563  s is zero arcsec
+00024400: 6f6e 6473 2c20 7265 7375 6c74 696e 6720  onds, resulting 
+00024410: 696e 2061 0a20 2020 2020 2020 2020 2020  in a.           
+00024420: 2063 6972 6375 6c61 7220 7370 6563 7472   circular spectr
+00024430: 756d 2e0a 2020 2020 2020 2020 3a70 6172  um..        :par
+00024440: 616d 2051 7561 6e74 6974 7920 6c6f 5f65  am Quantity lo_e
+00024450: 6e3a 2054 6865 206c 6f77 6572 2065 6e65  n: The lower ene
+00024460: 7267 7920 6c69 6d69 7420 666f 7220 7468  rgy limit for th
+00024470: 6520 6465 7369 7265 6420 6c75 6d69 6e6f  e desired lumino
+00024480: 7369 7479 206d 6561 7375 7265 6d65 6e74  sity measurement
+00024490: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+000244a0: 2051 7561 6e74 6974 7920 6869 5f65 6e3a   Quantity hi_en:
+000244b0: 2054 6865 2075 7070 6572 2065 6e65 7267   The upper energ
+000244c0: 7920 6c69 6d69 7420 666f 7220 7468 6520  y limit for the 
+000244d0: 6465 7369 7265 6420 6c75 6d69 6e6f 7369  desired luminosi
+000244e0: 7479 206d 6561 7375 7265 6d65 6e74 2e0a  ty measurement..
+000244f0: 2020 2020 2020 2020 3a70 6172 616d 2062          :param b
+00024500: 6f6f 6c20 6772 6f75 705f 7370 6563 3a20  ool group_spec: 
+00024510: 5768 6574 6865 7220 7468 6520 7370 6563  Whether the spec
+00024520: 7472 6120 7468 6174 2077 6572 6520 6669  tra that were fi
+00024530: 7474 6564 2066 6f72 2074 6865 2064 6573  tted for the des
+00024540: 6972 6564 2072 6573 756c 7420 7765 7265  ired result were
+00024550: 2067 726f 7570 6564 2e0a 2020 2020 2020   grouped..      
+00024560: 2020 3a70 6172 616d 2066 6c6f 6174 206d    :param float m
+00024570: 696e 5f63 6f75 6e74 733a 2054 6865 206d  in_counts: The m
+00024580: 696e 696d 756d 2063 6f75 6e74 7320 7065  inimum counts pe
+00024590: 7220 6368 616e 6e65 6c2c 2069 6620 7468  r channel, if th
+000245a0: 6520 7370 6563 7472 6120 7468 6174 2077  e spectra that w
+000245b0: 6572 6520 6669 7474 6564 2066 6f72 2074  ere fitted for t
+000245c0: 6865 0a20 2020 2020 2020 2020 2020 2064  he.            d
+000245d0: 6573 6972 6564 2072 6573 756c 7420 7765  esired result we
+000245e0: 7265 2067 726f 7570 6564 2062 7920 6d69  re grouped by mi
+000245f0: 6e69 6d75 6d20 636f 756e 7473 2e0a 2020  nimum counts..  
+00024600: 2020 2020 2020 3a70 6172 616d 2066 6c6f        :param flo
+00024610: 6174 206d 696e 5f73 6e3a 2054 6865 206d  at min_sn: The m
+00024620: 696e 696d 756d 2073 6967 6e61 6c20 746f  inimum signal to
+00024630: 206e 6f69 7365 2070 6572 2063 6861 6e6e   noise per chann
+00024640: 656c 2c20 6966 2074 6865 2073 7065 6374  el, if the spect
+00024650: 7261 2074 6861 7420 7765 7265 2066 6974  ra that were fit
+00024660: 7465 6420 666f 7220 7468 650a 2020 2020  ted for the.    
+00024670: 2020 2020 2020 2020 6465 7369 7265 6420          desired 
+00024680: 7265 7375 6c74 2077 6572 6520 6772 6f75  result were grou
+00024690: 7065 6420 6279 206d 696e 696d 756d 2073  ped by minimum s
+000246a0: 6967 6e61 6c20 746f 206e 6f69 7365 2e0a  ignal to noise..
+000246b0: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
+000246c0: 6c6f 6174 206f 7665 725f 7361 6d70 6c65  loat over_sample
+000246d0: 3a20 5468 6520 6c65 7665 6c20 6f66 206f  : The level of o
+000246e0: 7665 7273 616d 706c 696e 6720 6170 706c  versampling appl
+000246f0: 6965 6420 6f6e 2074 6865 2073 7065 6374  ied on the spect
+00024700: 7261 2074 6861 7420 7765 7265 2066 6974  ra that were fit
+00024710: 7465 642e 0a20 2020 2020 2020 203a 7265  ted..        :re
+00024720: 7475 726e 3a20 5468 6520 7265 7175 6573  turn: The reques
+00024730: 7465 6420 6c75 6d69 6e6f 7369 7479 2076  ted luminosity v
+00024740: 616c 7565 2c20 616e 6420 756e 6365 7274  alue, and uncert
+00024750: 6169 6e74 6965 732e 0a20 2020 2020 2020  ainties..       
+00024760: 2022 2222 0a20 2020 2020 2020 2023 2046   """.        # F
+00024770: 6972 7374 2049 2077 616e 7420 746f 2072  irst I want to r
+00024780: 6574 7269 6576 6520 7468 6520 7370 6563  etrieve the spec
+00024790: 7472 6120 7468 6174 2077 6572 6520 6669  tra that were fi
+000247a0: 7474 6564 2074 6f20 7072 6f64 7563 6520  tted to produce 
+000247b0: 7468 6520 7265 7375 6c74 2074 6865 7927  the result they'
+000247c0: 7265 206c 6f6f 6b69 6e67 2066 6f72 2c0a  re looking for,.
+000247d0: 2020 2020 2020 2020 2320 2062 6563 6175          #  becau
+000247e0: 7365 2074 6865 6e20 4920 6361 6e20 6a75  se then I can ju
+000247f0: 7374 2067 7261 6220 7468 6520 7374 6f72  st grab the stor
+00024800: 6167 6520 6b65 7920 6672 6f6d 206f 6e65  age key from one
+00024810: 206f 6620 7468 656d 0a20 2020 2020 2020   of them.       
+00024820: 2073 7065 6373 203d 2073 656c 662e 6765   specs = self.ge
+00024830: 745f 7370 6563 7472 6128 6f75 7465 725f  t_spectra(outer_
+00024840: 7261 6469 7573 2c20 4e6f 6e65 2c20 4e6f  radius, None, No
+00024850: 6e65 2c20 696e 6e65 725f 7261 6469 7573  ne, inner_radius
+00024860: 2c20 6772 6f75 705f 7370 6563 2c20 6d69  , group_spec, mi
+00024870: 6e5f 636f 756e 7473 2c20 6d69 6e5f 736e  n_counts, min_sn
+00024880: 2c20 6f76 6572 5f73 616d 706c 6529 0a20  , over_sample). 
+00024890: 2020 2020 2020 2023 2049 206a 7573 7420         # I just 
+000248a0: 7461 6b65 2074 6865 2066 6972 7374 2073  take the first s
+000248b0: 7065 6374 7275 6d20 696e 2074 6865 206c  pectrum in the l
+000248c0: 6973 7420 6265 6361 7573 6520 7468 6520  ist because the 
+000248d0: 7374 6f72 6167 6520 6b65 7920 7769 6c6c  storage key will
+000248e0: 2062 6520 7468 6520 7361 6d65 2066 6f72   be the same for
+000248f0: 2061 6c6c 206f 6620 7468 656d 0a20 2020   all of them.   
+00024900: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00024910: 6365 2873 7065 6373 2c20 6c69 7374 293a  ce(specs, list):
+00024920: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
+00024930: 7261 6765 5f6b 6579 203d 2073 7065 6373  rage_key = specs
+00024940: 5b30 5d2e 7374 6f72 6167 655f 6b65 790a  [0].storage_key.
+00024950: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00024960: 2020 2020 2020 2020 2020 7374 6f72 6167            storag
+00024970: 655f 6b65 7920 3d20 7370 6563 732e 7374  e_key = specs.st
+00024980: 6f72 6167 655f 6b65 790a 0a20 2020 2020  orage_key..     
+00024990: 2020 2023 2043 6865 636b 696e 6720 7468     # Checking th
+000249a0: 6520 696e 7075 7420 656e 6572 6779 206c  e input energy l
+000249b0: 696d 6974 7320 6172 6520 7661 6c69 642c  imits are valid,
+000249c0: 2061 6e64 2061 7373 656d 626c 6573 2074   and assembles t
+000249d0: 6865 206b 6579 2074 6f20 6c6f 6f6b 2066  he key to look f
+000249e0: 6f72 206c 756d 7320 696e 2074 686f 7365  or lums in those
+000249f0: 2065 6e65 7267 790a 2020 2020 2020 2020   energy.        
+00024a00: 2320 2062 6f75 6e64 732e 2049 6620 7468  #  bounds. If th
+00024a10: 6520 6c69 6d69 7473 2061 7265 206e 6f6e  e limits are non
+00024a20: 6520 7468 656e 2073 6f20 6973 2074 6865  e then so is the
+00024a30: 2065 6e65 7267 7920 6b65 790a 2020 2020   energy key.    
+00024a40: 2020 2020 6966 206c 6f5f 656e 2069 7320      if lo_en is 
+00024a50: 6e6f 7420 4e6f 6e65 2061 6e64 2068 695f  not None and hi_
+00024a60: 656e 2069 7320 6e6f 7420 4e6f 6e65 2061  en is not None a
+00024a70: 6e64 206c 6f5f 656e 203e 2068 695f 656e  nd lo_en > hi_en
+00024a80: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00024a90: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00024aa0: 5468 6520 6c6f 7720 656e 6572 6779 206c  The low energy l
+00024ab0: 696d 6974 2063 616e 6e6f 7420 6265 2067  imit cannot be g
+00024ac0: 7265 6174 6572 2074 6861 6e20 7468 6520  reater than the 
+00024ad0: 6869 6768 2065 6e65 7267 7920 6c69 6d69  high energy limi
+00024ae0: 7422 290a 2020 2020 2020 2020 656c 6966  t").        elif
+00024af0: 206c 6f5f 656e 2069 7320 6e6f 7420 4e6f   lo_en is not No
+00024b00: 6e65 2061 6e64 2068 695f 656e 2069 7320  ne and hi_en is 
+00024b10: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00024b20: 2020 2020 2020 656e 5f6b 6579 203d 2022        en_key = "
+00024b30: 626f 756e 645f 7b6c 7d2d 7b75 7d22 2e66  bound_{l}-{u}".f
+00024b40: 6f72 6d61 7428 6c3d 6c6f 5f65 6e2e 746f  ormat(l=lo_en.to
+00024b50: 2822 6b65 5622 292e 7661 6c75 652c 2075  ("keV").value, u
+00024b60: 3d68 695f 656e 2e74 6f28 226b 6556 2229  =hi_en.to("keV")
+00024b70: 2e76 616c 7565 290a 2020 2020 2020 2020  .value).        
+00024b80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00024b90: 2020 656e 5f6b 6579 203d 204e 6f6e 650a    en_key = None.
+00024ba0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
+00024bb0: 7320 7468 6174 2074 6865 2072 6571 7565  s that the reque
+00024bc0: 7374 6564 2072 6567 696f 6e2c 206d 6f64  sted region, mod
+00024bd0: 656c 2061 6e64 2065 6e65 7267 7920 6261  el and energy ba
+00024be0: 6e64 2061 6374 7561 6c6c 7920 6578 6973  nd actually exis
+00024bf0: 740a 2020 2020 2020 2020 6966 206c 656e  t.        if len
+00024c00: 2873 656c 662e 5f6c 756d 696e 6f73 6974  (self._luminosit
+00024c10: 6965 7329 203d 3d20 303a 0a20 2020 2020  ies) == 0:.     
+00024c20: 2020 2020 2020 2072 6169 7365 204d 6f64         raise Mod
+00024c30: 656c 4e6f 7441 7373 6f63 6961 7465 6445  elNotAssociatedE
+00024c40: 7272 6f72 2822 5468 6572 6520 6172 6520  rror("There are 
+00024c50: 6e6f 2058 5350 4543 2066 6974 7320 6173  no XSPEC fits as
+00024c60: 736f 6369 6174 6564 2077 6974 6820 7b73  sociated with {s
+00024c70: 7d22 2e66 6f72 6d61 7428 733d 7365 6c66  }".format(s=self
+00024c80: 2e6e 616d 6529 290a 2020 2020 2020 2020  .name)).        
+00024c90: 656c 6966 2073 746f 7261 6765 5f6b 6579  elif storage_key
+00024ca0: 206e 6f74 2069 6e20 7365 6c66 2e5f 6c75   not in self._lu
+00024cb0: 6d69 6e6f 7369 7469 6573 3a0a 2020 2020  minosities:.    
+00024cc0: 2020 2020 2020 2020 7261 6973 6520 4d6f          raise Mo
+00024cd0: 6465 6c4e 6f74 4173 736f 6369 6174 6564  delNotAssociated
+00024ce0: 4572 726f 7228 2254 6865 7365 2073 7065  Error("These spe
+00024cf0: 6374 7261 2068 6176 6520 6e6f 2061 7373  ctra have no ass
+00024d00: 6f63 6961 7465 6420 5853 5045 4320 6669  ociated XSPEC fi
+00024d10: 7420 746f 207b 737d 2e22 2e66 6f72 6d61  t to {s}.".forma
+00024d20: 7428 733d 7365 6c66 2e6e 616d 6529 290a  t(s=self.name)).
+00024d30: 2020 2020 2020 2020 656c 6966 206d 6f64          elif mod
+00024d40: 656c 206e 6f74 2069 6e20 7365 6c66 2e5f  el not in self._
+00024d50: 6c75 6d69 6e6f 7369 7469 6573 5b73 746f  luminosities[sto
+00024d60: 7261 6765 5f6b 6579 5d3a 0a20 2020 2020  rage_key]:.     
+00024d70: 2020 2020 2020 2061 765f 6d6f 6473 203d         av_mods =
+00024d80: 2022 2c20 222e 6a6f 696e 2873 656c 662e   ", ".join(self.
+00024d90: 5f6c 756d 696e 6f73 6974 6965 735b 7374  _luminosities[st
+00024da0: 6f72 6167 655f 6b65 795d 2e6b 6579 7328  orage_key].keys(
+00024db0: 2929 0a20 2020 2020 2020 2020 2020 2072  )).            r
+00024dc0: 6169 7365 204d 6f64 656c 4e6f 7441 7373  aise ModelNotAss
+00024dd0: 6f63 6961 7465 6445 7272 6f72 2822 7b6d  ociatedError("{m
+00024de0: 7d20 6861 7320 6e6f 7420 6265 656e 2066  } has not been f
+00024df0: 6974 7465 6420 746f 2074 6865 7365 2073  itted to these s
+00024e00: 7065 6374 7261 206f 6620 7b73 7d3b 2022  pectra of {s}; "
+00024e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e30: 2020 2020 2020 2020 2020 2022 6176 6169             "avai
+00024e40: 6c61 626c 6520 6d6f 6465 6c73 2061 7265  lable models are
+00024e50: 207b 617d 222e 666f 726d 6174 286d 3d6d   {a}".format(m=m
+00024e60: 6f64 656c 2c20 733d 7365 6c66 2e6e 616d  odel, s=self.nam
+00024e70: 652c 2061 3d61 765f 6d6f 6473 2929 0a20  e, a=av_mods)). 
+00024e80: 2020 2020 2020 2065 6c69 6620 656e 5f6b         elif en_k
+00024e90: 6579 2069 7320 6e6f 7420 4e6f 6e65 2061  ey is not None a
+00024ea0: 6e64 2065 6e5f 6b65 7920 6e6f 7420 696e  nd en_key not in
+00024eb0: 2073 656c 662e 5f6c 756d 696e 6f73 6974   self._luminosit
+00024ec0: 6965 735b 7374 6f72 6167 655f 6b65 795d  ies[storage_key]
+00024ed0: 5b6d 6f64 656c 5d3a 0a20 2020 2020 2020  [model]:.       
+00024ee0: 2020 2020 2061 765f 6261 6e64 7320 3d20       av_bands = 
+00024ef0: 222c 2022 2e6a 6f69 6e28 5b65 6e2e 7370  ", ".join([en.sp
+00024f00: 6c69 7428 225f 2229 5b2d 315d 202b 2022  lit("_")[-1] + "
+00024f10: 6b65 5622 2066 6f72 2065 6e20 696e 2073  keV" for en in s
+00024f20: 656c 662e 5f6c 756d 696e 6f73 6974 6965  elf._luminositie
+00024f30: 735b 7374 6f72 6167 655f 6b65 795d 5b6d  s[storage_key][m
+00024f40: 6f64 656c 5d2e 6b65 7973 2829 5d29 0a20  odel].keys()]). 
+00024f50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00024f60: 2050 6172 616d 6574 6572 4e6f 7441 7373   ParameterNotAss
+00024f70: 6f63 6961 7465 6445 7272 6f72 2822 7b6c  ociatedError("{l
+00024f80: 7d2d 7b75 7d6b 6556 2077 6173 206e 6f74  }-{u}keV was not
+00024f90: 2061 6e20 656e 6572 6779 2062 616e 6420   an energy band 
+00024fa0: 666f 7220 7468 6520 6669 7420 7769 7468  for the fit with
+00024fb0: 207b 6d7d 3b20 6176 6169 6c61 626c 6520   {m}; available 
+00024fc0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00024fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ff0: 2265 6e65 7267 7920 6261 6e64 7320 6172  "energy bands ar
+00025000: 6520 7b62 7d22 2e66 6f72 6d61 7428 6c3d  e {b}".format(l=
+00025010: 6c6f 5f65 6e2e 746f 2822 6b65 5622 292e  lo_en.to("keV").
+00025020: 7661 6c75 652c 0a20 2020 2020 2020 2020  value,.         
+00025030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025070: 2020 2075 3d68 695f 656e 2e74 6f28 226b     u=hi_en.to("k
+00025080: 6556 2229 2e76 616c 7565 2c0a 2020 2020  eV").value,.    
+00025090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000250a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000250b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000250c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000250d0: 2020 2020 2020 2020 6d3d 6d6f 6465 6c2c          m=model,
+000250e0: 2062 3d61 765f 6261 6e64 7329 290a 0a20   b=av_bands)).. 
+000250f0: 2020 2020 2020 2023 2049 6620 6e6f 206c         # If no l
+00025100: 696d 6974 7320 7370 6563 6966 6965 642c  imits specified,
+00025110: 7468 6520 7573 6572 2067 6574 7320 616c  the user gets al
+00025120: 6c20 7468 6520 6c75 6d69 6e6f 7369 7469  l the luminositi
+00025130: 6573 2c20 6f74 6865 7277 6973 6520 7468  es, otherwise th
+00025140: 6579 2067 6574 2074 6865 206f 6e65 2074  ey get the one t
+00025150: 6865 7920 6173 6b65 6420 666f 720a 2020  hey asked for.  
+00025160: 2020 2020 2020 6966 2065 6e5f 6b65 7920        if en_key 
+00025170: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00025180: 2020 2020 2070 6172 7365 645f 6c75 6d73       parsed_lums
+00025190: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+000251a0: 2020 666f 7220 6c75 6d5f 6b65 7920 696e    for lum_key in
+000251b0: 2073 656c 662e 5f6c 756d 696e 6f73 6974   self._luminosit
+000251c0: 6965 735b 7374 6f72 6167 655f 6b65 795d  ies[storage_key]
+000251d0: 5b6d 6f64 656c 5d3a 0a20 2020 2020 2020  [model]:.       
+000251e0: 2020 2020 2020 2020 206c 756d 5f76 616c           lum_val
+000251f0: 7565 203d 2073 656c 662e 5f6c 756d 696e  ue = self._lumin
+00025200: 6f73 6974 6965 735b 7374 6f72 6167 655f  osities[storage_
+00025210: 6b65 795d 5b6d 6f64 656c 5d5b 6c75 6d5f  key][model][lum_
+00025220: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
+00025230: 2020 2020 2070 6172 7365 645f 6c75 6d20       parsed_lum 
+00025240: 3d20 5175 616e 7469 7479 285b 6c75 6d2e  = Quantity([lum.
+00025250: 7661 6c75 6520 666f 7220 6c75 6d20 696e  value for lum in
+00025260: 206c 756d 5f76 616c 7565 5d2c 206c 756d   lum_value], lum
+00025270: 5f76 616c 7565 5b30 5d2e 756e 6974 290a  _value[0].unit).
+00025280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025290: 7061 7273 6564 5f6c 756d 735b 6c75 6d5f  parsed_lums[lum_
+000252a0: 6b65 795d 203d 2070 6172 7365 645f 6c75  key] = parsed_lu
+000252b0: 6d0a 2020 2020 2020 2020 2020 2020 7265  m.            re
+000252c0: 7475 726e 2070 6172 7365 645f 6c75 6d73  turn parsed_lums
+000252d0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000252e0: 2020 2020 2020 2020 2020 206c 756d 5f76             lum_v
+000252f0: 616c 7565 203d 2073 656c 662e 5f6c 756d  alue = self._lum
+00025300: 696e 6f73 6974 6965 735b 7374 6f72 6167  inosities[storag
+00025310: 655f 6b65 795d 5b6d 6f64 656c 5d5b 656e  e_key][model][en
+00025320: 5f6b 6579 5d0a 2020 2020 2020 2020 2020  _key].          
+00025330: 2020 7061 7273 6564 5f6c 756d 203d 2051    parsed_lum = Q
+00025340: 7561 6e74 6974 7928 5b6c 756d 2e76 616c  uantity([lum.val
+00025350: 7565 2066 6f72 206c 756d 2069 6e20 6c75  ue for lum in lu
+00025360: 6d5f 7661 6c75 655d 2c20 6c75 6d5f 7661  m_value], lum_va
+00025370: 6c75 655b 305d 2e75 6e69 7429 0a20 2020  lue[0].unit).   
+00025380: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00025390: 7061 7273 6564 5f6c 756d 0a0a 2020 2020  parsed_lum..    
+000253a0: 6465 6620 636f 6e76 6572 745f 7261 6469  def convert_radi
+000253b0: 7573 2873 656c 662c 2072 6164 6975 733a  us(self, radius:
+000253c0: 2051 7561 6e74 6974 792c 206f 7574 5f75   Quantity, out_u
+000253d0: 6e69 743a 2055 6e69 6f6e 5b55 6e69 742c  nit: Union[Unit,
+000253e0: 2073 7472 5d20 3d20 2764 6567 2729 202d   str] = 'deg') -
+000253f0: 3e20 5175 616e 7469 7479 3a0a 2020 2020  > Quantity:.    
+00025400: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00025410: 4120 7369 6d70 6c65 206d 6574 686f 6420  A simple method 
+00025420: 746f 2063 6f6e 7665 7274 2072 6164 6969  to convert radii
+00025430: 2062 6574 7765 656e 2064 6966 6665 7265   between differe
+00025440: 6e74 2064 6973 7461 6e63 6520 756e 6974  nt distance unit
+00025450: 732c 2069 7420 6175 746f 6d61 7469 6361  s, it automatica
+00025460: 6c6c 7920 6368 6563 6b73 2077 6865 7468  lly checks wheth
+00025470: 6572 0a20 2020 2020 2020 2074 6865 2072  er.        the r
+00025480: 6571 7565 7374 6564 2063 6f6e 7665 7273  equested convers
+00025490: 696f 6e20 6973 2070 6f73 7369 626c 652c  ion is possible,
+000254a0: 2067 6976 656e 2061 7661 696c 6162 6c65   given available
+000254b0: 2069 6e66 6f72 6d61 7469 6f6e 2e20 466f   information. Fo
+000254c0: 7220 696e 7374 616e 6365 2069 7420 776f  r instance it wo
+000254d0: 756c 6420 6661 696c 2069 6620 796f 750a  uld fail if you.
+000254e0: 2020 2020 2020 2020 7265 7175 6573 7465          requeste
+000254f0: 6420 6120 636f 6e76 6572 7369 6f6e 2066  d a conversion f
+00025500: 726f 6d20 6172 6373 6563 6f6e 6473 2074  rom arcseconds t
+00025510: 6f20 6120 7072 6f70 6572 2064 6973 7461  o a proper dista
+00025520: 6e63 6520 6966 206e 6f20 7265 6473 6869  nce if no redshi
+00025530: 6674 2069 6e66 6f72 6d61 7469 6f6e 2077  ft information w
+00025540: 6572 6520 6176 6169 6c61 626c 652e 0a0a  ere available...
+00025550: 2020 2020 2020 2020 3a70 6172 616d 2051          :param Q
+00025560: 7561 6e74 6974 7920 7261 6469 7573 3a20  uantity radius: 
+00025570: 5468 6520 7261 6469 7573 2074 6f20 636f  The radius to co
+00025580: 6e76 6572 7420 746f 2061 206e 6577 2075  nvert to a new u
+00025590: 6e69 742e 0a20 2020 2020 2020 203a 7061  nit..        :pa
+000255a0: 7261 6d20 556e 6974 2f73 7472 206f 7574  ram Unit/str out
+000255b0: 5f75 6e69 743a 2054 6865 2075 6e69 7420  _unit: The unit 
+000255c0: 746f 2063 6f6e 7665 7274 2074 6865 2069  to convert the i
+000255d0: 6e70 7574 2072 6164 6975 7320 746f 2e0a  nput radius to..
+000255e0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+000255f0: 2054 6865 2063 6f6e 7665 7274 6564 2072   The converted r
+00025600: 6164 6975 730a 2020 2020 2020 2020 3a72  adius.        :r
+00025610: 7479 7065 3a20 5175 616e 7469 7479 0a20  type: Quantity. 
+00025620: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00025630: 2020 2023 2049 6620 6120 7374 7269 6e67     # If a string
+00025640: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
+00025650: 7761 7320 7061 7373 6564 2c20 7765 206d  was passed, we m
+00025660: 616b 6520 6974 2061 6e20 6173 7472 6f70  ake it an astrop
+00025670: 7920 756e 6974 0a20 2020 2020 2020 2069  y unit.        i
+00025680: 6620 6973 696e 7374 616e 6365 286f 7574  f isinstance(out
+00025690: 5f75 6e69 742c 2073 7472 293a 0a20 2020  _unit, str):.   
+000256a0: 2020 2020 2020 2020 206f 7574 5f75 6e69           out_uni
+000256b0: 7420 3d20 556e 6974 286f 7574 5f75 6e69  t = Unit(out_uni
+000256c0: 7429 0a0a 2020 2020 2020 2020 6966 206f  t)..        if o
+000256d0: 7574 5f75 6e69 742e 6973 5f65 7175 6976  ut_unit.is_equiv
+000256e0: 616c 656e 7428 276b 7063 2729 2061 6e64  alent('kpc') and
+000256f0: 2073 656c 662e 5f72 6564 7368 6966 7420   self._redshift 
+00025700: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00025710: 2020 2020 2072 6169 7365 2055 6e69 7443       raise UnitC
+00025720: 6f6e 7665 7273 696f 6e45 7272 6f72 2822  onversionError("
+00025730: 596f 7520 6361 6e6e 6f74 2063 6f6e 7665  You cannot conve
+00025740: 7274 2074 6f20 7468 6973 2075 6e69 7420  rt to this unit 
+00025750: 7769 7468 6f75 7420 7265 6473 6869 6674  without redshift
+00025760: 2069 6e66 6f72 6d61 7469 6f6e 2e22 290a   information.").
+00025770: 0a20 2020 2020 2020 2069 6620 7261 6469  .        if radi
+00025780: 7573 2e75 6e69 742e 6973 5f65 7175 6976  us.unit.is_equiv
+00025790: 616c 656e 7428 2764 6567 2729 2061 6e64  alent('deg') and
+000257a0: 206f 7574 5f75 6e69 742e 6973 5f65 7175   out_unit.is_equ
+000257b0: 6976 616c 656e 7428 2764 6567 2729 3a0a  ivalent('deg'):.
+000257c0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+000257d0: 7261 6420 3d20 7261 6469 7573 2e74 6f28  rad = radius.to(
+000257e0: 6f75 745f 756e 6974 290a 2020 2020 2020  out_unit).      
+000257f0: 2020 656c 6966 2072 6164 6975 732e 756e    elif radius.un
+00025800: 6974 2e69 735f 6571 7569 7661 6c65 6e74  it.is_equivalent
+00025810: 2827 6465 6727 2920 616e 6420 6f75 745f  ('deg') and out_
+00025820: 756e 6974 2e69 735f 6571 7569 7661 6c65  unit.is_equivale
+00025830: 6e74 2827 6b70 6327 293a 0a20 2020 2020  nt('kpc'):.     
+00025840: 2020 2020 2020 206f 7574 5f72 6164 203d         out_rad =
+00025850: 2061 6e67 5f74 6f5f 7261 6428 7261 6469   ang_to_rad(radi
+00025860: 7573 2c20 7365 6c66 2e5f 7265 6473 6869  us, self._redshi
+00025870: 6674 2c20 7365 6c66 2e5f 636f 736d 6f29  ft, self._cosmo)
+00025880: 2e74 6f28 6f75 745f 756e 6974 290a 2020  .to(out_unit).  
+00025890: 2020 2020 2020 656c 6966 2072 6164 6975        elif radiu
+000258a0: 732e 756e 6974 2e69 735f 6571 7569 7661  s.unit.is_equiva
+000258b0: 6c65 6e74 2827 6b70 6327 2920 616e 6420  lent('kpc') and 
+000258c0: 6f75 745f 756e 6974 2e69 735f 6571 7569  out_unit.is_equi
+000258d0: 7661 6c65 6e74 2827 6b70 6327 293a 0a20  valent('kpc'):. 
+000258e0: 2020 2020 2020 2020 2020 206f 7574 5f72             out_r
+000258f0: 6164 203d 2072 6164 6975 732e 746f 286f  ad = radius.to(o
+00025900: 7574 5f75 6e69 7429 0a20 2020 2020 2020  ut_unit).       
+00025910: 2065 6c69 6620 7261 6469 7573 2e75 6e69   elif radius.uni
+00025920: 742e 6973 5f65 7175 6976 616c 656e 7428  t.is_equivalent(
+00025930: 276b 7063 2729 2061 6e64 206f 7574 5f75  'kpc') and out_u
+00025940: 6e69 742e 6973 5f65 7175 6976 616c 656e  nit.is_equivalen
+00025950: 7428 2764 6567 2729 3a0a 2020 2020 2020  t('deg'):.      
+00025960: 2020 2020 2020 6f75 745f 7261 6420 3d20        out_rad = 
+00025970: 7261 645f 746f 5f61 6e67 2872 6164 6975  rad_to_ang(radiu
+00025980: 732c 2073 656c 662e 5f72 6564 7368 6966  s, self._redshif
+00025990: 742c 2073 656c 662e 5f63 6f73 6d6f 292e  t, self._cosmo).
+000259a0: 746f 286f 7574 5f75 6e69 7429 0a20 2020  to(out_unit).   
+000259b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000259c0: 2020 2020 2020 2072 6169 7365 2055 6e69         raise Uni
+000259d0: 7443 6f6e 7665 7273 696f 6e45 7272 6f72  tConversionError
+000259e0: 2822 4361 6e6e 6f74 2075 6e64 6572 7374  ("Cannot underst
+000259f0: 616e 6420 7b7d 2061 7320 6120 6469 7374  and {} as a dist
+00025a00: 616e 6365 2075 6e69 7422 2e66 6f72 6d61  ance unit".forma
+00025a10: 7428 7374 7228 6f75 745f 756e 6974 2929  t(str(out_unit))
+00025a20: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00025a30: 6e20 6f75 745f 7261 640a 0a20 2020 2064  n out_rad..    d
+00025a40: 6566 2067 6574 5f72 6164 6975 7328 7365  ef get_radius(se
+00025a50: 6c66 2c20 7261 645f 6e61 6d65 3a20 7374  lf, rad_name: st
+00025a60: 722c 206f 7574 5f75 6e69 743a 2055 6e69  r, out_unit: Uni
+00025a70: 6f6e 5b55 6e69 742c 2073 7472 5d20 3d20  on[Unit, str] = 
+00025a80: 2764 6567 2729 202d 3e20 5175 616e 7469  'deg') -> Quanti
+00025a90: 7479 3a0a 2020 2020 2020 2020 2222 220a  ty:.        """.
+00025aa0: 2020 2020 2020 2020 416c 6c6f 7773 2061          Allows a
+00025ab0: 2072 6164 6975 7320 6173 736f 6369 6174   radius associat
+00025ac0: 6564 2077 6974 6820 7468 6973 2073 6f75  ed with this sou
+00025ad0: 7263 6520 746f 2062 6520 7265 7472 6965  rce to be retrie
+00025ae0: 7665 6420 696e 2073 7065 6369 6669 6564  ved in specified
+00025af0: 2064 6973 7461 6e63 6520 756e 6974 732e   distance units.
+00025b00: 204e 6f74 650a 2020 2020 2020 2020 7468   Note.        th
+00025b10: 6174 2070 6879 7369 6361 6c20 6469 7374  at physical dist
+00025b20: 616e 6365 2075 6e69 7473 2073 7563 6820  ance units such 
+00025b30: 6173 206b 696c 6f70 6172 7365 6373 206d  as kiloparsecs m
+00025b40: 6179 206f 6e6c 7920 6265 2075 7365 6420  ay only be used 
+00025b50: 6966 2074 6865 2073 6f75 7263 6520 6861  if the source ha
+00025b60: 730a 2020 2020 2020 2020 7265 6473 6869  s.        redshi
+00025b70: 6674 2069 6e66 6f72 6d61 7469 6f6e 2e0a  ft information..
+00025b80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00025b90: 7374 7220 7261 645f 6e61 6d65 3a20 5468  str rad_name: Th
+00025ba0: 6520 6e61 6d65 206f 6620 7468 6520 6465  e name of the de
+00025bb0: 7369 7265 6420 7261 6469 7573 2c20 7232  sired radius, r2
+00025bc0: 3030 2066 6f72 2069 6e73 7461 6e63 652e  00 for instance.
+00025bd0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00025be0: 556e 6974 2f73 7472 206f 7574 5f75 6e69  Unit/str out_uni
+00025bf0: 743a 2041 6e20 6173 7472 6f70 7920 756e  t: An astropy un
+00025c00: 6974 2c20 6569 7468 6572 2061 2055 6e69  it, either a Uni
+00025c10: 7420 696e 7374 616e 6365 206f 7220 6120  t instance or a 
+00025c20: 7374 7269 6e67 0a20 2020 2020 2020 2020  string.         
+00025c30: 2020 2072 6570 7265 7365 6e74 6174 696f     representatio
+00025c40: 6e2e 2044 6566 6175 6c74 2069 7320 6465  n. Default is de
+00025c50: 6772 6565 732e 0a20 2020 2020 2020 203a  grees..        :
+00025c60: 7265 7475 726e 3a20 5468 6520 6465 7369  return: The desi
+00025c70: 7265 6420 7261 6469 7573 2069 6e20 7468  red radius in th
+00025c80: 6520 6465 7369 7265 6420 756e 6974 732e  e desired units.
+00025c90: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
+00025ca0: 2051 7561 6e74 6974 790a 2020 2020 2020   Quantity.      
+00025cb0: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
+00025cc0: 2049 6e20 6361 7365 2073 6f6d 6562 6f64   In case somebod
+00025cd0: 7920 7479 7065 7320 696e 2052 3530 3020  y types in R500 
+00025ce0: 7261 7468 6572 2074 6861 6e20 7235 3030  rather than r500
+00025cf0: 2066 6f72 2069 6e73 7461 6e63 652e 0a20   for instance.. 
+00025d00: 2020 2020 2020 2072 6164 5f6e 616d 6520         rad_name 
+00025d10: 3d20 7261 645f 6e61 6d65 2e6c 6f77 6572  = rad_name.lower
+00025d20: 2829 0a20 2020 2020 2020 2069 6620 7261  ().        if ra
+00025d30: 645f 6e61 6d65 206e 6f74 2069 6e20 7365  d_name not in se
+00025d40: 6c66 2e5f 7261 6469 693a 0a20 2020 2020  lf._radii:.     
+00025d50: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00025d60: 7565 4572 726f 7228 2254 6865 7265 2069  ueError("There i
+00025d70: 7320 6e6f 207b 727d 2072 6164 6975 7320  s no {r} radius 
+00025d80: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
+00025d90: 7468 6973 206f 626a 6563 742e 222e 666f  this object.".fo
+00025da0: 726d 6174 2872 3d72 6164 5f6e 616d 6529  rmat(r=rad_name)
+00025db0: 290a 0a20 2020 2020 2020 206f 7574 5f72  )..        out_r
+00025dc0: 6164 203d 2073 656c 662e 636f 6e76 6572  ad = self.conver
+00025dd0: 745f 7261 6469 7573 2873 656c 662e 5f72  t_radius(self._r
+00025de0: 6164 6969 5b72 6164 5f6e 616d 655d 2c20  adii[rad_name], 
+00025df0: 6f75 745f 756e 6974 290a 0a20 2020 2020  out_unit)..     
+00025e00: 2020 2072 6574 7572 6e20 6f75 745f 7261     return out_ra
+00025e10: 640a 0a20 2020 2040 7072 6f70 6572 7479  d..    @property
+00025e20: 0a20 2020 2064 6566 206e 756d 5f70 6e5f  .    def num_pn_
+00025e30: 6f62 7328 7365 6c66 2920 2d3e 2069 6e74  obs(self) -> int
+00025e40: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00025e50: 2020 2020 2020 4765 7474 6572 206d 6574        Getter met
+00025e60: 686f 6420 7468 6174 2067 6976 6573 2074  hod that gives t
+00025e70: 6865 206e 756d 6265 7220 6f66 2050 4e20  he number of PN 
+00025e80: 6f62 7365 7276 6174 696f 6e73 2e0a 0a20  observations... 
+00025e90: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+00025ea0: 496e 7465 6765 7220 6e75 6d62 6572 206f  Integer number o
+00025eb0: 6620 504e 206f 6273 6572 7661 7469 6f6e  f PN observation
+00025ec0: 7320 6173 736f 6369 6174 6564 2077 6974  s associated wit
+00025ed0: 6820 7468 6973 2073 6f75 7263 650a 2020  h this source.  
+00025ee0: 2020 2020 2020 3a72 7479 7065 3a20 696e        :rtype: in
+00025ef0: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
+00025f00: 2020 2020 2020 7265 7475 726e 206c 656e        return len
+00025f10: 285b 6f20 666f 7220 6f20 696e 2073 656c  ([o for o in sel
+00025f20: 662e 6f62 735f 6964 7320 6966 2027 706e  f.obs_ids if 'pn
+00025f30: 2720 696e 2073 656c 662e 5f70 726f 6475  ' in self._produ
+00025f40: 6374 735b 6f5d 5d29 0a0a 2020 2020 4070  cts[o]])..    @p
+00025f50: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00025f60: 6e75 6d5f 6d6f 7331 5f6f 6273 2873 656c  num_mos1_obs(sel
+00025f70: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+00025f80: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
+00025f90: 6574 7465 7220 6d65 7468 6f64 2074 6861  etter method tha
+00025fa0: 7420 6769 7665 7320 7468 6520 6e75 6d62  t gives the numb
+00025fb0: 6572 206f 6620 4d4f 5331 206f 6273 6572  er of MOS1 obser
+00025fc0: 7661 7469 6f6e 732e 0a0a 2020 2020 2020  vations...      
+00025fd0: 2020 3a72 6574 7572 6e3a 2049 6e74 6567    :return: Integ
+00025fe0: 6572 206e 756d 6265 7220 6f66 204d 4f53  er number of MOS
+00025ff0: 3120 6f62 7365 7276 6174 696f 6e73 2061  1 observations a
+00026000: 7373 6f63 6961 7465 6420 7769 7468 2074  ssociated with t
+00026010: 6869 7320 736f 7572 6365 0a20 2020 2020  his source.     
+00026020: 2020 203a 7274 7970 653a 2069 6e74 0a20     :rtype: int. 
+00026030: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00026040: 2020 2072 6574 7572 6e20 6c65 6e28 5b6f     return len([o
+00026050: 2066 6f72 206f 2069 6e20 7365 6c66 2e6f   for o in self.o
+00026060: 6273 5f69 6473 2069 6620 276d 6f73 3127  bs_ids if 'mos1'
+00026070: 2069 6e20 7365 6c66 2e5f 7072 6f64 7563   in self._produc
+00026080: 7473 5b6f 5d5d 290a 0a20 2020 2040 7072  ts[o]])..    @pr
+00026090: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
+000260a0: 756d 5f6d 6f73 325f 6f62 7328 7365 6c66  um_mos2_obs(self
+000260b0: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+000260c0: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
+000260d0: 7474 6572 206d 6574 686f 6420 7468 6174  tter method that
+000260e0: 2067 6976 6573 2074 6865 206e 756d 6265   gives the numbe
+000260f0: 7220 6f66 204d 4f53 3220 6f62 7365 7276  r of MOS2 observ
+00026100: 6174 696f 6e73 2e0a 0a20 2020 2020 2020  ations...       
+00026110: 203a 7265 7475 726e 3a20 496e 7465 6765   :return: Intege
+00026120: 7220 6e75 6d62 6572 206f 6620 4d4f 5332  r number of MOS2
+00026130: 206f 6273 6572 7661 7469 6f6e 7320 6173   observations as
+00026140: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
+00026150: 6973 2073 6f75 7263 650a 2020 2020 2020  is source.      
+00026160: 2020 3a72 7479 7065 3a20 696e 740a 2020    :rtype: int.  
+00026170: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00026180: 2020 7265 7475 726e 206c 656e 285b 6f20    return len([o 
+00026190: 666f 7220 6f20 696e 2073 656c 662e 6f62  for o in self.ob
+000261a0: 735f 6964 7320 6966 2027 6d6f 7332 2720  s_ids if 'mos2' 
+000261b0: 696e 2073 656c 662e 5f70 726f 6475 6374  in self._product
+000261c0: 735b 6f5d 5d29 0a0a 2020 2020 2320 4173  s[o]])..    # As
+000261d0: 2074 6869 7320 6973 2061 6e20 696e 7472   this is an intr
+000261e0: 696e 7369 6320 7072 6f70 6572 7479 206f  insic property o
+000261f0: 6620 7768 6963 6820 6d61 7463 6865 6420  f which matched 
+00026200: 6f62 7365 7276 6174 696f 6e73 2061 7265  observations are
+00026210: 2076 616c 6964 2c20 7468 6572 6520 7769   valid, there wi
+00026220: 6c6c 2062 6520 6e6f 2073 6574 7465 720a  ll be no setter.
+00026230: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+00026240: 2020 6465 6620 696e 7374 7275 6d65 6e74    def instrument
+00026250: 7328 7365 6c66 2920 2d3e 2044 6963 743a  s(self) -> Dict:
+00026260: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00026270: 2020 2020 2041 2070 726f 7065 7274 7920       A property 
+00026280: 6f66 2061 2073 6f75 7263 6520 7468 6174  of a source that
+00026290: 2064 6574 6169 6c73 2077 6869 6368 2069   details which i
+000262a0: 6e73 7472 756d 656e 7473 2068 6176 6520  nstruments have 
+000262b0: 7661 6c69 6420 6461 7461 2066 6f72 2077  valid data for w
+000262c0: 6869 6368 206f 6273 6572 7661 7469 6f6e  hich observation
+000262d0: 732e 0a0a 2020 2020 2020 2020 3a72 6574  s...        :ret
+000262e0: 7572 6e3a 2041 2064 6963 7469 6f6e 6172  urn: A dictionar
+000262f0: 7920 6f66 204f 6273 4944 7320 616e 6420  y of ObsIDs and 
+00026300: 7468 6569 7220 6173 736f 6369 6174 6564  their associated
+00026310: 2076 616c 6964 2069 6e73 7472 756d 656e   valid instrumen
+00026320: 7473 2e0a 2020 2020 2020 2020 3a72 7479  ts..        :rty
+00026330: 7065 3a20 4469 6374 0a20 2020 2020 2020  pe: Dict.       
+00026340: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00026350: 7572 6e20 7365 6c66 2e5f 696e 7374 7275  urn self._instru
+00026360: 6d65 6e74 730a 0a20 2020 2040 7072 6f70  ments..    @prop
+00026370: 6572 7479 0a20 2020 2064 6566 2064 6973  erty.    def dis
+00026380: 6173 736f 6369 6174 6564 2873 656c 6629  associated(self)
+00026390: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+000263a0: 2020 2222 220a 2020 2020 2020 2020 5072    """.        Pr
+000263b0: 6f70 6572 7479 2074 6861 7420 6465 7363  operty that desc
+000263c0: 7269 6265 7320 7768 6574 6865 7220 7468  ribes whether th
+000263d0: 6973 2073 6f75 7263 6520 6861 7320 6861  is source has ha
+000263e0: 6420 4f62 7349 4473 2064 6973 6173 736f  d ObsIDs disasso
+000263f0: 6369 6174 6564 2066 726f 6d20 6974 2e0a  ciated from it..
+00026400: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00026410: 3a20 4120 626f 6f6c 6561 6e20 666c 6167  : A boolean flag
+00026420: 2c20 5472 7565 206d 6561 6e73 2074 6861  , True means tha
+00026430: 7420 4f62 7349 4473 2f69 6e73 7472 756d  t ObsIDs/instrum
+00026440: 656e 7473 2068 6176 6520 6265 656e 2072  ents have been r
+00026450: 656d 6f76 6564 2c20 4661 6c73 6520 6d65  emoved, False me
+00026460: 616e 7320 7468 6579 2068 6176 656e 2774  ans they haven't
+00026470: 2e0a 2020 2020 2020 2020 3a72 7479 7065  ..        :rtype
+00026480: 3a20 626f 6f6c 0a20 2020 2020 2020 2022  : bool.        "
+00026490: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+000264a0: 6e20 7365 6c66 2e5f 6469 7361 7373 6f63  n self._disassoc
+000264b0: 6961 7465 640a 0a20 2020 2040 7072 6f70  iated..    @prop
+000264c0: 6572 7479 0a20 2020 2064 6566 2064 6973  erty.    def dis
+000264d0: 6173 736f 6369 6174 6564 5f6f 6273 2873  associated_obs(s
+000264e0: 656c 6629 202d 3e20 6469 6374 3a0a 2020  elf) -> dict:.  
+000264f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00026500: 2020 5072 6f70 6572 7479 2074 6861 7420    Property that 
+00026510: 6465 7461 696c 7320 6578 6163 746c 7920  details exactly 
+00026520: 7768 6174 2064 6174 6120 6861 7320 6265  what data has be
+00026530: 656e 2064 6973 6173 736f 6369 6174 6564  en disassociated
+00026540: 2066 726f 6d20 7468 6973 2073 6f75 7263   from this sourc
+00026550: 652c 2069 6620 616e 792e 0a0a 2020 2020  e, if any...    
+00026560: 2020 2020 3a72 6574 7572 6e3a 2044 6963      :return: Dic
+00026570: 7469 6f6e 6172 7920 6465 7363 7269 6269  tionary describi
+00026580: 6e67 2077 6869 6368 2069 6e73 7472 756d  ng which instrum
+00026590: 656e 7473 206f 6620 7768 6963 6820 4f62  ents of which Ob
+000265a0: 7349 4473 2068 6176 6520 6265 656e 2064  sIDs have been d
+000265b0: 6973 6173 736f 6369 6174 6564 2066 726f  isassociated fro
+000265c0: 6d20 7468 6973 2073 6f75 7263 652e 0a20  m this source.. 
+000265d0: 2020 2020 2020 203a 7274 7970 653a 2064         :rtype: d
+000265e0: 6963 740a 2020 2020 2020 2020 2222 220a  ict.        """.
+000265f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00026600: 656c 662e 5f64 6973 6173 736f 6369 6174  elf._disassociat
+00026610: 6564 5f6f 6273 0a0a 2020 2020 6465 6620  ed_obs..    def 
+00026620: 6469 7361 7373 6f63 6961 7465 5f6f 6273  disassociate_obs
+00026630: 2873 656c 662c 2074 6f5f 7265 6d6f 7665  (self, to_remove
+00026640: 3a20 556e 696f 6e5b 6469 6374 2c20 7374  : Union[dict, st
+00026650: 722c 206c 6973 745d 293a 0a20 2020 2020  r, list]):.     
+00026660: 2020 2022 2222 0a20 2020 2020 2020 204d     """.        M
+00026670: 6574 686f 6420 7468 6174 2075 7365 7320  ethod that uses 
+00026680: 7468 6520 7375 7070 6c69 6564 2064 6963  the supplied dic
+00026690: 7469 6f6e 6172 7920 746f 2073 6166 656c  tionary to safel
+000266a0: 7920 7265 6d6f 7665 2064 6174 6120 6672  y remove data fr
+000266b0: 6f6d 2074 6865 2073 6f75 7263 652e 2054  om the source. T
+000266c0: 6869 7320 6461 7461 2077 696c 6c20 6e6f  his data will no
+000266d0: 206c 6f6e 6765 720a 2020 2020 2020 2020   longer.        
+000266e0: 6265 2075 7365 6420 696e 2061 6e79 2061  be used in any a
+000266f0: 6e61 6c79 7365 732c 2061 6e64 2077 6f75  nalyses, and wou
+00026700: 6c64 2074 7970 6963 616c 6c79 2062 6520  ld typically be 
+00026710: 7265 6d6f 7665 6420 6265 6361 7573 6520  removed because 
+00026720: 6974 2069 7320 6f66 2070 6f6f 7220 7175  it is of poor qu
+00026730: 616c 6974 792c 206f 7220 646f 6573 6e27  ality, or doesn'
+00026740: 7420 636f 6e74 7269 6275 7465 0a20 2020  t contribute.   
+00026750: 2020 2020 2065 6e6f 7567 6820 746f 206a       enough to j
+00026760: 7573 7469 6679 2069 7473 2070 7265 7365  ustify its prese
+00026770: 6e63 652e 0a0a 2020 2020 2020 2020 3a70  nce...        :p
+00026780: 6172 616d 2064 6963 742f 7374 722f 6c69  aram dict/str/li
+00026790: 7374 2074 6f5f 7265 6d6f 7665 3a20 4569  st to_remove: Ei
+000267a0: 7468 6572 2061 2064 6963 7469 6f6e 6172  ther a dictionar
+000267b0: 7920 6f66 206f 6273 6572 7661 7469 6f6e  y of observation
+000267c0: 7320 746f 2072 656d 6f76 652c 2028 696e  s to remove, (in
+000267d0: 2074 6865 2073 7479 6c65 206f 660a 2020   the style of.  
+000267e0: 2020 2020 2020 2020 2020 7468 6520 736f            the so
+000267f0: 7572 6365 2e69 6e73 7472 756d 656e 7473  urce.instruments
+00026800: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
+00026810: 2074 6865 2074 6f70 206c 6576 656c 206b   the top level k
+00026820: 6579 7320 6265 696e 6720 4f62 7349 4473  eys being ObsIDs
+00026830: 2c20 616e 6420 7468 6520 6c6f 7765 7220  , and the lower 
+00026840: 6c65 7665 6c73 0a20 2020 2020 2020 2020  levels.         
+00026850: 2020 2062 6569 6e67 2069 6e73 7472 756d     being instrum
+00026860: 656e 7420 6e61 6d65 7329 2c20 6120 7374  ent names), a st
+00026870: 7269 6e67 2063 6f6e 7461 696e 696e 6720  ring containing 
+00026880: 616e 204f 6273 4944 2c20 6f72 2061 206c  an ObsID, or a l
+00026890: 6973 7420 6f66 204f 6273 4944 732e 0a20  ist of ObsIDs.. 
+000268a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000268b0: 2020 2023 2055 7365 7273 2063 616e 2070     # Users can p
+000268c0: 6173 7320 6a75 7374 2061 6e20 4f62 7349  ass just an ObsI
+000268d0: 4420 7374 7269 6e67 2c20 6275 7420 7765  D string, but we
+000268e0: 2074 6865 6e20 6e65 6564 2074 6f20 636f   then need to co
+000268f0: 6e76 6572 7420 6974 2074 6f20 7468 6520  nvert it to the 
+00026900: 666f 726d 0a20 2020 2020 2020 2023 2020  form.        #  
+00026910: 7468 6174 2074 6865 2072 6573 7420 6f66  that the rest of
+00026920: 2074 6865 2066 756e 6374 696f 6e20 7265   the function re
+00026930: 7175 6972 6573 0a20 2020 2020 2020 2069  quires.        i
+00026940: 6620 6973 696e 7374 616e 6365 2874 6f5f  f isinstance(to_
+00026950: 7265 6d6f 7665 2c20 7374 7229 3a0a 2020  remove, str):.  
+00026960: 2020 2020 2020 2020 2020 746f 5f72 656d            to_rem
+00026970: 6f76 6520 3d20 7b74 6f5f 7265 6d6f 7665  ove = {to_remove
+00026980: 3a20 6465 6570 636f 7079 2873 656c 662e  : deepcopy(self.
+00026990: 696e 7374 7275 6d65 6e74 735b 746f 5f72  instruments[to_r
+000269a0: 656d 6f76 655d 297d 0a20 2020 2020 2020  emove])}.       
+000269b0: 2023 2048 6572 6520 6973 2077 6865 7265   # Here is where
+000269c0: 2074 6865 7920 6861 7665 206a 7573 7420   they have just 
+000269d0: 7061 7373 6564 2061 206c 6973 7420 6f66  passed a list of
+000269e0: 204f 6273 4944 732c 2061 6e64 2077 6520   ObsIDs, and we 
+000269f0: 6e65 6564 2074 6f20 6669 6c6c 2069 6e20  need to fill in 
+00026a00: 7468 6520 626c 616e 6b73 2077 6974 6820  the blanks with 
+00026a10: 7468 6520 696e 7374 7275 6d65 6e74 730a  the instruments.
+00026a20: 2020 2020 2020 2020 2320 2063 7572 7265          #  curre
+00026a30: 6e74 6c79 206c 6f61 6465 6420 666f 7220  ntly loaded for 
+00026a40: 7468 6f73 6520 4f62 7349 4473 0a20 2020  those ObsIDs.   
+00026a50: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00026a60: 616e 6365 2874 6f5f 7265 6d6f 7665 2c20  ance(to_remove, 
+00026a70: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+00026a80: 2020 2074 6f5f 7265 6d6f 7665 203d 207b     to_remove = {
+00026a90: 6f3a 2064 6565 7063 6f70 7928 7365 6c66  o: deepcopy(self
+00026aa0: 2e69 6e73 7472 756d 656e 7473 5b6f 5d29  .instruments[o])
+00026ab0: 2066 6f72 206f 2069 6e20 746f 5f72 656d   for o in to_rem
+00026ac0: 6f76 657d 0a20 2020 2020 2020 2023 2048  ove}.        # H
+00026ad0: 6572 6520 6465 616c 7320 7769 7468 2077  ere deals with w
+00026ae0: 6865 6e20 736f 6d65 6f6e 6520 6d69 6768  hen someone migh
+00026af0: 7420 6861 7665 2070 6173 7365 6420 6120  t have passed a 
+00026b00: 6469 6374 696f 6e61 7279 2077 6865 7265  dictionary where
+00026b10: 2074 6865 7265 2069 7320 6120 7369 6e67   there is a sing
+00026b20: 6c65 2069 6e73 7472 756d 656e 742c 2061  le instrument, a
+00026b30: 6e64 0a20 2020 2020 2020 2023 2020 7468  nd.        #  th
+00026b40: 6579 2068 6176 656e 2774 2070 7574 2069  ey haven't put i
+00026b50: 7420 696e 2061 206c 6973 743b 2065 2e67  t in a list; e.g
+00026b60: 2e20 7b27 3032 3031 3930 3335 3031 273a  . {'0201903501':
+00026b70: 2027 706e 277d 2e20 5468 6973 2064 6574   'pn'}. This det
+00026b80: 6563 7473 2069 6e73 7461 6e63 6573 206c  ects instances l
+00026b90: 696b 6520 7468 6174 2061 6e64 2074 6865  ike that and the
+00026ba0: 6e0a 2020 2020 2020 2020 2320 2070 7574  n.        #  put
+00026bb0: 7320 7468 6520 696e 6469 7669 6475 616c  s the individual
+00026bc0: 2069 6e73 7472 756d 656e 7420 696e 2061   instrument in a
+00026bd0: 206c 6973 7420 6173 2069 7320 6578 7065   list as is expe
+00026be0: 6374 6564 2062 7920 7468 6520 7265 7374  cted by the rest
+00026bf0: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
+00026c00: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00026c10: 696e 7374 616e 6365 2874 6f5f 7265 6d6f  instance(to_remo
+00026c20: 7665 2c20 6469 6374 2920 616e 6420 6e6f  ve, dict) and no
+00026c30: 7420 616c 6c28 5b69 7369 6e73 7461 6e63  t all([isinstanc
+00026c40: 6528 762c 206c 6973 7429 2066 6f72 2076  e(v, list) for v
+00026c50: 2069 6e20 746f 5f72 656d 6f76 652e 7661   in to_remove.va
+00026c60: 6c75 6573 2829 5d29 3a0a 2020 2020 2020  lues()]):.      
+00026c70: 2020 2020 2020 6e65 775f 746f 5f72 656d        new_to_rem
+00026c80: 6f76 6520 3d20 7b7d 0a20 2020 2020 2020  ove = {}.       
+00026c90: 2020 2020 2066 6f72 206f 2069 6e20 746f       for o in to
+00026ca0: 5f72 656d 6f76 653a 0a20 2020 2020 2020  _remove:.       
+00026cb0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00026cc0: 6973 696e 7374 616e 6365 2874 6f5f 7265  isinstance(to_re
+00026cd0: 6d6f 7665 5b6f 5d2c 206c 6973 7429 3a0a  move[o], list):.
+00026ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026cf0: 2020 2020 6e65 775f 746f 5f72 656d 6f76      new_to_remov
+00026d00: 655b 6f5d 203d 205b 6465 6570 636f 7079  e[o] = [deepcopy
+00026d10: 2874 6f5f 7265 6d6f 7665 5b6f 5d29 5d0a  (to_remove[o])].
+00026d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026d30: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00026d40: 2020 2020 2020 2020 2020 6e65 775f 746f            new_to
+00026d50: 5f72 656d 6f76 655b 6f5d 203d 2064 6565  _remove[o] = dee
+00026d60: 7063 6f70 7928 746f 5f72 656d 6f76 655b  pcopy(to_remove[
+00026d70: 6f5d 290a 0a20 2020 2020 2020 2020 2020  o])..           
+00026d80: 2023 2049 2075 7365 2064 6565 7063 6f70   # I use deepcop
+00026d90: 7920 6167 6169 6e20 6265 6361 7573 6520  y again because 
+00026da0: 7468 6572 6520 6861 7665 2062 6565 6e20  there have been 
+00026db0: 6973 7375 6573 2077 6974 6820 7468 6973  issues with this
+00026dc0: 2066 756e 6374 696f 6e20 7374 696c 6c20   function still 
+00026dd0: 706f 696e 7469 6e67 2074 6f20 6f6c 6420  pointing to old 
+00026de0: 6d65 6d6f 7279 0a20 2020 2020 2020 2020  memory.         
+00026df0: 2020 2023 2020 6164 6472 6573 7365 732c     #  addresses,
+00026e00: 2073 6f20 4927 6d20 7175 6974 6520 7061   so I'm quite pa
+00026e10: 7261 6e6f 6964 2069 6e20 7468 6973 2062  ranoid in this b
+00026e20: 6974 206f 6620 636f 6465 0a20 2020 2020  it of code.     
+00026e30: 2020 2020 2020 2074 6f5f 7265 6d6f 7665         to_remove
+00026e40: 203d 2064 6565 7063 6f70 7928 6e65 775f   = deepcopy(new_
+00026e50: 746f 5f72 656d 6f76 6529 0a0a 2020 2020  to_remove)..    
+00026e60: 2020 2020 2320 5765 2061 6c73 6f20 6368      # We also ch
+00026e70: 6563 6b20 746f 206d 616b 6520 7375 7265  eck to make sure
+00026e80: 2074 6861 7420 7468 6520 6461 7461 2077   that the data w
+00026e90: 6527 7265 2062 6569 6e67 2061 736b 6564  e're being asked
+00026ea0: 2074 6f20 7265 6d6f 7665 2061 6374 7561   to remove actua
+00026eb0: 6c6c 7920 6973 2061 7373 6f63 6961 7465  lly is associate
+00026ec0: 6420 7769 7468 2074 6865 0a20 2020 2020  d with the.     
+00026ed0: 2020 2023 2020 736f 7572 6365 2e20 5765     #  source. We
+00026ee0: 2073 6861 6c6c 2062 6520 666f 7267 6976   shall be forgiv
+00026ef0: 696e 6720 6966 2069 7420 6973 6e27 742c  ing if it isn't,
+00026f00: 2061 6e64 206a 7573 7420 6973 7375 6520   and just issue 
+00026f10: 6120 7761 726e 696e 6720 746f 206c 6574  a warning to let
+00026f20: 2074 6865 2075 7365 7220 6b6e 6f77 2074   the user know t
+00026f30: 6861 7420 7468 6579 2061 7265 0a20 2020  hat they are.   
+00026f40: 2020 2020 2023 2020 6173 7375 6d69 6e67       #  assuming
+00026f50: 2064 6174 6120 7761 7320 6865 7265 2074   data was here t
+00026f60: 6861 7420 6163 7475 616c 6c79 2069 736e  hat actually isn
+00026f70: 2774 2070 7265 7365 6e74 0a20 2020 2020  't present.     
+00026f80: 2020 2023 2049 7465 7261 7469 6e67 2074     # Iterating t
+00026f90: 6872 6f75 6768 2074 6865 206b 6579 7320  hrough the keys 
+00026fa0: 284f 6273 4944 7329 2069 6e20 746f 5f72  (ObsIDs) in to_r
+00026fb0: 656d 6f76 650a 2020 2020 2020 2020 666f  emove.        fo
+00026fc0: 7220 6f20 696e 2074 6f5f 7265 6d6f 7665  r o in to_remove
+00026fd0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00026fe0: 206f 206e 6f74 2069 6e20 7365 6c66 2e6f   o not in self.o
+00026ff0: 6273 5f69 6473 3a0a 2020 2020 2020 2020  bs_ids:.        
+00027000: 2020 2020 2020 2020 7761 726e 2822 7b6f          warn("{o
+00027010: 7d20 6461 7461 2063 616e 6e6f 7420 6265  } data cannot be
+00027020: 2072 656d 6f76 6564 2066 726f 6d20 7b73   removed from {s
+00027030: 7d20 6173 2074 6865 7920 6172 6520 6e6f  } as they are no
+00027040: 7420 6173 736f 6369 6174 6564 2077 6974  t associated wit
+00027050: 6820 220a 2020 2020 2020 2020 2020 2020  h ".            
+00027060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027070: 2020 2269 742e 222e 666f 726d 6174 286f    "it.".format(o
+00027080: 3d6f 2c20 733d 7365 6c66 2e6e 616d 6529  =o, s=self.name)
+00027090: 2c20 7374 6163 6b6c 6576 656c 3d32 290a  , stacklevel=2).
+000270a0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
+000270b0: 6563 6b20 746f 2073 6565 2077 6865 7468  eck to see wheth
+000270c0: 6572 2061 6e79 206f 6620 7468 6520 696e  er any of the in
+000270d0: 7374 7275 6d65 6e74 7320 666f 7220 6f20  struments for o 
+000270e0: 6172 6520 6e6f 7420 6163 7475 616c 6c79  are not actually
+000270f0: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
+00027100: 2074 6865 2073 6f75 7263 650a 2020 2020   the source.    
+00027110: 2020 2020 2020 2020 656c 6966 2061 6e79          elif any
+00027120: 285b 6920 6e6f 7420 696e 2073 656c 662e  ([i not in self.
+00027130: 696e 7374 7275 6d65 6e74 735b 6f5d 2066  instruments[o] f
+00027140: 6f72 2069 2069 6e20 746f 5f72 656d 6f76  or i in to_remov
+00027150: 655b 6f5d 5d29 3a0a 2020 2020 2020 2020  e[o]]):.        
+00027160: 2020 2020 2020 2020 6261 645f 6c69 7374          bad_list
+00027170: 203d 205b 6920 666f 7220 6920 696e 2074   = [i for i in t
+00027180: 6f5f 7265 6d6f 7665 5b6f 5d20 6966 2069  o_remove[o] if i
+00027190: 206e 6f74 2069 6e20 7365 6c66 2e69 6e73   not in self.ins
+000271a0: 7472 756d 656e 7473 5b6f 5d5d 0a20 2020  truments[o]].   
+000271b0: 2020 2020 2020 2020 2020 2020 2062 6164               bad
+000271c0: 5f73 7472 203d 2022 2f22 2e6a 6f69 6e28  _str = "/".join(
+000271d0: 6261 645f 6c69 7374 290a 2020 2020 2020  bad_list).      
+000271e0: 2020 2020 2020 2020 2020 7761 726e 2822            warn("
+000271f0: 7b6f 7d2d 7b69 627d 2064 6174 6120 6361  {o}-{ib} data ca
+00027200: 6e6e 6f74 2062 6520 7265 6d6f 7665 6420  nnot be removed 
+00027210: 6672 6f6d 207b 737d 2061 7320 7468 6579  from {s} as they
+00027220: 2061 7265 206e 6f74 2061 7373 6f63 6961   are not associa
+00027230: 7465 6420 220a 2020 2020 2020 2020 2020  ted ".          
+00027240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027250: 2020 2020 2277 6974 6820 6974 2e22 2e66      "with it.".f
+00027260: 6f72 6d61 7428 6f3d 6f2c 2069 623d 6261  ormat(o=o, ib=ba
+00027270: 645f 7374 722c 2073 3d73 656c 662e 6e61  d_str, s=self.na
+00027280: 6d65 292c 2073 7461 636b 6c65 7665 6c3d  me), stacklevel=
+00027290: 3229 0a0a 2020 2020 2020 2020 2320 5365  2)..        # Se
+000272a0: 7473 2074 6865 2061 7474 7269 6275 7465  ts the attribute
+000272b0: 2074 6861 7420 7465 6c6c 7320 7573 2077   that tells us w
+000272c0: 6865 7468 6572 2061 6e79 2064 6174 6120  hether any data 
+000272d0: 6861 7320 6265 656e 2072 656d 6f76 6564  has been removed
+000272e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000272f0: 7365 6c66 2e5f 6469 7361 7373 6f63 6961  self._disassocia
+00027300: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
+00027310: 2073 656c 662e 5f64 6973 6173 736f 6369   self._disassoci
+00027320: 6174 6564 203d 2054 7275 650a 0a20 2020  ated = True..   
+00027330: 2020 2020 2023 2057 6520 7761 6e74 2074       # We want t
+00027340: 6f20 7374 6f72 6520 6b6e 6f77 6c65 6467  o store knowledg
+00027350: 6520 6f66 2077 6861 7420 6461 7461 2068  e of what data h
+00027360: 6173 2062 6565 6e20 7265 6d6f 7665 642c  as been removed,
+00027370: 2069 6620 7468 6572 6520 6861 736e 2774   if there hasn't
+00027380: 2062 6565 6e20 616e 7974 6869 6e67 2074   been anything t
+00027390: 616b 656e 2061 7761 7920 7965 740a 2020  aken away yet.  
+000273a0: 2020 2020 2020 2320 2074 6865 6e20 7765        #  then we
+000273b0: 2063 616e 206a 7573 7420 7365 7420 6974   can just set it
+000273c0: 2065 7175 616c 2074 6f20 7468 6520 746f   equal to the to
+000273d0: 5f72 656d 6f76 6520 6469 6374 696f 6e61  _remove dictiona
+000273e0: 7279 0a20 2020 2020 2020 2069 6620 6c65  ry.        if le
+000273f0: 6e28 7365 6c66 2e5f 6469 7361 7373 6f63  n(self._disassoc
+00027400: 6961 7465 645f 6f62 7329 203d 3d20 303a  iated_obs) == 0:
+00027410: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00027420: 662e 5f64 6973 6173 736f 6369 6174 6564  f._disassociated
+00027430: 5f6f 6273 203d 2074 6f5f 7265 6d6f 7665  _obs = to_remove
+00027440: 0a20 2020 2020 2020 2023 204f 7468 6572  .        # Other
+00027450: 7769 7365 2077 6520 6861 7665 2074 6f20  wise we have to 
+00027460: 6164 6420 7468 6520 6461 7461 2074 6f20  add the data to 
+00027470: 7468 6520 6578 6973 7469 6e67 2064 6963  the existing dic
+00027480: 7469 6f6e 6172 7920 7374 7275 6374 7572  tionary structur
+00027490: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+000274a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000274b0: 6f20 696e 2074 6f5f 7265 6d6f 7665 3a0a  o in to_remove:.
+000274c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000274d0: 6966 206f 206e 6f74 2069 6e20 7365 6c66  if o not in self
+000274e0: 2e5f 6469 7361 7373 6f63 6961 7465 645f  ._disassociated_
+000274f0: 6f62 733a 0a20 2020 2020 2020 2020 2020  obs:.           
+00027500: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
+00027510: 6973 6173 736f 6369 6174 6564 5f6f 6273  isassociated_obs
+00027520: 5b6f 5d20 3d20 746f 5f72 656d 6f76 655b  [o] = to_remove[
+00027530: 6f5d 0a20 2020 2020 2020 2020 2020 2020  o].             
+00027540: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00027550: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00027560: 662e 5f64 6973 6173 736f 6369 6174 6564  f._disassociated
+00027570: 5f6f 6273 5b6f 5d20 2b3d 2074 6f5f 7265  _obs[o] += to_re
+00027580: 6d6f 7665 5b6f 5d0a 0a20 2020 2020 2020  move[o]..       
+00027590: 2023 2049 6620 7765 2772 6520 756e 2d61   # If we're un-a
+000275a0: 7373 6f63 6961 7469 6e67 2063 6572 7461  ssociating certa
+000275b0: 696e 206f 6273 6572 7661 7469 6f6e 732c  in observations,
+000275c0: 206f 6464 7320 6f6e 2074 6865 2063 6f6d   odds on the com
+000275d0: 6269 6e65 6420 7072 6f64 7563 7473 2061  bined products a
+000275e0: 7265 206e 6f20 6c6f 6e67 6572 2076 616c  re no longer val
+000275f0: 6964 0a20 2020 2020 2020 2069 6620 2263  id.        if "c
+00027600: 6f6d 6269 6e65 6422 2069 6e20 7365 6c66  ombined" in self
+00027610: 2e5f 7072 6f64 7563 7473 3a0a 2020 2020  ._products:.    
+00027620: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+00027630: 2e5f 7072 6f64 7563 7473 5b22 636f 6d62  ._products["comb
+00027640: 696e 6564 225d 0a20 2020 2020 2020 2020  ined"].         
+00027650: 2020 2069 6620 2263 6f6d 6269 6e65 6422     if "combined"
+00027660: 2069 6e20 7365 6c66 2e5f 696e 7465 726c   in self._interl
+00027670: 6f70 6572 5f6d 6173 6b73 3a0a 2020 2020  oper_masks:.    
+00027680: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00027690: 7365 6c66 2e5f 696e 7465 726c 6f70 6572  self._interloper
+000276a0: 5f6d 6173 6b73 5b22 636f 6d62 696e 6564  _masks["combined
+000276b0: 225d 0a20 2020 2020 2020 2020 2020 2073  "].            s
+000276c0: 656c 662e 5f66 6974 5f72 6573 756c 7473  elf._fit_results
+000276d0: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+000276e0: 2020 7365 6c66 2e5f 7465 7374 5f73 7461    self._test_sta
+000276f0: 7420 3d20 7b7d 0a20 2020 2020 2020 2020  t = {}.         
+00027700: 2020 2073 656c 662e 5f64 6f66 203d 207b     self._dof = {
+00027710: 7d0a 2020 2020 2020 2020 2020 2020 7365  }.            se
+00027720: 6c66 2e5f 746f 7461 6c5f 636f 756e 745f  lf._total_count_
+00027730: 7261 7465 203d 207b 7d0a 2020 2020 2020  rate = {}.      
+00027740: 2020 2020 2020 7365 6c66 2e5f 746f 7461        self._tota
+00027750: 6c5f 6578 7020 3d20 7b7d 0a20 2020 2020  l_exp = {}.     
+00027760: 2020 2020 2020 2073 656c 662e 5f6c 756d         self._lum
+00027770: 696e 6f73 6974 6965 7320 3d20 7b7d 0a0a  inosities = {}..
+00027780: 2020 2020 2020 2020 666f 7220 6f20 696e          for o in
+00027790: 2074 6f5f 7265 6d6f 7665 3a0a 2020 2020   to_remove:.    
+000277a0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+000277b0: 2074 6f5f 7265 6d6f 7665 5b6f 5d3a 0a20   to_remove[o]:. 
+000277c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000277d0: 656c 2073 656c 662e 5f70 726f 6475 6374  el self._product
+000277e0: 735b 6f5d 5b69 5d0a 2020 2020 2020 2020  s[o][i].        
+000277f0: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+00027800: 2e5f 696e 7374 7275 6d65 6e74 735b 6f5d  ._instruments[o]
+00027810: 5b73 656c 662e 5f69 6e73 7472 756d 656e  [self._instrumen
+00027820: 7473 5b6f 5d2e 696e 6465 7828 6929 5d0a  ts[o].index(i)].
+00027830: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00027840: 6c65 6e28 7365 6c66 2e5f 696e 7374 7275  len(self._instru
+00027850: 6d65 6e74 735b 6f5d 2920 3d3d 2030 3a0a  ments[o]) == 0:.
+00027860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027870: 6465 6c20 7365 6c66 2e5f 7072 6f64 7563  del self._produc
+00027880: 7473 5b6f 5d0a 2020 2020 2020 2020 2020  ts[o].          
+00027890: 2020 2020 2020 6465 6c20 7365 6c66 2e5f        del self._
+000278a0: 6465 7465 6374 6564 5b6f 5d0a 2020 2020  detected[o].    
+000278b0: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+000278c0: 7365 6c66 2e5f 696e 6974 6961 6c5f 7265  self._initial_re
+000278d0: 6769 6f6e 735b 6f5d 0a20 2020 2020 2020  gions[o].       
+000278e0: 2020 2020 2020 2020 2064 656c 2073 656c           del sel
+000278f0: 662e 5f69 6e69 7469 616c 5f72 6567 696f  f._initial_regio
+00027900: 6e5f 6d61 7463 6865 735b 6f5d 0a20 2020  n_matches[o].   
+00027910: 2020 2020 2020 2020 2020 2020 2064 656c               del
+00027920: 2073 656c 662e 5f72 6567 696f 6e73 5b6f   self._regions[o
+00027930: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00027940: 2020 6465 6c20 7365 6c66 2e5f 6f74 6865    del self._othe
+00027950: 725f 7265 6769 6f6e 735b 6f5d 0a20 2020  r_regions[o].   
+00027960: 2020 2020 2020 2020 2020 2020 2064 656c               del
+00027970: 2073 656c 662e 5f61 6c74 5f6d 6174 6368   self._alt_match
+00027980: 5f72 6567 696f 6e73 5b6f 5d0a 2020 2020  _regions[o].    
+00027990: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+000279a0: 6573 6520 6172 6520 6d61 6465 206f 6e20  ese are made on 
+000279b0: 6465 6d61 6e64 2c20 736f 206e 6565 6420  demand, so need 
+000279c0: 746f 2063 6865 636b 2069 6620 6974 7320  to check if its 
+000279d0: 6163 7475 616c 6c79 2070 7265 7365 6e74  actually present
+000279e0: 2066 6972 7374 0a20 2020 2020 2020 2020   first.         
+000279f0: 2020 2020 2020 2069 6620 6f20 696e 2073         if o in s
+00027a00: 656c 662e 5f69 6e74 6572 6c6f 7065 725f  elf._interloper_
+00027a10: 6d61 736b 733a 0a20 2020 2020 2020 2020  masks:.         
+00027a20: 2020 2020 2020 2020 2020 2064 656c 2073             del s
+00027a30: 656c 662e 5f69 6e74 6572 6c6f 7065 725f  elf._interloper_
+00027a40: 6d61 736b 735b 6f5d 0a20 2020 2020 2020  masks[o].       
+00027a50: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00027a60: 2e5f 7065 616b 7320 6973 206e 6f74 204e  ._peaks is not N
+00027a70: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00027a80: 2020 2020 2020 2020 2064 656c 2073 656c           del sel
+00027a90: 662e 5f70 6561 6b73 5b6f 5d0a 0a20 2020  f._peaks[o]..   
+00027aa0: 2020 2020 2020 2020 2020 2020 2064 656c               del
+00027ab0: 2073 656c 662e 5f6f 6273 5b73 656c 662e   self._obs[self.
+00027ac0: 5f6f 6273 2e69 6e64 6578 286f 295d 0a20  _obs.index(o)]. 
+00027ad0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00027ae0: 6620 6f20 696e 2073 656c 662e 5f6f 6e61  f o in self._ona
+00027af0: 7869 733a 0a20 2020 2020 2020 2020 2020  xis:.           
+00027b00: 2020 2020 2020 2020 2064 656c 2073 656c           del sel
+00027b10: 662e 5f6f 6e61 7869 735b 7365 6c66 2e5f  f._onaxis[self._
+00027b20: 6f6e 6178 6973 2e69 6e64 6578 286f 295d  onaxis.index(o)]
+00027b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027b40: 2064 656c 2073 656c 662e 5f69 6e73 7472   del self._instr
+00027b50: 756d 656e 7473 5b6f 5d0a 0a20 2020 2020  uments[o]..     
+00027b60: 2020 2069 6620 6c65 6e28 7365 6c66 2e5f     if len(self._
+00027b70: 6f62 7329 203d 3d20 303a 0a20 2020 2020  obs) == 0:.     
+00027b80: 2020 2020 2020 2072 6169 7365 204e 6f56         raise NoV
+00027b90: 616c 6964 4f62 7365 7276 6174 696f 6e73  alidObservations
+00027ba0: 4572 726f 7228 224e 6f20 6f62 7365 7276  Error("No observ
+00027bb0: 6174 696f 6e73 2072 656d 6169 6e20 6173  ations remain as
+00027bc0: 736f 6369 6174 6564 2077 6974 6820 7b7d  sociated with {}
+00027bd0: 2061 6674 6572 2063 6c65 616e 696e 6722   after cleaning"
+00027be0: 2e66 6f72 6d61 7428 7365 6c66 2e6e 616d  .format(self.nam
+00027bf0: 6529 290a 0a20 2020 2020 2020 2023 2057  e))..        # W
+00027c00: 6520 6174 7465 6d70 7420 746f 206c 6f61  e attempt to loa
+00027c10: 6420 696e 206d 6174 6368 696e 6720 5847  d in matching XG
+00027c20: 4120 7072 6f64 7563 7473 2069 6620 7468  A products if th
+00027c30: 6174 2077 6173 2074 6865 2062 6568 6176  at was the behav
+00027c40: 696f 7572 2073 6574 2062 7920 6c6f 6164  iour set by load
+00027c50: 5f70 726f 6475 6374 7320 6f6e 2069 6e69  _products on ini
+00027c60: 740a 2020 2020 2020 2020 6966 2073 656c  t.        if sel
+00027c70: 662e 5f6c 6f61 645f 7072 6f64 7563 7473  f._load_products
+00027c80: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00027c90: 6c66 2e5f 6578 6973 7469 6e67 5f78 6761  lf._existing_xga
+00027ca0: 5f70 726f 6475 6374 7328 7365 6c66 2e5f  _products(self._
+00027cb0: 6c6f 6164 5f66 6974 7329 0a0a 2020 2020  load_fits)..    
+00027cc0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00027cd0: 6620 6c75 6d69 6e6f 7369 7479 5f64 6973  f luminosity_dis
+00027ce0: 7461 6e63 6528 7365 6c66 2920 2d3e 2051  tance(self) -> Q
+00027cf0: 7561 6e74 6974 793a 0a20 2020 2020 2020  uantity:.       
+00027d00: 2022 2222 0a20 2020 2020 2020 2054 656c   """.        Tel
+00027d10: 6c73 2074 6865 2075 7365 7220 7468 6520  ls the user the 
+00027d20: 6c75 6d69 6e6f 7369 7479 2064 6973 7461  luminosity dista
+00027d30: 6e63 6520 746f 2074 6865 2073 6f75 7263  nce to the sourc
+00027d40: 6520 6966 2061 2072 6564 7368 6966 7420  e if a redshift 
+00027d50: 7761 7320 7375 7070 6c69 6564 2c20 6966  was supplied, if
+00027d60: 206e 6f74 2072 6574 7572 6e73 204e 6f6e   not returns Non
+00027d70: 652e 0a0a 2020 2020 2020 2020 3a72 6574  e...        :ret
+00027d80: 7572 6e3a 2054 6865 206c 756d 696e 6f73  urn: The luminos
+00027d90: 6974 7920 6469 7374 616e 6365 2074 6f20  ity distance to 
+00027da0: 7468 6520 736f 7572 6365 2c20 6361 6c63  the source, calc
+00027db0: 756c 6174 6564 2075 7369 6e67 2074 6865  ulated using the
+00027dc0: 2063 6f73 6d6f 6c6f 6779 2061 7373 6f63   cosmology assoc
+00027dd0: 6961 7465 6420 7769 7468 2074 6869 7320  iated with this 
+00027de0: 736f 7572 6365 2e0a 2020 2020 2020 2020  source..        
+00027df0: 3a72 7479 7065 3a20 5175 616e 7469 7479  :rtype: Quantity
+00027e00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00027e10: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00027e20: 2e5f 6c75 6d5f 6469 7374 0a0a 2020 2020  ._lum_dist..    
+00027e30: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00027e40: 6620 616e 6775 6c61 725f 6469 616d 6574  f angular_diamet
+00027e50: 6572 5f64 6973 7461 6e63 6528 7365 6c66  er_distance(self
+00027e60: 2920 2d3e 2051 7561 6e74 6974 793a 0a20  ) -> Quantity:. 
+00027e70: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00027e80: 2020 2054 656c 6c73 2074 6865 2075 7365     Tells the use
+00027e90: 7220 7468 6520 616e 6775 6c61 7220 6469  r the angular di
+00027ea0: 616d 6574 6572 2064 6973 7461 6e63 6520  ameter distance 
+00027eb0: 746f 2074 6865 2073 6f75 7263 6520 6966  to the source if
+00027ec0: 2061 2072 6564 7368 6966 7420 7761 7320   a redshift was 
+00027ed0: 7375 7070 6c69 6564 2c20 6966 206e 6f74  supplied, if not
+00027ee0: 2072 6574 7572 6e73 204e 6f6e 652e 0a0a   returns None...
+00027ef0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00027f00: 2054 6865 2061 6e67 756c 6172 2064 6961   The angular dia
+00027f10: 6d65 7465 7220 6469 7374 616e 6365 2074  meter distance t
+00027f20: 6f20 7468 6520 736f 7572 6365 2c20 6361  o the source, ca
+00027f30: 6c63 756c 6174 6564 2075 7369 6e67 2074  lculated using t
+00027f40: 6865 2063 6f73 6d6f 6c6f 6779 0a20 2020  he cosmology.   
+00027f50: 2020 2020 2020 2020 2061 7373 6f63 6961           associa
+00027f60: 7465 6420 7769 7468 2074 6869 7320 736f  ted with this so
+00027f70: 7572 6365 2e0a 2020 2020 2020 2020 3a72  urce..        :r
+00027f80: 7479 7065 3a20 5175 616e 7469 7479 0a20  type: Quantity. 
+00027f90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00027fa0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00027fb0: 616e 675f 6469 616d 5f64 6973 740a 0a20  ang_diam_dist.. 
+00027fc0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00027fd0: 2064 6566 2062 6163 6b67 726f 756e 645f   def background_
+00027fe0: 7261 6469 7573 5f66 6163 746f 7273 2873  radius_factors(s
+00027ff0: 656c 6629 202d 3e20 6e64 6172 7261 793a  elf) -> ndarray:
+00028000: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00028010: 2020 2020 2054 6865 2066 6163 746f 7273       The factors
+00028020: 2062 7920 7768 6963 6820 746f 206d 756c   by which to mul
+00028030: 7469 706c 7920 6f75 7465 7220 7261 6469  tiply outer radi
+00028040: 7573 2062 7920 746f 2067 6574 2069 6e6e  us by to get inn
+00028050: 6572 2061 6e64 206f 7574 6572 2072 6164  er and outer rad
+00028060: 6969 2066 6f72 2062 6163 6b67 726f 756e  ii for backgroun
+00028070: 6420 7265 6769 6f6e 732e 0a0a 2020 2020  d regions...    
+00028080: 2020 2020 3a72 6574 7572 6e3a 2041 6e20      :return: An 
+00028090: 6172 7261 7920 6f66 2074 6865 2074 776f  array of the two
+000280a0: 2066 6163 746f 7273 2e0a 2020 2020 2020   factors..      
+000280b0: 2020 3a72 7479 7065 3a20 6e64 6172 7261    :rtype: ndarra
+000280c0: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
+000280d0: 2020 2020 2020 7265 7475 726e 206e 702e        return np.
+000280e0: 6172 7261 7928 5b73 656c 662e 5f62 6163  array([self._bac
+000280f0: 6b5f 696e 6e5f 6661 6374 6f72 2c20 7365  k_inn_factor, se
+00028100: 6c66 2e5f 6261 636b 5f6f 7574 5f66 6163  lf._back_out_fac
+00028110: 746f 725d 290a 0a20 2020 2064 6566 206f  tor])..    def o
+00028120: 6273 5f63 6865 636b 2873 656c 662c 2072  bs_check(self, r
+00028130: 6567 5f74 7970 653a 2073 7472 2c20 7468  eg_type: str, th
+00028140: 7265 7368 6f6c 645f 6672 6163 7469 6f6e  reshold_fraction
+00028150: 3a20 666c 6f61 7420 3d20 302e 3529 202d  : float = 0.5) -
+00028160: 3e20 4469 6374 3a0a 2020 2020 2020 2020  > Dict:.        
+00028170: 2222 220a 2020 2020 2020 2020 5468 6973  """.        This
+00028180: 206d 6574 686f 6420 7573 6573 2065 7870   method uses exp
+00028190: 6f73 7572 6520 6d61 7073 2061 6e64 2072  osure maps and r
+000281a0: 6567 696f 6e20 6d61 736b 7320 746f 2064  egion masks to d
+000281b0: 6574 6572 6d69 6e65 2077 6869 6368 204f  etermine which O
+000281c0: 6273 4944 2f69 6e73 7472 756d 656e 7420  bsID/instrument 
+000281d0: 636f 6d62 696e 6174 696f 6e73 0a20 2020  combinations.   
+000281e0: 2020 2020 2061 7265 206e 6f74 2063 6f6e       are not con
+000281f0: 7472 6962 7574 696e 6720 746f 2074 6865  tributing to the
+00028200: 2061 6e61 6c79 7369 732e 2049 7420 6361   analysis. It ca
+00028210: 6c63 756c 6174 6573 2074 6865 2061 7265  lculates the are
+00028220: 6120 696e 7465 7273 6563 7469 6f6e 206f  a intersection o
+00028230: 6620 7468 6520 6d61 736b 2061 6e64 2065  f the mask and e
+00028240: 7870 6f73 7572 650a 2020 2020 2020 2020  xposure.        
+00028250: 6d61 7073 2c20 616e 6420 6966 2028 666f  maps, and if (fo
+00028260: 7220 6120 6769 7665 6e20 4f62 7349 442d  r a given ObsID-
+00028270: 496e 7374 7275 6d65 6e74 2920 7468 6520  Instrument) the 
+00028280: 7261 7469 6f20 6f66 2074 6861 7420 6172  ratio of that ar
+00028290: 6561 2074 6f20 7468 6520 6675 6c6c 2061  ea to the full a
+000282a0: 7265 6120 6f66 2074 6865 2072 6567 696f  rea of the regio
+000282b0: 6e0a 2020 2020 2020 2020 6361 6c63 756c  n.        calcul
+000282c0: 6174 6564 2069 7320 6c65 7373 2074 6861  ated is less tha
+000282d0: 6e20 7468 6520 7468 7265 7368 6f6c 6420  n the threshold 
+000282e0: 6672 6163 7469 6f6e 2c20 7468 6174 204f  fraction, that O
+000282f0: 6273 4944 2d69 6e73 7472 756d 656e 7420  bsID-instrument 
+00028300: 7769 6c6c 2062 6520 696e 636c 7564 6564  will be included
+00028310: 2069 6e20 7468 6520 7265 7475 726e 6564   in the returned
+00028320: 0a20 2020 2020 2020 2072 656a 6563 7469  .        rejecti
+00028330: 6f6e 2064 6963 7469 6f6e 6172 792e 0a0a  on dictionary...
+00028340: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+00028350: 7472 2072 6567 5f74 7970 653a 2054 6865  tr reg_type: The
+00028360: 2072 6567 696f 6e20 7479 7065 2066 6f72   region type for
+00028370: 2077 6869 6368 2074 6f20 6361 6c63 756c   which to calcul
+00028380: 6174 6520 7468 6520 6172 6561 2069 6e74  ate the area int
+00028390: 6572 7365 6374 696f 6e2e 0a20 2020 2020  ersection..     
+000283a0: 2020 203a 7061 7261 6d20 666c 6f61 7420     :param float 
+000283b0: 7468 7265 7368 6f6c 645f 6672 6163 7469  threshold_fracti
+000283c0: 6f6e 3a20 496e 7465 7273 6563 7469 6f6e  on: Intersection
+000283d0: 2061 7265 612f 2066 756c 6c20 7265 6769   area/ full regi
+000283e0: 6f6e 2061 7265 6120 7261 7469 6f73 2062  on area ratios b
+000283f0: 656c 6f77 2074 6869 7320 7661 6c75 6520  elow this value 
+00028400: 7769 6c6c 206d 6561 6e20 616e 0a20 2020  will mean an.   
+00028410: 2020 2020 2020 2020 204f 6273 4944 2d49           ObsID-I
+00028420: 6e73 7472 756d 656e 7420 6973 2072 656a  nstrument is rej
+00028430: 6563 7465 642e 0a20 2020 2020 2020 203a  ected..        :
+00028440: 7265 7475 726e 3a20 4120 6469 6374 696f  return: A dictio
+00028450: 6e61 7279 206f 6620 4f62 7349 4420 6b65  nary of ObsID ke
+00028460: 7973 206f 6e20 7468 6520 746f 7020 6c65  ys on the top le
+00028470: 7665 6c2c 2074 6865 6e20 696e 7374 7275  vel, then instru
+00028480: 6d65 6e74 7320 6120 6c65 7665 6c20 646f  ments a level do
+00028490: 776e 2c20 7468 6174 0a20 2020 2020 2020  wn, that.       
+000284a0: 2020 2020 2073 686f 756c 6420 6265 2072       should be r
+000284b0: 656a 6563 7465 6420 6163 636f 7264 696e  ejected accordin
+000284c0: 6720 746f 2074 6865 2063 7269 7465 7269  g to the criteri
+000284d0: 6120 7375 7070 6c69 6564 2074 6f20 7468  a supplied to th
+000284e0: 6973 206d 6574 686f 642e 0a20 2020 2020  is method..     
+000284f0: 2020 203a 7274 7970 653a 2044 6963 740a     :rtype: Dict.
+00028500: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00028510: 2020 2020 2320 4167 6169 6e20 646f 6e27      # Again don'
+00028520: 7420 7061 7274 6963 756c 6172 6c79 2077  t particularly w
+00028530: 616e 7420 746f 2064 6f20 7468 6973 206c  ant to do this l
+00028540: 6f63 616c 2069 6d70 6f72 742c 2062 7574  ocal import, but
+00028550: 2069 7473 206a 7573 7420 6561 7369 6572   its just easier
+00028560: 0a20 2020 2020 2020 2066 726f 6d20 7867  .        from xg
+00028570: 612e 7361 7320 696d 706f 7274 2065 6578  a.sas import eex
+00028580: 706d 6170 0a0a 2020 2020 2020 2020 2320  pmap..        # 
+00028590: 476f 696e 6720 746f 2065 6e73 7572 6520  Going to ensure 
+000285a0: 7468 6174 2069 6e64 6976 6964 7561 6c20  that individual 
+000285b0: 6578 706f 7375 7265 206d 6170 7320 6578  exposure maps ex
+000285c0: 6973 7420 666f 7220 6561 6368 206f 6620  ist for each of 
+000285d0: 7468 6520 4f62 7349 442f 696e 7374 7275  the ObsID/instru
+000285e0: 6d65 6e74 2063 6f6d 6269 6e61 7469 6f6e  ment combination
+000285f0: 730a 2020 2020 2020 2020 2320 2066 6972  s.        #  fir
+00028600: 7374 2c20 7468 656e 2063 6865 636b 696e  st, then checkin
+00028610: 6720 7768 6572 6520 7468 6520 736f 7572  g where the sour
+00028620: 6365 206c 6965 7320 6f6e 2074 6865 2065  ce lies on the e
+00028630: 7870 6f73 7572 6520 6d61 700a 2020 2020  xposure map.    
+00028640: 2020 2020 6565 7870 6d61 7028 7365 6c66      eexpmap(self
+00028650: 2c20 7365 6c66 2e5f 7065 616b 5f6c 6f5f  , self._peak_lo_
+00028660: 656e 2c20 7365 6c66 2e5f 7065 616b 5f68  en, self._peak_h
+00028670: 695f 656e 290a 0a20 2020 2020 2020 2065  i_en)..        e
+00028680: 7874 7261 5f6b 6579 203d 2022 626f 756e  xtra_key = "boun
+00028690: 645f 7b6c 7d2d 7b75 7d22 2e66 6f72 6d61  d_{l}-{u}".forma
+000286a0: 7428 6c3d 7365 6c66 2e5f 7065 616b 5f6c  t(l=self._peak_l
+000286b0: 6f5f 656e 2e74 6f28 226b 6556 2229 2e76  o_en.to("keV").v
+000286c0: 616c 7565 2c20 753d 7365 6c66 2e5f 7065  alue, u=self._pe
+000286d0: 616b 5f68 695f 656e 2e74 6f28 226b 6556  ak_hi_en.to("keV
+000286e0: 2229 2e76 616c 7565 290a 0a20 2020 2020  ").value)..     
+000286f0: 2020 2061 7265 6120 3d20 7b6f 3a20 7b7d     area = {o: {}
+00028700: 2066 6f72 206f 2069 6e20 7365 6c66 2e6f   for o in self.o
+00028710: 6273 5f69 6473 7d0a 2020 2020 2020 2020  bs_ids}.        
+00028720: 6675 6c6c 5f61 7265 6120 3d20 7b6f 3a20  full_area = {o: 
+00028730: 7b7d 2066 6f72 206f 2069 6e20 7365 6c66  {} for o in self
+00028740: 2e6f 6273 5f69 6473 7d0a 2020 2020 2020  .obs_ids}.      
+00028750: 2020 666f 7220 6f20 696e 2073 656c 662e    for o in self.
+00028760: 6f62 735f 6964 733a 0a20 2020 2020 2020  obs_ids:.       
+00028770: 2020 2020 2023 2045 7870 6f73 7572 6520       # Exposure 
+00028780: 6d61 7073 206f 6620 7468 6520 7065 616b  maps of the peak
+00028790: 2066 696e 6469 6e67 2065 6e65 7267 7920   finding energy 
+000287a0: 7261 6e67 6520 666f 7220 7468 6973 204f  range for this O
+000287b0: 6273 4944 0a20 2020 2020 2020 2020 2020  bsID.           
+000287c0: 2065 7870 5f6d 6170 7320 3d20 7365 6c66   exp_maps = self
+000287d0: 2e67 6574 5f70 726f 6475 6374 7328 2265  .get_products("e
+000287e0: 7870 6d61 7022 2c20 6f2c 2065 7874 7261  xpmap", o, extra
+000287f0: 5f6b 6579 3d65 7874 7261 5f6b 6579 290a  _key=extra_key).
+00028800: 2020 2020 2020 2020 2020 2020 6d20 3d20              m = 
+00028810: 7365 6c66 2e67 6574 5f73 6f75 7263 655f  self.get_source_
+00028820: 6d61 736b 2872 6567 5f74 7970 652c 206f  mask(reg_type, o
+00028830: 2c20 6365 6e74 7261 6c5f 636f 6f72 643d  , central_coord=
+00028840: 7365 6c66 2e5f 6465 6661 756c 745f 636f  self._default_co
+00028850: 6f72 6429 5b30 5d0a 2020 2020 2020 2020  ord)[0].        
+00028860: 2020 2020 6675 6c6c 5f61 7265 615b 6f5d      full_area[o]
+00028870: 203d 206d 2e73 756d 2829 0a0a 2020 2020   = m.sum()..    
+00028880: 2020 2020 2020 2020 666f 7220 6578 2069          for ex i
+00028890: 6e20 6578 705f 6d61 7073 3a0a 2020 2020  n exp_maps:.    
+000288a0: 2020 2020 2020 2020 2020 2020 2320 4772              # Gr
+000288b0: 6162 7320 6578 706f 7375 7265 206d 6170  abs exposure map
+000288c0: 2064 6174 612c 2074 6865 6e20 616c 7465   data, then alte
+000288d0: 7273 2069 7420 736f 2061 6e79 7468 696e  rs it so anythin
+000288e0: 6720 7468 6174 2069 736e 2774 207a 6572  g that isn't zer
+000288f0: 6f20 6973 2061 206f 6e65 0a20 2020 2020  o is a one.     
+00028900: 2020 2020 2020 2020 2020 2065 785f 6461             ex_da
+00028910: 7461 203d 2065 782e 6461 7461 2e63 6f70  ta = ex.data.cop
+00028920: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+00028930: 2020 2020 6578 5f64 6174 615b 6578 5f64      ex_data[ex_d
+00028940: 6174 6120 3e20 305d 203d 2031 0a20 2020  ata > 0] = 1.   
+00028950: 2020 2020 2020 2020 2020 2020 2023 2057               # W
+00028960: 6520 646f 2074 6869 7320 6265 6361 7573  e do this becaus
+00028970: 6520 6974 2074 6865 6e20 6265 636f 6d65  e it then become
+00028980: 7320 7665 7279 2065 6173 7920 746f 2063  s very easy to c
+00028990: 616c 6375 6c61 7465 2074 6865 2069 6e74  alculate the int
+000289a0: 6572 7365 6374 696f 6e20 6172 6561 206f  ersection area o
+000289b0: 6620 7468 6520 6d61 736b 0a20 2020 2020  f the mask.     
+000289c0: 2020 2020 2020 2020 2020 2023 2020 7769             #  wi
+000289d0: 7468 2074 6865 2058 4d4d 2063 6869 7073  th the XMM chips
+000289e0: 2e20 4a75 7374 206d 6173 6b20 7468 6520  . Just mask the 
+000289f0: 6d6f 6469 6669 6564 2065 7870 6d61 702c  modified expmap,
+00028a00: 2074 6865 6e20 7375 6d2e 0a20 2020 2020   then sum..     
+00028a10: 2020 2020 2020 2020 2020 2061 7265 615b             area[
+00028a20: 6f5d 5b65 782e 696e 7374 7275 6d65 6e74  o][ex.instrument
+00028a30: 5d20 3d20 2865 785f 6461 7461 202a 206d  ] = (ex_data * m
+00028a40: 292e 7375 6d28 290a 0a20 2020 2020 2020  ).sum()..       
+00028a50: 2069 6620 6d61 7828 6c69 7374 2866 756c   if max(list(ful
+00028a60: 6c5f 6172 6561 2e76 616c 7565 7328 2929  l_area.values())
+00028a70: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+00028a80: 2020 2020 2320 4576 6572 7974 6869 6e67      # Everything
+00028a90: 2068 6173 2074 6f20 6265 2072 656a 6563   has to be rejec
+00028aa0: 7465 6420 696e 2074 6869 7320 6361 7365  ted in this case
+00028ab0: 0a20 2020 2020 2020 2020 2020 2072 656a  .            rej
+00028ac0: 6563 745f 6469 6374 203d 2064 6565 7063  ect_dict = deepc
+00028ad0: 6f70 7928 7365 6c66 2e5f 696e 7374 7275  opy(self._instru
+00028ae0: 6d65 6e74 7329 0a20 2020 2020 2020 2065  ments).        e
+00028af0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00028b00: 2072 656a 6563 745f 6469 6374 203d 207b   reject_dict = {
+00028b10: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
+00028b20: 7220 6f20 696e 2061 7265 613a 0a20 2020  r o in area:.   
+00028b30: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00028b40: 2069 2069 6e20 6172 6561 5b6f 5d3a 0a20   i in area[o]:. 
 00028b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b60: 7265 6a65 6374 5f64 6963 745b 6f5d 2e61  reject_dict[o].a
-00028b70: 7070 656e 6428 6929 0a0a 2020 2020 2020  ppend(i)..      
-00028b80: 2020 7265 7475 726e 2072 656a 6563 745f    return reject_
-00028b90: 6469 6374 0a0a 2020 2020 2320 416e 6420  dict..    # And 
-00028ba0: 6865 7265 2049 276d 2061 6464 696e 6720  here I'm adding 
-00028bb0: 6120 6275 6e63 6820 6f66 2067 6574 206d  a bunch of get m
-00028bc0: 6574 686f 6473 2074 6861 7420 7368 6f75  ethods that shou
-00028bd0: 6c64 206d 6561 6e20 7468 6520 7573 6572  ld mean the user
-00028be0: 206e 6576 6572 2068 6173 2074 6f20 7573   never has to us
-00028bf0: 6520 6765 745f 7072 6f64 7563 7473 2c20  e get_products, 
-00028c00: 666f 720a 2020 2020 2320 2069 6e64 6976  for.    #  indiv
-00028c10: 6964 7561 6c20 7072 6f64 7563 7420 7479  idual product ty
-00028c20: 7065 732e 2049 7420 7769 6c6c 2061 6c73  pes. It will als
-00028c30: 6f20 6d65 616e 2074 6861 7420 7468 6579  o mean that they
-00028c40: 2077 696c 6c20 6e65 7665 7220 6861 7665   will never have
-00028c50: 2074 6f20 6669 6775 7265 206f 7574 2065   to figure out e
-00028c60: 7874 7261 206b 6579 7320 7468 656d 7365  xtra keys themse
-00028c70: 6c76 6573 0a20 2020 2023 2020 616e 6420  lves.    #  and 
-00028c80: 4920 6361 6e20 6d61 6b65 206c 6973 7473  I can make lists
-00028c90: 206f 6620 3120 7072 6f64 7563 7420 7265   of 1 product re
-00028ca0: 7475 726e 206a 7573 7420 6173 2074 6865  turn just as the
-00028cb0: 2070 726f 6475 6374 2077 6974 686f 7574   product without
-00028cc0: 2062 6569 6e67 2061 2062 7265 616b 696e   being a breakin
-00028cd0: 6720 6368 616e 6765 0a20 2020 2064 6566  g change.    def
-00028ce0: 2067 6574 5f73 7065 6374 7261 2873 656c   get_spectra(sel
-00028cf0: 662c 206f 7574 6572 5f72 6164 6975 733a  f, outer_radius:
-00028d00: 2055 6e69 6f6e 5b73 7472 2c20 5175 616e   Union[str, Quan
-00028d10: 7469 7479 5d2c 206f 6273 5f69 643a 2073  tity], obs_id: s
-00028d20: 7472 203d 204e 6f6e 652c 2069 6e73 743a  tr = None, inst:
-00028d30: 2073 7472 203d 204e 6f6e 652c 0a20 2020   str = None,.   
-00028d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028d50: 2069 6e6e 6572 5f72 6164 6975 733a 2055   inner_radius: U
-00028d60: 6e69 6f6e 5b73 7472 2c20 5175 616e 7469  nion[str, Quanti
-00028d70: 7479 5d20 3d20 5175 616e 7469 7479 2830  ty] = Quantity(0
-00028d80: 2c20 2761 7263 7365 6327 292c 2067 726f  , 'arcsec'), gro
-00028d90: 7570 5f73 7065 633a 2062 6f6f 6c20 3d20  up_spec: bool = 
-00028da0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00028db0: 2020 2020 2020 2020 2020 6d69 6e5f 636f            min_co
-00028dc0: 756e 7473 3a20 696e 7420 3d20 352c 206d  unts: int = 5, m
-00028dd0: 696e 5f73 6e3a 2066 6c6f 6174 203d 204e  in_sn: float = N
-00028de0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00028df0: 2020 2020 2020 2020 206f 7665 725f 7361           over_sa
-00028e00: 6d70 6c65 3a20 666c 6f61 7420 3d20 4e6f  mple: float = No
-00028e10: 6e65 2920 2d3e 2055 6e69 6f6e 5b53 7065  ne) -> Union[Spe
-00028e20: 6374 7275 6d2c 204c 6973 745b 5370 6563  ctrum, List[Spec
-00028e30: 7472 756d 5d5d 3a0a 2020 2020 2020 2020  trum]]:.        
-00028e40: 2222 220a 2020 2020 2020 2020 4120 7573  """.        A us
-00028e50: 6566 756c 206d 6574 686f 6420 7468 6174  eful method that
-00028e60: 2077 7261 7073 2074 6865 2067 6574 5f70   wraps the get_p
-00028e70: 726f 6475 6374 7320 6675 6e63 7469 6f6e  roducts function
-00028e80: 2074 6f20 616c 6c6f 7720 796f 7520 746f   to allow you to
-00028e90: 2065 6173 696c 7920 7265 7472 6965 7665   easily retrieve
-00028ea0: 2058 4741 2053 7065 6374 7275 6d20 6f62   XGA Spectrum ob
-00028eb0: 6a65 6374 732e 0a20 2020 2020 2020 2053  jects..        S
-00028ec0: 696d 706c 7920 7061 7373 2074 6865 2064  imply pass the d
-00028ed0: 6573 6972 6564 204f 6273 4944 2f69 6e73  esired ObsID/ins
-00028ee0: 7472 756d 656e 742c 2061 6e64 2074 6865  trument, and the
-00028ef0: 2073 616d 6520 7365 7474 696e 6773 2079   same settings y
-00028f00: 6f75 2075 7365 6420 746f 2067 656e 6572  ou used to gener
-00028f10: 6174 6520 7468 6520 7370 6563 7472 756d  ate the spectrum
-00028f20: 0a20 2020 2020 2020 2069 6e20 6576 7365  .        in evse
-00028f30: 6c65 6374 5f73 7065 6374 7275 6d2c 2061  lect_spectrum, a
-00028f40: 6e64 2074 6865 2073 7065 6374 7261 2875  nd the spectra(u
-00028f50: 6d29 2077 696c 6c20 6265 2070 726f 7669  m) will be provi
-00028f60: 6465 6420 746f 2079 6f75 2e20 4966 206e  ded to you. If n
-00028f70: 6f20 6d61 7463 6820 6973 2066 6f75 6e64  o match is found
-00028f80: 2074 6865 6e20 610a 2020 2020 2020 2020   then a.        
-00028f90: 4e6f 5072 6f64 7563 7441 7661 696c 6162  NoProductAvailab
-00028fa0: 6c65 4572 726f 7220 7769 6c6c 2062 6520  leError will be 
-00028fb0: 7261 6973 6564 2e0a 0a20 2020 2020 2020  raised...       
-00028fc0: 203a 7061 7261 6d20 7374 722f 5175 616e   :param str/Quan
-00028fd0: 7469 7479 206f 7574 6572 5f72 6164 6975  tity outer_radiu
-00028fe0: 733a 2054 6865 206e 616d 6520 6f72 2076  s: The name or v
-00028ff0: 616c 7565 206f 6620 7468 6520 6f75 7465  alue of the oute
-00029000: 7220 7261 6469 7573 2074 6861 7420 7761  r radius that wa
-00029010: 7320 7573 6564 2066 6f72 2074 6865 2067  s used for the g
-00029020: 656e 6572 6174 696f 6e20 6f66 0a20 2020  eneration of.   
-00029030: 2020 2020 2020 2020 2074 6865 2073 7065           the spe
-00029040: 6374 7275 6d20 2866 6f72 2069 6e73 7461  ctrum (for insta
-00029050: 6e63 6520 2772 3230 3027 2077 6f75 6c64  nce 'r200' would
-00029060: 2062 6520 6163 6365 7074 6162 6c65 2066   be acceptable f
-00029070: 6f72 2061 2047 616c 6178 7943 6c75 7374  or a GalaxyClust
-00029080: 6572 2c20 6f72 2051 7561 6e74 6974 7928  er, or Quantity(
-00029090: 3130 3030 2c20 276b 7063 2729 292e 2049  1000, 'kpc')). I
-000290a0: 660a 2020 2020 2020 2020 2020 2020 2772  f.            'r
-000290b0: 6567 696f 6e27 2069 7320 6368 6f73 656e  egion' is chosen
-000290c0: 2028 746f 2075 7365 2074 6865 2072 6567   (to use the reg
-000290d0: 696f 6e73 2069 6e20 7265 6769 6f6e 2066  ions in region f
-000290e0: 696c 6573 292c 2074 6865 6e20 616e 7920  iles), then any 
-000290f0: 696e 6e65 7220 7261 6469 7573 2077 696c  inner radius wil
-00029100: 6c20 6265 2069 676e 6f72 6564 2e0a 2020  l be ignored..  
-00029110: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
-00029120: 206f 6273 5f69 643a 204f 7074 696f 6e61   obs_id: Optiona
-00029130: 6c6c 792c 2061 2073 7065 6369 6669 6320  lly, a specific 
-00029140: 6f62 735f 6964 2074 6f20 7365 6172 6368  obs_id to search
-00029150: 2066 6f72 2063 616e 2062 6520 7375 7070   for can be supp
-00029160: 6c69 6564 2e20 5468 6520 6465 6661 756c  lied. The defaul
-00029170: 7420 6973 204e 6f6e 652c 0a20 2020 2020  t is None,.     
-00029180: 2020 2020 2020 2077 6869 6368 206d 6561         which mea
-00029190: 6e73 2061 6c6c 2073 7065 6374 7261 206d  ns all spectra m
-000291a0: 6174 6368 696e 6720 7468 6520 6f74 6865  atching the othe
-000291b0: 7220 6372 6974 6572 6961 2077 696c 6c20  r criteria will 
-000291c0: 6265 2072 6574 7572 6e65 642e 0a20 2020  be returned..   
-000291d0: 2020 2020 203a 7061 7261 6d20 7374 7220       :param str 
-000291e0: 696e 7374 3a20 4f70 7469 6f6e 616c 6c79  inst: Optionally
-000291f0: 2c20 6120 7370 6563 6966 6963 2069 6e73  , a specific ins
-00029200: 7472 756d 656e 7420 746f 2073 6561 7263  trument to searc
-00029210: 6820 666f 7220 6361 6e20 6265 2073 7570  h for can be sup
-00029220: 706c 6965 642e 2054 6865 2064 6566 6175  plied. The defau
-00029230: 6c74 2069 7320 4e6f 6e65 2c0a 2020 2020  lt is None,.    
-00029240: 2020 2020 2020 2020 7768 6963 6820 6d65          which me
-00029250: 616e 7320 616c 6c20 7370 6563 7472 6120  ans all spectra 
-00029260: 6d61 7463 6869 6e67 2074 6865 206f 7468  matching the oth
-00029270: 6572 2063 7269 7465 7269 6120 7769 6c6c  er criteria will
-00029280: 2062 6520 7265 7475 726e 6564 2e0a 2020   be returned..  
-00029290: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
-000292a0: 2f51 7561 6e74 6974 7920 696e 6e65 725f  /Quantity inner_
-000292b0: 7261 6469 7573 3a20 5468 6520 6e61 6d65  radius: The name
-000292c0: 206f 7220 7661 6c75 6520 6f66 2074 6865   or value of the
-000292d0: 2069 6e6e 6572 2072 6164 6975 7320 7468   inner radius th
-000292e0: 6174 2077 6173 2075 7365 6420 666f 7220  at was used for 
-000292f0: 7468 6520 6765 6e65 7261 7469 6f6e 206f  the generation o
-00029300: 660a 2020 2020 2020 2020 2020 2020 7468  f.            th
-00029310: 6520 7370 6563 7472 756d 2028 666f 7220  e spectrum (for 
-00029320: 696e 7374 616e 6365 2027 7235 3030 2720  instance 'r500' 
-00029330: 776f 756c 6420 6265 2061 6363 6570 7461  would be accepta
-00029340: 626c 6520 666f 7220 6120 4761 6c61 7879  ble for a Galaxy
-00029350: 436c 7573 7465 722c 206f 7220 5175 616e  Cluster, or Quan
-00029360: 7469 7479 2833 3030 2c20 276b 7063 2729  tity(300, 'kpc')
-00029370: 292e 2042 790a 2020 2020 2020 2020 2020  ). By.          
-00029380: 2020 6465 6661 756c 7420 7468 6973 2069    default this i
-00029390: 7320 7a65 726f 2061 7263 7365 636f 6e64  s zero arcsecond
-000293a0: 732c 2072 6573 756c 7469 6e67 2069 6e20  s, resulting in 
-000293b0: 6120 6369 7263 756c 6172 2073 7065 6374  a circular spect
-000293c0: 7275 6d2e 0a20 2020 2020 2020 203a 7061  rum..        :pa
-000293d0: 7261 6d20 626f 6f6c 2067 726f 7570 5f73  ram bool group_s
-000293e0: 7065 633a 2057 6173 2074 6865 2073 7065  pec: Was the spe
-000293f0: 6374 7275 6d20 796f 7520 7769 7368 2074  ctrum you wish t
-00029400: 6f20 7265 7472 6965 7665 2067 726f 7570  o retrieve group
-00029410: 6564 3f0a 2020 2020 2020 2020 3a70 6172  ed?.        :par
-00029420: 616d 2066 6c6f 6174 206d 696e 5f63 6f75  am float min_cou
-00029430: 6e74 733a 2049 6620 7468 6520 7370 6563  nts: If the spec
-00029440: 7472 756d 2079 6f75 2077 6973 6820 746f  trum you wish to
-00029450: 2072 6574 7269 6576 6520 7761 7320 6772   retrieve was gr
-00029460: 6f75 7065 6420 6f6e 206d 696e 696d 756d  ouped on minimum
-00029470: 2063 6f75 6e74 732c 2077 6861 7420 7761   counts, what wa
-00029480: 730a 2020 2020 2020 2020 2020 2020 7468  s.            th
-00029490: 6520 6d69 6e69 6d75 6d20 6e75 6d62 6572  e minimum number
-000294a0: 206f 6620 636f 756e 7473 3f0a 2020 2020   of counts?.    
-000294b0: 2020 2020 3a70 6172 616d 2066 6c6f 6174      :param float
-000294c0: 206d 696e 5f73 6e3a 2049 6620 7468 6520   min_sn: If the 
-000294d0: 7370 6563 7472 756d 2079 6f75 2077 6973  spectrum you wis
-000294e0: 6820 746f 2072 6574 7269 6576 6520 7761  h to retrieve wa
-000294f0: 7320 6772 6f75 7065 6420 6f6e 206d 696e  s grouped on min
-00029500: 696d 756d 2073 6967 6e61 6c20 746f 206e  imum signal to n
-00029510: 6f69 7365 2c20 7768 6174 2077 6173 0a20  oise, what was. 
-00029520: 2020 2020 2020 2020 2020 2074 6865 206d             the m
-00029530: 696e 696d 756d 2073 6967 6e61 6c20 746f  inimum signal to
-00029540: 206e 6f69 7365 2e0a 2020 2020 2020 2020   noise..        
-00029550: 3a70 6172 616d 2066 6c6f 6174 206f 7665  :param float ove
-00029560: 725f 7361 6d70 6c65 3a20 4966 2074 6865  r_sample: If the
-00029570: 2073 7065 6374 7275 6d20 796f 7520 7769   spectrum you wi
-00029580: 7368 2074 6f20 7265 7472 6965 7665 2077  sh to retrieve w
-00029590: 6173 206f 7665 7220 7361 6d70 6c65 642c  as over sampled,
-000295a0: 2077 6861 7420 7761 7320 7468 6520 6c65   what was the le
-000295b0: 7665 6c20 6f66 0a20 2020 2020 2020 2020  vel of.         
-000295c0: 2020 206f 7665 7220 7361 6d70 6c69 6e67     over sampling
-000295d0: 2075 7365 643f 0a20 2020 2020 2020 203a   used?.        :
-000295e0: 7265 7475 726e 3a20 416e 2058 4741 2053  return: An XGA S
-000295f0: 7065 6374 7275 6d20 6f62 6a65 6374 2028  pectrum object (
-00029600: 6966 2074 6865 7265 2069 7320 616e 2065  if there is an e
-00029610: 7861 6374 206d 6174 6368 292c 206f 7220  xact match), or 
-00029620: 6120 6c69 7374 206f 6620 5847 4120 5370  a list of XGA Sp
-00029630: 6563 7472 756d 206f 626a 6563 7473 2028  ectrum objects (
-00029640: 6966 2074 6865 7265 0a20 2020 2020 2020  if there.       
-00029650: 2020 2020 2077 6572 6520 6d75 6c74 6970       were multip
-00029660: 6c65 206d 6174 6368 696e 6720 7072 6f64  le matching prod
-00029670: 7563 7473 292e 0a20 2020 2020 2020 203a  ucts)..        :
-00029680: 7274 7970 653a 2055 6e69 6f6e 5b53 7065  rtype: Union[Spe
-00029690: 6374 7275 6d2c 204c 6973 745b 5370 6563  ctrum, List[Spec
-000296a0: 7472 756d 5d5d 0a20 2020 2020 2020 2022  trum]].        "
-000296b0: 2222 0a20 2020 2020 2020 2069 6620 6973  "".        if is
-000296c0: 696e 7374 616e 6365 2869 6e6e 6572 5f72  instance(inner_r
-000296d0: 6164 6975 732c 2051 7561 6e74 6974 7929  adius, Quantity)
-000296e0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-000296f0: 6e5f 7261 645f 6e75 6d20 3d20 7365 6c66  n_rad_num = self
-00029700: 2e63 6f6e 7665 7274 5f72 6164 6975 7328  .convert_radius(
-00029710: 696e 6e65 725f 7261 6469 7573 2c20 2764  inner_radius, 'd
-00029720: 6567 2729 0a20 2020 2020 2020 2065 6c69  eg').        eli
-00029730: 6620 6973 696e 7374 616e 6365 2869 6e6e  f isinstance(inn
-00029740: 6572 5f72 6164 6975 732c 2073 7472 293a  er_radius, str):
-00029750: 0a20 2020 2020 2020 2020 2020 2069 6e6e  .            inn
-00029760: 5f72 6164 5f6e 756d 203d 2073 656c 662e  _rad_num = self.
-00029770: 6765 745f 7261 6469 7573 2869 6e6e 6572  get_radius(inner
-00029780: 5f72 6164 6975 732c 2027 6465 6727 290a  _radius, 'deg').
-00029790: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000297a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000297b0: 5479 7065 4572 726f 7228 2259 6f75 206d  TypeError("You m
-000297c0: 6179 206f 6e6c 7920 7061 7373 2061 2071  ay only pass a q
-000297d0: 7561 6e74 6974 7920 6f72 2061 2073 7472  uantity or a str
-000297e0: 696e 6720 6173 2069 6e6e 6572 5f72 6164  ing as inner_rad
-000297f0: 6975 7322 290a 0a20 2020 2020 2020 2069  ius")..        i
-00029800: 6620 6973 696e 7374 616e 6365 286f 7574  f isinstance(out
-00029810: 6572 5f72 6164 6975 732c 2051 7561 6e74  er_radius, Quant
-00029820: 6974 7929 3a0a 2020 2020 2020 2020 2020  ity):.          
-00029830: 2020 6f75 745f 7261 645f 6e75 6d20 3d20    out_rad_num = 
-00029840: 7365 6c66 2e63 6f6e 7665 7274 5f72 6164  self.convert_rad
-00029850: 6975 7328 6f75 7465 725f 7261 6469 7573  ius(outer_radius
-00029860: 2c20 2764 6567 2729 0a20 2020 2020 2020  , 'deg').       
-00029870: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00029880: 286f 7574 6572 5f72 6164 6975 732c 2073  (outer_radius, s
-00029890: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-000298a0: 206f 7574 5f72 6164 5f6e 756d 203d 2073   out_rad_num = s
-000298b0: 656c 662e 6765 745f 7261 6469 7573 286f  elf.get_radius(o
-000298c0: 7574 6572 5f72 6164 6975 732c 2027 6465  uter_radius, 'de
-000298d0: 6727 290a 2020 2020 2020 2020 656c 7365  g').        else
-000298e0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000298f0: 6973 6520 5479 7065 4572 726f 7228 2259  ise TypeError("Y
-00029900: 6f75 206d 6179 206f 6e6c 7920 7061 7373  ou may only pass
-00029910: 2061 2071 7561 6e74 6974 7920 6f72 2061   a quantity or a
-00029920: 2073 7472 696e 6720 6173 206f 7574 6572   string as outer
-00029930: 5f72 6164 6975 7322 290a 0a20 2020 2020  _radius")..     
-00029940: 2020 2069 6620 6f76 6572 5f73 616d 706c     if over_sampl
-00029950: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00029960: 2020 2020 2020 2020 2020 206f 7665 725f             over_
-00029970: 7361 6d70 6c65 203d 2069 6e74 286f 7665  sample = int(ove
-00029980: 725f 7361 6d70 6c65 290a 2020 2020 2020  r_sample).      
-00029990: 2020 6966 206d 696e 5f63 6f75 6e74 7320    if min_counts 
-000299a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000299b0: 2020 2020 2020 2020 206d 696e 5f63 6f75           min_cou
-000299c0: 6e74 7320 3d20 696e 7428 6d69 6e5f 636f  nts = int(min_co
-000299d0: 756e 7473 290a 2020 2020 2020 2020 6966  unts).        if
-000299e0: 206d 696e 5f73 6e20 6973 206e 6f74 204e   min_sn is not N
-000299f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00029a00: 206d 696e 5f73 6e20 3d20 666c 6f61 7428   min_sn = float(
-00029a10: 6d69 6e5f 736e 290a 0a20 2020 2020 2020  min_sn)..       
-00029a20: 2023 2053 6574 7320 7570 2074 6865 2065   # Sets up the e
-00029a30: 7874 7261 2070 6172 7420 6f66 2074 6865  xtra part of the
-00029a40: 2073 746f 7261 6765 206b 6579 206e 616d   storage key nam
-00029a50: 6520 6465 7065 6e64 696e 6720 6f6e 2069  e depending on i
-00029a60: 6620 6772 6f75 7069 6e67 2069 7320 656e  f grouping is en
-00029a70: 6162 6c65 640a 2020 2020 2020 2020 6966  abled.        if
-00029a80: 2067 726f 7570 5f73 7065 6320 616e 6420   group_spec and 
-00029a90: 6d69 6e5f 636f 756e 7473 2069 7320 6e6f  min_counts is no
-00029aa0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00029ab0: 2020 2020 6578 7472 615f 6e61 6d65 203d      extra_name =
-00029ac0: 2022 5f6d 696e 636e 747b 7d22 2e66 6f72   "_mincnt{}".for
-00029ad0: 6d61 7428 6d69 6e5f 636f 756e 7473 290a  mat(min_counts).
-00029ae0: 2020 2020 2020 2020 656c 6966 2067 726f          elif gro
-00029af0: 7570 5f73 7065 6320 616e 6420 6d69 6e5f  up_spec and min_
-00029b00: 736e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  sn is not None:.
-00029b10: 2020 2020 2020 2020 2020 2020 6578 7472              extr
-00029b20: 615f 6e61 6d65 203d 2022 5f6d 696e 736e  a_name = "_minsn
-00029b30: 7b7d 222e 666f 726d 6174 286d 696e 5f73  {}".format(min_s
-00029b40: 6e29 0a20 2020 2020 2020 2065 6c73 653a  n).        else:
-00029b50: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
-00029b60: 7261 5f6e 616d 6520 3d20 2727 0a0a 2020  ra_name = ''..  
-00029b70: 2020 2020 2020 2320 416e 6420 6966 2069        # And if i
-00029b80: 7420 7761 7320 6f76 6572 7361 6d70 6c65  t was oversample
-00029b90: 6420 6475 7269 6e67 2067 656e 6572 6174  d during generat
-00029ba0: 696f 6e20 7468 656e 2077 6520 6e65 6564  ion then we need
-00029bb0: 2074 6f20 696e 636c 7564 6520 7468 6174   to include that
-00029bc0: 2061 7320 7765 6c6c 0a20 2020 2020 2020   as well.       
-00029bd0: 2069 6620 6f76 6572 5f73 616d 706c 6520   if over_sample 
-00029be0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00029bf0: 2020 2020 2020 2020 2065 7874 7261 5f6e           extra_n
-00029c00: 616d 6520 2b3d 2022 5f6f 7673 616d 707b  ame += "_ovsamp{
-00029c10: 6f76 7d22 2e66 6f72 6d61 7428 6f76 3d6f  ov}".format(ov=o
-00029c20: 7665 725f 7361 6d70 6c65 290a 0a20 2020  ver_sample)..   
-00029c30: 2020 2020 2069 6620 6f75 7465 725f 7261       if outer_ra
-00029c40: 6469 7573 2021 3d20 2772 6567 696f 6e27  dius != 'region'
-00029c50: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00029c60: 5468 6520 6b65 7920 756e 6465 7220 7768  The key under wh
-00029c70: 6963 6820 7468 6573 6520 7370 6563 7472  ich these spectr
-00029c80: 6120 7769 6c6c 2062 6520 7374 6f72 6564  a will be stored
-00029c90: 0a20 2020 2020 2020 2020 2020 2073 7065  .            spe
-00029ca0: 635f 7374 6f72 6167 655f 6e61 6d65 203d  c_storage_name =
-00029cb0: 2022 7261 7b72 617d 5f64 6563 7b64 6563   "ra{ra}_dec{dec
-00029cc0: 7d5f 7269 7b72 697d 5f72 6f7b 726f 7d5f  }_ri{ri}_ro{ro}_
-00029cd0: 6772 707b 6772 7d22 0a20 2020 2020 2020  grp{gr}".       
-00029ce0: 2020 2020 2073 7065 635f 7374 6f72 6167       spec_storag
-00029cf0: 655f 6e61 6d65 203d 2073 7065 635f 7374  e_name = spec_st
-00029d00: 6f72 6167 655f 6e61 6d65 2e66 6f72 6d61  orage_name.forma
-00029d10: 7428 7261 3d73 656c 662e 6465 6661 756c  t(ra=self.defaul
-00029d20: 745f 636f 6f72 645b 305d 2e76 616c 7565  t_coord[0].value
-00029d30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00029d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d60: 2020 2020 2020 2020 2020 2064 6563 3d73             dec=s
-00029d70: 656c 662e 6465 6661 756c 745f 636f 6f72  elf.default_coor
-00029d80: 645b 315d 2e76 616c 7565 2c0a 2020 2020  d[1].value,.    
-00029d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029dc0: 2020 2020 2072 693d 696e 6e5f 7261 645f       ri=inn_rad_
-00029dd0: 6e75 6d2e 7661 6c75 652c 2072 6f3d 6f75  num.value, ro=ou
-00029de0: 745f 7261 645f 6e75 6d2e 7661 6c75 652c  t_rad_num.value,
-00029df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e20: 2020 2020 2020 2020 2020 6772 3d67 726f            gr=gro
-00029e30: 7570 5f73 7065 6329 0a20 2020 2020 2020  up_spec).       
-00029e40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00029e50: 2020 2073 7065 635f 7374 6f72 6167 655f     spec_storage_
-00029e60: 6e61 6d65 203d 2022 7265 6769 6f6e 5f67  name = "region_g
-00029e70: 7270 7b67 727d 222e 666f 726d 6174 2867  rp{gr}".format(g
-00029e80: 723d 6772 6f75 705f 7370 6563 290a 0a20  r=group_spec).. 
-00029e90: 2020 2020 2020 2023 2041 6464 7320 6f6e         # Adds on
-00029ea0: 2074 6865 2065 7874 7261 2069 6e66 6f72   the extra infor
-00029eb0: 6d61 7469 6f6e 2061 626f 7574 2067 726f  mation about gro
-00029ec0: 7570 696e 6720 746f 2074 6865 2073 746f  uping to the sto
-00029ed0: 7261 6765 206b 6579 0a20 2020 2020 2020  rage key.       
-00029ee0: 2073 7065 635f 7374 6f72 6167 655f 6e61   spec_storage_na
-00029ef0: 6d65 202b 3d20 6578 7472 615f 6e61 6d65  me += extra_name
-00029f00: 0a20 2020 2020 2020 206d 6174 6368 6564  .        matched
-00029f10: 5f70 726f 6473 203d 2073 656c 662e 6765  _prods = self.ge
-00029f20: 745f 7072 6f64 7563 7473 2827 7370 6563  t_products('spec
-00029f30: 7472 756d 272c 206f 6273 5f69 643d 6f62  trum', obs_id=ob
-00029f40: 735f 6964 2c20 696e 7374 3d69 6e73 742c  s_id, inst=inst,
-00029f50: 2065 7874 7261 5f6b 6579 3d73 7065 635f   extra_key=spec_
-00029f60: 7374 6f72 6167 655f 6e61 6d65 290a 2020  storage_name).  
-00029f70: 2020 2020 2020 6966 206c 656e 286d 6174        if len(mat
-00029f80: 6368 6564 5f70 726f 6473 2920 3d3d 2031  ched_prods) == 1
-00029f90: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-00029fa0: 7463 6865 645f 7072 6f64 7320 3d20 6d61  tched_prods = ma
-00029fb0: 7463 6865 645f 7072 6f64 735b 305d 0a20  tched_prods[0]. 
-00029fc0: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
-00029fd0: 6d61 7463 6865 645f 7072 6f64 7329 203d  matched_prods) =
-00029fe0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00029ff0: 2072 6169 7365 204e 6f50 726f 6475 6374   raise NoProduct
-0002a000: 4176 6169 6c61 626c 6545 7272 6f72 2822  AvailableError("
-0002a010: 4361 6e6e 6f74 2066 696e 6420 616e 7920  Cannot find any 
-0002a020: 7370 6563 7472 6120 6d61 7463 6869 6e67  spectra matching
-0002a030: 2079 6f75 7220 696e 7075 742e 2229 0a0a   your input.")..
-0002a040: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0002a050: 6174 6368 6564 5f70 726f 6473 0a0a 2020  atched_prods..  
-0002a060: 2020 6465 6620 6765 745f 616e 6e75 6c61    def get_annula
-0002a070: 725f 7370 6563 7472 6128 7365 6c66 2c20  r_spectra(self, 
-0002a080: 7261 6469 693a 2051 7561 6e74 6974 7920  radii: Quantity 
-0002a090: 3d20 4e6f 6e65 2c20 6772 6f75 705f 7370  = None, group_sp
-0002a0a0: 6563 3a20 626f 6f6c 203d 2054 7275 652c  ec: bool = True,
-0002a0b0: 206d 696e 5f63 6f75 6e74 733a 2069 6e74   min_counts: int
-0002a0c0: 203d 2035 2c0a 2020 2020 2020 2020 2020   = 5,.          
-0002a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0e0: 2020 6d69 6e5f 736e 3a20 666c 6f61 7420    min_sn: float 
-0002a0f0: 3d20 4e6f 6e65 2c20 6f76 6572 5f73 616d  = None, over_sam
-0002a100: 706c 653a 2066 6c6f 6174 203d 204e 6f6e  ple: float = Non
-0002a110: 652c 2073 6574 5f69 643a 2069 6e74 203d  e, set_id: int =
-0002a120: 204e 6f6e 6529 202d 3e20 416e 6e75 6c61   None) -> Annula
-0002a130: 7253 7065 6374 7261 3a0a 2020 2020 2020  rSpectra:.      
-0002a140: 2020 2222 220a 2020 2020 2020 2020 416e    """.        An
-0002a150: 6f74 6865 7220 7573 6566 756c 206d 6574  other useful met
-0002a160: 686f 6420 7468 6174 2077 7261 7073 2074  hod that wraps t
-0002a170: 6865 2067 6574 5f70 726f 6475 6374 7320  he get_products 
-0002a180: 6675 6e63 7469 6f6e 2c20 7468 6f75 6768  function, though
-0002a190: 2074 6869 7320 6f6e 6520 6765 7473 2079   this one gets y
-0002a1a0: 6f75 2041 6e6e 756c 6172 5370 6563 7472  ou AnnularSpectr
-0002a1b0: 612e 0a20 2020 2020 2020 2050 6173 7320  a..        Pass 
-0002a1c0: 7468 6520 7261 6469 6920 7573 6564 2074  the radii used t
-0002a1d0: 6f20 6765 6e65 7261 7465 2074 6865 2061  o generate the a
-0002a1e0: 6e6e 756c 692c 2061 6e64 2074 6865 2073  nnuli, and the s
-0002a1f0: 616d 6520 7365 7474 696e 6773 2079 6f75  ame settings you
-0002a200: 2075 7365 6420 746f 2067 656e 6572 6174   used to generat
-0002a210: 6520 7468 6520 7370 6563 7472 756d 0a20  e the spectrum. 
-0002a220: 2020 2020 2020 2069 6e20 7370 6563 7472         in spectr
-0002a230: 756d 5f73 6574 2c20 616e 6420 7468 6520  um_set, and the 
-0002a240: 416e 6e75 6c61 7253 7065 6374 7261 2077  AnnularSpectra w
-0002a250: 696c 6c20 6265 2072 6574 7572 6e65 6420  ill be returned 
-0002a260: 2869 6620 6974 2065 7869 7374 7329 2e20  (if it exists). 
-0002a270: 4966 206e 6f20 6d61 7463 6820 6973 2066  If no match is f
-0002a280: 6f75 6e64 2074 6865 6e0a 2020 2020 2020  ound then.      
-0002a290: 2020 6120 4e6f 5072 6f64 7563 7441 7661    a NoProductAva
-0002a2a0: 696c 6162 6c65 4572 726f 7220 7769 6c6c  ilableError will
-0002a2b0: 2062 6520 7261 6973 6564 2e20 5468 6973   be raised. This
-0002a2c0: 206d 6574 686f 6420 6861 7320 616e 2061   method has an a
-0002a2d0: 6464 6974 696f 6e61 6c20 7761 7920 6f66  dditional way of
-0002a2e0: 206c 6f6f 6b69 6e67 2066 6f72 2061 206d   looking for a m
-0002a2f0: 6174 6368 696e 670a 2020 2020 2020 2020  atching.        
-0002a300: 7370 6563 7472 756d 2c20 6966 2074 6865  spectrum, if the
-0002a310: 2073 6574 2049 4420 6973 206b 6e6f 776e   set ID is known
-0002a320: 2074 6865 6e20 7468 6174 2063 616e 2062   then that can b
-0002a330: 6520 7061 7373 6564 2062 7920 7468 6520  e passed by the 
-0002a340: 7573 6572 2061 6e64 2075 7365 6420 746f  user and used to
-0002a350: 2066 696e 6420 616e 2065 7861 6374 206d   find an exact m
-0002a360: 6174 6368 2e0a 0a20 2020 2020 2020 203a  atch...        :
-0002a370: 7061 7261 6d20 5175 616e 7469 7479 2072  param Quantity r
-0002a380: 6164 6969 3a20 5468 6520 616e 6e75 6c75  adii: The annulu
-0002a390: 7320 626f 756e 6461 7279 2072 6164 6969  s boundary radii
-0002a3a0: 2074 6861 7420 7765 7265 2075 7365 6420   that were used 
-0002a3b0: 746f 2067 656e 6572 6174 6520 7468 6520  to generate the 
-0002a3c0: 616e 6e75 6c61 7220 7370 6563 7472 6120  annular spectra 
-0002a3d0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-0002a3e0: 7468 6174 2079 6f75 2077 6973 6820 746f  that you wish to
-0002a3f0: 2072 6574 7269 6576 652e 2042 7920 6465   retrieve. By de
-0002a400: 6661 756c 7420 7468 6973 2069 7320 4e6f  fault this is No
-0002a410: 6e65 2c20 7768 6963 6820 6d65 616e 7320  ne, which means 
-0002a420: 7468 6520 6d65 7468 6f64 2077 696c 6c20  the method will 
-0002a430: 7265 7475 726e 2061 6e6e 756c 6172 0a20  return annular. 
-0002a440: 2020 2020 2020 2020 2020 2073 7065 6374             spect
-0002a450: 7261 2077 6974 6820 616e 7920 7261 6469  ra with any radi
-0002a460: 692e 0a20 2020 2020 2020 203a 7061 7261  i..        :para
-0002a470: 6d20 626f 6f6c 2067 726f 7570 5f73 7065  m bool group_spe
-0002a480: 633a 2057 6173 2074 6865 2073 7065 6374  c: Was the spect
-0002a490: 7275 6d20 7365 7420 796f 7520 7769 7368  rum set you wish
-0002a4a0: 2074 6f20 7265 7472 6965 7665 2067 726f   to retrieve gro
-0002a4b0: 7570 6564 3f0a 2020 2020 2020 2020 3a70  uped?.        :p
-0002a4c0: 6172 616d 2066 6c6f 6174 206d 696e 5f63  aram float min_c
-0002a4d0: 6f75 6e74 733a 2049 6620 7468 6520 7370  ounts: If the sp
-0002a4e0: 6563 7472 756d 2073 6574 2079 6f75 2077  ectrum set you w
-0002a4f0: 6973 6820 746f 2072 6574 7269 6576 6520  ish to retrieve 
-0002a500: 7761 7320 6772 6f75 7065 6420 6f6e 206d  was grouped on m
-0002a510: 696e 696d 756d 2063 6f75 6e74 732c 2077  inimum counts, w
-0002a520: 6861 7420 7761 730a 2020 2020 2020 2020  hat was.        
-0002a530: 2020 2020 7468 6520 6d69 6e69 6d75 6d20      the minimum 
-0002a540: 6e75 6d62 6572 206f 6620 636f 756e 7473  number of counts
-0002a550: 3f0a 2020 2020 2020 2020 3a70 6172 616d  ?.        :param
-0002a560: 2066 6c6f 6174 206d 696e 5f73 6e3a 2049   float min_sn: I
-0002a570: 6620 7468 6520 7370 6563 7472 756d 2073  f the spectrum s
-0002a580: 6574 2079 6f75 2077 6973 6820 746f 2072  et you wish to r
-0002a590: 6574 7269 6576 6520 7761 7320 6772 6f75  etrieve was grou
-0002a5a0: 7065 6420 6f6e 206d 696e 696d 756d 2073  ped on minimum s
-0002a5b0: 6967 6e61 6c20 746f 0a20 2020 2020 2020  ignal to.       
-0002a5c0: 2020 2020 206e 6f69 7365 2c20 7768 6174       noise, what
-0002a5d0: 2077 6173 2074 6865 206d 696e 696d 756d   was the minimum
-0002a5e0: 2073 6967 6e61 6c20 746f 206e 6f69 7365   signal to noise
-0002a5f0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0002a600: 2066 6c6f 6174 206f 7665 725f 7361 6d70   float over_samp
-0002a610: 6c65 3a20 4966 2074 6865 2073 7065 6374  le: If the spect
-0002a620: 7275 6d20 7365 7420 796f 7520 7769 7368  rum set you wish
-0002a630: 2074 6f20 7265 7472 6965 7665 2077 6173   to retrieve was
-0002a640: 206f 7665 7220 7361 6d70 6c65 642c 2077   over sampled, w
-0002a650: 6861 7420 7761 7320 7468 6520 6c65 7665  hat was the leve
-0002a660: 6c20 6f66 0a20 2020 2020 2020 2020 2020  l of.           
-0002a670: 206f 7665 7220 7361 6d70 6c69 6e67 2075   over sampling u
-0002a680: 7365 643f 0a20 2020 2020 2020 203a 7061  sed?.        :pa
-0002a690: 7261 6d20 696e 7420 7365 745f 6964 3a20  ram int set_id: 
-0002a6a0: 5468 6520 756e 6971 7565 2069 6465 6e74  The unique ident
-0002a6b0: 6966 6965 7220 6f66 2074 6865 2061 6e6e  ifier of the ann
-0002a6c0: 756c 6172 2073 7065 6374 7275 6d20 7365  ular spectrum se
-0002a6d0: 742e 2050 6173 7369 6e67 2061 2076 616c  t. Passing a val
-0002a6e0: 7565 2066 6f72 2074 6869 7320 7061 7261  ue for this para
-0002a6f0: 6d65 7465 720a 2020 2020 2020 2020 2020  meter.          
-0002a700: 2020 7769 6c6c 206f 7665 7272 6964 6520    will override 
-0002a710: 616e 7920 6f74 6865 7220 696e 666f 726d  any other inform
-0002a720: 6174 696f 6e20 7468 6174 2079 6f75 2068  ation that you h
-0002a730: 6176 6520 6769 7665 6e20 7468 6973 206d  ave given this m
-0002a740: 6574 686f 642e 0a20 2020 2020 2020 203a  ethod..        :
-0002a750: 7265 7475 726e 3a20 416e 2058 4741 2041  return: An XGA A
-0002a760: 6e6e 756c 6172 5370 6563 7472 6120 6f62  nnularSpectra ob
-0002a770: 6a65 6374 2069 6620 7468 6572 6520 6973  ject if there is
-0002a780: 2061 6e20 6578 6163 7420 6d61 7463 682e   an exact match.
-0002a790: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0002a7a0: 2041 6e6e 756c 6172 5370 6563 7472 610a   AnnularSpectra.
-0002a7b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0002a7c0: 2020 2020 6966 2067 726f 7570 5f73 7065      if group_spe
-0002a7d0: 6320 616e 6420 6d69 6e5f 636f 756e 7473  c and min_counts
-0002a7e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0002a7f0: 2020 2020 2020 2020 2020 6578 7472 615f            extra_
-0002a800: 6e61 6d65 203d 2022 5f6d 696e 636e 747b  name = "_mincnt{
-0002a810: 7d22 2e66 6f72 6d61 7428 6d69 6e5f 636f  }".format(min_co
-0002a820: 756e 7473 290a 2020 2020 2020 2020 656c  unts).        el
-0002a830: 6966 2067 726f 7570 5f73 7065 6320 616e  if group_spec an
-0002a840: 6420 6d69 6e5f 736e 2069 7320 6e6f 7420  d min_sn is not 
-0002a850: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0002a860: 2020 6578 7472 615f 6e61 6d65 203d 2022    extra_name = "
-0002a870: 5f6d 696e 736e 7b7d 222e 666f 726d 6174  _minsn{}".format
-0002a880: 286d 696e 5f73 6e29 0a20 2020 2020 2020  (min_sn).       
-0002a890: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002a8a0: 2020 2065 7874 7261 5f6e 616d 6520 3d20     extra_name = 
-0002a8b0: 2727 0a0a 2020 2020 2020 2020 2320 416e  ''..        # An
-0002a8c0: 6420 6966 2069 7420 7761 7320 6f76 6572  d if it was over
-0002a8d0: 7361 6d70 6c65 6420 6475 7269 6e67 2067  sampled during g
-0002a8e0: 656e 6572 6174 696f 6e20 7468 656e 2077  eneration then w
-0002a8f0: 6520 6e65 6564 2074 6f20 696e 636c 7564  e need to includ
-0002a900: 6520 7468 6174 2061 7320 7765 6c6c 0a20  e that as well. 
-0002a910: 2020 2020 2020 2069 6620 6f76 6572 5f73         if over_s
-0002a920: 616d 706c 6520 6973 206e 6f74 204e 6f6e  ample is not Non
-0002a930: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
-0002a940: 7874 7261 5f6e 616d 6520 2b3d 2022 5f6f  xtra_name += "_o
-0002a950: 7673 616d 707b 6f76 7d22 2e66 6f72 6d61  vsamp{ov}".forma
-0002a960: 7428 6f76 3d6f 7665 725f 7361 6d70 6c65  t(ov=over_sample
-0002a970: 290a 0a20 2020 2020 2020 2023 2043 6f6d  )..        # Com
-0002a980: 6269 6e65 7320 7468 6520 616e 6e75 6c61  bines the annula
-0002a990: 7220 7261 6469 6920 696e 746f 2061 2073  r radii into a s
-0002a9a0: 7472 696e 672c 2061 6e64 206d 616b 6573  tring, and makes
-0002a9b0: 2073 7572 6520 7468 6520 7261 6469 6920   sure the radii 
-0002a9c0: 6172 6520 696e 2064 6567 7265 6573 2c20  are in degrees, 
-0002a9d0: 6173 2072 6164 6969 2061 7265 2069 6e0a  as radii are in.
-0002a9e0: 2020 2020 2020 2020 2320 2064 6567 7265          #  degre
-0002a9f0: 6573 2069 6e20 7468 6520 7374 6f72 6167  es in the storag
-0002aa00: 6520 6b65 790a 2020 2020 2020 2020 6966  e key.        if
-0002aa10: 2072 6164 6969 2069 7320 6e6f 7420 4e6f   radii is not No
-0002aa20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0002aa30: 2320 5765 2772 6520 6465 616c 696e 6720  # We're dealing 
-0002aa40: 7769 7468 2074 6865 2062 6573 7420 6361  with the best ca
-0002aa50: 7365 2068 6572 652c 2074 6865 2075 7365  se here, the use
-0002aa60: 7220 6861 7320 7061 7373 6564 2072 6164  r has passed rad
-0002aa70: 6969 2c20 736f 2077 6520 6361 6e20 6765  ii, so we can ge
-0002aa80: 6e65 7261 7465 2061 6e20 6578 6163 740a  nerate an exact.
-0002aa90: 2020 2020 2020 2020 2020 2020 2320 2073              #  s
-0002aaa0: 746f 7261 6765 206b 6579 2061 6e64 206c  torage key and l
-0002aab0: 6f6f 6b20 666f 7220 6120 7369 6e67 6c65  ook for a single
-0002aac0: 206d 6174 6368 0a20 2020 2020 2020 2020   match.         
-0002aad0: 2020 2061 6e6e 5f72 6164 5f73 7472 203d     ann_rad_str =
-0002aae0: 2022 5f22 2e6a 6f69 6e28 7365 6c66 2e63   "_".join(self.c
-0002aaf0: 6f6e 7665 7274 5f72 6164 6975 7328 7261  onvert_radius(ra
-0002ab00: 6469 692c 2027 6465 6727 292e 7661 6c75  dii, 'deg').valu
-0002ab10: 652e 6173 7479 7065 2873 7472 2929 0a20  e.astype(str)). 
-0002ab20: 2020 2020 2020 2020 2020 2073 7065 635f             spec_
-0002ab30: 7374 6f72 6167 655f 6e61 6d65 203d 2022  storage_name = "
-0002ab40: 7261 7b72 617d 5f64 6563 7b64 6563 7d5f  ra{ra}_dec{dec}_
-0002ab50: 6172 7b61 727d 5f67 7270 7b67 727d 220a  ar{ar}_grp{gr}".
-0002ab60: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-0002ab70: 5f73 746f 7261 6765 5f6e 616d 6520 3d20  _storage_name = 
-0002ab80: 7370 6563 5f73 746f 7261 6765 5f6e 616d  spec_storage_nam
-0002ab90: 652e 666f 726d 6174 2872 613d 7365 6c66  e.format(ra=self
-0002aba0: 2e64 6566 6175 6c74 5f63 6f6f 7264 5b30  .default_coord[0
-0002abb0: 5d2e 7661 6c75 652c 0a20 2020 2020 2020  ].value,.       
-0002abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002abf0: 2020 6465 633d 7365 6c66 2e64 6566 6175    dec=self.defau
-0002ac00: 6c74 5f63 6f6f 7264 5b31 5d2e 7661 6c75  lt_coord[1].valu
-0002ac10: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0002ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ac40: 2020 2020 2020 2020 2020 2020 6172 3d61              ar=a
-0002ac50: 6e6e 5f72 6164 5f73 7472 2c20 6772 3d67  nn_rad_str, gr=g
-0002ac60: 726f 7570 5f73 7065 6329 0a20 2020 2020  roup_spec).     
-0002ac70: 2020 2020 2020 2073 7065 635f 7374 6f72         spec_stor
-0002ac80: 6167 655f 6e61 6d65 202b 3d20 6578 7472  age_name += extr
-0002ac90: 615f 6e61 6d65 0a20 2020 2020 2020 2065  a_name.        e
-0002aca0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002acb0: 2023 2054 6869 7320 6973 2061 2077 6f72   # This is a wor
-0002acc0: 7365 2063 6173 652c 2077 6520 646f 6e27  se case, we don'
-0002acd0: 7420 6861 7665 2072 6164 6969 2c20 736f  t have radii, so
-0002ace0: 2077 6520 7370 6c69 7420 7468 6520 6b6e   we split the kn
-0002acf0: 6f77 6e20 7061 7274 7320 6f66 2074 6865  own parts of the
-0002ad00: 206b 6579 2069 6e74 6f20 6120 6c69 7374   key into a list
-0002ad10: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-0002ad20: 616e 6420 7765 276c 6c20 6c6f 6f6b 2066  and we'll look f
-0002ad30: 6f72 2070 6172 7469 616c 206d 6174 6368  or partial match
-0002ad40: 6573 0a20 2020 2020 2020 2020 2020 2070  es.            p
-0002ad50: 6f73 5f73 7472 203d 2022 7261 7b72 617d  os_str = "ra{ra}
-0002ad60: 5f64 6563 7b64 6563 7d22 2e66 6f72 6d61  _dec{dec}".forma
-0002ad70: 7428 7261 3d73 656c 662e 6465 6661 756c  t(ra=self.defaul
-0002ad80: 745f 636f 6f72 645b 305d 2e76 616c 7565  t_coord[0].value
-0002ad90: 2c20 6465 633d 7365 6c66 2e64 6566 6175  , dec=self.defau
-0002ada0: 6c74 5f63 6f6f 7264 5b31 5d2e 7661 6c75  lt_coord[1].valu
-0002adb0: 6529 0a20 2020 2020 2020 2020 2020 2067  e).            g
-0002adc0: 7270 5f73 7472 203d 2022 6772 707b 6772  rp_str = "grp{gr
-0002add0: 7d22 2e66 6f72 6d61 7428 6772 3d67 726f  }".format(gr=gro
-0002ade0: 7570 5f73 7065 6329 202b 2065 7874 7261  up_spec) + extra
-0002adf0: 5f6e 616d 650a 2020 2020 2020 2020 2020  _name.          
-0002ae00: 2020 7370 6563 5f73 746f 7261 6765 5f6e    spec_storage_n
-0002ae10: 616d 6520 3d20 5b70 6f73 5f73 7472 2c20  ame = [pos_str, 
-0002ae20: 6772 705f 7374 725d 0a0a 2020 2020 2020  grp_str]..      
-0002ae30: 2020 2320 4966 2074 6865 2075 7365 7220    # If the user 
-0002ae40: 6861 736e 2774 2070 6173 7365 6420 6120  hasn't passed a 
-0002ae50: 7365 7420 4944 2041 4e44 2074 6865 2075  set ID AND the u
-0002ae60: 7365 7220 6861 7320 7061 7373 6564 2072  ser has passed r
-0002ae70: 6164 6969 2074 6865 6e20 7765 276c 6c20  adii then we'll 
-0002ae80: 676f 206c 6f6f 6b69 6e67 2077 6974 6820  go looking with 
-0002ae90: 6f75 740a 2020 2020 2020 2020 2320 2070  out.        #  p
-0002aea0: 726f 7065 726c 7920 636f 6e73 7472 7563  roperly construc
-0002aeb0: 7465 6420 7374 6f72 6167 6520 6b65 790a  ted storage key.
-0002aec0: 2020 2020 2020 2020 6966 2073 6574 5f69          if set_i
-0002aed0: 6420 6973 204e 6f6e 6520 616e 6420 7261  d is None and ra
-0002aee0: 6469 6920 6973 206e 6f74 204e 6f6e 653a  dii is not None:
-0002aef0: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
-0002af00: 6368 6564 5f70 726f 6473 203d 2073 656c  ched_prods = sel
-0002af10: 662e 6765 745f 7072 6f64 7563 7473 2827  f.get_products('
-0002af20: 636f 6d62 696e 6564 5f73 7065 6374 7275  combined_spectru
-0002af30: 6d27 2c20 6578 7472 615f 6b65 793d 7370  m', extra_key=sp
-0002af40: 6563 5f73 746f 7261 6765 5f6e 616d 6529  ec_storage_name)
-0002af50: 0a20 2020 2020 2020 2023 2042 7574 2069  .        # But i
-0002af60: 6620 7468 6520 7573 6572 2068 6173 6e27  f the user hasn'
-0002af70: 7420 7061 7373 6564 2061 6e20 4944 2041  t passed an ID A
-0002af80: 4e44 2074 6865 2072 6164 6969 2061 7265  ND the radii are
-0002af90: 204e 6f6e 6520 7468 656e 2077 6520 6c6f   None then we lo
-0002afa0: 6f6b 2066 6f72 2070 6172 7469 616c 206d  ok for partial m
-0002afb0: 6174 6368 6573 0a20 2020 2020 2020 2065  atches.        e
-0002afc0: 6c69 6620 7365 745f 6964 2069 7320 4e6f  lif set_id is No
-0002afd0: 6e65 2061 6e64 2072 6164 6969 2069 7320  ne and radii is 
-0002afe0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0002aff0: 2020 6d61 7463 6865 645f 7072 6f64 7320    matched_prods 
-0002b000: 3d20 5b70 2066 6f72 2070 2069 6e20 7365  = [p for p in se
-0002b010: 6c66 2e67 6574 5f70 726f 6475 6374 7328  lf.get_products(
-0002b020: 2763 6f6d 6269 6e65 645f 7370 6563 7472  'combined_spectr
-0002b030: 756d 2729 0a20 2020 2020 2020 2020 2020  um').           
-0002b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b050: 2020 6966 2073 7065 635f 7374 6f72 6167    if spec_storag
-0002b060: 655f 6e61 6d65 5b30 5d20 696e 2070 2e73  e_name[0] in p.s
-0002b070: 746f 7261 6765 5f6b 6579 2061 6e64 2073  torage_key and s
-0002b080: 7065 635f 7374 6f72 6167 655f 6e61 6d65  pec_storage_name
-0002b090: 5b31 5d20 696e 2070 2e73 746f 7261 6765  [1] in p.storage
-0002b0a0: 5f6b 6579 5d0a 2020 2020 2020 2020 2320  _key].        # 
-0002b0b0: 486f 7765 7665 7220 6966 2074 6865 7920  However if they 
-0002b0c0: 6861 7665 2070 6173 7365 6420 6120 7365  have passed a se
-0002b0d0: 7449 4420 7468 656e 2074 6869 7320 6f76  tID then this ov
-0002b0e0: 6572 2d72 6964 6573 2065 7665 7279 7468  er-rides everyth
-0002b0f0: 696e 6720 656c 7365 0a20 2020 2020 2020  ing else.       
-0002b100: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002b110: 2020 2023 2057 6974 6820 7468 6520 7365     # With the se
-0002b120: 7420 4944 2077 6520 6665 7463 6820 414c  t ID we fetch AL
-0002b130: 4c20 616e 6e75 6c61 7220 7370 6563 7472  L annular spectr
-0002b140: 612c 2074 6865 6e20 7573 6520 7468 6569  a, then use thei
-0002b150: 7220 7365 745f 6964 2070 726f 7065 7274  r set_id propert
-0002b160: 7920 746f 206d 6174 6368 2061 6761 696e  y to match again
-0002b170: 7374 0a20 2020 2020 2020 2020 2020 2023  st.            #
-0002b180: 2020 7768 6174 6576 6572 2074 6865 2075    whatever the u
-0002b190: 7365 7220 7061 7373 6564 2069 6e0a 2020  ser passed in.  
-0002b1a0: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
-0002b1b0: 645f 7072 6f64 7320 3d20 5b70 2066 6f72  d_prods = [p for
-0002b1c0: 2070 2069 6e20 7365 6c66 2e67 6574 5f70   p in self.get_p
-0002b1d0: 726f 6475 6374 7328 2763 6f6d 6269 6e65  roducts('combine
-0002b1e0: 645f 7370 6563 7472 756d 2729 2069 6620  d_spectrum') if 
-0002b1f0: 702e 7365 745f 6964 656e 7420 3d3d 2073  p.set_ident == s
-0002b200: 6574 5f69 645d 0a0a 2020 2020 2020 2020  et_id]..        
-0002b210: 6966 206c 656e 286d 6174 6368 6564 5f70  if len(matched_p
-0002b220: 726f 6473 2920 3d3d 2031 3a0a 2020 2020  rods) == 1:.    
-0002b230: 2020 2020 2020 2020 6d61 7463 6865 645f          matched_
-0002b240: 7072 6f64 7320 3d20 6d61 7463 6865 645f  prods = matched_
-0002b250: 7072 6f64 735b 305d 0a20 2020 2020 2020  prods[0].       
-0002b260: 2065 6c69 6620 6c65 6e28 6d61 7463 6865   elif len(matche
-0002b270: 645f 7072 6f64 7329 203d 3d20 303a 0a20  d_prods) == 0:. 
-0002b280: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0002b290: 204e 6f50 726f 6475 6374 4176 6169 6c61   NoProductAvaila
-0002b2a0: 626c 6545 7272 6f72 2822 4e6f 206d 6174  bleError("No mat
-0002b2b0: 6368 696e 6720 416e 6e75 6c61 7253 7065  ching AnnularSpe
-0002b2c0: 6374 7261 2063 616e 2062 6520 666f 756e  ctra can be foun
-0002b2d0: 642e 2229 0a0a 2020 2020 2020 2020 7265  d.")..        re
-0002b2e0: 7475 726e 206d 6174 6368 6564 5f70 726f  turn matched_pro
-0002b2f0: 6473 0a0a 2020 2020 6465 6620 5f67 6574  ds..    def _get
-0002b300: 5f70 686f 745f 7072 6f64 2873 656c 662c  _phot_prod(self,
-0002b310: 2070 726f 645f 7479 7065 3a20 7374 722c   prod_type: str,
-0002b320: 206f 6273 5f69 643a 2073 7472 203d 204e   obs_id: str = N
-0002b330: 6f6e 652c 2069 6e73 743a 2073 7472 203d  one, inst: str =
-0002b340: 204e 6f6e 652c 206c 6f5f 656e 3a20 5175   None, lo_en: Qu
-0002b350: 616e 7469 7479 203d 204e 6f6e 652c 0a20  antity = None,. 
-0002b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b370: 2020 2020 2020 6869 5f65 6e3a 2051 7561        hi_en: Qua
-0002b380: 6e74 6974 7920 3d20 4e6f 6e65 2c20 7073  ntity = None, ps
-0002b390: 665f 636f 7272 3a20 626f 6f6c 203d 2046  f_corr: bool = F
-0002b3a0: 616c 7365 2c20 7073 665f 6d6f 6465 6c3a  alse, psf_model:
-0002b3b0: 2073 7472 203d 2022 454c 4c42 4554 4122   str = "ELLBETA"
-0002b3c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002b3d0: 2020 2020 2020 2020 2070 7366 5f62 696e           psf_bin
-0002b3e0: 733a 2069 6e74 203d 2034 2c20 7073 665f  s: int = 4, psf_
-0002b3f0: 616c 676f 3a20 7374 7220 3d20 2272 6c22  algo: str = "rl"
-0002b400: 2c20 7073 665f 6974 6572 3a20 696e 7420  , psf_iter: int 
-0002b410: 3d20 3135 2920 5c0a 2020 2020 2020 2020  = 15) \.        
-0002b420: 2020 2020 2d3e 2055 6e69 6f6e 5b49 6d61      -> Union[Ima
-0002b430: 6765 2c20 4578 704d 6170 2c20 5261 7465  ge, ExpMap, Rate
-0002b440: 4d61 702c 204c 6973 745b 496d 6167 655d  Map, List[Image]
-0002b450: 2c20 4c69 7374 5b45 7870 4d61 705d 2c20  , List[ExpMap], 
-0002b460: 4c69 7374 5b52 6174 654d 6170 5d5d 3a0a  List[RateMap]]:.
-0002b470: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0002b480: 2020 2020 416e 2069 6e74 6572 6e61 6c20      An internal 
-0002b490: 6d65 7468 6f64 2077 6869 6368 2069 7320  method which is 
-0002b4a0: 7468 6520 6261 7369 7320 6f66 2074 6865  the basis of the
-0002b4b0: 2067 6574 5f69 6d61 6765 732c 2067 6574   get_images, get
-0002b4c0: 5f65 7870 6d61 7073 2c20 616e 6420 6765  _expmaps, and ge
-0002b4d0: 745f 7261 7465 6d61 7073 206d 6574 686f  t_ratemaps metho
-0002b4e0: 6473 2e0a 0a20 2020 2020 2020 203a 7061  ds...        :pa
-0002b4f0: 7261 6d20 7374 7220 6f62 735f 6964 3a20  ram str obs_id: 
-0002b500: 4f70 7469 6f6e 616c 6c79 2c20 6120 7370  Optionally, a sp
-0002b510: 6563 6966 6963 206f 6273 5f69 6420 746f  ecific obs_id to
-0002b520: 2073 6561 7263 6820 666f 7220 6361 6e20   search for can 
-0002b530: 6265 2073 7570 706c 6965 642e 2054 6865  be supplied. The
-0002b540: 2064 6566 6175 6c74 2069 7320 4e6f 6e65   default is None
-0002b550: 2c0a 2020 2020 2020 2020 2020 2020 7768  ,.            wh
-0002b560: 6963 6820 6d65 616e 7320 616c 6c20 696d  ich means all im
-0002b570: 6167 6573 2f65 7870 6d61 7073 2f72 6174  ages/expmaps/rat
-0002b580: 656d 6170 7320 6d61 7463 6869 6e67 2074  emaps matching t
-0002b590: 6865 206f 7468 6572 2063 7269 7465 7269  he other criteri
-0002b5a0: 6120 7769 6c6c 2062 6520 7265 7475 726e  a will be return
-0002b5b0: 6564 2e0a 2020 2020 2020 2020 3a70 6172  ed..        :par
-0002b5c0: 616d 2073 7472 2069 6e73 743a 204f 7074  am str inst: Opt
-0002b5d0: 696f 6e61 6c6c 792c 2061 2073 7065 6369  ionally, a speci
-0002b5e0: 6669 6320 696e 7374 7275 6d65 6e74 2074  fic instrument t
-0002b5f0: 6f20 7365 6172 6368 2066 6f72 2063 616e  o search for can
-0002b600: 2062 6520 7375 7070 6c69 6564 2e20 5468   be supplied. Th
-0002b610: 6520 6465 6661 756c 7420 6973 204e 6f6e  e default is Non
-0002b620: 652c 0a20 2020 2020 2020 2020 2020 2077  e,.            w
-0002b630: 6869 6368 206d 6561 6e73 2061 6c6c 2069  hich means all i
-0002b640: 6d61 6765 732f 6578 706d 6170 732f 7261  mages/expmaps/ra
-0002b650: 7465 6d61 7073 206d 6174 6368 696e 6720  temaps matching 
-0002b660: 7468 6520 6f74 6865 7220 6372 6974 6572  the other criter
-0002b670: 6961 2077 696c 6c20 6265 2072 6574 7572  ia will be retur
-0002b680: 6e65 642e 0a20 2020 2020 2020 203a 7061  ned..        :pa
-0002b690: 7261 6d20 5175 616e 7469 7479 206c 6f5f  ram Quantity lo_
-0002b6a0: 656e 3a20 5468 6520 6c6f 7765 7220 656e  en: The lower en
-0002b6b0: 6572 6779 206c 696d 6974 206f 6620 7468  ergy limit of th
-0002b6c0: 6520 696d 6167 6573 2f65 7870 6d61 7073  e images/expmaps
-0002b6d0: 2f72 6174 656d 6170 7320 796f 7520 7769  /ratemaps you wi
-0002b6e0: 7368 2074 6f0a 2020 2020 2020 2020 2020  sh to.          
-0002b6f0: 2020 7265 7472 6965 7665 2c20 7468 6520    retrieve, the 
-0002b700: 6465 6661 756c 7420 6973 204e 6f6e 6520  default is None 
-0002b710: 2877 6869 6368 2077 696c 6c20 7265 7472  (which will retr
-0002b720: 6965 7665 2061 6c6c 2069 6d61 6765 732f  ieve all images/
-0002b730: 6578 706d 6170 732f 7261 7465 6d61 7073  expmaps/ratemaps
-0002b740: 2072 6567 6172 646c 6573 7320 6f66 0a20   regardless of. 
-0002b750: 2020 2020 2020 2020 2020 2065 6e65 7267             energ
-0002b760: 7920 6c69 6d69 7429 2e0a 2020 2020 2020  y limit)..      
-0002b770: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
-0002b780: 7920 6869 5f65 6e3a 2054 6865 2075 7070  y hi_en: The upp
-0002b790: 6572 2065 6e65 7267 7920 6c69 6d69 7420  er energy limit 
-0002b7a0: 6f66 2074 6865 2069 6d61 6765 732f 6578  of the images/ex
-0002b7b0: 706d 6170 732f 7261 7465 6d61 7073 2079  pmaps/ratemaps y
-0002b7c0: 6f75 2077 6973 6820 746f 0a20 2020 2020  ou wish to.     
-0002b7d0: 2020 2020 2020 2072 6574 7269 6576 652c         retrieve,
-0002b7e0: 2074 6865 2064 6566 6175 6c74 2069 7320   the default is 
-0002b7f0: 4e6f 6e65 2028 7768 6963 6820 7769 6c6c  None (which will
-0002b800: 2072 6574 7269 6576 6520 616c 6c20 696d   retrieve all im
-0002b810: 6167 6573 2f65 7870 6d61 7073 2f72 6174  ages/expmaps/rat
-0002b820: 656d 6170 7320 7265 6761 7264 6c65 7373  emaps regardless
-0002b830: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
-0002b840: 656e 6572 6779 206c 696d 6974 292e 0a20  energy limit).. 
-0002b850: 2020 2020 2020 203a 7061 7261 6d20 626f         :param bo
-0002b860: 6f6c 2070 7366 5f63 6f72 723a 2053 6574  ol psf_corr: Set
-0002b870: 7320 7768 6574 6865 7220 796f 7520 7769  s whether you wi
-0002b880: 7368 2074 6f20 7265 7472 6965 7665 2061  sh to retrieve a
-0002b890: 2050 5346 2063 6f72 7265 6374 6564 2069   PSF corrected i
-0002b8a0: 6d61 6765 732f 7261 7465 6d61 7073 206f  mages/ratemaps o
-0002b8b0: 7220 6e6f 742e 0a20 2020 2020 2020 203a  r not..        :
-0002b8c0: 7061 7261 6d20 7374 7220 7073 665f 6d6f  param str psf_mo
-0002b8d0: 6465 6c3a 2049 6620 7468 6520 696d 6167  del: If the imag
-0002b8e0: 6573 2f72 6174 656d 6170 7320 796f 7520  es/ratemaps you 
-0002b8f0: 7761 6e74 2061 7265 2050 5346 2063 6f72  want are PSF cor
-0002b900: 7265 6374 6564 2c20 7468 6973 2069 7320  rected, this is 
-0002b910: 7468 6520 5053 4620 6d6f 6465 6c20 7573  the PSF model us
-0002b920: 6564 2e0a 2020 2020 2020 2020 3a70 6172  ed..        :par
-0002b930: 616d 2069 6e74 2070 7366 5f62 696e 733a  am int psf_bins:
-0002b940: 2049 6620 7468 6520 696d 6167 6573 2f72   If the images/r
-0002b950: 6174 656d 6170 7320 796f 7520 7761 6e74  atemaps you want
-0002b960: 2061 7265 2050 5346 2063 6f72 7265 6374   are PSF correct
-0002b970: 6564 2c20 7468 6973 2069 7320 7468 6520  ed, this is the 
-0002b980: 6e75 6d62 6572 206f 6620 5053 4673 2070  number of PSFs p
-0002b990: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
-0002b9a0: 6964 6520 696e 2074 6865 2050 5346 2067  ide in the PSF g
-0002b9b0: 7269 642e 0a20 2020 2020 2020 203a 7061  rid..        :pa
-0002b9c0: 7261 6d20 7374 7220 7073 665f 616c 676f  ram str psf_algo
-0002b9d0: 3a20 4966 2074 6865 2069 6d61 6765 732f  : If the images/
-0002b9e0: 7261 7465 6d61 7073 2079 6f75 2077 616e  ratemaps you wan
-0002b9f0: 7420 6172 6520 5053 4620 636f 7272 6563  t are PSF correc
-0002ba00: 7465 642c 2074 6869 7320 6973 2074 6865  ted, this is the
-0002ba10: 2061 6c67 6f72 6974 686d 2075 7365 642e   algorithm used.
+00028b60: 2020 2069 6620 6675 6c6c 5f61 7265 615b     if full_area[
+00028b70: 6f5d 2021 3d20 303a 0a20 2020 2020 2020  o] != 0:.       
+00028b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028b90: 2066 7261 6320 3d20 2861 7265 615b 6f5d   frac = (area[o]
+00028ba0: 5b69 5d20 2f20 6675 6c6c 5f61 7265 615b  [i] / full_area[
+00028bb0: 6f5d 290a 2020 2020 2020 2020 2020 2020  o]).            
+00028bc0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00028bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028be0: 2020 2020 2020 6672 6163 203d 2030 0a20        frac = 0. 
+00028bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c00: 2020 2069 6620 6672 6163 203c 3d20 7468     if frac <= th
+00028c10: 7265 7368 6f6c 645f 6672 6163 7469 6f6e  reshold_fraction
+00028c20: 2061 6e64 206f 206e 6f74 2069 6e20 7265   and o not in re
+00028c30: 6a65 6374 5f64 6963 743a 0a20 2020 2020  ject_dict:.     
+00028c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c50: 2020 2072 656a 6563 745f 6469 6374 5b6f     reject_dict[o
+00028c60: 5d20 3d20 5b69 5d0a 2020 2020 2020 2020  ] = [i].        
+00028c70: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00028c80: 2066 7261 6320 3c3d 2074 6872 6573 686f   frac <= thresho
+00028c90: 6c64 5f66 7261 6374 696f 6e20 616e 6420  ld_fraction and 
+00028ca0: 6f20 696e 2072 656a 6563 745f 6469 6374  o in reject_dict
+00028cb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00028cc0: 2020 2020 2020 2020 2020 7265 6a65 6374            reject
+00028cd0: 5f64 6963 745b 6f5d 2e61 7070 656e 6428  _dict[o].append(
+00028ce0: 6929 0a0a 2020 2020 2020 2020 7265 7475  i)..        retu
+00028cf0: 726e 2072 656a 6563 745f 6469 6374 0a0a  rn reject_dict..
+00028d00: 2020 2020 2320 416e 6420 6865 7265 2049      # And here I
+00028d10: 276d 2061 6464 696e 6720 6120 6275 6e63  'm adding a bunc
+00028d20: 6820 6f66 2067 6574 206d 6574 686f 6473  h of get methods
+00028d30: 2074 6861 7420 7368 6f75 6c64 206d 6561   that should mea
+00028d40: 6e20 7468 6520 7573 6572 206e 6576 6572  n the user never
+00028d50: 2068 6173 2074 6f20 7573 6520 6765 745f   has to use get_
+00028d60: 7072 6f64 7563 7473 2c20 666f 720a 2020  products, for.  
+00028d70: 2020 2320 2069 6e64 6976 6964 7561 6c20    #  individual 
+00028d80: 7072 6f64 7563 7420 7479 7065 732e 2049  product types. I
+00028d90: 7420 7769 6c6c 2061 6c73 6f20 6d65 616e  t will also mean
+00028da0: 2074 6861 7420 7468 6579 2077 696c 6c20   that they will 
+00028db0: 6e65 7665 7220 6861 7665 2074 6f20 6669  never have to fi
+00028dc0: 6775 7265 206f 7574 2065 7874 7261 206b  gure out extra k
+00028dd0: 6579 7320 7468 656d 7365 6c76 6573 0a20  eys themselves. 
+00028de0: 2020 2023 2020 616e 6420 4920 6361 6e20     #  and I can 
+00028df0: 6d61 6b65 206c 6973 7473 206f 6620 3120  make lists of 1 
+00028e00: 7072 6f64 7563 7420 7265 7475 726e 206a  product return j
+00028e10: 7573 7420 6173 2074 6865 2070 726f 6475  ust as the produ
+00028e20: 6374 2077 6974 686f 7574 2062 6569 6e67  ct without being
+00028e30: 2061 2062 7265 616b 696e 6720 6368 616e   a breaking chan
+00028e40: 6765 0a20 2020 2064 6566 2067 6574 5f73  ge.    def get_s
+00028e50: 7065 6374 7261 2873 656c 662c 206f 7574  pectra(self, out
+00028e60: 6572 5f72 6164 6975 733a 2055 6e69 6f6e  er_radius: Union
+00028e70: 5b73 7472 2c20 5175 616e 7469 7479 5d2c  [str, Quantity],
+00028e80: 206f 6273 5f69 643a 2073 7472 203d 204e   obs_id: str = N
+00028e90: 6f6e 652c 2069 6e73 743a 2073 7472 203d  one, inst: str =
+00028ea0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00028eb0: 2020 2020 2020 2020 2020 2069 6e6e 6572             inner
+00028ec0: 5f72 6164 6975 733a 2055 6e69 6f6e 5b73  _radius: Union[s
+00028ed0: 7472 2c20 5175 616e 7469 7479 5d20 3d20  tr, Quantity] = 
+00028ee0: 5175 616e 7469 7479 2830 2c20 2761 7263  Quantity(0, 'arc
+00028ef0: 7365 6327 292c 2067 726f 7570 5f73 7065  sec'), group_spe
+00028f00: 633a 2062 6f6f 6c20 3d20 5472 7565 2c0a  c: bool = True,.
+00028f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f20: 2020 2020 6d69 6e5f 636f 756e 7473 3a20      min_counts: 
+00028f30: 696e 7420 3d20 352c 206d 696e 5f73 6e3a  int = 5, min_sn:
+00028f40: 2066 6c6f 6174 203d 204e 6f6e 652c 0a20   float = None,. 
+00028f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f60: 2020 206f 7665 725f 7361 6d70 6c65 3a20     over_sample: 
+00028f70: 666c 6f61 7420 3d20 4e6f 6e65 2920 2d3e  float = None) ->
+00028f80: 2055 6e69 6f6e 5b53 7065 6374 7275 6d2c   Union[Spectrum,
+00028f90: 204c 6973 745b 5370 6563 7472 756d 5d5d   List[Spectrum]]
+00028fa0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00028fb0: 2020 2020 2020 4120 7573 6566 756c 206d        A useful m
+00028fc0: 6574 686f 6420 7468 6174 2077 7261 7073  ethod that wraps
+00028fd0: 2074 6865 2067 6574 5f70 726f 6475 6374   the get_product
+00028fe0: 7320 6675 6e63 7469 6f6e 2074 6f20 616c  s function to al
+00028ff0: 6c6f 7720 796f 7520 746f 2065 6173 696c  low you to easil
+00029000: 7920 7265 7472 6965 7665 2058 4741 2053  y retrieve XGA S
+00029010: 7065 6374 7275 6d20 6f62 6a65 6374 732e  pectrum objects.
+00029020: 0a20 2020 2020 2020 2053 696d 706c 7920  .        Simply 
+00029030: 7061 7373 2074 6865 2064 6573 6972 6564  pass the desired
+00029040: 204f 6273 4944 2f69 6e73 7472 756d 656e   ObsID/instrumen
+00029050: 742c 2061 6e64 2074 6865 2073 616d 6520  t, and the same 
+00029060: 7365 7474 696e 6773 2079 6f75 2075 7365  settings you use
+00029070: 6420 746f 2067 656e 6572 6174 6520 7468  d to generate th
+00029080: 6520 7370 6563 7472 756d 0a20 2020 2020  e spectrum.     
+00029090: 2020 2069 6e20 6576 7365 6c65 6374 5f73     in evselect_s
+000290a0: 7065 6374 7275 6d2c 2061 6e64 2074 6865  pectrum, and the
+000290b0: 2073 7065 6374 7261 2875 6d29 2077 696c   spectra(um) wil
+000290c0: 6c20 6265 2070 726f 7669 6465 6420 746f  l be provided to
+000290d0: 2079 6f75 2e20 4966 206e 6f20 6d61 7463   you. If no matc
+000290e0: 6820 6973 2066 6f75 6e64 2074 6865 6e20  h is found then 
+000290f0: 610a 2020 2020 2020 2020 4e6f 5072 6f64  a.        NoProd
+00029100: 7563 7441 7661 696c 6162 6c65 4572 726f  uctAvailableErro
+00029110: 7220 7769 6c6c 2062 6520 7261 6973 6564  r will be raised
+00029120: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+00029130: 6d20 7374 722f 5175 616e 7469 7479 206f  m str/Quantity o
+00029140: 7574 6572 5f72 6164 6975 733a 2054 6865  uter_radius: The
+00029150: 206e 616d 6520 6f72 2076 616c 7565 206f   name or value o
+00029160: 6620 7468 6520 6f75 7465 7220 7261 6469  f the outer radi
+00029170: 7573 2074 6861 7420 7761 7320 7573 6564  us that was used
+00029180: 2066 6f72 2074 6865 2067 656e 6572 6174   for the generat
+00029190: 696f 6e20 6f66 0a20 2020 2020 2020 2020  ion of.         
+000291a0: 2020 2074 6865 2073 7065 6374 7275 6d20     the spectrum 
+000291b0: 2866 6f72 2069 6e73 7461 6e63 6520 2772  (for instance 'r
+000291c0: 3230 3027 2077 6f75 6c64 2062 6520 6163  200' would be ac
+000291d0: 6365 7074 6162 6c65 2066 6f72 2061 2047  ceptable for a G
+000291e0: 616c 6178 7943 6c75 7374 6572 2c20 6f72  alaxyCluster, or
+000291f0: 2051 7561 6e74 6974 7928 3130 3030 2c20   Quantity(1000, 
+00029200: 276b 7063 2729 292e 2049 660a 2020 2020  'kpc')). If.    
+00029210: 2020 2020 2020 2020 2772 6567 696f 6e27          'region'
+00029220: 2069 7320 6368 6f73 656e 2028 746f 2075   is chosen (to u
+00029230: 7365 2074 6865 2072 6567 696f 6e73 2069  se the regions i
+00029240: 6e20 7265 6769 6f6e 2066 696c 6573 292c  n region files),
+00029250: 2074 6865 6e20 616e 7920 696e 6e65 7220   then any inner 
+00029260: 7261 6469 7573 2077 696c 6c20 6265 2069  radius will be i
+00029270: 676e 6f72 6564 2e0a 2020 2020 2020 2020  gnored..        
+00029280: 3a70 6172 616d 2073 7472 206f 6273 5f69  :param str obs_i
+00029290: 643a 204f 7074 696f 6e61 6c6c 792c 2061  d: Optionally, a
+000292a0: 2073 7065 6369 6669 6320 6f62 735f 6964   specific obs_id
+000292b0: 2074 6f20 7365 6172 6368 2066 6f72 2063   to search for c
+000292c0: 616e 2062 6520 7375 7070 6c69 6564 2e20  an be supplied. 
+000292d0: 5468 6520 6465 6661 756c 7420 6973 204e  The default is N
+000292e0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+000292f0: 2077 6869 6368 206d 6561 6e73 2061 6c6c   which means all
+00029300: 2073 7065 6374 7261 206d 6174 6368 696e   spectra matchin
+00029310: 6720 7468 6520 6f74 6865 7220 6372 6974  g the other crit
+00029320: 6572 6961 2077 696c 6c20 6265 2072 6574  eria will be ret
+00029330: 7572 6e65 642e 0a20 2020 2020 2020 203a  urned..        :
+00029340: 7061 7261 6d20 7374 7220 696e 7374 3a20  param str inst: 
+00029350: 4f70 7469 6f6e 616c 6c79 2c20 6120 7370  Optionally, a sp
+00029360: 6563 6966 6963 2069 6e73 7472 756d 656e  ecific instrumen
+00029370: 7420 746f 2073 6561 7263 6820 666f 7220  t to search for 
+00029380: 6361 6e20 6265 2073 7570 706c 6965 642e  can be supplied.
+00029390: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
+000293a0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+000293b0: 2020 7768 6963 6820 6d65 616e 7320 616c    which means al
+000293c0: 6c20 7370 6563 7472 6120 6d61 7463 6869  l spectra matchi
+000293d0: 6e67 2074 6865 206f 7468 6572 2063 7269  ng the other cri
+000293e0: 7465 7269 6120 7769 6c6c 2062 6520 7265  teria will be re
+000293f0: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
+00029400: 3a70 6172 616d 2073 7472 2f51 7561 6e74  :param str/Quant
+00029410: 6974 7920 696e 6e65 725f 7261 6469 7573  ity inner_radius
+00029420: 3a20 5468 6520 6e61 6d65 206f 7220 7661  : The name or va
+00029430: 6c75 6520 6f66 2074 6865 2069 6e6e 6572  lue of the inner
+00029440: 2072 6164 6975 7320 7468 6174 2077 6173   radius that was
+00029450: 2075 7365 6420 666f 7220 7468 6520 6765   used for the ge
+00029460: 6e65 7261 7469 6f6e 206f 660a 2020 2020  neration of.    
+00029470: 2020 2020 2020 2020 7468 6520 7370 6563          the spec
+00029480: 7472 756d 2028 666f 7220 696e 7374 616e  trum (for instan
+00029490: 6365 2027 7235 3030 2720 776f 756c 6420  ce 'r500' would 
+000294a0: 6265 2061 6363 6570 7461 626c 6520 666f  be acceptable fo
+000294b0: 7220 6120 4761 6c61 7879 436c 7573 7465  r a GalaxyCluste
+000294c0: 722c 206f 7220 5175 616e 7469 7479 2833  r, or Quantity(3
+000294d0: 3030 2c20 276b 7063 2729 292e 2042 790a  00, 'kpc')). By.
+000294e0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+000294f0: 756c 7420 7468 6973 2069 7320 7a65 726f  ult this is zero
+00029500: 2061 7263 7365 636f 6e64 732c 2072 6573   arcseconds, res
+00029510: 756c 7469 6e67 2069 6e20 6120 6369 7263  ulting in a circ
+00029520: 756c 6172 2073 7065 6374 7275 6d2e 0a20  ular spectrum.. 
+00029530: 2020 2020 2020 203a 7061 7261 6d20 626f         :param bo
+00029540: 6f6c 2067 726f 7570 5f73 7065 633a 2057  ol group_spec: W
+00029550: 6173 2074 6865 2073 7065 6374 7275 6d20  as the spectrum 
+00029560: 796f 7520 7769 7368 2074 6f20 7265 7472  you wish to retr
+00029570: 6965 7665 2067 726f 7570 6564 3f0a 2020  ieve grouped?.  
+00029580: 2020 2020 2020 3a70 6172 616d 2066 6c6f        :param flo
+00029590: 6174 206d 696e 5f63 6f75 6e74 733a 2049  at min_counts: I
+000295a0: 6620 7468 6520 7370 6563 7472 756d 2079  f the spectrum y
+000295b0: 6f75 2077 6973 6820 746f 2072 6574 7269  ou wish to retri
+000295c0: 6576 6520 7761 7320 6772 6f75 7065 6420  eve was grouped 
+000295d0: 6f6e 206d 696e 696d 756d 2063 6f75 6e74  on minimum count
+000295e0: 732c 2077 6861 7420 7761 730a 2020 2020  s, what was.    
+000295f0: 2020 2020 2020 2020 7468 6520 6d69 6e69          the mini
+00029600: 6d75 6d20 6e75 6d62 6572 206f 6620 636f  mum number of co
+00029610: 756e 7473 3f0a 2020 2020 2020 2020 3a70  unts?.        :p
+00029620: 6172 616d 2066 6c6f 6174 206d 696e 5f73  aram float min_s
+00029630: 6e3a 2049 6620 7468 6520 7370 6563 7472  n: If the spectr
+00029640: 756d 2079 6f75 2077 6973 6820 746f 2072  um you wish to r
+00029650: 6574 7269 6576 6520 7761 7320 6772 6f75  etrieve was grou
+00029660: 7065 6420 6f6e 206d 696e 696d 756d 2073  ped on minimum s
+00029670: 6967 6e61 6c20 746f 206e 6f69 7365 2c20  ignal to noise, 
+00029680: 7768 6174 2077 6173 0a20 2020 2020 2020  what was.       
+00029690: 2020 2020 2074 6865 206d 696e 696d 756d       the minimum
+000296a0: 2073 6967 6e61 6c20 746f 206e 6f69 7365   signal to noise
+000296b0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+000296c0: 2066 6c6f 6174 206f 7665 725f 7361 6d70   float over_samp
+000296d0: 6c65 3a20 4966 2074 6865 2073 7065 6374  le: If the spect
+000296e0: 7275 6d20 796f 7520 7769 7368 2074 6f20  rum you wish to 
+000296f0: 7265 7472 6965 7665 2077 6173 206f 7665  retrieve was ove
+00029700: 7220 7361 6d70 6c65 642c 2077 6861 7420  r sampled, what 
+00029710: 7761 7320 7468 6520 6c65 7665 6c20 6f66  was the level of
+00029720: 0a20 2020 2020 2020 2020 2020 206f 7665  .            ove
+00029730: 7220 7361 6d70 6c69 6e67 2075 7365 643f  r sampling used?
+00029740: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00029750: 3a20 416e 2058 4741 2053 7065 6374 7275  : An XGA Spectru
+00029760: 6d20 6f62 6a65 6374 2028 6966 2074 6865  m object (if the
+00029770: 7265 2069 7320 616e 2065 7861 6374 206d  re is an exact m
+00029780: 6174 6368 292c 206f 7220 6120 6c69 7374  atch), or a list
+00029790: 206f 6620 5847 4120 5370 6563 7472 756d   of XGA Spectrum
+000297a0: 206f 626a 6563 7473 2028 6966 2074 6865   objects (if the
+000297b0: 7265 0a20 2020 2020 2020 2020 2020 2077  re.            w
+000297c0: 6572 6520 6d75 6c74 6970 6c65 206d 6174  ere multiple mat
+000297d0: 6368 696e 6720 7072 6f64 7563 7473 292e  ching products).
+000297e0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
+000297f0: 2055 6e69 6f6e 5b53 7065 6374 7275 6d2c   Union[Spectrum,
+00029800: 204c 6973 745b 5370 6563 7472 756d 5d5d   List[Spectrum]]
+00029810: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00029820: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00029830: 6365 2869 6e6e 6572 5f72 6164 6975 732c  ce(inner_radius,
+00029840: 2051 7561 6e74 6974 7929 3a0a 2020 2020   Quantity):.    
+00029850: 2020 2020 2020 2020 696e 6e5f 7261 645f          inn_rad_
+00029860: 6e75 6d20 3d20 7365 6c66 2e63 6f6e 7665  num = self.conve
+00029870: 7274 5f72 6164 6975 7328 696e 6e65 725f  rt_radius(inner_
+00029880: 7261 6469 7573 2c20 2764 6567 2729 0a20  radius, 'deg'). 
+00029890: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+000298a0: 7374 616e 6365 2869 6e6e 6572 5f72 6164  stance(inner_rad
+000298b0: 6975 732c 2073 7472 293a 0a20 2020 2020  ius, str):.     
+000298c0: 2020 2020 2020 2069 6e6e 5f72 6164 5f6e         inn_rad_n
+000298d0: 756d 203d 2073 656c 662e 6765 745f 7261  um = self.get_ra
+000298e0: 6469 7573 2869 6e6e 6572 5f72 6164 6975  dius(inner_radiu
+000298f0: 732c 2027 6465 6727 290a 2020 2020 2020  s, 'deg').      
+00029900: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00029910: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+00029920: 726f 7228 2259 6f75 206d 6179 206f 6e6c  ror("You may onl
+00029930: 7920 7061 7373 2061 2071 7561 6e74 6974  y pass a quantit
+00029940: 7920 6f72 2061 2073 7472 696e 6720 6173  y or a string as
+00029950: 2069 6e6e 6572 5f72 6164 6975 7322 290a   inner_radius").
+00029960: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00029970: 7374 616e 6365 286f 7574 6572 5f72 6164  stance(outer_rad
+00029980: 6975 732c 2051 7561 6e74 6974 7929 3a0a  ius, Quantity):.
+00029990: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+000299a0: 7261 645f 6e75 6d20 3d20 7365 6c66 2e63  rad_num = self.c
+000299b0: 6f6e 7665 7274 5f72 6164 6975 7328 6f75  onvert_radius(ou
+000299c0: 7465 725f 7261 6469 7573 2c20 2764 6567  ter_radius, 'deg
+000299d0: 2729 0a20 2020 2020 2020 2065 6c69 6620  ').        elif 
+000299e0: 6973 696e 7374 616e 6365 286f 7574 6572  isinstance(outer
+000299f0: 5f72 6164 6975 732c 2073 7472 293a 0a20  _radius, str):. 
+00029a00: 2020 2020 2020 2020 2020 206f 7574 5f72             out_r
+00029a10: 6164 5f6e 756d 203d 2073 656c 662e 6765  ad_num = self.ge
+00029a20: 745f 7261 6469 7573 286f 7574 6572 5f72  t_radius(outer_r
+00029a30: 6164 6975 732c 2027 6465 6727 290a 2020  adius, 'deg').  
+00029a40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00029a50: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00029a60: 7065 4572 726f 7228 2259 6f75 206d 6179  peError("You may
+00029a70: 206f 6e6c 7920 7061 7373 2061 2071 7561   only pass a qua
+00029a80: 6e74 6974 7920 6f72 2061 2073 7472 696e  ntity or a strin
+00029a90: 6720 6173 206f 7574 6572 5f72 6164 6975  g as outer_radiu
+00029aa0: 7322 290a 0a20 2020 2020 2020 2069 6620  s")..        if 
+00029ab0: 6f76 6572 5f73 616d 706c 6520 6973 206e  over_sample is n
+00029ac0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00029ad0: 2020 2020 206f 7665 725f 7361 6d70 6c65       over_sample
+00029ae0: 203d 2069 6e74 286f 7665 725f 7361 6d70   = int(over_samp
+00029af0: 6c65 290a 2020 2020 2020 2020 6966 206d  le).        if m
+00029b00: 696e 5f63 6f75 6e74 7320 6973 206e 6f74  in_counts is not
+00029b10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00029b20: 2020 206d 696e 5f63 6f75 6e74 7320 3d20     min_counts = 
+00029b30: 696e 7428 6d69 6e5f 636f 756e 7473 290a  int(min_counts).
+00029b40: 2020 2020 2020 2020 6966 206d 696e 5f73          if min_s
+00029b50: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
+00029b60: 2020 2020 2020 2020 2020 206d 696e 5f73             min_s
+00029b70: 6e20 3d20 666c 6f61 7428 6d69 6e5f 736e  n = float(min_sn
+00029b80: 290a 0a20 2020 2020 2020 2023 2053 6574  )..        # Set
+00029b90: 7320 7570 2074 6865 2065 7874 7261 2070  s up the extra p
+00029ba0: 6172 7420 6f66 2074 6865 2073 746f 7261  art of the stora
+00029bb0: 6765 206b 6579 206e 616d 6520 6465 7065  ge key name depe
+00029bc0: 6e64 696e 6720 6f6e 2069 6620 6772 6f75  nding on if grou
+00029bd0: 7069 6e67 2069 7320 656e 6162 6c65 640a  ping is enabled.
+00029be0: 2020 2020 2020 2020 6966 2067 726f 7570          if group
+00029bf0: 5f73 7065 6320 616e 6420 6d69 6e5f 636f  _spec and min_co
+00029c00: 756e 7473 2069 7320 6e6f 7420 4e6f 6e65  unts is not None
+00029c10: 3a0a 2020 2020 2020 2020 2020 2020 6578  :.            ex
+00029c20: 7472 615f 6e61 6d65 203d 2022 5f6d 696e  tra_name = "_min
+00029c30: 636e 747b 7d22 2e66 6f72 6d61 7428 6d69  cnt{}".format(mi
+00029c40: 6e5f 636f 756e 7473 290a 2020 2020 2020  n_counts).      
+00029c50: 2020 656c 6966 2067 726f 7570 5f73 7065    elif group_spe
+00029c60: 6320 616e 6420 6d69 6e5f 736e 2069 7320  c and min_sn is 
+00029c70: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00029c80: 2020 2020 2020 6578 7472 615f 6e61 6d65        extra_name
+00029c90: 203d 2022 5f6d 696e 736e 7b7d 222e 666f   = "_minsn{}".fo
+00029ca0: 726d 6174 286d 696e 5f73 6e29 0a20 2020  rmat(min_sn).   
+00029cb0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00029cc0: 2020 2020 2020 2065 7874 7261 5f6e 616d         extra_nam
+00029cd0: 6520 3d20 2727 0a0a 2020 2020 2020 2020  e = ''..        
+00029ce0: 2320 416e 6420 6966 2069 7420 7761 7320  # And if it was 
+00029cf0: 6f76 6572 7361 6d70 6c65 6420 6475 7269  oversampled duri
+00029d00: 6e67 2067 656e 6572 6174 696f 6e20 7468  ng generation th
+00029d10: 656e 2077 6520 6e65 6564 2074 6f20 696e  en we need to in
+00029d20: 636c 7564 6520 7468 6174 2061 7320 7765  clude that as we
+00029d30: 6c6c 0a20 2020 2020 2020 2069 6620 6f76  ll.        if ov
+00029d40: 6572 5f73 616d 706c 6520 6973 206e 6f74  er_sample is not
+00029d50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00029d60: 2020 2065 7874 7261 5f6e 616d 6520 2b3d     extra_name +=
+00029d70: 2022 5f6f 7673 616d 707b 6f76 7d22 2e66   "_ovsamp{ov}".f
+00029d80: 6f72 6d61 7428 6f76 3d6f 7665 725f 7361  ormat(ov=over_sa
+00029d90: 6d70 6c65 290a 0a20 2020 2020 2020 2069  mple)..        i
+00029da0: 6620 6f75 7465 725f 7261 6469 7573 2021  f outer_radius !
+00029db0: 3d20 2772 6567 696f 6e27 3a0a 2020 2020  = 'region':.    
+00029dc0: 2020 2020 2020 2020 2320 5468 6520 6b65          # The ke
+00029dd0: 7920 756e 6465 7220 7768 6963 6820 7468  y under which th
+00029de0: 6573 6520 7370 6563 7472 6120 7769 6c6c  ese spectra will
+00029df0: 2062 6520 7374 6f72 6564 0a20 2020 2020   be stored.     
+00029e00: 2020 2020 2020 2073 7065 635f 7374 6f72         spec_stor
+00029e10: 6167 655f 6e61 6d65 203d 2022 7261 7b72  age_name = "ra{r
+00029e20: 617d 5f64 6563 7b64 6563 7d5f 7269 7b72  a}_dec{dec}_ri{r
+00029e30: 697d 5f72 6f7b 726f 7d5f 6772 707b 6772  i}_ro{ro}_grp{gr
+00029e40: 7d22 0a20 2020 2020 2020 2020 2020 2073  }".            s
+00029e50: 7065 635f 7374 6f72 6167 655f 6e61 6d65  pec_storage_name
+00029e60: 203d 2073 7065 635f 7374 6f72 6167 655f   = spec_storage_
+00029e70: 6e61 6d65 2e66 6f72 6d61 7428 7261 3d73  name.format(ra=s
+00029e80: 656c 662e 6465 6661 756c 745f 636f 6f72  elf.default_coor
+00029e90: 645b 305d 2e76 616c 7565 2c0a 2020 2020  d[0].value,.    
+00029ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ed0: 2020 2020 2064 6563 3d73 656c 662e 6465       dec=self.de
+00029ee0: 6661 756c 745f 636f 6f72 645b 315d 2e76  fault_coord[1].v
+00029ef0: 616c 7565 2c0a 2020 2020 2020 2020 2020  alue,.          
+00029f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00029f30: 693d 696e 6e5f 7261 645f 6e75 6d2e 7661  i=inn_rad_num.va
+00029f40: 6c75 652c 2072 6f3d 6f75 745f 7261 645f  lue, ro=out_rad_
+00029f50: 6e75 6d2e 7661 6c75 652c 0a20 2020 2020  num.value,.     
+00029f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f90: 2020 2020 6772 3d67 726f 7570 5f73 7065      gr=group_spe
+00029fa0: 6329 0a20 2020 2020 2020 2065 6c73 653a  c).        else:
+00029fb0: 0a20 2020 2020 2020 2020 2020 2073 7065  .            spe
+00029fc0: 635f 7374 6f72 6167 655f 6e61 6d65 203d  c_storage_name =
+00029fd0: 2022 7265 6769 6f6e 5f67 7270 7b67 727d   "region_grp{gr}
+00029fe0: 222e 666f 726d 6174 2867 723d 6772 6f75  ".format(gr=grou
+00029ff0: 705f 7370 6563 290a 0a20 2020 2020 2020  p_spec)..       
+0002a000: 2023 2041 6464 7320 6f6e 2074 6865 2065   # Adds on the e
+0002a010: 7874 7261 2069 6e66 6f72 6d61 7469 6f6e  xtra information
+0002a020: 2061 626f 7574 2067 726f 7570 696e 6720   about grouping 
+0002a030: 746f 2074 6865 2073 746f 7261 6765 206b  to the storage k
+0002a040: 6579 0a20 2020 2020 2020 2073 7065 635f  ey.        spec_
+0002a050: 7374 6f72 6167 655f 6e61 6d65 202b 3d20  storage_name += 
+0002a060: 6578 7472 615f 6e61 6d65 0a20 2020 2020  extra_name.     
+0002a070: 2020 206d 6174 6368 6564 5f70 726f 6473     matched_prods
+0002a080: 203d 2073 656c 662e 6765 745f 7072 6f64   = self.get_prod
+0002a090: 7563 7473 2827 7370 6563 7472 756d 272c  ucts('spectrum',
+0002a0a0: 206f 6273 5f69 643d 6f62 735f 6964 2c20   obs_id=obs_id, 
+0002a0b0: 696e 7374 3d69 6e73 742c 2065 7874 7261  inst=inst, extra
+0002a0c0: 5f6b 6579 3d73 7065 635f 7374 6f72 6167  _key=spec_storag
+0002a0d0: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
+0002a0e0: 6966 206c 656e 286d 6174 6368 6564 5f70  if len(matched_p
+0002a0f0: 726f 6473 2920 3d3d 2031 3a0a 2020 2020  rods) == 1:.    
+0002a100: 2020 2020 2020 2020 6d61 7463 6865 645f          matched_
+0002a110: 7072 6f64 7320 3d20 6d61 7463 6865 645f  prods = matched_
+0002a120: 7072 6f64 735b 305d 0a20 2020 2020 2020  prods[0].       
+0002a130: 2065 6c69 6620 6c65 6e28 6d61 7463 6865   elif len(matche
+0002a140: 645f 7072 6f64 7329 203d 3d20 303a 0a20  d_prods) == 0:. 
+0002a150: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0002a160: 204e 6f50 726f 6475 6374 4176 6169 6c61   NoProductAvaila
+0002a170: 626c 6545 7272 6f72 2822 4361 6e6e 6f74  bleError("Cannot
+0002a180: 2066 696e 6420 616e 7920 7370 6563 7472   find any spectr
+0002a190: 6120 6d61 7463 6869 6e67 2079 6f75 7220  a matching your 
+0002a1a0: 696e 7075 742e 2229 0a0a 2020 2020 2020  input.")..      
+0002a1b0: 2020 7265 7475 726e 206d 6174 6368 6564    return matched
+0002a1c0: 5f70 726f 6473 0a0a 2020 2020 6465 6620  _prods..    def 
+0002a1d0: 6765 745f 616e 6e75 6c61 725f 7370 6563  get_annular_spec
+0002a1e0: 7472 6128 7365 6c66 2c20 7261 6469 693a  tra(self, radii:
+0002a1f0: 2051 7561 6e74 6974 7920 3d20 4e6f 6e65   Quantity = None
+0002a200: 2c20 6772 6f75 705f 7370 6563 3a20 626f  , group_spec: bo
+0002a210: 6f6c 203d 2054 7275 652c 206d 696e 5f63  ol = True, min_c
+0002a220: 6f75 6e74 733a 2069 6e74 203d 2035 2c0a  ounts: int = 5,.
+0002a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a240: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+0002a250: 736e 3a20 666c 6f61 7420 3d20 4e6f 6e65  sn: float = None
+0002a260: 2c20 6f76 6572 5f73 616d 706c 653a 2066  , over_sample: f
+0002a270: 6c6f 6174 203d 204e 6f6e 652c 2073 6574  loat = None, set
+0002a280: 5f69 643a 2069 6e74 203d 204e 6f6e 6529  _id: int = None)
+0002a290: 202d 3e20 416e 6e75 6c61 7253 7065 6374   -> AnnularSpect
+0002a2a0: 7261 3a0a 2020 2020 2020 2020 2222 220a  ra:.        """.
+0002a2b0: 2020 2020 2020 2020 416e 6f74 6865 7220          Another 
+0002a2c0: 7573 6566 756c 206d 6574 686f 6420 7468  useful method th
+0002a2d0: 6174 2077 7261 7073 2074 6865 2067 6574  at wraps the get
+0002a2e0: 5f70 726f 6475 6374 7320 6675 6e63 7469  _products functi
+0002a2f0: 6f6e 2c20 7468 6f75 6768 2074 6869 7320  on, though this 
+0002a300: 6f6e 6520 6765 7473 2079 6f75 2041 6e6e  one gets you Ann
+0002a310: 756c 6172 5370 6563 7472 612e 0a20 2020  ularSpectra..   
+0002a320: 2020 2020 2050 6173 7320 7468 6520 7261       Pass the ra
+0002a330: 6469 6920 7573 6564 2074 6f20 6765 6e65  dii used to gene
+0002a340: 7261 7465 2074 6865 2061 6e6e 756c 692c  rate the annuli,
+0002a350: 2061 6e64 2074 6865 2073 616d 6520 7365   and the same se
+0002a360: 7474 696e 6773 2079 6f75 2075 7365 6420  ttings you used 
+0002a370: 746f 2067 656e 6572 6174 6520 7468 6520  to generate the 
+0002a380: 7370 6563 7472 756d 0a20 2020 2020 2020  spectrum.       
+0002a390: 2069 6e20 7370 6563 7472 756d 5f73 6574   in spectrum_set
+0002a3a0: 2c20 616e 6420 7468 6520 416e 6e75 6c61  , and the Annula
+0002a3b0: 7253 7065 6374 7261 2077 696c 6c20 6265  rSpectra will be
+0002a3c0: 2072 6574 7572 6e65 6420 2869 6620 6974   returned (if it
+0002a3d0: 2065 7869 7374 7329 2e20 4966 206e 6f20   exists). If no 
+0002a3e0: 6d61 7463 6820 6973 2066 6f75 6e64 2074  match is found t
+0002a3f0: 6865 6e0a 2020 2020 2020 2020 6120 4e6f  hen.        a No
+0002a400: 5072 6f64 7563 7441 7661 696c 6162 6c65  ProductAvailable
+0002a410: 4572 726f 7220 7769 6c6c 2062 6520 7261  Error will be ra
+0002a420: 6973 6564 2e20 5468 6973 206d 6574 686f  ised. This metho
+0002a430: 6420 6861 7320 616e 2061 6464 6974 696f  d has an additio
+0002a440: 6e61 6c20 7761 7920 6f66 206c 6f6f 6b69  nal way of looki
+0002a450: 6e67 2066 6f72 2061 206d 6174 6368 696e  ng for a matchin
+0002a460: 670a 2020 2020 2020 2020 7370 6563 7472  g.        spectr
+0002a470: 756d 2c20 6966 2074 6865 2073 6574 2049  um, if the set I
+0002a480: 4420 6973 206b 6e6f 776e 2074 6865 6e20  D is known then 
+0002a490: 7468 6174 2063 616e 2062 6520 7061 7373  that can be pass
+0002a4a0: 6564 2062 7920 7468 6520 7573 6572 2061  ed by the user a
+0002a4b0: 6e64 2075 7365 6420 746f 2066 696e 6420  nd used to find 
+0002a4c0: 616e 2065 7861 6374 206d 6174 6368 2e0a  an exact match..
+0002a4d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0002a4e0: 5175 616e 7469 7479 2072 6164 6969 3a20  Quantity radii: 
+0002a4f0: 5468 6520 616e 6e75 6c75 7320 626f 756e  The annulus boun
+0002a500: 6461 7279 2072 6164 6969 2074 6861 7420  dary radii that 
+0002a510: 7765 7265 2075 7365 6420 746f 2067 656e  were used to gen
+0002a520: 6572 6174 6520 7468 6520 616e 6e75 6c61  erate the annula
+0002a530: 7220 7370 6563 7472 6120 7365 740a 2020  r spectra set.  
+0002a540: 2020 2020 2020 2020 2020 7468 6174 2079            that y
+0002a550: 6f75 2077 6973 6820 746f 2072 6574 7269  ou wish to retri
+0002a560: 6576 652e 2042 7920 6465 6661 756c 7420  eve. By default 
+0002a570: 7468 6973 2069 7320 4e6f 6e65 2c20 7768  this is None, wh
+0002a580: 6963 6820 6d65 616e 7320 7468 6520 6d65  ich means the me
+0002a590: 7468 6f64 2077 696c 6c20 7265 7475 726e  thod will return
+0002a5a0: 2061 6e6e 756c 6172 0a20 2020 2020 2020   annular.       
+0002a5b0: 2020 2020 2073 7065 6374 7261 2077 6974       spectra wit
+0002a5c0: 6820 616e 7920 7261 6469 692e 0a20 2020  h any radii..   
+0002a5d0: 2020 2020 203a 7061 7261 6d20 626f 6f6c       :param bool
+0002a5e0: 2067 726f 7570 5f73 7065 633a 2057 6173   group_spec: Was
+0002a5f0: 2074 6865 2073 7065 6374 7275 6d20 7365   the spectrum se
+0002a600: 7420 796f 7520 7769 7368 2074 6f20 7265  t you wish to re
+0002a610: 7472 6965 7665 2067 726f 7570 6564 3f0a  trieve grouped?.
+0002a620: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
+0002a630: 6c6f 6174 206d 696e 5f63 6f75 6e74 733a  loat min_counts:
+0002a640: 2049 6620 7468 6520 7370 6563 7472 756d   If the spectrum
+0002a650: 2073 6574 2079 6f75 2077 6973 6820 746f   set you wish to
+0002a660: 2072 6574 7269 6576 6520 7761 7320 6772   retrieve was gr
+0002a670: 6f75 7065 6420 6f6e 206d 696e 696d 756d  ouped on minimum
+0002a680: 2063 6f75 6e74 732c 2077 6861 7420 7761   counts, what wa
+0002a690: 730a 2020 2020 2020 2020 2020 2020 7468  s.            th
+0002a6a0: 6520 6d69 6e69 6d75 6d20 6e75 6d62 6572  e minimum number
+0002a6b0: 206f 6620 636f 756e 7473 3f0a 2020 2020   of counts?.    
+0002a6c0: 2020 2020 3a70 6172 616d 2066 6c6f 6174      :param float
+0002a6d0: 206d 696e 5f73 6e3a 2049 6620 7468 6520   min_sn: If the 
+0002a6e0: 7370 6563 7472 756d 2073 6574 2079 6f75  spectrum set you
+0002a6f0: 2077 6973 6820 746f 2072 6574 7269 6576   wish to retriev
+0002a700: 6520 7761 7320 6772 6f75 7065 6420 6f6e  e was grouped on
+0002a710: 206d 696e 696d 756d 2073 6967 6e61 6c20   minimum signal 
+0002a720: 746f 0a20 2020 2020 2020 2020 2020 206e  to.            n
+0002a730: 6f69 7365 2c20 7768 6174 2077 6173 2074  oise, what was t
+0002a740: 6865 206d 696e 696d 756d 2073 6967 6e61  he minimum signa
+0002a750: 6c20 746f 206e 6f69 7365 2e0a 2020 2020  l to noise..    
+0002a760: 2020 2020 3a70 6172 616d 2066 6c6f 6174      :param float
+0002a770: 206f 7665 725f 7361 6d70 6c65 3a20 4966   over_sample: If
+0002a780: 2074 6865 2073 7065 6374 7275 6d20 7365   the spectrum se
+0002a790: 7420 796f 7520 7769 7368 2074 6f20 7265  t you wish to re
+0002a7a0: 7472 6965 7665 2077 6173 206f 7665 7220  trieve was over 
+0002a7b0: 7361 6d70 6c65 642c 2077 6861 7420 7761  sampled, what wa
+0002a7c0: 7320 7468 6520 6c65 7665 6c20 6f66 0a20  s the level of. 
+0002a7d0: 2020 2020 2020 2020 2020 206f 7665 7220             over 
+0002a7e0: 7361 6d70 6c69 6e67 2075 7365 643f 0a20  sampling used?. 
+0002a7f0: 2020 2020 2020 203a 7061 7261 6d20 696e         :param in
+0002a800: 7420 7365 745f 6964 3a20 5468 6520 756e  t set_id: The un
+0002a810: 6971 7565 2069 6465 6e74 6966 6965 7220  ique identifier 
+0002a820: 6f66 2074 6865 2061 6e6e 756c 6172 2073  of the annular s
+0002a830: 7065 6374 7275 6d20 7365 742e 2050 6173  pectrum set. Pas
+0002a840: 7369 6e67 2061 2076 616c 7565 2066 6f72  sing a value for
+0002a850: 2074 6869 7320 7061 7261 6d65 7465 720a   this parameter.
+0002a860: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+0002a870: 206f 7665 7272 6964 6520 616e 7920 6f74   override any ot
+0002a880: 6865 7220 696e 666f 726d 6174 696f 6e20  her information 
+0002a890: 7468 6174 2079 6f75 2068 6176 6520 6769  that you have gi
+0002a8a0: 7665 6e20 7468 6973 206d 6574 686f 642e  ven this method.
+0002a8b0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0002a8c0: 3a20 416e 2058 4741 2041 6e6e 756c 6172  : An XGA Annular
+0002a8d0: 5370 6563 7472 6120 6f62 6a65 6374 2069  Spectra object i
+0002a8e0: 6620 7468 6572 6520 6973 2061 6e20 6578  f there is an ex
+0002a8f0: 6163 7420 6d61 7463 682e 0a20 2020 2020  act match..     
+0002a900: 2020 203a 7274 7970 653a 2041 6e6e 756c     :rtype: Annul
+0002a910: 6172 5370 6563 7472 610a 2020 2020 2020  arSpectra.      
+0002a920: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0002a930: 2067 726f 7570 5f73 7065 6320 616e 6420   group_spec and 
+0002a940: 6d69 6e5f 636f 756e 7473 2069 7320 6e6f  min_counts is no
+0002a950: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0002a960: 2020 2020 6578 7472 615f 6e61 6d65 203d      extra_name =
+0002a970: 2022 5f6d 696e 636e 747b 7d22 2e66 6f72   "_mincnt{}".for
+0002a980: 6d61 7428 6d69 6e5f 636f 756e 7473 290a  mat(min_counts).
+0002a990: 2020 2020 2020 2020 656c 6966 2067 726f          elif gro
+0002a9a0: 7570 5f73 7065 6320 616e 6420 6d69 6e5f  up_spec and min_
+0002a9b0: 736e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  sn is not None:.
+0002a9c0: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+0002a9d0: 615f 6e61 6d65 203d 2022 5f6d 696e 736e  a_name = "_minsn
+0002a9e0: 7b7d 222e 666f 726d 6174 286d 696e 5f73  {}".format(min_s
+0002a9f0: 6e29 0a20 2020 2020 2020 2065 6c73 653a  n).        else:
+0002aa00: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
+0002aa10: 7261 5f6e 616d 6520 3d20 2727 0a0a 2020  ra_name = ''..  
+0002aa20: 2020 2020 2020 2320 416e 6420 6966 2069        # And if i
+0002aa30: 7420 7761 7320 6f76 6572 7361 6d70 6c65  t was oversample
+0002aa40: 6420 6475 7269 6e67 2067 656e 6572 6174  d during generat
+0002aa50: 696f 6e20 7468 656e 2077 6520 6e65 6564  ion then we need
+0002aa60: 2074 6f20 696e 636c 7564 6520 7468 6174   to include that
+0002aa70: 2061 7320 7765 6c6c 0a20 2020 2020 2020   as well.       
+0002aa80: 2069 6620 6f76 6572 5f73 616d 706c 6520   if over_sample 
+0002aa90: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0002aaa0: 2020 2020 2020 2020 2065 7874 7261 5f6e           extra_n
+0002aab0: 616d 6520 2b3d 2022 5f6f 7673 616d 707b  ame += "_ovsamp{
+0002aac0: 6f76 7d22 2e66 6f72 6d61 7428 6f76 3d6f  ov}".format(ov=o
+0002aad0: 7665 725f 7361 6d70 6c65 290a 0a20 2020  ver_sample)..   
+0002aae0: 2020 2020 2023 2043 6f6d 6269 6e65 7320       # Combines 
+0002aaf0: 7468 6520 616e 6e75 6c61 7220 7261 6469  the annular radi
+0002ab00: 6920 696e 746f 2061 2073 7472 696e 672c  i into a string,
+0002ab10: 2061 6e64 206d 616b 6573 2073 7572 6520   and makes sure 
+0002ab20: 7468 6520 7261 6469 6920 6172 6520 696e  the radii are in
+0002ab30: 2064 6567 7265 6573 2c20 6173 2072 6164   degrees, as rad
+0002ab40: 6969 2061 7265 2069 6e0a 2020 2020 2020  ii are in.      
+0002ab50: 2020 2320 2064 6567 7265 6573 2069 6e20    #  degrees in 
+0002ab60: 7468 6520 7374 6f72 6167 6520 6b65 790a  the storage key.
+0002ab70: 2020 2020 2020 2020 6966 2072 6164 6969          if radii
+0002ab80: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0002ab90: 2020 2020 2020 2020 2020 2320 5765 2772            # We'r
+0002aba0: 6520 6465 616c 696e 6720 7769 7468 2074  e dealing with t
+0002abb0: 6865 2062 6573 7420 6361 7365 2068 6572  he best case her
+0002abc0: 652c 2074 6865 2075 7365 7220 6861 7320  e, the user has 
+0002abd0: 7061 7373 6564 2072 6164 6969 2c20 736f  passed radii, so
+0002abe0: 2077 6520 6361 6e20 6765 6e65 7261 7465   we can generate
+0002abf0: 2061 6e20 6578 6163 740a 2020 2020 2020   an exact.      
+0002ac00: 2020 2020 2020 2320 2073 746f 7261 6765        #  storage
+0002ac10: 206b 6579 2061 6e64 206c 6f6f 6b20 666f   key and look fo
+0002ac20: 7220 6120 7369 6e67 6c65 206d 6174 6368  r a single match
+0002ac30: 0a20 2020 2020 2020 2020 2020 2061 6e6e  .            ann
+0002ac40: 5f72 6164 5f73 7472 203d 2022 5f22 2e6a  _rad_str = "_".j
+0002ac50: 6f69 6e28 7365 6c66 2e63 6f6e 7665 7274  oin(self.convert
+0002ac60: 5f72 6164 6975 7328 7261 6469 692c 2027  _radius(radii, '
+0002ac70: 6465 6727 292e 7661 6c75 652e 6173 7479  deg').value.asty
+0002ac80: 7065 2873 7472 2929 0a20 2020 2020 2020  pe(str)).       
+0002ac90: 2020 2020 2073 7065 635f 7374 6f72 6167       spec_storag
+0002aca0: 655f 6e61 6d65 203d 2022 7261 7b72 617d  e_name = "ra{ra}
+0002acb0: 5f64 6563 7b64 6563 7d5f 6172 7b61 727d  _dec{dec}_ar{ar}
+0002acc0: 5f67 7270 7b67 727d 220a 2020 2020 2020  _grp{gr}".      
+0002acd0: 2020 2020 2020 7370 6563 5f73 746f 7261        spec_stora
+0002ace0: 6765 5f6e 616d 6520 3d20 7370 6563 5f73  ge_name = spec_s
+0002acf0: 746f 7261 6765 5f6e 616d 652e 666f 726d  torage_name.form
+0002ad00: 6174 2872 613d 7365 6c66 2e64 6566 6175  at(ra=self.defau
+0002ad10: 6c74 5f63 6f6f 7264 5b30 5d2e 7661 6c75  lt_coord[0].valu
+0002ad20: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0002ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ad50: 2020 2020 2020 2020 2020 2020 6465 633d              dec=
+0002ad60: 7365 6c66 2e64 6566 6175 6c74 5f63 6f6f  self.default_coo
+0002ad70: 7264 5b31 5d2e 7661 6c75 652c 0a20 2020  rd[1].value,.   
+0002ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002adb0: 2020 2020 2020 6172 3d61 6e6e 5f72 6164        ar=ann_rad
+0002adc0: 5f73 7472 2c20 6772 3d67 726f 7570 5f73  _str, gr=group_s
+0002add0: 7065 6329 0a20 2020 2020 2020 2020 2020  pec).           
+0002ade0: 2073 7065 635f 7374 6f72 6167 655f 6e61   spec_storage_na
+0002adf0: 6d65 202b 3d20 6578 7472 615f 6e61 6d65  me += extra_name
+0002ae00: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0002ae10: 2020 2020 2020 2020 2020 2023 2054 6869             # Thi
+0002ae20: 7320 6973 2061 2077 6f72 7365 2063 6173  s is a worse cas
+0002ae30: 652c 2077 6520 646f 6e27 7420 6861 7665  e, we don't have
+0002ae40: 2072 6164 6969 2c20 736f 2077 6520 7370   radii, so we sp
+0002ae50: 6c69 7420 7468 6520 6b6e 6f77 6e20 7061  lit the known pa
+0002ae60: 7274 7320 6f66 2074 6865 206b 6579 2069  rts of the key i
+0002ae70: 6e74 6f20 6120 6c69 7374 0a20 2020 2020  nto a list.     
+0002ae80: 2020 2020 2020 2023 2020 616e 6420 7765         #  and we
+0002ae90: 276c 6c20 6c6f 6f6b 2066 6f72 2070 6172  'll look for par
+0002aea0: 7469 616c 206d 6174 6368 6573 0a20 2020  tial matches.   
+0002aeb0: 2020 2020 2020 2020 2070 6f73 5f73 7472           pos_str
+0002aec0: 203d 2022 7261 7b72 617d 5f64 6563 7b64   = "ra{ra}_dec{d
+0002aed0: 6563 7d22 2e66 6f72 6d61 7428 7261 3d73  ec}".format(ra=s
+0002aee0: 656c 662e 6465 6661 756c 745f 636f 6f72  elf.default_coor
+0002aef0: 645b 305d 2e76 616c 7565 2c20 6465 633d  d[0].value, dec=
+0002af00: 7365 6c66 2e64 6566 6175 6c74 5f63 6f6f  self.default_coo
+0002af10: 7264 5b31 5d2e 7661 6c75 6529 0a20 2020  rd[1].value).   
+0002af20: 2020 2020 2020 2020 2067 7270 5f73 7472           grp_str
+0002af30: 203d 2022 6772 707b 6772 7d22 2e66 6f72   = "grp{gr}".for
+0002af40: 6d61 7428 6772 3d67 726f 7570 5f73 7065  mat(gr=group_spe
+0002af50: 6329 202b 2065 7874 7261 5f6e 616d 650a  c) + extra_name.
+0002af60: 2020 2020 2020 2020 2020 2020 7370 6563              spec
+0002af70: 5f73 746f 7261 6765 5f6e 616d 6520 3d20  _storage_name = 
+0002af80: 5b70 6f73 5f73 7472 2c20 6772 705f 7374  [pos_str, grp_st
+0002af90: 725d 0a0a 2020 2020 2020 2020 2320 4966  r]..        # If
+0002afa0: 2074 6865 2075 7365 7220 6861 736e 2774   the user hasn't
+0002afb0: 2070 6173 7365 6420 6120 7365 7420 4944   passed a set ID
+0002afc0: 2041 4e44 2074 6865 2075 7365 7220 6861   AND the user ha
+0002afd0: 7320 7061 7373 6564 2072 6164 6969 2074  s passed radii t
+0002afe0: 6865 6e20 7765 276c 6c20 676f 206c 6f6f  hen we'll go loo
+0002aff0: 6b69 6e67 2077 6974 6820 6f75 740a 2020  king with out.  
+0002b000: 2020 2020 2020 2320 2070 726f 7065 726c        #  properl
+0002b010: 7920 636f 6e73 7472 7563 7465 6420 7374  y constructed st
+0002b020: 6f72 6167 6520 6b65 790a 2020 2020 2020  orage key.      
+0002b030: 2020 6966 2073 6574 5f69 6420 6973 204e    if set_id is N
+0002b040: 6f6e 6520 616e 6420 7261 6469 6920 6973  one and radii is
+0002b050: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0002b060: 2020 2020 2020 206d 6174 6368 6564 5f70         matched_p
+0002b070: 726f 6473 203d 2073 656c 662e 6765 745f  rods = self.get_
+0002b080: 7072 6f64 7563 7473 2827 636f 6d62 696e  products('combin
+0002b090: 6564 5f73 7065 6374 7275 6d27 2c20 6578  ed_spectrum', ex
+0002b0a0: 7472 615f 6b65 793d 7370 6563 5f73 746f  tra_key=spec_sto
+0002b0b0: 7261 6765 5f6e 616d 6529 0a20 2020 2020  rage_name).     
+0002b0c0: 2020 2023 2042 7574 2069 6620 7468 6520     # But if the 
+0002b0d0: 7573 6572 2068 6173 6e27 7420 7061 7373  user hasn't pass
+0002b0e0: 6564 2061 6e20 4944 2041 4e44 2074 6865  ed an ID AND the
+0002b0f0: 2072 6164 6969 2061 7265 204e 6f6e 6520   radii are None 
+0002b100: 7468 656e 2077 6520 6c6f 6f6b 2066 6f72  then we look for
+0002b110: 2070 6172 7469 616c 206d 6174 6368 6573   partial matches
+0002b120: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+0002b130: 745f 6964 2069 7320 4e6f 6e65 2061 6e64  t_id is None and
+0002b140: 2072 6164 6969 2069 7320 4e6f 6e65 3a0a   radii is None:.
+0002b150: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
+0002b160: 6865 645f 7072 6f64 7320 3d20 5b70 2066  hed_prods = [p f
+0002b170: 6f72 2070 2069 6e20 7365 6c66 2e67 6574  or p in self.get
+0002b180: 5f70 726f 6475 6374 7328 2763 6f6d 6269  _products('combi
+0002b190: 6e65 645f 7370 6563 7472 756d 2729 0a20  ned_spectrum'). 
+0002b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1b0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0002b1c0: 7065 635f 7374 6f72 6167 655f 6e61 6d65  pec_storage_name
+0002b1d0: 5b30 5d20 696e 2070 2e73 746f 7261 6765  [0] in p.storage
+0002b1e0: 5f6b 6579 2061 6e64 2073 7065 635f 7374  _key and spec_st
+0002b1f0: 6f72 6167 655f 6e61 6d65 5b31 5d20 696e  orage_name[1] in
+0002b200: 2070 2e73 746f 7261 6765 5f6b 6579 5d0a   p.storage_key].
+0002b210: 2020 2020 2020 2020 2320 486f 7765 7665          # Howeve
+0002b220: 7220 6966 2074 6865 7920 6861 7665 2070  r if they have p
+0002b230: 6173 7365 6420 6120 7365 7449 4420 7468  assed a setID th
+0002b240: 656e 2074 6869 7320 6f76 6572 2d72 6964  en this over-rid
+0002b250: 6573 2065 7665 7279 7468 696e 6720 656c  es everything el
+0002b260: 7365 0a20 2020 2020 2020 2065 6c73 653a  se.        else:
+0002b270: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
+0002b280: 6974 6820 7468 6520 7365 7420 4944 2077  ith the set ID w
+0002b290: 6520 6665 7463 6820 414c 4c20 616e 6e75  e fetch ALL annu
+0002b2a0: 6c61 7220 7370 6563 7472 612c 2074 6865  lar spectra, the
+0002b2b0: 6e20 7573 6520 7468 6569 7220 7365 745f  n use their set_
+0002b2c0: 6964 2070 726f 7065 7274 7920 746f 206d  id property to m
+0002b2d0: 6174 6368 2061 6761 696e 7374 0a20 2020  atch against.   
+0002b2e0: 2020 2020 2020 2020 2023 2020 7768 6174           #  what
+0002b2f0: 6576 6572 2074 6865 2075 7365 7220 7061  ever the user pa
+0002b300: 7373 6564 2069 6e0a 2020 2020 2020 2020  ssed in.        
+0002b310: 2020 2020 6d61 7463 6865 645f 7072 6f64      matched_prod
+0002b320: 7320 3d20 5b70 2066 6f72 2070 2069 6e20  s = [p for p in 
+0002b330: 7365 6c66 2e67 6574 5f70 726f 6475 6374  self.get_product
+0002b340: 7328 2763 6f6d 6269 6e65 645f 7370 6563  s('combined_spec
+0002b350: 7472 756d 2729 2069 6620 702e 7365 745f  trum') if p.set_
+0002b360: 6964 656e 7420 3d3d 2073 6574 5f69 645d  ident == set_id]
+0002b370: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+0002b380: 286d 6174 6368 6564 5f70 726f 6473 2920  (matched_prods) 
+0002b390: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+0002b3a0: 2020 6d61 7463 6865 645f 7072 6f64 7320    matched_prods 
+0002b3b0: 3d20 6d61 7463 6865 645f 7072 6f64 735b  = matched_prods[
+0002b3c0: 305d 0a20 2020 2020 2020 2065 6c69 6620  0].        elif 
+0002b3d0: 6c65 6e28 6d61 7463 6865 645f 7072 6f64  len(matched_prod
+0002b3e0: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
+0002b3f0: 2020 2020 2072 6169 7365 204e 6f50 726f       raise NoPro
+0002b400: 6475 6374 4176 6169 6c61 626c 6545 7272  ductAvailableErr
+0002b410: 6f72 2822 4e6f 206d 6174 6368 696e 6720  or("No matching 
+0002b420: 416e 6e75 6c61 7253 7065 6374 7261 2063  AnnularSpectra c
+0002b430: 616e 2062 6520 666f 756e 642e 2229 0a0a  an be found.")..
+0002b440: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+0002b450: 6174 6368 6564 5f70 726f 6473 0a0a 2020  atched_prods..  
+0002b460: 2020 6465 6620 5f67 6574 5f70 686f 745f    def _get_phot_
+0002b470: 7072 6f64 2873 656c 662c 2070 726f 645f  prod(self, prod_
+0002b480: 7479 7065 3a20 7374 722c 206f 6273 5f69  type: str, obs_i
+0002b490: 643a 2073 7472 203d 204e 6f6e 652c 2069  d: str = None, i
+0002b4a0: 6e73 743a 2073 7472 203d 204e 6f6e 652c  nst: str = None,
+0002b4b0: 206c 6f5f 656e 3a20 5175 616e 7469 7479   lo_en: Quantity
+0002b4c0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0002b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b4e0: 6869 5f65 6e3a 2051 7561 6e74 6974 7920  hi_en: Quantity 
+0002b4f0: 3d20 4e6f 6e65 2c20 7073 665f 636f 7272  = None, psf_corr
+0002b500: 3a20 626f 6f6c 203d 2046 616c 7365 2c20  : bool = False, 
+0002b510: 7073 665f 6d6f 6465 6c3a 2073 7472 203d  psf_model: str =
+0002b520: 2022 454c 4c42 4554 4122 2c0a 2020 2020   "ELLBETA",.    
+0002b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b540: 2020 2070 7366 5f62 696e 733a 2069 6e74     psf_bins: int
+0002b550: 203d 2034 2c20 7073 665f 616c 676f 3a20   = 4, psf_algo: 
+0002b560: 7374 7220 3d20 2272 6c22 2c20 7073 665f  str = "rl", psf_
+0002b570: 6974 6572 3a20 696e 7420 3d20 3135 2920  iter: int = 15) 
+0002b580: 5c0a 2020 2020 2020 2020 2020 2020 2d3e  \.            ->
+0002b590: 2055 6e69 6f6e 5b49 6d61 6765 2c20 4578   Union[Image, Ex
+0002b5a0: 704d 6170 2c20 5261 7465 4d61 702c 204c  pMap, RateMap, L
+0002b5b0: 6973 745b 496d 6167 655d 2c20 4c69 7374  ist[Image], List
+0002b5c0: 5b45 7870 4d61 705d 2c20 4c69 7374 5b52  [ExpMap], List[R
+0002b5d0: 6174 654d 6170 5d5d 3a0a 2020 2020 2020  ateMap]]:.      
+0002b5e0: 2020 2222 220a 2020 2020 2020 2020 416e    """.        An
+0002b5f0: 2069 6e74 6572 6e61 6c20 6d65 7468 6f64   internal method
+0002b600: 2077 6869 6368 2069 7320 7468 6520 6261   which is the ba
+0002b610: 7369 7320 6f66 2074 6865 2067 6574 5f69  sis of the get_i
+0002b620: 6d61 6765 732c 2067 6574 5f65 7870 6d61  mages, get_expma
+0002b630: 7073 2c20 616e 6420 6765 745f 7261 7465  ps, and get_rate
+0002b640: 6d61 7073 206d 6574 686f 6473 2e0a 0a20  maps methods... 
+0002b650: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+0002b660: 7220 6f62 735f 6964 3a20 4f70 7469 6f6e  r obs_id: Option
+0002b670: 616c 6c79 2c20 6120 7370 6563 6966 6963  ally, a specific
+0002b680: 206f 6273 5f69 6420 746f 2073 6561 7263   obs_id to searc
+0002b690: 6820 666f 7220 6361 6e20 6265 2073 7570  h for can be sup
+0002b6a0: 706c 6965 642e 2054 6865 2064 6566 6175  plied. The defau
+0002b6b0: 6c74 2069 7320 4e6f 6e65 2c0a 2020 2020  lt is None,.    
+0002b6c0: 2020 2020 2020 2020 7768 6963 6820 6d65          which me
+0002b6d0: 616e 7320 616c 6c20 696d 6167 6573 2f65  ans all images/e
+0002b6e0: 7870 6d61 7073 2f72 6174 656d 6170 7320  xpmaps/ratemaps 
+0002b6f0: 6d61 7463 6869 6e67 2074 6865 206f 7468  matching the oth
+0002b700: 6572 2063 7269 7465 7269 6120 7769 6c6c  er criteria will
+0002b710: 2062 6520 7265 7475 726e 6564 2e0a 2020   be returned..  
+0002b720: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
+0002b730: 2069 6e73 743a 204f 7074 696f 6e61 6c6c   inst: Optionall
+0002b740: 792c 2061 2073 7065 6369 6669 6320 696e  y, a specific in
+0002b750: 7374 7275 6d65 6e74 2074 6f20 7365 6172  strument to sear
+0002b760: 6368 2066 6f72 2063 616e 2062 6520 7375  ch for can be su
+0002b770: 7070 6c69 6564 2e20 5468 6520 6465 6661  pplied. The defa
+0002b780: 756c 7420 6973 204e 6f6e 652c 0a20 2020  ult is None,.   
+0002b790: 2020 2020 2020 2020 2077 6869 6368 206d           which m
+0002b7a0: 6561 6e73 2061 6c6c 2069 6d61 6765 732f  eans all images/
+0002b7b0: 6578 706d 6170 732f 7261 7465 6d61 7073  expmaps/ratemaps
+0002b7c0: 206d 6174 6368 696e 6720 7468 6520 6f74   matching the ot
+0002b7d0: 6865 7220 6372 6974 6572 6961 2077 696c  her criteria wil
+0002b7e0: 6c20 6265 2072 6574 7572 6e65 642e 0a20  l be returned.. 
+0002b7f0: 2020 2020 2020 203a 7061 7261 6d20 5175         :param Qu
+0002b800: 616e 7469 7479 206c 6f5f 656e 3a20 5468  antity lo_en: Th
+0002b810: 6520 6c6f 7765 7220 656e 6572 6779 206c  e lower energy l
+0002b820: 696d 6974 206f 6620 7468 6520 696d 6167  imit of the imag
+0002b830: 6573 2f65 7870 6d61 7073 2f72 6174 656d  es/expmaps/ratem
+0002b840: 6170 7320 796f 7520 7769 7368 2074 6f0a  aps you wish to.
+0002b850: 2020 2020 2020 2020 2020 2020 7265 7472              retr
+0002b860: 6965 7665 2c20 7468 6520 6465 6661 756c  ieve, the defaul
+0002b870: 7420 6973 204e 6f6e 6520 2877 6869 6368  t is None (which
+0002b880: 2077 696c 6c20 7265 7472 6965 7665 2061   will retrieve a
+0002b890: 6c6c 2069 6d61 6765 732f 6578 706d 6170  ll images/expmap
+0002b8a0: 732f 7261 7465 6d61 7073 2072 6567 6172  s/ratemaps regar
+0002b8b0: 646c 6573 7320 6f66 0a20 2020 2020 2020  dless of.       
+0002b8c0: 2020 2020 2065 6e65 7267 7920 6c69 6d69       energy limi
+0002b8d0: 7429 2e0a 2020 2020 2020 2020 3a70 6172  t)..        :par
+0002b8e0: 616d 2051 7561 6e74 6974 7920 6869 5f65  am Quantity hi_e
+0002b8f0: 6e3a 2054 6865 2075 7070 6572 2065 6e65  n: The upper ene
+0002b900: 7267 7920 6c69 6d69 7420 6f66 2074 6865  rgy limit of the
+0002b910: 2069 6d61 6765 732f 6578 706d 6170 732f   images/expmaps/
+0002b920: 7261 7465 6d61 7073 2079 6f75 2077 6973  ratemaps you wis
+0002b930: 6820 746f 0a20 2020 2020 2020 2020 2020  h to.           
+0002b940: 2072 6574 7269 6576 652c 2074 6865 2064   retrieve, the d
+0002b950: 6566 6175 6c74 2069 7320 4e6f 6e65 2028  efault is None (
+0002b960: 7768 6963 6820 7769 6c6c 2072 6574 7269  which will retri
+0002b970: 6576 6520 616c 6c20 696d 6167 6573 2f65  eve all images/e
+0002b980: 7870 6d61 7073 2f72 6174 656d 6170 7320  xpmaps/ratemaps 
+0002b990: 7265 6761 7264 6c65 7373 206f 660a 2020  regardless of.  
+0002b9a0: 2020 2020 2020 2020 2020 656e 6572 6779            energy
+0002b9b0: 206c 696d 6974 292e 0a20 2020 2020 2020   limit)..       
+0002b9c0: 203a 7061 7261 6d20 626f 6f6c 2070 7366   :param bool psf
+0002b9d0: 5f63 6f72 723a 2053 6574 7320 7768 6574  _corr: Sets whet
+0002b9e0: 6865 7220 796f 7520 7769 7368 2074 6f20  her you wish to 
+0002b9f0: 7265 7472 6965 7665 2061 2050 5346 2063  retrieve a PSF c
+0002ba00: 6f72 7265 6374 6564 2069 6d61 6765 732f  orrected images/
+0002ba10: 7261 7465 6d61 7073 206f 7220 6e6f 742e  ratemaps or not.
 0002ba20: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0002ba30: 696e 7420 7073 665f 6974 6572 3a20 4966  int psf_iter: If
-0002ba40: 2074 6865 2069 6d61 6765 732f 7261 7465   the images/rate
-0002ba50: 6d61 7073 2079 6f75 2077 616e 7420 6172  maps you want ar
-0002ba60: 6520 5053 4620 636f 7272 6563 7465 642c  e PSF corrected,
-0002ba70: 2074 6869 7320 6973 2074 6865 206e 756d   this is the num
-0002ba80: 6265 7220 6f66 2069 7465 7261 7469 6f6e  ber of iteration
-0002ba90: 732e 0a20 2020 2020 2020 203a 7265 7475  s..        :retu
-0002baa0: 726e 3a20 416e 2058 4741 2049 6d61 6765  rn: An XGA Image
-0002bab0: 2f52 6174 654d 6170 2f45 7870 4d61 7020  /RateMap/ExpMap 
-0002bac0: 6f62 6a65 6374 2028 6966 2074 6865 7265  object (if there
-0002bad0: 2069 7320 616e 2065 7861 6374 206d 6174   is an exact mat
-0002bae0: 6368 292c 206f 7220 6120 6c69 7374 206f  ch), or a list o
-0002baf0: 6620 5847 410a 2020 2020 2020 2020 2020  f XGA.          
-0002bb00: 2020 496d 6167 652f 5261 7465 4d61 702f    Image/RateMap/
-0002bb10: 4578 704d 6170 206f 626a 6563 7473 2028  ExpMap objects (
-0002bb20: 6966 2074 6865 7265 2077 6572 6520 6d75  if there were mu
-0002bb30: 6c74 6970 6c65 206d 6174 6368 696e 6720  ltiple matching 
-0002bb40: 7072 6f64 7563 7473 292e 0a20 2020 2020  products)..     
-0002bb50: 2020 203a 7274 7970 653a 2055 6e69 6f6e     :rtype: Union
-0002bb60: 5b49 6d61 6765 2c20 4578 704d 6170 2c20  [Image, ExpMap, 
-0002bb70: 5261 7465 4d61 702c 204c 6973 745b 496d  RateMap, List[Im
-0002bb80: 6167 655d 2c20 4c69 7374 5b45 7870 4d61  age], List[ExpMa
-0002bb90: 705d 2c20 4c69 7374 5b52 6174 654d 6170  p], List[RateMap
-0002bba0: 5d5d 0a20 2020 2020 2020 2022 2222 0a20  ]].        """. 
-0002bbb0: 2020 2020 2020 2023 2043 6865 636b 7320         # Checks 
-0002bbc0: 746f 206d 616b 6520 7375 7265 2074 6861  to make sure tha
-0002bbd0: 7420 616e 2061 6c6c 6f77 6564 2063 6f6d  t an allowed com
-0002bbe0: 6269 6e61 7469 6f6e 206f 6620 6c6f 5f65  bination of lo_e
-0002bbf0: 6e20 616e 6420 6869 5f65 6e20 6861 7320  n and hi_en has 
-0002bc00: 6265 656e 2070 6173 7365 642e 0a20 2020  been passed..   
-0002bc10: 2020 2020 2069 6620 616c 6c28 5b6c 6f5f       if all([lo_
-0002bc20: 656e 2069 7320 4e6f 6e65 2c20 6869 5f65  en is None, hi_e
-0002bc30: 6e20 6973 204e 6f6e 655d 293a 0a20 2020  n is None]):.   
-0002bc40: 2020 2020 2020 2020 2023 2053 6574 7320           # Sets 
-0002bc50: 6120 666c 6167 2074 6f20 7465 6c6c 2074  a flag to tell t
-0002bc60: 6865 2072 6573 7420 6f66 2074 6865 206d  he rest of the m
-0002bc70: 6574 686f 6420 7768 6574 6865 7220 7765  ethod whether we
-0002bc80: 2068 6176 6520 656e 6572 6779 206c 696d   have energy lim
-0002bc90: 7320 6f72 206e 6f74 0a20 2020 2020 2020  s or not.       
-0002bca0: 2020 2020 2077 6974 685f 6c69 6d73 203d       with_lims =
-0002bcb0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-0002bcc0: 2020 2065 6e65 7267 795f 6b65 7920 3d20     energy_key = 
-0002bcd0: 4e6f 6e65 0a20 2020 2020 2020 2065 6c69  None.        eli
-0002bce0: 6620 616c 6c28 5b6c 6f5f 656e 2069 7320  f all([lo_en is 
-0002bcf0: 6e6f 7420 4e6f 6e65 2c20 6869 5f65 6e20  not None, hi_en 
-0002bd00: 6973 206e 6f74 204e 6f6e 655d 293a 0a20  is not None]):. 
-0002bd10: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-0002bd20: 6c69 6d73 203d 2054 7275 650a 2020 2020  lims = True.    
-0002bd30: 2020 2020 2020 2020 2320 5765 2068 6176          # We hav
-0002bd40: 6520 656e 6572 6779 206c 696d 6974 7320  e energy limits 
-0002bd50: 6865 7265 2073 6f20 7765 2061 7373 656d  here so we assem
-0002bd60: 626c 6520 7468 6520 6b65 7920 7468 6174  ble the key that
-0002bd70: 2064 6573 6372 6962 6573 2074 6865 2065   describes the e
-0002bd80: 6e65 7267 7920 7261 6e67 650a 2020 2020  nergy range.    
-0002bd90: 2020 2020 2020 2020 656e 6572 6779 5f6b          energy_k
-0002bda0: 6579 203d 2022 626f 756e 645f 7b6c 7d2d  ey = "bound_{l}-
-0002bdb0: 7b68 7d22 2e66 6f72 6d61 7428 6c3d 6c6f  {h}".format(l=lo
-0002bdc0: 5f65 6e2e 746f 2827 6b65 5627 292e 7661  _en.to('keV').va
-0002bdd0: 6c75 652c 2068 3d68 695f 656e 2e74 6f28  lue, h=hi_en.to(
-0002bde0: 276b 6556 2729 2e76 616c 7565 290a 2020  'keV').value).  
-0002bdf0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002be00: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0002be10: 6c75 6545 7272 6f72 2822 6c6f 5f65 6e20  lueError("lo_en 
-0002be20: 616e 6420 6869 5f65 6e20 6d75 7374 2062  and hi_en must b
-0002be30: 6520 6569 7468 6572 2042 4f54 4820 4e6f  e either BOTH No
-0002be40: 6e65 206f 7220 424f 5448 2061 6e20 4173  ne or BOTH an As
-0002be50: 7472 6f70 7920 7175 616e 7469 7479 2e22  tropy quantity."
-0002be60: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
-0002be70: 7765 2061 7265 206c 6f6f 6b69 6e67 2066  we are looking f
-0002be80: 6f72 2061 2050 5346 2063 6f72 7265 6374  or a PSF correct
-0002be90: 6564 2069 6d61 6765 2f72 6174 656d 6170  ed image/ratemap
-0002bea0: 2074 6865 6e20 7765 2061 7373 656d 626c   then we assembl
-0002beb0: 6520 7468 6520 6578 7472 6120 6b65 7920  e the extra key 
-0002bec0: 7769 7468 2050 5346 2064 6574 6169 6c73  with PSF details
-0002bed0: 0a20 2020 2020 2020 2069 6620 7073 665f  .        if psf_
-0002bee0: 636f 7272 2061 6e64 2070 726f 645f 7479  corr and prod_ty
-0002bef0: 7065 2069 6e20 5b22 696d 6167 6522 2c20  pe in ["image", 
-0002bf00: 2272 6174 656d 6170 225d 3a0a 2020 2020  "ratemap"]:.    
-0002bf10: 2020 2020 2020 2020 6578 7472 615f 6b65          extra_ke
-0002bf20: 7920 3d20 225f 2220 2b20 7073 665f 6d6f  y = "_" + psf_mo
-0002bf30: 6465 6c20 2b20 225f 2220 2b20 7374 7228  del + "_" + str(
-0002bf40: 7073 665f 6269 6e73 2920 2b20 225f 2220  psf_bins) + "_" 
-0002bf50: 2b20 7073 665f 616c 676f 202b 2073 7472  + psf_algo + str
-0002bf60: 2870 7366 5f69 7465 7229 0a0a 2020 2020  (psf_iter)..    
-0002bf70: 2020 2020 6966 206e 6f74 2070 7366 5f63      if not psf_c
-0002bf80: 6f72 7220 616e 6420 7769 7468 5f6c 696d  orr and with_lim
-0002bf90: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-0002bfa0: 2053 696d 706c 6573 7420 6361 7365 2c20   Simplest case, 
-0002bfb0: 6a75 7374 2063 616c 6c69 6e67 2067 6574  just calling get
-0002bfc0: 5f70 726f 6475 6374 7320 616e 6420 7061  _products and pa
-0002bfd0: 7373 696e 6720 696e 206f 7572 2069 6e66  ssing in our inf
-0002bfe0: 6f72 6d61 7469 6f6e 0a20 2020 2020 2020  ormation.       
-0002bff0: 2020 2020 206d 6174 6368 6564 5f70 726f       matched_pro
-0002c000: 6473 203d 2073 656c 662e 6765 745f 7072  ds = self.get_pr
-0002c010: 6f64 7563 7473 2870 726f 645f 7479 7065  oducts(prod_type
-0002c020: 2c20 6f62 735f 6964 2c20 696e 7374 2c20  , obs_id, inst, 
-0002c030: 6578 7472 615f 6b65 793d 656e 6572 6779  extra_key=energy
-0002c040: 5f6b 6579 290a 2020 2020 2020 2020 656c  _key).        el
-0002c050: 6966 206e 6f74 2070 7366 5f63 6f72 7220  if not psf_corr 
-0002c060: 616e 6420 6e6f 7420 7769 7468 5f6c 696d  and not with_lim
-0002c070: 733a 0a20 2020 2020 2020 2020 2020 2062  s:.            b
-0002c080: 726f 6164 5f6d 6174 6368 6573 203d 2073  road_matches = s
-0002c090: 656c 662e 6765 745f 7072 6f64 7563 7473  elf.get_products
-0002c0a0: 2870 726f 645f 7479 7065 2c20 6f62 735f  (prod_type, obs_
-0002c0b0: 6964 2c20 696e 7374 290a 2020 2020 2020  id, inst).      
-0002c0c0: 2020 2020 2020 6d61 7463 6865 645f 7072        matched_pr
-0002c0d0: 6f64 7320 3d20 5b70 2066 6f72 2070 2069  ods = [p for p i
-0002c0e0: 6e20 6272 6f61 645f 6d61 7463 6865 7320  n broad_matches 
-0002c0f0: 6966 206e 6f74 2070 2e70 7366 5f63 6f72  if not p.psf_cor
-0002c100: 7265 6374 6564 5d0a 2020 2020 2020 2020  rected].        
-0002c110: 656c 6966 2070 7366 5f63 6f72 7220 616e  elif psf_corr an
-0002c120: 6420 7769 7468 5f6c 696d 733a 0a20 2020  d with_lims:.   
-0002c130: 2020 2020 2020 2020 2023 2048 6572 6520           # Here 
-0002c140: 7765 206e 6565 6420 746f 2061 6464 2074  we need to add t
-0002c150: 6865 2065 7874 7261 206b 6579 2074 6f20  he extra key to 
-0002c160: 7468 6520 656e 6572 6779 206b 6579 0a20  the energy key. 
-0002c170: 2020 2020 2020 2020 2020 206d 6174 6368             match
-0002c180: 6564 5f70 726f 6473 203d 2073 656c 662e  ed_prods = self.
-0002c190: 6765 745f 7072 6f64 7563 7473 2870 726f  get_products(pro
-0002c1a0: 645f 7479 7065 2c20 6f62 735f 6964 2c20  d_type, obs_id, 
-0002c1b0: 696e 7374 2c20 6578 7472 615f 6b65 793d  inst, extra_key=
-0002c1c0: 656e 6572 6779 5f6b 6579 202b 2065 7874  energy_key + ext
-0002c1d0: 7261 5f6b 6579 290a 2020 2020 2020 2020  ra_key).        
-0002c1e0: 656c 6966 2070 7366 5f63 6f72 7220 616e  elif psf_corr an
-0002c1f0: 6420 6e6f 7420 7769 7468 5f6c 696d 733a  d not with_lims:
-0002c200: 0a20 2020 2020 2020 2020 2020 2023 2048  .            # H
-0002c210: 6572 6520 7765 2064 6f6e 2774 206b 6e6f  ere we don't kno
-0002c220: 7720 7468 6520 656e 6572 6779 206b 6579  w the energy key
-0002c230: 2c20 736f 2077 6520 6861 7665 2074 6f20  , so we have to 
-0002c240: 6c6f 6f6b 2066 6f72 2070 6172 7469 616c  look for partial
-0002c250: 206d 6174 6368 6573 2069 6e20 7468 6520   matches in the 
-0002c260: 6765 745f 7072 6f64 7563 7473 2072 6574  get_products ret
-0002c270: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
-0002c280: 6272 6f61 645f 6d61 7463 6865 7320 3d20  broad_matches = 
-0002c290: 7365 6c66 2e67 6574 5f70 726f 6475 6374  self.get_product
-0002c2a0: 7328 7072 6f64 5f74 7970 652c 206f 6273  s(prod_type, obs
-0002c2b0: 5f69 642c 2069 6e73 742c 2065 7874 7261  _id, inst, extra
-0002c2c0: 5f6b 6579 3d4e 6f6e 652c 206a 7573 745f  _key=None, just_
-0002c2d0: 6f62 6a3d 4661 6c73 6529 0a20 2020 2020  obj=False).     
-0002c2e0: 2020 2020 2020 206d 6174 6368 6564 5f70         matched_p
-0002c2f0: 726f 6473 203d 205b 705b 2d31 5d20 666f  rods = [p[-1] fo
-0002c300: 7220 7020 696e 2062 726f 6164 5f6d 6174  r p in broad_mat
-0002c310: 6368 6573 2069 6620 6578 7472 615f 6b65  ches if extra_ke
-0002c320: 7920 696e 2070 5b2d 325d 5d0a 0a20 2020  y in p[-2]]..   
-0002c330: 2020 2020 2069 6620 6c65 6e28 6d61 7463       if len(matc
-0002c340: 6865 645f 7072 6f64 7329 203d 3d20 313a  hed_prods) == 1:
-0002c350: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
-0002c360: 6368 6564 5f70 726f 6473 203d 206d 6174  ched_prods = mat
-0002c370: 6368 6564 5f70 726f 6473 5b30 5d0a 2020  ched_prods[0].  
-0002c380: 2020 2020 2020 656c 6966 206c 656e 286d        elif len(m
-0002c390: 6174 6368 6564 5f70 726f 6473 2920 3d3d  atched_prods) ==
-0002c3a0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0002c3b0: 7261 6973 6520 4e6f 5072 6f64 7563 7441  raise NoProductA
-0002c3c0: 7661 696c 6162 6c65 4572 726f 7228 2243  vailableError("C
-0002c3d0: 616e 6e6f 7420 6669 6e64 2061 6e79 207b  annot find any {
-0002c3e0: 707d 7320 6d61 7463 6869 6e67 2079 6f75  p}s matching you
-0002c3f0: 7220 696e 7075 742e 222e 666f 726d 6174  r input.".format
-0002c400: 2870 3d70 726f 645f 7479 7065 2929 0a0a  (p=prod_type))..
-0002c410: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0002c420: 6174 6368 6564 5f70 726f 6473 0a0a 2020  atched_prods..  
-0002c430: 2020 6465 6620 6765 745f 696d 6167 6573    def get_images
-0002c440: 2873 656c 662c 206f 6273 5f69 643a 2073  (self, obs_id: s
-0002c450: 7472 203d 204e 6f6e 652c 2069 6e73 743a  tr = None, inst:
-0002c460: 2073 7472 203d 204e 6f6e 652c 206c 6f5f   str = None, lo_
-0002c470: 656e 3a20 5175 616e 7469 7479 203d 204e  en: Quantity = N
-0002c480: 6f6e 652c 2068 695f 656e 3a20 5175 616e  one, hi_en: Quan
-0002c490: 7469 7479 203d 204e 6f6e 652c 0a20 2020  tity = None,.   
-0002c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c4b0: 7073 665f 636f 7272 3a20 626f 6f6c 203d  psf_corr: bool =
-0002c4c0: 2046 616c 7365 2c20 7073 665f 6d6f 6465   False, psf_mode
-0002c4d0: 6c3a 2073 7472 203d 2022 454c 4c42 4554  l: str = "ELLBET
-0002c4e0: 4122 2c20 7073 665f 6269 6e73 3a20 696e  A", psf_bins: in
-0002c4f0: 7420 3d20 342c 2070 7366 5f61 6c67 6f3a  t = 4, psf_algo:
-0002c500: 2073 7472 203d 2022 726c 222c 0a20 2020   str = "rl",.   
-0002c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c520: 7073 665f 6974 6572 3a20 696e 7420 3d20  psf_iter: int = 
-0002c530: 3135 2920 2d3e 2055 6e69 6f6e 5b49 6d61  15) -> Union[Ima
-0002c540: 6765 2c20 4c69 7374 5b49 6d61 6765 5d5d  ge, List[Image]]
-0002c550: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0002c560: 2020 2020 2020 4120 6d65 7468 6f64 2074        A method t
-0002c570: 6f20 7265 7472 6965 7665 2058 4741 2049  o retrieve XGA I
-0002c580: 6d61 6765 206f 626a 6563 7473 2e20 5468  mage objects. Th
-0002c590: 6973 2073 7570 706f 7274 7320 7468 6520  is supports the 
-0002c5a0: 7265 7472 6965 7661 6c20 6f66 2062 6f74  retrieval of bot
-0002c5b0: 6820 5053 4620 636f 7272 6563 7465 6420  h PSF corrected 
-0002c5c0: 616e 6420 6e6f 6e2d 5053 460a 2020 2020  and non-PSF.    
-0002c5d0: 2020 2020 636f 7272 6563 7465 6420 696d      corrected im
-0002c5e0: 6167 6573 2c20 6173 2077 656c 6c20 6173  ages, as well as
-0002c5f0: 2073 6574 7469 6e67 2074 6865 2065 6e65   setting the ene
-0002c600: 7267 7920 6c69 6d69 7473 206f 6620 7468  rgy limits of th
-0002c610: 6520 7370 6563 6966 6963 2069 6d61 6765  e specific image
-0002c620: 2079 6f75 2077 6f75 6c64 206c 696b 652e   you would like.
-0002c630: 2041 0a20 2020 2020 2020 204e 6f50 726f   A.        NoPro
-0002c640: 6475 6374 4176 6169 6c61 626c 6545 7272  ductAvailableErr
-0002c650: 6f72 2065 7272 6f72 2077 696c 6c20 6265  or error will be
-0002c660: 2072 6169 7365 6420 6966 206e 6f20 6d61   raised if no ma
-0002c670: 7463 6865 7320 6172 6520 666f 756e 642e  tches are found.
-0002c680: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0002c690: 2073 7472 206f 6273 5f69 643a 204f 7074   str obs_id: Opt
-0002c6a0: 696f 6e61 6c6c 792c 2061 2073 7065 6369  ionally, a speci
-0002c6b0: 6669 6320 6f62 735f 6964 2074 6f20 7365  fic obs_id to se
-0002c6c0: 6172 6368 2066 6f72 2063 616e 2062 6520  arch for can be 
-0002c6d0: 7375 7070 6c69 6564 2e20 5468 6520 6465  supplied. The de
-0002c6e0: 6661 756c 7420 6973 204e 6f6e 652c 0a20  fault is None,. 
-0002c6f0: 2020 2020 2020 2020 2020 2077 6869 6368             which
-0002c700: 206d 6561 6e73 2061 6c6c 2069 6d61 6765   means all image
-0002c710: 7320 6d61 7463 6869 6e67 2074 6865 206f  s matching the o
-0002c720: 7468 6572 2063 7269 7465 7269 6120 7769  ther criteria wi
-0002c730: 6c6c 2062 6520 7265 7475 726e 6564 2e0a  ll be returned..
-0002c740: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0002c750: 7472 2069 6e73 743a 204f 7074 696f 6e61  tr inst: Optiona
-0002c760: 6c6c 792c 2061 2073 7065 6369 6669 6320  lly, a specific 
-0002c770: 696e 7374 7275 6d65 6e74 2074 6f20 7365  instrument to se
-0002c780: 6172 6368 2066 6f72 2063 616e 2062 6520  arch for can be 
-0002c790: 7375 7070 6c69 6564 2e20 5468 6520 6465  supplied. The de
-0002c7a0: 6661 756c 7420 6973 204e 6f6e 652c 0a20  fault is None,. 
-0002c7b0: 2020 2020 2020 2020 2020 2077 6869 6368             which
-0002c7c0: 206d 6561 6e73 2061 6c6c 2069 6d61 6765   means all image
-0002c7d0: 7320 6d61 7463 6869 6e67 2074 6865 206f  s matching the o
-0002c7e0: 7468 6572 2063 7269 7465 7269 6120 7769  ther criteria wi
-0002c7f0: 6c6c 2062 6520 7265 7475 726e 6564 2e0a  ll be returned..
-0002c800: 2020 2020 2020 2020 3a70 6172 616d 2051          :param Q
-0002c810: 7561 6e74 6974 7920 6c6f 5f65 6e3a 2054  uantity lo_en: T
-0002c820: 6865 206c 6f77 6572 2065 6e65 7267 7920  he lower energy 
-0002c830: 6c69 6d69 7420 6f66 2074 6865 2069 6d61  limit of the ima
-0002c840: 6765 2079 6f75 2077 6973 6820 746f 2072  ge you wish to r
-0002c850: 6574 7269 6576 652c 2074 6865 2064 6566  etrieve, the def
-0002c860: 6175 6c74 0a20 2020 2020 2020 2020 2020  ault.           
-0002c870: 2069 7320 4e6f 6e65 2028 7768 6963 6820   is None (which 
-0002c880: 7769 6c6c 2072 6574 7269 6576 6520 616c  will retrieve al
-0002c890: 6c20 696d 6167 6573 2072 6567 6172 646c  l images regardl
-0002c8a0: 6573 7320 6f66 2065 6e65 7267 7920 6c69  ess of energy li
-0002c8b0: 6d69 7429 2e0a 2020 2020 2020 2020 3a70  mit)..        :p
-0002c8c0: 6172 616d 2051 7561 6e74 6974 7920 6869  aram Quantity hi
-0002c8d0: 5f65 6e3a 2054 6865 2075 7070 6572 2065  _en: The upper e
-0002c8e0: 6e65 7267 7920 6c69 6d69 7420 6f66 2074  nergy limit of t
-0002c8f0: 6865 2069 6d61 6765 2079 6f75 2077 6973  he image you wis
-0002c900: 6820 746f 2072 6574 7269 6576 652c 2074  h to retrieve, t
-0002c910: 6865 2064 6566 6175 6c74 0a20 2020 2020  he default.     
-0002c920: 2020 2020 2020 2069 7320 4e6f 6e65 2028         is None (
-0002c930: 7768 6963 6820 7769 6c6c 2072 6574 7269  which will retri
-0002c940: 6576 6520 616c 6c20 696d 6167 6573 2072  eve all images r
-0002c950: 6567 6172 646c 6573 7320 6f66 2065 6e65  egardless of ene
-0002c960: 7267 7920 6c69 6d69 7429 2e0a 2020 2020  rgy limit)..    
-0002c970: 2020 2020 3a70 6172 616d 2062 6f6f 6c20      :param bool 
-0002c980: 7073 665f 636f 7272 3a20 5365 7473 2077  psf_corr: Sets w
-0002c990: 6865 7468 6572 2079 6f75 2077 6973 6820  hether you wish 
-0002c9a0: 746f 2072 6574 7269 6576 6520 6120 5053  to retrieve a PS
-0002c9b0: 4620 636f 7272 6563 7465 6420 696d 6167  F corrected imag
-0002c9c0: 6520 6f72 206e 6f74 2e0a 2020 2020 2020  e or not..      
-0002c9d0: 2020 3a70 6172 616d 2073 7472 2070 7366    :param str psf
-0002c9e0: 5f6d 6f64 656c 3a20 4966 2074 6865 2069  _model: If the i
-0002c9f0: 6d61 6765 2079 6f75 2077 616e 7420 6973  mage you want is
-0002ca00: 2050 5346 2063 6f72 7265 6374 6564 2c20   PSF corrected, 
-0002ca10: 7468 6973 2069 7320 7468 6520 5053 4620  this is the PSF 
-0002ca20: 6d6f 6465 6c20 7573 6564 2e0a 2020 2020  model used..    
-0002ca30: 2020 2020 3a70 6172 616d 2069 6e74 2070      :param int p
-0002ca40: 7366 5f62 696e 733a 2049 6620 7468 6520  sf_bins: If the 
-0002ca50: 696d 6167 6520 796f 7520 7761 6e74 2069  image you want i
-0002ca60: 7320 5053 4620 636f 7272 6563 7465 642c  s PSF corrected,
-0002ca70: 2074 6869 7320 6973 2074 6865 206e 756d   this is the num
-0002ca80: 6265 7220 6f66 2050 5346 7320 7065 720a  ber of PSFs per.
-0002ca90: 2020 2020 2020 2020 2020 2020 7369 6465              side
-0002caa0: 2069 6e20 7468 6520 5053 4620 6772 6964   in the PSF grid
-0002cab0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0002cac0: 2073 7472 2070 7366 5f61 6c67 6f3a 2049   str psf_algo: I
-0002cad0: 6620 7468 6520 696d 6167 6520 796f 7520  f the image you 
-0002cae0: 7761 6e74 2069 7320 5053 4620 636f 7272  want is PSF corr
-0002caf0: 6563 7465 642c 2074 6869 7320 6973 2074  ected, this is t
-0002cb00: 6865 2061 6c67 6f72 6974 686d 2075 7365  he algorithm use
-0002cb10: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
-0002cb20: 6d20 696e 7420 7073 665f 6974 6572 3a20  m int psf_iter: 
-0002cb30: 4966 2074 6865 2069 6d61 6765 2079 6f75  If the image you
-0002cb40: 2077 616e 7420 6973 2050 5346 2063 6f72   want is PSF cor
-0002cb50: 7265 6374 6564 2c20 7468 6973 2069 7320  rected, this is 
-0002cb60: 7468 6520 6e75 6d62 6572 206f 6620 6974  the number of it
-0002cb70: 6572 6174 696f 6e73 2e0a 2020 2020 2020  erations..      
-0002cb80: 2020 3a72 6574 7572 6e3a 2041 6e20 5847    :return: An XG
-0002cb90: 4120 496d 6167 6520 6f62 6a65 6374 2028  A Image object (
-0002cba0: 6966 2074 6865 7265 2069 7320 616e 2065  if there is an e
-0002cbb0: 7861 6374 206d 6174 6368 292c 206f 7220  xact match), or 
-0002cbc0: 6120 6c69 7374 206f 6620 5847 4120 496d  a list of XGA Im
-0002cbd0: 6167 6520 6f62 6a65 6374 7320 2869 6620  age objects (if 
-0002cbe0: 7468 6572 650a 2020 2020 2020 2020 2020  there.          
-0002cbf0: 2020 7765 7265 206d 756c 7469 706c 6520    were multiple 
-0002cc00: 6d61 7463 6869 6e67 2070 726f 6475 6374  matching product
-0002cc10: 7329 2e0a 2020 2020 2020 2020 3a72 7479  s)..        :rty
-0002cc20: 7065 3a20 556e 696f 6e5b 496d 6167 652c  pe: Union[Image,
-0002cc30: 204c 6973 745b 496d 6167 655d 5d0a 2020   List[Image]].  
-0002cc40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0002cc50: 2020 7265 7475 726e 2073 656c 662e 5f67    return self._g
-0002cc60: 6574 5f70 686f 745f 7072 6f64 2822 696d  et_phot_prod("im
-0002cc70: 6167 6522 2c20 6f62 735f 6964 2c20 696e  age", obs_id, in
-0002cc80: 7374 2c20 6c6f 5f65 6e2c 2068 695f 656e  st, lo_en, hi_en
-0002cc90: 2c20 7073 665f 636f 7272 2c20 7073 665f  , psf_corr, psf_
-0002cca0: 6d6f 6465 6c2c 2070 7366 5f62 696e 732c  model, psf_bins,
-0002ccb0: 2070 7366 5f61 6c67 6f2c 0a20 2020 2020   psf_algo,.     
-0002ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ccd0: 2020 2020 2020 2020 2020 2020 2020 7073                ps
-0002cce0: 665f 6974 6572 290a 0a20 2020 2064 6566  f_iter)..    def
-0002ccf0: 2067 6574 5f65 7870 6d61 7073 2873 656c   get_expmaps(sel
-0002cd00: 662c 206f 6273 5f69 643a 2073 7472 203d  f, obs_id: str =
-0002cd10: 204e 6f6e 652c 2069 6e73 743a 2073 7472   None, inst: str
-0002cd20: 203d 204e 6f6e 652c 206c 6f5f 656e 3a20   = None, lo_en: 
-0002cd30: 5175 616e 7469 7479 203d 204e 6f6e 652c  Quantity = None,
-0002cd40: 2068 695f 656e 3a20 5175 616e 7469 7479   hi_en: Quantity
-0002cd50: 203d 204e 6f6e 6529 205c 0a20 2020 2020   = None) \.     
-0002cd60: 2020 2020 2020 202d 3e20 556e 696f 6e5b         -> Union[
-0002cd70: 4578 704d 6170 2c20 4c69 7374 5b45 7870  ExpMap, List[Exp
-0002cd80: 4d61 705d 5d3a 0a20 2020 2020 2020 2022  Map]]:.        "
-0002cd90: 2222 0a20 2020 2020 2020 2041 206d 6574  "".        A met
-0002cda0: 686f 6420 746f 2072 6574 7269 6576 6520  hod to retrieve 
-0002cdb0: 5847 4120 4578 704d 6170 206f 626a 6563  XGA ExpMap objec
-0002cdc0: 7473 2e20 5468 6973 2073 7570 706f 7274  ts. This support
-0002cdd0: 7320 7365 7474 696e 6720 7468 6520 656e  s setting the en
-0002cde0: 6572 6779 206c 696d 6974 7320 6f66 2074  ergy limits of t
-0002cdf0: 6865 2073 7065 6369 6669 630a 2020 2020  he specific.    
-0002ce00: 2020 2020 6578 706f 7375 7265 206d 6170      exposure map
-0002ce10: 7320 796f 7520 776f 756c 6420 6c69 6b65  s you would like
-0002ce20: 2e20 4120 4e6f 5072 6f64 7563 7441 7661  . A NoProductAva
-0002ce30: 696c 6162 6c65 4572 726f 7220 6572 726f  ilableError erro
-0002ce40: 7220 7769 6c6c 2062 6520 7261 6973 6564  r will be raised
-0002ce50: 2069 6620 6e6f 206d 6174 6368 6573 2061   if no matches a
-0002ce60: 7265 2066 6f75 6e64 2e0a 0a20 2020 2020  re found...     
-0002ce70: 2020 203a 7061 7261 6d20 7374 7220 6f62     :param str ob
-0002ce80: 735f 6964 3a20 4f70 7469 6f6e 616c 6c79  s_id: Optionally
-0002ce90: 2c20 6120 7370 6563 6966 6963 206f 6273  , a specific obs
-0002cea0: 5f69 6420 746f 2073 6561 7263 6820 666f  _id to search fo
-0002ceb0: 7220 6361 6e20 6265 2073 7570 706c 6965  r can be supplie
-0002cec0: 642e 2054 6865 2064 6566 6175 6c74 2069  d. The default i
-0002ced0: 7320 4e6f 6e65 2c0a 2020 2020 2020 2020  s None,.        
-0002cee0: 2020 2020 7768 6963 6820 6d65 616e 7320      which means 
-0002cef0: 616c 6c20 6578 706f 7375 7265 206d 6170  all exposure map
-0002cf00: 7320 6d61 7463 6869 6e67 2074 6865 206f  s matching the o
-0002cf10: 7468 6572 2063 7269 7465 7269 6120 7769  ther criteria wi
-0002cf20: 6c6c 2062 6520 7265 7475 726e 6564 2e0a  ll be returned..
-0002cf30: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0002cf40: 7472 2069 6e73 743a 204f 7074 696f 6e61  tr inst: Optiona
-0002cf50: 6c6c 792c 2061 2073 7065 6369 6669 6320  lly, a specific 
-0002cf60: 696e 7374 7275 6d65 6e74 2074 6f20 7365  instrument to se
-0002cf70: 6172 6368 2066 6f72 2063 616e 2062 6520  arch for can be 
-0002cf80: 7375 7070 6c69 6564 2e20 5468 6520 6465  supplied. The de
-0002cf90: 6661 756c 7420 6973 204e 6f6e 652c 0a20  fault is None,. 
-0002cfa0: 2020 2020 2020 2020 2020 2077 6869 6368             which
-0002cfb0: 206d 6561 6e73 2061 6c6c 2065 7870 6f73   means all expos
-0002cfc0: 7572 6520 6d61 7073 206d 6174 6368 696e  ure maps matchin
-0002cfd0: 6720 7468 6520 6f74 6865 7220 6372 6974  g the other crit
-0002cfe0: 6572 6961 2077 696c 6c20 6265 2072 6574  eria will be ret
-0002cff0: 7572 6e65 642e 0a20 2020 2020 2020 203a  urned..        :
-0002d000: 7061 7261 6d20 5175 616e 7469 7479 206c  param Quantity l
-0002d010: 6f5f 656e 3a20 5468 6520 6c6f 7765 7220  o_en: The lower 
-0002d020: 656e 6572 6779 206c 696d 6974 206f 6620  energy limit of 
-0002d030: 7468 6520 6578 706f 7375 7265 206d 6170  the exposure map
-0002d040: 7320 796f 7520 7769 7368 2074 6f20 7265  s you wish to re
-0002d050: 7472 6965 7665 2c20 7468 6520 6465 6661  trieve, the defa
-0002d060: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
-0002d070: 6973 204e 6f6e 6520 2877 6869 6368 2077  is None (which w
-0002d080: 696c 6c20 7265 7472 6965 7665 2061 6c6c  ill retrieve all
-0002d090: 2069 6d61 6765 7320 7265 6761 7264 6c65   images regardle
-0002d0a0: 7373 206f 6620 656e 6572 6779 206c 696d  ss of energy lim
-0002d0b0: 6974 292e 0a20 2020 2020 2020 203a 7061  it)..        :pa
-0002d0c0: 7261 6d20 5175 616e 7469 7479 2068 695f  ram Quantity hi_
-0002d0d0: 656e 3a20 5468 6520 7570 7065 7220 656e  en: The upper en
-0002d0e0: 6572 6779 206c 696d 6974 206f 6620 7468  ergy limit of th
-0002d0f0: 6520 6578 706f 7375 7265 206d 6170 7320  e exposure maps 
-0002d100: 796f 7520 7769 7368 2074 6f20 7265 7472  you wish to retr
-0002d110: 6965 7665 2c20 7468 6520 6465 6661 756c  ieve, the defaul
-0002d120: 740a 2020 2020 2020 2020 2020 2020 6973  t.            is
-0002d130: 204e 6f6e 6520 2877 6869 6368 2077 696c   None (which wil
-0002d140: 6c20 7265 7472 6965 7665 2061 6c6c 2069  l retrieve all i
-0002d150: 6d61 6765 7320 7265 6761 7264 6c65 7373  mages regardless
-0002d160: 206f 6620 656e 6572 6779 206c 696d 6974   of energy limit
-0002d170: 292e 0a20 2020 2020 2020 203a 7265 7475  )..        :retu
-0002d180: 726e 3a20 416e 2058 4741 2045 7870 4d61  rn: An XGA ExpMa
-0002d190: 7020 6f62 6a65 6374 2028 6966 2074 6865  p object (if the
-0002d1a0: 7265 2069 7320 616e 2065 7861 6374 206d  re is an exact m
-0002d1b0: 6174 6368 292c 206f 7220 6120 6c69 7374  atch), or a list
-0002d1c0: 206f 6620 5847 4120 4578 704d 6170 206f   of XGA ExpMap o
-0002d1d0: 626a 6563 7473 2028 6966 2074 6865 7265  bjects (if there
-0002d1e0: 0a20 2020 2020 2020 2020 2020 2077 6572  .            wer
-0002d1f0: 6520 6d75 6c74 6970 6c65 206d 6174 6368  e multiple match
-0002d200: 696e 6720 7072 6f64 7563 7473 292e 0a20  ing products).. 
-0002d210: 2020 2020 2020 203a 7274 7970 653a 2055         :rtype: U
-0002d220: 6e69 6f6e 5b45 7870 4d61 702c 204c 6973  nion[ExpMap, Lis
-0002d230: 745b 4578 704d 6170 5d5d 0a20 2020 2020  t[ExpMap]].     
-0002d240: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0002d250: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
-0002d260: 7068 6f74 5f70 726f 6428 2265 7870 6d61  phot_prod("expma
-0002d270: 7022 2c20 6f62 735f 6964 2c20 696e 7374  p", obs_id, inst
-0002d280: 2c20 6c6f 5f65 6e2c 2068 695f 656e 2c20  , lo_en, hi_en, 
-0002d290: 4661 6c73 6529 0a0a 2020 2020 6465 6620  False)..    def 
-0002d2a0: 6765 745f 7261 7465 6d61 7073 2873 656c  get_ratemaps(sel
-0002d2b0: 662c 206f 6273 5f69 643a 2073 7472 203d  f, obs_id: str =
-0002d2c0: 204e 6f6e 652c 2069 6e73 743a 2073 7472   None, inst: str
-0002d2d0: 203d 204e 6f6e 652c 206c 6f5f 656e 3a20   = None, lo_en: 
-0002d2e0: 5175 616e 7469 7479 203d 204e 6f6e 652c  Quantity = None,
-0002d2f0: 2068 695f 656e 3a20 5175 616e 7469 7479   hi_en: Quantity
-0002d300: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0002d310: 2020 2020 2020 2020 2020 2020 2020 7073                ps
-0002d320: 665f 636f 7272 3a20 626f 6f6c 203d 2046  f_corr: bool = F
-0002d330: 616c 7365 2c20 7073 665f 6d6f 6465 6c3a  alse, psf_model:
-0002d340: 2073 7472 203d 2022 454c 4c42 4554 4122   str = "ELLBETA"
-0002d350: 2c20 7073 665f 6269 6e73 3a20 696e 7420  , psf_bins: int 
-0002d360: 3d20 342c 2070 7366 5f61 6c67 6f3a 2073  = 4, psf_algo: s
-0002d370: 7472 203d 2022 726c 222c 0a20 2020 2020  tr = "rl",.     
-0002d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d390: 7073 665f 6974 6572 3a20 696e 7420 3d20  psf_iter: int = 
-0002d3a0: 3135 2920 2d3e 2055 6e69 6f6e 5b52 6174  15) -> Union[Rat
-0002d3b0: 654d 6170 2c20 4c69 7374 5b52 6174 654d  eMap, List[RateM
-0002d3c0: 6170 5d5d 3a0a 2020 2020 2020 2020 2222  ap]]:.        ""
-0002d3d0: 220a 2020 2020 2020 2020 4120 6d65 7468  ".        A meth
-0002d3e0: 6f64 2074 6f20 7265 7472 6965 7665 2058  od to retrieve X
-0002d3f0: 4741 2052 6174 654d 6170 206f 626a 6563  GA RateMap objec
-0002d400: 7473 2e20 5468 6973 2073 7570 706f 7274  ts. This support
-0002d410: 7320 7468 6520 7265 7472 6965 7661 6c20  s the retrieval 
-0002d420: 6f66 2062 6f74 6820 5053 4620 636f 7272  of both PSF corr
-0002d430: 6563 7465 6420 616e 6420 6e6f 6e2d 5053  ected and non-PS
-0002d440: 460a 2020 2020 2020 2020 636f 7272 6563  F.        correc
-0002d450: 7465 6420 7261 7465 6d61 7073 2c20 6173  ted ratemaps, as
-0002d460: 2077 656c 6c20 6173 2073 6574 7469 6e67   well as setting
-0002d470: 2074 6865 2065 6e65 7267 7920 6c69 6d69   the energy limi
-0002d480: 7473 206f 6620 7468 6520 7370 6563 6966  ts of the specif
-0002d490: 6963 2072 6174 656d 6170 2079 6f75 2077  ic ratemap you w
-0002d4a0: 6f75 6c64 206c 696b 652e 2041 0a20 2020  ould like. A.   
-0002d4b0: 2020 2020 204e 6f50 726f 6475 6374 4176       NoProductAv
-0002d4c0: 6169 6c61 626c 6545 7272 6f72 2065 7272  ailableError err
-0002d4d0: 6f72 2077 696c 6c20 6265 2072 6169 7365  or will be raise
-0002d4e0: 6420 6966 206e 6f20 6d61 7463 6865 7320  d if no matches 
-0002d4f0: 6172 6520 666f 756e 642e 0a0a 2020 2020  are found...    
-0002d500: 2020 2020 3a70 6172 616d 2073 7472 206f      :param str o
-0002d510: 6273 5f69 643a 204f 7074 696f 6e61 6c6c  bs_id: Optionall
-0002d520: 792c 2061 2073 7065 6369 6669 6320 6f62  y, a specific ob
-0002d530: 735f 6964 2074 6f20 7365 6172 6368 2066  s_id to search f
-0002d540: 6f72 2063 616e 2062 6520 7375 7070 6c69  or can be suppli
-0002d550: 6564 2e20 5468 6520 6465 6661 756c 7420  ed. The default 
-0002d560: 6973 204e 6f6e 652c 0a20 2020 2020 2020  is None,.       
-0002d570: 2020 2020 2077 6869 6368 206d 6561 6e73       which means
-0002d580: 2061 6c6c 2072 6174 656d 6170 7320 6d61   all ratemaps ma
-0002d590: 7463 6869 6e67 2074 6865 206f 7468 6572  tching the other
-0002d5a0: 2063 7269 7465 7269 6120 7769 6c6c 2062   criteria will b
-0002d5b0: 6520 7265 7475 726e 6564 2e0a 2020 2020  e returned..    
-0002d5c0: 2020 2020 3a70 6172 616d 2073 7472 2069      :param str i
-0002d5d0: 6e73 743a 204f 7074 696f 6e61 6c6c 792c  nst: Optionally,
-0002d5e0: 2061 2073 7065 6369 6669 6320 696e 7374   a specific inst
-0002d5f0: 7275 6d65 6e74 2074 6f20 7365 6172 6368  rument to search
-0002d600: 2066 6f72 2063 616e 2062 6520 7375 7070   for can be supp
-0002d610: 6c69 6564 2e20 5468 6520 6465 6661 756c  lied. The defaul
-0002d620: 7420 6973 204e 6f6e 652c 0a20 2020 2020  t is None,.     
-0002d630: 2020 2020 2020 2077 6869 6368 206d 6561         which mea
-0002d640: 6e73 2061 6c6c 2072 6174 656d 6170 7320  ns all ratemaps 
-0002d650: 6d61 7463 6869 6e67 2074 6865 206f 7468  matching the oth
-0002d660: 6572 2063 7269 7465 7269 6120 7769 6c6c  er criteria will
-0002d670: 2062 6520 7265 7475 726e 6564 2e0a 2020   be returned..  
-0002d680: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
-0002d690: 6e74 6974 7920 6c6f 5f65 6e3a 2054 6865  ntity lo_en: The
-0002d6a0: 206c 6f77 6572 2065 6e65 7267 7920 6c69   lower energy li
-0002d6b0: 6d69 7420 6f66 2074 6865 2072 6174 656d  mit of the ratem
-0002d6c0: 6170 7320 796f 7520 7769 7368 2074 6f20  aps you wish to 
-0002d6d0: 7265 7472 6965 7665 2c20 7468 6520 6465  retrieve, the de
-0002d6e0: 6661 756c 740a 2020 2020 2020 2020 2020  fault.          
-0002d6f0: 2020 6973 204e 6f6e 6520 2877 6869 6368    is None (which
-0002d700: 2077 696c 6c20 7265 7472 6965 7665 2061   will retrieve a
-0002d710: 6c6c 2072 6174 656d 6170 7320 7265 6761  ll ratemaps rega
-0002d720: 7264 6c65 7373 206f 6620 656e 6572 6779  rdless of energy
-0002d730: 206c 696d 6974 292e 0a20 2020 2020 2020   limit)..       
-0002d740: 203a 7061 7261 6d20 5175 616e 7469 7479   :param Quantity
-0002d750: 2068 695f 656e 3a20 5468 6520 7570 7065   hi_en: The uppe
-0002d760: 7220 656e 6572 6779 206c 696d 6974 206f  r energy limit o
-0002d770: 6620 7468 6520 7261 7465 6d61 7073 2079  f the ratemaps y
-0002d780: 6f75 2077 6973 6820 746f 2072 6574 7269  ou wish to retri
-0002d790: 6576 652c 2074 6865 2064 6566 6175 6c74  eve, the default
-0002d7a0: 0a20 2020 2020 2020 2020 2020 2069 7320  .            is 
-0002d7b0: 4e6f 6e65 2028 7768 6963 6820 7769 6c6c  None (which will
-0002d7c0: 2072 6574 7269 6576 6520 616c 6c20 7261   retrieve all ra
-0002d7d0: 7465 6d61 7073 2072 6567 6172 646c 6573  temaps regardles
-0002d7e0: 7320 6f66 2065 6e65 7267 7920 6c69 6d69  s of energy limi
-0002d7f0: 7429 2e0a 2020 2020 2020 2020 3a70 6172  t)..        :par
-0002d800: 616d 2062 6f6f 6c20 7073 665f 636f 7272  am bool psf_corr
-0002d810: 3a20 5365 7473 2077 6865 7468 6572 2079  : Sets whether y
-0002d820: 6f75 2077 6973 6820 746f 2072 6574 7269  ou wish to retri
-0002d830: 6576 6520 6120 5053 4620 636f 7272 6563  eve a PSF correc
-0002d840: 7465 6420 7261 7465 6d61 7020 6f72 206e  ted ratemap or n
-0002d850: 6f74 2e0a 2020 2020 2020 2020 3a70 6172  ot..        :par
-0002d860: 616d 2073 7472 2070 7366 5f6d 6f64 656c  am str psf_model
-0002d870: 3a20 4966 2074 6865 2072 6174 656d 6170  : If the ratemap
-0002d880: 2079 6f75 2077 616e 7420 6973 2050 5346   you want is PSF
-0002d890: 2063 6f72 7265 6374 6564 2c20 7468 6973   corrected, this
-0002d8a0: 2069 7320 7468 6520 5053 4620 6d6f 6465   is the PSF mode
-0002d8b0: 6c20 7573 6564 2e0a 2020 2020 2020 2020  l used..        
-0002d8c0: 3a70 6172 616d 2069 6e74 2070 7366 5f62  :param int psf_b
-0002d8d0: 696e 733a 2049 6620 7468 6520 7261 7465  ins: If the rate
-0002d8e0: 6d61 7020 796f 7520 7761 6e74 2069 7320  map you want is 
-0002d8f0: 5053 4620 636f 7272 6563 7465 642c 2074  PSF corrected, t
-0002d900: 6869 7320 6973 2074 6865 206e 756d 6265  his is the numbe
-0002d910: 7220 6f66 2050 5346 7320 7065 720a 2020  r of PSFs per.  
-0002d920: 2020 2020 2020 2020 2020 7369 6465 2069            side i
-0002d930: 6e20 7468 6520 5053 4620 6772 6964 2e0a  n the PSF grid..
-0002d940: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0002d950: 7472 2070 7366 5f61 6c67 6f3a 2049 6620  tr psf_algo: If 
-0002d960: 7468 6520 7261 7465 6d61 7020 796f 7520  the ratemap you 
-0002d970: 7761 6e74 2069 7320 5053 4620 636f 7272  want is PSF corr
-0002d980: 6563 7465 642c 2074 6869 7320 6973 2074  ected, this is t
-0002d990: 6865 2061 6c67 6f72 6974 686d 2075 7365  he algorithm use
-0002d9a0: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
-0002d9b0: 6d20 696e 7420 7073 665f 6974 6572 3a20  m int psf_iter: 
-0002d9c0: 4966 2074 6865 2072 6174 656d 6170 2079  If the ratemap y
-0002d9d0: 6f75 2077 616e 7420 6973 2050 5346 2063  ou want is PSF c
-0002d9e0: 6f72 7265 6374 6564 2c20 7468 6973 2069  orrected, this i
-0002d9f0: 7320 7468 6520 6e75 6d62 6572 206f 6620  s the number of 
-0002da00: 6974 6572 6174 696f 6e73 2e0a 2020 2020  iterations..    
-0002da10: 2020 2020 3a72 6574 7572 6e3a 2041 6e20      :return: An 
-0002da20: 5847 4120 5261 7465 4d61 7020 6f62 6a65  XGA RateMap obje
-0002da30: 6374 2028 6966 2074 6865 7265 2069 7320  ct (if there is 
-0002da40: 616e 2065 7861 6374 206d 6174 6368 292c  an exact match),
-0002da50: 206f 7220 6120 6c69 7374 206f 6620 5847   or a list of XG
-0002da60: 4120 5261 7465 4d61 7020 6f62 6a65 6374  A RateMap object
-0002da70: 7320 2869 6620 7468 6572 650a 2020 2020  s (if there.    
-0002da80: 2020 2020 2020 2020 7765 7265 206d 756c          were mul
-0002da90: 7469 706c 6520 6d61 7463 6869 6e67 2070  tiple matching p
-0002daa0: 726f 6475 6374 7329 2e0a 2020 2020 2020  roducts)..      
-0002dab0: 2020 3a72 7479 7065 3a20 556e 696f 6e5b    :rtype: Union[
-0002dac0: 5261 7465 4d61 702c 204c 6973 745b 5261  RateMap, List[Ra
-0002dad0: 7465 4d61 705d 5d0a 2020 2020 2020 2020  teMap]].        
-0002dae0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0002daf0: 726e 2073 656c 662e 5f67 6574 5f70 686f  rn self._get_pho
-0002db00: 745f 7072 6f64 2822 7261 7465 6d61 7022  t_prod("ratemap"
-0002db10: 2c20 6f62 735f 6964 2c20 696e 7374 2c20  , obs_id, inst, 
-0002db20: 6c6f 5f65 6e2c 2068 695f 656e 2c20 7073  lo_en, hi_en, ps
-0002db30: 665f 636f 7272 2c20 7073 665f 6d6f 6465  f_corr, psf_mode
-0002db40: 6c2c 2070 7366 5f62 696e 732c 2070 7366  l, psf_bins, psf
-0002db50: 5f61 6c67 6f2c 0a20 2020 2020 2020 2020  _algo,.         
-0002db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002db70: 2020 2020 2020 2020 2020 7073 665f 6974            psf_it
-0002db80: 6572 290a 0a20 2020 2064 6566 205f 6765  er)..    def _ge
-0002db90: 745f 6c63 5f70 726f 6428 7365 6c66 2c20  t_lc_prod(self, 
-0002dba0: 6f75 7465 725f 7261 6469 7573 3a20 556e  outer_radius: Un
-0002dbb0: 696f 6e5b 7374 722c 2051 7561 6e74 6974  ion[str, Quantit
-0002dbc0: 795d 203d 204e 6f6e 652c 206f 6273 5f69  y] = None, obs_i
-0002dbd0: 643a 2073 7472 203d 204e 6f6e 652c 2069  d: str = None, i
-0002dbe0: 6e73 743a 2073 7472 203d 204e 6f6e 652c  nst: str = None,
-0002dbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002dc00: 2020 2020 2020 696e 6e65 725f 7261 6469        inner_radi
-0002dc10: 7573 3a20 556e 696f 6e5b 7374 722c 2051  us: Union[str, Q
-0002dc20: 7561 6e74 6974 795d 203d 204e 6f6e 652c  uantity] = None,
-0002dc30: 206c 6f5f 656e 3a20 5175 616e 7469 7479   lo_en: Quantity
-0002dc40: 203d 204e 6f6e 652c 2068 695f 656e 3a20   = None, hi_en: 
-0002dc50: 5175 616e 7469 7479 203d 204e 6f6e 652c  Quantity = None,
-0002dc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002dc70: 2020 2020 2020 7469 6d65 5f62 696e 5f73        time_bin_s
-0002dc80: 697a 653a 2051 7561 6e74 6974 7920 3d20  ize: Quantity = 
-0002dc90: 4e6f 6e65 2920 5c0a 2020 2020 2020 2020  None) \.        
-0002dca0: 2020 2020 2d3e 2055 6e69 6f6e 5b4c 6967      -> Union[Lig
-0002dcb0: 6874 4375 7276 652c 204c 6973 745b 4c69  htCurve, List[Li
-0002dcc0: 6768 7443 7572 7665 5d2c 2041 6767 7265  ghtCurve], Aggre
-0002dcd0: 6761 7465 4c69 6768 7443 7572 7665 2c20  gateLightCurve, 
-0002dce0: 4c69 7374 5b41 6767 7265 6761 7465 4c69  List[AggregateLi
-0002dcf0: 6768 7443 7572 7665 5d5d 3a0a 2020 2020  ghtCurve]]:.    
-0002dd00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0002dd10: 4120 7072 6f74 6563 7465 6420 6d65 7468  A protected meth
-0002dd20: 6f64 2074 6f20 7265 7472 6965 7665 2058  od to retrieve X
-0002dd30: 4741 204c 6967 6874 4375 7276 6520 6f62  GA LightCurve ob
-0002dd40: 6a65 6374 732c 2074 6865 2075 7365 7220  jects, the user 
-0002dd50: 7368 6f75 6c64 206e 6576 6572 2069 6e74  should never int
-0002dd60: 6572 6163 7420 7769 7468 2074 6869 7320  eract with this 
-0002dd70: 6469 7265 6374 6c79 2e0a 0a20 2020 2020  directly...     
-0002dd80: 2020 203a 7061 7261 6d20 7374 722f 5175     :param str/Qu
-0002dd90: 616e 7469 7479 206f 7574 6572 5f72 6164  antity outer_rad
-0002dda0: 6975 733a 2054 6865 206e 616d 6520 6f72  ius: The name or
-0002ddb0: 2076 616c 7565 206f 6620 7468 6520 6f75   value of the ou
-0002ddc0: 7465 7220 7261 6469 7573 2074 6861 7420  ter radius that 
-0002ddd0: 7761 7320 7573 6564 2066 6f72 2074 6865  was used for the
-0002dde0: 2067 656e 6572 6174 696f 6e20 6f66 0a20   generation of. 
-0002ddf0: 2020 2020 2020 2020 2020 2074 6865 206c             the l
-0002de00: 6967 6874 6375 7276 6520 2866 6f72 2069  ightcurve (for i
-0002de10: 6e73 7461 6e63 6520 2770 6f69 6e74 2720  nstance 'point' 
-0002de20: 776f 756c 6420 6265 2061 6363 6570 7461  would be accepta
-0002de30: 626c 6520 666f 7220 6120 506f 696e 7453  ble for a PointS
-0002de40: 6f75 7263 652c 206f 7220 5175 616e 7469  ource, or Quanti
-0002de50: 7479 2831 3030 2c20 276b 7063 2729 292e  ty(100, 'kpc')).
-0002de60: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
-0002de70: 6175 6c74 2069 7320 4e6f 6e65 2c20 6d65  ault is None, me
-0002de80: 616e 696e 6720 616c 6c20 6c69 6768 7463  aning all lightc
-0002de90: 7572 7665 7320 7769 6c6c 2062 6520 7265  urves will be re
-0002dea0: 7472 6965 7665 642e 0a20 2020 2020 2020  trieved..       
-0002deb0: 203a 7061 7261 6d20 7374 7220 6f62 735f   :param str obs_
-0002dec0: 6964 3a20 4f70 7469 6f6e 616c 6c79 2c20  id: Optionally, 
-0002ded0: 6120 7370 6563 6966 6963 206f 6273 5f69  a specific obs_i
-0002dee0: 6420 746f 2073 6561 7263 6820 666f 7220  d to search for 
-0002def0: 6361 6e20 6265 2073 7570 706c 6965 642e  can be supplied.
-0002df00: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
-0002df10: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-0002df20: 2020 7768 6963 6820 6d65 616e 7320 616c    which means al
-0002df30: 6c20 6c69 6768 7463 7572 7665 7320 6d61  l lightcurves ma
-0002df40: 7463 6869 6e67 2074 6865 206f 7468 6572  tching the other
-0002df50: 2063 7269 7465 7269 6120 7769 6c6c 2062   criteria will b
-0002df60: 6520 7265 7475 726e 6564 2e0a 2020 2020  e returned..    
-0002df70: 2020 2020 3a70 6172 616d 2073 7472 2069      :param str i
-0002df80: 6e73 743a 204f 7074 696f 6e61 6c6c 792c  nst: Optionally,
-0002df90: 2061 2073 7065 6369 6669 6320 696e 7374   a specific inst
-0002dfa0: 7275 6d65 6e74 2074 6f20 7365 6172 6368  rument to search
-0002dfb0: 2066 6f72 2063 616e 2062 6520 7375 7070   for can be supp
-0002dfc0: 6c69 6564 2e20 5468 6520 6465 6661 756c  lied. The defaul
-0002dfd0: 7420 6973 204e 6f6e 652c 0a20 2020 2020  t is None,.     
-0002dfe0: 2020 2020 2020 2077 6869 6368 206d 6561         which mea
-0002dff0: 6e73 2061 6c6c 206c 6967 6874 6375 7276  ns all lightcurv
-0002e000: 6573 206d 6174 6368 696e 6720 7468 6520  es matching the 
-0002e010: 6f74 6865 7220 6372 6974 6572 6961 2077  other criteria w
-0002e020: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
-0002e030: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0002e040: 7374 722f 5175 616e 7469 7479 2069 6e6e  str/Quantity inn
-0002e050: 6572 5f72 6164 6975 733a 2054 6865 206e  er_radius: The n
-0002e060: 616d 6520 6f72 2076 616c 7565 206f 6620  ame or value of 
-0002e070: 7468 6520 696e 6e65 7220 7261 6469 7573  the inner radius
-0002e080: 2074 6861 7420 7761 7320 7573 6564 2066   that was used f
-0002e090: 6f72 2074 6865 2067 656e 6572 6174 696f  or the generatio
-0002e0a0: 6e20 6f66 0a20 2020 2020 2020 2020 2020  n of.           
-0002e0b0: 2074 6865 206c 6967 6874 6375 7276 6520   the lightcurve 
-0002e0c0: 2866 6f72 2069 6e73 7461 6e63 6520 2770  (for instance 'p
-0002e0d0: 6f69 6e74 2720 776f 756c 6420 6265 2061  oint' would be a
-0002e0e0: 6363 6570 7461 626c 6520 666f 7220 6120  cceptable for a 
-0002e0f0: 506f 696e 7453 6f75 7263 652c 206f 7220  PointSource, or 
-0002e100: 5175 616e 7469 7479 2830 2c20 276b 7063  Quantity(0, 'kpc
-0002e110: 2729 292e 0a20 2020 2020 2020 2020 2020  '))..           
-0002e120: 2044 6566 6175 6c74 2069 7320 4e6f 6e65   Default is None
-0002e130: 2c20 6d65 616e 696e 6720 616c 6c20 6c69  , meaning all li
-0002e140: 6768 7463 7572 7665 7320 7769 6c6c 2062  ghtcurves will b
-0002e150: 6520 7265 7472 6965 7665 642e 0a20 2020  e retrieved..   
-0002e160: 2020 2020 203a 7061 7261 6d20 5175 616e       :param Quan
-0002e170: 7469 7479 206c 6f5f 656e 3a20 5468 6520  tity lo_en: The 
-0002e180: 6c6f 7765 7220 656e 6572 6779 206c 696d  lower energy lim
-0002e190: 6974 206f 6620 7468 6520 6c69 6768 7463  it of the lightc
-0002e1a0: 7572 7665 7320 796f 7520 7769 7368 2074  urves you wish t
-0002e1b0: 6f20 7265 7472 6965 7665 2c20 7468 6520  o retrieve, the 
-0002e1c0: 6465 6661 756c 740a 2020 2020 2020 2020  default.        
-0002e1d0: 2020 2020 6973 204e 6f6e 6520 2877 6869      is None (whi
-0002e1e0: 6368 2077 696c 6c20 7265 7472 6965 7665  ch will retrieve
-0002e1f0: 2061 6c6c 206c 6967 6874 6375 7276 6573   all lightcurves
-0002e200: 2072 6567 6172 646c 6573 7320 6f66 2065   regardless of e
-0002e210: 6e65 7267 7920 6c69 6d69 7429 2e0a 2020  nergy limit)..  
-0002e220: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
-0002e230: 6e74 6974 7920 6869 5f65 6e3a 2054 6865  ntity hi_en: The
-0002e240: 2075 7070 6572 2065 6e65 7267 7920 6c69   upper energy li
-0002e250: 6d69 7420 6f66 2074 6865 206c 6967 6874  mit of the light
-0002e260: 6375 7276 6573 2079 6f75 2077 6973 6820  curves you wish 
-0002e270: 746f 2072 6574 7269 6576 652c 2074 6865  to retrieve, the
-0002e280: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
-0002e290: 2020 2020 2069 7320 4e6f 6e65 2028 7768       is None (wh
-0002e2a0: 6963 6820 7769 6c6c 2072 6574 7269 6576  ich will retriev
-0002e2b0: 6520 616c 6c20 6c69 6768 7463 7572 7665  e all lightcurve
-0002e2c0: 7320 7265 6761 7264 6c65 7373 206f 6620  s regardless of 
-0002e2d0: 656e 6572 6779 206c 696d 6974 292e 0a20  energy limit).. 
-0002e2e0: 2020 2020 2020 203a 7061 7261 6d20 5175         :param Qu
-0002e2f0: 616e 7469 7479 2074 696d 655f 6269 6e5f  antity time_bin_
-0002e300: 7369 7a65 3a20 5468 6520 7469 6d65 2062  size: The time b
-0002e310: 696e 2073 697a 6520 7573 6564 2074 6f20  in size used to 
-0002e320: 6765 6e65 7261 7465 2074 6865 2064 6573  generate the des
-0002e330: 6972 6564 206c 6967 6874 6375 7276 652e  ired lightcurve.
-0002e340: 2054 6865 2064 6566 6175 6c74 2076 616c   The default val
-0002e350: 7565 0a20 2020 2020 2020 2020 2020 2069  ue.            i
-0002e360: 7320 4e6f 6e65 2c20 696e 2077 6869 6368  s None, in which
-0002e370: 2063 6173 6520 616c 6c20 6c69 6768 7463   case all lightc
-0002e380: 7572 7665 7320 6d61 7463 6869 6e67 206f  urves matching o
-0002e390: 7468 6572 2063 7269 7465 7269 6120 7769  ther criteria wi
-0002e3a0: 6c6c 2062 6520 7265 7472 6965 7665 642e  ll be retrieved.
-0002e3b0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-0002e3c0: 3a20 416e 2058 4741 204c 6967 6874 4375  : An XGA LightCu
-0002e3d0: 7276 6520 6f62 6a65 6374 2028 6966 2074  rve object (if t
-0002e3e0: 6865 7265 2069 7320 616e 2065 7861 6374  here is an exact
-0002e3f0: 206d 6174 6368 292c 206f 7220 6120 6c69   match), or a li
-0002e400: 7374 206f 6620 5847 4120 4c69 6768 7443  st of XGA LightC
-0002e410: 7572 7665 206f 626a 6563 7473 2028 6966  urve objects (if
-0002e420: 2074 6865 7265 0a20 2020 2020 2020 2020   there.         
-0002e430: 2020 2077 6572 6520 6d75 6c74 6970 6c65     were multiple
-0002e440: 206d 6174 6368 696e 6720 7072 6f64 7563   matching produc
-0002e450: 7473 292c 206f 7220 6120 7369 6e67 6c65  ts), or a single
-0002e460: 2f6c 6973 7420 6f66 2041 6767 7265 6761  /list of Aggrega
-0002e470: 7465 4c69 6768 7443 7572 7665 206f 626a  teLightCurve obj
-0002e480: 6563 7473 2e0a 2020 2020 2020 2020 3a72  ects..        :r
-0002e490: 7479 7065 3a20 556e 696f 6e5b 4c69 6768  type: Union[Ligh
-0002e4a0: 7443 7572 7665 2c20 4c69 7374 5b4c 6967  tCurve, List[Lig
-0002e4b0: 6874 4375 7276 655d 2c20 4167 6772 6567  htCurve], Aggreg
-0002e4c0: 6174 654c 6967 6874 4375 7276 652c 204c  ateLightCurve, L
-0002e4d0: 6973 745b 4167 6772 6567 6174 654c 6967  ist[AggregateLig
-0002e4e0: 6874 4375 7276 655d 5d0a 2020 2020 2020  htCurve]].      
-0002e4f0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-0002e500: 5365 7420 7570 2073 6561 7263 6820 7374  Set up search st
-0002e510: 7269 6e67 7320 2866 6f72 2074 6865 2070  rings (for the p
-0002e520: 726f 6475 6374 2073 746f 7261 6765 206b  roduct storage k
-0002e530: 6579 7329 2066 6f72 2074 6865 2069 6e6e  eys) for the inn
-0002e540: 6572 2061 6e64 206f 7574 6572 2072 6164  er and outer rad
-0002e550: 6969 2068 6572 652e 2054 6865 2064 6566  ii here. The def
-0002e560: 6175 6c74 204e 6f6e 650a 2020 2020 2020  ault None.      
-0002e570: 2020 2320 2076 616c 7565 206a 7573 7420    #  value just 
-0002e580: 6372 6561 7465 7320 6120 6b65 7920 7468  creates a key th
-0002e590: 6174 206c 6f6f 6b73 2066 6f72 2074 6865  at looks for the
-0002e5a0: 2027 7269 2720 6f72 2027 726f 2720 7072   'ri' or 'ro' pr
-0002e5b0: 6563 7572 736f 7220 746f 2074 6865 2076  ecursor to the v
-0002e5c0: 616c 7565 2069 6e20 7468 6520 6b65 792c  alue in the key,
-0002e5d0: 2069 2e65 2e20 6974 2064 6f65 736e 2774   i.e. it doesn't
-0002e5e0: 0a20 2020 2020 2020 2023 2020 646f 2061  .        #  do a
-0002e5f0: 6e79 7468 696e 6720 2d20 7765 2061 6c73  nything - we als
-0002e600: 6f20 6d61 6b65 2073 7572 6520 7468 6174  o make sure that
-0002e610: 2061 6e79 2072 6164 6969 2070 6173 7365   any radii passe
-0002e620: 6420 6279 2074 6865 2075 7365 7220 6172  d by the user ar
-0002e630: 6520 636f 6e76 6572 7465 6420 7072 6f70  e converted prop
-0002e640: 6572 6c79 0a20 2020 2020 2020 2069 6620  erly.        if 
-0002e650: 696e 6e65 725f 7261 6469 7573 2069 7320  inner_radius is 
-0002e660: 6e6f 7420 4e6f 6e65 2061 6e64 2069 7369  not None and isi
-0002e670: 6e73 7461 6e63 6528 696e 6e65 725f 7261  nstance(inner_ra
-0002e680: 6469 7573 2c20 5175 616e 7469 7479 293a  dius, Quantity):
-0002e690: 0a20 2020 2020 2020 2020 2020 2069 6e6e  .            inn
-0002e6a0: 5f72 6164 5f73 6561 7263 6820 3d20 275f  _rad_search = '_
-0002e6b0: 7269 7b7d 5f27 2e66 6f72 6d61 7428 7365  ri{}_'.format(se
-0002e6c0: 6c66 2e63 6f6e 7665 7274 5f72 6164 6975  lf.convert_radiu
-0002e6d0: 7328 696e 6e65 725f 7261 6469 7573 2c20  s(inner_radius, 
-0002e6e0: 2764 6567 2729 2e76 616c 7565 290a 2020  'deg').value).  
-0002e6f0: 2020 2020 2020 656c 6966 2069 6e6e 6572        elif inner
-0002e700: 5f72 6164 6975 7320 6973 206e 6f74 204e  _radius is not N
-0002e710: 6f6e 6520 616e 6420 6973 696e 7374 616e  one and isinstan
-0002e720: 6365 2869 6e6e 6572 5f72 6164 6975 732c  ce(inner_radius,
-0002e730: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-0002e740: 2020 2069 6e6e 5f72 6164 5f73 6561 7263     inn_rad_searc
-0002e750: 6820 3d20 275f 7269 7b7d 5f27 2e66 6f72  h = '_ri{}_'.for
-0002e760: 6d61 7428 7365 6c66 2e67 6574 5f72 6164  mat(self.get_rad
-0002e770: 6975 7328 696e 6e65 725f 7261 6469 7573  ius(inner_radius
-0002e780: 2c20 2764 6567 2729 2e76 616c 7565 290a  , 'deg').value).
-0002e790: 2020 2020 2020 2020 656c 6966 2069 6e6e          elif inn
-0002e7a0: 6572 5f72 6164 6975 7320 6973 204e 6f6e  er_radius is Non
-0002e7b0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0002e7c0: 6e6e 5f72 6164 5f73 6561 7263 6820 3d20  nn_rad_search = 
-0002e7d0: 225f 7269 220a 2020 2020 2020 2020 656c  "_ri".        el
-0002e7e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002e7f0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-0002e800: 2259 6f75 206d 6179 206f 6e6c 7920 7061  "You may only pa
-0002e810: 7373 2061 2071 7561 6e74 6974 7920 6f72  ss a quantity or
-0002e820: 2061 2073 7472 696e 6720 6173 2069 6e6e   a string as inn
-0002e830: 6572 5f72 6164 6975 7322 290a 0a20 2020  er_radius")..   
-0002e840: 2020 2020 2069 6620 6f75 7465 725f 7261       if outer_ra
-0002e850: 6469 7573 2069 7320 6e6f 7420 4e6f 6e65  dius is not None
-0002e860: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
-0002e870: 6f75 7465 725f 7261 6469 7573 2c20 5175  outer_radius, Qu
-0002e880: 616e 7469 7479 293a 0a20 2020 2020 2020  antity):.       
-0002e890: 2020 2020 206f 7574 5f72 6164 5f73 6561       out_rad_sea
-0002e8a0: 7263 6820 3d20 275f 726f 7b7d 5f27 2e66  rch = '_ro{}_'.f
-0002e8b0: 6f72 6d61 7428 7365 6c66 2e63 6f6e 7665  ormat(self.conve
-0002e8c0: 7274 5f72 6164 6975 7328 6f75 7465 725f  rt_radius(outer_
-0002e8d0: 7261 6469 7573 2c20 2764 6567 2729 2e76  radius, 'deg').v
-0002e8e0: 616c 7565 290a 2020 2020 2020 2020 656c  alue).        el
-0002e8f0: 6966 206f 7574 6572 5f72 6164 6975 7320  if outer_radius 
-0002e900: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0002e910: 6973 696e 7374 616e 6365 286f 7574 6572  isinstance(outer
-0002e920: 5f72 6164 6975 732c 2073 7472 293a 0a20  _radius, str):. 
-0002e930: 2020 2020 2020 2020 2020 206f 7574 5f72             out_r
-0002e940: 6164 5f73 6561 7263 6820 3d20 275f 726f  ad_search = '_ro
-0002e950: 7b7d 5f27 2e66 6f72 6d61 7428 7365 6c66  {}_'.format(self
-0002e960: 2e67 6574 5f72 6164 6975 7328 6f75 7465  .get_radius(oute
-0002e970: 725f 7261 6469 7573 2c20 2764 6567 2729  r_radius, 'deg')
-0002e980: 2e76 616c 7565 290a 2020 2020 2020 2020  .value).        
-0002e990: 656c 6966 206f 7574 6572 5f72 6164 6975  elif outer_radiu
-0002e9a0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-0002e9b0: 2020 2020 2020 206f 7574 5f72 6164 5f73         out_rad_s
-0002e9c0: 6561 7263 6820 3d20 225f 726f 220a 2020  earch = "_ro".  
-0002e9d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002e9e0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-0002e9f0: 7065 4572 726f 7228 2259 6f75 206d 6179  peError("You may
-0002ea00: 206f 6e6c 7920 7061 7373 2061 2071 7561   only pass a qua
-0002ea10: 6e74 6974 7920 6f72 2061 2073 7472 696e  ntity or a strin
-0002ea20: 6720 6173 206f 7574 6572 5f72 6164 6975  g as outer_radiu
-0002ea30: 7322 290a 0a20 2020 2020 2020 2023 2043  s")..        # C
-0002ea40: 6865 636b 2074 6f20 6d61 6b65 2073 7572  heck to make sur
-0002ea50: 6520 7468 6174 2074 6865 2074 696d 6520  e that the time 
-0002ea60: 6269 6e20 7369 7a65 2069 7320 6120 6c65  bin size is a le
-0002ea70: 6761 6c20 7661 6c75 652c 2061 6e64 2073  gal value, and s
-0002ea80: 6574 2075 7020 6120 7365 6172 6368 2073  et up a search s
-0002ea90: 7472 696e 6720 666f 7220 7468 6520 7469  tring for the ti
-0002eaa0: 6d65 2062 696e 0a20 2020 2020 2020 2023  me bin.        #
-0002eab0: 2020 7369 7a65 2069 6e20 6f72 6465 7220    size in order 
-0002eac0: 746f 206e 6172 726f 7720 646f 776e 2074  to narrow down t
-0002ead0: 6865 206c 6967 6874 6375 7276 6573 2074  he lightcurves t
-0002eae0: 6f20 6a75 7374 2074 6865 206f 6e65 7320  o just the ones 
-0002eaf0: 7468 6174 2074 6865 2075 7365 7220 7761  that the user wa
-0002eb00: 6e74 730a 2020 2020 2020 2020 6966 2074  nts.        if t
-0002eb10: 696d 655f 6269 6e5f 7369 7a65 2069 7320  ime_bin_size is 
-0002eb20: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
-0002eb30: 2074 696d 655f 6269 6e5f 7369 7a65 2e75   time_bin_size.u
-0002eb40: 6e69 742e 6973 5f65 7175 6976 616c 656e  nit.is_equivalen
-0002eb50: 7428 2773 2729 3a0a 2020 2020 2020 2020  t('s'):.        
-0002eb60: 2020 2020 7261 6973 6520 556e 6974 436f      raise UnitCo
-0002eb70: 6e76 6572 7369 6f6e 4572 726f 7228 2254  nversionError("T
-0002eb80: 6865 2027 7469 6d65 5f62 696e 5f73 697a  he 'time_bin_siz
-0002eb90: 6527 2061 7267 756d 656e 7420 6d75 7374  e' argument must
-0002eba0: 2062 6520 636f 6e76 6572 7469 626c 6520   be convertible 
-0002ebb0: 746f 2073 6563 6f6e 6473 2e22 290a 2020  to seconds.").  
-0002ebc0: 2020 2020 2020 656c 6966 2074 696d 655f        elif time_
-0002ebd0: 6269 6e5f 7369 7a65 2069 7320 4e6f 6e65  bin_size is None
-0002ebe0: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
-0002ebf0: 6d65 5f62 696e 5f73 6561 7263 6820 3d20  me_bin_search = 
-0002ec00: 275f 7469 6d65 6269 6e27 0a20 2020 2020  '_timebin'.     
-0002ec10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002ec20: 2020 2020 2074 696d 655f 6269 6e5f 7365       time_bin_se
-0002ec30: 6172 6368 203d 2027 5f74 696d 6562 696e  arch = '_timebin
-0002ec40: 7b7d 272e 666f 726d 6174 2874 696d 655f  {}'.format(time_
-0002ec50: 6269 6e5f 7369 7a65 2e74 6f28 2773 2729  bin_size.to('s')
-0002ec60: 2e76 616c 7565 290a 0a20 2020 2020 2020  .value)..       
-0002ec70: 2023 2053 6574 7469 6e67 2075 7020 7468   # Setting up th
-0002ec80: 6520 656e 6572 6779 2062 616e 6420 7365  e energy band se
-0002ec90: 6172 6368 2073 7472 696e 6720 2d20 6966  arch string - if
-0002eca0: 206f 6e65 2062 6f75 6e64 2069 7320 7370   one bound is sp
-0002ecb0: 6563 6966 6965 6420 7468 656e 2074 6865  ecified then the
-0002ecc0: 206f 7468 6572 2068 6173 2074 6f20 6265   other has to be
-0002ecd0: 2061 7320 7765 6c6c 2c20 490a 2020 2020   as well, I.    
-0002ece0: 2020 2020 2320 2064 6964 6e27 7420 7468      #  didn't th
-0002ecf0: 696e 6b20 6974 206d 6164 6520 7365 6e73  ink it made sens
-0002ed00: 6520 6f74 6865 7277 6973 650a 2020 2020  e otherwise.    
-0002ed10: 2020 2020 6966 2061 6e79 285b 6c6f 5f65      if any([lo_e
-0002ed20: 6e20 6973 206e 6f74 204e 6f6e 652c 2068  n is not None, h
-0002ed30: 695f 656e 2069 7320 6e6f 7420 4e6f 6e65  i_en is not None
-0002ed40: 5d29 2061 6e64 206e 6f74 2061 6c6c 285b  ]) and not all([
-0002ed50: 6c6f 5f65 6e20 6973 206e 6f74 204e 6f6e  lo_en is not Non
-0002ed60: 652c 2068 695f 656e 2069 7320 6e6f 7420  e, hi_en is not 
-0002ed70: 4e6f 6e65 5d29 3a0a 2020 2020 2020 2020  None]):.        
-0002ed80: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0002ed90: 7272 6f72 2822 5468 6520 276c 6f5f 656e  rror("The 'lo_en
-0002eda0: 2720 616e 6420 2768 695f 656e 2720 7661  ' and 'hi_en' va
-0002edb0: 6c75 6573 206d 7573 7420 6569 7468 6572  lues must either
-0002edc0: 2062 6f74 6820 6265 204e 6f6e 652c 206f   both be None, o
-0002edd0: 7220 626f 7468 2062 6520 616e 2065 6e65  r both be an ene
-0002ede0: 7267 7920 7661 6c75 652e 2229 0a20 2020  rgy value.").   
-0002edf0: 2020 2020 2069 6620 286c 6f5f 656e 2069       if (lo_en i
-0002ee00: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206e  s not None and n
-0002ee10: 6f74 206c 6f5f 656e 2e75 6e69 742e 6973  ot lo_en.unit.is
-0002ee20: 5f65 7175 6976 616c 656e 7428 276b 6556  _equivalent('keV
-0002ee30: 2729 2920 6f72 205c 0a20 2020 2020 2020  ')) or \.       
-0002ee40: 2020 2020 2020 2020 2028 6869 5f65 6e20           (hi_en 
-0002ee50: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0002ee60: 6e6f 7420 6869 5f65 6e2e 756e 6974 2e69  not hi_en.unit.i
-0002ee70: 735f 6571 7569 7661 6c65 6e74 2827 6b65  s_equivalent('ke
-0002ee80: 5627 2929 3a0a 2020 2020 2020 2020 2020  V')):.          
-0002ee90: 2020 7261 6973 6520 556e 6974 436f 6e76    raise UnitConv
-0002eea0: 6572 7369 6f6e 4572 726f 7228 2254 6865  ersionError("The
-0002eeb0: 2027 6c6f 5f65 6e27 2061 6e64 2027 6869   'lo_en' and 'hi
-0002eec0: 5f65 6e27 2061 7267 756d 656e 7473 206d  _en' arguments m
-0002eed0: 7573 7420 6265 2063 6f6e 7665 7274 6962  ust be convertib
-0002eee0: 6c65 2074 6f20 6b65 562e 2229 0a20 2020  le to keV.").   
-0002eef0: 2020 2020 2023 2049 6620 6569 7468 6572       # If either
-0002ef00: 2069 7320 4e6f 6e65 2074 6865 6e20 7765   is None then we
-0002ef10: 206b 6e6f 7720 626f 7468 2061 7265 2062   know both are b
-0002ef20: 6563 6175 7365 2077 6520 6368 6563 6b65  ecause we checke
-0002ef30: 6420 6561 726c 6965 720a 2020 2020 2020  d earlier.      
-0002ef40: 2020 656c 6966 206c 6f5f 656e 2069 7320    elif lo_en is 
-0002ef50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0002ef60: 2020 656e 5f73 6561 7263 6820 3d20 2762    en_search = 'b
-0002ef70: 6f75 6e64 5f27 0a20 2020 2020 2020 2065  ound_'.        e
-0002ef80: 6c69 6620 6c6f 5f65 6e20 6973 206e 6f74  lif lo_en is not
-0002ef90: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0002efa0: 2020 2065 6e5f 7365 6172 6368 203d 2027     en_search = '
-0002efb0: 626f 756e 645f 7b6c 7d2d 7b75 7d27 2e66  bound_{l}-{u}'.f
-0002efc0: 6f72 6d61 7428 6c3d 6c6f 5f65 6e2e 746f  ormat(l=lo_en.to
-0002efd0: 2827 6b65 5627 292e 7661 6c75 652c 2075  ('keV').value, u
-0002efe0: 3d68 695f 656e 2e74 6f28 276b 6556 2729  =hi_en.to('keV')
-0002eff0: 2e76 616c 7565 290a 0a20 2020 2020 2020  .value)..       
-0002f000: 2069 6620 6f62 735f 6964 203d 3d20 2763   if obs_id == 'c
-0002f010: 6f6d 6269 6e65 6427 3a0a 2020 2020 2020  ombined':.      
-0002f020: 2020 2020 2020 7365 6172 6368 5f6b 6579        search_key
-0002f030: 203d 2027 636f 6d62 696e 6564 5f6c 6967   = 'combined_lig
-0002f040: 6874 6375 7276 6527 0a20 2020 2020 2020  htcurve'.       
-0002f050: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002f060: 2020 2073 6561 7263 685f 6b65 7920 3d20     search_key = 
-0002f070: 276c 6967 6874 6375 7276 6527 0a20 2020  'lightcurve'.   
-0002f080: 2020 2020 2023 2047 7261 6262 696e 6720       # Grabbing 
-0002f090: 6576 6572 7920 7369 6e67 6c65 206c 6967  every single lig
-0002f0a0: 6874 6375 7276 6520 7468 6174 206d 6174  htcurve that mat
-0002f0b0: 6368 6573 204f 6273 4944 2061 6e64 2069  ches ObsID and i
-0002f0c0: 6e73 7420 7061 7373 6564 2062 7920 7468  nst passed by th
-0002f0d0: 6520 7573 6572 2028 7265 6d65 6d62 6572  e user (remember
-0002f0e0: 2074 6865 7920 636f 756c 6420 6265 0a20   they could be. 
-0002f0f0: 2020 2020 2020 2023 2020 4e6f 6e65 2076         #  None v
-0002f100: 616c 7565 732c 2069 6e64 6565 6420 7468  alues, indeed th
-0002f110: 6579 2061 7265 2062 7920 6465 6661 756c  ey are by defaul
-0002f120: 7429 202d 2077 6527 6c6c 2074 6865 6e20  t) - we'll then 
-0002f130: 7377 6565 7020 7468 726f 7567 6820 7768  sweep through wh
-0002f140: 6174 6576 6572 206c 6973 7420 6973 2072  atever list is r
-0002f150: 6574 7572 6e65 6420 616e 640a 2020 2020  eturned and.    
-0002f160: 2020 2020 2320 206e 6172 726f 7720 7468      #  narrow th
-0002f170: 656d 2064 6f77 6e0a 2020 2020 2020 2020  em down.        
-0002f180: 616c 6c5f 6c63 7320 3d20 7365 6c66 2e67  all_lcs = self.g
-0002f190: 6574 5f70 726f 6475 6374 7328 7365 6172  et_products(sear
-0002f1a0: 6368 5f6b 6579 2c20 6f62 735f 6964 2c20  ch_key, obs_id, 
-0002f1b0: 696e 7374 290a 2020 2020 2020 2020 2320  inst).        # 
-0002f1c0: 4974 2077 6173 2067 6574 7469 6e67 2074  It was getting t
-0002f1d0: 6f20 7468 6520 706f 696e 7420 7768 6572  o the point wher
-0002f1e0: 6520 6120 6c69 7374 2063 6f6d 7072 6568  e a list compreh
-0002f1f0: 656e 7369 6f6e 2077 6173 206c 6573 7320  ension was less 
-0002f200: 7265 6164 6162 6c65 2074 6861 6e20 6120  readable than a 
-0002f210: 666f 7220 6c6f 6f70 2c20 7061 7274 6963  for loop, partic
-0002f220: 756c 6172 6c79 0a20 2020 2020 2020 2023  ularly.        #
-0002f230: 2020 7769 7468 2074 6865 2070 6174 7465    with the patte
-0002f240: 726e 206c 6f67 6963 2c20 736f 2049 2063  rn logic, so I c
-0002f250: 6861 6e67 6564 2069 7420 746f 2074 6869  hanged it to thi
-0002f260: 730a 2020 2020 2020 2020 6d61 7463 6865  s.        matche
-0002f270: 645f 7072 6f64 7320 3d20 5b5d 0a20 2020  d_prods = [].   
-0002f280: 2020 2020 2066 6f72 206c 6320 696e 2061       for lc in a
-0002f290: 6c6c 5f6c 6373 3a0a 2020 2020 2020 2020  ll_lcs:.        
-0002f2a0: 2020 2020 6966 206f 7574 5f72 6164 5f73      if out_rad_s
-0002f2b0: 6561 7263 6820 696e 206c 632e 7374 6f72  earch in lc.stor
-0002f2c0: 6167 655f 6b65 7920 616e 6420 696e 6e5f  age_key and inn_
-0002f2d0: 7261 645f 7365 6172 6368 2069 6e20 6c63  rad_search in lc
-0002f2e0: 2e73 746f 7261 6765 5f6b 6579 2061 6e64  .storage_key and
-0002f2f0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0002f300: 2020 2020 2020 2074 696d 655f 6269 6e5f         time_bin_
-0002f310: 7365 6172 6368 2069 6e20 6c63 2e73 746f  search in lc.sto
-0002f320: 7261 6765 5f6b 6579 2061 6e64 2065 6e5f  rage_key and en_
-0002f330: 7365 6172 6368 2069 6e20 6c63 2e73 746f  search in lc.sto
-0002f340: 7261 6765 5f6b 6579 3a0a 2020 2020 2020  rage_key:.      
-0002f350: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
-0002f360: 645f 7072 6f64 732e 6170 7065 6e64 286c  d_prods.append(l
-0002f370: 6329 0a0a 2020 2020 2020 2020 6966 206c  c)..        if l
-0002f380: 656e 286d 6174 6368 6564 5f70 726f 6473  en(matched_prods
-0002f390: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-0002f3a0: 2020 2020 7261 6973 6520 4e6f 5072 6f64      raise NoProd
-0002f3b0: 7563 7441 7661 696c 6162 6c65 4572 726f  uctAvailableErro
-0002f3c0: 7228 2243 616e 6e6f 7420 6669 6e64 2061  r("Cannot find a
-0002f3d0: 6e79 206c 6967 6874 6375 7276 6573 206d  ny lightcurves m
-0002f3e0: 6174 6368 696e 6720 796f 7572 2069 6e70  atching your inp
-0002f3f0: 7574 2e22 290a 0a20 2020 2020 2020 2072  ut.")..        r
-0002f400: 6574 7572 6e20 6d61 7463 6865 645f 7072  eturn matched_pr
-0002f410: 6f64 730a 0a20 2020 2064 6566 2067 6574  ods..    def get
-0002f420: 5f6c 6967 6874 6375 7276 6573 2873 656c  _lightcurves(sel
-0002f430: 662c 206f 7574 6572 5f72 6164 6975 733a  f, outer_radius:
-0002f440: 2055 6e69 6f6e 5b73 7472 2c20 5175 616e   Union[str, Quan
-0002f450: 7469 7479 5d20 3d20 4e6f 6e65 2c20 6f62  tity] = None, ob
-0002f460: 735f 6964 3a20 7374 7220 3d20 4e6f 6e65  s_id: str = None
-0002f470: 2c20 696e 7374 3a20 7374 7220 3d20 4e6f  , inst: str = No
-0002f480: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-0002f490: 2020 2020 2020 2020 2020 2020 696e 6e65              inne
-0002f4a0: 725f 7261 6469 7573 3a20 556e 696f 6e5b  r_radius: Union[
-0002f4b0: 7374 722c 2051 7561 6e74 6974 795d 203d  str, Quantity] =
-0002f4c0: 204e 6f6e 652c 206c 6f5f 656e 3a20 5175   None, lo_en: Qu
-0002f4d0: 616e 7469 7479 203d 204e 6f6e 652c 0a20  antity = None,. 
-0002f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f4f0: 2020 2020 2020 2068 695f 656e 3a20 5175         hi_en: Qu
-0002f500: 616e 7469 7479 203d 204e 6f6e 652c 2074  antity = None, t
-0002f510: 696d 655f 6269 6e5f 7369 7a65 3a20 5175  ime_bin_size: Qu
-0002f520: 616e 7469 7479 203d 204e 6f6e 652c 0a20  antity = None,. 
-0002f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f540: 2020 2020 2020 2070 6174 7465 726e 3a20         pattern: 
-0002f550: 556e 696f 6e5b 6469 6374 2c20 7374 725d  Union[dict, str]
-0002f560: 203d 2027 6465 6661 756c 7427 2920 2d3e   = 'default') ->
-0002f570: 2055 6e69 6f6e 5b4c 6967 6874 4375 7276   Union[LightCurv
-0002f580: 652c 204c 6973 745b 4c69 6768 7443 7572  e, List[LightCur
-0002f590: 7665 5d5d 3a0a 2020 2020 2020 2020 2222  ve]]:.        ""
-0002f5a0: 220a 2020 2020 2020 2020 4120 6d65 7468  ".        A meth
-0002f5b0: 6f64 2074 6f20 7265 7472 6965 7665 2058  od to retrieve X
-0002f5c0: 4741 204c 6967 6874 4375 7276 6520 6f62  GA LightCurve ob
-0002f5d0: 6a65 6374 732e 0a0a 2020 2020 2020 2020  jects...        
-0002f5e0: 3a70 6172 616d 2073 7472 2f51 7561 6e74  :param str/Quant
-0002f5f0: 6974 7920 6f75 7465 725f 7261 6469 7573  ity outer_radius
-0002f600: 3a20 5468 6520 6e61 6d65 206f 7220 7661  : The name or va
-0002f610: 6c75 6520 6f66 2074 6865 206f 7574 6572  lue of the outer
-0002f620: 2072 6164 6975 7320 7468 6174 2077 6173   radius that was
-0002f630: 2075 7365 6420 666f 7220 7468 6520 6765   used for the ge
-0002f640: 6e65 7261 7469 6f6e 206f 660a 2020 2020  neration of.    
-0002f650: 2020 2020 2020 2020 7468 6520 6c69 6768          the ligh
-0002f660: 7463 7572 7665 2028 666f 7220 696e 7374  tcurve (for inst
-0002f670: 616e 6365 2027 706f 696e 7427 2077 6f75  ance 'point' wou
-0002f680: 6c64 2062 6520 6163 6365 7074 6162 6c65  ld be acceptable
-0002f690: 2066 6f72 2061 2050 6f69 6e74 536f 7572   for a PointSour
-0002f6a0: 6365 2c20 6f72 2051 7561 6e74 6974 7928  ce, or Quantity(
-0002f6b0: 3130 302c 2027 6b70 6327 2929 2e0a 2020  100, 'kpc'))..  
-0002f6c0: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
-0002f6d0: 7420 6973 204e 6f6e 652c 206d 6561 6e69  t is None, meani
-0002f6e0: 6e67 2061 6c6c 206c 6967 6874 6375 7276  ng all lightcurv
-0002f6f0: 6573 2077 696c 6c20 6265 2072 6574 7269  es will be retri
-0002f700: 6576 6564 2e0a 2020 2020 2020 2020 3a70  eved..        :p
-0002f710: 6172 616d 2073 7472 206f 6273 5f69 643a  aram str obs_id:
-0002f720: 204f 7074 696f 6e61 6c6c 792c 2061 2073   Optionally, a s
-0002f730: 7065 6369 6669 6320 6f62 735f 6964 2074  pecific obs_id t
-0002f740: 6f20 7365 6172 6368 2066 6f72 2063 616e  o search for can
-0002f750: 2062 6520 7375 7070 6c69 6564 2e20 5468   be supplied. Th
-0002f760: 6520 6465 6661 756c 7420 6973 204e 6f6e  e default is Non
-0002f770: 652c 0a20 2020 2020 2020 2020 2020 2077  e,.            w
-0002f780: 6869 6368 206d 6561 6e73 2061 6c6c 206c  hich means all l
-0002f790: 6967 6874 6375 7276 6573 206d 6174 6368  ightcurves match
-0002f7a0: 696e 6720 7468 6520 6f74 6865 7220 6372  ing the other cr
-0002f7b0: 6974 6572 6961 2077 696c 6c20 6265 2072  iteria will be r
-0002f7c0: 6574 7572 6e65 642e 0a20 2020 2020 2020  eturned..       
-0002f7d0: 203a 7061 7261 6d20 7374 7220 696e 7374   :param str inst
-0002f7e0: 3a20 4f70 7469 6f6e 616c 6c79 2c20 6120  : Optionally, a 
-0002f7f0: 7370 6563 6966 6963 2069 6e73 7472 756d  specific instrum
-0002f800: 656e 7420 746f 2073 6561 7263 6820 666f  ent to search fo
-0002f810: 7220 6361 6e20 6265 2073 7570 706c 6965  r can be supplie
-0002f820: 642e 2054 6865 2064 6566 6175 6c74 2069  d. The default i
-0002f830: 7320 4e6f 6e65 2c0a 2020 2020 2020 2020  s None,.        
-0002f840: 2020 2020 7768 6963 6820 6d65 616e 7320      which means 
-0002f850: 616c 6c20 6c69 6768 7463 7572 7665 7320  all lightcurves 
-0002f860: 6d61 7463 6869 6e67 2074 6865 206f 7468  matching the oth
-0002f870: 6572 2063 7269 7465 7269 6120 7769 6c6c  er criteria will
-0002f880: 2062 6520 7265 7475 726e 6564 2e0a 2020   be returned..  
-0002f890: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
-0002f8a0: 2f51 7561 6e74 6974 7920 696e 6e65 725f  /Quantity inner_
-0002f8b0: 7261 6469 7573 3a20 5468 6520 6e61 6d65  radius: The name
-0002f8c0: 206f 7220 7661 6c75 6520 6f66 2074 6865   or value of the
-0002f8d0: 2069 6e6e 6572 2072 6164 6975 7320 7468   inner radius th
-0002f8e0: 6174 2077 6173 2075 7365 6420 666f 7220  at was used for 
-0002f8f0: 7468 6520 6765 6e65 7261 7469 6f6e 206f  the generation o
-0002f900: 660a 2020 2020 2020 2020 2020 2020 7468  f.            th
-0002f910: 6520 6c69 6768 7463 7572 7665 2028 666f  e lightcurve (fo
-0002f920: 7220 696e 7374 616e 6365 2027 706f 696e  r instance 'poin
-0002f930: 7427 2077 6f75 6c64 2062 6520 6163 6365  t' would be acce
-0002f940: 7074 6162 6c65 2066 6f72 2061 2050 6f69  ptable for a Poi
-0002f950: 6e74 536f 7572 6365 2c20 6f72 2051 7561  ntSource, or Qua
-0002f960: 6e74 6974 7928 302c 2027 6b70 6327 2929  ntity(0, 'kpc'))
-0002f970: 2e0a 2020 2020 2020 2020 2020 2020 4465  ..            De
-0002f980: 6661 756c 7420 6973 204e 6f6e 652c 206d  fault is None, m
-0002f990: 6561 6e69 6e67 2061 6c6c 206c 6967 6874  eaning all light
-0002f9a0: 6375 7276 6573 2077 696c 6c20 6265 2072  curves will be r
-0002f9b0: 6574 7269 6576 6564 2e0a 2020 2020 2020  etrieved..      
-0002f9c0: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
-0002f9d0: 7920 6c6f 5f65 6e3a 2054 6865 206c 6f77  y lo_en: The low
-0002f9e0: 6572 2065 6e65 7267 7920 6c69 6d69 7420  er energy limit 
-0002f9f0: 6f66 2074 6865 206c 6967 6874 6375 7276  of the lightcurv
-0002fa00: 6573 2079 6f75 2077 6973 6820 746f 2072  es you wish to r
-0002fa10: 6574 7269 6576 652c 2074 6865 2064 6566  etrieve, the def
-0002fa20: 6175 6c74 0a20 2020 2020 2020 2020 2020  ault.           
-0002fa30: 2069 7320 4e6f 6e65 2028 7768 6963 6820   is None (which 
-0002fa40: 7769 6c6c 2072 6574 7269 6576 6520 616c  will retrieve al
-0002fa50: 6c20 6c69 6768 7463 7572 7665 7320 7265  l lightcurves re
-0002fa60: 6761 7264 6c65 7373 206f 6620 656e 6572  gardless of ener
-0002fa70: 6779 206c 696d 6974 292e 0a20 2020 2020  gy limit)..     
-0002fa80: 2020 203a 7061 7261 6d20 5175 616e 7469     :param Quanti
-0002fa90: 7479 2068 695f 656e 3a20 5468 6520 7570  ty hi_en: The up
-0002faa0: 7065 7220 656e 6572 6779 206c 696d 6974  per energy limit
-0002fab0: 206f 6620 7468 6520 6c69 6768 7463 7572   of the lightcur
-0002fac0: 7665 7320 796f 7520 7769 7368 2074 6f20  ves you wish to 
-0002fad0: 7265 7472 6965 7665 2c20 7468 6520 6465  retrieve, the de
-0002fae0: 6661 756c 740a 2020 2020 2020 2020 2020  fault.          
-0002faf0: 2020 6973 204e 6f6e 6520 2877 6869 6368    is None (which
-0002fb00: 2077 696c 6c20 7265 7472 6965 7665 2061   will retrieve a
-0002fb10: 6c6c 206c 6967 6874 6375 7276 6573 2072  ll lightcurves r
-0002fb20: 6567 6172 646c 6573 7320 6f66 2065 6e65  egardless of ene
-0002fb30: 7267 7920 6c69 6d69 7429 2e0a 2020 2020  rgy limit)..    
-0002fb40: 2020 2020 3a70 6172 616d 2051 7561 6e74      :param Quant
-0002fb50: 6974 7920 7469 6d65 5f62 696e 5f73 697a  ity time_bin_siz
-0002fb60: 653a 2054 6865 2074 696d 6520 6269 6e20  e: The time bin 
-0002fb70: 7369 7a65 2075 7365 6420 746f 2067 656e  size used to gen
-0002fb80: 6572 6174 6520 7468 6520 6465 7369 7265  erate the desire
-0002fb90: 6420 6c69 6768 7463 7572 7665 2e20 5468  d lightcurve. Th
-0002fba0: 6520 6465 6661 756c 7420 7661 6c75 650a  e default value.
-0002fbb0: 2020 2020 2020 2020 2020 2020 6973 204e              is N
-0002fbc0: 6f6e 652c 2069 6e20 7768 6963 6820 6361  one, in which ca
-0002fbd0: 7365 2061 6c6c 206c 6967 6874 6375 7276  se all lightcurv
-0002fbe0: 6573 206d 6174 6368 696e 6720 6f74 6865  es matching othe
-0002fbf0: 7220 6372 6974 6572 6961 2077 696c 6c20  r criteria will 
-0002fc00: 6265 2072 6574 7269 6576 6564 2e0a 2020  be retrieved..  
-0002fc10: 2020 2020 2020 3a70 6172 616d 2064 6963        :param dic
-0002fc20: 7420 7061 7474 6572 6e3a 2045 7665 6e74  t pattern: Event
-0002fc30: 2073 656c 6563 7469 6f6e 2070 6174 7465   selection patte
-0002fc40: 726e 7320 7573 6564 2074 6f20 6372 6561  rns used to crea
-0002fc50: 7465 206c 6967 6874 6375 7276 6573 206f  te lightcurves o
-0002fc60: 6620 696e 7465 7265 7374 2e20 5468 6520  f interest. The 
-0002fc70: 6465 6661 756c 7420 7661 6c75 6520 6973  default value is
-0002fc80: 0a20 2020 2020 2020 2020 2020 2027 6465  .            'de
-0002fc90: 6661 756c 7427 2077 6869 6368 2075 7365  fault' which use
-0002fca0: 7320 7468 6520 6465 6661 756c 7420 7661  s the default va
-0002fcb0: 6c75 6573 2066 6f72 2067 656e 6572 6174  lues for generat
-0002fcc0: 696e 6720 6c69 6768 7463 7572 7665 7320  ing lightcurves 
-0002fcd0: 666f 7220 6469 6666 6572 656e 7420 696e  for different in
-0002fce0: 7374 7275 6d65 6e74 732c 206f 7220 796f  struments, or yo
-0002fcf0: 750a 2020 2020 2020 2020 2020 2020 6361  u.            ca
-0002fd00: 6e20 7061 7373 2061 2064 6963 7469 6f6e  n pass a diction
-0002fd10: 6172 7920 7769 7468 2070 6174 7465 726e  ary with pattern
-0002fd20: 7320 696e 3b20 652e 672e 207b 2770 6e27  s in; e.g. {'pn'
-0002fd30: 3a20 273c 3d34 272c 2027 6d6f 7327 3a20  : '<=4', 'mos': 
-0002fd40: 273c 3d31 3227 7d2e 2059 6f75 2063 616e  '<=12'}. You can
-0002fd50: 2061 6c73 6f20 7061 7373 204e 6f6e 652c   also pass None,
-0002fd60: 2077 6869 6368 0a20 2020 2020 2020 2020   which.         
-0002fd70: 2020 206d 6561 6e73 2061 6c6c 206c 6967     means all lig
-0002fd80: 6874 2063 7572 7665 7320 6d61 7463 6869  ht curves matchi
-0002fd90: 6e67 206f 7468 6572 2073 6561 7263 6820  ng other search 
-0002fda0: 7465 726d 7320 7769 6c6c 2062 6520 7265  terms will be re
-0002fdb0: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
-0002fdc0: 3a72 6574 7572 6e3a 2041 6e20 5847 4120  :return: An XGA 
-0002fdd0: 4c69 6768 7443 7572 7665 206f 626a 6563  LightCurve objec
-0002fde0: 7420 2869 6620 7468 6572 6520 6973 2061  t (if there is a
-0002fdf0: 6e20 6578 6163 7420 6d61 7463 6829 2c20  n exact match), 
-0002fe00: 6f72 2061 206c 6973 7420 6f66 2058 4741  or a list of XGA
-0002fe10: 204c 6967 6874 4375 7276 6520 6f62 6a65   LightCurve obje
-0002fe20: 6374 7320 2869 6620 7468 6572 650a 2020  cts (if there.  
-0002fe30: 2020 2020 2020 2020 2020 7765 7265 206d            were m
-0002fe40: 756c 7469 706c 6520 6d61 7463 6869 6e67  ultiple matching
-0002fe50: 2070 726f 6475 6374 7329 2e0a 2020 2020   products)..    
-0002fe60: 2020 2020 3a72 7479 7065 3a20 556e 696f      :rtype: Unio
-0002fe70: 6e5b 4c69 6768 7443 7572 7665 2c20 4c69  n[LightCurve, Li
-0002fe80: 7374 5b4c 6967 6874 4375 7276 655d 5d0a  st[LightCurve]].
-0002fe90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0002fea0: 2020 2020 6672 6f6d 2078 6761 2e73 6173      from xga.sas
-0002feb0: 2069 6d70 6f72 7420 6368 6563 6b5f 7061   import check_pa
-0002fec0: 7474 6572 6e0a 0a20 2020 2020 2020 2023  ttern..        #
-0002fed0: 2054 4f44 4f20 5468 6973 2069 7320 584d   TODO This is XM
-0002fee0: 4d20 7370 6563 6966 6963 2062 6563 6175  M specific becau
-0002fef0: 7365 206f 6620 7468 6520 7061 7474 6572  se of the patter
-0002ff00: 6e73 2063 7572 7265 6e74 6c79 0a20 2020  ns currently.   
-0002ff10: 2020 2020 2023 2054 6869 7320 6973 2077       # This is w
-0002ff20: 6865 7265 2077 6520 7365 7420 7570 2074  here we set up t
-0002ff30: 6865 2073 6561 7263 6820 7374 7269 6e67  he search string
-0002ff40: 2066 6f72 2074 6865 2070 6174 7465 726e   for the pattern
-0002ff50: 7320 7370 6563 6966 6965 6420 6279 2074  s specified by t
-0002ff60: 6865 2075 7365 722e 0a20 2020 2020 2020  he user..       
-0002ff70: 2069 6620 7061 7474 6572 6e20 6973 204e   if pattern is N
-0002ff80: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002ff90: 2070 6174 745f 7365 6172 6368 203d 2022   patt_search = "
-0002ffa0: 5f70 6174 7465 726e 220a 2020 2020 2020  _pattern".      
-0002ffb0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0002ffc0: 6528 7061 7474 6572 6e2c 2073 7472 293a  e(pattern, str):
-0002ffd0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0002ffe0: 7465 726e 203d 207b 2770 6e27 3a20 273c  tern = {'pn': '<
-0002fff0: 3d34 272c 2027 6d6f 7327 3a20 273c 3d31  =4', 'mos': '<=1
-00030000: 3227 7d0a 2020 2020 2020 2020 2020 2020  2'}.            
-00030010: 7061 7474 5f73 6561 7263 6820 3d20 7b69  patt_search = {i
-00030020: 6e73 743a 2022 5f70 6174 7465 726e 2220  nst: "_pattern" 
-00030030: 2b20 6368 6563 6b5f 7061 7474 6572 6e28  + check_pattern(
-00030040: 7061 7474 295b 315d 2066 6f72 2069 6e73  patt)[1] for ins
-00030050: 742c 2070 6174 7420 696e 2070 6174 7465  t, patt in patte
-00030060: 726e 2e69 7465 6d73 2829 7d0a 2020 2020  rn.items()}.    
-00030070: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00030080: 6e63 6528 7061 7474 6572 6e2c 2064 6963  nce(pattern, dic
-00030090: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-000300a0: 6966 2027 6d6f 7331 2720 696e 206c 6973  if 'mos1' in lis
-000300b0: 7428 7061 7474 6572 6e2e 6b65 7973 2829  t(pattern.keys()
-000300c0: 2920 6f72 2027 6d6f 7332 2720 696e 206c  ) or 'mos2' in l
-000300d0: 6973 7428 7061 7474 6572 6e2e 6b65 7973  ist(pattern.keys
-000300e0: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
-000300f0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00030100: 4572 726f 7228 2253 7065 6369 6669 6320  Error("Specific 
-00030110: 4d4f 5320 696e 7374 7275 6d65 6e74 7320  MOS instruments 
-00030120: 646f 206e 6f74 206e 6565 6420 746f 2062  do not need to b
-00030130: 6520 7370 6563 6966 6965 6420 666f 7220  e specified for 
-00030140: 2770 6174 7465 726e 273b 2069 2e65 2e20  'pattern'; i.e. 
-00030150: 7468 6572 6520 220a 2020 2020 2020 2020  there ".        
-00030160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030170: 2020 2020 2020 2020 2022 7368 6f75 6c64           "should
-00030180: 2062 6520 6f6e 6520 656e 7472 7920 666f   be one entry fo
-00030190: 7220 276d 6f73 272e 2229 0a20 2020 2020  r 'mos'.").     
-000301a0: 2020 2020 2020 2070 6174 7465 726e 203d         pattern =
-000301b0: 207b 696e 7374 3a20 7061 7474 2e72 6570   {inst: patt.rep
-000301c0: 6c61 6365 2827 2027 2c20 2727 2920 666f  lace(' ', '') fo
-000301d0: 7220 696e 7374 2c20 7061 7474 2069 6e20  r inst, patt in 
-000301e0: 7061 7474 6572 6e2e 6974 656d 7328 297d  pattern.items()}
-000301f0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00030200: 745f 7365 6172 6368 203d 207b 696e 7374  t_search = {inst
-00030210: 3a20 225f 7061 7474 6572 6e22 202b 2063  : "_pattern" + c
-00030220: 6865 636b 5f70 6174 7465 726e 2870 6174  heck_pattern(pat
-00030230: 7429 5b31 5d20 666f 7220 696e 7374 2c20  t)[1] for inst, 
-00030240: 7061 7474 2069 6e20 7061 7474 6572 6e2e  patt in pattern.
-00030250: 6974 656d 7328 297d 0a20 2020 2020 2020  items()}.       
-00030260: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00030270: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-00030280: 6f72 2822 5468 6520 2770 6174 7465 726e  or("The 'pattern
-00030290: 2720 6172 6775 6d65 6e74 206d 7573 7420  ' argument must 
-000302a0: 6265 2065 6974 6865 7220 2764 6566 6175  be either 'defau
-000302b0: 6c74 272c 206f 7220 6120 6469 6374 696f  lt', or a dictio
-000302c0: 6e61 7279 2077 6865 7265 2074 6865 206b  nary where the k
-000302d0: 6579 7320 6172 6520 220a 2020 2020 2020  eys are ".      
-000302e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000302f0: 2020 2020 2020 2269 6e73 7472 756d 656e        "instrumen
-00030300: 7420 6e61 6d65 7320 616e 6420 7661 6c75  t names and valu
-00030310: 6573 2061 7265 2073 7472 696e 6720 7061  es are string pa
-00030320: 7474 6572 6e73 2e22 290a 0a20 2020 2020  tterns.")..     
-00030330: 2020 2023 204a 7573 7420 6d61 6b65 7320     # Just makes 
-00030340: 7468 6520 7365 6172 6368 2065 6173 6965  the search easie
-00030350: 7220 646f 776e 2074 6865 206c 696e 650a  r down the line.
-00030360: 2020 2020 2020 2020 6966 2027 6d6f 7327          if 'mos'
-00030370: 2069 6e20 7061 7474 5f73 6561 7263 683a   in patt_search:
-00030380: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00030390: 745f 7365 6172 6368 2e75 7064 6174 6528  t_search.update(
-000303a0: 7b27 6d6f 7331 273a 2070 6174 745f 7365  {'mos1': patt_se
-000303b0: 6172 6368 5b27 6d6f 7327 5d2c 2027 6d6f  arch['mos'], 'mo
-000303c0: 7332 273a 2070 6174 745f 7365 6172 6368  s2': patt_search
-000303d0: 5b27 6d6f 7327 5d7d 290a 0a20 2020 2020  ['mos']})..     
-000303e0: 2020 2073 6f6d 655f 6c63 7320 3d20 7365     some_lcs = se
-000303f0: 6c66 2e5f 6765 745f 6c63 5f70 726f 6428  lf._get_lc_prod(
-00030400: 6f75 7465 725f 7261 6469 7573 2c20 6f62  outer_radius, ob
-00030410: 735f 6964 2c20 696e 7374 2c20 696e 6e65  s_id, inst, inne
-00030420: 725f 7261 6469 7573 2c20 6c6f 5f65 6e2c  r_radius, lo_en,
-00030430: 2068 695f 656e 2c20 7469 6d65 5f62 696e   hi_en, time_bin
-00030440: 5f73 697a 6529 0a20 2020 2020 2020 206d  _size).        m
-00030450: 6174 6368 6564 5f70 726f 6473 203d 205b  atched_prods = [
-00030460: 5d0a 2020 2020 2020 2020 666f 7220 6c63  ].        for lc
-00030470: 2069 6e20 736f 6d65 5f6c 6373 3a0a 2020   in some_lcs:.  
-00030480: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00030490: 6e73 7461 6e63 6528 7061 7474 5f73 6561  nstance(patt_sea
-000304a0: 7263 682c 2073 7472 293a 0a20 2020 2020  rch, str):.     
-000304b0: 2020 2020 2020 2020 2020 2072 656c 5f70             rel_p
-000304c0: 6174 745f 7365 6172 6368 203d 2070 6174  att_search = pat
-000304d0: 745f 7365 6172 6368 0a20 2020 2020 2020  t_search.       
-000304e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000304f0: 2020 2020 2020 2020 2020 2072 656c 5f70             rel_p
-00030500: 6174 745f 7365 6172 6368 203d 2070 6174  att_search = pat
-00030510: 745f 7365 6172 6368 5b6c 632e 696e 7374  t_search[lc.inst
-00030520: 7275 6d65 6e74 5d0a 0a20 2020 2020 2020  rument]..       
-00030530: 2020 2020 2069 6620 7265 6c5f 7061 7474       if rel_patt
-00030540: 5f73 6561 7263 6820 696e 206c 632e 7374  _search in lc.st
-00030550: 6f72 6167 655f 6b65 793a 0a20 2020 2020  orage_key:.     
-00030560: 2020 2020 2020 2020 2020 206d 6174 6368             match
-00030570: 6564 5f70 726f 6473 2e61 7070 656e 6428  ed_prods.append(
-00030580: 6c63 290a 0a20 2020 2020 2020 2069 6620  lc)..        if 
-00030590: 6c65 6e28 6d61 7463 6865 645f 7072 6f64  len(matched_prod
-000305a0: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
-000305b0: 2020 2020 206d 6174 6368 6564 5f70 726f       matched_pro
-000305c0: 6473 203d 206d 6174 6368 6564 5f70 726f  ds = matched_pro
-000305d0: 6473 5b30 5d0a 2020 2020 2020 2020 656c  ds[0].        el
-000305e0: 6966 206c 656e 286d 6174 6368 6564 5f70  if len(matched_p
-000305f0: 726f 6473 2920 3d3d 2030 3a0a 2020 2020  rods) == 0:.    
-00030600: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-00030610: 5072 6f64 7563 7441 7661 696c 6162 6c65  ProductAvailable
-00030620: 4572 726f 7228 2243 616e 6e6f 7420 6669  Error("Cannot fi
-00030630: 6e64 2061 6e79 206c 6967 6874 6375 7276  nd any lightcurv
-00030640: 6573 206d 6174 6368 696e 6720 796f 7572  es matching your
-00030650: 2069 6e70 7574 2e22 290a 0a20 2020 2020   input.")..     
-00030660: 2020 2072 6574 7572 6e20 6d61 7463 6865     return matche
-00030670: 645f 7072 6f64 730a 0a20 2020 2064 6566  d_prods..    def
-00030680: 2067 6574 5f63 6f6d 6269 6e65 645f 6c69   get_combined_li
-00030690: 6768 7463 7572 7665 7328 7365 6c66 2c20  ghtcurves(self, 
-000306a0: 6f75 7465 725f 7261 6469 7573 3a20 556e  outer_radius: Un
-000306b0: 696f 6e5b 7374 722c 2051 7561 6e74 6974  ion[str, Quantit
-000306c0: 795d 203d 204e 6f6e 652c 0a20 2020 2020  y] = None,.     
-000306d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000306e0: 2020 2020 2020 2020 2020 2020 696e 6e65              inne
-000306f0: 725f 7261 6469 7573 3a20 556e 696f 6e5b  r_radius: Union[
-00030700: 7374 722c 2051 7561 6e74 6974 795d 203d  str, Quantity] =
-00030710: 204e 6f6e 652c 206c 6f5f 656e 3a20 5175   None, lo_en: Qu
-00030720: 616e 7469 7479 203d 204e 6f6e 652c 0a20  antity = None,. 
-00030730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030750: 6869 5f65 6e3a 2051 7561 6e74 6974 7920  hi_en: Quantity 
-00030760: 3d20 4e6f 6e65 2c20 7469 6d65 5f62 696e  = None, time_bin
-00030770: 5f73 697a 653a 2051 7561 6e74 6974 7920  _size: Quantity 
-00030780: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00030790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000307a0: 2020 2020 2020 2020 2070 6174 7465 726e           pattern
-000307b0: 3a20 556e 696f 6e5b 6469 6374 2c20 7374  : Union[dict, st
-000307c0: 725d 203d 2022 6465 6661 756c 7422 2920  r] = "default") 
-000307d0: 5c0a 2020 2020 2020 2020 2020 2020 2d3e  \.            ->
-000307e0: 2055 6e69 6f6e 5b41 6767 7265 6761 7465   Union[Aggregate
-000307f0: 4c69 6768 7443 7572 7665 2c20 4c69 7374  LightCurve, List
-00030800: 5b41 6767 7265 6761 7465 4c69 6768 7443  [AggregateLightC
-00030810: 7572 7665 5d5d 3a0a 2020 2020 2020 2020  urve]]:.        
-00030820: 2222 220a 2020 2020 2020 2020 4120 6d65  """.        A me
-00030830: 7468 6f64 2074 6f20 7265 7472 6965 7665  thod to retrieve
-00030840: 2058 4741 2041 6767 7265 6761 7465 4c69   XGA AggregateLi
-00030850: 6768 7443 7572 7665 206f 626a 6563 7473  ghtCurve objects
-00030860: 2028 692e 652e 206c 6967 6874 6375 7276   (i.e. lightcurv
-00030870: 6573 2066 6f72 2074 6869 7320 6f62 6a65  es for this obje
-00030880: 6374 2074 6861 7420 7765 7265 2067 656e  ct that were gen
-00030890: 6572 6174 6564 2061 740a 2020 2020 2020  erated at.      
-000308a0: 2020 7468 6520 7361 6d65 2074 696d 6520    the same time 
-000308b0: 616e 6420 6861 7665 2062 6565 6e20 7061  and have been pa
-000308c0: 636b 6167 6564 2074 6f67 6574 6865 7229  ckaged together)
-000308d0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-000308e0: 6d20 7374 722f 5175 616e 7469 7479 206f  m str/Quantity o
-000308f0: 7574 6572 5f72 6164 6975 733a 2054 6865  uter_radius: The
-00030900: 206e 616d 6520 6f72 2076 616c 7565 206f   name or value o
-00030910: 6620 7468 6520 6f75 7465 7220 7261 6469  f the outer radi
-00030920: 7573 2074 6861 7420 7761 7320 7573 6564  us that was used
-00030930: 2066 6f72 2074 6865 2067 656e 6572 6174   for the generat
-00030940: 696f 6e20 6f66 0a20 2020 2020 2020 2020  ion of.         
-00030950: 2020 2074 6865 2061 6767 7265 6761 7465     the aggregate
-00030960: 206c 6967 6874 6375 7276 6520 2866 6f72   lightcurve (for
-00030970: 2069 6e73 7461 6e63 6520 2770 6f69 6e74   instance 'point
-00030980: 2720 776f 756c 6420 6265 2061 6363 6570  ' would be accep
-00030990: 7461 626c 6520 666f 7220 6120 506f 696e  table for a Poin
-000309a0: 7453 6f75 7263 652c 206f 720a 2020 2020  tSource, or.    
-000309b0: 2020 2020 2020 2020 5175 616e 7469 7479          Quantity
-000309c0: 2831 3030 2c20 276b 7063 2729 292e 2044  (100, 'kpc')). D
-000309d0: 6566 6175 6c74 2069 7320 4e6f 6e65 2c20  efault is None, 
-000309e0: 6d65 616e 696e 6720 616c 6c20 6167 6772  meaning all aggr
-000309f0: 6567 6174 6520 6c69 6768 7463 7572 7665  egate lightcurve
-00030a00: 7320 7769 6c6c 2062 6520 7265 7472 6965  s will be retrie
-00030a10: 7665 642e 0a20 2020 2020 2020 203a 7061  ved..        :pa
-00030a20: 7261 6d20 7374 722f 5175 616e 7469 7479  ram str/Quantity
-00030a30: 2069 6e6e 6572 5f72 6164 6975 733a 2054   inner_radius: T
-00030a40: 6865 206e 616d 6520 6f72 2076 616c 7565  he name or value
-00030a50: 206f 6620 7468 6520 696e 6e65 7220 7261   of the inner ra
-00030a60: 6469 7573 2074 6861 7420 7761 7320 7573  dius that was us
-00030a70: 6564 2066 6f72 2074 6865 2067 656e 6572  ed for the gener
-00030a80: 6174 696f 6e20 6f66 0a20 2020 2020 2020  ation of.       
-00030a90: 2020 2020 2074 6865 2061 6767 7265 6761       the aggrega
-00030aa0: 7465 206c 6967 6874 6375 7276 6520 2866  te lightcurve (f
-00030ab0: 6f72 2069 6e73 7461 6e63 6520 2770 6f69  or instance 'poi
-00030ac0: 6e74 2720 776f 756c 6420 6265 2061 6363  nt' would be acc
-00030ad0: 6570 7461 626c 6520 666f 7220 6120 506f  eptable for a Po
-00030ae0: 696e 7453 6f75 7263 652c 206f 720a 2020  intSource, or.  
-00030af0: 2020 2020 2020 2020 2020 5175 616e 7469            Quanti
-00030b00: 7479 2830 2c20 276b 7063 2729 292e 2044  ty(0, 'kpc')). D
-00030b10: 6566 6175 6c74 2069 7320 4e6f 6e65 2c20  efault is None, 
-00030b20: 6d65 616e 696e 6720 616c 6c20 6167 6772  meaning all aggr
-00030b30: 6567 6174 6520 6c69 6768 7463 7572 7665  egate lightcurve
-00030b40: 7320 7769 6c6c 2062 6520 7265 7472 6965  s will be retrie
-00030b50: 7665 642e 0a20 2020 2020 2020 203a 7061  ved..        :pa
-00030b60: 7261 6d20 5175 616e 7469 7479 206c 6f5f  ram Quantity lo_
-00030b70: 656e 3a20 5468 6520 6c6f 7765 7220 656e  en: The lower en
-00030b80: 6572 6779 206c 696d 6974 206f 6620 7468  ergy limit of th
-00030b90: 6520 6167 6772 6567 6174 6520 6c69 6768  e aggregate ligh
-00030ba0: 7463 7572 7665 7320 796f 7520 7769 7368  tcurves you wish
-00030bb0: 2074 6f20 7265 7472 6965 7665 2c20 7468   to retrieve, th
-00030bc0: 6520 6465 6661 756c 740a 2020 2020 2020  e default.      
-00030bd0: 2020 2020 2020 6973 204e 6f6e 6520 2877        is None (w
-00030be0: 6869 6368 2077 696c 6c20 7265 7472 6965  hich will retrie
-00030bf0: 7665 2061 6c6c 2061 6767 7265 6761 7465  ve all aggregate
-00030c00: 206c 6967 6874 6375 7276 6573 2072 6567   lightcurves reg
-00030c10: 6172 646c 6573 7320 6f66 2065 6e65 7267  ardless of energ
-00030c20: 7920 6c69 6d69 7429 2e0a 2020 2020 2020  y limit)..      
-00030c30: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
-00030c40: 7920 6869 5f65 6e3a 2054 6865 2075 7070  y hi_en: The upp
-00030c50: 6572 2065 6e65 7267 7920 6c69 6d69 7420  er energy limit 
-00030c60: 6f66 2074 6865 2061 6767 7265 6761 7465  of the aggregate
-00030c70: 206c 6967 6874 6375 7276 6573 2079 6f75   lightcurves you
-00030c80: 2077 6973 6820 746f 2072 6574 7269 6576   wish to retriev
-00030c90: 652c 2074 6865 2064 6566 6175 6c74 0a20  e, the default. 
-00030ca0: 2020 2020 2020 2020 2020 2069 7320 4e6f             is No
-00030cb0: 6e65 2028 7768 6963 6820 7769 6c6c 2072  ne (which will r
-00030cc0: 6574 7269 6576 6520 616c 6c20 6167 6772  etrieve all aggr
-00030cd0: 6567 6174 6520 6c69 6768 7463 7572 7665  egate lightcurve
-00030ce0: 7320 7265 6761 7264 6c65 7373 206f 6620  s regardless of 
-00030cf0: 656e 6572 6779 206c 696d 6974 292e 0a20  energy limit).. 
-00030d00: 2020 2020 2020 203a 7061 7261 6d20 5175         :param Qu
-00030d10: 616e 7469 7479 2074 696d 655f 6269 6e5f  antity time_bin_
-00030d20: 7369 7a65 3a20 5468 6520 7469 6d65 2062  size: The time b
-00030d30: 696e 2073 697a 6520 7573 6564 2074 6f20  in size used to 
-00030d40: 6765 6e65 7261 7465 2074 6865 2064 6573  generate the des
-00030d50: 6972 6564 2061 6767 7265 6761 7465 206c  ired aggregate l
-00030d60: 6967 6874 6375 7276 652e 2054 6865 0a20  ightcurve. The. 
-00030d70: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00030d80: 6c74 2076 616c 7565 2069 7320 4e6f 6e65  lt value is None
-00030d90: 2c20 696e 2077 6869 6368 2063 6173 6520  , in which case 
-00030da0: 616c 6c20 6167 6772 6567 6174 6520 6c69  all aggregate li
-00030db0: 6768 7463 7572 7665 7320 6d61 7463 6869  ghtcurves matchi
-00030dc0: 6e67 206f 7468 6572 2063 7269 7465 7269  ng other criteri
-00030dd0: 6120 7769 6c6c 2062 6520 7265 7472 6965  a will be retrie
-00030de0: 7665 642e 0a20 2020 2020 2020 203a 7061  ved..        :pa
-00030df0: 7261 6d20 6469 6374 2070 6174 7465 726e  ram dict pattern
-00030e00: 3a20 4576 656e 7420 7365 6c65 6374 696f  : Event selectio
-00030e10: 6e20 7061 7474 6572 6e73 2075 7365 6420  n patterns used 
-00030e20: 746f 2063 7265 6174 6520 6167 6772 6567  to create aggreg
-00030e30: 6174 6520 6c69 6768 7463 7572 7665 7320  ate lightcurves 
-00030e40: 6f66 2069 6e74 6572 6573 742e 2054 6865  of interest. The
-00030e50: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
-00030e60: 2020 2020 2069 7320 2764 6566 6175 6c74       is 'default
-00030e70: 2720 7768 6963 6820 7573 6573 2074 6865  ' which uses the
-00030e80: 2064 6566 6175 6c74 2076 616c 7565 7320   default values 
-00030e90: 666f 7220 6765 6e65 7261 7469 6e67 206c  for generating l
-00030ea0: 6967 6874 6375 7276 6573 2066 6f72 2064  ightcurves for d
-00030eb0: 6966 6665 7265 6e74 2069 6e73 7472 756d  ifferent instrum
-00030ec0: 656e 7473 2c20 6f72 2079 6f75 0a20 2020  ents, or you.   
-00030ed0: 2020 2020 2020 2020 2063 616e 2070 6173           can pas
-00030ee0: 7320 6120 6469 6374 696f 6e61 7279 2077  s a dictionary w
-00030ef0: 6974 6820 7061 7474 6572 6e73 2069 6e3b  ith patterns in;
-00030f00: 2065 2e67 2e20 7b27 706e 273a 2027 3c3d   e.g. {'pn': '<=
-00030f10: 3427 2c20 276d 6f73 273a 2027 3c3d 3132  4', 'mos': '<=12
-00030f20: 277d 2e20 596f 7520 6361 6e20 616c 736f  '}. You can also
-00030f30: 2070 6173 7320 4e6f 6e65 2c20 7768 6963   pass None, whic
-00030f40: 680a 2020 2020 2020 2020 2020 2020 6d65  h.            me
-00030f50: 616e 7320 616c 6c20 6167 6772 6567 6174  ans all aggregat
-00030f60: 6520 206c 6967 6874 2063 7572 7665 7320  e  light curves 
-00030f70: 6d61 7463 6869 6e67 206f 7468 6572 2073  matching other s
-00030f80: 6561 7263 6820 7465 726d 7320 7769 6c6c  earch terms will
-00030f90: 2062 6520 7265 7475 726e 6564 2e0a 2020   be returned..  
-00030fa0: 2020 2020 2020 3a72 6574 7572 6e3a 2041        :return: A
-00030fb0: 6e20 5847 4120 4167 6772 6567 6174 654c  n XGA AggregateL
-00030fc0: 6967 6874 4375 7276 6520 6f62 6a65 6374  ightCurve object
-00030fd0: 2028 6966 2074 6865 7265 2069 7320 616e   (if there is an
-00030fe0: 2065 7861 6374 206d 6174 6368 292c 206f   exact match), o
-00030ff0: 7220 6120 6c69 7374 206f 6620 5847 4120  r a list of XGA 
-00031000: 4167 6772 6567 6174 654c 6967 6874 4375  AggregateLightCu
-00031010: 7276 650a 2020 2020 2020 2020 2020 2020  rve.            
-00031020: 6f62 6a65 6374 7320 2869 6620 7468 6572  objects (if ther
-00031030: 6520 7765 7265 206d 756c 7469 706c 6520  e were multiple 
-00031040: 6d61 7463 6869 6e67 2070 726f 6475 6374  matching product
-00031050: 7329 2e0a 2020 2020 2020 2020 3a72 7479  s)..        :rty
-00031060: 7065 3a20 556e 696f 6e5b 4167 6772 6567  pe: Union[Aggreg
-00031070: 6174 654c 6967 6874 4375 7276 652c 204c  ateLightCurve, L
-00031080: 6973 745b 4167 6772 6567 6174 654c 6967  ist[AggregateLig
-00031090: 6874 4375 7276 655d 5d0a 2020 2020 2020  htCurve]].      
-000310a0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-000310b0: 6f6d 2078 6761 2e73 6173 2069 6d70 6f72  om xga.sas impor
-000310c0: 7420 6368 6563 6b5f 7061 7474 6572 6e0a  t check_pattern.
-000310d0: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
-000310e0: 5468 6973 2069 7320 584d 4d20 7370 6563  This is XMM spec
-000310f0: 6966 6963 2062 6563 6175 7365 206f 6620  ific because of 
-00031100: 7468 6520 7061 7474 6572 6e73 2063 7572  the patterns cur
-00031110: 7265 6e74 6c79 0a20 2020 2020 2020 2023  rently.        #
-00031120: 2054 6869 7320 6973 2077 6865 7265 2077   This is where w
-00031130: 6520 7365 7420 7570 2074 6865 2073 6561  e set up the sea
-00031140: 7263 6820 7374 7269 6e67 2066 6f72 2074  rch string for t
-00031150: 6865 2070 6174 7465 726e 7320 7370 6563  he patterns spec
-00031160: 6966 6965 6420 6279 2074 6865 2075 7365  ified by the use
-00031170: 722e 0a20 2020 2020 2020 2069 6620 7061  r..        if pa
-00031180: 7474 6572 6e20 6973 204e 6f6e 653a 0a20  ttern is None:. 
-00031190: 2020 2020 2020 2020 2020 2070 6174 745f             patt_
-000311a0: 7365 6172 6368 203d 2022 7061 7474 6572  search = "patter
-000311b0: 6e22 0a20 2020 2020 2020 2065 6c69 6620  n".        elif 
-000311c0: 6973 696e 7374 616e 6365 2870 6174 7465  isinstance(patte
-000311d0: 726e 2c20 7374 7229 3a0a 2020 2020 2020  rn, str):.      
-000311e0: 2020 2020 2020 7061 7474 6572 6e20 3d20        pattern = 
-000311f0: 7b27 706e 273a 2027 3c3d 3427 2c20 276d  {'pn': '<=4', 'm
-00031200: 6f73 273a 2027 3c3d 3132 277d 0a20 2020  os': '<=12'}.   
-00031210: 2020 2020 2020 2020 2070 6174 745f 7365           patt_se
-00031220: 6172 6368 203d 207b 696e 7374 3a20 225f  arch = {inst: "_
-00031230: 7b69 7d70 6174 7465 726e 222e 666f 726d  {i}pattern".form
-00031240: 6174 2869 3d69 6e73 7429 202b 2063 6865  at(i=inst) + che
-00031250: 636b 5f70 6174 7465 726e 2870 6174 7429  ck_pattern(patt)
-00031260: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-00031270: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00031280: 6f72 2069 6e73 742c 2070 6174 7420 696e  or inst, patt in
-00031290: 2070 6174 7465 726e 2e69 7465 6d73 2829   pattern.items()
-000312a0: 7d0a 2020 2020 2020 2020 656c 6966 2069  }.        elif i
-000312b0: 7369 6e73 7461 6e63 6528 7061 7474 6572  sinstance(patter
-000312c0: 6e2c 2064 6963 7429 3a0a 2020 2020 2020  n, dict):.      
-000312d0: 2020 2020 2020 6966 2027 6d6f 7331 2720        if 'mos1' 
-000312e0: 696e 206c 6973 7428 7061 7474 6572 6e2e  in list(pattern.
-000312f0: 6b65 7973 2829 2920 6f72 2027 6d6f 7332  keys()) or 'mos2
-00031300: 2720 696e 206c 6973 7428 7061 7474 6572  ' in list(patter
-00031310: 6e2e 6b65 7973 2829 293a 0a20 2020 2020  n.keys()):.     
-00031320: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00031330: 2056 616c 7565 4572 726f 7228 2253 7065   ValueError("Spe
-00031340: 6369 6669 6320 4d4f 5320 696e 7374 7275  cific MOS instru
-00031350: 6d65 6e74 7320 646f 206e 6f74 206e 6565  ments do not nee
-00031360: 6420 746f 2062 6520 7370 6563 6966 6965  d to be specifie
-00031370: 6420 666f 7220 2770 6174 7465 726e 273b  d for 'pattern';
-00031380: 2069 2e65 2e20 7468 6572 6520 220a 2020   i.e. there ".  
-00031390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000313a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000313b0: 7368 6f75 6c64 2062 6520 6f6e 6520 656e  should be one en
-000313c0: 7472 7920 666f 7220 276d 6f73 272e 2229  try for 'mos'.")
-000313d0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-000313e0: 7465 726e 203d 207b 696e 7374 3a20 7061  tern = {inst: pa
-000313f0: 7474 2e72 6570 6c61 6365 2827 2027 2c20  tt.replace(' ', 
-00031400: 2727 2920 666f 7220 696e 7374 2c20 7061  '') for inst, pa
-00031410: 7474 2069 6e20 7061 7474 6572 6e2e 6974  tt in pattern.it
-00031420: 656d 7328 297d 0a20 2020 2020 2020 2020  ems()}.         
-00031430: 2020 2070 6174 745f 7365 6172 6368 203d     patt_search =
-00031440: 207b 696e 7374 3a20 225f 7b69 7d70 6174   {inst: "_{i}pat
-00031450: 7465 726e 222e 666f 726d 6174 2869 3d69  tern".format(i=i
-00031460: 6e73 7429 202b 2063 6865 636b 5f70 6174  nst) + check_pat
-00031470: 7465 726e 2870 6174 7429 5b31 5d0a 2020  tern(patt)[1].  
-00031480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031490: 2020 2020 2020 2020 2066 6f72 2069 6e73           for ins
-000314a0: 742c 2070 6174 7420 696e 2070 6174 7465  t, patt in patte
-000314b0: 726e 2e69 7465 6d73 2829 7d0a 2020 2020  rn.items()}.    
-000314c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000314d0: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-000314e0: 4572 726f 7228 2254 6865 2027 7061 7474  Error("The 'patt
-000314f0: 6572 6e27 2061 7267 756d 656e 7420 6d75  ern' argument mu
-00031500: 7374 2062 6520 6569 7468 6572 2027 6465  st be either 'de
-00031510: 6661 756c 7427 2c20 6f72 2061 2064 6963  fault', or a dic
-00031520: 7469 6f6e 6172 7920 7768 6572 6520 7468  tionary where th
-00031530: 6520 6b65 7973 2061 7265 2022 0a20 2020  e keys are ".   
-00031540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031550: 2020 2020 2020 2020 2022 696e 7374 7275           "instru
-00031560: 6d65 6e74 206e 616d 6573 2061 6e64 2076  ment names and v
-00031570: 616c 7565 7320 6172 6520 7374 7269 6e67  alues are string
-00031580: 2070 6174 7465 726e 732e 2229 0a0a 2020   patterns.")..  
-00031590: 2020 2020 2020 2320 5573 6520 7468 6520        # Use the 
-000315a0: 696e 7465 726e 616c 2066 756e 6374 696f  internal functio
-000315b0: 6e20 746f 2066 696e 6420 7468 6520 636f  n to find the co
-000315c0: 6d62 696e 6564 206c 6967 6874 2063 7572  mbined light cur
-000315d0: 7665 732c 2074 6865 6e20 6170 706c 7920  ves, then apply 
-000315e0: 7061 7474 6572 6e20 6368 6563 6b73 2061  pattern checks a
-000315f0: 6674 6572 0a20 2020 2020 2020 2073 6f6d  fter.        som
-00031600: 655f 6c63 7320 3d20 7365 6c66 2e5f 6765  e_lcs = self._ge
-00031610: 745f 6c63 5f70 726f 6428 6f75 7465 725f  t_lc_prod(outer_
-00031620: 7261 6469 7573 2c20 2763 6f6d 6269 6e65  radius, 'combine
-00031630: 6427 2c20 4e6f 6e65 2c20 696e 6e65 725f  d', None, inner_
-00031640: 7261 6469 7573 2c20 6c6f 5f65 6e2c 2068  radius, lo_en, h
-00031650: 695f 656e 2c20 7469 6d65 5f62 696e 5f73  i_en, time_bin_s
-00031660: 697a 6529 0a20 2020 2020 2020 206d 6174  ize).        mat
-00031670: 6368 6564 5f70 726f 6473 203d 205b 5d0a  ched_prods = [].
-00031680: 2020 2020 2020 2020 666f 7220 6c63 2069          for lc i
-00031690: 6e20 736f 6d65 5f6c 6373 3a0a 2020 2020  n some_lcs:.    
-000316a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000316b0: 7461 6e63 6528 7061 7474 5f73 6561 7263  tance(patt_searc
-000316c0: 682c 2073 7472 293a 0a20 2020 2020 2020  h, str):.       
-000316d0: 2020 2020 2020 2020 2072 656c 5f70 6174           rel_pat
-000316e0: 745f 7365 6172 6368 203d 205b 7061 7474  t_search = [patt
-000316f0: 5f73 6561 7263 685d 0a20 2020 2020 2020  _search].       
-00031700: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00031710: 2020 2020 2020 2020 2020 2072 656c 5f70             rel_p
-00031720: 6174 745f 7365 6172 6368 203d 205b 7061  att_search = [pa
-00031730: 7474 2066 6f72 2069 6e73 742c 2070 6174  tt for inst, pat
-00031740: 7420 696e 2070 6174 745f 7365 6172 6368  t in patt_search
-00031750: 2e69 7465 6d73 2829 5d0a 0a20 2020 2020  .items()]..     
-00031760: 2020 2020 2020 2069 6620 616c 6c28 5b72         if all([r
-00031770: 7073 2069 6e20 6c63 2e73 746f 7261 6765  ps in lc.storage
-00031780: 5f6b 6579 2066 6f72 2072 7073 2069 6e20  _key for rps in 
-00031790: 7265 6c5f 7061 7474 5f73 6561 7263 685d  rel_patt_search]
-000317a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000317b0: 2020 206d 6174 6368 6564 5f70 726f 6473     matched_prods
-000317c0: 2e61 7070 656e 6428 6c63 290a 0a20 2020  .append(lc)..   
-000317d0: 2020 2020 2069 6620 6c65 6e28 6d61 7463       if len(matc
-000317e0: 6865 645f 7072 6f64 7329 203d 3d20 313a  hed_prods) == 1:
-000317f0: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
-00031800: 6368 6564 5f70 726f 6473 203d 206d 6174  ched_prods = mat
-00031810: 6368 6564 5f70 726f 6473 5b30 5d0a 2020  ched_prods[0].  
-00031820: 2020 2020 2020 656c 6966 206c 656e 286d        elif len(m
-00031830: 6174 6368 6564 5f70 726f 6473 2920 3d3d  atched_prods) ==
-00031840: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00031850: 7261 6973 6520 4e6f 5072 6f64 7563 7441  raise NoProductA
-00031860: 7661 696c 6162 6c65 4572 726f 7228 2243  vailableError("C
-00031870: 616e 6e6f 7420 6669 6e64 2061 6e79 206c  annot find any l
-00031880: 6967 6874 6375 7276 6573 206d 6174 6368  ightcurves match
-00031890: 696e 6720 796f 7572 2069 6e70 7574 2e22  ing your input."
-000318a0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000318b0: 6e20 6d61 7463 6865 645f 7072 6f64 730a  n matched_prods.
-000318c0: 0a20 2020 2023 2054 6865 2063 6f6d 6269  .    # The combi
-000318d0: 6e65 6420 7068 6f74 6f6d 6574 7269 6320  ned photometric 
-000318e0: 7072 6f64 7563 7473 2064 6f6e 2774 2072  products don't r
-000318f0: 6561 6c6c 7920 4e45 4544 2074 6865 6972  eally NEED their
-00031900: 206f 776e 2067 6574 206d 6574 686f 6473   own get methods
-00031910: 2c20 6275 7420 4920 6669 6775 7265 6420  , but I figured 
-00031920: 4920 776f 756c 6420 6a75 7374 2066 6f72  I would just for
-00031930: 0a20 2020 2023 2020 636c 6172 6974 7927  .    #  clarity'
-00031940: 7320 7361 6b65 0a20 2020 2064 6566 2067  s sake.    def g
-00031950: 6574 5f63 6f6d 6269 6e65 645f 696d 6167  et_combined_imag
-00031960: 6573 2873 656c 662c 206c 6f5f 656e 3a20  es(self, lo_en: 
-00031970: 5175 616e 7469 7479 203d 204e 6f6e 652c  Quantity = None,
-00031980: 2068 695f 656e 3a20 5175 616e 7469 7479   hi_en: Quantity
-00031990: 203d 204e 6f6e 652c 2070 7366 5f63 6f72   = None, psf_cor
-000319a0: 723a 2062 6f6f 6c20 3d20 4661 6c73 652c  r: bool = False,
-000319b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000319c0: 2020 2020 2020 2020 2020 2020 2070 7366               psf
-000319d0: 5f6d 6f64 656c 3a20 7374 7220 3d20 2245  _model: str = "E
-000319e0: 4c4c 4245 5441 222c 2070 7366 5f62 696e  LLBETA", psf_bin
-000319f0: 733a 2069 6e74 203d 2034 2c20 7073 665f  s: int = 4, psf_
-00031a00: 616c 676f 3a20 7374 7220 3d20 2272 6c22  algo: str = "rl"
-00031a10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00031a20: 2020 2020 2020 2020 2020 2020 2020 7073                ps
-00031a30: 665f 6974 6572 3a20 696e 7420 3d20 3135  f_iter: int = 15
-00031a40: 2920 2d3e 2055 6e69 6f6e 5b49 6d61 6765  ) -> Union[Image
-00031a50: 2c20 4c69 7374 5b49 6d61 6765 5d5d 3a0a  , List[Image]]:.
-00031a60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00031a70: 2020 2020 4120 6d65 7468 6f64 2074 6f20      A method to 
-00031a80: 7265 7472 6965 7665 2063 6f6d 6269 6e65  retrieve combine
-00031a90: 6420 5847 4120 496d 6167 6520 6f62 6a65  d XGA Image obje
-00031aa0: 6374 732c 2061 7320 696e 2074 686f 7365  cts, as in those
-00031ab0: 2069 6d61 6765 7320 7468 6174 2068 6176   images that hav
-00031ac0: 6520 6265 656e 2063 7265 6174 6564 2062  e been created b
-00031ad0: 790a 2020 2020 2020 2020 6d65 7267 696e  y.        mergin
-00031ae0: 6720 616c 6c20 6176 6169 6c61 626c 6520  g all available 
-00031af0: 6461 7461 2066 6f72 2074 6869 7320 736f  data for this so
-00031b00: 7572 6365 2e20 5468 6973 2073 7570 706f  urce. This suppo
-00031b10: 7274 7320 7468 6520 7265 7472 6965 7661  rts the retrieva
-00031b20: 6c20 6f66 2062 6f74 6820 5053 4620 636f  l of both PSF co
-00031b30: 7272 6563 7465 6420 616e 6420 6e6f 6e2d  rrected and non-
-00031b40: 5053 460a 2020 2020 2020 2020 636f 7272  PSF.        corr
-00031b50: 6563 7465 6420 696d 6167 6573 2c20 6173  ected images, as
-00031b60: 2077 656c 6c20 6173 2073 6574 7469 6e67   well as setting
-00031b70: 2074 6865 2065 6e65 7267 7920 6c69 6d69   the energy limi
-00031b80: 7473 206f 6620 7468 6520 7370 6563 6966  ts of the specif
-00031b90: 6963 2069 6d61 6765 2079 6f75 2077 6f75  ic image you wou
-00031ba0: 6c64 206c 696b 652e 2041 0a20 2020 2020  ld like. A.     
-00031bb0: 2020 204e 6f50 726f 6475 6374 4176 6169     NoProductAvai
-00031bc0: 6c61 626c 6545 7272 6f72 2065 7272 6f72  lableError error
-00031bd0: 2077 696c 6c20 6265 2072 6169 7365 6420   will be raised 
-00031be0: 6966 206e 6f20 6d61 7463 6865 7320 6172  if no matches ar
-00031bf0: 6520 666f 756e 642e 0a0a 2020 2020 2020  e found...      
-00031c00: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
-00031c10: 7920 6c6f 5f65 6e3a 2054 6865 206c 6f77  y lo_en: The low
-00031c20: 6572 2065 6e65 7267 7920 6c69 6d69 7420  er energy limit 
-00031c30: 6f66 2074 6865 2069 6d61 6765 2079 6f75  of the image you
-00031c40: 2077 6973 6820 746f 2072 6574 7269 6576   wish to retriev
-00031c50: 652c 2074 6865 2064 6566 6175 6c74 0a20  e, the default. 
-00031c60: 2020 2020 2020 2020 2020 2069 7320 4e6f             is No
-00031c70: 6e65 2028 7768 6963 6820 7769 6c6c 2072  ne (which will r
-00031c80: 6574 7269 6576 6520 616c 6c20 696d 6167  etrieve all imag
-00031c90: 6573 2072 6567 6172 646c 6573 7320 6f66  es regardless of
-00031ca0: 2065 6e65 7267 7920 6c69 6d69 7429 2e0a   energy limit)..
-00031cb0: 2020 2020 2020 2020 3a70 6172 616d 2051          :param Q
-00031cc0: 7561 6e74 6974 7920 6869 5f65 6e3a 2054  uantity hi_en: T
-00031cd0: 6865 2075 7070 6572 2065 6e65 7267 7920  he upper energy 
-00031ce0: 6c69 6d69 7420 6f66 2074 6865 2069 6d61  limit of the ima
-00031cf0: 6765 2079 6f75 2077 6973 6820 746f 2072  ge you wish to r
-00031d00: 6574 7269 6576 652c 2074 6865 2064 6566  etrieve, the def
-00031d10: 6175 6c74 0a20 2020 2020 2020 2020 2020  ault.           
-00031d20: 2069 7320 4e6f 6e65 2028 7768 6963 6820   is None (which 
-00031d30: 7769 6c6c 2072 6574 7269 6576 6520 616c  will retrieve al
-00031d40: 6c20 696d 6167 6573 2072 6567 6172 646c  l images regardl
-00031d50: 6573 7320 6f66 2065 6e65 7267 7920 6c69  ess of energy li
-00031d60: 6d69 7429 2e0a 2020 2020 2020 2020 3a70  mit)..        :p
-00031d70: 6172 616d 2062 6f6f 6c20 7073 665f 636f  aram bool psf_co
-00031d80: 7272 3a20 5365 7473 2077 6865 7468 6572  rr: Sets whether
-00031d90: 2079 6f75 2077 6973 6820 746f 2072 6574   you wish to ret
-00031da0: 7269 6576 6520 6120 5053 4620 636f 7272  rieve a PSF corr
-00031db0: 6563 7465 6420 696d 6167 6520 6f72 206e  ected image or n
-00031dc0: 6f74 2e0a 2020 2020 2020 2020 3a70 6172  ot..        :par
-00031dd0: 616d 2073 7472 2070 7366 5f6d 6f64 656c  am str psf_model
-00031de0: 3a20 4966 2074 6865 2069 6d61 6765 2079  : If the image y
-00031df0: 6f75 2077 616e 7420 6973 2050 5346 2063  ou want is PSF c
-00031e00: 6f72 7265 6374 6564 2c20 7468 6973 2069  orrected, this i
-00031e10: 7320 7468 6520 5053 4620 6d6f 6465 6c20  s the PSF model 
-00031e20: 7573 6564 2e0a 2020 2020 2020 2020 3a70  used..        :p
-00031e30: 6172 616d 2069 6e74 2070 7366 5f62 696e  aram int psf_bin
-00031e40: 733a 2049 6620 7468 6520 696d 6167 6520  s: If the image 
-00031e50: 796f 7520 7761 6e74 2069 7320 5053 4620  you want is PSF 
-00031e60: 636f 7272 6563 7465 642c 2074 6869 7320  corrected, this 
-00031e70: 6973 2074 6865 206e 756d 6265 7220 6f66  is the number of
-00031e80: 2050 5346 7320 7065 720a 2020 2020 2020   PSFs per.      
-00031e90: 2020 2020 2020 7369 6465 2069 6e20 7468        side in th
-00031ea0: 6520 5053 4620 6772 6964 2e0a 2020 2020  e PSF grid..    
-00031eb0: 2020 2020 3a70 6172 616d 2073 7472 2070      :param str p
-00031ec0: 7366 5f61 6c67 6f3a 2049 6620 7468 6520  sf_algo: If the 
-00031ed0: 696d 6167 6520 796f 7520 7761 6e74 2069  image you want i
-00031ee0: 7320 5053 4620 636f 7272 6563 7465 642c  s PSF corrected,
-00031ef0: 2074 6869 7320 6973 2074 6865 2061 6c67   this is the alg
-00031f00: 6f72 6974 686d 2075 7365 642e 0a20 2020  orithm used..   
-00031f10: 2020 2020 203a 7061 7261 6d20 696e 7420       :param int 
-00031f20: 7073 665f 6974 6572 3a20 4966 2074 6865  psf_iter: If the
-00031f30: 2069 6d61 6765 2079 6f75 2077 616e 7420   image you want 
-00031f40: 6973 2050 5346 2063 6f72 7265 6374 6564  is PSF corrected
-00031f50: 2c20 7468 6973 2069 7320 7468 6520 6e75  , this is the nu
-00031f60: 6d62 6572 206f 6620 6974 6572 6174 696f  mber of iteratio
-00031f70: 6e73 2e0a 2020 2020 2020 2020 3a72 6574  ns..        :ret
-00031f80: 7572 6e3a 2041 6e20 5847 4120 496d 6167  urn: An XGA Imag
-00031f90: 6520 6f62 6a65 6374 2028 6966 2074 6865  e object (if the
-00031fa0: 7265 2069 7320 616e 2065 7861 6374 206d  re is an exact m
-00031fb0: 6174 6368 292c 206f 7220 6120 6c69 7374  atch), or a list
-00031fc0: 206f 6620 5847 4120 496d 6167 6520 6f62   of XGA Image ob
-00031fd0: 6a65 6374 7320 2869 6620 7468 6572 650a  jects (if there.
-00031fe0: 2020 2020 2020 2020 2020 2020 7765 7265              were
-00031ff0: 206d 756c 7469 706c 6520 6d61 7463 6869   multiple matchi
-00032000: 6e67 2070 726f 6475 6374 7329 2e0a 2020  ng products)..  
-00032010: 2020 2020 2020 3a72 7479 7065 3a20 556e        :rtype: Un
-00032020: 696f 6e5b 496d 6167 652c 204c 6973 745b  ion[Image, List[
-00032030: 496d 6167 655d 5d0a 2020 2020 2020 2020  Image]].        
-00032040: 2222 220a 0a20 2020 2020 2020 2023 2043  """..        # C
-00032050: 6865 636b 7320 746f 206d 616b 6520 7375  hecks to make su
-00032060: 7265 2074 6861 7420 616e 2061 6c6c 6f77  re that an allow
-00032070: 6564 2063 6f6d 6269 6e61 7469 6f6e 206f  ed combination o
-00032080: 6620 6c6f 5f65 6e20 616e 6420 6869 5f65  f lo_en and hi_e
-00032090: 6e20 6861 7320 6265 656e 2070 6173 7365  n has been passe
-000320a0: 642e 0a20 2020 2020 2020 2069 6620 616c  d..        if al
-000320b0: 6c28 5b6c 6f5f 656e 2069 7320 4e6f 6e65  l([lo_en is None
-000320c0: 2c20 6869 5f65 6e20 6973 204e 6f6e 655d  , hi_en is None]
-000320d0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-000320e0: 2053 6574 7320 6120 666c 6167 2074 6f20   Sets a flag to 
-000320f0: 7465 6c6c 2074 6865 2072 6573 7420 6f66  tell the rest of
-00032100: 2074 6865 206d 6574 686f 6420 7768 6574   the method whet
-00032110: 6865 7220 7765 2068 6176 6520 656e 6572  her we have ener
-00032120: 6779 206c 696d 7320 6f72 206e 6f74 0a20  gy lims or not. 
-00032130: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-00032140: 6c69 6d73 203d 2046 616c 7365 0a20 2020  lims = False.   
-00032150: 2020 2020 2020 2020 2065 6e65 7267 795f           energy_
-00032160: 6b65 7920 3d20 4e6f 6e65 0a20 2020 2020  key = None.     
-00032170: 2020 2065 6c69 6620 616c 6c28 5b6c 6f5f     elif all([lo_
-00032180: 656e 2069 7320 6e6f 7420 4e6f 6e65 2c20  en is not None, 
-00032190: 6869 5f65 6e20 6973 206e 6f74 204e 6f6e  hi_en is not Non
-000321a0: 655d 293a 0a20 2020 2020 2020 2020 2020  e]):.           
-000321b0: 2077 6974 685f 6c69 6d73 203d 2054 7275   with_lims = Tru
-000321c0: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
-000321d0: 5765 2068 6176 6520 656e 6572 6779 206c  We have energy l
-000321e0: 696d 6974 7320 6865 7265 2073 6f20 7765  imits here so we
-000321f0: 2061 7373 656d 626c 6520 7468 6520 6b65   assemble the ke
-00032200: 7920 7468 6174 2064 6573 6372 6962 6573  y that describes
-00032210: 2074 6865 2065 6e65 7267 7920 7261 6e67   the energy rang
-00032220: 650a 2020 2020 2020 2020 2020 2020 656e  e.            en
-00032230: 6572 6779 5f6b 6579 203d 2022 626f 756e  ergy_key = "boun
-00032240: 645f 7b6c 7d2d 7b68 7d22 2e66 6f72 6d61  d_{l}-{h}".forma
-00032250: 7428 6c3d 6c6f 5f65 6e2e 746f 2827 6b65  t(l=lo_en.to('ke
-00032260: 5627 292e 7661 6c75 652c 2068 3d68 695f  V').value, h=hi_
-00032270: 656e 2e74 6f28 276b 6556 2729 2e76 616c  en.to('keV').val
-00032280: 7565 290a 2020 2020 2020 2020 656c 7365  ue).        else
-00032290: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000322a0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-000322b0: 6c6f 5f65 6e20 616e 6420 6869 5f65 6e20  lo_en and hi_en 
-000322c0: 6d75 7374 2062 6520 6569 7468 6572 2042  must be either B
-000322d0: 4f54 4820 4e6f 6e65 206f 7220 424f 5448  OTH None or BOTH
-000322e0: 2061 6e20 4173 7472 6f70 7920 7175 616e   an Astropy quan
-000322f0: 7469 7479 2e22 290a 0a20 2020 2020 2020  tity.")..       
-00032300: 2023 2049 6620 7765 2061 7265 206c 6f6f   # If we are loo
-00032310: 6b69 6e67 2066 6f72 2061 2050 5346 2063  king for a PSF c
-00032320: 6f72 7265 6374 6564 2069 6d61 6765 2074  orrected image t
-00032330: 6865 6e20 7765 2061 7373 656d 626c 6520  hen we assemble 
-00032340: 7468 6520 6578 7472 6120 6b65 7920 7769  the extra key wi
-00032350: 7468 2050 5346 2064 6574 6169 6c73 0a20  th PSF details. 
-00032360: 2020 2020 2020 2069 6620 7073 665f 636f         if psf_co
-00032370: 7272 3a0a 2020 2020 2020 2020 2020 2020  rr:.            
-00032380: 6578 7472 615f 6b65 7920 3d20 225f 2220  extra_key = "_" 
-00032390: 2b20 7073 665f 6d6f 6465 6c20 2b20 225f  + psf_model + "_
-000323a0: 2220 2b20 7374 7228 7073 665f 6269 6e73  " + str(psf_bins
-000323b0: 2920 2b20 225f 2220 2b20 7073 665f 616c  ) + "_" + psf_al
-000323c0: 676f 202b 2073 7472 2870 7366 5f69 7465  go + str(psf_ite
-000323d0: 7229 0a0a 2020 2020 2020 2020 6966 206e  r)..        if n
-000323e0: 6f74 2070 7366 5f63 6f72 7220 616e 6420  ot psf_corr and 
-000323f0: 7769 7468 5f6c 696d 733a 0a20 2020 2020  with_lims:.     
-00032400: 2020 2020 2020 2023 2053 696d 706c 6573         # Simples
-00032410: 7420 6361 7365 2c20 6a75 7374 2063 616c  t case, just cal
-00032420: 6c69 6e67 2067 6574 5f70 726f 6475 6374  ling get_product
-00032430: 7320 616e 6420 7061 7373 696e 6720 696e  s and passing in
-00032440: 206f 7572 2069 6e66 6f72 6d61 7469 6f6e   our information
-00032450: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
-00032460: 6368 6564 5f70 726f 6473 203d 2073 656c  ched_prods = sel
-00032470: 662e 6765 745f 7072 6f64 7563 7473 2827  f.get_products('
-00032480: 636f 6d62 696e 6564 5f69 6d61 6765 272c  combined_image',
-00032490: 2065 7874 7261 5f6b 6579 3d65 6e65 7267   extra_key=energ
-000324a0: 795f 6b65 7929 0a20 2020 2020 2020 2065  y_key).        e
-000324b0: 6c69 6620 6e6f 7420 7073 665f 636f 7272  lif not psf_corr
-000324c0: 2061 6e64 206e 6f74 2077 6974 685f 6c69   and not with_li
-000324d0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-000324e0: 6272 6f61 645f 6d61 7463 6865 7320 3d20  broad_matches = 
-000324f0: 7365 6c66 2e67 6574 5f70 726f 6475 6374  self.get_product
-00032500: 7328 2263 6f6d 6269 6e65 645f 696d 6167  s("combined_imag
-00032510: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-00032520: 6d61 7463 6865 645f 7072 6f64 7320 3d20  matched_prods = 
-00032530: 5b70 2066 6f72 2070 2069 6e20 6272 6f61  [p for p in broa
-00032540: 645f 6d61 7463 6865 7320 6966 206e 6f74  d_matches if not
-00032550: 2070 2e70 7366 5f63 6f72 7265 6374 6564   p.psf_corrected
-00032560: 5d0a 2020 2020 2020 2020 656c 6966 2070  ].        elif p
-00032570: 7366 5f63 6f72 7220 616e 6420 7769 7468  sf_corr and with
-00032580: 5f6c 696d 733a 0a20 2020 2020 2020 2020  _lims:.         
-00032590: 2020 2023 2048 6572 6520 7765 206e 6565     # Here we nee
-000325a0: 6420 746f 2061 6464 2074 6865 2065 7874  d to add the ext
-000325b0: 7261 206b 6579 2074 6f20 7468 6520 656e  ra key to the en
-000325c0: 6572 6779 206b 6579 0a20 2020 2020 2020  ergy key.       
-000325d0: 2020 2020 206d 6174 6368 6564 5f70 726f       matched_pro
-000325e0: 6473 203d 2073 656c 662e 6765 745f 7072  ds = self.get_pr
-000325f0: 6f64 7563 7473 2827 636f 6d62 696e 6564  oducts('combined
-00032600: 5f69 6d61 6765 272c 2065 7874 7261 5f6b  _image', extra_k
-00032610: 6579 3d65 6e65 7267 795f 6b65 7920 2b20  ey=energy_key + 
-00032620: 6578 7472 615f 6b65 7929 0a20 2020 2020  extra_key).     
-00032630: 2020 2065 6c69 6620 7073 665f 636f 7272     elif psf_corr
-00032640: 2061 6e64 206e 6f74 2077 6974 685f 6c69   and not with_li
-00032650: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-00032660: 2320 4865 7265 2077 6520 646f 6e27 7420  # Here we don't 
-00032670: 6b6e 6f77 2074 6865 2065 6e65 7267 7920  know the energy 
-00032680: 6b65 792c 2073 6f20 7765 2068 6176 6520  key, so we have 
-00032690: 746f 206c 6f6f 6b20 666f 7220 7061 7274  to look for part
-000326a0: 6961 6c20 6d61 7463 6865 7320 696e 2074  ial matches in t
-000326b0: 6865 2067 6574 5f70 726f 6475 6374 7320  he get_products 
-000326c0: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
-000326d0: 2020 2062 726f 6164 5f6d 6174 6368 6573     broad_matches
-000326e0: 203d 2073 656c 662e 6765 745f 7072 6f64   = self.get_prod
-000326f0: 7563 7473 2827 636f 6d62 696e 6564 5f69  ucts('combined_i
-00032700: 6d61 6765 272c 2065 7874 7261 5f6b 6579  mage', extra_key
-00032710: 3d4e 6f6e 652c 206a 7573 745f 6f62 6a3d  =None, just_obj=
-00032720: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-00032730: 2020 206d 6174 6368 6564 5f70 726f 6473     matched_prods
-00032740: 203d 205b 705b 2d31 5d20 666f 7220 7020   = [p[-1] for p 
-00032750: 696e 2062 726f 6164 5f6d 6174 6368 6573  in broad_matches
-00032760: 2069 6620 6578 7472 615f 6b65 7920 696e   if extra_key in
-00032770: 2070 5b2d 325d 5d0a 0a20 2020 2020 2020   p[-2]]..       
-00032780: 2069 6620 6c65 6e28 6d61 7463 6865 645f   if len(matched_
-00032790: 7072 6f64 7329 203d 3d20 313a 0a20 2020  prods) == 1:.   
-000327a0: 2020 2020 2020 2020 206d 6174 6368 6564           matched
-000327b0: 5f70 726f 6473 203d 206d 6174 6368 6564  _prods = matched
-000327c0: 5f70 726f 6473 5b30 5d0a 2020 2020 2020  _prods[0].      
-000327d0: 2020 656c 6966 206c 656e 286d 6174 6368    elif len(match
-000327e0: 6564 5f70 726f 6473 2920 3d3d 2030 3a0a  ed_prods) == 0:.
-000327f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00032800: 6520 4e6f 5072 6f64 7563 7441 7661 696c  e NoProductAvail
-00032810: 6162 6c65 4572 726f 7228 2243 616e 6e6f  ableError("Canno
-00032820: 7420 6669 6e64 2061 6e79 2063 6f6d 6269  t find any combi
-00032830: 6e65 6420 696d 6167 6573 206d 6174 6368  ned images match
-00032840: 696e 6720 796f 7572 2069 6e70 7574 2e22  ing your input."
-00032850: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00032860: 6e20 6d61 7463 6865 645f 7072 6f64 730a  n matched_prods.
-00032870: 0a20 2020 2064 6566 2067 6574 5f63 6f6d  .    def get_com
-00032880: 6269 6e65 645f 6578 706d 6170 7328 7365  bined_expmaps(se
-00032890: 6c66 2c20 6c6f 5f65 6e3a 2051 7561 6e74  lf, lo_en: Quant
-000328a0: 6974 7920 3d20 4e6f 6e65 2c20 6869 5f65  ity = None, hi_e
-000328b0: 6e3a 2051 7561 6e74 6974 7920 3d20 4e6f  n: Quantity = No
-000328c0: 6e65 2920 2d3e 2055 6e69 6f6e 5b45 7870  ne) -> Union[Exp
-000328d0: 4d61 702c 204c 6973 745b 4578 704d 6170  Map, List[ExpMap
-000328e0: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
-000328f0: 2020 2020 2020 2020 4120 6d65 7468 6f64          A method
-00032900: 2074 6f20 7265 7472 6965 7665 2063 6f6d   to retrieve com
-00032910: 6269 6e65 6420 5847 4120 4578 704d 6170  bined XGA ExpMap
-00032920: 206f 626a 6563 7473 2c20 6173 2069 6e20   objects, as in 
-00032930: 7468 6f73 6520 6578 706f 7375 7265 206d  those exposure m
-00032940: 6170 7320 7468 6174 2068 6176 6520 6265  aps that have be
-00032950: 656e 2063 7265 6174 6564 2062 790a 2020  en created by.  
-00032960: 2020 2020 2020 6d65 7267 696e 6720 616c        merging al
-00032970: 6c20 6176 6169 6c61 626c 6520 6461 7461  l available data
-00032980: 2066 6f72 2074 6869 7320 736f 7572 6365   for this source
-00032990: 2e20 5468 6973 2073 7570 706f 7274 7320  . This supports 
-000329a0: 7365 7474 696e 6720 7468 6520 656e 6572  setting the ener
-000329b0: 6779 206c 696d 6974 7320 6f66 2074 6865  gy limits of the
-000329c0: 2073 7065 6369 6669 630a 2020 2020 2020   specific.      
-000329d0: 2020 6578 706f 7375 7265 206d 6170 7320    exposure maps 
-000329e0: 796f 7520 776f 756c 6420 6c69 6b65 2e20  you would like. 
-000329f0: 4120 4e6f 5072 6f64 7563 7441 7661 696c  A NoProductAvail
-00032a00: 6162 6c65 4572 726f 7220 6572 726f 7220  ableError error 
-00032a10: 7769 6c6c 2062 6520 7261 6973 6564 2069  will be raised i
-00032a20: 6620 6e6f 206d 6174 6368 6573 2061 7265  f no matches are
-00032a30: 2066 6f75 6e64 2e0a 0a20 2020 2020 2020   found...       
-00032a40: 203a 7061 7261 6d20 5175 616e 7469 7479   :param Quantity
-00032a50: 206c 6f5f 656e 3a20 5468 6520 6c6f 7765   lo_en: The lowe
-00032a60: 7220 656e 6572 6779 206c 696d 6974 206f  r energy limit o
-00032a70: 6620 7468 6520 6578 706f 7375 7265 206d  f the exposure m
-00032a80: 6170 7320 796f 7520 7769 7368 2074 6f20  aps you wish to 
-00032a90: 7265 7472 6965 7665 2c20 7468 6520 6465  retrieve, the de
-00032aa0: 6661 756c 740a 2020 2020 2020 2020 2020  fault.          
-00032ab0: 2020 6973 204e 6f6e 6520 2877 6869 6368    is None (which
-00032ac0: 2077 696c 6c20 7265 7472 6965 7665 2061   will retrieve a
-00032ad0: 6c6c 2069 6d61 6765 7320 7265 6761 7264  ll images regard
-00032ae0: 6c65 7373 206f 6620 656e 6572 6779 206c  less of energy l
-00032af0: 696d 6974 292e 0a20 2020 2020 2020 203a  imit)..        :
-00032b00: 7061 7261 6d20 5175 616e 7469 7479 2068  param Quantity h
-00032b10: 695f 656e 3a20 5468 6520 7570 7065 7220  i_en: The upper 
-00032b20: 656e 6572 6779 206c 696d 6974 206f 6620  energy limit of 
-00032b30: 7468 6520 6578 706f 7375 7265 206d 6170  the exposure map
-00032b40: 7320 796f 7520 7769 7368 2074 6f20 7265  s you wish to re
-00032b50: 7472 6965 7665 2c20 7468 6520 6465 6661  trieve, the defa
-00032b60: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
-00032b70: 6973 204e 6f6e 6520 2877 6869 6368 2077  is None (which w
-00032b80: 696c 6c20 7265 7472 6965 7665 2061 6c6c  ill retrieve all
-00032b90: 2069 6d61 6765 7320 7265 6761 7264 6c65   images regardle
-00032ba0: 7373 206f 6620 656e 6572 6779 206c 696d  ss of energy lim
-00032bb0: 6974 292e 0a20 2020 2020 2020 203a 7265  it)..        :re
-00032bc0: 7475 726e 3a20 416e 2058 4741 2045 7870  turn: An XGA Exp
-00032bd0: 4d61 7020 6f62 6a65 6374 2028 6966 2074  Map object (if t
-00032be0: 6865 7265 2069 7320 616e 2065 7861 6374  here is an exact
-00032bf0: 206d 6174 6368 292c 206f 7220 6120 6c69   match), or a li
-00032c00: 7374 206f 6620 5847 4120 496d 6167 6520  st of XGA Image 
-00032c10: 6f62 6a65 6374 7320 2869 6620 7468 6572  objects (if ther
-00032c20: 650a 2020 2020 2020 2020 2020 2020 7765  e.            we
-00032c30: 7265 206d 756c 7469 706c 6520 6d61 7463  re multiple matc
-00032c40: 6869 6e67 2070 726f 6475 6374 7329 2e0a  hing products)..
-00032c50: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-00032c60: 556e 696f 6e5b 4578 704d 6170 2c20 4c69  Union[ExpMap, Li
-00032c70: 7374 5b45 7870 4d61 705d 5d0a 2020 2020  st[ExpMap]].    
-00032c80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00032c90: 6966 2061 6c6c 285b 6c6f 5f65 6e20 6973  if all([lo_en is
-00032ca0: 204e 6f6e 652c 2068 695f 656e 2069 7320   None, hi_en is 
-00032cb0: 4e6f 6e65 5d29 3a0a 2020 2020 2020 2020  None]):.        
-00032cc0: 2020 2020 656e 6572 6779 5f6b 6579 203d      energy_key =
-00032cd0: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
-00032ce0: 6966 2061 6c6c 285b 6c6f 5f65 6e20 6973  if all([lo_en is
-00032cf0: 206e 6f74 204e 6f6e 652c 2068 695f 656e   not None, hi_en
-00032d00: 2069 7320 6e6f 7420 4e6f 6e65 5d29 3a0a   is not None]):.
-00032d10: 2020 2020 2020 2020 2020 2020 656e 6572              ener
-00032d20: 6779 5f6b 6579 203d 2022 626f 756e 645f  gy_key = "bound_
-00032d30: 7b6c 7d2d 7b68 7d22 2e66 6f72 6d61 7428  {l}-{h}".format(
-00032d40: 6c3d 6c6f 5f65 6e2e 746f 2827 6b65 5627  l=lo_en.to('keV'
-00032d50: 292e 7661 6c75 652c 2068 3d68 695f 656e  ).value, h=hi_en
-00032d60: 2e74 6f28 276b 6556 2729 2e76 616c 7565  .to('keV').value
-00032d70: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00032d80: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00032d90: 6520 5661 6c75 6545 7272 6f72 2822 6c6f  e ValueError("lo
-00032da0: 5f65 6e20 616e 6420 6869 5f65 6e20 6d75  _en and hi_en mu
-00032db0: 7374 2062 6520 6569 7468 6572 2042 4f54  st be either BOT
-00032dc0: 4820 4e6f 6e65 206f 7220 424f 5448 2061  H None or BOTH a
-00032dd0: 6e20 4173 7472 6f70 7920 7175 616e 7469  n Astropy quanti
-00032de0: 7479 2e22 290a 0a20 2020 2020 2020 206d  ty.")..        m
-00032df0: 6174 6368 6564 5f70 726f 6473 203d 2073  atched_prods = s
-00032e00: 656c 662e 6765 745f 7072 6f64 7563 7473  elf.get_products
-00032e10: 2827 636f 6d62 696e 6564 5f65 7870 6d61  ('combined_expma
-00032e20: 7027 2c20 6578 7472 615f 6b65 793d 656e  p', extra_key=en
-00032e30: 6572 6779 5f6b 6579 290a 2020 2020 2020  ergy_key).      
-00032e40: 2020 6966 206c 656e 286d 6174 6368 6564    if len(matched
-00032e50: 5f70 726f 6473 2920 3d3d 2031 3a0a 2020  _prods) == 1:.  
-00032e60: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
-00032e70: 645f 7072 6f64 7320 3d20 6d61 7463 6865  d_prods = matche
-00032e80: 645f 7072 6f64 735b 305d 0a20 2020 2020  d_prods[0].     
-00032e90: 2020 2065 6c69 6620 6c65 6e28 6d61 7463     elif len(matc
-00032ea0: 6865 645f 7072 6f64 7329 203d 3d20 303a  hed_prods) == 0:
-00032eb0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00032ec0: 7365 204e 6f50 726f 6475 6374 4176 6169  se NoProductAvai
-00032ed0: 6c61 626c 6545 7272 6f72 2822 4361 6e6e  lableError("Cann
-00032ee0: 6f74 2066 696e 6420 616e 7920 636f 6d62  ot find any comb
-00032ef0: 696e 6564 2065 7870 6f73 7572 6520 6d61  ined exposure ma
-00032f00: 7073 206d 6174 6368 696e 6720 796f 7572  ps matching your
-00032f10: 2069 6e70 7574 2e22 290a 0a20 2020 2020   input.")..     
-00032f20: 2020 2072 6574 7572 6e20 6d61 7463 6865     return matche
-00032f30: 645f 7072 6f64 730a 0a20 2020 2064 6566  d_prods..    def
-00032f40: 2067 6574 5f63 6f6d 6269 6e65 645f 7261   get_combined_ra
-00032f50: 7465 6d61 7073 2873 656c 662c 206c 6f5f  temaps(self, lo_
-00032f60: 656e 3a20 5175 616e 7469 7479 203d 204e  en: Quantity = N
-00032f70: 6f6e 652c 2068 695f 656e 3a20 5175 616e  one, hi_en: Quan
-00032f80: 7469 7479 203d 204e 6f6e 652c 2020 7073  tity = None,  ps
-00032f90: 665f 636f 7272 3a20 626f 6f6c 203d 2046  f_corr: bool = F
-00032fa0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-00032fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032fc0: 2020 2020 7073 665f 6d6f 6465 6c3a 2073      psf_model: s
-00032fd0: 7472 203d 2022 454c 4c42 4554 4122 2c20  tr = "ELLBETA", 
-00032fe0: 7073 665f 6269 6e73 3a20 696e 7420 3d20  psf_bins: int = 
-00032ff0: 342c 2070 7366 5f61 6c67 6f3a 2073 7472  4, psf_algo: str
-00033000: 203d 2022 726c 222c 0a20 2020 2020 2020   = "rl",.       
-00033010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033020: 2020 2020 2020 2070 7366 5f69 7465 723a         psf_iter:
-00033030: 2069 6e74 203d 2031 3529 202d 3e20 556e   int = 15) -> Un
-00033040: 696f 6e5b 5261 7465 4d61 702c 204c 6973  ion[RateMap, Lis
-00033050: 745b 5261 7465 4d61 705d 5d3a 0a20 2020  t[RateMap]]:.   
-00033060: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00033070: 2041 206d 6574 686f 6420 746f 2072 6574   A method to ret
-00033080: 7269 6576 6520 636f 6d62 696e 6564 2058  rieve combined X
-00033090: 4741 2052 6174 654d 6170 206f 626a 6563  GA RateMap objec
-000330a0: 7473 2c20 6173 2069 6e20 7468 6f73 6520  ts, as in those 
-000330b0: 7261 7465 6d61 7020 7468 6174 2068 6176  ratemap that hav
-000330c0: 6520 6265 656e 2063 7265 6174 6564 2062  e been created b
-000330d0: 790a 2020 2020 2020 2020 6d65 7267 696e  y.        mergin
-000330e0: 6720 616c 6c20 6176 6169 6c61 626c 6520  g all available 
-000330f0: 6461 7461 2066 6f72 2074 6869 7320 736f  data for this so
-00033100: 7572 6365 2e20 5468 6973 2073 7570 706f  urce. This suppo
-00033110: 7274 7320 7468 6520 7265 7472 6965 7661  rts the retrieva
-00033120: 6c20 6f66 2062 6f74 6820 5053 4620 636f  l of both PSF co
-00033130: 7272 6563 7465 6420 616e 6420 6e6f 6e2d  rrected and non-
-00033140: 5053 460a 2020 2020 2020 2020 636f 7272  PSF.        corr
-00033150: 6563 7465 6420 7261 7465 6d61 7073 2c20  ected ratemaps, 
-00033160: 6173 2077 656c 6c20 6173 2073 6574 7469  as well as setti
-00033170: 6e67 2074 6865 2065 6e65 7267 7920 6c69  ng the energy li
-00033180: 6d69 7473 206f 6620 7468 6520 7370 6563  mits of the spec
-00033190: 6966 6963 2072 6174 656d 6170 2079 6f75  ific ratemap you
-000331a0: 2077 6f75 6c64 206c 696b 652e 2041 0a20   would like. A. 
-000331b0: 2020 2020 2020 204e 6f50 726f 6475 6374         NoProduct
-000331c0: 4176 6169 6c61 626c 6545 7272 6f72 2065  AvailableError e
-000331d0: 7272 6f72 2077 696c 6c20 6265 2072 6169  rror will be rai
-000331e0: 7365 6420 6966 206e 6f20 6d61 7463 6865  sed if no matche
-000331f0: 7320 6172 6520 666f 756e 642e 0a0a 2020  s are found...  
-00033200: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
-00033210: 6e74 6974 7920 6c6f 5f65 6e3a 2054 6865  ntity lo_en: The
-00033220: 206c 6f77 6572 2065 6e65 7267 7920 6c69   lower energy li
-00033230: 6d69 7420 6f66 2074 6865 2072 6174 656d  mit of the ratem
-00033240: 6170 7320 796f 7520 7769 7368 2074 6f20  aps you wish to 
-00033250: 7265 7472 6965 7665 2c20 7468 6520 6465  retrieve, the de
-00033260: 6661 756c 740a 2020 2020 2020 2020 2020  fault.          
-00033270: 2020 6973 204e 6f6e 6520 2877 6869 6368    is None (which
-00033280: 2077 696c 6c20 7265 7472 6965 7665 2061   will retrieve a
-00033290: 6c6c 2072 6174 656d 6170 7320 7265 6761  ll ratemaps rega
-000332a0: 7264 6c65 7373 206f 6620 656e 6572 6779  rdless of energy
-000332b0: 206c 696d 6974 292e 0a20 2020 2020 2020   limit)..       
-000332c0: 203a 7061 7261 6d20 5175 616e 7469 7479   :param Quantity
-000332d0: 2068 695f 656e 3a20 5468 6520 7570 7065   hi_en: The uppe
-000332e0: 7220 656e 6572 6779 206c 696d 6974 206f  r energy limit o
-000332f0: 6620 7468 6520 7261 7465 6d61 7073 2079  f the ratemaps y
-00033300: 6f75 2077 6973 6820 746f 2072 6574 7269  ou wish to retri
-00033310: 6576 652c 2074 6865 2064 6566 6175 6c74  eve, the default
-00033320: 0a20 2020 2020 2020 2020 2020 2069 7320  .            is 
-00033330: 4e6f 6e65 2028 7768 6963 6820 7769 6c6c  None (which will
-00033340: 2072 6574 7269 6576 6520 616c 6c20 7261   retrieve all ra
-00033350: 7465 6d61 7073 2072 6567 6172 646c 6573  temaps regardles
-00033360: 7320 6f66 2065 6e65 7267 7920 6c69 6d69  s of energy limi
-00033370: 7429 2e0a 2020 2020 2020 2020 3a70 6172  t)..        :par
-00033380: 616d 2062 6f6f 6c20 7073 665f 636f 7272  am bool psf_corr
-00033390: 3a20 5365 7473 2077 6865 7468 6572 2079  : Sets whether y
-000333a0: 6f75 2077 6973 6820 746f 2072 6574 7269  ou wish to retri
-000333b0: 6576 6520 6120 5053 4620 636f 7272 6563  eve a PSF correc
-000333c0: 7465 6420 7261 7465 6d61 7020 6f72 206e  ted ratemap or n
-000333d0: 6f74 2e0a 2020 2020 2020 2020 3a70 6172  ot..        :par
-000333e0: 616d 2073 7472 2070 7366 5f6d 6f64 656c  am str psf_model
-000333f0: 3a20 4966 2074 6865 2072 6174 656d 6170  : If the ratemap
-00033400: 2079 6f75 2077 616e 7420 6973 2050 5346   you want is PSF
-00033410: 2063 6f72 7265 6374 6564 2c20 7468 6973   corrected, this
-00033420: 2069 7320 7468 6520 5053 4620 6d6f 6465   is the PSF mode
-00033430: 6c20 7573 6564 2e0a 2020 2020 2020 2020  l used..        
-00033440: 3a70 6172 616d 2069 6e74 2070 7366 5f62  :param int psf_b
-00033450: 696e 733a 2049 6620 7468 6520 7261 7465  ins: If the rate
-00033460: 6d61 7020 796f 7520 7761 6e74 2069 7320  map you want is 
-00033470: 5053 4620 636f 7272 6563 7465 642c 2074  PSF corrected, t
-00033480: 6869 7320 6973 2074 6865 206e 756d 6265  his is the numbe
-00033490: 7220 6f66 2050 5346 7320 7065 720a 2020  r of PSFs per.  
-000334a0: 2020 2020 2020 2020 2020 7369 6465 2069            side i
-000334b0: 6e20 7468 6520 5053 4620 6772 6964 2e0a  n the PSF grid..
-000334c0: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-000334d0: 7472 2070 7366 5f61 6c67 6f3a 2049 6620  tr psf_algo: If 
-000334e0: 7468 6520 7261 7465 6d61 7020 796f 7520  the ratemap you 
-000334f0: 7761 6e74 2069 7320 5053 4620 636f 7272  want is PSF corr
-00033500: 6563 7465 642c 2074 6869 7320 6973 2074  ected, this is t
-00033510: 6865 2061 6c67 6f72 6974 686d 2075 7365  he algorithm use
-00033520: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
-00033530: 6d20 696e 7420 7073 665f 6974 6572 3a20  m int psf_iter: 
-00033540: 4966 2074 6865 2072 6174 656d 6170 2079  If the ratemap y
-00033550: 6f75 2077 616e 7420 6973 2050 5346 2063  ou want is PSF c
-00033560: 6f72 7265 6374 6564 2c20 7468 6973 2069  orrected, this i
-00033570: 7320 7468 6520 6e75 6d62 6572 206f 6620  s the number of 
-00033580: 6974 6572 6174 696f 6e73 2e0a 2020 2020  iterations..    
-00033590: 2020 2020 3a72 6574 7572 6e3a 2041 6e20      :return: An 
-000335a0: 5847 4120 5261 7465 4d61 7020 6f62 6a65  XGA RateMap obje
-000335b0: 6374 2028 6966 2074 6865 7265 2069 7320  ct (if there is 
-000335c0: 616e 2065 7861 6374 206d 6174 6368 292c  an exact match),
-000335d0: 206f 7220 6120 6c69 7374 206f 6620 5847   or a list of XG
-000335e0: 4120 5261 7465 4d61 7020 6f62 6a65 6374  A RateMap object
-000335f0: 7320 2869 6620 7468 6572 650a 2020 2020  s (if there.    
-00033600: 2020 2020 2020 2020 7765 7265 206d 756c          were mul
-00033610: 7469 706c 6520 6d61 7463 6869 6e67 2070  tiple matching p
-00033620: 726f 6475 6374 7329 2e0a 2020 2020 2020  roducts)..      
-00033630: 2020 3a72 7479 7065 3a20 556e 696f 6e5b    :rtype: Union[
-00033640: 5261 7465 4d61 702c 204c 6973 745b 5261  RateMap, List[Ra
-00033650: 7465 4d61 705d 5d0a 2020 2020 2020 2020  teMap]].        
-00033660: 2222 220a 2020 2020 2020 2020 2320 5468  """.        # Th
-00033670: 6973 2066 756e 6374 696f 6e20 6973 2065  is function is e
-00033680: 7373 656e 7469 616c 6c79 2069 6465 6e74  ssentially ident
-00033690: 6963 616c 2074 6f20 6765 745f 696d 6167  ical to get_imag
-000336a0: 6573 2c20 6275 7420 4927 6d20 676f 696e  es, but I'm goin
-000336b0: 6720 746f 2062 6520 6c61 7a79 2061 6e64  g to be lazy and
-000336c0: 206e 6f74 2077 7269 7465 0a20 2020 2020   not write.     
-000336d0: 2020 2023 2020 6120 7365 7061 7261 7465     #  a separate
-000336e0: 2069 6e74 6572 6e61 6c20 6675 6e63 7469   internal functi
-000336f0: 6f6e 2074 6f20 646f 2062 6f74 682e 0a0a  on to do both...
-00033700: 2020 2020 2020 2020 2320 4368 6563 6b73          # Checks
-00033710: 2074 6f20 6d61 6b65 2073 7572 6520 7468   to make sure th
-00033720: 6174 2061 6e20 616c 6c6f 7765 6420 636f  at an allowed co
-00033730: 6d62 696e 6174 696f 6e20 6f66 206c 6f5f  mbination of lo_
-00033740: 656e 2061 6e64 2068 695f 656e 2068 6173  en and hi_en has
-00033750: 2062 6565 6e20 7061 7373 6564 2e0a 2020   been passed..  
-00033760: 2020 2020 2020 6966 2061 6c6c 285b 6c6f        if all([lo
-00033770: 5f65 6e20 6973 204e 6f6e 652c 2068 695f  _en is None, hi_
-00033780: 656e 2069 7320 4e6f 6e65 5d29 3a0a 2020  en is None]):.  
-00033790: 2020 2020 2020 2020 2020 2320 5365 7473            # Sets
-000337a0: 2061 2066 6c61 6720 746f 2074 656c 6c20   a flag to tell 
-000337b0: 7468 6520 7265 7374 206f 6620 7468 6520  the rest of the 
-000337c0: 6d65 7468 6f64 2077 6865 7468 6572 2077  method whether w
-000337d0: 6520 6861 7665 2065 6e65 7267 7920 6c69  e have energy li
-000337e0: 6d73 206f 7220 6e6f 740a 2020 2020 2020  ms or not.      
-000337f0: 2020 2020 2020 7769 7468 5f6c 696d 7320        with_lims 
-00033800: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00033810: 2020 2020 656e 6572 6779 5f6b 6579 203d      energy_key =
-00033820: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
-00033830: 6966 2061 6c6c 285b 6c6f 5f65 6e20 6973  if all([lo_en is
-00033840: 206e 6f74 204e 6f6e 652c 2068 695f 656e   not None, hi_en
-00033850: 2069 7320 6e6f 7420 4e6f 6e65 5d29 3a0a   is not None]):.
-00033860: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00033870: 5f6c 696d 7320 3d20 5472 7565 0a20 2020  _lims = True.   
-00033880: 2020 2020 2020 2020 2023 2057 6520 6861           # We ha
-00033890: 7665 2065 6e65 7267 7920 6c69 6d69 7473  ve energy limits
-000338a0: 2068 6572 6520 736f 2077 6520 6173 7365   here so we asse
-000338b0: 6d62 6c65 2074 6865 206b 6579 2074 6861  mble the key tha
-000338c0: 7420 6465 7363 7269 6265 7320 7468 6520  t describes the 
-000338d0: 656e 6572 6779 2072 616e 6765 0a20 2020  energy range.   
-000338e0: 2020 2020 2020 2020 2065 6e65 7267 795f           energy_
-000338f0: 6b65 7920 3d20 2262 6f75 6e64 5f7b 6c7d  key = "bound_{l}
-00033900: 2d7b 687d 222e 666f 726d 6174 286c 3d6c  -{h}".format(l=l
-00033910: 6f5f 656e 2e74 6f28 276b 6556 2729 2e76  o_en.to('keV').v
-00033920: 616c 7565 2c20 683d 6869 5f65 6e2e 746f  alue, h=hi_en.to
-00033930: 2827 6b65 5627 292e 7661 6c75 6529 0a20  ('keV').value). 
-00033940: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00033950: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00033960: 616c 7565 4572 726f 7228 226c 6f5f 656e  alueError("lo_en
-00033970: 2061 6e64 2068 695f 656e 206d 7573 7420   and hi_en must 
-00033980: 6265 2065 6974 6865 7220 424f 5448 204e  be either BOTH N
-00033990: 6f6e 6520 6f72 2042 4f54 4820 616e 2041  one or BOTH an A
-000339a0: 7374 726f 7079 2071 7561 6e74 6974 792e  stropy quantity.
-000339b0: 2229 0a0a 2020 2020 2020 2020 2320 4966  ")..        # If
-000339c0: 2077 6520 6172 6520 6c6f 6f6b 696e 6720   we are looking 
-000339d0: 666f 7220 6120 5053 4620 636f 7272 6563  for a PSF correc
-000339e0: 7465 6420 7261 7465 6d61 7020 7468 656e  ted ratemap then
-000339f0: 2077 6520 6173 7365 6d62 6c65 2074 6865   we assemble the
-00033a00: 2065 7874 7261 206b 6579 2077 6974 6820   extra key with 
-00033a10: 5053 4620 6465 7461 696c 730a 2020 2020  PSF details.    
-00033a20: 2020 2020 6966 2070 7366 5f63 6f72 723a      if psf_corr:
-00033a30: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
-00033a40: 7261 5f6b 6579 203d 2022 5f22 202b 2070  ra_key = "_" + p
-00033a50: 7366 5f6d 6f64 656c 202b 2022 5f22 202b  sf_model + "_" +
-00033a60: 2073 7472 2870 7366 5f62 696e 7329 202b   str(psf_bins) +
-00033a70: 2022 5f22 202b 2070 7366 5f61 6c67 6f20   "_" + psf_algo 
-00033a80: 2b20 7374 7228 7073 665f 6974 6572 290a  + str(psf_iter).
-00033a90: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00033aa0: 7073 665f 636f 7272 2061 6e64 2077 6974  psf_corr and wit
-00033ab0: 685f 6c69 6d73 3a0a 2020 2020 2020 2020  h_lims:.        
-00033ac0: 2020 2020 2320 5369 6d70 6c65 7374 2063      # Simplest c
-00033ad0: 6173 652c 206a 7573 7420 6361 6c6c 696e  ase, just callin
-00033ae0: 6720 6765 745f 7072 6f64 7563 7473 2061  g get_products a
-00033af0: 6e64 2070 6173 7369 6e67 2069 6e20 6f75  nd passing in ou
-00033b00: 7220 696e 666f 726d 6174 696f 6e0a 2020  r information.  
-00033b10: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
-00033b20: 645f 7072 6f64 7320 3d20 7365 6c66 2e67  d_prods = self.g
-00033b30: 6574 5f70 726f 6475 6374 7328 2763 6f6d  et_products('com
-00033b40: 6269 6e65 645f 7261 7465 6d61 7027 2c20  bined_ratemap', 
-00033b50: 6578 7472 615f 6b65 793d 656e 6572 6779  extra_key=energy
-00033b60: 5f6b 6579 290a 2020 2020 2020 2020 656c  _key).        el
-00033b70: 6966 206e 6f74 2070 7366 5f63 6f72 7220  if not psf_corr 
-00033b80: 616e 6420 6e6f 7420 7769 7468 5f6c 696d  and not with_lim
-00033b90: 733a 0a20 2020 2020 2020 2020 2020 2062  s:.            b
-00033ba0: 726f 6164 5f6d 6174 6368 6573 203d 2073  road_matches = s
-00033bb0: 656c 662e 6765 745f 7072 6f64 7563 7473  elf.get_products
-00033bc0: 2822 636f 6d62 696e 6564 5f72 6174 656d  ("combined_ratem
-00033bd0: 6170 2229 0a20 2020 2020 2020 2020 2020  ap").           
-00033be0: 206d 6174 6368 6564 5f70 726f 6473 203d   matched_prods =
-00033bf0: 205b 7020 666f 7220 7020 696e 2062 726f   [p for p in bro
-00033c00: 6164 5f6d 6174 6368 6573 2069 6620 6e6f  ad_matches if no
-00033c10: 7420 702e 7073 665f 636f 7272 6563 7465  t p.psf_correcte
-00033c20: 645d 0a20 2020 2020 2020 2065 6c69 6620  d].        elif 
-00033c30: 7073 665f 636f 7272 2061 6e64 2077 6974  psf_corr and wit
-00033c40: 685f 6c69 6d73 3a0a 2020 2020 2020 2020  h_lims:.        
-00033c50: 2020 2020 2320 4865 7265 2077 6520 6e65      # Here we ne
-00033c60: 6564 2074 6f20 6164 6420 7468 6520 6578  ed to add the ex
-00033c70: 7472 6120 6b65 7920 746f 2074 6865 2065  tra key to the e
-00033c80: 6e65 7267 7920 6b65 790a 2020 2020 2020  nergy key.      
-00033c90: 2020 2020 2020 6d61 7463 6865 645f 7072        matched_pr
-00033ca0: 6f64 7320 3d20 7365 6c66 2e67 6574 5f70  ods = self.get_p
-00033cb0: 726f 6475 6374 7328 2763 6f6d 6269 6e65  roducts('combine
-00033cc0: 645f 7261 7465 6d61 7027 2c20 6578 7472  d_ratemap', extr
-00033cd0: 615f 6b65 793d 656e 6572 6779 5f6b 6579  a_key=energy_key
-00033ce0: 202b 2065 7874 7261 5f6b 6579 290a 2020   + extra_key).  
-00033cf0: 2020 2020 2020 656c 6966 2070 7366 5f63        elif psf_c
-00033d00: 6f72 7220 616e 6420 6e6f 7420 7769 7468  orr and not with
-00033d10: 5f6c 696d 733a 0a20 2020 2020 2020 2020  _lims:.         
-00033d20: 2020 2023 2048 6572 6520 7765 2064 6f6e     # Here we don
-00033d30: 2774 206b 6e6f 7720 7468 6520 656e 6572  't know the ener
-00033d40: 6779 206b 6579 2c20 736f 2077 6520 6861  gy key, so we ha
-00033d50: 7665 2074 6f20 6c6f 6f6b 2066 6f72 2070  ve to look for p
-00033d60: 6172 7469 616c 206d 6174 6368 6573 2069  artial matches i
-00033d70: 6e20 7468 6520 6765 745f 7072 6f64 7563  n the get_produc
-00033d80: 7473 2072 6574 7572 6e0a 2020 2020 2020  ts return.      
-00033d90: 2020 2020 2020 6272 6f61 645f 6d61 7463        broad_matc
-00033da0: 6865 7320 3d20 7365 6c66 2e67 6574 5f70  hes = self.get_p
-00033db0: 726f 6475 6374 7328 2763 6f6d 6269 6e65  roducts('combine
-00033dc0: 645f 7261 7465 6d61 7027 2c20 6578 7472  d_ratemap', extr
-00033dd0: 615f 6b65 793d 4e6f 6e65 2c20 6a75 7374  a_key=None, just
-00033de0: 5f6f 626a 3d46 616c 7365 290a 2020 2020  _obj=False).    
-00033df0: 2020 2020 2020 2020 6d61 7463 6865 645f          matched_
-00033e00: 7072 6f64 7320 3d20 5b70 5b2d 315d 2066  prods = [p[-1] f
-00033e10: 6f72 2070 2069 6e20 6272 6f61 645f 6d61  or p in broad_ma
-00033e20: 7463 6865 7320 6966 2065 7874 7261 5f6b  tches if extra_k
-00033e30: 6579 2069 6e20 705b 2d32 5d5d 0a0a 2020  ey in p[-2]]..  
-00033e40: 2020 2020 2020 6966 206c 656e 286d 6174        if len(mat
-00033e50: 6368 6564 5f70 726f 6473 2920 3d3d 2031  ched_prods) == 1
-00033e60: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-00033e70: 7463 6865 645f 7072 6f64 7320 3d20 6d61  tched_prods = ma
-00033e80: 7463 6865 645f 7072 6f64 735b 305d 0a20  tched_prods[0]. 
-00033e90: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
-00033ea0: 6d61 7463 6865 645f 7072 6f64 7329 203d  matched_prods) =
-00033eb0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00033ec0: 2072 6169 7365 204e 6f50 726f 6475 6374   raise NoProduct
-00033ed0: 4176 6169 6c61 626c 6545 7272 6f72 2822  AvailableError("
-00033ee0: 4361 6e6e 6f74 2066 696e 6420 616e 7920  Cannot find any 
-00033ef0: 636f 6d62 696e 6564 2072 6174 656d 6170  combined ratemap
-00033f00: 7320 6d61 7463 6869 6e67 2079 6f75 7220  s matching your 
-00033f10: 696e 7075 742e 2229 0a0a 2020 2020 2020  input.")..      
-00033f20: 2020 7265 7475 726e 206d 6174 6368 6564    return matched
-00033f30: 5f70 726f 6473 0a0a 2020 2020 6465 6620  _prods..    def 
-00033f40: 5f67 6574 5f70 726f 665f 7072 6f64 2873  _get_prof_prod(s
-00033f50: 656c 662c 2073 6561 7263 685f 6b65 793a  elf, search_key:
-00033f60: 2073 7472 2c20 6f62 735f 6964 3a20 7374   str, obs_id: st
-00033f70: 7220 3d20 4e6f 6e65 2c20 696e 7374 3a20  r = None, inst: 
-00033f80: 7374 7220 3d20 4e6f 6e65 2c20 6365 6e74  str = None, cent
-00033f90: 7261 6c5f 636f 6f72 643a 2051 7561 6e74  ral_coord: Quant
-00033fa0: 6974 7920 3d20 4e6f 6e65 2c0a 2020 2020  ity = None,.    
-00033fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033fc0: 2020 2072 6164 6969 3a20 5175 616e 7469     radii: Quanti
-00033fd0: 7479 203d 204e 6f6e 652c 206c 6f5f 656e  ty = None, lo_en
-00033fe0: 3a20 5175 616e 7469 7479 203d 204e 6f6e  : Quantity = Non
-00033ff0: 652c 2068 695f 656e 3a20 5175 616e 7469  e, hi_en: Quanti
-00034000: 7479 203d 204e 6f6e 6529 205c 0a20 2020  ty = None) \.   
-00034010: 2020 2020 2020 2020 202d 3e20 556e 696f           -> Unio
-00034020: 6e5b 4261 7365 5072 6f66 696c 6531 442c  n[BaseProfile1D,
-00034030: 204c 6973 745b 4261 7365 5072 6f66 696c   List[BaseProfil
-00034040: 6531 445d 5d3a 0a20 2020 2020 2020 2022  e1D]]:.        "
-00034050: 2222 0a20 2020 2020 2020 2054 6865 2069  "".        The i
-00034060: 6e74 6572 6e61 6c20 6d65 7468 6f64 2077  nternal method w
-00034070: 6869 6368 2069 7320 7468 6520 6775 7473  hich is the guts
-00034080: 206f 6620 6765 745f 7072 6f66 696c 6573   of get_profiles
-00034090: 2061 6e64 2067 6574 5f63 6f6d 6269 6e65   and get_combine
-000340a0: 645f 7072 6f66 696c 6573 2e20 4974 2070  d_profiles. It p
-000340b0: 6172 7365 7320 7468 6520 696e 7075 7420  arses the input 
-000340c0: 616e 640a 2020 2020 2020 2020 7365 6172  and.        sear
-000340d0: 6368 6573 2066 6f72 2066 756c 6c20 616e  ches for full an
-000340e0: 6420 7061 7274 6961 6c20 6d61 7463 6865  d partial matche
-000340f0: 7320 696e 2074 6869 7320 736f 7572 6365  s in this source
-00034100: 2773 2070 726f 6475 6374 2073 746f 7261  's product stora
-00034110: 6765 2073 7472 7563 7475 7265 2e0a 0a20  ge structure... 
-00034120: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00034130: 7220 7365 6172 6368 5f6b 6579 3a20 5468  r search_key: Th
-00034140: 6520 6578 6163 7420 7365 6172 6368 206b  e exact search k
-00034150: 6579 2077 6869 6368 2064 6566 696e 6564  ey which defined
-00034160: 2070 726f 6669 6c65 2074 7970 652c 2061   profile type, a
-00034170: 6e64 2077 6865 7468 6572 2069 7420 6973  nd whether it is
-00034180: 2063 6f6d 6269 6e65 6420 6f72 206e 6f74   combined or not
-00034190: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000341a0: 2073 7472 206f 6273 5f69 643a 204f 7074   str obs_id: Opt
-000341b0: 696f 6e61 6c6c 792c 2061 2073 7065 6369  ionally, a speci
-000341c0: 6669 6320 6f62 735f 6964 2074 6f20 7365  fic obs_id to se
-000341d0: 6172 6368 2066 6f72 2063 616e 2062 6520  arch for can be 
-000341e0: 7375 7070 6c69 6564 2e20 5468 6520 6465  supplied. The de
-000341f0: 6661 756c 7420 6973 204e 6f6e 652c 0a20  fault is None,. 
-00034200: 2020 2020 2020 2020 2020 2077 6869 6368             which
-00034210: 206d 6561 6e73 2061 6c6c 2070 726f 6669   means all profi
-00034220: 6c65 7320 6d61 7463 6869 6e67 2074 6865  les matching the
-00034230: 206f 7468 6572 2063 7269 7465 7269 6120   other criteria 
-00034240: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
-00034250: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00034260: 2073 7472 2069 6e73 743a 204f 7074 696f   str inst: Optio
-00034270: 6e61 6c6c 792c 2061 2073 7065 6369 6669  nally, a specifi
-00034280: 6320 696e 7374 7275 6d65 6e74 2074 6f20  c instrument to 
-00034290: 7365 6172 6368 2066 6f72 2063 616e 2062  search for can b
-000342a0: 6520 7375 7070 6c69 6564 2e20 5468 6520  e supplied. The 
-000342b0: 6465 6661 756c 7420 6973 204e 6f6e 652c  default is None,
-000342c0: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
-000342d0: 6368 206d 6561 6e73 2061 6c6c 2070 726f  ch means all pro
-000342e0: 6669 6c65 7320 6d61 7463 6869 6e67 2074  files matching t
-000342f0: 6865 206f 7468 6572 2063 7269 7465 7269  he other criteri
-00034300: 6120 7769 6c6c 2062 6520 7265 7475 726e  a will be return
-00034310: 6564 2e0a 2020 2020 2020 2020 3a70 6172  ed..        :par
-00034320: 616d 2051 7561 6e74 6974 7920 6365 6e74  am Quantity cent
-00034330: 7261 6c5f 636f 6f72 643a 2054 6865 2063  ral_coord: The c
-00034340: 656e 7472 616c 2063 6f6f 7264 696e 6174  entral coordinat
-00034350: 6520 6f66 2074 6865 2070 726f 6669 6c65  e of the profile
-00034360: 2079 6f75 2077 6973 6820 746f 2072 6574   you wish to ret
-00034370: 7269 6576 652c 2074 6865 2064 6566 6175  rieve, the defau
-00034380: 6c74 0a20 2020 2020 2020 2020 2020 2069  lt.            i
-00034390: 7320 4e6f 6e65 2077 6869 6368 206d 6561  s None which mea
-000343a0: 6e73 2074 6865 206d 6574 686f 6420 7769  ns the method wi
-000343b0: 6c6c 2075 7365 2074 6865 2064 6566 6175  ll use the defau
-000343c0: 6c74 2063 6f6f 7264 696e 6174 6520 6f66  lt coordinate of
-000343d0: 2074 6869 7320 736f 7572 6365 2e0a 2020   this source..  
-000343e0: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
-000343f0: 6e74 6974 7920 7261 6469 693a 2054 6865  ntity radii: The
-00034400: 2063 656e 7472 616c 2072 6164 6969 206f   central radii o
-00034410: 6620 7468 6520 7072 6f66 696c 6520 706f  f the profile po
-00034420: 696e 7473 2c20 6974 2069 7320 6e6f 7420  ints, it is not 
-00034430: 6c69 6b65 6c79 2074 6861 7420 7468 6973  likely that this
-00034440: 206f 7074 696f 6e20 7769 6c6c 2062 650a   option will be.
-00034450: 2020 2020 2020 2020 2020 2020 7573 6564              used
-00034460: 206f 6674 656e 2061 7320 796f 7520 6c69   often as you li
-00034470: 6b65 6c79 2077 6f6e 2774 206b 6e6f 7720  kely won't know 
-00034480: 7468 6520 7261 6469 616c 2076 616c 7565  the radial value
-00034490: 7320 6120 7072 696f 7269 2e0a 2020 2020  s a priori..    
-000344a0: 2020 2020 3a70 6172 616d 2051 7561 6e74      :param Quant
-000344b0: 6974 7920 6c6f 5f65 6e3a 2054 6865 206c  ity lo_en: The l
-000344c0: 6f77 6572 2065 6e65 7267 7920 626f 756e  ower energy boun
-000344d0: 6420 6f66 2074 6865 2070 726f 6669 6c65  d of the profile
-000344e0: 2079 6f75 2077 6973 6820 746f 2072 6574   you wish to ret
-000344f0: 7269 6576 6520 2869 6620 6170 706c 6963  rieve (if applic
-00034500: 6162 6c65 292c 2064 6566 6175 6c74 0a20  able), default. 
-00034510: 2020 2020 2020 2020 2020 2069 7320 4e6f             is No
-00034520: 6e65 2c20 616e 6420 6966 2074 6869 7320  ne, and if this 
-00034530: 6172 6775 6d65 6e74 2069 7320 7061 7373  argument is pass
-00034540: 6564 2068 695f 656e 206d 7573 7420 6265  ed hi_en must be
-00034550: 2074 6f6f 2e0a 2020 2020 2020 2020 3a70   too..        :p
-00034560: 6172 616d 2051 7561 6e74 6974 7920 6869  aram Quantity hi
-00034570: 5f65 6e3a 2054 6865 2068 6967 6865 7220  _en: The higher 
-00034580: 656e 6572 6779 2062 6f75 6e64 206f 6620  energy bound of 
-00034590: 7468 6520 7072 6f66 696c 6520 796f 7520  the profile you 
-000345a0: 7769 7368 2074 6f20 7265 7472 6965 7665  wish to retrieve
-000345b0: 2028 6966 2061 7070 6c69 6361 626c 6529   (if applicable)
-000345c0: 2c20 6465 6661 756c 740a 2020 2020 2020  , default.      
-000345d0: 2020 2020 2020 6973 204e 6f6e 652c 2061        is None, a
-000345e0: 6e64 2069 6620 7468 6973 2061 7267 756d  nd if this argum
-000345f0: 656e 7420 6973 2070 6173 7365 6420 6c6f  ent is passed lo
-00034600: 5f65 6e20 6d75 7374 2062 6520 746f 6f2e  _en must be too.
-00034610: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00034620: 3a20 416e 2058 4741 2070 726f 6669 6c65  : An XGA profile
-00034630: 206f 626a 6563 7420 2869 6620 7468 6572   object (if ther
-00034640: 6520 6973 2061 6e20 6578 6163 7420 6d61  e is an exact ma
-00034650: 7463 6829 2c20 6f72 2061 206c 6973 7420  tch), or a list 
-00034660: 6f66 2058 4741 2070 726f 6669 6c65 206f  of XGA profile o
-00034670: 626a 6563 7473 2028 6966 2074 6865 7265  bjects (if there
-00034680: 0a20 2020 2020 2020 2020 2020 2077 6572  .            wer
-00034690: 6520 6d75 6c74 6970 6c65 206d 6174 6368  e multiple match
-000346a0: 696e 6720 7072 6f64 7563 7473 292e 0a20  ing products).. 
-000346b0: 2020 2020 2020 203a 7274 7970 653a 2055         :rtype: U
-000346c0: 6e69 6f6e 5b42 6173 6550 726f 6669 6c65  nion[BaseProfile
-000346d0: 3144 2c20 4c69 7374 5b42 6173 6550 726f  1D, List[BasePro
-000346e0: 6669 6c65 3144 5d5d 0a20 2020 2020 2020  file1D]].       
-000346f0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00034700: 616c 6c28 5b6c 6f5f 656e 2069 7320 4e6f  all([lo_en is No
-00034710: 6e65 2c20 6869 5f65 6e20 6973 204e 6f6e  ne, hi_en is Non
-00034720: 655d 293a 0a20 2020 2020 2020 2020 2020  e]):.           
-00034730: 2065 6e65 7267 795f 6b65 7920 3d20 225f   energy_key = "_
-00034740: 220a 2020 2020 2020 2020 656c 6966 2061  ".        elif a
-00034750: 6c6c 285b 6c6f 5f65 6e20 6973 206e 6f74  ll([lo_en is not
-00034760: 204e 6f6e 652c 2068 695f 656e 2069 7320   None, hi_en is 
-00034770: 6e6f 7420 4e6f 6e65 5d29 3a0a 2020 2020  not None]):.    
-00034780: 2020 2020 2020 2020 656e 6572 6779 5f6b          energy_k
-00034790: 6579 203d 2022 626f 756e 645f 7b6c 7d2d  ey = "bound_{l}-
-000347a0: 7b68 7d5f 222e 666f 726d 6174 286c 3d6c  {h}_".format(l=l
-000347b0: 6f5f 656e 2e74 6f28 276b 6556 2729 2e76  o_en.to('keV').v
-000347c0: 616c 7565 2c20 683d 6869 5f65 6e2e 746f  alue, h=hi_en.to
-000347d0: 2827 6b65 5627 292e 7661 6c75 6529 0a20  ('keV').value). 
-000347e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000347f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00034800: 616c 7565 4572 726f 7228 226c 6f5f 656e  alueError("lo_en
-00034810: 2061 6e64 2068 695f 656e 206d 7573 7420   and hi_en must 
-00034820: 6265 2065 6974 6865 7220 424f 5448 204e  be either BOTH N
-00034830: 6f6e 6520 6f72 2042 4f54 4820 616e 2041  one or BOTH an A
-00034840: 7374 726f 7079 2071 7561 6e74 6974 792e  stropy quantity.
-00034850: 2229 0a0a 2020 2020 2020 2020 6966 2063  ")..        if c
-00034860: 656e 7472 616c 5f63 6f6f 7264 2069 7320  entral_coord is 
-00034870: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00034880: 2020 6365 6e74 7261 6c5f 636f 6f72 6420    central_coord 
-00034890: 3d20 7365 6c66 2e64 6566 6175 6c74 5f63  = self.default_c
-000348a0: 6f6f 7264 0a20 2020 2020 2020 2063 656e  oord.        cen
-000348b0: 5f63 6875 6e6b 203d 2022 7261 7b72 7d5f  _chunk = "ra{r}_
-000348c0: 6465 637b 647d 5f22 2e66 6f72 6d61 7428  dec{d}_".format(
-000348d0: 723d 6365 6e74 7261 6c5f 636f 6f72 645b  r=central_coord[
-000348e0: 305d 2e76 616c 7565 2c20 643d 6365 6e74  0].value, d=cent
-000348f0: 7261 6c5f 636f 6f72 645b 315d 2e76 616c  ral_coord[1].val
-00034900: 7565 290a 0a20 2020 2020 2020 2069 6620  ue)..        if 
-00034910: 7261 6469 6920 6973 206e 6f74 204e 6f6e  radii is not Non
-00034920: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00034930: 6164 6969 203d 2073 656c 662e 636f 6e76  adii = self.conv
-00034940: 6572 745f 7261 6469 7573 2872 6164 6969  ert_radius(radii
-00034950: 2c20 2764 6567 2729 0a20 2020 2020 2020  , 'deg').       
-00034960: 2020 2020 2072 6164 5f63 6875 6e6b 203d       rad_chunk =
-00034970: 2022 7222 202b 2022 5f22 2e6a 6f69 6e28   "r" + "_".join(
-00034980: 7261 6469 692e 7661 6c75 652e 6173 7479  radii.value.asty
-00034990: 7065 2873 7472 2929 0a20 2020 2020 2020  pe(str)).       
-000349a0: 2020 2020 2072 6164 5f69 6e66 6f20 3d20       rad_info = 
-000349b0: 5472 7565 0a20 2020 2020 2020 2065 6c73  True.        els
-000349c0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000349d0: 6164 5f69 6e66 6f20 3d20 4661 6c73 650a  ad_info = False.
-000349e0: 0a20 2020 2020 2020 2062 726f 6164 5f70  .        broad_p
-000349f0: 726f 6473 203d 2073 656c 662e 6765 745f  rods = self.get_
-00034a00: 7072 6f64 7563 7473 2873 6561 7263 685f  products(search_
-00034a10: 6b65 792c 206f 6273 5f69 642c 2069 6e73  key, obs_id, ins
-00034a20: 742c 206a 7573 745f 6f62 6a3d 4661 6c73  t, just_obj=Fals
-00034a30: 6529 0a20 2020 2020 2020 206d 6174 6368  e).        match
-00034a40: 6564 5f70 726f 6473 203d 205b 5d0a 2020  ed_prods = [].  
-00034a50: 2020 2020 2020 666f 7220 7020 696e 2062        for p in b
-00034a60: 726f 6164 5f70 726f 6473 3a0a 2020 2020  road_prods:.    
-00034a70: 2020 2020 2020 2020 7261 645f 7374 7220          rad_str 
-00034a80: 3d20 705b 2d32 5d2e 7370 6c69 7428 225f  = p[-2].split("_
-00034a90: 7374 2229 5b30 5d2e 7370 6c69 7428 6365  st")[0].split(ce
-00034aa0: 6e5f 6368 756e 6b29 5b2d 315d 0a0a 2020  n_chunk)[-1]..  
-00034ab0: 2020 2020 2020 2020 2020 6966 2063 656e            if cen
-00034ac0: 5f63 6875 6e6b 2069 6e20 705b 2d32 5d20  _chunk in p[-2] 
-00034ad0: 616e 6420 656e 6572 6779 5f6b 6579 2069  and energy_key i
-00034ae0: 6e20 705b 2d32 5d20 616e 6420 7261 645f  n p[-2] and rad_
-00034af0: 696e 666f 2061 6e64 2072 6164 5f73 7472  info and rad_str
-00034b00: 203d 3d20 7261 645f 6368 756e 6b3a 0a20   == rad_chunk:. 
-00034b10: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00034b20: 6174 6368 6564 5f70 726f 6473 2e61 7070  atched_prods.app
-00034b30: 656e 6428 705b 2d31 5d29 0a20 2020 2020  end(p[-1]).     
-00034b40: 2020 2020 2020 2065 6c69 6620 6365 6e5f         elif cen_
-00034b50: 6368 756e 6b20 696e 2070 5b2d 325d 2061  chunk in p[-2] a
-00034b60: 6e64 2065 6e65 7267 795f 6b65 7920 696e  nd energy_key in
-00034b70: 2070 5b2d 325d 2061 6e64 206e 6f74 2072   p[-2] and not r
-00034b80: 6164 5f69 6e66 6f3a 0a20 2020 2020 2020  ad_info:.       
-00034b90: 2020 2020 2020 2020 206d 6174 6368 6564           matched
-00034ba0: 5f70 726f 6473 2e61 7070 656e 6428 705b  _prods.append(p[
-00034bb0: 2d31 5d29 0a0a 2020 2020 2020 2020 7265  -1])..        re
-00034bc0: 7475 726e 206d 6174 6368 6564 5f70 726f  turn matched_pro
-00034bd0: 6473 0a0a 2020 2020 6465 6620 6765 745f  ds..    def get_
-00034be0: 7072 6f66 696c 6573 2873 656c 662c 2070  profiles(self, p
-00034bf0: 726f 6669 6c65 5f74 7970 653a 2073 7472  rofile_type: str
-00034c00: 2c20 6f62 735f 6964 3a20 7374 7220 3d20  , obs_id: str = 
-00034c10: 4e6f 6e65 2c20 696e 7374 3a20 7374 7220  None, inst: str 
-00034c20: 3d20 4e6f 6e65 2c20 6365 6e74 7261 6c5f  = None, central_
-00034c30: 636f 6f72 643a 2051 7561 6e74 6974 7920  coord: Quantity 
-00034c40: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00034c50: 2020 2020 2020 2020 2020 2020 2072 6164               rad
-00034c60: 6969 3a20 5175 616e 7469 7479 203d 204e  ii: Quantity = N
-00034c70: 6f6e 652c 206c 6f5f 656e 3a20 5175 616e  one, lo_en: Quan
-00034c80: 7469 7479 203d 204e 6f6e 652c 2068 695f  tity = None, hi_
-00034c90: 656e 3a20 5175 616e 7469 7479 203d 204e  en: Quantity = N
-00034ca0: 6f6e 6529 205c 0a20 2020 2020 2020 2020  one) \.         
-00034cb0: 2020 202d 3e20 556e 696f 6e5b 4261 7365     -> Union[Base
-00034cc0: 5072 6f66 696c 6531 442c 204c 6973 745b  Profile1D, List[
-00034cd0: 4261 7365 5072 6f66 696c 6531 445d 5d3a  BaseProfile1D]]:
-00034ce0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00034cf0: 2020 2020 2054 6869 7320 6973 2074 6865       This is the
-00034d00: 2067 656e 6572 6963 2067 6574 206d 6574   generic get met
-00034d10: 686f 6420 666f 7220 5847 4120 7072 6f66  hod for XGA prof
-00034d20: 696c 6520 6f62 6a65 6374 7320 7374 6f72  ile objects stor
-00034d30: 6564 2069 6e20 7468 6973 2073 6f75 7263  ed in this sourc
-00034d40: 652e 2059 6f75 2073 7469 6c6c 206d 7573  e. You still mus
-00034d50: 7420 7265 6d65 6d62 6572 0a20 2020 2020  t remember.     
-00034d60: 2020 2074 6865 2070 726f 6669 6c65 2074     the profile t
-00034d70: 7970 6520 7661 6c75 6520 746f 2075 7365  ype value to use
-00034d80: 2069 742c 2062 7574 206f 6e63 6520 656e   it, but once en
-00034d90: 7465 7265 6420 6974 2077 696c 6c20 7265  tered it will re
-00034da0: 7475 726e 2061 206c 6973 7420 6f66 2061  turn a list of a
-00034db0: 6c6c 206d 6174 6368 696e 6720 7072 6f66  ll matching prof
-00034dc0: 696c 6573 2028 6f72 2061 0a20 2020 2020  iles (or a.     
-00034dd0: 2020 2073 696e 676c 6520 6f62 6a65 6374     single object
-00034de0: 2069 6620 6f6e 6c79 206f 6e65 206d 6174   if only one mat
-00034df0: 6368 2069 7320 666f 756e 6429 2e0a 0a20  ch is found)... 
-00034e00: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00034e10: 7220 7072 6f66 696c 655f 7479 7065 3a20  r profile_type: 
-00034e20: 5468 6520 7374 7269 6e67 2070 726f 6669  The string profi
-00034e30: 6c65 2074 7970 6520 6f66 2074 6865 2070  le type of the p
-00034e40: 726f 6669 6c65 2873 2920 796f 7520 7769  rofile(s) you wi
-00034e50: 7368 2074 6f20 7265 7472 6965 7665 2e0a  sh to retrieve..
-00034e60: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-00034e70: 7472 206f 6273 5f69 643a 204f 7074 696f  tr obs_id: Optio
-00034e80: 6e61 6c6c 792c 2061 2073 7065 6369 6669  nally, a specifi
-00034e90: 6320 6f62 735f 6964 2074 6f20 7365 6172  c obs_id to sear
-00034ea0: 6368 2066 6f72 2063 616e 2062 6520 7375  ch for can be su
-00034eb0: 7070 6c69 6564 2e20 5468 6520 6465 6661  pplied. The defa
-00034ec0: 756c 7420 6973 204e 6f6e 652c 0a20 2020  ult is None,.   
-00034ed0: 2020 2020 2020 2020 2077 6869 6368 206d           which m
-00034ee0: 6561 6e73 2061 6c6c 2070 726f 6669 6c65  eans all profile
-00034ef0: 7320 6d61 7463 6869 6e67 2074 6865 206f  s matching the o
-00034f00: 7468 6572 2063 7269 7465 7269 6120 7769  ther criteria wi
-00034f10: 6c6c 2062 6520 7265 7475 726e 6564 2e0a  ll be returned..
-00034f20: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-00034f30: 7472 2069 6e73 743a 204f 7074 696f 6e61  tr inst: Optiona
-00034f40: 6c6c 792c 2061 2073 7065 6369 6669 6320  lly, a specific 
-00034f50: 696e 7374 7275 6d65 6e74 2074 6f20 7365  instrument to se
-00034f60: 6172 6368 2066 6f72 2063 616e 2062 6520  arch for can be 
-00034f70: 7375 7070 6c69 6564 2e20 5468 6520 6465  supplied. The de
-00034f80: 6661 756c 7420 6973 204e 6f6e 652c 0a20  fault is None,. 
-00034f90: 2020 2020 2020 2020 2020 2077 6869 6368             which
-00034fa0: 206d 6561 6e73 2061 6c6c 2070 726f 6669   means all profi
-00034fb0: 6c65 7320 6d61 7463 6869 6e67 2074 6865  les matching the
-00034fc0: 206f 7468 6572 2063 7269 7465 7269 6120   other criteria 
-00034fd0: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
-00034fe0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00034ff0: 2051 7561 6e74 6974 7920 6365 6e74 7261   Quantity centra
-00035000: 6c5f 636f 6f72 643a 2054 6865 2063 656e  l_coord: The cen
-00035010: 7472 616c 2063 6f6f 7264 696e 6174 6520  tral coordinate 
-00035020: 6f66 2074 6865 2070 726f 6669 6c65 2079  of the profile y
-00035030: 6f75 2077 6973 6820 746f 2072 6574 7269  ou wish to retri
-00035040: 6576 652c 2074 6865 2064 6566 6175 6c74  eve, the default
-00035050: 0a20 2020 2020 2020 2020 2020 2069 7320  .            is 
-00035060: 4e6f 6e65 2077 6869 6368 206d 6561 6e73  None which means
-00035070: 2074 6865 206d 6574 686f 6420 7769 6c6c   the method will
-00035080: 2075 7365 2074 6865 2064 6566 6175 6c74   use the default
-00035090: 2063 6f6f 7264 696e 6174 6520 6f66 2074   coordinate of t
-000350a0: 6869 7320 736f 7572 6365 2e0a 2020 2020  his source..    
-000350b0: 2020 2020 3a70 6172 616d 2051 7561 6e74      :param Quant
-000350c0: 6974 7920 7261 6469 693a 2054 6865 2063  ity radii: The c
-000350d0: 656e 7472 616c 2072 6164 6969 206f 6620  entral radii of 
-000350e0: 7468 6520 7072 6f66 696c 6520 706f 696e  the profile poin
-000350f0: 7473 2c20 6974 2069 7320 6e6f 7420 6c69  ts, it is not li
-00035100: 6b65 6c79 2074 6861 7420 7468 6973 206f  kely that this o
-00035110: 7074 696f 6e20 7769 6c6c 2062 650a 2020  ption will be.  
-00035120: 2020 2020 2020 2020 2020 7573 6564 206f            used o
-00035130: 6674 656e 2061 7320 796f 7520 6c69 6b65  ften as you like
-00035140: 6c79 2077 6f6e 2774 206b 6e6f 7720 7468  ly won't know th
-00035150: 6520 7261 6469 616c 2076 616c 7565 7320  e radial values 
-00035160: 6120 7072 696f 7269 2e0a 2020 2020 2020  a priori..      
-00035170: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
-00035180: 7920 6c6f 5f65 6e3a 2054 6865 206c 6f77  y lo_en: The low
-00035190: 6572 2065 6e65 7267 7920 626f 756e 6420  er energy bound 
-000351a0: 6f66 2074 6865 2070 726f 6669 6c65 2079  of the profile y
-000351b0: 6f75 2077 6973 6820 746f 2072 6574 7269  ou wish to retri
-000351c0: 6576 6520 2869 6620 6170 706c 6963 6162  eve (if applicab
-000351d0: 6c65 292c 2064 6566 6175 6c74 0a20 2020  le), default.   
-000351e0: 2020 2020 2020 2020 2069 7320 4e6f 6e65           is None
-000351f0: 2c20 616e 6420 6966 2074 6869 7320 6172  , and if this ar
-00035200: 6775 6d65 6e74 2069 7320 7061 7373 6564  gument is passed
-00035210: 2068 695f 656e 206d 7573 7420 6265 2074   hi_en must be t
-00035220: 6f6f 2e0a 2020 2020 2020 2020 3a70 6172  oo..        :par
-00035230: 616d 2051 7561 6e74 6974 7920 6869 5f65  am Quantity hi_e
-00035240: 6e3a 2054 6865 2068 6967 6865 7220 656e  n: The higher en
-00035250: 6572 6779 2062 6f75 6e64 206f 6620 7468  ergy bound of th
-00035260: 6520 7072 6f66 696c 6520 796f 7520 7769  e profile you wi
-00035270: 7368 2074 6f20 7265 7472 6965 7665 2028  sh to retrieve (
-00035280: 6966 2061 7070 6c69 6361 626c 6529 2c20  if applicable), 
-00035290: 6465 6661 756c 740a 2020 2020 2020 2020  default.        
-000352a0: 2020 2020 6973 204e 6f6e 652c 2061 6e64      is None, and
-000352b0: 2069 6620 7468 6973 2061 7267 756d 656e   if this argumen
-000352c0: 7420 6973 2070 6173 7365 6420 6c6f 5f65  t is passed lo_e
-000352d0: 6e20 6d75 7374 2062 6520 746f 6f2e 0a20  n must be too.. 
-000352e0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-000352f0: 416e 2058 4741 2070 726f 6669 6c65 206f  An XGA profile o
-00035300: 626a 6563 7420 2869 6620 7468 6572 6520  bject (if there 
-00035310: 6973 2061 6e20 6578 6163 7420 6d61 7463  is an exact matc
-00035320: 6829 2c20 6f72 2061 206c 6973 7420 6f66  h), or a list of
-00035330: 2058 4741 2070 726f 6669 6c65 206f 626a   XGA profile obj
-00035340: 6563 7473 2028 6966 2074 6865 7265 0a20  ects (if there. 
-00035350: 2020 2020 2020 2020 2020 2077 6572 6520             were 
-00035360: 6d75 6c74 6970 6c65 206d 6174 6368 696e  multiple matchin
-00035370: 6720 7072 6f64 7563 7473 292e 0a20 2020  g products)..   
-00035380: 2020 2020 203a 7274 7970 653a 2055 6e69       :rtype: Uni
-00035390: 6f6e 5b42 6173 6550 726f 6669 6c65 3144  on[BaseProfile1D
-000353a0: 2c20 4c69 7374 5b42 6173 6550 726f 6669  , List[BaseProfi
-000353b0: 6c65 3144 5d5d 0a20 2020 2020 2020 2022  le1D]].        "
-000353c0: 2222 0a20 2020 2020 2020 2069 6620 2270  "".        if "p
-000353d0: 726f 6669 6c65 2220 696e 2070 726f 6669  rofile" in profi
-000353e0: 6c65 5f74 7970 653a 0a20 2020 2020 2020  le_type:.       
-000353f0: 2020 2020 2077 6172 6e28 2254 6865 2070       warn("The p
-00035400: 726f 6669 6c65 5f74 7970 6520 796f 7520  rofile_type you 
-00035410: 7061 7373 6564 2063 6f6e 7461 696e 7320  passed contains 
-00035420: 7468 6520 776f 7264 2027 7072 6f66 696c  the word 'profil
-00035430: 6527 2c20 7768 6963 6820 6973 2061 7070  e', which is app
-00035440: 656e 6465 6420 6f6e 746f 2022 0a20 2020  ended onto ".   
-00035450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035460: 2020 2020 2020 2022 6120 7072 6f66 696c         "a profil
-00035470: 6520 7479 7065 2062 7920 5847 412c 2079  e type by XGA, y
-00035480: 6f75 206e 6565 6420 746f 2074 7279 2074  ou need to try t
-00035490: 6869 7320 6167 6169 6e20 7769 7468 6f75  his again withou
-000354a0: 7420 7072 6f66 696c 6520 6f6e 2074 6865  t profile on the
-000354b0: 2065 6e64 2c20 756e 6c65 7373 220a 2020   end, unless".  
-000354c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000354d0: 2020 2020 2020 2020 2220 796f 7520 6761          " you ga
-000354e0: 7665 2061 2067 656e 6572 6963 2070 726f  ve a generic pro
-000354f0: 6669 6c65 2061 2074 7970 6520 7769 7468  file a type with
-00035500: 2027 7072 6f66 696c 6527 2069 6e2e 222c   'profile' in.",
-00035510: 2073 7461 636b 6c65 7665 6c3d 3229 0a0a   stacklevel=2)..
-00035520: 2020 2020 2020 2020 7365 6172 6368 5f6b          search_k
-00035530: 6579 203d 2070 726f 6669 6c65 5f74 7970  ey = profile_typ
-00035540: 6520 2b20 225f 7072 6f66 696c 6522 0a20  e + "_profile". 
-00035550: 2020 2020 2020 2069 6620 616c 6c28 5b6f         if all([o
-00035560: 6273 5f69 6420 6973 204e 6f6e 652c 2069  bs_id is None, i
-00035570: 6e73 7420 6973 204e 6f6e 655d 293a 0a20  nst is None]):. 
-00035580: 2020 2020 2020 2020 2020 2073 6561 7263             searc
-00035590: 685f 6b65 7920 3d20 2263 6f6d 6269 6e65  h_key = "combine
-000355a0: 645f 2220 2b20 7365 6172 6368 5f6b 6579  d_" + search_key
-000355b0: 0a0a 2020 2020 2020 2020 7365 6172 6368  ..        search
-000355c0: 5f6b 6579 203d 2070 726f 6669 6c65 5f74  _key = profile_t
-000355d0: 7970 6520 2b20 225f 7072 6f66 696c 6522  ype + "_profile"
-000355e0: 0a20 2020 2020 2020 2069 6620 7365 6172  .        if sear
-000355f0: 6368 5f6b 6579 206e 6f74 2069 6e20 414c  ch_key not in AL
-00035600: 4c4f 5745 445f 5052 4f44 5543 5453 3a0a  LOWED_PRODUCTS:.
-00035610: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-00035620: 2822 7b7d 2073 6565 6d73 2074 6f20 6265  ("{} seems to be
-00035630: 2061 2063 7573 746f 6d20 7072 6f66 696c   a custom profil
-00035640: 652c 206e 6f74 2061 6e20 5847 4120 6465  e, not an XGA de
-00035650: 6661 756c 7420 7479 7065 2e20 4966 2074  fault type. If t
-00035660: 6869 7320 6973 206e 6f74 2022 0a20 2020  his is not ".   
-00035670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035680: 2020 2020 2020 2022 7472 7565 2074 6865         "true the
-00035690: 6e20 796f 7520 6861 7665 2070 6173 7365  n you have passe
-000356a0: 6420 616e 2069 6e76 616c 6964 2070 726f  d an invalid pro
-000356b0: 6669 6c65 2074 7970 652e 222e 666f 726d  file type.".form
-000356c0: 6174 2873 6561 7263 685f 6b65 7929 2c20  at(search_key), 
-000356d0: 7374 6163 6b6c 6576 656c 3d32 290a 0a20  stacklevel=2).. 
-000356e0: 2020 2020 2020 206d 6174 6368 6564 5f70         matched_p
-000356f0: 726f 6473 203d 2073 656c 662e 5f67 6574  rods = self._get
-00035700: 5f70 726f 665f 7072 6f64 2873 6561 7263  _prof_prod(searc
-00035710: 685f 6b65 792c 206f 6273 5f69 642c 2069  h_key, obs_id, i
-00035720: 6e73 742c 2063 656e 7472 616c 5f63 6f6f  nst, central_coo
-00035730: 7264 2c20 7261 6469 692c 206c 6f5f 656e  rd, radii, lo_en
-00035740: 2c20 6869 5f65 6e29 0a20 2020 2020 2020  , hi_en).       
-00035750: 2069 6620 6c65 6e28 6d61 7463 6865 645f   if len(matched_
-00035760: 7072 6f64 7329 203d 3d20 313a 0a20 2020  prods) == 1:.   
-00035770: 2020 2020 2020 2020 206d 6174 6368 6564           matched
-00035780: 5f70 726f 6473 203d 206d 6174 6368 6564  _prods = matched
-00035790: 5f70 726f 6473 5b30 5d0a 2020 2020 2020  _prods[0].      
-000357a0: 2020 656c 6966 206c 656e 286d 6174 6368    elif len(match
-000357b0: 6564 5f70 726f 6473 2920 3d3d 2030 3a0a  ed_prods) == 0:.
-000357c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000357d0: 6520 4e6f 5072 6f64 7563 7441 7661 696c  e NoProductAvail
-000357e0: 6162 6c65 4572 726f 7228 2243 616e 6e6f  ableError("Canno
-000357f0: 7420 6669 6e64 2061 6e79 207b 707d 2070  t find any {p} p
-00035800: 726f 6669 6c65 7320 6d61 7463 6869 6e67  rofiles matching
-00035810: 2079 6f75 7220 696e 7075 742e 222e 666f   your input.".fo
-00035820: 726d 6174 2870 3d70 726f 6669 6c65 5f74  rmat(p=profile_t
-00035830: 7970 6529 290a 0a20 2020 2020 2020 2072  ype))..        r
-00035840: 6574 7572 6e20 6d61 7463 6865 645f 7072  eturn matched_pr
-00035850: 6f64 730a 0a20 2020 2064 6566 2067 6574  ods..    def get
-00035860: 5f63 6f6d 6269 6e65 645f 7072 6f66 696c  _combined_profil
-00035870: 6573 2873 656c 662c 2070 726f 6669 6c65  es(self, profile
-00035880: 5f74 7970 653a 2073 7472 2c20 6365 6e74  _type: str, cent
-00035890: 7261 6c5f 636f 6f72 643a 2051 7561 6e74  ral_coord: Quant
-000358a0: 6974 7920 3d20 4e6f 6e65 2c20 7261 6469  ity = None, radi
-000358b0: 693a 2051 7561 6e74 6974 7920 3d20 4e6f  i: Quantity = No
-000358c0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-000358d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000358e0: 2020 6c6f 5f65 6e3a 2051 7561 6e74 6974    lo_en: Quantit
-000358f0: 7920 3d20 4e6f 6e65 2c20 6869 5f65 6e3a  y = None, hi_en:
-00035900: 2051 7561 6e74 6974 7920 3d20 4e6f 6e65   Quantity = None
-00035910: 2920 5c0a 2020 2020 2020 2020 2020 2020  ) \.            
-00035920: 2d3e 2055 6e69 6f6e 5b42 6173 6550 726f  -> Union[BasePro
-00035930: 6669 6c65 3144 2c20 4c69 7374 5b42 6173  file1D, List[Bas
-00035940: 6550 726f 6669 6c65 3144 5d5d 3a0a 2020  eProfile1D]]:.  
-00035950: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00035960: 2020 5468 6520 6765 6e65 7269 6320 6765    The generic ge
-00035970: 7420 6d65 7468 6f64 2066 6f72 2058 4741  t method for XGA
-00035980: 2070 726f 6669 6c65 7320 6d61 6465 2075   profiles made u
-00035990: 7369 6e67 2061 6c6c 2061 7661 696c 6162  sing all availab
-000359a0: 6c65 2064 6174 6120 7768 6963 6820 6172  le data which ar
-000359b0: 6520 7374 6f72 6564 2069 6e20 7468 6973  e stored in this
-000359c0: 2073 6f75 7263 652e 0a20 2020 2020 2020   source..       
-000359d0: 2059 6f75 2073 7469 6c6c 206d 7573 7420   You still must 
-000359e0: 7265 6d65 6d62 6572 2074 6865 2070 726f  remember the pro
-000359f0: 6669 6c65 2074 7970 6520 7661 6c75 6520  file type value 
-00035a00: 746f 2075 7365 2069 742c 2062 7574 206f  to use it, but o
-00035a10: 6e63 6520 656e 7465 7265 6420 6974 2077  nce entered it w
-00035a20: 696c 6c20 7265 7475 726e 2061 206c 6973  ill return a lis
-00035a30: 740a 2020 2020 2020 2020 6f66 2061 6c6c  t.        of all
-00035a40: 206d 6174 6368 696e 6720 7072 6f66 696c   matching profil
-00035a50: 6573 2028 6f72 2061 2073 696e 676c 6520  es (or a single 
-00035a60: 6f62 6a65 6374 2069 6620 6f6e 6c79 206f  object if only o
-00035a70: 6e65 206d 6174 6368 2069 7320 666f 756e  ne match is foun
-00035a80: 6429 2e0a 0a20 2020 2020 2020 203a 7061  d)...        :pa
-00035a90: 7261 6d20 7374 7220 7072 6f66 696c 655f  ram str profile_
-00035aa0: 7479 7065 3a20 5468 6520 7374 7269 6e67  type: The string
-00035ab0: 2070 726f 6669 6c65 2074 7970 6520 6f66   profile type of
-00035ac0: 2074 6865 2070 726f 6669 6c65 2873 2920   the profile(s) 
-00035ad0: 796f 7520 7769 7368 2074 6f20 7265 7472  you wish to retr
-00035ae0: 6965 7665 2e0a 2020 2020 2020 2020 3a70  ieve..        :p
-00035af0: 6172 616d 2051 7561 6e74 6974 7920 6365  aram Quantity ce
-00035b00: 6e74 7261 6c5f 636f 6f72 643a 2054 6865  ntral_coord: The
-00035b10: 2063 656e 7472 616c 2063 6f6f 7264 696e   central coordin
-00035b20: 6174 6520 6f66 2074 6865 2070 726f 6669  ate of the profi
-00035b30: 6c65 2079 6f75 2077 6973 6820 746f 2072  le you wish to r
-00035b40: 6574 7269 6576 652c 2074 6865 2064 6566  etrieve, the def
-00035b50: 6175 6c74 0a20 2020 2020 2020 2020 2020  ault.           
-00035b60: 2069 7320 4e6f 6e65 2077 6869 6368 206d   is None which m
-00035b70: 6561 6e73 2074 6865 206d 6574 686f 6420  eans the method 
-00035b80: 7769 6c6c 2075 7365 2074 6865 2064 6566  will use the def
-00035b90: 6175 6c74 2063 6f6f 7264 696e 6174 6520  ault coordinate 
-00035ba0: 6f66 2074 6869 7320 736f 7572 6365 2e0a  of this source..
-00035bb0: 2020 2020 2020 2020 3a70 6172 616d 2051          :param Q
-00035bc0: 7561 6e74 6974 7920 7261 6469 693a 2054  uantity radii: T
-00035bd0: 6865 2063 656e 7472 616c 2072 6164 6969  he central radii
-00035be0: 206f 6620 7468 6520 7072 6f66 696c 6520   of the profile 
-00035bf0: 706f 696e 7473 2c20 6974 2069 7320 6e6f  points, it is no
-00035c00: 7420 6c69 6b65 6c79 2074 6861 7420 7468  t likely that th
-00035c10: 6973 206f 7074 696f 6e20 7769 6c6c 2062  is option will b
-00035c20: 650a 2020 2020 2020 2020 2020 2020 7573  e.            us
-00035c30: 6564 206f 6674 656e 2061 7320 796f 7520  ed often as you 
-00035c40: 6c69 6b65 6c79 2077 6f6e 2774 206b 6e6f  likely won't kno
-00035c50: 7720 7468 6520 7261 6469 616c 2076 616c  w the radial val
-00035c60: 7565 7320 6120 7072 696f 7269 2e0a 2020  ues a priori..  
-00035c70: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
-00035c80: 6e74 6974 7920 6c6f 5f65 6e3a 2054 6865  ntity lo_en: The
-00035c90: 206c 6f77 6572 2065 6e65 7267 7920 626f   lower energy bo
-00035ca0: 756e 6420 6f66 2074 6865 2070 726f 6669  und of the profi
-00035cb0: 6c65 2079 6f75 2077 6973 6820 746f 2072  le you wish to r
-00035cc0: 6574 7269 6576 6520 2869 6620 6170 706c  etrieve (if appl
-00035cd0: 6963 6162 6c65 292c 2064 6566 6175 6c74  icable), default
-00035ce0: 0a20 2020 2020 2020 2020 2020 2069 7320  .            is 
-00035cf0: 4e6f 6e65 2c20 616e 6420 6966 2074 6869  None, and if thi
-00035d00: 7320 6172 6775 6d65 6e74 2069 7320 7061  s argument is pa
-00035d10: 7373 6564 2068 695f 656e 206d 7573 7420  ssed hi_en must 
-00035d20: 6265 2074 6f6f 2e0a 2020 2020 2020 2020  be too..        
-00035d30: 3a70 6172 616d 2051 7561 6e74 6974 7920  :param Quantity 
-00035d40: 6869 5f65 6e3a 2054 6865 2068 6967 6865  hi_en: The highe
-00035d50: 7220 656e 6572 6779 2062 6f75 6e64 206f  r energy bound o
-00035d60: 6620 7468 6520 7072 6f66 696c 6520 796f  f the profile yo
-00035d70: 7520 7769 7368 2074 6f20 7265 7472 6965  u wish to retrie
-00035d80: 7665 2028 6966 2061 7070 6c69 6361 626c  ve (if applicabl
-00035d90: 6529 2c20 6465 6661 756c 740a 2020 2020  e), default.    
-00035da0: 2020 2020 2020 2020 6973 204e 6f6e 652c          is None,
-00035db0: 2061 6e64 2069 6620 7468 6973 2061 7267   and if this arg
-00035dc0: 756d 656e 7420 6973 2070 6173 7365 6420  ument is passed 
-00035dd0: 6c6f 5f65 6e20 6d75 7374 2062 6520 746f  lo_en must be to
-00035de0: 6f2e 0a20 2020 2020 2020 203a 7265 7475  o..        :retu
-00035df0: 726e 3a20 416e 2058 4741 2070 726f 6669  rn: An XGA profi
-00035e00: 6c65 206f 626a 6563 7420 2869 6620 7468  le object (if th
-00035e10: 6572 6520 6973 2061 6e20 6578 6163 7420  ere is an exact 
-00035e20: 6d61 7463 6829 2c20 6f72 2061 206c 6973  match), or a lis
-00035e30: 7420 6f66 2058 4741 2070 726f 6669 6c65  t of XGA profile
-00035e40: 206f 626a 6563 7473 2028 6966 2074 6865   objects (if the
-00035e50: 7265 0a20 2020 2020 2020 2020 2020 2077  re.            w
-00035e60: 6572 6520 6d75 6c74 6970 6c65 206d 6174  ere multiple mat
-00035e70: 6368 696e 6720 7072 6f64 7563 7473 292e  ching products).
-00035e80: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-00035e90: 2055 6e69 6f6e 5b42 6173 6550 726f 6669   Union[BaseProfi
-00035ea0: 6c65 3144 2c20 4c69 7374 5b42 6173 6550  le1D, List[BaseP
-00035eb0: 726f 6669 6c65 3144 5d5d 0a20 2020 2020  rofile1D]].     
-00035ec0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00035ed0: 6620 2270 726f 6669 6c65 2220 696e 2070  f "profile" in p
-00035ee0: 726f 6669 6c65 5f74 7970 653a 0a20 2020  rofile_type:.   
-00035ef0: 2020 2020 2020 2020 2077 6172 6e28 2254           warn("T
-00035f00: 6865 2070 726f 6669 6c65 5f74 7970 6520  he profile_type 
-00035f10: 796f 7520 7061 7373 6564 2063 6f6e 7461  you passed conta
-00035f20: 696e 7320 7468 6520 776f 7264 2027 7072  ins the word 'pr
-00035f30: 6f66 696c 6527 2c20 7768 6963 6820 6973  ofile', which is
-00035f40: 2061 7070 656e 6465 6420 6f6e 746f 2022   appended onto "
-00035f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035f60: 2020 2020 2020 2020 2020 2022 6120 7072             "a pr
-00035f70: 6f66 696c 6520 7479 7065 2062 7920 5847  ofile type by XG
-00035f80: 412c 2079 6f75 206e 6565 6420 746f 2074  A, you need to t
-00035f90: 7279 2074 6869 7320 6167 6169 6e20 7769  ry this again wi
-00035fa0: 7468 6f75 7420 7072 6f66 696c 6520 6f6e  thout profile on
-00035fb0: 2074 6865 2065 6e64 2c20 756e 6c65 7373   the end, unless
-00035fc0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00035fd0: 2020 2020 2020 2020 2020 2020 2220 796f              " yo
-00035fe0: 7520 6761 7665 2061 2067 656e 6572 6963  u gave a generic
-00035ff0: 2070 726f 6669 6c65 2061 2074 7970 6520   profile a type 
-00036000: 7769 7468 2027 7072 6f66 696c 6527 2069  with 'profile' i
-00036010: 6e2e 222c 2073 7461 636b 6c65 7665 6c3d  n.", stacklevel=
-00036020: 3229 0a0a 2020 2020 2020 2020 7365 6172  2)..        sear
-00036030: 6368 5f6b 6579 203d 2022 636f 6d62 696e  ch_key = "combin
-00036040: 6564 5f22 202b 2070 726f 6669 6c65 5f74  ed_" + profile_t
-00036050: 7970 6520 2b20 225f 7072 6f66 696c 6522  ype + "_profile"
-00036060: 0a0a 2020 2020 2020 2020 6966 2073 6561  ..        if sea
-00036070: 7263 685f 6b65 7920 6e6f 7420 696e 2041  rch_key not in A
-00036080: 4c4c 4f57 4544 5f50 524f 4455 4354 533a  LLOWED_PRODUCTS:
-00036090: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
-000360a0: 6e28 2254 6861 7420 7072 6f66 696c 6520  n("That profile 
-000360b0: 7479 7065 2073 6565 6d73 2074 6f20 6265  type seems to be
-000360c0: 2061 2063 7573 746f 6d20 7072 6f66 696c   a custom profil
-000360d0: 652c 206e 6f74 2061 6e20 5847 4120 6465  e, not an XGA de
-000360e0: 6661 756c 7420 7479 7065 2e20 4966 2074  fault type. If t
-000360f0: 6869 7320 6973 206e 6f74 2022 0a20 2020  his is not ".   
-00036100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036110: 2020 2020 2020 2022 7472 7565 2074 6865         "true the
-00036120: 6e20 796f 7520 6861 7665 2070 6173 7365  n you have passe
-00036130: 6420 616e 2069 6e76 616c 6964 2070 726f  d an invalid pro
-00036140: 6669 6c65 2074 7970 652e 222c 2073 7461  file type.", sta
-00036150: 636b 6c65 7665 6c3d 3229 0a0a 2020 2020  cklevel=2)..    
-00036160: 2020 2020 6d61 7463 6865 645f 7072 6f64      matched_prod
-00036170: 7320 3d20 7365 6c66 2e5f 6765 745f 7072  s = self._get_pr
-00036180: 6f66 5f70 726f 6428 7365 6172 6368 5f6b  of_prod(search_k
-00036190: 6579 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20  ey, None, None, 
-000361a0: 6365 6e74 7261 6c5f 636f 6f72 642c 2072  central_coord, r
-000361b0: 6164 6969 2c20 6c6f 5f65 6e2c 2068 695f  adii, lo_en, hi_
-000361c0: 656e 290a 2020 2020 2020 2020 6966 206c  en).        if l
-000361d0: 656e 286d 6174 6368 6564 5f70 726f 6473  en(matched_prods
-000361e0: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
-000361f0: 2020 2020 6d61 7463 6865 645f 7072 6f64      matched_prod
-00036200: 7320 3d20 6d61 7463 6865 645f 7072 6f64  s = matched_prod
-00036210: 735b 305d 0a20 2020 2020 2020 2065 6c69  s[0].        eli
-00036220: 6620 6c65 6e28 6d61 7463 6865 645f 7072  f len(matched_pr
-00036230: 6f64 7329 203d 3d20 303a 0a20 2020 2020  ods) == 0:.     
-00036240: 2020 2020 2020 2072 6169 7365 204e 6f50         raise NoP
-00036250: 726f 6475 6374 4176 6169 6c61 626c 6545  roductAvailableE
-00036260: 7272 6f72 2822 4361 6e6e 6f74 2066 696e  rror("Cannot fin
-00036270: 6420 616e 7920 636f 6d62 696e 6564 207b  d any combined {
-00036280: 707d 2070 726f 6669 6c65 7320 6d61 7463  p} profiles matc
-00036290: 6869 6e67 2079 6f75 7220 220a 2020 2020  hing your ".    
-000362a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000362b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000362c0: 2020 2020 2020 2269 6e70 7574 2e22 2e66        "input.".f
-000362d0: 6f72 6d61 7428 703d 7072 6f66 696c 655f  ormat(p=profile_
-000362e0: 7479 7065 2929 0a0a 2020 2020 2020 2020  type))..        
-000362f0: 7265 7475 726e 206d 6174 6368 6564 5f70  return matched_p
-00036300: 726f 6473 0a0a 2020 2020 4070 726f 7065  rods..    @prope
-00036310: 7274 790a 2020 2020 6465 6620 6669 7474  rty.    def fitt
-00036320: 6564 5f6d 6f64 656c 7328 7365 6c66 2920  ed_models(self) 
-00036330: 2d3e 204c 6973 745b 7374 725d 3a0a 2020  -> List[str]:.  
-00036340: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00036350: 2020 5468 6973 2070 726f 7065 7274 7920    This property 
-00036360: 6379 636c 6573 2074 6872 6f75 6768 2061  cycles through a
-00036370: 6c6c 2074 6865 2061 7661 696c 6162 6c65  ll the available
-00036380: 2066 6974 2072 6573 756c 7473 2c20 616e   fit results, an
-00036390: 6420 6669 6e64 7320 7468 6520 756e 6971  d finds the uniq
-000363a0: 7565 206e 616d 6573 206f 6620 5853 5045  ue names of XSPE
-000363b0: 4320 6d6f 6465 6c73 0a20 2020 2020 2020  C models.       
-000363c0: 2074 6861 7420 6861 7665 2062 6565 6e20   that have been 
-000363d0: 6669 7474 6564 2074 6f20 7468 6973 2073  fitted to this s
-000363e0: 6f75 7263 652e 0a0a 2020 2020 2020 2020  ource...        
-000363f0: 3a72 6574 7572 6e3a 2041 206c 6973 7420  :return: A list 
-00036400: 6f66 206d 6f64 656c 206e 616d 6573 2e0a  of model names..
-00036410: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-00036420: 4c69 7374 5b73 7472 5d0a 2020 2020 2020  List[str].      
-00036430: 2020 2222 220a 2020 2020 2020 2020 6d6f    """.        mo
-00036440: 6465 6c73 203d 205b 5d0a 2020 2020 2020  dels = [].      
-00036450: 2020 666f 7220 735f 6b65 7920 696e 2073    for s_key in s
-00036460: 656c 662e 5f66 6974 5f72 6573 756c 7473  elf._fit_results
-00036470: 3a0a 2020 2020 2020 2020 2020 2020 6d6f  :.            mo
-00036480: 6465 6c73 202b 3d20 6c69 7374 2873 656c  dels += list(sel
-00036490: 662e 5f66 6974 5f72 6573 756c 7473 5b73  f._fit_results[s
-000364a0: 5f6b 6579 5d2e 6b65 7973 2829 290a 0a20  _key].keys()).. 
-000364b0: 2020 2020 2020 2072 6574 7572 6e20 6d6f         return mo
-000364c0: 6465 6c73 0a0a 2020 2020 6465 6620 736e  dels..    def sn
-000364d0: 725f 7261 6e6b 696e 6728 7365 6c66 2c20  r_ranking(self, 
-000364e0: 6f75 7465 725f 7261 6469 7573 3a20 556e  outer_radius: Un
-000364f0: 696f 6e5b 5175 616e 7469 7479 2c20 7374  ion[Quantity, st
-00036500: 725d 2c20 6c6f 5f65 6e3a 2051 7561 6e74  r], lo_en: Quant
-00036510: 6974 7920 3d20 4e6f 6e65 2c20 6869 5f65  ity = None, hi_e
-00036520: 6e3a 2051 7561 6e74 6974 7920 3d20 4e6f  n: Quantity = No
-00036530: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00036540: 2020 2020 2020 2020 616c 6c6f 775f 6e65          allow_ne
-00036550: 6761 7469 7665 3a20 626f 6f6c 203d 2046  gative: bool = F
-00036560: 616c 7365 2920 2d3e 2054 7570 6c65 5b6e  alse) -> Tuple[n
-00036570: 702e 6e64 6172 7261 792c 206e 702e 6e64  p.ndarray, np.nd
-00036580: 6172 7261 795d 3a0a 2020 2020 2020 2020  array]:.        
-00036590: 2222 220a 2020 2020 2020 2020 5468 6973  """.        This
-000365a0: 206d 6574 686f 6420 6765 6e65 7261 7465   method generate
-000365b0: 7320 6120 6c69 7374 206f 6620 4f62 7349  s a list of ObsI
-000365c0: 442d 496e 7374 7275 6d65 6e74 2070 6169  D-Instrument pai
-000365d0: 7273 2c20 6f72 6465 7265 6420 6279 2074  rs, ordered by t
-000365e0: 6865 2073 6967 6e61 6c20 746f 206e 6f69  he signal to noi
-000365f0: 7365 206d 6561 7375 7265 6420 666f 7220  se measured for 
-00036600: 7468 650a 2020 2020 2020 2020 6769 7665  the.        give
-00036610: 6e20 7265 6769 6f6e 2c20 7769 7468 2065  n region, with e
-00036620: 6c65 6d65 6e74 207a 6572 6f20 6265 696e  lement zero bein
-00036630: 6720 7468 6520 6c6f 7765 7374 2053 4e52  g the lowest SNR
-00036640: 2c20 616e 6420 656c 656d 656e 7420 4e20  , and element N 
-00036650: 6265 696e 6720 7468 6520 6869 6768 6573  being the highes
-00036660: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
-00036670: 616d 2051 7561 6e74 6974 792f 7374 7220  am Quantity/str 
-00036680: 6f75 7465 725f 7261 6469 7573 3a20 5468  outer_radius: Th
-00036690: 6520 7261 6469 7573 2074 6861 7420 534e  e radius that SN
-000366a0: 5220 7368 6f75 6c64 2062 6520 6361 6c63  R should be calc
-000366b0: 756c 6174 6564 2077 6974 6869 6e2c 2074  ulated within, t
-000366c0: 6869 7320 6361 6e20 6569 7468 6572 2062  his can either b
-000366d0: 6520 610a 2020 2020 2020 2020 2020 2020  e a.            
-000366e0: 6e61 6d65 6420 7261 6469 7573 2073 7563  named radius suc
-000366f0: 6820 6173 2072 3530 302c 206f 7220 616e  h as r500, or an
-00036700: 2061 7374 726f 7079 2051 7561 6e74 6974   astropy Quantit
-00036710: 792e 0a20 2020 2020 2020 203a 7061 7261  y..        :para
-00036720: 6d20 5175 616e 7469 7479 206c 6f5f 656e  m Quantity lo_en
-00036730: 3a20 5468 6520 6c6f 7765 7220 656e 6572  : The lower ener
-00036740: 6779 2062 6f75 6e64 206f 6620 7468 6520  gy bound of the 
-00036750: 7261 7465 6d61 7020 746f 2075 7365 2074  ratemap to use t
-00036760: 6f20 6361 6c63 756c 6174 6520 7468 6520  o calculate the 
-00036770: 534e 522e 2044 6566 6175 6c74 2069 7320  SNR. Default is 
-00036780: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00036790: 2020 696e 2077 6869 6368 2063 6173 6520    in which case 
-000367a0: 7468 6520 6c6f 7765 7220 656e 6572 6779  the lower energy
-000367b0: 2062 6f75 6e64 2066 6f72 2070 6561 6b20   bound for peak 
-000367c0: 6669 6e64 696e 6720 7769 6c6c 2062 6520  finding will be 
-000367d0: 7573 6564 2028 6465 6661 756c 7420 6973  used (default is
-000367e0: 2030 2e35 6b65 5629 2e0a 2020 2020 2020   0.5keV)..      
-000367f0: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
-00036800: 7920 6869 5f65 6e3a 2054 6865 2075 7070  y hi_en: The upp
-00036810: 6572 2065 6e65 7267 7920 626f 756e 6420  er energy bound 
-00036820: 6f66 2074 6865 2072 6174 656d 6170 2074  of the ratemap t
-00036830: 6f20 7573 6520 746f 2063 616c 6375 6c61  o use to calcula
-00036840: 7465 2074 6865 2053 4e52 2e20 4465 6661  te the SNR. Defa
-00036850: 756c 7420 6973 204e 6f6e 652c 0a20 2020  ult is None,.   
-00036860: 2020 2020 2020 2020 2069 6e20 7768 6963           in whic
-00036870: 6820 6361 7365 2074 6865 2075 7070 6572  h case the upper
-00036880: 2065 6e65 7267 7920 626f 756e 6420 666f   energy bound fo
-00036890: 7220 7065 616b 2066 696e 6469 6e67 2077  r peak finding w
-000368a0: 696c 6c20 6265 2075 7365 6420 2864 6566  ill be used (def
-000368b0: 6175 6c74 2069 7320 322e 306b 6556 292e  ault is 2.0keV).
-000368c0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000368d0: 626f 6f6c 2061 6c6c 6f77 5f6e 6567 6174  bool allow_negat
-000368e0: 6976 653a 2053 686f 756c 6420 7069 7865  ive: Should pixe
-000368f0: 6c73 2069 6e20 7468 6520 6261 636b 6772  ls in the backgr
-00036900: 6f75 6e64 2073 7562 7472 6163 7465 6420  ound subtracted 
-00036910: 636f 756e 7420 6d61 7020 6265 2061 6c6c  count map be all
-00036920: 6f77 6564 2074 6f20 676f 2062 656c 6f77  owed to go below
-00036930: 0a20 2020 2020 2020 2020 2020 207a 6572  .            zer
-00036940: 6f2c 2077 6869 6368 2072 6573 756c 7473  o, which results
-00036950: 2069 6e20 6120 6c6f 7765 7220 7369 676e   in a lower sign
-00036960: 616c 2074 6f20 6e6f 6973 6520 2861 6e64  al to noise (and
-00036970: 2063 616e 2072 6573 756c 7420 696e 2061   can result in a
-00036980: 206e 6567 6174 6976 6520 7369 676e 616c   negative signal
-00036990: 2074 6f20 6e6f 6973 6529 2e0a 2020 2020   to noise)..    
-000369a0: 2020 2020 3a72 6574 7572 6e3a 2054 776f      :return: Two
-000369b0: 2061 7272 6179 732c 2074 6865 2066 6972   arrays, the fir
-000369c0: 7374 2061 6e20 4e20 6279 2032 2061 7272  st an N by 2 arr
-000369d0: 6179 2c20 7769 7468 2074 6865 204f 6273  ay, with the Obs
-000369e0: 4944 2c20 496e 7374 7275 6d65 6e74 2063  ID, Instrument c
-000369f0: 6f6d 6269 6e61 7469 6f6e 7320 696e 206f  ombinations in o
-00036a00: 7264 6572 0a20 2020 2020 2020 2020 2020  rder.           
-00036a10: 206f 6620 6173 6365 6e64 696e 6720 7369   of ascending si
-00036a20: 676e 616c 2074 6f20 6e6f 6973 652c 2074  gnal to noise, t
-00036a30: 6865 6e20 616e 2061 7272 6179 2063 6f6e  hen an array con
-00036a40: 7461 696e 696e 6720 7468 6520 6f72 6465  taining the orde
-00036a50: 7220 534e 5220 7261 7469 6f73 2e0a 2020  r SNR ratios..  
-00036a60: 2020 2020 2020 3a72 7479 7065 3a20 5475        :rtype: Tu
-00036a70: 706c 655b 6e70 2e6e 6461 7272 6179 2c20  ple[np.ndarray, 
-00036a80: 6e70 2e6e 6461 7272 6179 5d0a 2020 2020  np.ndarray].    
-00036a90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00036aa0: 2320 5365 7420 7570 2073 6f6d 6520 6c69  # Set up some li
-00036ab0: 7374 7320 666f 7220 7468 6520 4f62 7349  sts for the ObsI
-00036ac0: 442d 496e 7374 7275 6d65 6e74 2063 6f6d  D-Instrument com
-00036ad0: 626f 7320 616e 6420 7468 6569 7220 534e  bos and their SN
-00036ae0: 5273 2072 6573 7065 6374 6976 656c 790a  Rs respectively.
-00036af0: 2020 2020 2020 2020 6f62 735f 696e 7374          obs_inst
-00036b00: 203d 205b 5d0a 2020 2020 2020 2020 736e   = [].        sn
-00036b10: 7273 203d 205b 5d0a 2020 2020 2020 2020  rs = [].        
-00036b20: 2320 5765 206c 6f6f 7020 7468 726f 7567  # We loop throug
-00036b30: 6820 7468 6520 4f62 7349 4473 2061 7373  h the ObsIDs ass
-00036b40: 6f63 6961 7465 6420 7769 7468 2074 6869  ociated with thi
-00036b50: 7320 736f 7572 6365 2061 6e64 2074 6865  s source and the
-00036b60: 2069 6e73 7472 756d 656e 7473 2061 7373   instruments ass
-00036b70: 6f63 6961 7465 6420 7769 7468 2074 686f  ociated with tho
-00036b80: 7365 204f 6273 4944 730a 2020 2020 2020  se ObsIDs.      
-00036b90: 2020 666f 7220 6f62 735f 6964 2069 6e20    for obs_id in 
-00036ba0: 7365 6c66 2e69 6e73 7472 756d 656e 7473  self.instruments
-00036bb0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00036bc0: 7220 696e 7374 2069 6e20 7365 6c66 2e69  r inst in self.i
-00036bd0: 6e73 7472 756d 656e 7473 5b6f 6273 5f69  nstruments[obs_i
-00036be0: 645d 3a0a 2020 2020 2020 2020 2020 2020  d]:.            
-00036bf0: 2020 2020 2320 5573 6520 6f75 7220 6861      # Use our ha
-00036c00: 6e64 7920 6765 745f 736e 7220 6d65 7468  ndy get_snr meth
-00036c10: 6f64 2074 6f20 6361 6c63 756c 6174 6520  od to calculate 
-00036c20: 7468 6520 534e 5273 2077 6520 7761 6e74  the SNRs we want
-00036c30: 2c20 7468 656e 2061 6464 2074 6861 7420  , then add that 
-00036c40: 616e 6420 7468 650a 2020 2020 2020 2020  and the.        
-00036c50: 2020 2020 2020 2020 2320 204f 6273 4944          #  ObsID
-00036c60: 2d69 6e73 7420 636f 6d62 6f20 696e 746f  -inst combo into
-00036c70: 2074 6865 6972 2072 6573 7065 6374 6976   their respectiv
-00036c80: 6520 6c69 7374 730a 2020 2020 2020 2020  e lists.        
-00036c90: 2020 2020 2020 2020 736e 7273 2e61 7070          snrs.app
-00036ca0: 656e 6428 7365 6c66 2e67 6574 5f73 6e72  end(self.get_snr
-00036cb0: 286f 7574 6572 5f72 6164 6975 732c 2073  (outer_radius, s
-00036cc0: 656c 662e 6465 6661 756c 745f 636f 6f72  elf.default_coor
-00036cd0: 642c 206c 6f5f 656e 2c20 6869 5f65 6e2c  d, lo_en, hi_en,
-00036ce0: 206f 6273 5f69 642c 2069 6e73 742c 0a20   obs_id, inst,. 
-00036cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036d10: 2020 2020 2020 2020 616c 6c6f 775f 6e65          allow_ne
-00036d20: 6761 7469 7665 2929 0a20 2020 2020 2020  gative)).       
-00036d30: 2020 2020 2020 2020 206f 6273 5f69 6e73           obs_ins
-00036d40: 742e 6170 7065 6e64 285b 6f62 735f 6964  t.append([obs_id
-00036d50: 2c20 696e 7374 5d29 0a0a 2020 2020 2020  , inst])..      
-00036d60: 2020 2320 4d61 6b65 206f 7572 2073 746f    # Make our sto
-00036d70: 7261 6765 206c 6973 7473 2069 6e74 6f20  rage lists into 
-00036d80: 6172 7261 7973 2c20 6561 7369 6572 2074  arrays, easier t
-00036d90: 6f20 776f 726b 2077 6974 6820 7468 6174  o work with that
-00036da0: 2077 6179 0a20 2020 2020 2020 206f 6273   way.        obs
-00036db0: 5f69 6e73 7420 3d20 6e70 2e61 7272 6179  _inst = np.array
-00036dc0: 286f 6273 5f69 6e73 7429 0a20 2020 2020  (obs_inst).     
-00036dd0: 2020 2073 6e72 7320 3d20 6e70 2e61 7272     snrs = np.arr
-00036de0: 6179 2873 6e72 7329 0a0a 2020 2020 2020  ay(snrs)..      
-00036df0: 2020 2320 5765 2077 616e 7420 746f 206f    # We want to o
-00036e00: 7264 6572 2074 6865 206f 7574 7075 7420  rder the output 
-00036e10: 6279 2053 4e52 2c20 7769 7468 2074 6865  by SNR, with the
-00036e20: 206c 6f77 6573 7420 6265 696e 6720 6669   lowest being fi
-00036e30: 7273 7420 616e 6420 7468 6520 6869 6768  rst and the high
-00036e40: 6573 7420 6265 696e 6720 6c61 7374 2c20  est being last, 
-00036e50: 736f 2077 650a 2020 2020 2020 2020 2320  so we.        # 
-00036e60: 2075 7365 2061 206e 756d 7079 2066 756e   use a numpy fun
-00036e70: 6374 696f 6e20 746f 206f 7574 7075 7420  ction to output 
-00036e80: 7468 6520 696e 6465 7820 6f72 6465 7220  the index order 
-00036e90: 6e65 6564 6564 2074 6f20 7265 2d6f 7264  needed to re-ord
-00036ea0: 6572 206f 7572 2074 776f 2061 7272 6179  er our two array
-00036eb0: 730a 2020 2020 2020 2020 7265 6f72 6465  s.        reorde
-00036ec0: 725f 736e 7273 203d 206e 702e 6172 6773  r_snrs = np.args
-00036ed0: 6f72 7428 736e 7273 290a 2020 2020 2020  ort(snrs).      
-00036ee0: 2020 2320 5468 656e 2077 6520 7573 6520    # Then we use 
-00036ef0: 7468 6174 2074 6f20 7265 2d6f 7264 6572  that to re-order
-00036f00: 2074 6865 6d0a 2020 2020 2020 2020 736e   them.        sn
-00036f10: 7273 203d 2073 6e72 735b 7265 6f72 6465  rs = snrs[reorde
-00036f20: 725f 736e 7273 5d0a 2020 2020 2020 2020  r_snrs].        
-00036f30: 6f62 735f 696e 7374 203d 206f 6273 5f69  obs_inst = obs_i
-00036f40: 6e73 745b 7265 6f72 6465 725f 736e 7273  nst[reorder_snrs
-00036f50: 5d0a 0a20 2020 2020 2020 2023 2041 6e64  ]..        # And
-00036f60: 2072 6574 7572 6e20 6f75 7220 6f72 6465   return our orde
-00036f70: 7265 6420 6469 6374 696f 6e61 7269 6573  red dictionaries
-00036f80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00036f90: 6f62 735f 696e 7374 2c20 736e 7273 0a0a  obs_inst, snrs..
-00036fa0: 2020 2020 6465 6620 636f 756e 745f 7261      def count_ra
-00036fb0: 6e6b 696e 6728 7365 6c66 2c20 6f75 7465  nking(self, oute
-00036fc0: 725f 7261 6469 7573 3a20 556e 696f 6e5b  r_radius: Union[
-00036fd0: 5175 616e 7469 7479 2c20 7374 725d 2c20  Quantity, str], 
-00036fe0: 6c6f 5f65 6e3a 2051 7561 6e74 6974 7920  lo_en: Quantity 
-00036ff0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00037000: 2020 2020 2020 2020 2020 2020 2020 6869                hi
-00037010: 5f65 6e3a 2051 7561 6e74 6974 7920 3d20  _en: Quantity = 
-00037020: 4e6f 6e65 2920 2d3e 2054 7570 6c65 5b6e  None) -> Tuple[n
-00037030: 702e 6e64 6172 7261 792c 2051 7561 6e74  p.ndarray, Quant
-00037040: 6974 795d 3a0a 2020 2020 2020 2020 2222  ity]:.        ""
-00037050: 220a 2020 2020 2020 2020 5468 6973 206d  ".        This m
-00037060: 6574 686f 6420 6765 6e65 7261 7465 7320  ethod generates 
-00037070: 6120 6c69 7374 206f 6620 4f62 7349 442d  a list of ObsID-
-00037080: 496e 7374 7275 6d65 6e74 2070 6169 7273  Instrument pairs
-00037090: 2c20 6f72 6465 7265 6420 6279 2074 6865  , ordered by the
-000370a0: 2063 6f75 6e74 7320 6d65 6173 7572 6564   counts measured
-000370b0: 2066 6f72 2074 6865 0a20 2020 2020 2020   for the.       
-000370c0: 2067 6976 656e 2072 6567 696f 6e2c 2077   given region, w
-000370d0: 6974 6820 656c 656d 656e 7420 7a65 726f  ith element zero
-000370e0: 2062 6569 6e67 2074 6865 206c 6f77 6573   being the lowes
-000370f0: 7420 636f 756e 7473 2c20 616e 6420 656c  t counts, and el
-00037100: 656d 656e 7420 4e20 6265 696e 6720 7468  ement N being th
-00037110: 6520 6869 6768 6573 742e 0a0a 2020 2020  e highest...    
-00037120: 2020 2020 3a70 6172 616d 2051 7561 6e74      :param Quant
-00037130: 6974 792f 7374 7220 6f75 7465 725f 7261  ity/str outer_ra
-00037140: 6469 7573 3a20 5468 6520 7261 6469 7573  dius: The radius
-00037150: 2074 6861 7420 636f 756e 7473 2073 686f   that counts sho
-00037160: 756c 6420 6265 2063 616c 6375 6c61 7465  uld be calculate
-00037170: 6420 7769 7468 696e 2c20 7468 6973 2063  d within, this c
-00037180: 616e 2065 6974 6865 7220 6265 2061 0a20  an either be a. 
-00037190: 2020 2020 2020 2020 2020 206e 616d 6564             named
-000371a0: 2072 6164 6975 7320 7375 6368 2061 7320   radius such as 
-000371b0: 7235 3030 2c20 6f72 2061 6e20 6173 7472  r500, or an astr
-000371c0: 6f70 7920 5175 616e 7469 7479 2e0a 2020  opy Quantity..  
-000371d0: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
-000371e0: 6e74 6974 7920 6c6f 5f65 6e3a 2054 6865  ntity lo_en: The
-000371f0: 206c 6f77 6572 2065 6e65 7267 7920 626f   lower energy bo
-00037200: 756e 6420 6f66 2074 6865 2072 6174 656d  und of the ratem
-00037210: 6170 2074 6f20 7573 6520 746f 2063 616c  ap to use to cal
-00037220: 6375 6c61 7465 2074 6865 2063 6f75 6e74  culate the count
-00037230: 732e 2044 6566 6175 6c74 2069 7320 4e6f  s. Default is No
-00037240: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00037250: 696e 2077 6869 6368 2063 6173 6520 7468  in which case th
-00037260: 6520 6c6f 7765 7220 656e 6572 6779 2062  e lower energy b
-00037270: 6f75 6e64 2066 6f72 2070 6561 6b20 6669  ound for peak fi
-00037280: 6e64 696e 6720 7769 6c6c 2062 6520 7573  nding will be us
-00037290: 6564 2028 6465 6661 756c 7420 6973 2030  ed (default is 0
-000372a0: 2e35 6b65 5629 2e0a 2020 2020 2020 2020  .5keV)..        
-000372b0: 3a70 6172 616d 2051 7561 6e74 6974 7920  :param Quantity 
-000372c0: 6869 5f65 6e3a 2054 6865 2075 7070 6572  hi_en: The upper
-000372d0: 2065 6e65 7267 7920 626f 756e 6420 6f66   energy bound of
-000372e0: 2074 6865 2072 6174 656d 6170 2074 6f20   the ratemap to 
-000372f0: 7573 6520 746f 2063 616c 6375 6c61 7465  use to calculate
-00037300: 2074 6865 2063 6f75 6e74 732e 2044 6566   the counts. Def
-00037310: 6175 6c74 2069 7320 4e6f 6e65 2c0a 2020  ault is None,.  
-00037320: 2020 2020 2020 2020 2020 696e 2077 6869            in whi
-00037330: 6368 2063 6173 6520 7468 6520 7570 7065  ch case the uppe
-00037340: 7220 656e 6572 6779 2062 6f75 6e64 2066  r energy bound f
-00037350: 6f72 2070 6561 6b20 6669 6e64 696e 6720  or peak finding 
-00037360: 7769 6c6c 2062 6520 7573 6564 2028 6465  will be used (de
-00037370: 6661 756c 7420 6973 2032 2e30 6b65 5629  fault is 2.0keV)
-00037380: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-00037390: 6e3a 2054 776f 2061 7272 6179 732c 2074  n: Two arrays, t
-000373a0: 6865 2066 6972 7374 2061 6e20 4e20 6279  he first an N by
-000373b0: 2032 2061 7272 6179 2c20 7769 7468 2074   2 array, with t
-000373c0: 6865 204f 6273 4944 2c20 496e 7374 7275  he ObsID, Instru
-000373d0: 6d65 6e74 2063 6f6d 6269 6e61 7469 6f6e  ment combination
-000373e0: 7320 696e 206f 7264 6572 0a20 2020 2020  s in order.     
-000373f0: 2020 2020 2020 206f 6620 6173 6365 6e64         of ascend
-00037400: 696e 6720 636f 756e 7473 2c20 7468 656e  ing counts, then
-00037410: 2061 6e20 6172 7261 7920 636f 6e74 6169   an array contai
-00037420: 6e69 6e67 2074 6865 206f 7264 6572 2063  ning the order c
-00037430: 6f75 6e74 7320 7261 7469 6f73 2e0a 2020  ounts ratios..  
-00037440: 2020 2020 2020 3a72 7479 7065 3a20 5475        :rtype: Tu
-00037450: 706c 655b 6e70 2e6e 6461 7272 6179 2c20  ple[np.ndarray, 
-00037460: 5175 616e 7469 7479 5d0a 2020 2020 2020  Quantity].      
-00037470: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-00037480: 5365 7420 7570 2073 6f6d 6520 6c69 7374  Set up some list
-00037490: 7320 666f 7220 7468 6520 4f62 7349 442d  s for the ObsID-
-000374a0: 496e 7374 7275 6d65 6e74 2063 6f6d 626f  Instrument combo
-000374b0: 7320 616e 6420 7468 6569 7220 636e 7473  s and their cnts
-000374c0: 2072 6573 7065 6374 6976 656c 790a 2020   respectively.  
-000374d0: 2020 2020 2020 6f62 735f 696e 7374 203d        obs_inst =
-000374e0: 205b 5d0a 2020 2020 2020 2020 636e 7473   [].        cnts
-000374f0: 203d 205b 5d0a 2020 2020 2020 2020 2320   = [].        # 
-00037500: 5765 206c 6f6f 7020 7468 726f 7567 6820  We loop through 
-00037510: 7468 6520 4f62 7349 4473 2061 7373 6f63  the ObsIDs assoc
-00037520: 6961 7465 6420 7769 7468 2074 6869 7320  iated with this 
-00037530: 736f 7572 6365 2061 6e64 2074 6865 2069  source and the i
-00037540: 6e73 7472 756d 656e 7473 2061 7373 6f63  nstruments assoc
-00037550: 6961 7465 6420 7769 7468 2074 686f 7365  iated with those
-00037560: 204f 6273 4944 730a 2020 2020 2020 2020   ObsIDs.        
-00037570: 666f 7220 6f62 735f 6964 2069 6e20 7365  for obs_id in se
-00037580: 6c66 2e69 6e73 7472 756d 656e 7473 3a0a  lf.instruments:.
-00037590: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000375a0: 696e 7374 2069 6e20 7365 6c66 2e69 6e73  inst in self.ins
-000375b0: 7472 756d 656e 7473 5b6f 6273 5f69 645d  truments[obs_id]
-000375c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000375d0: 2020 636e 7473 2e61 7070 656e 6428 7365    cnts.append(se
-000375e0: 6c66 2e67 6574 5f63 6f75 6e74 7328 6f75  lf.get_counts(ou
-000375f0: 7465 725f 7261 6469 7573 2c20 7365 6c66  ter_radius, self
-00037600: 2e64 6566 6175 6c74 5f63 6f6f 7264 2c20  .default_coord, 
-00037610: 6c6f 5f65 6e2c 2068 695f 656e 2c20 6f62  lo_en, hi_en, ob
-00037620: 735f 6964 2c20 696e 7374 2929 0a20 2020  s_id, inst)).   
-00037630: 2020 2020 2020 2020 2020 2020 206f 6273               obs
-00037640: 5f69 6e73 742e 6170 7065 6e64 285b 6f62  _inst.append([ob
-00037650: 735f 6964 2c20 696e 7374 5d29 0a0a 2020  s_id, inst])..  
-00037660: 2020 2020 2020 2320 4d61 6b65 206f 7572        # Make our
-00037670: 2073 746f 7261 6765 206c 6973 7473 2069   storage lists i
-00037680: 6e74 6f20 6172 7261 7973 2c20 6561 7369  nto arrays, easi
-00037690: 6572 2074 6f20 776f 726b 2077 6974 6820  er to work with 
-000376a0: 7468 6174 2077 6179 0a20 2020 2020 2020  that way.       
-000376b0: 206f 6273 5f69 6e73 7420 3d20 6e70 2e61   obs_inst = np.a
-000376c0: 7272 6179 286f 6273 5f69 6e73 7429 0a20  rray(obs_inst). 
-000376d0: 2020 2020 2020 2063 6e74 7320 3d20 5175         cnts = Qu
-000376e0: 616e 7469 7479 2863 6e74 7329 0a0a 2020  antity(cnts)..  
-000376f0: 2020 2020 2020 2320 5765 2077 616e 7420        # We want 
-00037700: 746f 206f 7264 6572 2074 6865 206f 7574  to order the out
-00037710: 7075 7420 6279 2063 6f75 6e74 732c 2077  put by counts, w
-00037720: 6974 6820 7468 6520 6c6f 7765 7374 2062  ith the lowest b
-00037730: 6569 6e67 2066 6972 7374 2061 6e64 2074  eing first and t
-00037740: 6865 2068 6967 6865 7374 2062 6569 6e67  he highest being
-00037750: 206c 6173 742c 2073 6f20 7765 0a20 2020   last, so we.   
-00037760: 2020 2020 2023 2020 7573 6520 6120 6e75       #  use a nu
-00037770: 6d70 7920 6675 6e63 7469 6f6e 2074 6f20  mpy function to 
-00037780: 6f75 7470 7574 2074 6865 2069 6e64 6578  output the index
-00037790: 206f 7264 6572 206e 6565 6465 6420 746f   order needed to
-000377a0: 2072 652d 6f72 6465 7220 6f75 7220 7477   re-order our tw
-000377b0: 6f20 6172 7261 7973 0a20 2020 2020 2020  o arrays.       
-000377c0: 2072 656f 7264 6572 5f63 6e74 7320 3d20   reorder_cnts = 
-000377d0: 6e70 2e61 7267 736f 7274 2863 6e74 7329  np.argsort(cnts)
-000377e0: 0a20 2020 2020 2020 2023 2054 6865 6e20  .        # Then 
-000377f0: 7765 2075 7365 2074 6861 7420 746f 2072  we use that to r
-00037800: 652d 6f72 6465 7220 7468 656d 0a20 2020  e-order them.   
-00037810: 2020 2020 2063 6e74 7320 3d20 636e 7473       cnts = cnts
-00037820: 5b72 656f 7264 6572 5f63 6e74 735d 0a20  [reorder_cnts]. 
-00037830: 2020 2020 2020 206f 6273 5f69 6e73 7420         obs_inst 
-00037840: 3d20 6f62 735f 696e 7374 5b72 656f 7264  = obs_inst[reord
-00037850: 6572 5f63 6e74 735d 0a0a 2020 2020 2020  er_cnts]..      
-00037860: 2020 2320 416e 6420 7265 7475 726e 206f    # And return o
-00037870: 7572 206f 7264 6572 6564 2064 6963 7469  ur ordered dicti
-00037880: 6f6e 6172 6965 7327 0a20 2020 2020 2020  onaries'.       
-00037890: 2072 6574 7572 6e20 6f62 735f 696e 7374   return obs_inst
-000378a0: 2c20 636e 7473 0a0a 2020 2020 6465 6620  , cnts..    def 
-000378b0: 6f66 6673 6574 2873 656c 662c 206f 6666  offset(self, off
-000378c0: 5f75 6e69 743a 2055 6e69 6f6e 5b55 6e69  _unit: Union[Uni
-000378d0: 742c 2073 7472 5d20 3d20 2261 7263 6d69  t, str] = "arcmi
-000378e0: 6e22 2920 2d3e 2051 7561 6e74 6974 793a  n") -> Quantity:
-000378f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00037900: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
-00037910: 2063 616c 6375 6c61 7465 7320 7468 6520   calculates the 
-00037920: 7365 7061 7261 7469 6f6e 2062 6574 7765  separation betwe
-00037930: 656e 2074 6865 2075 7365 7220 7375 7070  en the user supp
-00037940: 6c69 6564 2072 615f 6465 6320 636f 6f72  lied ra_dec coor
-00037950: 6469 6e61 7465 732c 2061 6e64 2074 6865  dinates, and the
-00037960: 2070 6561 6b0a 2020 2020 2020 2020 636f   peak.        co
-00037970: 6f72 6469 6e61 7465 7320 696e 2074 6865  ordinates in the
-00037980: 2072 6571 7565 7374 6564 206f 6666 5f75   requested off_u
-00037990: 6e69 742e 2049 6620 7468 6572 6520 6973  nit. If there is
-000379a0: 206e 6f20 7065 616b 2061 7474 7269 6275   no peak attribu
-000379b0: 7465 2061 6e64 2065 7272 6f72 2077 696c  te and error wil
-000379c0: 6c20 6265 2074 6872 6f77 6e2c 2061 6e64  l be thrown, and
-000379d0: 2069 6620 6e6f 0a20 2020 2020 2020 2070   if no.        p
-000379e0: 6561 6b20 6861 7320 6265 656e 2063 616c  eak has been cal
-000379f0: 6375 6c61 7465 6420 7468 656e 2074 6865  culated then the
-00037a00: 2072 6573 756c 7420 7769 6c6c 2062 6520   result will be 
-00037a10: 302e 0a0a 2020 2020 2020 2020 3a70 6172  0...        :par
-00037a20: 616d 2055 6e69 742f 7374 7220 6f66 665f  am Unit/str off_
-00037a30: 756e 6974 3a20 5468 6520 756e 6974 2074  unit: The unit t
-00037a40: 6861 7420 7468 6520 6f66 6673 6574 2073  hat the offset s
-00037a50: 686f 756c 6420 6265 2069 6e2e 0a20 2020  hould be in..   
-00037a60: 2020 2020 203a 7265 7475 726e 3a20 5468       :return: Th
-00037a70: 6520 6f66 6673 6574 2062 6574 7765 656e  e offset between
-00037a80: 2072 615f 6465 6320 616e 6420 7065 616b   ra_dec and peak
-00037a90: 2c20 696e 2074 6865 2072 6571 7565 7374  , in the request
-00037aa0: 6564 2075 6e69 742e 0a20 2020 2020 2020  ed unit..       
-00037ab0: 203a 7274 7970 653a 2051 7561 6e74 6974   :rtype: Quantit
-00037ac0: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
-00037ad0: 2020 2020 2020 2320 4368 6563 6b20 7468        # Check th
-00037ae0: 6174 2074 6865 2073 6f75 7263 6520 6861  at the source ha
-00037af0: 7320 6120 7065 616b 2061 7474 7269 6275  s a peak attribu
-00037b00: 7465 2074 6f20 6665 7463 682c 206f 7468  te to fetch, oth
-00037b10: 6572 7769 7365 2074 6872 6f77 2065 7272  erwise throw err
-00037b20: 6f72 0a20 2020 2020 2020 2069 6620 6e6f  or.        if no
-00037b30: 7420 6861 7361 7474 7228 7365 6c66 2c20  t hasattr(self, 
-00037b40: 2770 6561 6b27 293a 0a20 2020 2020 2020  'peak'):.       
-00037b50: 2020 2020 2072 6169 7365 2041 7474 7269       raise Attri
-00037b60: 6275 7465 4572 726f 7228 2254 6869 7320  buteError("This 
-00037b70: 736f 7572 6365 2064 6f65 7320 6e6f 7420  source does not 
-00037b80: 6861 7665 2061 2070 6561 6b20 6174 7472  have a peak attr
-00037b90: 6962 7574 652c 2061 6e64 2073 6f20 616e  ibute, and so an
-00037ba0: 206f 6666 7365 7420 6361 6e6e 6f74 2062   offset cannot b
-00037bb0: 6520 6361 6c63 756c 6174 6564 2e22 290a  e calculated.").
-00037bc0: 0a20 2020 2020 2020 2023 2043 616c 6375  .        # Calcu
-00037bd0: 6c61 7465 2074 6865 2065 7563 6c69 6465  late the euclide
-00037be0: 616e 2064 6973 7461 6e63 6520 6265 7477  an distance betw
-00037bf0: 6565 6e20 7261 5f64 6563 2061 6e64 2070  een ra_dec and p
-00037c00: 6561 6b0a 2020 2020 2020 2020 7365 7020  eak.        sep 
-00037c10: 3d20 6e70 2e73 7172 7428 6162 7328 7365  = np.sqrt(abs(se
-00037c20: 6c66 2e72 615f 6465 635b 305d 202d 2073  lf.ra_dec[0] - s
-00037c30: 656c 662e 7065 616b 5b30 5d29 202a 2a20  elf.peak[0]) ** 
-00037c40: 3220 2b20 6162 7328 7365 6c66 2e72 615f  2 + abs(self.ra_
-00037c50: 6465 635b 315d 202d 2073 656c 662e 7065  dec[1] - self.pe
-00037c60: 616b 5b31 5d29 202a 2a20 3229 0a20 2020  ak[1]) ** 2).   
-00037c70: 2020 2020 2023 2043 6f6e 7665 7274 2074       # Convert t
-00037c80: 6865 2073 6570 6172 6174 696f 6e20 746f  he separation to
-00037c90: 2074 6865 2072 6571 7565 7374 6564 2075   the requested u
-00037ca0: 6e69 7420 2d20 7468 6973 2077 696c 6c20  nit - this will 
-00037cb0: 7468 726f 7720 616e 2065 7272 6f72 2069  throw an error i
-00037cc0: 6620 7468 6520 756e 6974 2069 7320 7374  f the unit is st
-00037cd0: 7570 6964 0a20 2020 2020 2020 2063 6f6e  upid.        con
-00037ce0: 765f 7365 7020 3d20 7365 6c66 2e63 6f6e  v_sep = self.con
-00037cf0: 7665 7274 5f72 6164 6975 7328 7365 702c  vert_radius(sep,
-00037d00: 206f 6666 5f75 6e69 7429 0a0a 2020 2020   off_unit)..    
-00037d10: 2020 2020 2320 5265 7475 726e 2074 6865      # Return the
-00037d20: 2063 6f6e 7665 7274 6564 2073 6570 6172   converted separ
-00037d30: 6174 696f 6e0a 2020 2020 2020 2020 7265  ation.        re
-00037d40: 7475 726e 2063 6f6e 765f 7365 700a 0a20  turn conv_sep.. 
-00037d50: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00037d60: 2064 6566 2070 6561 6b5f 6c6f 5f65 6e28   def peak_lo_en(
-00037d70: 7365 6c66 2920 2d3e 2051 7561 6e74 6974  self) -> Quantit
-00037d80: 793a 0a20 2020 2020 2020 2022 2222 0a20  y:.        """. 
-00037d90: 2020 2020 2020 2054 6869 7320 7072 6f70         This prop
-00037da0: 6572 7479 2072 6574 7572 6e73 2074 6865  erty returns the
-00037db0: 206c 6f77 6572 2065 6e65 7267 7920 626f   lower energy bo
-00037dc0: 756e 6420 6f66 2074 6865 2069 6d61 6765  und of the image
-00037dd0: 2075 7365 6420 666f 7220 7065 616b 2066   used for peak f
-00037de0: 696e 6469 6e67 2e0a 0a20 2020 2020 2020  inding...       
-00037df0: 203a 7265 7475 726e 3a20 4120 7175 616e   :return: A quan
-00037e00: 7469 7479 2063 6f6e 7461 696e 696e 6720  tity containing 
-00037e10: 7468 6520 6c6f 7765 7220 656e 6572 6779  the lower energy
-00037e20: 206c 696d 6974 2075 7365 6420 666f 7220   limit used for 
-00037e30: 7065 616b 2066 696e 6469 6e67 2e0a 2020  peak finding..  
-00037e40: 2020 2020 2020 3a72 7479 7065 3a20 5175        :rtype: Qu
-00037e50: 616e 7469 7479 0a20 2020 2020 2020 2022  antity.        "
-00037e60: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00037e70: 6e20 7365 6c66 2e5f 7065 616b 5f6c 6f5f  n self._peak_lo_
-00037e80: 656e 0a0a 2020 2020 4070 726f 7065 7274  en..    @propert
-00037e90: 790a 2020 2020 6465 6620 7065 616b 5f68  y.    def peak_h
-00037ea0: 695f 656e 2873 656c 6629 202d 3e20 5175  i_en(self) -> Qu
-00037eb0: 616e 7469 7479 3a0a 2020 2020 2020 2020  antity:.        
-00037ec0: 2222 220a 2020 2020 2020 2020 5468 6973  """.        This
-00037ed0: 2070 726f 7065 7274 7920 7265 7475 726e   property return
-00037ee0: 7320 7468 6520 7570 7065 7220 656e 6572  s the upper ener
-00037ef0: 6779 2062 6f75 6e64 206f 6620 7468 6520  gy bound of the 
-00037f00: 696d 6167 6520 7573 6564 2066 6f72 2070  image used for p
-00037f10: 6561 6b20 6669 6e64 696e 672e 0a0a 2020  eak finding...  
-00037f20: 2020 2020 2020 3a72 6574 7572 6e3a 2041        :return: A
-00037f30: 2071 7561 6e74 6974 7920 636f 6e74 6169   quantity contai
-00037f40: 6e69 6e67 2074 6865 2075 7070 6572 2065  ning the upper e
-00037f50: 6e65 7267 7920 6c69 6d69 7420 7573 6564  nergy limit used
-00037f60: 2066 6f72 2070 6561 6b20 6669 6e64 696e   for peak findin
-00037f70: 672e 0a20 2020 2020 2020 203a 7274 7970  g..        :rtyp
-00037f80: 653a 2051 7561 6e74 6974 790a 2020 2020  e: Quantity.    
-00037f90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00037fa0: 7265 7475 726e 2073 656c 662e 5f70 6561  return self._pea
-00037fb0: 6b5f 6869 5f65 6e0a 0a20 2020 2040 7072  k_hi_en..    @pr
-00037fc0: 6f70 6572 7479 0a20 2020 2064 6566 2075  operty.    def u
-00037fd0: 7365 5f70 6561 6b28 7365 6c66 2920 2d3e  se_peak(self) ->
-00037fe0: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
-00037ff0: 2222 0a20 2020 2020 2020 2054 6869 7320  "".        This 
-00038000: 7072 6f70 6572 7479 2073 686f 7773 2077  property shows w
-00038010: 6865 7468 6572 2061 2070 6172 7469 6375  hether a particu
-00038020: 6c61 7220 5847 4120 736f 7572 6365 206f  lar XGA source o
-00038030: 626a 6563 7420 6861 7320 6265 656e 2073  bject has been s
-00038040: 6574 7570 2074 6f20 7573 6520 7065 616b  etup to use peak
-00038050: 2063 6f6f 7264 696e 6174 6573 0a20 2020   coordinates.   
-00038060: 2020 2020 206f 7220 6e6f 742e 2054 6865       or not. The
-00038070: 2070 726f 7065 7274 7920 6973 2065 6974   property is eit
-00038080: 6865 7220 5472 7565 2c20 4661 6c73 652c  her True, False,
-00038090: 206f 7220 4e6f 6e65 2028 6966 2069 7473   or None (if its
-000380a0: 2061 2042 6173 6553 6f75 7263 6529 2e0a   a BaseSource)..
-000380b0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-000380c0: 3a20 4966 2074 6865 2073 6f75 7263 6520  : If the source 
-000380d0: 6973 2073 6574 2074 6f20 7573 6520 7065  is set to use pe
-000380e0: 616b 732c 2054 7275 652c 206f 7468 6572  aks, True, other
-000380f0: 7769 7365 2046 616c 7365 2e0a 2020 2020  wise False..    
-00038100: 2020 2020 3a72 7479 7065 3a20 626f 6f6c      :rtype: bool
-00038110: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00038120: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00038130: 2e5f 7573 655f 7065 616b 0a0a 2020 2020  ._use_peak..    
-00038140: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00038150: 6620 7375 7070 7265 7373 6564 5f77 6172  f suppressed_war
-00038160: 6e69 6e67 7328 7365 6c66 2920 2d3e 204c  nings(self) -> L
-00038170: 6973 745b 7374 725d 3a0a 2020 2020 2020  ist[str]:.      
-00038180: 2020 2222 220a 2020 2020 2020 2020 4120    """.        A 
-00038190: 7072 6f70 6572 7479 2067 6574 7465 7220  property getter 
-000381a0: 2877 6974 6820 6e6f 2073 6574 7465 7229  (with no setter)
-000381b0: 2066 6f72 2074 6865 2077 6172 6e69 6e67   for the warning
-000381c0: 7320 7468 6174 2068 6176 6520 6265 656e  s that have been
-000381d0: 2073 7570 7072 6573 7365 6420 6672 6f6d   suppressed from
-000381e0: 2064 6973 706c 6179 2074 6f20 7468 6520   display to the 
-000381f0: 7573 6572 2061 730a 2020 2020 2020 2020  user as.        
-00038200: 7468 6520 736f 7572 6365 2077 6173 2064  the source was d
-00038210: 6563 6c61 7265 6420 6173 2061 206d 656d  eclared as a mem
-00038220: 6265 7220 6f66 2061 2073 616d 706c 652e  ber of a sample.
-00038230: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-00038240: 6e3a 2054 6865 206c 6973 7420 6f66 2073  n: The list of s
-00038250: 7570 7072 6573 7365 6420 7761 726e 696e  uppressed warnin
-00038260: 6773 2066 6f72 2074 6869 7320 736f 7572  gs for this sour
-00038270: 6365 2e0a 2020 2020 2020 2020 3a72 7479  ce..        :rty
-00038280: 7065 3a20 4c69 7374 5b73 7472 5d0a 2020  pe: List[str].  
-00038290: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000382a0: 2020 6966 206e 6f74 2073 656c 662e 5f73    if not self._s
-000382b0: 616d 705f 6d65 6d62 6572 3a0a 2020 2020  amp_member:.    
-000382c0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-000382d0: 7453 616d 706c 654d 656d 6265 7245 7272  tSampleMemberErr
-000382e0: 6f72 2822 5468 6520 736f 7572 6365 2066  or("The source f
-000382f0: 6f72 207b 6e7d 2069 7320 6e6f 7420 6120  or {n} is not a 
-00038300: 6d65 6d62 6572 206f 6620 6120 7361 6d70  member of a samp
-00038310: 6c65 2c20 616e 6420 6173 2073 7563 6820  le, and as such 
-00038320: 7761 726e 696e 6773 2068 6176 6520 220a  warnings have ".
-00038330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038350: 2020 2020 2020 2022 6e6f 7420 6265 656e         "not been
-00038360: 2073 7570 7072 6573 7365 642e 222e 666f   suppressed.".fo
-00038370: 726d 6174 286e 3d73 656c 662e 6e61 6d65  rmat(n=self.name
-00038380: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-00038390: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000383a0: 7572 6e20 7365 6c66 2e5f 7375 7070 5f77  urn self._supp_w
-000383b0: 6172 6e0a 0a20 2020 2064 6566 2069 6e66  arn..    def inf
-000383c0: 6f28 7365 6c66 293a 0a20 2020 2020 2020  o(self):.       
-000383d0: 2022 2222 0a20 2020 2020 2020 2056 6572   """.        Ver
-000383e0: 7920 7369 6d70 6c65 2066 756e 6374 696f  y simple functio
-000383f0: 6e20 7468 6174 206a 7573 7420 7072 696e  n that just prin
-00038400: 7473 2061 2073 756d 6d61 7279 206f 6620  ts a summary of 
-00038410: 696d 706f 7274 616e 7420 696e 666f 726d  important inform
-00038420: 6174 696f 6e20 7265 6c61 7465 6420 746f  ation related to
-00038430: 2074 6865 2073 6f75 7263 6520 6f62 6a65   the source obje
-00038440: 6374 2e2e 0a20 2020 2020 2020 2022 2222  ct...        """
-00038450: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00038460: 5c6e 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  \n--------------
-00038470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00038480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00038490: 2d2d 2d2d 2d2d 2d22 290a 2020 2020 2020  -------").      
-000384a0: 2020 7072 696e 7428 2253 6f75 7263 6520    print("Source 
-000384b0: 4e61 6d65 202d 207b 7d22 2e66 6f72 6d61  Name - {}".forma
-000384c0: 7428 7365 6c66 2e5f 6e61 6d65 2929 0a20  t(self._name)). 
-000384d0: 2020 2020 2020 2070 7269 6e74 2822 5573         print("Us
-000384e0: 6572 2043 6f6f 7264 696e 6174 6573 202d  er Coordinates -
-000384f0: 2028 7b30 7d2c 207b 317d 2920 6465 6772   ({0}, {1}) degr
-00038500: 6565 7322 2e66 6f72 6d61 7428 2a73 656c  ees".format(*sel
-00038510: 662e 5f72 615f 6465 6329 290a 2020 2020  f._ra_dec)).    
-00038520: 2020 2020 6966 2073 656c 662e 5f75 7365      if self._use
-00038530: 5f70 6561 6b20 6973 206e 6f74 204e 6f6e  _peak is not Non
-00038540: 6520 616e 6420 7365 6c66 2e5f 7573 655f  e and self._use_
-00038550: 7065 616b 3a0a 2020 2020 2020 2020 2020  peak:.          
-00038560: 2020 7072 696e 7428 2258 2d72 6179 2050    print("X-ray P
-00038570: 6561 6b20 2d20 287b 307d 2c20 7b31 7d29  eak - ({0}, {1})
-00038580: 2064 6567 7265 6573 222e 666f 726d 6174   degrees".format
-00038590: 282a 7365 6c66 2e5f 7065 616b 735b 2263  (*self._peaks["c
-000385a0: 6f6d 6269 6e65 6422 5d2e 7661 6c75 6529  ombined"].value)
-000385b0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-000385c0: 226e 4820 2d20 7b7d 222e 666f 726d 6174  "nH - {}".format
-000385d0: 2873 656c 662e 6e48 2929 0a20 2020 2020  (self.nH)).     
-000385e0: 2020 2069 6620 7365 6c66 2e5f 7265 6473     if self._reds
-000385f0: 6869 6674 2069 7320 6e6f 7420 4e6f 6e65  hift is not None
-00038600: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00038610: 696e 7428 2252 6564 7368 6966 7420 2d20  int("Redshift - 
-00038620: 7b7d 222e 666f 726d 6174 2872 6f75 6e64  {}".format(round
-00038630: 2873 656c 662e 5f72 6564 7368 6966 742c  (self._redshift,
-00038640: 2033 2929 290a 2020 2020 2020 2020 7072   3))).        pr
-00038650: 696e 7428 2258 4d4d 204f 6273 4944 7320  int("XMM ObsIDs 
-00038660: 2d20 7b7d 222e 666f 726d 6174 2873 656c  - {}".format(sel
-00038670: 662e 5f5f 6c65 6e5f 5f28 2929 290a 2020  f.__len__())).  
-00038680: 2020 2020 2020 7072 696e 7428 2250 4e20        print("PN 
-00038690: 4f62 7365 7276 6174 696f 6e73 202d 207b  Observations - {
-000386a0: 7d22 2e66 6f72 6d61 7428 7365 6c66 2e6e  }".format(self.n
-000386b0: 756d 5f70 6e5f 6f62 7329 290a 2020 2020  um_pn_obs)).    
-000386c0: 2020 2020 7072 696e 7428 224d 4f53 3120      print("MOS1 
-000386d0: 4f62 7365 7276 6174 696f 6e73 202d 207b  Observations - {
-000386e0: 7d22 2e66 6f72 6d61 7428 7365 6c66 2e6e  }".format(self.n
-000386f0: 756d 5f6d 6f73 315f 6f62 7329 290a 2020  um_mos1_obs)).  
-00038700: 2020 2020 2020 7072 696e 7428 224d 4f53        print("MOS
-00038710: 3220 4f62 7365 7276 6174 696f 6e73 202d  2 Observations -
-00038720: 207b 7d22 2e66 6f72 6d61 7428 7365 6c66   {}".format(self
-00038730: 2e6e 756d 5f6d 6f73 325f 6f62 7329 290a  .num_mos2_obs)).
-00038740: 2020 2020 2020 2020 7072 696e 7428 224f          print("O
-00038750: 6e2d 4178 6973 202d 207b 7d22 2e66 6f72  n-Axis - {}".for
-00038760: 6d61 7428 6c65 6e28 7365 6c66 2e5f 6f6e  mat(len(self._on
-00038770: 6178 6973 2929 290a 2020 2020 2020 2020  axis))).        
-00038780: 7072 696e 7428 2257 6974 6820 7265 6769  print("With regi
-00038790: 6f6e 7320 2d20 7b7d 222e 666f 726d 6174  ons - {}".format
-000387a0: 286c 656e 2873 656c 662e 5f69 6e69 7469  (len(self._initi
-000387b0: 616c 5f72 6567 696f 6e73 2929 290a 2020  al_regions))).  
-000387c0: 2020 2020 2020 7072 696e 7428 2254 6f74        print("Tot
-000387d0: 616c 2072 6567 696f 6e73 202d 207b 7d22  al regions - {}"
-000387e0: 2e66 6f72 6d61 7428 7375 6d28 5b6c 656e  .format(sum([len
-000387f0: 2873 656c 662e 5f69 6e69 7469 616c 5f72  (self._initial_r
-00038800: 6567 696f 6e73 5b6f 5d29 2066 6f72 206f  egions[o]) for o
-00038810: 2069 6e20 7365 6c66 2e5f 696e 6974 6961   in self._initia
-00038820: 6c5f 7265 6769 6f6e 735d 2929 290a 2020  l_regions]))).  
-00038830: 2020 2020 2020 7072 696e 7428 224f 6273        print("Obs
-00038840: 2077 6974 6820 3120 6465 7465 6374 696f   with 1 detectio
-00038850: 6e20 2d20 7b7d 222e 666f 726d 6174 2873  n - {}".format(s
-00038860: 756d 285b 3120 666f 7220 6f20 696e 2073  um([1 for o in s
-00038870: 656c 662e 5f69 6e69 7469 616c 5f72 6567  elf._initial_reg
-00038880: 696f 6e5f 6d61 7463 6865 7320 6966 0a20  ion_matches if. 
-00038890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000388a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000388b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000388c0: 2020 2073 656c 662e 5f69 6e69 7469 616c     self._initial
-000388d0: 5f72 6567 696f 6e5f 6d61 7463 6865 735b  _region_matches[
-000388e0: 6f5d 2e73 756d 2829 203d 3d20 315d 2929  o].sum() == 1]))
-000388f0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00038900: 224f 6273 2077 6974 6820 3e31 206d 6174  "Obs with >1 mat
-00038910: 6368 6573 202d 207b 7d22 2e66 6f72 6d61  ches - {}".forma
-00038920: 7428 7375 6d28 5b31 2066 6f72 206f 2069  t(sum([1 for o i
-00038930: 6e20 7365 6c66 2e5f 696e 6974 6961 6c5f  n self._initial_
-00038940: 7265 6769 6f6e 5f6d 6174 6368 6573 2069  region_matches i
-00038950: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-00038960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038980: 2020 2020 2020 2073 656c 662e 5f69 6e69         self._ini
-00038990: 7469 616c 5f72 6567 696f 6e5f 6d61 7463  tial_region_matc
-000389a0: 6865 735b 6f5d 2e73 756d 2829 203e 2031  hes[o].sum() > 1
-000389b0: 5d29 2929 0a20 2020 2020 2020 2023 2049  ]))).        # I
-000389c0: 6620 6120 636f 6d62 696e 6564 2065 7870  f a combined exp
-000389d0: 6f73 7572 6520 6d61 7020 6578 6973 7473  osure map exists
-000389e0: 2c20 7765 276c 6c20 7573 6520 6974 2074  , we'll use it t
-000389f0: 6f20 6769 7665 2074 6865 2075 7365 7220  o give the user 
-00038a00: 616e 2069 6465 6120 6f66 2074 6865 2074  an idea of the t
-00038a10: 6f74 616c 2065 7870 6f73 7572 650a 2020  otal exposure.  
-00038a20: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00038a30: 2020 2020 2020 2065 7820 3d20 7365 6c66         ex = self
-00038a40: 2e67 6574 5f63 6f6d 6269 6e65 645f 6578  .get_combined_ex
-00038a50: 706d 6170 7328 290a 2020 2020 2020 2020  pmaps().        
-00038a60: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00038a70: 6528 6578 2c20 6c69 7374 293a 0a20 2020  e(ex, list):.   
-00038a80: 2020 2020 2020 2020 2020 2020 2065 7820               ex 
-00038a90: 3d20 6578 5b30 5d0a 2020 2020 2020 2020  = ex[0].        
-00038aa0: 2020 2020 7072 696e 7428 2254 6f74 616c      print("Total
-00038ab0: 2065 7870 6f73 7572 6520 2d20 7b7d 222e   exposure - {}".
-00038ac0: 666f 726d 6174 2865 782e 6765 745f 6578  format(ex.get_ex
-00038ad0: 7028 7365 6c66 2e72 615f 6465 6329 2e74  p(self.ra_dec).t
-00038ae0: 6f28 276b 7327 292e 726f 756e 6428 3229  o('ks').round(2)
-00038af0: 2929 0a20 2020 2020 2020 2065 7863 6570  )).        excep
-00038b00: 7420 4e6f 5072 6f64 7563 7441 7661 696c  t NoProductAvail
-00038b10: 6162 6c65 4572 726f 723a 0a20 2020 2020  ableError:.     
-00038b20: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00038b30: 2020 2020 7072 696e 7428 2249 6d61 6765      print("Image
-00038b40: 7320 6173 736f 6369 6174 6564 202d 207b  s associated - {
-00038b50: 7d22 2e66 6f72 6d61 7428 6c65 6e28 7365  }".format(len(se
-00038b60: 6c66 2e67 6574 5f70 726f 6475 6374 7328  lf.get_products(
-00038b70: 2269 6d61 6765 2229 2929 290a 2020 2020  "image")))).    
-00038b80: 2020 2020 7072 696e 7428 2245 7870 6f73      print("Expos
-00038b90: 7572 6520 6d61 7073 2061 7373 6f63 6961  ure maps associa
-00038ba0: 7465 6420 2d20 7b7d 222e 666f 726d 6174  ted - {}".format
-00038bb0: 286c 656e 2873 656c 662e 6765 745f 7072  (len(self.get_pr
-00038bc0: 6f64 7563 7473 2822 6578 706d 6170 2229  oducts("expmap")
-00038bd0: 2929 290a 2020 2020 2020 2020 7072 696e  ))).        prin
-00038be0: 7428 2243 6f6d 6269 6e65 6420 5261 7465  t("Combined Rate
-00038bf0: 6d61 7073 2061 7373 6f63 6961 7465 6420  maps associated 
-00038c00: 2d20 7b7d 222e 666f 726d 6174 286c 656e  - {}".format(len
-00038c10: 2873 656c 662e 6765 745f 7072 6f64 7563  (self.get_produc
-00038c20: 7473 2822 636f 6d62 696e 6564 5f72 6174  ts("combined_rat
-00038c30: 656d 6170 2229 2929 290a 2020 2020 2020  emap")))).      
-00038c40: 2020 7072 696e 7428 2253 7065 6374 7261    print("Spectra
-00038c50: 2061 7373 6f63 6961 7465 6420 2d20 7b7d   associated - {}
-00038c60: 222e 666f 726d 6174 286c 656e 2873 656c  ".format(len(sel
-00038c70: 662e 6765 745f 7072 6f64 7563 7473 2822  f.get_products("
-00038c80: 7370 6563 7472 756d 2229 2929 290a 0a20  spectrum")))).. 
-00038c90: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-00038ca0: 6c66 2e5f 6669 745f 7265 7375 6c74 7329  lf._fit_results)
-00038cb0: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
-00038cc0: 2020 2070 7269 6e74 2822 4669 7474 6564     print("Fitted
-00038cd0: 204d 6f64 656c 7320 2d20 7b7d 222e 666f   Models - {}".fo
-00038ce0: 726d 6174 2822 207c 2022 2e6a 6f69 6e28  rmat(" | ".join(
-00038cf0: 7365 6c66 2e66 6974 7465 645f 6d6f 6465  self.fitted_mode
-00038d00: 6c73 2929 290a 0a20 2020 2020 2020 2069  ls)))..        i
-00038d10: 6620 7365 6c66 2e5f 7265 6769 6f6e 7320  f self._regions 
-00038d20: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00038d30: 2263 7573 746f 6d22 2069 6e20 7365 6c66  "custom" in self
-00038d40: 2e5f 7261 6469 693a 0a20 2020 2020 2020  ._radii:.       
-00038d50: 2020 2020 2069 6620 7365 6c66 2e5f 7265       if self._re
-00038d60: 6473 6869 6674 2069 7320 6e6f 7420 4e6f  dshift is not No
-00038d70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00038d80: 2020 2020 7265 6769 6f6e 5f72 6164 6975      region_radiu
-00038d90: 7320 3d20 616e 675f 746f 5f72 6164 2873  s = ang_to_rad(s
-00038da0: 656c 662e 5f63 7573 746f 6d5f 7265 6769  elf._custom_regi
-00038db0: 6f6e 5f72 6164 6975 732c 2073 656c 662e  on_radius, self.
-00038dc0: 5f72 6564 7368 6966 742c 2063 6f73 6d6f  _redshift, cosmo
-00038dd0: 3d73 656c 662e 5f63 6f73 6d6f 290a 2020  =self._cosmo).  
-00038de0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00038df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038e00: 7265 6769 6f6e 5f72 6164 6975 7320 3d20  region_radius = 
-00038e10: 7365 6c66 2e5f 6375 7374 6f6d 5f72 6567  self._custom_reg
-00038e20: 696f 6e5f 7261 6469 7573 2e74 6f28 2264  ion_radius.to("d
-00038e30: 6567 2229 0a20 2020 2020 2020 2020 2020  eg").           
-00038e40: 2070 7269 6e74 2822 4375 7374 6f6d 2052   print("Custom R
-00038e50: 6567 696f 6e20 5261 6469 7573 202d 207b  egion Radius - {
-00038e60: 7d22 2e66 6f72 6d61 7428 7265 6769 6f6e  }".format(region
-00038e70: 5f72 6164 6975 732e 726f 756e 6428 3229  _radius.round(2)
-00038e80: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
-00038e90: 6620 6c65 6e28 7365 6c66 2e67 6574 5f70  f len(self.get_p
-00038ea0: 726f 6475 6374 7328 2763 6f6d 6269 6e65  roducts('combine
-00038eb0: 645f 696d 6167 6527 2929 2021 3d20 303a  d_image')) != 0:
-00038ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038ed0: 2070 7269 6e74 2822 4375 7374 6f6d 2052   print("Custom R
-00038ee0: 6567 696f 6e20 534e 5220 2d20 7b7d 222e  egion SNR - {}".
-00038ef0: 666f 726d 6174 2873 656c 662e 6765 745f  format(self.get_
-00038f00: 736e 7228 2263 7573 746f 6d22 2c20 7365  snr("custom", se
-00038f10: 6c66 2e5f 6465 6661 756c 745f 636f 6f72  lf._default_coor
-00038f20: 6429 2e72 6f75 6e64 2832 2929 290a 0a20  d).round(2))).. 
-00038f30: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00038f40: 7232 3030 2069 7320 6e6f 7420 4e6f 6e65  r200 is not None
-00038f50: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00038f60: 696e 7428 2252 3230 3020 2d20 7b7d 222e  int("R200 - {}".
-00038f70: 666f 726d 6174 2873 656c 662e 5f72 3230  format(self._r20
-00038f80: 302e 726f 756e 6428 3229 2929 0a20 2020  0.round(2))).   
-00038f90: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00038fa0: 7365 6c66 2e67 6574 5f70 726f 6475 6374  self.get_product
-00038fb0: 7328 2763 6f6d 6269 6e65 645f 696d 6167  s('combined_imag
-00038fc0: 6527 2929 2021 3d20 303a 0a20 2020 2020  e')) != 0:.     
-00038fd0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00038fe0: 2822 5232 3030 2053 4e52 202d 207b 7d22  ("R200 SNR - {}"
-00038ff0: 2e66 6f72 6d61 7428 7365 6c66 2e67 6574  .format(self.get
-00039000: 5f73 6e72 2822 7232 3030 222c 2073 656c  _snr("r200", sel
-00039010: 662e 5f64 6566 6175 6c74 5f63 6f6f 7264  f._default_coord
-00039020: 292e 726f 756e 6428 3229 2929 0a20 2020  ).round(2))).   
-00039030: 2020 2020 2069 6620 7365 6c66 2e5f 7235       if self._r5
-00039040: 3030 2069 7320 6e6f 7420 4e6f 6e65 3a0a  00 is not None:.
-00039050: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00039060: 7428 2252 3530 3020 2d20 7b7d 222e 666f  t("R500 - {}".fo
-00039070: 726d 6174 2873 656c 662e 5f72 3530 302e  rmat(self._r500.
-00039080: 726f 756e 6428 3229 2929 0a20 2020 2020  round(2))).     
-00039090: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-000390a0: 6c66 2e67 6574 5f70 726f 6475 6374 7328  lf.get_products(
-000390b0: 2763 6f6d 6269 6e65 645f 696d 6167 6527  'combined_image'
-000390c0: 2929 2021 3d20 303a 0a20 2020 2020 2020  )) != 0:.       
-000390d0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-000390e0: 5235 3030 2053 4e52 202d 207b 7d22 2e66  R500 SNR - {}".f
-000390f0: 6f72 6d61 7428 7365 6c66 2e67 6574 5f73  ormat(self.get_s
-00039100: 6e72 2822 7235 3030 222c 2073 656c 662e  nr("r500", self.
-00039110: 5f64 6566 6175 6c74 5f63 6f6f 7264 292e  _default_coord).
-00039120: 726f 756e 6428 3229 2929 0a20 2020 2020  round(2))).     
-00039130: 2020 2069 6620 7365 6c66 2e5f 7232 3530     if self._r250
-00039140: 3020 6973 206e 6f74 204e 6f6e 653a 0a20  0 is not None:. 
-00039150: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00039160: 2822 5232 3530 3020 2d20 7b7d 222e 666f  ("R2500 - {}".fo
-00039170: 726d 6174 2873 656c 662e 5f72 3235 3030  rmat(self._r2500
-00039180: 2e72 6f75 6e64 2832 2929 290a 2020 2020  .round(2))).    
-00039190: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-000391a0: 656c 662e 6765 745f 7072 6f64 7563 7473  elf.get_products
-000391b0: 2827 636f 6d62 696e 6564 5f69 6d61 6765  ('combined_image
-000391c0: 2729 2920 213d 2030 3a0a 2020 2020 2020  ')) != 0:.      
-000391d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000391e0: 2252 3235 3030 2053 4e52 202d 207b 7d22  "R2500 SNR - {}"
-000391f0: 2e66 6f72 6d61 7428 7365 6c66 2e67 6574  .format(self.get
-00039200: 5f73 6e72 2822 7232 3530 3022 2c20 7365  _snr("r2500", se
-00039210: 6c66 2e5f 6465 6661 756c 745f 636f 6f72  lf._default_coor
-00039220: 6429 2e72 6f75 6e64 2832 2929 290a 0a20  d).round(2))).. 
-00039230: 2020 2020 2020 2023 2054 6865 7265 2773         # There's
-00039240: 2070 726f 6261 626c 7920 6120 6e65 6174   probably a neat
-00039250: 6572 2077 6179 206f 6620 646f 696e 6720  er way of doing 
-00039260: 7468 6520 6f62 7365 7276 6162 6c65 7320  the observables 
-00039270: 2d20 6d61 7962 6520 6120 666f 726d 6174  - maybe a format
-00039280: 7469 6e67 2066 756e 6374 696f 6e3f 0a20  ting function?. 
-00039290: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-000392a0: 7269 6368 6e65 7373 2069 7320 6e6f 7420  richness is not 
-000392b0: 4e6f 6e65 2061 6e64 2073 656c 662e 5f72  None and self._r
-000392c0: 6963 686e 6573 735f 6572 7220 6973 206e  ichness_err is n
-000392d0: 6f74 204e 6f6e 6520 5c0a 2020 2020 2020  ot None \.      
-000392e0: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
-000392f0: 7420 6973 696e 7374 616e 6365 2873 656c  t isinstance(sel
-00039300: 662e 5f72 6963 686e 6573 735f 6572 722c  f._richness_err,
-00039310: 2028 6c69 7374 2c20 7475 706c 652c 206e   (list, tuple, n
-00039320: 6461 7272 6179 2929 3a0a 2020 2020 2020  darray)):.      
-00039330: 2020 2020 2020 7072 696e 7428 2252 6963        print("Ric
-00039340: 686e 6573 7320 2d20 7b30 7dc2 b17b 317d  hness - {0}..{1}
-00039350: 222e 666f 726d 6174 2873 656c 662e 5f72  ".format(self._r
-00039360: 6963 686e 6573 732e 726f 756e 6428 3229  ichness.round(2)
-00039370: 2c20 7365 6c66 2e5f 7269 6368 6e65 7373  , self._richness
-00039380: 5f65 7272 2e72 6f75 6e64 2832 2929 290a  _err.round(2))).
-00039390: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-000393a0: 662e 5f72 6963 686e 6573 7320 6973 206e  f._richness is n
-000393b0: 6f74 204e 6f6e 6520 616e 6420 7365 6c66  ot None and self
-000393c0: 2e5f 7269 6368 6e65 7373 5f65 7272 2069  ._richness_err i
-000393d0: 7320 6e6f 7420 4e6f 6e65 205c 0a20 2020  s not None \.   
-000393e0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-000393f0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00039400: 2e5f 7269 6368 6e65 7373 5f65 7272 2c20  ._richness_err, 
-00039410: 286c 6973 742c 2074 7570 6c65 2c20 6e64  (list, tuple, nd
-00039420: 6172 7261 7929 293a 0a20 2020 2020 2020  array)):.       
-00039430: 2020 2020 2070 7269 6e74 2822 5269 6368       print("Rich
-00039440: 6e65 7373 202d 207b 307d 202d 7b31 7d2b  ness - {0} -{1}+
-00039450: 7b32 7d22 2e66 6f72 6d61 7428 7365 6c66  {2}".format(self
-00039460: 2e5f 7269 6368 6e65 7373 2e72 6f75 6e64  ._richness.round
-00039470: 2832 292c 2073 656c 662e 5f72 6963 686e  (2), self._richn
-00039480: 6573 735f 6572 725b 305d 2e72 6f75 6e64  ess_err[0].round
-00039490: 2832 292c 0a20 2020 2020 2020 2020 2020  (2),.           
-000394a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000394b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000394c0: 2020 2020 2020 2020 7365 6c66 2e5f 7269          self._ri
-000394d0: 6368 6e65 7373 5f65 7272 5b31 5d2e 726f  chness_err[1].ro
-000394e0: 756e 6428 3229 2929 0a20 2020 2020 2020  und(2))).       
-000394f0: 2065 6c69 6620 7365 6c66 2e5f 7269 6368   elif self._rich
-00039500: 6e65 7373 2069 7320 6e6f 7420 4e6f 6e65  ness is not None
-00039510: 2061 6e64 2073 656c 662e 5f72 6963 686e   and self._richn
-00039520: 6573 735f 6572 7220 6973 204e 6f6e 653a  ess_err is None:
-00039530: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00039540: 6e74 2822 5269 6368 6e65 7373 202d 207b  nt("Richness - {
-00039550: 307d 222e 666f 726d 6174 2873 656c 662e  0}".format(self.
-00039560: 5f72 6963 686e 6573 732e 726f 756e 6428  _richness.round(
-00039570: 3229 2929 0a0a 2020 2020 2020 2020 6966  2)))..        if
-00039580: 2073 656c 662e 5f77 6c5f 6d61 7373 2069   self._wl_mass i
-00039590: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
-000395a0: 656c 662e 5f77 6c5f 6d61 7373 5f65 7272  elf._wl_mass_err
-000395b0: 2069 7320 6e6f 7420 4e6f 6e65 205c 0a20   is not None \. 
-000395c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000395d0: 6e64 206e 6f74 2069 7369 6e73 7461 6e63  nd not isinstanc
-000395e0: 6528 7365 6c66 2e5f 776c 5f6d 6173 735f  e(self._wl_mass_
-000395f0: 6572 722c 2028 6c69 7374 2c20 7475 706c  err, (list, tupl
-00039600: 652c 206e 6461 7272 6179 2929 3a0a 2020  e, ndarray)):.  
-00039610: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00039620: 2257 6561 6b20 4c65 6e73 696e 6720 4d61  "Weak Lensing Ma
-00039630: 7373 202d 207b 307d c2b1 7b31 7d22 2e66  ss - {0}..{1}".f
-00039640: 6f72 6d61 7428 7365 6c66 2e5f 776c 5f6d  ormat(self._wl_m
-00039650: 6173 732c 2073 656c 662e 5f72 6963 686e  ass, self._richn
-00039660: 6573 735f 6572 7229 290a 2020 2020 2020  ess_err)).      
-00039670: 2020 656c 6966 2073 656c 662e 5f77 6c5f    elif self._wl_
-00039680: 6d61 7373 2069 7320 6e6f 7420 4e6f 6e65  mass is not None
-00039690: 2061 6e64 2073 656c 662e 5f77 6c5f 6d61   and self._wl_ma
-000396a0: 7373 5f65 7272 2069 7320 6e6f 7420 4e6f  ss_err is not No
-000396b0: 6e65 205c 0a20 2020 2020 2020 2020 2020  ne \.           
-000396c0: 2020 2020 2061 6e64 2069 7369 6e73 7461       and isinsta
-000396d0: 6e63 6528 7365 6c66 2e5f 776c 5f6d 6173  nce(self._wl_mas
-000396e0: 735f 6572 722c 2028 6c69 7374 2c20 7475  s_err, (list, tu
-000396f0: 706c 652c 206e 6461 7272 6179 2929 3a0a  ple, ndarray)):.
-00039700: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00039710: 7428 2257 6561 6b20 4c65 6e73 696e 6720  t("Weak Lensing 
-00039720: 4d61 7373 202d 207b 307d 202d 7b31 7d2b  Mass - {0} -{1}+
-00039730: 7b32 7d22 2e66 6f72 6d61 7428 7365 6c66  {2}".format(self
-00039740: 2e5f 776c 5f6d 6173 732c 2073 656c 662e  ._wl_mass, self.
-00039750: 5f77 6c5f 6d61 7373 5f65 7272 5b30 5d2c  _wl_mass_err[0],
-00039760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039790: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000397a0: 662e 5f77 6c5f 6d61 7373 5f65 7272 5b31  f._wl_mass_err[1
-000397b0: 5d29 290a 2020 2020 2020 2020 656c 6966  ])).        elif
-000397c0: 2073 656c 662e 5f77 6c5f 6d61 7373 2069   self._wl_mass i
-000397d0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
-000397e0: 656c 662e 5f77 6c5f 6d61 7373 5f65 7272  elf._wl_mass_err
-000397f0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00039800: 2020 2020 2020 7072 696e 7428 2257 6561        print("Wea
-00039810: 6b20 4c65 6e73 696e 6720 4d61 7373 202d  k Lensing Mass -
-00039820: 207b 307d 222e 666f 726d 6174 2873 656c   {0}".format(sel
-00039830: 662e 5f77 6c5f 6d61 7373 2929 0a0a 2020  f._wl_mass))..  
-00039840: 2020 2020 2020 6966 2027 6765 745f 7465        if 'get_te
-00039850: 6d70 6572 6174 7572 6527 2069 6e20 6469  mperature' in di
-00039860: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
-00039870: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00039880: 2020 2020 2020 2020 2020 7478 203d 2073            tx = s
-00039890: 656c 662e 6765 745f 7465 6d70 6572 6174  elf.get_temperat
-000398a0: 7572 6528 2772 3530 3027 2c20 2763 6f6e  ure('r500', 'con
-000398b0: 7374 616e 742a 7462 6162 732a 6170 6563  stant*tbabs*apec
-000398c0: 2729 2e76 616c 7565 2e72 6f75 6e64 2832  ').value.round(2
-000398d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000398e0: 2020 2320 4a75 7374 2061 7665 7261 6765    # Just average
-000398f0: 2074 6865 2075 6e63 6572 7461 696e 7479   the uncertainty
-00039900: 2066 6f72 2074 6869 730a 2020 2020 2020   for this.      
-00039910: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00039920: 2252 3530 3020 5478 202d 207b 307d c2b1  "R500 Tx - {0}..
-00039930: 7b31 7d5b 6b65 565d 222e 666f 726d 6174  {1}[keV]".format
-00039940: 2874 785b 305d 2c20 7478 5b31 3a5d 2e6d  (tx[0], tx[1:].m
-00039950: 6561 6e28 292e 726f 756e 6428 3229 2929  ean().round(2)))
-00039960: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00039970: 6570 7420 284d 6f64 656c 4e6f 7441 7373  ept (ModelNotAss
-00039980: 6f63 6961 7465 6445 7272 6f72 2c20 4e6f  ociatedError, No
-00039990: 5072 6f64 7563 7441 7661 696c 6162 6c65  ProductAvailable
-000399a0: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-000399b0: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-000399c0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-000399d0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000399e0: 7820 3d20 7365 6c66 2e67 6574 5f6c 756d  x = self.get_lum
-000399f0: 696e 6f73 6974 6965 7328 2772 3530 3027  inosities('r500'
-00039a00: 2c20 2763 6f6e 7374 616e 742a 7462 6162  , 'constant*tbab
-00039a10: 732a 6170 6563 272c 206c 6f5f 656e 3d51  s*apec', lo_en=Q
-00039a20: 7561 6e74 6974 7928 302e 352c 2027 6b65  uantity(0.5, 'ke
-00039a30: 5627 292c 0a20 2020 2020 2020 2020 2020  V'),.           
-00039a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039a60: 6869 5f65 6e3d 5175 616e 7469 7479 2832  hi_en=Quantity(2
-00039a70: 2e30 2c20 276b 6556 2729 292e 746f 2827  .0, 'keV')).to('
-00039a80: 3130 5e34 3420 6572 672f 7327 292e 7661  10^44 erg/s').va
-00039a90: 6c75 652e 726f 756e 6428 3229 0a20 2020  lue.round(2).   
-00039aa0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00039ab0: 6e74 2822 5235 3030 2030 2e35 2d32 2e30  nt("R500 0.5-2.0
-00039ac0: 6b65 5620 4c78 202d 207b 307d c2b1 7b31  keV Lx - {0}..{1
-00039ad0: 7d5b 652b 3434 2065 7267 2f73 5d22 2e66  }[e+44 erg/s]".f
-00039ae0: 6f72 6d61 7428 6c78 5b30 5d2c 206c 785b  ormat(lx[0], lx[
-00039af0: 313a 5d2e 6d65 616e 2829 2e72 6f75 6e64  1:].mean().round
-00039b00: 2832 2929 290a 0a20 2020 2020 2020 2020  (2)))..         
-00039b10: 2020 2065 7863 6570 7420 284d 6f64 656c     except (Model
-00039b20: 4e6f 7441 7373 6f63 6961 7465 6445 7272  NotAssociatedErr
-00039b30: 6f72 2c20 4e6f 5072 6f64 7563 7441 7661  or, NoProductAva
-00039b40: 696c 6162 6c65 4572 726f 7229 3a0a 2020  ilableError):.  
-00039b50: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00039b60: 7373 0a20 2020 2020 2020 2070 7269 6e74  ss.        print
-00039b70: 2822 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ("--------------
-00039b80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00039b90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00039ba0: 2d2d 2d2d 2d2d 2d5c 6e22 290a 0a20 2020  -------\n")..   
-00039bb0: 2064 6566 205f 5f6c 656e 5f5f 2873 656c   def __len__(sel
-00039bc0: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-00039bd0: 2020 2022 2222 0a20 2020 2020 2020 204d     """.        M
-00039be0: 6574 686f 6420 746f 2072 6574 7572 6e20  ethod to return 
-00039bf0: 7468 6520 6c65 6e67 7468 206f 6620 7468  the length of th
-00039c00: 6520 7072 6f64 7563 7473 2064 6963 7469  e products dicti
-00039c10: 6f6e 6172 7920 2877 6869 6368 206d 6561  onary (which mea
-00039c20: 6e73 2074 6865 206e 756d 6265 7220 6f66  ns the number of
-00039c30: 0a20 2020 2020 2020 2069 6e64 6976 6964  .        individ
-00039c40: 7561 6c20 4f62 7349 4473 2061 7373 6f63  ual ObsIDs assoc
-00039c50: 6961 7465 6420 7769 7468 2074 6869 7320  iated with this 
-00039c60: 736f 7572 6365 292c 2077 6865 6e20 6c65  source), when le
-00039c70: 6e28 2920 6973 2063 616c 6c65 6420 6f6e  n() is called on
-00039c80: 2061 6e20 696e 7374 616e 6365 206f 6620   an instance of 
-00039c90: 7468 6973 2063 6c61 7373 2e0a 0a20 2020  this class...   
-00039ca0: 2020 2020 203a 7265 7475 726e 3a20 5468       :return: Th
-00039cb0: 6520 696e 7465 6765 7220 6c65 6e67 7468  e integer length
-00039cc0: 206f 6620 7468 6520 746f 7020 6c65 7665   of the top leve
-00039cd0: 6c20 6f66 2074 6865 205f 7072 6f64 7563  l of the _produc
-00039ce0: 7473 206e 6573 7465 6420 6469 6374 696f  ts nested dictio
-00039cf0: 6e61 7279 2e0a 2020 2020 2020 2020 3a72  nary..        :r
-00039d00: 7479 7065 3a20 696e 740a 2020 2020 2020  type: int.      
-00039d10: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00039d20: 7475 726e 206c 656e 2873 656c 662e 6f62  turn len(self.ob
-00039d30: 735f 6964 7329 0a0a 0a23 2057 6173 2067  s_ids)...# Was g
-00039d40: 6f69 6e67 2074 6f20 7772 6974 6520 7468  oing to write th
-00039d50: 6973 2061 7320 6120 7375 6263 6c61 7373  is as a subclass
-00039d60: 206f 6620 4261 7365 536f 7572 6365 2c20   of BaseSource, 
-00039d70: 6173 2069 7420 7769 6c6c 2062 6568 6176  as it will behav
-00039d80: 6520 6c61 7267 656c 7920 7468 6520 7361  e largely the sa
-00039d90: 6d65 2c20 6275 7420 4920 646f 6e27 740a  me, but I don't.
-00039da0: 2320 2077 616e 7420 6974 2064 6563 6c61  #  want it decla
-00039db0: 7269 6e67 2058 4741 2070 726f 6475 6374  ring XGA product
-00039dc0: 7320 666f 7220 7465 6e73 206f 6620 7468  s for tens of th
-00039dd0: 6f75 7361 6e64 7320 6f66 2069 6d61 6765  ousands of image
-00039de0: 7320 6574 632e 0a23 2041 7320 7375 6368  s etc..# As such
-00039df0: 2077 696c 6c20 7265 706c 6963 6174 6520   will replicate 
-00039e00: 7468 6520 6261 7365 2066 756e 6374 696f  the base functio
-00039e10: 6e61 6c69 7479 206f 6620 4261 7365 536f  nality of BaseSo
-00039e20: 7572 6365 2074 6861 7420 7769 6c6c 2061  urce that will a
-00039e30: 6c6c 6f77 2065 7673 656c 6563 745f 696d  llow evselect_im
-00039e40: 6167 652c 2065 7870 6d61 702c 2063 6966  age, expmap, cif
-00039e50: 6275 696c 640a 2320 5341 5320 7772 6170  build.# SAS wrap
-00039e60: 7065 7273 2074 6f20 776f 726b 2e0a 2320  pers to work..# 
-00039e70: 5468 6973 2064 6f65 7320 6861 7665 2061  This does have a
-00039e80: 206c 6f74 206f 6620 7374 7261 6967 6874   lot of straight
-00039e90: 2063 6f70 6965 6420 636f 6465 2066 726f   copied code fro
-00039ea0: 6d20 4261 7365 536f 7572 6365 2c20 6275  m BaseSource, bu
-00039eb0: 7420 4920 646f 6e27 7420 6d69 6e64 2069  t I don't mind i
-00039ec0: 6e20 7468 6973 2069 6e73 7461 6e63 650a  n this instance.
-00039ed0: 636c 6173 7320 4e75 6c6c 536f 7572 6365  class NullSource
-00039ee0: 3a0a 2020 2020 2222 220a 2020 2020 4120  :.    """.    A 
-00039ef0: 7573 6566 756c 2c20 6275 7420 7665 7279  useful, but very
-00039f00: 206c 696d 6974 6564 2c20 736f 7572 6365   limited, source
-00039f10: 2063 6c61 7373 2e20 4279 2064 6566 6175   class. By defau
-00039f20: 6c74 2074 6869 7320 736f 7572 6365 2063  lt this source c
-00039f30: 6c61 7373 2077 696c 6c20 696e 636c 7564  lass will includ
-00039f40: 6520 616c 6c20 4f62 7349 4473 2070 7265  e all ObsIDs pre
-00039f50: 7365 6e74 2069 6e20 7468 650a 2020 2020  sent in the.    
-00039f60: 5847 4120 6365 6e73 7573 2c20 616e 6420  XGA census, and 
-00039f70: 6173 2073 7563 6820 6361 6e20 6265 2075  as such can be u
-00039f80: 7365 6420 666f 7220 6275 6c6b 2067 656e  sed for bulk gen
-00039f90: 6572 6174 696f 6e20 6f66 2053 4153 2070  eration of SAS p
-00039fa0: 726f 6475 6374 732e 2049 7420 6361 6e20  roducts. It can 
-00039fb0: 616c 736f 2062 6520 6d61 6465 2074 6f20  also be made to 
-00039fc0: 6f6e 6c79 2069 6e63 6c75 6465 0a20 2020  only include.   
-00039fd0: 2063 6572 7461 696e 204f 6273 4944 732e   certain ObsIDs.
-00039fe0: 0a0a 0a20 2020 203a 7061 7261 6d20 4c69  ...    :param Li
-00039ff0: 7374 206f 6273 3a20 416e 206f 7074 696f  st obs: An optio
-0003a000: 6e61 6c20 6c69 7374 206f 6620 4f62 7349  nal list of ObsI
-0003a010: 4473 2074 6f20 696e 636c 7564 6520 696e  Ds to include in
-0003a020: 2074 6865 204e 756c 6c53 6f75 7263 652c   the NullSource,
-0003a030: 206f 7468 6572 7769 7365 2061 6c6c 2061   otherwise all a
-0003a040: 7661 696c 6162 6c65 204f 6273 4944 730a  vailable ObsIDs.
-0003a050: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-0003a060: 696e 636c 7564 6564 2e0a 2020 2020 2222  included..    ""
-0003a070: 220a 2020 2020 6465 6620 5f5f 696e 6974  ".    def __init
-0003a080: 5f5f 2873 656c 662c 206f 6273 3a20 4c69  __(self, obs: Li
-0003a090: 7374 5b73 7472 5d20 3d20 4e6f 6e65 293a  st[str] = None):
-0003a0a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0003a0b0: 2020 2020 2054 6865 206d 6574 686f 6420       The method 
-0003a0c0: 7573 6564 2074 6f20 696e 6974 6961 7465  used to initiate
-0003a0d0: 2074 6865 204e 756c 6c53 6f75 7263 6520   the NullSource 
-0003a0e0: 636c 6173 732e 0a20 2020 2020 2020 2022  class..        "
-0003a0f0: 2222 0a20 2020 2020 2020 2023 2054 6f20  "".        # To 
-0003a100: 6669 6e64 2061 6c6c 2063 656e 7375 7320  find all census 
-0003a110: 656e 7472 6965 7320 7769 7468 206e 6f6e  entries with non
-0003a120: 2d6e 6120 636f 6f72 6469 6e61 7465 730a  -na coordinates.
-0003a130: 2020 2020 2020 2020 636c 6561 6e65 645f          cleaned_
-0003a140: 6365 6e73 7573 203d 2043 454e 5355 532e  census = CENSUS.
-0003a150: 6472 6f70 6e61 2829 0a20 2020 2020 2020  dropna().       
-0003a160: 2073 656c 662e 5f72 615f 6465 6320 3d20   self._ra_dec = 
-0003a170: 6e70 2e61 7272 6179 285b 4e6f 6e65 2c20  np.array([None, 
-0003a180: 4e6f 6e65 5d29 0a20 2020 2020 2020 2023  None]).        #
-0003a190: 2054 6865 2075 7365 7220 6361 6e20 7370   The user can sp
-0003a1a0: 6563 6966 7920 4f62 7349 4473 2074 6f20  ecify ObsIDs to 
-0003a1b0: 6173 736f 6369 6174 6520 7769 7468 2074  associate with t
-0003a1c0: 6865 204e 756c 6c53 6f75 7263 652c 206f  he NullSource, o
-0003a1d0: 7220 6173 736f 6369 6174 6520 616c 6c0a  r associate all.
-0003a1e0: 2020 2020 2020 2020 2320 206f 6620 7468          #  of th
-0003a1f0: 656d 2062 7920 6c65 6176 696e 6720 6974  em by leaving it
-0003a200: 2061 7320 4e6f 6e65 0a20 2020 2020 2020   as None.       
-0003a210: 2069 6620 6f62 7320 6973 204e 6f6e 653a   if obs is None:
-0003a220: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003a230: 662e 5f6e 616d 6520 3d20 2241 6c6c 4f62  f._name = "AllOb
-0003a240: 7365 7276 6174 696f 6e73 220a 2020 2020  servations".    
-0003a250: 2020 2020 2020 2020 6f62 7320 3d20 636c          obs = cl
-0003a260: 6561 6e65 645f 6365 6e73 7573 5b22 4f62  eaned_census["Ob
-0003a270: 7349 4422 5d2e 7661 6c75 6573 0a20 2020  sID"].values.   
-0003a280: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0003a290: 2020 2020 2020 2023 2049 206b 6e6f 7720         # I know 
-0003a2a0: 7468 6973 2069 7320 616e 2075 676c 7920  this is an ugly 
-0003a2b0: 6e65 7374 6564 2069 6620 7374 6174 656d  nested if statem
-0003a2c0: 656e 7473 2c20 6275 7420 4920 6f6e 6c79  ents, but I only
-0003a2d0: 2077 616e 7465 6420 746f 2072 756e 206f   wanted to run o
-0003a2e0: 6273 5f63 6865 636b 206f 6e63 650a 2020  bs_check once.  
-0003a2f0: 2020 2020 2020 2020 2020 6f62 7320 3d20            obs = 
-0003a300: 6e70 2e61 7272 6179 286f 6273 290a 2020  np.array(obs).  
-0003a310: 2020 2020 2020 2020 2020 6f62 735f 6368            obs_ch
-0003a320: 6563 6b20 3d20 5b6f 2069 6e20 636c 6561  eck = [o in clea
-0003a330: 6e65 645f 6365 6e73 7573 5b22 4f62 7349  ned_census["ObsI
-0003a340: 4422 5d2e 7661 6c75 6573 2066 6f72 206f  D"].values for o
-0003a350: 2069 6e20 6f62 735d 0a20 2020 2020 2020   in obs].       
-0003a360: 2020 2020 2023 2049 6620 616c 6c20 7573       # If all us
-0003a370: 6572 2065 6e74 6572 6564 204f 6273 4944  er entered ObsID
-0003a380: 7320 6172 6520 696e 2074 6865 2063 656e  s are in the cen
-0003a390: 7375 732c 2074 6865 6e20 616c 6c20 6973  sus, then all is
-0003a3a0: 2066 696e 650a 2020 2020 2020 2020 2020   fine.          
-0003a3b0: 2020 6966 2061 6c6c 286f 6273 5f63 6865    if all(obs_che
-0003a3c0: 636b 293a 0a20 2020 2020 2020 2020 2020  ck):.           
-0003a3d0: 2020 2020 2073 656c 662e 5f6e 616d 6520       self._name 
-0003a3e0: 3d20 227b 7d4f 6273 6572 7661 7469 6f6e  = "{}Observation
-0003a3f0: 7322 2e66 6f72 6d61 7428 6c65 6e28 6f62  s".format(len(ob
-0003a400: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
-0003a410: 2320 4966 2074 6865 7920 6172 656e 2774  # If they aren't
-0003a420: 2061 6c6c 2069 6e20 7468 6520 6365 6e73   all in the cens
-0003a430: 7573 2074 6865 6e20 7468 6174 2069 7320  us then that is 
-0003a440: 6465 6369 6465 646c 7920 6e6f 7420 6669  decidedly not fi
-0003a450: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
-0003a460: 6c69 6620 6e6f 7420 616c 6c28 6f62 735f  lif not all(obs_
-0003a470: 6368 6563 6b29 3a0a 2020 2020 2020 2020  check):.        
-0003a480: 2020 2020 2020 2020 6e6f 745f 7661 6c69          not_vali
-0003a490: 6420 3d20 6e70 2e61 7272 6179 286f 6273  d = np.array(obs
-0003a4a0: 295b 7e6e 702e 6172 7261 7928 6f62 735f  )[~np.array(obs_
-0003a4b0: 6368 6563 6b29 5d0a 2020 2020 2020 2020  check)].        
-0003a4c0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0003a4d0: 6c75 6545 7272 6f72 2822 5468 6520 666f  lueError("The fo
-0003a4e0: 6c6c 6f77 696e 6720 6172 6520 6e6f 7420  llowing are not 
-0003a4f0: 7072 6573 656e 7420 696e 2074 6865 2058  present in the X
-0003a500: 4741 2063 656e 7375 732c 2022 0a20 2020  GA census, ".   
-0003a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a520: 2020 2020 2020 2020 2020 2020 2020 227b                "{
-0003a530: 7d22 2e66 6f72 6d61 7428 222c 2022 2e6a  }".format(", ".j
-0003a540: 6f69 6e28 6e6f 745f 7661 6c69 6429 2929  oin(not_valid)))
-0003a550: 0a0a 2020 2020 2020 2020 2320 4669 6e64  ..        # Find
-0003a560: 206f 7574 2077 6869 6368 0a20 2020 2020   out which.     
-0003a570: 2020 2069 6e73 7472 756d 656e 7473 203d     instruments =
-0003a580: 207b 6f3a 205b 5d20 666f 7220 6f20 696e   {o: [] for o in
-0003a590: 206f 6273 7d0a 2020 2020 2020 2020 666f   obs}.        fo
-0003a5a0: 7220 6f20 696e 206f 6273 3a0a 2020 2020  r o in obs:.    
-0003a5b0: 2020 2020 2020 2020 6966 2063 6c65 616e          if clean
-0003a5c0: 6564 5f63 656e 7375 735b 636c 6561 6e65  ed_census[cleane
-0003a5d0: 645f 6365 6e73 7573 5b22 4f62 7349 4422  d_census["ObsID"
-0003a5e0: 5d20 3d3d 206f 5d5b 2255 5345 5f50 4e22  ] == o]["USE_PN"
-0003a5f0: 5d2e 7661 6c75 6573 5b30 5d3a 0a20 2020  ].values[0]:.   
-0003a600: 2020 2020 2020 2020 2020 2020 2069 6e73               ins
-0003a610: 7472 756d 656e 7473 5b6f 5d2e 6170 7065  truments[o].appe
-0003a620: 6e64 2822 706e 2229 0a20 2020 2020 2020  nd("pn").       
-0003a630: 2020 2020 2069 6620 636c 6561 6e65 645f       if cleaned_
-0003a640: 6365 6e73 7573 5b63 6c65 616e 6564 5f63  census[cleaned_c
-0003a650: 656e 7375 735b 224f 6273 4944 225d 203d  ensus["ObsID"] =
-0003a660: 3d20 6f5d 5b22 5553 455f 4d4f 5331 225d  = o]["USE_MOS1"]
-0003a670: 2e76 616c 7565 735b 305d 3a0a 2020 2020  .values[0]:.    
-0003a680: 2020 2020 2020 2020 2020 2020 696e 7374              inst
-0003a690: 7275 6d65 6e74 735b 6f5d 2e61 7070 656e  ruments[o].appen
-0003a6a0: 6428 226d 6f73 3122 290a 2020 2020 2020  d("mos1").      
-0003a6b0: 2020 2020 2020 6966 2063 6c65 616e 6564        if cleaned
-0003a6c0: 5f63 656e 7375 735b 636c 6561 6e65 645f  _census[cleaned_
-0003a6d0: 6365 6e73 7573 5b22 4f62 7349 4422 5d20  census["ObsID"] 
-0003a6e0: 3d3d 206f 5d5b 2255 5345 5f4d 4f53 3222  == o]["USE_MOS2"
-0003a6f0: 5d2e 7661 6c75 6573 5b30 5d3a 0a20 2020  ].values[0]:.   
-0003a700: 2020 2020 2020 2020 2020 2020 2069 6e73               ins
-0003a710: 7472 756d 656e 7473 5b6f 5d2e 6170 7065  truments[o].appe
-0003a720: 6e64 2822 6d6f 7332 2229 0a0a 2020 2020  nd("mos2")..    
-0003a730: 2020 2020 2320 5468 6973 2063 6865 636b      # This check
-0003a740: 7320 7468 6174 2074 6865 206f 6273 6572  s that the obser
-0003a750: 7661 7469 6f6e 7320 6861 7665 2061 7420  vations have at 
-0003a760: 6c65 6173 7420 6f6e 6520 7573 6162 6c65  least one usable
-0003a770: 2069 6e73 7472 756d 656e 740a 2020 2020   instrument.    
-0003a780: 2020 2020 7365 6c66 2e5f 6f62 7320 3d20      self._obs = 
-0003a790: 5b6f 2066 6f72 206f 2069 6e20 6f62 7320  [o for o in obs 
-0003a7a0: 6966 206c 656e 2869 6e73 7472 756d 656e  if len(instrumen
-0003a7b0: 7473 5b6f 5d29 203e 2030 5d0a 2020 2020  ts[o]) > 0].    
-0003a7c0: 2020 2020 7365 6c66 2e5f 696e 7374 7275      self._instru
-0003a7d0: 6d65 6e74 7320 3d20 7b6f 3a20 696e 7374  ments = {o: inst
-0003a7e0: 7275 6d65 6e74 735b 6f5d 2066 6f72 206f  ruments[o] for o
-0003a7f0: 2069 6e20 7365 6c66 2e5f 6f62 7320 6966   in self._obs if
-0003a800: 206c 656e 2869 6e73 7472 756d 656e 7473   len(instruments
-0003a810: 5b6f 5d29 203e 2030 7d0a 0a20 2020 2020  [o]) > 0}..     
-0003a820: 2020 2023 2048 6572 6520 7765 2063 6865     # Here we che
-0003a830: 636b 2074 6f20 6d61 6b65 2073 7572 6520  ck to make sure 
-0003a840: 7468 6174 2074 6865 7265 2069 7320 6174  that there is at
-0003a850: 206c 6561 7374 206f 6e65 2076 616c 6964   least one valid
-0003a860: 204f 6273 4944 2072 656d 6169 6e69 6e67   ObsID remaining
-0003a870: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0003a880: 7365 6c66 2e5f 6f62 7329 203d 3d20 303a  self._obs) == 0:
-0003a890: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0003a8a0: 7365 204e 6f56 616c 6964 4f62 7365 7276  se NoValidObserv
-0003a8b0: 6174 696f 6e73 4572 726f 7228 2241 6674  ationsError("Aft
-0003a8c0: 6572 2063 6865 636b 7320 7573 696e 6720  er checks using 
-0003a8d0: 7468 6520 5847 4120 6365 6e73 7573 2c20  the XGA census, 
-0003a8e0: 616c 6c20 4f62 7349 4473 2061 7373 6f63  all ObsIDs assoc
-0003a8f0: 6961 7465 6420 7769 7468 2074 6869 7320  iated with this 
-0003a900: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0003a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a920: 2020 2020 2020 2020 2020 2020 2022 4e75               "Nu
-0003a930: 6c6c 536f 7572 6365 2061 7265 2063 6f6e  llSource are con
-0003a940: 7369 6465 7265 6420 756e 7573 6162 6c65  sidered unusable
-0003a950: 2e22 290a 0a20 2020 2020 2020 2023 2054  .")..        # T
-0003a960: 6865 2053 4153 2067 656e 6572 6174 696f  he SAS generatio
-0003a970: 6e20 726f 7574 696e 6520 6d69 6768 7420  n routine might 
-0003a980: 6e65 6564 2074 6869 7320 696e 666f 726d  need this inform
-0003a990: 6174 696f 6e0a 2020 2020 2020 2020 7365  ation.        se
-0003a9a0: 6c66 2e5f 6174 745f 6669 6c65 7320 3d20  lf._att_files = 
-0003a9b0: 7b6f 3a20 7867 615f 636f 6e66 5b22 584d  {o: xga_conf["XM
-0003a9c0: 4d5f 4649 4c45 5322 5d5b 2261 7474 6974  M_FILES"]["attit
-0003a9d0: 7564 655f 6669 6c65 225d 2e66 6f72 6d61  ude_file"].forma
-0003a9e0: 7428 6f62 735f 6964 3d6f 2920 666f 7220  t(obs_id=o) for 
-0003a9f0: 6f20 696e 2073 656c 662e 5f6f 6273 7d0a  o in self._obs}.
-0003aa00: 0a20 2020 2020 2020 2023 204e 6565 6420  .        # Need 
-0003aa10: 7468 6520 6576 656e 7420 6c69 7374 206f  the event list o
-0003aa20: 626a 6563 7473 2064 6563 6c61 7265 6420  bjects declared 
-0003aa30: 756e 666f 7274 756e 6174 656c 790a 2020  unfortunately.  
-0003aa40: 2020 2020 2020 7365 6c66 2e5f 7072 6f64        self._prod
-0003aa50: 7563 7473 203d 207b 6f3a 207b 7d20 666f  ucts = {o: {} fo
-0003aa60: 7220 6f20 696e 2073 656c 662e 5f6f 6273  r o in self._obs
-0003aa70: 7d0a 2020 2020 2020 2020 666f 7220 6f20  }.        for o 
-0003aa80: 696e 2073 656c 662e 5f6f 6273 3a0a 2020  in self._obs:.  
-0003aa90: 2020 2020 2020 2020 2020 666f 7220 696e            for in
-0003aaa0: 7374 2069 6e20 7365 6c66 2e5f 696e 7374  st in self._inst
-0003aab0: 7275 6d65 6e74 735b 6f5d 3a0a 2020 2020  ruments[o]:.    
-0003aac0: 2020 2020 2020 2020 2020 2020 6576 745f              evt_
-0003aad0: 6b65 7920 3d20 2263 6c65 616e 5f7b 7d5f  key = "clean_{}_
-0003aae0: 6576 7473 222e 666f 726d 6174 2869 6e73  evts".format(ins
-0003aaf0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-0003ab00: 2020 2065 7674 5f66 696c 6520 3d20 7867     evt_file = xg
-0003ab10: 615f 636f 6e66 5b22 584d 4d5f 4649 4c45  a_conf["XMM_FILE
-0003ab20: 5322 5d5b 6576 745f 6b65 795d 2e66 6f72  S"][evt_key].for
-0003ab30: 6d61 7428 6f62 735f 6964 3d6f 290a 2020  mat(obs_id=o).  
-0003ab40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0003ab50: 6c66 2e5f 7072 6f64 7563 7473 5b6f 5d5b  lf._products[o][
-0003ab60: 696e 7374 5d20 3d20 7b22 6576 656e 7473  inst] = {"events
-0003ab70: 223a 2045 7665 6e74 4c69 7374 2865 7674  ": EventList(evt
-0003ab80: 5f66 696c 652c 206f 6273 5f69 643d 6f2c  _file, obs_id=o,
-0003ab90: 2069 6e73 7472 756d 656e 743d 696e 7374   instrument=inst
-0003aba0: 2c20 7374 646f 7574 5f73 7472 3d22 222c  , stdout_str="",
-0003abb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abf0: 7374 6465 7272 5f73 7472 3d22 222c 2067  stderr_str="", g
-0003ac00: 656e 5f63 6d64 3d22 2229 7d0a 0a20 2020  en_cmd="")}..   
-0003ac10: 2020 2020 2023 2054 6869 7320 6973 2061       # This is a
-0003ac20: 2071 7565 7565 2066 6f72 2070 726f 6475   queue for produ
-0003ac30: 6374 7320 746f 2062 6520 6765 6e65 7261  cts to be genera
-0003ac40: 7465 6420 666f 7220 7468 6973 2073 6f75  ted for this sou
-0003ac50: 7263 652c 2077 696c 6c20 6265 2061 206e  rce, will be a n
-0003ac60: 756d 7079 2061 7272 6179 2069 6e20 7072  umpy array in pr
-0003ac70: 6163 7469 7365 2e0a 2020 2020 2020 2020  actise..        
-0003ac80: 2320 4974 656d 7320 696e 2074 6865 2073  # Items in the s
-0003ac90: 616d 6520 726f 7720 7769 6c6c 2061 6c6c  ame row will all
-0003aca0: 2062 6520 6765 6e65 7261 7465 6420 696e   be generated in
-0003acb0: 2070 6172 616c 6c65 6c2c 2077 6865 7265   parallel, where
-0003acc0: 6173 2069 7465 6d73 2069 6e20 7468 6520  as items in the 
-0003acd0: 7361 6d65 2063 6f6c 756d 6e20 7769 6c6c  same column will
-0003ace0: 0a20 2020 2020 2020 2023 2062 6520 636f  .        # be co
-0003acf0: 6d62 696e 6564 2069 6e74 6f20 6120 636f  mbined into a co
-0003ad00: 6d6d 616e 6420 7374 6163 6b20 616e 6420  mmand stack and 
-0003ad10: 7275 6e20 696e 206f 7264 6572 2e0a 2020  run in order..  
-0003ad20: 2020 2020 2020 7365 6c66 2e71 7565 7565        self.queue
-0003ad30: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0003ad40: 2320 416e 6f74 6865 7220 6174 7472 6962  # Another attrib
-0003ad50: 7574 6520 6465 7374 696e 6564 2074 6f20  ute destined to 
-0003ad60: 6265 2061 6e20 6172 7261 792c 2077 696c  be an array, wil
-0003ad70: 6c20 636f 6e74 6169 6e20 7468 6520 6f75  l contain the ou
-0003ad80: 7470 7574 2074 7970 6520 6f66 2065 6163  tput type of eac
-0003ad90: 6820 636f 6d6d 616e 6420 7375 626d 6974  h command submit
-0003ada0: 7465 6420 746f 0a20 2020 2020 2020 2023  ted to.        #
-0003adb0: 2074 6865 2071 7565 7565 2061 7272 6179   the queue array
-0003adc0: 2e0a 2020 2020 2020 2020 7365 6c66 2e71  ..        self.q
-0003add0: 7565 7565 5f74 7970 6520 3d20 4e6f 6e65  ueue_type = None
-0003ade0: 0a20 2020 2020 2020 2023 2054 6869 7320  .        # This 
-0003adf0: 636f 6e74 6169 6e73 2061 6e20 6172 7261  contains an arra
-0003ae00: 7920 6f66 2074 6865 2070 6174 6873 206f  y of the paths o
-0003ae10: 6620 7468 6520 6669 6e61 6c20 6f75 7470  f the final outp
-0003ae20: 7574 206f 6620 6561 6368 2063 6f6d 6d61  ut of each comma
-0003ae30: 6e64 2069 6e20 7468 6520 7175 6575 650a  nd in the queue.
-0003ae40: 2020 2020 2020 2020 7365 6c66 2e71 7565          self.que
-0003ae50: 7565 5f70 6174 6820 3d20 4e6f 6e65 0a20  ue_path = None. 
-0003ae60: 2020 2020 2020 2023 2054 6869 7320 636f         # This co
-0003ae70: 6e74 6169 6e73 2061 6e20 6172 7261 7920  ntains an array 
-0003ae80: 6f66 2074 6865 2065 7874 7261 2069 6e66  of the extra inf
-0003ae90: 6f72 6d61 7469 6f6e 206e 6565 6465 6420  ormation needed 
-0003aea0: 746f 2069 6e73 7461 6e74 6961 7465 2063  to instantiate c
-0003aeb0: 6c61 7373 0a20 2020 2020 2020 2023 2061  lass.        # a
-0003aec0: 6674 6572 2074 6865 2053 4153 2063 6f6d  fter the SAS com
-0003aed0: 6d61 6e64 2068 6173 2072 756e 0a20 2020  mand has run.   
-0003aee0: 2020 2020 2073 656c 662e 7175 6575 655f       self.queue_
-0003aef0: 6578 7472 615f 696e 666f 203d 204e 6f6e  extra_info = Non
-0003af00: 650a 0a20 2020 2064 6566 2067 6574 5f61  e..    def get_a
-0003af10: 7474 5f66 696c 6528 7365 6c66 2c20 6f62  tt_file(self, ob
-0003af20: 735f 6964 3a20 7374 7229 202d 3e20 7374  s_id: str) -> st
-0003af30: 723a 0a20 2020 2020 2020 2022 2222 0a20  r:.        """. 
-0003af40: 2020 2020 2020 2046 6574 6368 6573 2074         Fetches t
-0003af50: 6865 2070 6174 6820 746f 2074 6865 2061  he path to the a
-0003af60: 7474 6974 7564 6520 6669 6c65 2066 6f72  ttitude file for
-0003af70: 2061 6e20 584d 4d20 6f62 7365 7276 6174   an XMM observat
-0003af80: 696f 6e2e 0a0a 2020 2020 2020 2020 3a70  ion...        :p
-0003af90: 6172 616d 206f 6273 5f69 643a 2054 6865  aram obs_id: The
-0003afa0: 204f 6273 4944 2074 6f20 6665 7463 6820   ObsID to fetch 
-0003afb0: 7468 6520 6174 7469 7475 6465 2066 696c  the attitude fil
-0003afc0: 6520 666f 722e 0a20 2020 2020 2020 203a  e for..        :
-0003afd0: 7265 7475 726e 3a20 5468 6520 7061 7468  return: The path
-0003afe0: 2074 6f20 7468 6520 6174 7469 7475 6465   to the attitude
-0003aff0: 2066 696c 652e 0a20 2020 2020 2020 203a   file..        :
-0003b000: 7274 7970 653a 2073 7472 0a20 2020 2020  rtype: str.     
-0003b010: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0003b020: 6620 6f62 735f 6964 206e 6f74 2069 6e20  f obs_id not in 
-0003b030: 7365 6c66 2e5f 7072 6f64 7563 7473 3a0a  self._products:.
-0003b040: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0003b050: 6520 4e6f 7441 7373 6f63 6961 7465 6445  e NotAssociatedE
-0003b060: 7272 6f72 2822 7b6f 7d20 6973 206e 6f74  rror("{o} is not
-0003b070: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-0003b080: 207b 737d 222e 666f 726d 6174 286f 3d6f   {s}".format(o=o
-0003b090: 6273 5f69 642c 2073 3d73 656c 662e 6e61  bs_id, s=self.na
-0003b0a0: 6d65 2929 0a20 2020 2020 2020 2065 6c73  me)).        els
-0003b0b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0003b0c0: 6574 7572 6e20 7365 6c66 2e5f 6174 745f  eturn self._att_
-0003b0d0: 6669 6c65 735b 6f62 735f 6964 5d0a 0a20  files[obs_id].. 
-0003b0e0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0003b0f0: 2064 6566 206f 6273 5f69 6473 2873 656c   def obs_ids(sel
-0003b100: 6629 202d 3e20 4c69 7374 5b73 7472 5d3a  f) -> List[str]:
-0003b110: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0003b120: 2020 2020 2050 726f 7065 7274 7920 6765       Property ge
-0003b130: 7474 6572 2066 6f72 204f 6273 4944 7320  tter for ObsIDs 
-0003b140: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
-0003b150: 7468 6973 2073 6f75 7263 6520 7468 6174  this source that
-0003b160: 2061 7265 2063 6f6e 6669 726d 6564 2074   are confirmed t
-0003b170: 6f20 6861 7665 2065 7665 6e74 7320 6669  o have events fi
-0003b180: 6c65 732e 0a0a 2020 2020 2020 2020 3a72  les...        :r
-0003b190: 6574 7572 6e3a 2041 206c 6973 7420 6f66  eturn: A list of
-0003b1a0: 2074 6865 2061 7373 6f63 6961 7465 6420   the associated 
-0003b1b0: 584d 4d20 4f62 7349 4473 2e0a 2020 2020  XMM ObsIDs..    
-0003b1c0: 2020 2020 3a72 7479 7065 3a20 4c69 7374      :rtype: List
-0003b1d0: 5b73 7472 5d0a 2020 2020 2020 2020 2222  [str].        ""
-0003b1e0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0003b1f0: 2073 656c 662e 5f6f 6273 0a0a 2020 2020   self._obs..    
-0003b200: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-0003b210: 6620 696e 7374 7275 6d65 6e74 7328 7365  f instruments(se
-0003b220: 6c66 2920 2d3e 2044 6963 743a 0a20 2020  lf) -> Dict:.   
-0003b230: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0003b240: 2041 2070 726f 7065 7274 7920 6f66 2061   A property of a
-0003b250: 2073 6f75 7263 6520 7468 6174 2064 6574   source that det
-0003b260: 6169 6c73 2077 6869 6368 2069 6e73 7472  ails which instr
-0003b270: 756d 656e 7473 2068 6176 6520 7661 6c69  uments have vali
-0003b280: 6420 6461 7461 2066 6f72 2077 6869 6368  d data for which
-0003b290: 206f 6273 6572 7661 7469 6f6e 732e 0a0a   observations...
-0003b2a0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0003b2b0: 2041 2064 6963 7469 6f6e 6172 7920 6f66   A dictionary of
-0003b2c0: 204f 6273 4944 7320 616e 6420 7468 6569   ObsIDs and thei
-0003b2d0: 7220 6173 736f 6369 6174 6564 2076 616c  r associated val
-0003b2e0: 6964 2069 6e73 7472 756d 656e 7473 2e0a  id instruments..
-0003b2f0: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-0003b300: 4469 6374 0a20 2020 2020 2020 2022 2222  Dict.        """
-0003b310: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0003b320: 7365 6c66 2e5f 696e 7374 7275 6d65 6e74  self._instrument
-0003b330: 730a 0a20 2020 2064 6566 2075 7064 6174  s..    def updat
-0003b340: 655f 7175 6575 6528 7365 6c66 2c20 636d  e_queue(self, cm
-0003b350: 645f 6172 723a 206e 702e 6e64 6172 7261  d_arr: np.ndarra
-0003b360: 792c 2070 5f74 7970 655f 6172 723a 206e  y, p_type_arr: n
-0003b370: 702e 6e64 6172 7261 792c 2070 5f70 6174  p.ndarray, p_pat
-0003b380: 685f 6172 723a 206e 702e 6e64 6172 7261  h_arr: np.ndarra
-0003b390: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-0003b3a0: 2020 2020 2020 2020 6578 7472 615f 696e          extra_in
-0003b3b0: 666f 3a20 6e70 2e6e 6461 7272 6179 2c20  fo: np.ndarray, 
-0003b3c0: 7374 6163 6b3a 2062 6f6f 6c20 3d20 4661  stack: bool = Fa
-0003b3d0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
-0003b3e0: 220a 2020 2020 2020 2020 536d 616c 6c20  ".        Small 
-0003b3f0: 6675 6e63 7469 6f6e 2074 6f20 7570 6461  function to upda
-0003b400: 7465 2074 6865 206e 756d 7079 2061 7272  te the numpy arr
-0003b410: 6179 2074 6861 7420 6d61 6b65 7320 7570  ay that makes up
-0003b420: 2074 6865 2071 7565 7565 206f 6620 7072   the queue of pr
-0003b430: 6f64 7563 7473 2074 6f20 6265 2067 656e  oducts to be gen
-0003b440: 6572 6174 6564 2e0a 0a20 2020 2020 2020  erated...       
-0003b450: 203a 7061 7261 6d20 6e70 2e6e 6461 7272   :param np.ndarr
-0003b460: 6179 2063 6d64 5f61 7272 3a20 4172 7261  ay cmd_arr: Arra
-0003b470: 7920 636f 6e74 6169 6e69 6e67 2053 4153  y containing SAS
-0003b480: 2063 6f6d 6d61 6e64 732e 0a20 2020 2020   commands..     
-0003b490: 2020 203a 7061 7261 6d20 6e70 2e6e 6461     :param np.nda
-0003b4a0: 7272 6179 2070 5f74 7970 655f 6172 723a  rray p_type_arr:
-0003b4b0: 2041 7272 6179 206f 6620 7072 6f64 7563   Array of produc
-0003b4c0: 7420 7479 7065 2069 6465 6e74 6966 6965  t type identifie
-0003b4d0: 7273 2066 6f72 2074 6865 2070 726f 6475  rs for the produ
-0003b4e0: 6374 7320 6765 6e65 7261 7465 640a 2020  cts generated.  
-0003b4f0: 2020 2020 2020 2020 2020 6279 2074 6865            by the
-0003b500: 2063 6d64 2061 7272 6179 2e20 652e 672e   cmd array. e.g.
-0003b510: 2069 6d61 6765 206f 7220 6578 706d 6170   image or expmap
-0003b520: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0003b530: 206e 702e 6e64 6172 7261 7920 705f 7061   np.ndarray p_pa
-0003b540: 7468 5f61 7272 3a20 4172 7261 7920 6f66  th_arr: Array of
-0003b550: 2066 696e 616c 2070 726f 6475 6374 2070   final product p
-0003b560: 6174 6873 2069 6620 636d 6420 6973 2073  aths if cmd is s
-0003b570: 7563 6365 7373 6675 6c0a 2020 2020 2020  uccessful.      
-0003b580: 2020 3a70 6172 616d 206e 702e 6e64 6172    :param np.ndar
-0003b590: 7261 7920 6578 7472 615f 696e 666f 3a20  ray extra_info: 
-0003b5a0: 4172 7261 7920 6f66 2065 7874 7261 2069  Array of extra i
-0003b5b0: 6e66 6f72 6d61 7469 6f6e 2064 6963 7469  nformation dicti
-0003b5c0: 6f6e 6172 6965 730a 2020 2020 2020 2020  onaries.        
-0003b5d0: 3a70 6172 616d 2073 7461 636b 3a20 5368  :param stack: Sh
-0003b5e0: 6f75 6c64 2074 6865 7365 2063 6f6d 6d61  ould these comma
-0003b5f0: 6e64 7320 6265 2065 7865 6375 7465 6420  nds be executed 
-0003b600: 6166 7465 7220 6120 7072 6563 6564 696e  after a precedin
-0003b610: 6720 6c69 6e65 206f 6620 636f 6d6d 616e  g line of comman
-0003b620: 6473 2c0a 2020 2020 2020 2020 2020 2020  ds,.            
-0003b630: 6f72 2061 7420 7468 6520 7361 6d65 2074  or at the same t
-0003b640: 696d 652e 0a20 2020 2020 2020 203a 7265  ime..        :re
-0003b650: 7475 726e 3a0a 2020 2020 2020 2020 2222  turn:.        ""
-0003b660: 220a 2020 2020 2020 2020 6966 2073 656c  ".        if sel
-0003b670: 662e 7175 6575 6520 6973 204e 6f6e 653a  f.queue is None:
-0003b680: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-0003b690: 2063 6f75 6c64 2068 6176 6520 646f 6e65   could have done
-0003b6a0: 2061 6c6c 206f 6620 7468 6573 6520 696e   all of these in
-0003b6b0: 206f 6e65 2061 7272 6179 2077 6974 6820   one array with 
-0003b6c0: 3320 6469 6d65 6e73 696f 6e73 2c20 6275  3 dimensions, bu
-0003b6d0: 7420 6665 6c74 2074 6869 7320 7761 7320  t felt this was 
-0003b6e0: 6561 7369 6572 2074 6f20 7265 6164 0a20  easier to read. 
-0003b6f0: 2020 2020 2020 2020 2020 2023 2061 6e64             # and
-0003b700: 2077 6974 6820 6e6f 2072 6561 6c20 7065   with no real pe
-0003b710: 7266 6f72 6d61 6e63 6520 7065 6e61 6c74  rformance penalt
-0003b720: 790a 2020 2020 2020 2020 2020 2020 7365  y.            se
-0003b730: 6c66 2e71 7565 7565 203d 2063 6d64 5f61  lf.queue = cmd_a
-0003b740: 7272 0a20 2020 2020 2020 2020 2020 2073  rr.            s
-0003b750: 656c 662e 7175 6575 655f 7479 7065 203d  elf.queue_type =
-0003b760: 2070 5f74 7970 655f 6172 720a 2020 2020   p_type_arr.    
-0003b770: 2020 2020 2020 2020 7365 6c66 2e71 7565          self.que
-0003b780: 7565 5f70 6174 6820 3d20 705f 7061 7468  ue_path = p_path
-0003b790: 5f61 7272 0a20 2020 2020 2020 2020 2020  _arr.           
-0003b7a0: 2073 656c 662e 7175 6575 655f 6578 7472   self.queue_extr
-0003b7b0: 615f 696e 666f 203d 2065 7874 7261 5f69  a_info = extra_i
-0003b7c0: 6e66 6f0a 2020 2020 2020 2020 656c 6966  nfo.        elif
-0003b7d0: 2073 7461 636b 3a0a 2020 2020 2020 2020   stack:.        
-0003b7e0: 2020 2020 7365 6c66 2e71 7565 7565 203d      self.queue =
-0003b7f0: 206e 702e 7673 7461 636b 2828 7365 6c66   np.vstack((self
-0003b800: 2e71 7565 7565 2c20 636d 645f 6172 7229  .queue, cmd_arr)
-0003b810: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0003b820: 6c66 2e71 7565 7565 5f74 7970 6520 3d20  lf.queue_type = 
-0003b830: 6e70 2e76 7374 6163 6b28 2873 656c 662e  np.vstack((self.
-0003b840: 7175 6575 655f 7479 7065 2c20 705f 7479  queue_type, p_ty
-0003b850: 7065 5f61 7272 2929 0a20 2020 2020 2020  pe_arr)).       
-0003b860: 2020 2020 2073 656c 662e 7175 6575 655f       self.queue_
-0003b870: 7061 7468 203d 206e 702e 7673 7461 636b  path = np.vstack
-0003b880: 2828 7365 6c66 2e71 7565 7565 5f70 6174  ((self.queue_pat
-0003b890: 682c 2070 5f70 6174 685f 6172 7229 290a  h, p_path_arr)).
-0003b8a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003b8b0: 2e71 7565 7565 5f65 7874 7261 5f69 6e66  .queue_extra_inf
-0003b8c0: 6f20 3d20 6e70 2e76 7374 6163 6b28 2873  o = np.vstack((s
-0003b8d0: 656c 662e 7175 6575 655f 6578 7472 615f  elf.queue_extra_
-0003b8e0: 696e 666f 2c20 6578 7472 615f 696e 666f  info, extra_info
-0003b8f0: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-0003b900: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003b910: 662e 7175 6575 6520 3d20 6e70 2e61 7070  f.queue = np.app
-0003b920: 656e 6428 7365 6c66 2e71 7565 7565 2c20  end(self.queue, 
-0003b930: 636d 645f 6172 722c 2061 7869 733d 3029  cmd_arr, axis=0)
-0003b940: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003b950: 662e 7175 6575 655f 7479 7065 203d 206e  f.queue_type = n
-0003b960: 702e 6170 7065 6e64 2873 656c 662e 7175  p.append(self.qu
-0003b970: 6575 655f 7479 7065 2c20 705f 7479 7065  eue_type, p_type
-0003b980: 5f61 7272 2c20 6178 6973 3d30 290a 2020  _arr, axis=0).  
-0003b990: 2020 2020 2020 2020 2020 7365 6c66 2e71            self.q
-0003b9a0: 7565 7565 5f70 6174 6820 3d20 6e70 2e61  ueue_path = np.a
-0003b9b0: 7070 656e 6428 7365 6c66 2e71 7565 7565  ppend(self.queue
-0003b9c0: 5f70 6174 682c 2070 5f70 6174 685f 6172  _path, p_path_ar
-0003b9d0: 722c 2061 7869 733d 3029 0a20 2020 2020  r, axis=0).     
-0003b9e0: 2020 2020 2020 2073 656c 662e 7175 6575         self.queu
-0003b9f0: 655f 6578 7472 615f 696e 666f 203d 206e  e_extra_info = n
-0003ba00: 702e 6170 7065 6e64 2873 656c 662e 7175  p.append(self.qu
-0003ba10: 6575 655f 6578 7472 615f 696e 666f 2c20  eue_extra_info, 
-0003ba20: 6578 7472 615f 696e 666f 2c20 6178 6973  extra_info, axis
-0003ba30: 3d30 290a 0a20 2020 2064 6566 2067 6574  =0)..    def get
-0003ba40: 5f71 7565 7565 2873 656c 6629 202d 3e20  _queue(self) -> 
-0003ba50: 5475 706c 655b 4c69 7374 5b73 7472 5d2c  Tuple[List[str],
-0003ba60: 204c 6973 745b 7374 725d 2c20 4c69 7374   List[str], List
-0003ba70: 5b4c 6973 745b 7374 725d 5d2c 204c 6973  [List[str]], Lis
-0003ba80: 745b 6469 6374 5d5d 3a0a 2020 2020 2020  t[dict]]:.      
-0003ba90: 2020 2222 220a 2020 2020 2020 2020 4361    """.        Ca
-0003baa0: 6c6c 696e 6720 7468 6973 2069 6e64 6963  lling this indic
-0003bab0: 6174 6573 2074 6861 7420 7468 6520 7175  ates that the qu
-0003bac0: 6575 6520 6973 2061 626f 7574 2074 6f20  eue is about to 
-0003bad0: 6265 2070 726f 6365 7373 6564 2c20 736f  be processed, so
-0003bae0: 2074 6869 7320 6675 6e63 7469 6f6e 2063   this function c
-0003baf0: 6f6d 6269 6e65 7320 5341 530a 2020 2020  ombines SAS.    
-0003bb00: 2020 2020 636f 6d6d 616e 6473 2061 6c6f      commands alo
-0003bb10: 6e67 2063 6f6c 756d 6e73 2028 636f 6d6d  ng columns (comm
-0003bb20: 616e 6420 7374 6163 6b73 292c 2061 6e64  and stacks), and
-0003bb30: 2072 6574 7572 6e73 204e 2053 4153 2063   returns N SAS c
-0003bb40: 6f6d 6d61 6e64 7320 746f 2062 6520 7275  ommands to be ru
-0003bb50: 6e20 636f 6e63 7572 7265 6e74 6c79 2c0a  n concurrently,.
-0003bb60: 2020 2020 2020 2020 7768 6572 6520 4e20          where N 
-0003bb70: 6973 2074 6865 206e 756d 6265 7220 6f66  is the number of
-0003bb80: 2063 6f6c 756d 6e73 2e0a 0a20 2020 2020   columns...     
-0003bb90: 2020 203a 7265 7475 726e 3a20 4c69 7374     :return: List
-0003bba0: 206f 6620 7374 7269 6e67 732c 2077 6865   of strings, whe
-0003bbb0: 7265 2074 6865 2073 7472 696e 6773 2061  re the strings a
-0003bbc0: 7265 2062 6173 6820 636f 6d6d 616e 6473  re bash commands
-0003bbd0: 2074 6f20 7275 6e20 5341 5320 7072 6f63   to run SAS proc
-0003bbe0: 6564 7572 6573 2c20 616e 6f74 6865 720a  edures, another.
-0003bbf0: 2020 2020 2020 2020 2020 2020 6c69 7374              list
-0003bc00: 206f 6620 7374 7269 6e67 732c 2077 6865   of strings, whe
-0003bc10: 7265 2074 6865 2073 7472 696e 6773 2061  re the strings a
-0003bc20: 7265 2065 7870 6563 7465 6420 6f75 7470  re expected outp
-0003bc30: 7574 2074 7970 6573 2066 6f72 2074 6865  ut types for the
-0003bc40: 2063 6f6d 6d61 6e64 732c 2061 206c 6973   commands, a lis
-0003bc50: 7420 6f66 0a20 2020 2020 2020 2020 2020  t of.           
-0003bc60: 206c 6973 7473 206f 6620 7374 7269 6e67   lists of string
-0003bc70: 732c 2077 6865 7265 2074 6865 2073 7472  s, where the str
-0003bc80: 696e 6773 2061 7265 2065 7870 6563 7465  ings are expecte
-0003bc90: 6420 6f75 7470 7574 2070 6174 6873 2066  d output paths f
-0003bca0: 6f72 2070 726f 6475 6374 7320 6f66 2074  or products of t
-0003bcb0: 6865 2053 4153 2063 6f6d 6d61 6e64 732e  he SAS commands.
-0003bcc0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0003bcd0: 2054 7570 6c65 5b4c 6973 745b 7374 725d   Tuple[List[str]
-0003bce0: 2c20 4c69 7374 5b73 7472 5d2c 204c 6973  , List[str], Lis
-0003bcf0: 745b 4c69 7374 5b73 7472 5d5d 5d0a 2020  t[List[str]]].  
-0003bd00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0003bd10: 2020 6966 2073 656c 662e 7175 6575 6520    if self.queue 
-0003bd20: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0003bd30: 2020 2020 2023 2054 6869 7320 7265 7475       # This retu
-0003bd40: 726e 7320 656d 7074 7920 6c69 7374 7320  rns empty lists 
-0003bd50: 6966 2074 6865 2071 7565 7565 2069 7320  if the queue is 
-0003bd60: 756e 6465 6669 6e65 640a 2020 2020 2020  undefined.      
-0003bd70: 2020 2020 2020 7072 6f63 6573 7365 645f        processed_
-0003bd80: 636d 6473 203d 205b 5d0a 2020 2020 2020  cmds = [].      
-0003bd90: 2020 2020 2020 7479 7065 7320 3d20 5b5d        types = []
-0003bda0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0003bdb0: 6873 203d 205b 5d0a 2020 2020 2020 2020  hs = [].        
-0003bdc0: 2020 2020 6578 7472 6173 203d 205b 5d0a      extras = [].
-0003bdd0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
-0003bde0: 2873 656c 662e 7175 6575 652e 7368 6170  (self.queue.shap
-0003bdf0: 6529 203d 3d20 3120 6f72 2073 656c 662e  e) == 1 or self.
-0003be00: 7175 6575 652e 7368 6170 655b 315d 203c  queue.shape[1] <
-0003be10: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0003be20: 2070 726f 6365 7373 6564 5f63 6d64 7320   processed_cmds 
-0003be30: 3d20 6c69 7374 2873 656c 662e 7175 6575  = list(self.queu
-0003be40: 6529 0a20 2020 2020 2020 2020 2020 2074  e).            t
-0003be50: 7970 6573 203d 206c 6973 7428 7365 6c66  ypes = list(self
-0003be60: 2e71 7565 7565 5f74 7970 6529 0a20 2020  .queue_type).   
-0003be70: 2020 2020 2020 2020 2070 6174 6873 203d           paths =
-0003be80: 205b 5b73 7472 2870 6174 6829 5d20 666f   [[str(path)] fo
-0003be90: 7220 7061 7468 2069 6e20 7365 6c66 2e71  r path in self.q
-0003bea0: 7565 7565 5f70 6174 685d 0a20 2020 2020  ueue_path].     
-0003beb0: 2020 2020 2020 2065 7874 7261 7320 3d20         extras = 
-0003bec0: 6c69 7374 2873 656c 662e 7175 6575 655f  list(self.queue_
-0003bed0: 6578 7472 615f 696e 666f 290a 2020 2020  extra_info).    
-0003bee0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0003bef0: 2020 2020 2020 7072 6f63 6573 7365 645f        processed_
-0003bf00: 636d 6473 203d 205b 223b 222e 6a6f 696e  cmds = [";".join
-0003bf10: 2863 6f6c 2920 666f 7220 636f 6c20 696e  (col) for col in
-0003bf20: 2073 656c 662e 7175 6575 652e 545d 0a20   self.queue.T]. 
-0003bf30: 2020 2020 2020 2020 2020 2074 7970 6573             types
-0003bf40: 203d 206c 6973 7428 7365 6c66 2e71 7565   = list(self.que
-0003bf50: 7565 5f74 7970 655b 2d31 2c20 3a5d 290a  ue_type[-1, :]).
-0003bf60: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0003bf70: 7320 3d20 5b6c 6973 7428 636f 6c2e 6173  s = [list(col.as
-0003bf80: 7479 7065 2873 7472 2929 2066 6f72 2063  type(str)) for c
-0003bf90: 6f6c 2069 6e20 7365 6c66 2e71 7565 7565  ol in self.queue
-0003bfa0: 5f70 6174 682e 545d 0a20 2020 2020 2020  _path.T].       
-0003bfb0: 2020 2020 2065 7874 7261 7320 3d20 5b5d       extras = []
-0003bfc0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0003bfd0: 2063 6f6c 2069 6e20 7365 6c66 2e71 7565   col in self.que
-0003bfe0: 7565 5f70 6174 682e 543a 0a20 2020 2020  ue_path.T:.     
-0003bff0: 2020 2020 2020 2020 2020 2023 2054 6869             # Thi
-0003c000: 7320 6e65 7374 6564 2064 6963 7469 6f6e  s nested diction
-0003c010: 6172 7920 636f 6d70 7265 6865 6e73 696f  ary comprehensio
-0003c020: 6e20 636f 6d62 696e 6573 2061 2063 6f6c  n combines a col
-0003c030: 756d 6e20 6f66 2065 7874 7261 2069 6e66  umn of extra inf
-0003c040: 6f72 6d61 7469 6f6e 0a20 2020 2020 2020  ormation.       
-0003c050: 2020 2020 2020 2020 2023 2064 6963 7469           # dicti
-0003c060: 6f6e 6172 6965 7320 696e 746f 206f 6e65  onaries into one
-0003c070: 2c20 666f 7220 6561 7365 206f 6620 6163  , for ease of ac
-0003c080: 6365 7373 2e0a 2020 2020 2020 2020 2020  cess..          
-0003c090: 2020 2020 2020 636f 6d62 5f65 7874 7261        comb_extra
-0003c0a0: 203d 207b 6b3a 2076 2066 6f72 2065 7874   = {k: v for ext
-0003c0b0: 5f64 6963 7420 696e 2063 6f6c 2066 6f72  _dict in col for
-0003c0c0: 206b 2c20 7620 696e 2065 7874 5f64 6963   k, v in ext_dic
-0003c0d0: 742e 6974 656d 7328 297d 0a20 2020 2020  t.items()}.     
-0003c0e0: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-0003c0f0: 732e 6170 7065 6e64 2863 6f6d 625f 6578  s.append(comb_ex
-0003c100: 7472 6129 0a0a 2020 2020 2020 2020 2320  tra)..        # 
-0003c110: 5468 6973 2069 7320 6f6e 6c79 206c 696b  This is only lik
-0003c120: 656c 7920 746f 2062 6520 6361 6c6c 6564  ely to be called
-0003c130: 2077 6865 6e20 7072 6f63 6573 7369 6e67   when processing
-0003c140: 2069 7320 6265 6769 6e6e 696e 672c 2073   is beginning, s
-0003c150: 6f20 7468 6973 2077 696c 6c20 7769 7065  o this will wipe
-0003c160: 2074 6865 2071 7565 7565 2e0a 2020 2020   the queue..    
-0003c170: 2020 2020 7365 6c66 2e71 7565 7565 203d      self.queue =
-0003c180: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-0003c190: 6c66 2e71 7565 7565 5f74 7970 6520 3d20  lf.queue_type = 
-0003c1a0: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
-0003c1b0: 662e 7175 6575 655f 7061 7468 203d 204e  f.queue_path = N
-0003c1c0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-0003c1d0: 2e71 7565 7565 5f65 7874 7261 5f69 6e66  .queue_extra_inf
-0003c1e0: 6f20 3d20 4e6f 6e65 0a20 2020 2020 2020  o = None.       
-0003c1f0: 2023 2054 6865 2072 6574 7572 6e65 6420   # The returned 
-0003c200: 7061 7468 7320 6172 6520 6c69 7374 7320  paths are lists 
-0003c210: 6f66 2073 7472 696e 6773 2062 6563 6175  of strings becau
-0003c220: 7365 2077 6520 7761 6e74 2074 6f20 696e  se we want to in
-0003c230: 636c 7564 6520 6576 6572 7920 6669 6c65  clude every file
-0003c240: 2069 6e20 6120 7374 6163 6b20 746f 2062   in a stack to b
-0003c250: 6520 6162 6c65 0a20 2020 2020 2020 2023  e able.        #
-0003c260: 2074 6f20 6368 6563 6b20 7468 6174 2065   to check that e
-0003c270: 7869 7374 730a 2020 2020 2020 2020 7265  xists.        re
-0003c280: 7475 726e 2070 726f 6365 7373 6564 5f63  turn processed_c
-0003c290: 6d64 732c 2074 7970 6573 2c20 7061 7468  mds, types, path
-0003c2a0: 732c 2065 7874 7261 730a 0a20 2020 2064  s, extras..    d
-0003c2b0: 6566 2075 7064 6174 655f 7072 6f64 7563  ef update_produc
-0003c2c0: 7473 2873 656c 662c 2070 726f 645f 6f62  ts(self, prod_ob
-0003c2d0: 6a3a 2042 6173 6550 726f 6475 6374 293a  j: BaseProduct):
-0003c2e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0003c2f0: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
-0003c300: 2077 696c 6c20 4f4e 4c59 2073 746f 7265   will ONLY store
-0003c310: 2069 6d61 6765 7320 616e 6420 6578 706f   images and expo
-0003c320: 7375 7265 206d 6170 732e 2049 6465 616c  sure maps. Ideal
-0003c330: 6c79 2049 2077 6f75 6c64 6e27 7420 7374  ly I wouldn't st
-0003c340: 6f72 6520 7468 656d 2061 7320 7072 6f64  ore them as prod
-0003c350: 7563 7420 6f62 6a65 6374 730a 2020 2020  uct objects.    
-0003c360: 2020 2020 6174 2061 6c6c 2c20 6275 7420      at all, but 
-0003c370: 756e 666f 7274 756e 6174 656c 7920 6578  unfortunately ex
-0003c380: 706f 7375 7265 206d 6170 7320 7265 7175  posure maps requ
-0003c390: 6972 6520 616e 2069 6d61 6765 2074 6f20  ire an image to 
-0003c3a0: 6265 2067 656e 6572 6174 6564 2e20 556e  be generated. Un
-0003c3b0: 6c69 6b65 2061 6c6c 206f 7468 6572 2073  like all other s
-0003c3c0: 6f75 7263 6520 636c 6173 7365 732c 0a20  ource classes,. 
-0003c3d0: 2020 2020 2020 2072 6174 656d 6170 7320         ratemaps 
-0003c3e0: 7769 6c6c 206e 6f74 2062 6520 6765 6e65  will not be gene
-0003c3f0: 7261 7465 6420 7768 656e 206d 6174 6368  rated when match
-0003c400: 696e 6720 696d 6167 6573 2061 6e64 2065  ing images and e
-0003c410: 7870 6f73 7572 6520 6d61 7073 2061 7265  xposure maps are
-0003c420: 2061 6464 6564 2e0a 0a20 2020 2020 2020   added...       
-0003c430: 203a 7061 7261 6d20 4261 7365 5072 6f64   :param BaseProd
-0003c440: 7563 7420 7072 6f64 5f6f 626a 3a20 5468  uct prod_obj: Th
-0003c450: 6520 6e65 7720 7072 6f64 7563 7420 6f62  e new product ob
-0003c460: 6a65 6374 2074 6f20 6265 2061 6464 6564  ject to be added
-0003c470: 2074 6f20 7468 6520 736f 7572 6365 206f   to the source o
-0003c480: 626a 6563 742e 0a20 2020 2020 2020 2022  bject..        "
-0003c490: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-0003c4a0: 7420 6973 696e 7374 616e 6365 2870 726f  t isinstance(pro
-0003c4b0: 645f 6f62 6a2c 2028 4261 7365 5072 6f64  d_obj, (BaseProd
-0003c4c0: 7563 742c 2042 6173 6541 6767 7265 6761  uct, BaseAggrega
-0003c4d0: 7465 5072 6f64 7563 7429 2920 616e 6420  teProduct)) and 
-0003c4e0: 7072 6f64 5f6f 626a 2069 7320 6e6f 7420  prod_obj is not 
-0003c4f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0003c500: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-0003c510: 7228 224f 6e6c 7920 7072 6f64 7563 7420  r("Only product 
-0003c520: 6f62 6a65 6374 7320 6361 6e20 6265 2061  objects can be a
-0003c530: 7373 6967 6e65 6420 746f 2073 6f75 7263  ssigned to sourc
-0003c540: 6573 2e22 290a 2020 2020 2020 2020 656c  es.").        el
-0003c550: 6966 2070 726f 645f 6f62 6a2e 7479 7065  if prod_obj.type
-0003c560: 2021 3d20 2769 6d61 6765 2720 616e 6420   != 'image' and 
-0003c570: 7072 6f64 5f6f 626a 2e74 7970 6520 213d  prod_obj.type !=
-0003c580: 2027 6578 706d 6170 273a 0a20 2020 2020   'expmap':.     
-0003c590: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-0003c5a0: 6545 7272 6f72 2822 4f6e 6c79 2069 6d61  eError("Only ima
-0003c5b0: 6765 7320 616e 6420 6578 706f 7375 7265  ges and exposure
-0003c5c0: 206d 6170 7320 6361 6e20 6265 2073 746f   maps can be sto
-0003c5d0: 7265 6420 696e 2061 204e 756c 6c53 6f75  red in a NullSou
-0003c5e0: 7263 652c 207b 7d20 6f62 6a65 6374 7320  rce, {} objects 
-0003c5f0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0003c600: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-0003c610: 616e 6e6f 7422 2e66 6f72 6d61 7428 7072  annot".format(pr
-0003c620: 6f64 5f6f 626a 2e74 7970 6529 290a 0a20  od_obj.type)).. 
-0003c630: 2020 2020 2020 2069 6620 7072 6f64 5f6f         if prod_o
-0003c640: 626a 2069 7320 6e6f 7420 4e6f 6e65 3a0a  bj is not None:.
-0003c650: 2020 2020 2020 2020 2020 2020 656e 5f62              en_b
-0003c660: 6e64 7320 3d20 7072 6f64 5f6f 626a 2e65  nds = prod_obj.e
-0003c670: 6e65 7267 795f 626f 756e 6473 0a20 2020  nergy_bounds.   
-0003c680: 2020 2020 2020 2020 2065 7874 7261 5f6b           extra_k
-0003c690: 6579 203d 2022 626f 756e 645f 7b6c 7d2d  ey = "bound_{l}-
-0003c6a0: 7b75 7d22 2e66 6f72 6d61 7428 6c3d 666c  {u}".format(l=fl
-0003c6b0: 6f61 7428 656e 5f62 6e64 735b 305d 2e76  oat(en_bnds[0].v
-0003c6c0: 616c 7565 292c 2075 3d66 6c6f 6174 2865  alue), u=float(e
-0003c6d0: 6e5f 626e 6473 5b31 5d2e 7661 6c75 6529  n_bnds[1].value)
-0003c6e0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0003c6f0: 4173 2074 6865 2065 7874 7261 5f6b 6579  As the extra_key
-0003c700: 2076 6172 6961 626c 6520 6361 6e20 6265   variable can be
-0003c710: 2061 6c74 6572 6564 2069 6620 7468 6520   altered if the 
-0003c720: 496d 6167 6520 6973 2050 5346 2063 6f72  Image is PSF cor
-0003c730: 7265 6374 6564 2c20 4927 6c6c 2061 6c73  rected, I'll als
-0003c740: 6f20 6d61 6b65 0a20 2020 2020 2020 2020  o make.         
-0003c750: 2020 2023 2020 7468 6973 2076 6172 6961     #  this varia
-0003c760: 626c 6520 7769 7468 206a 7573 7420 7468  ble with just th
-0003c770: 6520 656e 6572 6779 206b 6579 0a20 2020  e energy key.   
-0003c780: 2020 2020 2020 2020 2065 6e5f 6b65 7920           en_key 
-0003c790: 3d20 2262 6f75 6e64 5f7b 6c7d 2d7b 757d  = "bound_{l}-{u}
-0003c7a0: 222e 666f 726d 6174 286c 3d66 6c6f 6174  ".format(l=float
-0003c7b0: 2865 6e5f 626e 6473 5b30 5d2e 7661 6c75  (en_bnds[0].valu
-0003c7c0: 6529 2c20 753d 666c 6f61 7428 656e 5f62  e), u=float(en_b
-0003c7d0: 6e64 735b 315d 2e76 616c 7565 2929 0a0a  nds[1].value))..
-0003c7e0: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
-0003c7f0: 636f 6e64 6172 7920 6368 6563 6b69 6e67  condary checking
-0003c800: 2073 7465 7020 6e6f 7720 4927 7665 2061   step now I've a
-0003c810: 6464 6564 2050 5346 2063 6f72 7265 6374  dded PSF correct
-0003c820: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-0003c830: 6966 2074 7970 6528 7072 6f64 5f6f 626a  if type(prod_obj
-0003c840: 2920 3d3d 2049 6d61 6765 2061 6e64 2070  ) == Image and p
-0003c850: 726f 645f 6f62 6a2e 7073 665f 636f 7272  rod_obj.psf_corr
-0003c860: 6563 7465 643a 0a20 2020 2020 2020 2020  ected:.         
-0003c870: 2020 2020 2020 2065 7874 7261 5f6b 6579         extra_key
-0003c880: 202b 3d20 225f 2220 2b20 7072 6f64 5f6f   += "_" + prod_o
-0003c890: 626a 2e70 7366 5f6d 6f64 656c 202b 2022  bj.psf_model + "
-0003c8a0: 5f22 202b 2073 7472 2870 726f 645f 6f62  _" + str(prod_ob
-0003c8b0: 6a2e 7073 665f 6269 6e73 2920 2b20 225f  j.psf_bins) + "_
-0003c8c0: 2220 2b20 7072 6f64 5f6f 626a 2e70 7366  " + prod_obj.psf
-0003c8d0: 5f61 6c67 6f72 6974 686d 202b 205c 0a20  _algorithm + \. 
-0003c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c8f0: 2020 2020 2020 2020 2020 2020 7374 7228              str(
-0003c900: 7072 6f64 5f6f 626a 2e70 7366 5f69 7465  prod_obj.psf_ite
-0003c910: 7261 7469 6f6e 7329 0a0a 2020 2020 2020  rations)..      
-0003c920: 2020 2020 2020 2320 416c 6c20 696e 666f        # All info
-0003c930: 726d 6174 696f 6e20 6162 6f75 7420 7768  rmation about wh
-0003c940: 6572 6520 746f 2070 6c61 6365 2069 7420  ere to place it 
-0003c950: 696e 206f 7572 2073 746f 7261 6765 2068  in our storage h
-0003c960: 6965 7261 7263 6879 2063 616e 2062 6520  ierarchy can be 
-0003c970: 7075 6c6c 6564 2066 726f 6d20 7468 6520  pulled from the 
-0003c980: 7072 6f64 7563 740a 2020 2020 2020 2020  product.        
-0003c990: 2020 2020 2320 6f62 6a65 6374 2069 7473      # object its
-0003c9a0: 656c 660a 2020 2020 2020 2020 2020 2020  elf.            
-0003c9b0: 6f62 735f 6964 203d 2070 726f 645f 6f62  obs_id = prod_ob
-0003c9c0: 6a2e 6f62 735f 6964 0a20 2020 2020 2020  j.obs_id.       
-0003c9d0: 2020 2020 2069 6e73 7420 3d20 7072 6f64       inst = prod
-0003c9e0: 5f6f 626a 2e69 6e73 7472 756d 656e 740a  _obj.instrument.
-0003c9f0: 2020 2020 2020 2020 2020 2020 705f 7479              p_ty
-0003ca00: 7065 203d 2070 726f 645f 6f62 6a2e 7479  pe = prod_obj.ty
-0003ca10: 7065 0a0a 2020 2020 2020 2020 2020 2020  pe..            
-0003ca20: 2320 446f 7562 6c65 2063 6865 636b 2074  # Double check t
-0003ca30: 6861 7420 736f 6d65 7468 696e 6720 6973  hat something is
-0003ca40: 2074 7279 696e 6720 746f 2061 6464 2070   trying to add p
-0003ca50: 726f 6475 6374 7320 6672 6f6d 2061 6e6f  roducts from ano
-0003ca60: 7468 6572 2073 6f75 7263 6520 746f 2074  ther source to t
-0003ca70: 6865 2063 7572 7265 6e74 206f 6e65 2e0a  he current one..
-0003ca80: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0003ca90: 6273 5f69 6420 213d 2022 636f 6d62 696e  bs_id != "combin
-0003caa0: 6564 2220 616e 6420 6f62 735f 6964 206e  ed" and obs_id n
-0003cab0: 6f74 2069 6e20 7365 6c66 2e5f 7072 6f64  ot in self._prod
-0003cac0: 7563 7473 3a0a 2020 2020 2020 2020 2020  ucts:.          
-0003cad0: 2020 2020 2020 7261 6973 6520 4e6f 7441        raise NotA
-0003cae0: 7373 6f63 6961 7465 6445 7272 6f72 2822  ssociatedError("
-0003caf0: 7b6f 7d20 6973 206e 6f74 2061 7373 6f63  {o} is not assoc
-0003cb00: 6961 7465 6420 7769 7468 2074 6869 7320  iated with this 
-0003cb10: 6e75 6c6c 2073 6f75 7263 652e 222e 666f  null source.".fo
-0003cb20: 726d 6174 286f 3d6f 6273 5f69 6429 290a  rmat(o=obs_id)).
-0003cb30: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0003cb40: 2069 6e73 7420 213d 2022 636f 6d62 696e   inst != "combin
-0003cb50: 6564 2220 616e 6420 696e 7374 206e 6f74  ed" and inst not
-0003cb60: 2069 6e20 7365 6c66 2e5f 7072 6f64 7563   in self._produc
-0003cb70: 7473 5b6f 6273 5f69 645d 3a0a 2020 2020  ts[obs_id]:.    
-0003cb80: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0003cb90: 6520 4e6f 7441 7373 6f63 6961 7465 6445  e NotAssociatedE
-0003cba0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0003cbb0: 2020 2020 2020 2020 2020 227b 697d 2069            "{i} i
-0003cbc0: 7320 6e6f 7420 6173 736f 6369 6174 6564  s not associated
-0003cbd0: 2077 6974 6820 584d 4d20 6f62 7365 7276   with XMM observ
-0003cbe0: 6174 696f 6e20 7b6f 7d22 2e66 6f72 6d61  ation {o}".forma
-0003cbf0: 7428 693d 696e 7374 2c20 6f3d 6f62 735f  t(i=inst, o=obs_
-0003cc00: 6964 2929 0a0a 2020 2020 2020 2020 2020  id))..          
-0003cc10: 2020 6966 2065 7874 7261 5f6b 6579 206e    if extra_key n
-0003cc20: 6f74 2069 6e20 7365 6c66 2e5f 7072 6f64  ot in self._prod
-0003cc30: 7563 7473 5b6f 6273 5f69 645d 5b69 6e73  ucts[obs_id][ins
-0003cc40: 745d 3a0a 2020 2020 2020 2020 2020 2020  t]:.            
-0003cc50: 2020 2020 7365 6c66 2e5f 7072 6f64 7563      self._produc
-0003cc60: 7473 5b6f 6273 5f69 645d 5b69 6e73 745d  ts[obs_id][inst]
-0003cc70: 5b65 7874 7261 5f6b 6579 5d20 3d20 7b7d  [extra_key] = {}
-0003cc80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003cc90: 662e 5f70 726f 6475 6374 735b 6f62 735f  f._products[obs_
-0003cca0: 6964 5d5b 696e 7374 5d5b 6578 7472 615f  id][inst][extra_
-0003ccb0: 6b65 795d 5b70 5f74 7970 655d 203d 2070  key][p_type] = p
-0003ccc0: 726f 645f 6f62 6a0a 0a20 2020 2064 6566  rod_obj..    def
-0003ccd0: 2067 6574 5f70 726f 6475 6374 7328 7365   get_products(se
-0003cce0: 6c66 2c20 705f 7479 7065 3a20 7374 722c  lf, p_type: str,
-0003ccf0: 206f 6273 5f69 643a 2073 7472 203d 204e   obs_id: str = N
-0003cd00: 6f6e 652c 2069 6e73 743a 2073 7472 203d  one, inst: str =
-0003cd10: 204e 6f6e 652c 2065 7874 7261 5f6b 6579   None, extra_key
-0003cd20: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
-0003cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cd40: 2020 206a 7573 745f 6f62 6a3a 2062 6f6f     just_obj: boo
-0003cd50: 6c20 3d20 5472 7565 2920 2d3e 204c 6973  l = True) -> Lis
-0003cd60: 745b 4261 7365 5072 6f64 7563 745d 3a0a  t[BaseProduct]:.
-0003cd70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0003cd80: 2020 2020 5468 6973 2069 7320 7468 6520      This is the 
-0003cd90: 6765 7474 6572 2066 6f72 2074 6865 2070  getter for the p
-0003cda0: 726f 6475 6374 7320 6461 7461 2073 7472  roducts data str
-0003cdb0: 7563 7475 7265 206f 6620 536f 7572 6365  ucture of Source
-0003cdc0: 206f 626a 6563 7473 2e20 5061 7373 696e   objects. Passin
-0003cdd0: 6720 6120 2770 726f 6475 6374 2074 7970  g a 'product typ
-0003cde0: 6527 0a20 2020 2020 2020 2073 7563 6820  e'.        such 
-0003cdf0: 6173 2027 6576 656e 7473 2720 6f72 2027  as 'events' or '
-0003ce00: 696d 6167 6573 2720 7769 6c6c 2072 6574  images' will ret
-0003ce10: 7572 6e20 6576 6572 7920 6d61 7463 6869  urn every matchi
-0003ce20: 6e67 2065 6e74 7279 2069 6e20 7468 6520  ng entry in the 
-0003ce30: 7072 6f64 7563 7473 2064 6174 6120 7374  products data st
-0003ce40: 7275 6374 7572 652e 0a0a 2020 2020 2020  ructure...      
-0003ce50: 2020 3a70 6172 616d 2073 7472 2070 5f74    :param str p_t
-0003ce60: 7970 653a 2050 726f 6475 6374 2074 7970  ype: Product typ
-0003ce70: 6520 6964 656e 7469 6669 6572 2e20 652e  e identifier. e.
-0003ce80: 672e 2069 6d61 6765 206f 7220 6578 706d  g. image or expm
-0003ce90: 6170 2e0a 2020 2020 2020 2020 3a70 6172  ap..        :par
-0003cea0: 616d 2073 7472 206f 6273 5f69 643a 204f  am str obs_id: O
-0003ceb0: 7074 696f 6e61 6c6c 792c 2061 2073 7065  ptionally, a spe
-0003cec0: 6369 6669 6320 6f62 735f 6964 2074 6f20  cific obs_id to 
-0003ced0: 7365 6172 6368 2063 616e 2062 6520 7375  search can be su
-0003cee0: 7070 6c69 6564 2e0a 2020 2020 2020 2020  pplied..        
-0003cef0: 3a70 6172 616d 2073 7472 2069 6e73 743a  :param str inst:
-0003cf00: 204f 7074 696f 6e61 6c6c 792c 2061 2073   Optionally, a s
-0003cf10: 7065 6369 6669 6320 696e 7374 7275 6d65  pecific instrume
-0003cf20: 6e74 2074 6f20 7365 6172 6368 2063 616e  nt to search can
-0003cf30: 2062 6520 7375 7070 6c69 6564 2e0a 2020   be supplied..  
-0003cf40: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
-0003cf50: 2065 7874 7261 5f6b 6579 3a20 4f70 7469   extra_key: Opti
-0003cf60: 6f6e 616c 6c79 2c20 616e 2065 7874 7261  onally, an extra
-0003cf70: 206b 6579 2028 6c69 6b65 2061 6e20 656e   key (like an en
-0003cf80: 6572 6779 2062 6f75 6e64 2920 6361 6e20  ergy bound) can 
-0003cf90: 6265 2073 7570 706c 6965 642e 0a20 2020  be supplied..   
-0003cfa0: 2020 2020 203a 7061 7261 6d20 626f 6f6c       :param bool
-0003cfb0: 206a 7573 745f 6f62 6a3a 2041 2062 6f6f   just_obj: A boo
-0003cfc0: 6c65 616e 2066 6c61 6720 7468 6174 2063  lean flag that c
-0003cfd0: 6f6e 7472 6f6c 7320 7768 6574 6865 7220  ontrols whether 
-0003cfe0: 7468 6973 206d 6574 686f 6420 7265 7475  this method retu
-0003cff0: 726e 7320 6a75 7374 2074 6865 2070 726f  rns just the pro
-0003d000: 6475 6374 206f 626a 6563 7473 2c0a 2020  duct objects,.  
-0003d010: 2020 2020 2020 2020 2020 6f72 2074 6865            or the
-0003d020: 206f 7468 6572 2069 6e66 6f72 6d61 7469   other informati
-0003d030: 6f6e 2074 6861 7420 676f 6573 2077 6974  on that goes wit
-0003d040: 6820 6974 206c 696b 6520 4f62 7349 4420  h it like ObsID 
-0003d050: 616e 6420 696e 7374 7275 6d65 6e74 2e0a  and instrument..
-0003d060: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0003d070: 204c 6973 7420 6f66 206d 6174 6368 696e   List of matchin
-0003d080: 6720 7072 6f64 7563 7473 2e0a 2020 2020  g products..    
-0003d090: 2020 2020 3a72 7479 7065 3a20 4c69 7374      :rtype: List
-0003d0a0: 5b42 6173 6550 726f 6475 6374 5d0a 2020  [BaseProduct].  
-0003d0b0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0003d0c0: 2020 2064 6566 2075 6e70 6163 6b5f 6c69     def unpack_li
-0003d0d0: 7374 2874 6f5f 756e 7061 636b 3a20 6c69  st(to_unpack: li
-0003d0e0: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-0003d0f0: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
-0003d100: 2041 2072 6563 7572 7369 7665 2066 756e   A recursive fun
-0003d110: 6374 696f 6e20 746f 2067 6f20 7468 726f  ction to go thro
-0003d120: 7567 6820 6576 6572 7920 6c61 7965 7220  ugh every layer 
-0003d130: 6f66 2061 206e 6573 7465 6420 6c69 7374  of a nested list
-0003d140: 2061 6e64 2066 6c61 7474 656e 2069 7420   and flatten it 
-0003d150: 616c 6c20 6f75 742e 2049 740a 2020 2020  all out. It.    
-0003d160: 2020 2020 2020 2020 646f 6573 6e27 7420          doesn't 
-0003d170: 7265 7475 726e 2061 6e79 7468 696e 6720  return anything 
-0003d180: 6265 6361 7573 6520 746f 206d 616b 6520  because to make 
-0003d190: 6c69 6665 2065 6173 6965 7220 7468 6520  life easier the 
-0003d1a0: 2772 6573 756c 7473 2720 6172 6520 6170  'results' are ap
-0003d1b0: 7065 6e64 6564 2074 6f20 6120 7661 7269  pended to a vari
-0003d1c0: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
-0003d1d0: 2069 6e20 7468 6520 6e61 6d65 7370 6163   in the namespac
-0003d1e0: 6520 6162 6f76 6520 7468 6973 206f 6e65  e above this one
-0003d1f0: 2e0a 0a20 2020 2020 2020 2020 2020 203a  ...            :
-0003d200: 7061 7261 6d20 6c69 7374 2074 6f5f 756e  param list to_un
-0003d210: 7061 636b 3a20 5468 6520 6c69 7374 2074  pack: The list t
-0003d220: 6861 7420 6e65 6564 7320 756e 7061 636b  hat needs unpack
-0003d230: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-0003d240: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
-0003d250: 2023 204d 7573 7420 6974 6572 6174 6520   # Must iterate 
-0003d260: 7468 726f 7567 6820 7468 6520 6769 7665  through the give
-0003d270: 6e20 6c69 7374 0a20 2020 2020 2020 2020  n list.         
-0003d280: 2020 2066 6f72 2065 6e74 7279 2069 6e20     for entry in 
-0003d290: 746f 5f75 6e70 6163 6b3a 0a20 2020 2020  to_unpack:.     
-0003d2a0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0003d2b0: 7468 6520 6375 7272 656e 7420 656c 656d  the current elem
-0003d2c0: 656e 7420 6973 206e 6f74 2061 206c 6973  ent is not a lis
-0003d2d0: 7420 7468 656e 2061 6c6c 2069 7320 6368  t then all is ch
-0003d2e0: 696c 6c2c 2074 6869 7320 656c 656d 656e  ill, this elemen
-0003d2f0: 7420 6973 2072 6561 6479 2066 6f72 2061  t is ready for a
-0003d300: 7070 656e 6469 6e67 0a20 2020 2020 2020  ppending.       
-0003d310: 2020 2020 2020 2020 2023 2074 6f20 7468           # to th
-0003d320: 6520 6669 6e61 6c20 6c69 7374 0a20 2020  e final list.   
-0003d330: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0003d340: 6e6f 7420 6973 696e 7374 616e 6365 2865  not isinstance(e
-0003d350: 6e74 7279 2c20 6c69 7374 293a 0a20 2020  ntry, list):.   
-0003d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d370: 206f 7574 2e61 7070 656e 6428 656e 7472   out.append(entr
-0003d380: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
-0003d390: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003d3a0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-0003d3b0: 6620 7468 6520 6375 7272 656e 7420 656c  f the current el
-0003d3c0: 656d 656e 7420 4953 2061 206c 6973 742c  ement IS a list,
-0003d3d0: 2074 6865 6e20 6f62 7669 6f75 736c 7920   then obviously 
-0003d3e0: 7765 2073 7469 6c6c 2068 6176 6520 6d6f  we still have mo
-0003d3f0: 7265 2075 6e70 6163 6b69 6e67 2074 6f20  re unpacking to 
-0003d400: 646f 2c0a 2020 2020 2020 2020 2020 2020  do,.            
-0003d410: 2020 2020 2020 2020 2320 736f 2077 6520          # so we 
-0003d420: 6361 6c6c 2074 6869 7320 6675 6e63 7469  call this functi
-0003d430: 6f6e 2072 6563 7572 7369 7665 6c79 2e0a  on recursively..
-0003d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d450: 2020 2020 756e 7061 636b 5f6c 6973 7428      unpack_list(
-0003d460: 656e 7472 7929 0a0a 2020 2020 2020 2020  entry)..        
-0003d470: 6966 206f 6273 5f69 6420 6e6f 7420 696e  if obs_id not in
-0003d480: 2073 656c 662e 5f70 726f 6475 6374 7320   self._products 
-0003d490: 616e 6420 6f62 735f 6964 2069 7320 6e6f  and obs_id is no
-0003d4a0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0003d4b0: 2020 2020 7261 6973 6520 4e6f 7441 7373      raise NotAss
-0003d4c0: 6f63 6961 7465 6445 7272 6f72 2822 7b6f  ociatedError("{o
-0003d4d0: 7d20 6973 206e 6f74 2061 7373 6f63 6961  } is not associa
-0003d4e0: 7465 6420 7769 7468 207b 737d 2e22 2e66  ted with {s}.".f
-0003d4f0: 6f72 6d61 7428 6f3d 6f62 735f 6964 2c20  ormat(o=obs_id, 
-0003d500: 733d 7365 6c66 2e6e 616d 6529 290a 2020  s=self.name)).  
-0003d510: 2020 2020 2020 656c 6966 2069 6e73 7420        elif inst 
-0003d520: 6e6f 7420 696e 2058 4d4d 5f49 4e53 5420  not in XMM_INST 
-0003d530: 616e 6420 696e 7374 2069 7320 6e6f 7420  and inst is not 
-0003d540: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0003d550: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0003d560: 6f72 2822 7b7d 2069 7320 6e6f 7420 616e  or("{} is not an
-0003d570: 2061 6c6c 6f77 6564 2069 6e73 7472 756d   allowed instrum
-0003d580: 656e 7422 2e66 6f72 6d61 7428 696e 7374  ent".format(inst
-0003d590: 2929 0a0a 2020 2020 2020 2020 6d61 7463  ))..        matc
-0003d5a0: 6865 7320 3d20 5b5d 0a20 2020 2020 2020  hes = [].       
-0003d5b0: 2023 2049 7465 7261 7465 7320 7468 726f   # Iterates thro
-0003d5c0: 7567 6820 7468 6520 6469 6374 2073 6561  ugh the dict sea
-0003d5d0: 7263 6820 7265 7475 726e 2c20 6275 7420  rch return, but 
-0003d5e0: 6561 6368 206d 6174 6368 2069 7320 6c69  each match is li
-0003d5f0: 6b65 6c79 2074 6f20 6265 2061 2076 6572  kely to be a ver
-0003d600: 7920 6e65 7374 6564 206c 6973 742c 0a20  y nested list,. 
-0003d610: 2020 2020 2020 2023 2077 6974 6820 7468         # with th
-0003d620: 6520 6465 6772 6565 206f 6620 6e65 7374  e degree of nest
-0003d630: 696e 6720 6465 7065 6e64 616e 7420 6f6e  ing dependant on
-0003d640: 2070 726f 6475 6374 2074 7970 6520 2861   product type (a
-0003d650: 7320 6576 656e 7420 6c69 7374 7320 6c69  s event lists li
-0003d660: 7665 2061 206c 6576 656c 2075 7020 6672  ve a level up fr
-0003d670: 6f6d 0a20 2020 2020 2020 2023 2069 6d61  om.        # ima
-0003d680: 6765 7320 666f 7220 696e 7374 616e 6365  ges for instance
-0003d690: 0a20 2020 2020 2020 2066 6f72 206d 6174  .        for mat
-0003d6a0: 6368 2069 6e20 6469 6374 5f73 6561 7263  ch in dict_searc
-0003d6b0: 6828 705f 7479 7065 2c20 7365 6c66 2e5f  h(p_type, self._
-0003d6c0: 7072 6f64 7563 7473 293a 0a20 2020 2020  products):.     
-0003d6d0: 2020 2020 2020 206f 7574 203d 205b 5d0a         out = [].
-0003d6e0: 2020 2020 2020 2020 2020 2020 756e 7061              unpa
-0003d6f0: 636b 5f6c 6973 7428 6d61 7463 6829 0a20  ck_list(match). 
-0003d700: 2020 2020 2020 2020 2020 2023 204f 6e6c             # Onl
-0003d710: 7920 6170 7065 6e64 7320 6966 2074 6869  y appends if thi
-0003d720: 7320 7061 7274 6963 756c 6172 206d 6174  s particular mat
-0003d730: 6368 2069 7320 666f 7220 7468 6520 6f62  ch is for the ob
-0003d740: 735f 6964 2061 6e64 2069 6e73 7472 756d  s_id and instrum
-0003d750: 656e 7420 7061 7373 6564 2074 6f20 7468  ent passed to th
-0003d760: 6973 206d 6574 686f 640a 2020 2020 2020  is method.      
-0003d770: 2020 2020 2020 2320 5468 6f75 6768 2061        # Though a
-0003d780: 6c6c 206d 6174 6368 6573 2077 696c 6c20  ll matches will 
-0003d790: 6265 2072 6574 7572 6e65 6420 6966 206e  be returned if n
-0003d7a0: 6f20 6f62 735f 6964 2f69 6e73 7420 6973  o obs_id/inst is
-0003d7b0: 2070 6173 7365 640a 2020 2020 2020 2020   passed.        
-0003d7c0: 2020 2020 6966 2028 6f62 735f 6964 203d      if (obs_id =
-0003d7d0: 3d20 6f75 745b 305d 206f 7220 6f62 735f  = out[0] or obs_
-0003d7e0: 6964 2069 7320 4e6f 6e65 2920 616e 6420  id is None) and 
-0003d7f0: 2869 6e73 7420 3d3d 206f 7574 5b31 5d20  (inst == out[1] 
-0003d800: 6f72 2069 6e73 7420 6973 204e 6f6e 6529  or inst is None)
-0003d810: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0003d820: 2020 2020 2020 2061 6e64 2028 6578 7472         and (extr
-0003d830: 615f 6b65 7920 696e 206f 7574 206f 7220  a_key in out or 
-0003d840: 6578 7472 615f 6b65 7920 6973 204e 6f6e  extra_key is Non
-0003d850: 6529 2061 6e64 206e 6f74 206a 7573 745f  e) and not just_
-0003d860: 6f62 6a3a 0a20 2020 2020 2020 2020 2020  obj:.           
-0003d870: 2020 2020 206d 6174 6368 6573 2e61 7070       matches.app
-0003d880: 656e 6428 6f75 7429 0a20 2020 2020 2020  end(out).       
-0003d890: 2020 2020 2065 6c69 6620 286f 6273 5f69       elif (obs_i
-0003d8a0: 6420 3d3d 206f 7574 5b30 5d20 6f72 206f  d == out[0] or o
-0003d8b0: 6273 5f69 6420 6973 204e 6f6e 6529 2061  bs_id is None) a
-0003d8c0: 6e64 2028 696e 7374 203d 3d20 6f75 745b  nd (inst == out[
-0003d8d0: 315d 206f 7220 696e 7374 2069 7320 4e6f  1] or inst is No
-0003d8e0: 6e65 2920 5c0a 2020 2020 2020 2020 2020  ne) \.          
-0003d8f0: 2020 2020 2020 2020 2020 616e 6420 2865            and (e
-0003d900: 7874 7261 5f6b 6579 2069 6e20 6f75 7420  xtra_key in out 
-0003d910: 6f72 2065 7874 7261 5f6b 6579 2069 7320  or extra_key is 
-0003d920: 4e6f 6e65 2920 616e 6420 6a75 7374 5f6f  None) and just_o
-0003d930: 626a 3a0a 2020 2020 2020 2020 2020 2020  bj:.            
-0003d940: 2020 2020 6d61 7463 6865 732e 6170 7065      matches.appe
-0003d950: 6e64 286f 7574 5b2d 315d 290a 2020 2020  nd(out[-1]).    
-0003d960: 2020 2020 7265 7475 726e 206d 6174 6368      return match
-0003d970: 6573 0a0a 2020 2020 2320 5468 6973 2069  es..    # This i
-0003d980: 7320 7573 6564 2074 6f20 6e61 6d65 2066  s used to name f
-0003d990: 696c 6573 2061 6e64 2064 6972 6563 746f  iles and directo
-0003d9a0: 7269 6573 2073 6f20 7468 6973 2069 7320  ries so this is 
-0003d9b0: 6e6f 7420 616c 6c6f 7765 6420 746f 2063  not allowed to c
-0003d9c0: 6861 6e67 652e 0a20 2020 2040 7072 6f70  hange..    @prop
-0003d9d0: 6572 7479 0a20 2020 2064 6566 206e 616d  erty.    def nam
-0003d9e0: 6528 7365 6c66 2920 2d3e 2073 7472 3a0a  e(self) -> str:.
-0003d9f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0003da00: 2020 2020 5468 6520 6e61 6d65 206f 6620      The name of 
-0003da10: 7468 6520 736f 7572 6365 2c20 6569 7468  the source, eith
-0003da20: 6572 2067 6976 656e 2061 7420 696e 6974  er given at init
-0003da30: 6961 6c69 7361 7469 6f6e 206f 7220 6765  ialisation or ge
-0003da40: 6e65 7261 7465 6420 6672 6f6d 2074 6865  nerated from the
-0003da50: 2075 7365 722d 7375 7070 6c69 6564 2063   user-supplied c
-0003da60: 6f6f 7264 696e 6174 6573 2e0a 0a20 2020  oordinates...   
-0003da70: 2020 2020 203a 7265 7475 726e 3a20 5468       :return: Th
-0003da80: 6520 6e61 6d65 206f 6620 7468 6520 736f  e name of the so
-0003da90: 7572 6365 2e0a 2020 2020 2020 2020 3a72  urce..        :r
-0003daa0: 7479 7065 3a20 7374 720a 2020 2020 2020  type: str.      
-0003dab0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-0003dac0: 7475 726e 2073 656c 662e 5f6e 616d 650a  turn self._name.
-0003dad0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-0003dae0: 2020 2064 6566 206e 756d 5f70 6e5f 6f62     def num_pn_ob
-0003daf0: 7328 7365 6c66 2920 2d3e 2069 6e74 3a0a  s(self) -> int:.
-0003db00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0003db10: 2020 2020 4765 7474 6572 206d 6574 686f      Getter metho
-0003db20: 6420 7468 6174 2067 6976 6573 2074 6865  d that gives the
-0003db30: 206e 756d 6265 7220 6f66 2050 4e20 6f62   number of PN ob
-0003db40: 7365 7276 6174 696f 6e73 2e0a 0a20 2020  servations...   
-0003db50: 2020 2020 203a 7265 7475 726e 3a20 496e       :return: In
-0003db60: 7465 6765 7220 6e75 6d62 6572 206f 6620  teger number of 
-0003db70: 504e 206f 6273 6572 7661 7469 6f6e 7320  PN observations 
-0003db80: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
-0003db90: 7468 6973 2073 6f75 7263 650a 2020 2020  this source.    
-0003dba0: 2020 2020 3a72 7479 7065 3a20 696e 740a      :rtype: int.
-0003dbb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0003dbc0: 2020 2020 7265 7475 726e 206c 656e 285b      return len([
-0003dbd0: 6f20 666f 7220 6f20 696e 2073 656c 662e  o for o in self.
-0003dbe0: 6f62 735f 6964 7320 6966 2027 706e 2720  obs_ids if 'pn' 
-0003dbf0: 696e 2073 656c 662e 5f70 726f 6475 6374  in self._product
-0003dc00: 735b 6f5d 5d29 0a0a 2020 2020 4070 726f  s[o]])..    @pro
-0003dc10: 7065 7274 790a 2020 2020 6465 6620 6e75  perty.    def nu
-0003dc20: 6d5f 6d6f 7331 5f6f 6273 2873 656c 6629  m_mos1_obs(self)
-0003dc30: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
-0003dc40: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-0003dc50: 7465 7220 6d65 7468 6f64 2074 6861 7420  ter method that 
-0003dc60: 6769 7665 7320 7468 6520 6e75 6d62 6572  gives the number
-0003dc70: 206f 6620 4d4f 5331 206f 6273 6572 7661   of MOS1 observa
-0003dc80: 7469 6f6e 732e 0a0a 2020 2020 2020 2020  tions...        
-0003dc90: 3a72 6574 7572 6e3a 2049 6e74 6567 6572  :return: Integer
-0003dca0: 206e 756d 6265 7220 6f66 204d 4f53 3120   number of MOS1 
-0003dcb0: 6f62 7365 7276 6174 696f 6e73 2061 7373  observations ass
-0003dcc0: 6f63 6961 7465 6420 7769 7468 2074 6869  ociated with thi
-0003dcd0: 7320 736f 7572 6365 0a20 2020 2020 2020  s source.       
-0003dce0: 203a 7274 7970 653a 2069 6e74 0a20 2020   :rtype: int.   
-0003dcf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0003dd00: 2072 6574 7572 6e20 6c65 6e28 5b6f 2066   return len([o f
-0003dd10: 6f72 206f 2069 6e20 7365 6c66 2e6f 6273  or o in self.obs
-0003dd20: 5f69 6473 2069 6620 276d 6f73 3127 2069  _ids if 'mos1' i
-0003dd30: 6e20 7365 6c66 2e5f 7072 6f64 7563 7473  n self._products
-0003dd40: 5b6f 5d5d 290a 0a20 2020 2040 7072 6f70  [o]])..    @prop
-0003dd50: 6572 7479 0a20 2020 2064 6566 206e 756d  erty.    def num
-0003dd60: 5f6d 6f73 325f 6f62 7328 7365 6c66 2920  _mos2_obs(self) 
-0003dd70: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-0003dd80: 2222 220a 2020 2020 2020 2020 4765 7474  """.        Gett
-0003dd90: 6572 206d 6574 686f 6420 7468 6174 2067  er method that g
-0003dda0: 6976 6573 2074 6865 206e 756d 6265 7220  ives the number 
-0003ddb0: 6f66 204d 4f53 3220 6f62 7365 7276 6174  of MOS2 observat
-0003ddc0: 696f 6e73 2e0a 0a20 2020 2020 2020 203a  ions...        :
-0003ddd0: 7265 7475 726e 3a20 496e 7465 6765 7220  return: Integer 
-0003dde0: 6e75 6d62 6572 206f 6620 4d4f 5332 206f  number of MOS2 o
-0003ddf0: 6273 6572 7661 7469 6f6e 7320 6173 736f  bservations asso
-0003de00: 6369 6174 6564 2077 6974 6820 7468 6973  ciated with this
-0003de10: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
-0003de20: 3a72 7479 7065 3a20 696e 740a 2020 2020  :rtype: int.    
-0003de30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0003de40: 7265 7475 726e 206c 656e 285b 6f20 666f  return len([o fo
-0003de50: 7220 6f20 696e 2073 656c 662e 6f62 735f  r o in self.obs_
-0003de60: 6964 7320 6966 2027 6d6f 7332 2720 696e  ids if 'mos2' in
-0003de70: 2073 656c 662e 5f70 726f 6475 6374 735b   self._products[
-0003de80: 6f5d 5d29 0a0a 2020 2020 6465 6620 696e  o]])..    def in
-0003de90: 666f 2873 656c 6629 3a0a 2020 2020 2020  fo(self):.      
-0003dea0: 2020 2222 220a 2020 2020 2020 2020 4a75    """.        Ju
-0003deb0: 7374 2070 7269 6e74 7320 6120 636f 7570  st prints a coup
-0003dec0: 6c65 206f 6620 7069 6563 6573 206f 6620  le of pieces of 
-0003ded0: 696e 666f 726d 6174 696f 6e20 6162 6f75  information abou
-0003dee0: 7420 7468 6520 4e75 6c6c 536f 7572 6365  t the NullSource
-0003def0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0003df00: 2020 2020 2070 7269 6e74 2822 5c6e 2d2d       print("\n--
-0003df10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0003df20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0003df30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0003df40: 2d2d 2d22 290a 2020 2020 2020 2020 7072  ---").        pr
-0003df50: 696e 7428 2253 6f75 7263 6520 4e61 6d65  int("Source Name
-0003df60: 202d 207b 7d22 2e66 6f72 6d61 7428 7365   - {}".format(se
-0003df70: 6c66 2e5f 6e61 6d65 2929 0a20 2020 2020  lf._name)).     
-0003df80: 2020 2070 7269 6e74 2822 584d 4d20 4f62     print("XMM Ob
-0003df90: 7349 4473 202d 207b 7d22 2e66 6f72 6d61  sIDs - {}".forma
-0003dfa0: 7428 7365 6c66 2e5f 5f6c 656e 5f5f 2829  t(self.__len__()
-0003dfb0: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
-0003dfc0: 2822 504e 204f 6273 6572 7661 7469 6f6e  ("PN Observation
-0003dfd0: 7320 2d20 7b7d 222e 666f 726d 6174 2873  s - {}".format(s
-0003dfe0: 656c 662e 6e75 6d5f 706e 5f6f 6273 2929  elf.num_pn_obs))
-0003dff0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-0003e000: 4d4f 5331 204f 6273 6572 7661 7469 6f6e  MOS1 Observation
-0003e010: 7320 2d20 7b7d 222e 666f 726d 6174 2873  s - {}".format(s
-0003e020: 656c 662e 6e75 6d5f 6d6f 7331 5f6f 6273  elf.num_mos1_obs
-0003e030: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
-0003e040: 2822 4d4f 5332 204f 6273 6572 7661 7469  ("MOS2 Observati
-0003e050: 6f6e 7320 2d20 7b7d 222e 666f 726d 6174  ons - {}".format
-0003e060: 2873 656c 662e 6e75 6d5f 6d6f 7332 5f6f  (self.num_mos2_o
-0003e070: 6273 2929 0a20 2020 2020 2020 2070 7269  bs)).        pri
-0003e080: 6e74 2822 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt("------------
+0002ba30: 7374 7220 7073 665f 6d6f 6465 6c3a 2049  str psf_model: I
+0002ba40: 6620 7468 6520 696d 6167 6573 2f72 6174  f the images/rat
+0002ba50: 656d 6170 7320 796f 7520 7761 6e74 2061  emaps you want a
+0002ba60: 7265 2050 5346 2063 6f72 7265 6374 6564  re PSF corrected
+0002ba70: 2c20 7468 6973 2069 7320 7468 6520 5053  , this is the PS
+0002ba80: 4620 6d6f 6465 6c20 7573 6564 2e0a 2020  F model used..  
+0002ba90: 2020 2020 2020 3a70 6172 616d 2069 6e74        :param int
+0002baa0: 2070 7366 5f62 696e 733a 2049 6620 7468   psf_bins: If th
+0002bab0: 6520 696d 6167 6573 2f72 6174 656d 6170  e images/ratemap
+0002bac0: 7320 796f 7520 7761 6e74 2061 7265 2050  s you want are P
+0002bad0: 5346 2063 6f72 7265 6374 6564 2c20 7468  SF corrected, th
+0002bae0: 6973 2069 7320 7468 6520 6e75 6d62 6572  is is the number
+0002baf0: 206f 6620 5053 4673 2070 6572 0a20 2020   of PSFs per.   
+0002bb00: 2020 2020 2020 2020 2073 6964 6520 696e           side in
+0002bb10: 2074 6865 2050 5346 2067 7269 642e 0a20   the PSF grid.. 
+0002bb20: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+0002bb30: 7220 7073 665f 616c 676f 3a20 4966 2074  r psf_algo: If t
+0002bb40: 6865 2069 6d61 6765 732f 7261 7465 6d61  he images/ratema
+0002bb50: 7073 2079 6f75 2077 616e 7420 6172 6520  ps you want are 
+0002bb60: 5053 4620 636f 7272 6563 7465 642c 2074  PSF corrected, t
+0002bb70: 6869 7320 6973 2074 6865 2061 6c67 6f72  his is the algor
+0002bb80: 6974 686d 2075 7365 642e 0a20 2020 2020  ithm used..     
+0002bb90: 2020 203a 7061 7261 6d20 696e 7420 7073     :param int ps
+0002bba0: 665f 6974 6572 3a20 4966 2074 6865 2069  f_iter: If the i
+0002bbb0: 6d61 6765 732f 7261 7465 6d61 7073 2079  mages/ratemaps y
+0002bbc0: 6f75 2077 616e 7420 6172 6520 5053 4620  ou want are PSF 
+0002bbd0: 636f 7272 6563 7465 642c 2074 6869 7320  corrected, this 
+0002bbe0: 6973 2074 6865 206e 756d 6265 7220 6f66  is the number of
+0002bbf0: 2069 7465 7261 7469 6f6e 732e 0a20 2020   iterations..   
+0002bc00: 2020 2020 203a 7265 7475 726e 3a20 416e       :return: An
+0002bc10: 2058 4741 2049 6d61 6765 2f52 6174 654d   XGA Image/RateM
+0002bc20: 6170 2f45 7870 4d61 7020 6f62 6a65 6374  ap/ExpMap object
+0002bc30: 2028 6966 2074 6865 7265 2069 7320 616e   (if there is an
+0002bc40: 2065 7861 6374 206d 6174 6368 292c 206f   exact match), o
+0002bc50: 7220 6120 6c69 7374 206f 6620 5847 410a  r a list of XGA.
+0002bc60: 2020 2020 2020 2020 2020 2020 496d 6167              Imag
+0002bc70: 652f 5261 7465 4d61 702f 4578 704d 6170  e/RateMap/ExpMap
+0002bc80: 206f 626a 6563 7473 2028 6966 2074 6865   objects (if the
+0002bc90: 7265 2077 6572 6520 6d75 6c74 6970 6c65  re were multiple
+0002bca0: 206d 6174 6368 696e 6720 7072 6f64 7563   matching produc
+0002bcb0: 7473 292e 0a20 2020 2020 2020 203a 7274  ts)..        :rt
+0002bcc0: 7970 653a 2055 6e69 6f6e 5b49 6d61 6765  ype: Union[Image
+0002bcd0: 2c20 4578 704d 6170 2c20 5261 7465 4d61  , ExpMap, RateMa
+0002bce0: 702c 204c 6973 745b 496d 6167 655d 2c20  p, List[Image], 
+0002bcf0: 4c69 7374 5b45 7870 4d61 705d 2c20 4c69  List[ExpMap], Li
+0002bd00: 7374 5b52 6174 654d 6170 5d5d 0a20 2020  st[RateMap]].   
+0002bd10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0002bd20: 2023 2043 6865 636b 7320 746f 206d 616b   # Checks to mak
+0002bd30: 6520 7375 7265 2074 6861 7420 616e 2061  e sure that an a
+0002bd40: 6c6c 6f77 6564 2063 6f6d 6269 6e61 7469  llowed combinati
+0002bd50: 6f6e 206f 6620 6c6f 5f65 6e20 616e 6420  on of lo_en and 
+0002bd60: 6869 5f65 6e20 6861 7320 6265 656e 2070  hi_en has been p
+0002bd70: 6173 7365 642e 0a20 2020 2020 2020 2069  assed..        i
+0002bd80: 6620 616c 6c28 5b6c 6f5f 656e 2069 7320  f all([lo_en is 
+0002bd90: 4e6f 6e65 2c20 6869 5f65 6e20 6973 204e  None, hi_en is N
+0002bda0: 6f6e 655d 293a 0a20 2020 2020 2020 2020  one]):.         
+0002bdb0: 2020 2023 2053 6574 7320 6120 666c 6167     # Sets a flag
+0002bdc0: 2074 6f20 7465 6c6c 2074 6865 2072 6573   to tell the res
+0002bdd0: 7420 6f66 2074 6865 206d 6574 686f 6420  t of the method 
+0002bde0: 7768 6574 6865 7220 7765 2068 6176 6520  whether we have 
+0002bdf0: 656e 6572 6779 206c 696d 7320 6f72 206e  energy lims or n
+0002be00: 6f74 0a20 2020 2020 2020 2020 2020 2077  ot.            w
+0002be10: 6974 685f 6c69 6d73 203d 2046 616c 7365  ith_lims = False
+0002be20: 0a20 2020 2020 2020 2020 2020 2065 6e65  .            ene
+0002be30: 7267 795f 6b65 7920 3d20 4e6f 6e65 0a20  rgy_key = None. 
+0002be40: 2020 2020 2020 2065 6c69 6620 616c 6c28         elif all(
+0002be50: 5b6c 6f5f 656e 2069 7320 6e6f 7420 4e6f  [lo_en is not No
+0002be60: 6e65 2c20 6869 5f65 6e20 6973 206e 6f74  ne, hi_en is not
+0002be70: 204e 6f6e 655d 293a 0a20 2020 2020 2020   None]):.       
+0002be80: 2020 2020 2077 6974 685f 6c69 6d73 203d       with_lims =
+0002be90: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+0002bea0: 2020 2320 5765 2068 6176 6520 656e 6572    # We have ener
+0002beb0: 6779 206c 696d 6974 7320 6865 7265 2073  gy limits here s
+0002bec0: 6f20 7765 2061 7373 656d 626c 6520 7468  o we assemble th
+0002bed0: 6520 6b65 7920 7468 6174 2064 6573 6372  e key that descr
+0002bee0: 6962 6573 2074 6865 2065 6e65 7267 7920  ibes the energy 
+0002bef0: 7261 6e67 650a 2020 2020 2020 2020 2020  range.          
+0002bf00: 2020 656e 6572 6779 5f6b 6579 203d 2022    energy_key = "
+0002bf10: 626f 756e 645f 7b6c 7d2d 7b68 7d22 2e66  bound_{l}-{h}".f
+0002bf20: 6f72 6d61 7428 6c3d 6c6f 5f65 6e2e 746f  ormat(l=lo_en.to
+0002bf30: 2827 6b65 5627 292e 7661 6c75 652c 2068  ('keV').value, h
+0002bf40: 3d68 695f 656e 2e74 6f28 276b 6556 2729  =hi_en.to('keV')
+0002bf50: 2e76 616c 7565 290a 2020 2020 2020 2020  .value).        
+0002bf60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002bf70: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0002bf80: 6f72 2822 6c6f 5f65 6e20 616e 6420 6869  or("lo_en and hi
+0002bf90: 5f65 6e20 6d75 7374 2062 6520 6569 7468  _en must be eith
+0002bfa0: 6572 2042 4f54 4820 4e6f 6e65 206f 7220  er BOTH None or 
+0002bfb0: 424f 5448 2061 6e20 4173 7472 6f70 7920  BOTH an Astropy 
+0002bfc0: 7175 616e 7469 7479 2e22 290a 0a20 2020  quantity.")..   
+0002bfd0: 2020 2020 2023 2049 6620 7765 2061 7265       # If we are
+0002bfe0: 206c 6f6f 6b69 6e67 2066 6f72 2061 2050   looking for a P
+0002bff0: 5346 2063 6f72 7265 6374 6564 2069 6d61  SF corrected ima
+0002c000: 6765 2f72 6174 656d 6170 2074 6865 6e20  ge/ratemap then 
+0002c010: 7765 2061 7373 656d 626c 6520 7468 6520  we assemble the 
+0002c020: 6578 7472 6120 6b65 7920 7769 7468 2050  extra key with P
+0002c030: 5346 2064 6574 6169 6c73 0a20 2020 2020  SF details.     
+0002c040: 2020 2069 6620 7073 665f 636f 7272 2061     if psf_corr a
+0002c050: 6e64 2070 726f 645f 7479 7065 2069 6e20  nd prod_type in 
+0002c060: 5b22 696d 6167 6522 2c20 2272 6174 656d  ["image", "ratem
+0002c070: 6170 225d 3a0a 2020 2020 2020 2020 2020  ap"]:.          
+0002c080: 2020 6578 7472 615f 6b65 7920 3d20 225f    extra_key = "_
+0002c090: 2220 2b20 7073 665f 6d6f 6465 6c20 2b20  " + psf_model + 
+0002c0a0: 225f 2220 2b20 7374 7228 7073 665f 6269  "_" + str(psf_bi
+0002c0b0: 6e73 2920 2b20 225f 2220 2b20 7073 665f  ns) + "_" + psf_
+0002c0c0: 616c 676f 202b 2073 7472 2870 7366 5f69  algo + str(psf_i
+0002c0d0: 7465 7229 0a0a 2020 2020 2020 2020 6966  ter)..        if
+0002c0e0: 206e 6f74 2070 7366 5f63 6f72 7220 616e   not psf_corr an
+0002c0f0: 6420 7769 7468 5f6c 696d 733a 0a20 2020  d with_lims:.   
+0002c100: 2020 2020 2020 2020 2023 2053 696d 706c           # Simpl
+0002c110: 6573 7420 6361 7365 2c20 6a75 7374 2063  est case, just c
+0002c120: 616c 6c69 6e67 2067 6574 5f70 726f 6475  alling get_produ
+0002c130: 6374 7320 616e 6420 7061 7373 696e 6720  cts and passing 
+0002c140: 696e 206f 7572 2069 6e66 6f72 6d61 7469  in our informati
+0002c150: 6f6e 0a20 2020 2020 2020 2020 2020 206d  on.            m
+0002c160: 6174 6368 6564 5f70 726f 6473 203d 2073  atched_prods = s
+0002c170: 656c 662e 6765 745f 7072 6f64 7563 7473  elf.get_products
+0002c180: 2870 726f 645f 7479 7065 2c20 6f62 735f  (prod_type, obs_
+0002c190: 6964 2c20 696e 7374 2c20 6578 7472 615f  id, inst, extra_
+0002c1a0: 6b65 793d 656e 6572 6779 5f6b 6579 290a  key=energy_key).
+0002c1b0: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+0002c1c0: 2070 7366 5f63 6f72 7220 616e 6420 6e6f   psf_corr and no
+0002c1d0: 7420 7769 7468 5f6c 696d 733a 0a20 2020  t with_lims:.   
+0002c1e0: 2020 2020 2020 2020 2062 726f 6164 5f6d           broad_m
+0002c1f0: 6174 6368 6573 203d 2073 656c 662e 6765  atches = self.ge
+0002c200: 745f 7072 6f64 7563 7473 2870 726f 645f  t_products(prod_
+0002c210: 7479 7065 2c20 6f62 735f 6964 2c20 696e  type, obs_id, in
+0002c220: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
+0002c230: 6d61 7463 6865 645f 7072 6f64 7320 3d20  matched_prods = 
+0002c240: 5b70 2066 6f72 2070 2069 6e20 6272 6f61  [p for p in broa
+0002c250: 645f 6d61 7463 6865 7320 6966 206e 6f74  d_matches if not
+0002c260: 2070 2e70 7366 5f63 6f72 7265 6374 6564   p.psf_corrected
+0002c270: 5d0a 2020 2020 2020 2020 656c 6966 2070  ].        elif p
+0002c280: 7366 5f63 6f72 7220 616e 6420 7769 7468  sf_corr and with
+0002c290: 5f6c 696d 733a 0a20 2020 2020 2020 2020  _lims:.         
+0002c2a0: 2020 2023 2048 6572 6520 7765 206e 6565     # Here we nee
+0002c2b0: 6420 746f 2061 6464 2074 6865 2065 7874  d to add the ext
+0002c2c0: 7261 206b 6579 2074 6f20 7468 6520 656e  ra key to the en
+0002c2d0: 6572 6779 206b 6579 0a20 2020 2020 2020  ergy key.       
+0002c2e0: 2020 2020 206d 6174 6368 6564 5f70 726f       matched_pro
+0002c2f0: 6473 203d 2073 656c 662e 6765 745f 7072  ds = self.get_pr
+0002c300: 6f64 7563 7473 2870 726f 645f 7479 7065  oducts(prod_type
+0002c310: 2c20 6f62 735f 6964 2c20 696e 7374 2c20  , obs_id, inst, 
+0002c320: 6578 7472 615f 6b65 793d 656e 6572 6779  extra_key=energy
+0002c330: 5f6b 6579 202b 2065 7874 7261 5f6b 6579  _key + extra_key
+0002c340: 290a 2020 2020 2020 2020 656c 6966 2070  ).        elif p
+0002c350: 7366 5f63 6f72 7220 616e 6420 6e6f 7420  sf_corr and not 
+0002c360: 7769 7468 5f6c 696d 733a 0a20 2020 2020  with_lims:.     
+0002c370: 2020 2020 2020 2023 2048 6572 6520 7765         # Here we
+0002c380: 2064 6f6e 2774 206b 6e6f 7720 7468 6520   don't know the 
+0002c390: 656e 6572 6779 206b 6579 2c20 736f 2077  energy key, so w
+0002c3a0: 6520 6861 7665 2074 6f20 6c6f 6f6b 2066  e have to look f
+0002c3b0: 6f72 2070 6172 7469 616c 206d 6174 6368  or partial match
+0002c3c0: 6573 2069 6e20 7468 6520 6765 745f 7072  es in the get_pr
+0002c3d0: 6f64 7563 7473 2072 6574 7572 6e0a 2020  oducts return.  
+0002c3e0: 2020 2020 2020 2020 2020 6272 6f61 645f            broad_
+0002c3f0: 6d61 7463 6865 7320 3d20 7365 6c66 2e67  matches = self.g
+0002c400: 6574 5f70 726f 6475 6374 7328 7072 6f64  et_products(prod
+0002c410: 5f74 7970 652c 206f 6273 5f69 642c 2069  _type, obs_id, i
+0002c420: 6e73 742c 2065 7874 7261 5f6b 6579 3d4e  nst, extra_key=N
+0002c430: 6f6e 652c 206a 7573 745f 6f62 6a3d 4661  one, just_obj=Fa
+0002c440: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+0002c450: 206d 6174 6368 6564 5f70 726f 6473 203d   matched_prods =
+0002c460: 205b 705b 2d31 5d20 666f 7220 7020 696e   [p[-1] for p in
+0002c470: 2062 726f 6164 5f6d 6174 6368 6573 2069   broad_matches i
+0002c480: 6620 6578 7472 615f 6b65 7920 696e 2070  f extra_key in p
+0002c490: 5b2d 325d 5d0a 0a20 2020 2020 2020 2069  [-2]]..        i
+0002c4a0: 6620 6c65 6e28 6d61 7463 6865 645f 7072  f len(matched_pr
+0002c4b0: 6f64 7329 203d 3d20 313a 0a20 2020 2020  ods) == 1:.     
+0002c4c0: 2020 2020 2020 206d 6174 6368 6564 5f70         matched_p
+0002c4d0: 726f 6473 203d 206d 6174 6368 6564 5f70  rods = matched_p
+0002c4e0: 726f 6473 5b30 5d0a 2020 2020 2020 2020  rods[0].        
+0002c4f0: 656c 6966 206c 656e 286d 6174 6368 6564  elif len(matched
+0002c500: 5f70 726f 6473 2920 3d3d 2030 3a0a 2020  _prods) == 0:.  
+0002c510: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0002c520: 4e6f 5072 6f64 7563 7441 7661 696c 6162  NoProductAvailab
+0002c530: 6c65 4572 726f 7228 2243 616e 6e6f 7420  leError("Cannot 
+0002c540: 6669 6e64 2061 6e79 207b 707d 7320 6d61  find any {p}s ma
+0002c550: 7463 6869 6e67 2079 6f75 7220 696e 7075  tching your inpu
+0002c560: 742e 222e 666f 726d 6174 2870 3d70 726f  t.".format(p=pro
+0002c570: 645f 7479 7065 2929 0a0a 2020 2020 2020  d_type))..      
+0002c580: 2020 7265 7475 726e 206d 6174 6368 6564    return matched
+0002c590: 5f70 726f 6473 0a0a 2020 2020 6465 6620  _prods..    def 
+0002c5a0: 6765 745f 696d 6167 6573 2873 656c 662c  get_images(self,
+0002c5b0: 206f 6273 5f69 643a 2073 7472 203d 204e   obs_id: str = N
+0002c5c0: 6f6e 652c 2069 6e73 743a 2073 7472 203d  one, inst: str =
+0002c5d0: 204e 6f6e 652c 206c 6f5f 656e 3a20 5175   None, lo_en: Qu
+0002c5e0: 616e 7469 7479 203d 204e 6f6e 652c 2068  antity = None, h
+0002c5f0: 695f 656e 3a20 5175 616e 7469 7479 203d  i_en: Quantity =
+0002c600: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+0002c610: 2020 2020 2020 2020 2020 7073 665f 636f            psf_co
+0002c620: 7272 3a20 626f 6f6c 203d 2046 616c 7365  rr: bool = False
+0002c630: 2c20 7073 665f 6d6f 6465 6c3a 2073 7472  , psf_model: str
+0002c640: 203d 2022 454c 4c42 4554 4122 2c20 7073   = "ELLBETA", ps
+0002c650: 665f 6269 6e73 3a20 696e 7420 3d20 342c  f_bins: int = 4,
+0002c660: 2070 7366 5f61 6c67 6f3a 2073 7472 203d   psf_algo: str =
+0002c670: 2022 726c 222c 0a20 2020 2020 2020 2020   "rl",.         
+0002c680: 2020 2020 2020 2020 2020 7073 665f 6974            psf_it
+0002c690: 6572 3a20 696e 7420 3d20 3135 2920 2d3e  er: int = 15) ->
+0002c6a0: 2055 6e69 6f6e 5b49 6d61 6765 2c20 4c69   Union[Image, Li
+0002c6b0: 7374 5b49 6d61 6765 5d5d 3a0a 2020 2020  st[Image]]:.    
+0002c6c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0002c6d0: 4120 6d65 7468 6f64 2074 6f20 7265 7472  A method to retr
+0002c6e0: 6965 7665 2058 4741 2049 6d61 6765 206f  ieve XGA Image o
+0002c6f0: 626a 6563 7473 2e20 5468 6973 2073 7570  bjects. This sup
+0002c700: 706f 7274 7320 7468 6520 7265 7472 6965  ports the retrie
+0002c710: 7661 6c20 6f66 2062 6f74 6820 5053 4620  val of both PSF 
+0002c720: 636f 7272 6563 7465 6420 616e 6420 6e6f  corrected and no
+0002c730: 6e2d 5053 460a 2020 2020 2020 2020 636f  n-PSF.        co
+0002c740: 7272 6563 7465 6420 696d 6167 6573 2c20  rrected images, 
+0002c750: 6173 2077 656c 6c20 6173 2073 6574 7469  as well as setti
+0002c760: 6e67 2074 6865 2065 6e65 7267 7920 6c69  ng the energy li
+0002c770: 6d69 7473 206f 6620 7468 6520 7370 6563  mits of the spec
+0002c780: 6966 6963 2069 6d61 6765 2079 6f75 2077  ific image you w
+0002c790: 6f75 6c64 206c 696b 652e 2041 0a20 2020  ould like. A.   
+0002c7a0: 2020 2020 204e 6f50 726f 6475 6374 4176       NoProductAv
+0002c7b0: 6169 6c61 626c 6545 7272 6f72 2065 7272  ailableError err
+0002c7c0: 6f72 2077 696c 6c20 6265 2072 6169 7365  or will be raise
+0002c7d0: 6420 6966 206e 6f20 6d61 7463 6865 7320  d if no matches 
+0002c7e0: 6172 6520 666f 756e 642e 0a0a 2020 2020  are found...    
+0002c7f0: 2020 2020 3a70 6172 616d 2073 7472 206f      :param str o
+0002c800: 6273 5f69 643a 204f 7074 696f 6e61 6c6c  bs_id: Optionall
+0002c810: 792c 2061 2073 7065 6369 6669 6320 6f62  y, a specific ob
+0002c820: 735f 6964 2074 6f20 7365 6172 6368 2066  s_id to search f
+0002c830: 6f72 2063 616e 2062 6520 7375 7070 6c69  or can be suppli
+0002c840: 6564 2e20 5468 6520 6465 6661 756c 7420  ed. The default 
+0002c850: 6973 204e 6f6e 652c 0a20 2020 2020 2020  is None,.       
+0002c860: 2020 2020 2077 6869 6368 206d 6561 6e73       which means
+0002c870: 2061 6c6c 2069 6d61 6765 7320 6d61 7463   all images matc
+0002c880: 6869 6e67 2074 6865 206f 7468 6572 2063  hing the other c
+0002c890: 7269 7465 7269 6120 7769 6c6c 2062 6520  riteria will be 
+0002c8a0: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+0002c8b0: 2020 3a70 6172 616d 2073 7472 2069 6e73    :param str ins
+0002c8c0: 743a 204f 7074 696f 6e61 6c6c 792c 2061  t: Optionally, a
+0002c8d0: 2073 7065 6369 6669 6320 696e 7374 7275   specific instru
+0002c8e0: 6d65 6e74 2074 6f20 7365 6172 6368 2066  ment to search f
+0002c8f0: 6f72 2063 616e 2062 6520 7375 7070 6c69  or can be suppli
+0002c900: 6564 2e20 5468 6520 6465 6661 756c 7420  ed. The default 
+0002c910: 6973 204e 6f6e 652c 0a20 2020 2020 2020  is None,.       
+0002c920: 2020 2020 2077 6869 6368 206d 6561 6e73       which means
+0002c930: 2061 6c6c 2069 6d61 6765 7320 6d61 7463   all images matc
+0002c940: 6869 6e67 2074 6865 206f 7468 6572 2063  hing the other c
+0002c950: 7269 7465 7269 6120 7769 6c6c 2062 6520  riteria will be 
+0002c960: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+0002c970: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
+0002c980: 7920 6c6f 5f65 6e3a 2054 6865 206c 6f77  y lo_en: The low
+0002c990: 6572 2065 6e65 7267 7920 6c69 6d69 7420  er energy limit 
+0002c9a0: 6f66 2074 6865 2069 6d61 6765 2079 6f75  of the image you
+0002c9b0: 2077 6973 6820 746f 2072 6574 7269 6576   wish to retriev
+0002c9c0: 652c 2074 6865 2064 6566 6175 6c74 0a20  e, the default. 
+0002c9d0: 2020 2020 2020 2020 2020 2069 7320 4e6f             is No
+0002c9e0: 6e65 2028 7768 6963 6820 7769 6c6c 2072  ne (which will r
+0002c9f0: 6574 7269 6576 6520 616c 6c20 696d 6167  etrieve all imag
+0002ca00: 6573 2072 6567 6172 646c 6573 7320 6f66  es regardless of
+0002ca10: 2065 6e65 7267 7920 6c69 6d69 7429 2e0a   energy limit)..
+0002ca20: 2020 2020 2020 2020 3a70 6172 616d 2051          :param Q
+0002ca30: 7561 6e74 6974 7920 6869 5f65 6e3a 2054  uantity hi_en: T
+0002ca40: 6865 2075 7070 6572 2065 6e65 7267 7920  he upper energy 
+0002ca50: 6c69 6d69 7420 6f66 2074 6865 2069 6d61  limit of the ima
+0002ca60: 6765 2079 6f75 2077 6973 6820 746f 2072  ge you wish to r
+0002ca70: 6574 7269 6576 652c 2074 6865 2064 6566  etrieve, the def
+0002ca80: 6175 6c74 0a20 2020 2020 2020 2020 2020  ault.           
+0002ca90: 2069 7320 4e6f 6e65 2028 7768 6963 6820   is None (which 
+0002caa0: 7769 6c6c 2072 6574 7269 6576 6520 616c  will retrieve al
+0002cab0: 6c20 696d 6167 6573 2072 6567 6172 646c  l images regardl
+0002cac0: 6573 7320 6f66 2065 6e65 7267 7920 6c69  ess of energy li
+0002cad0: 6d69 7429 2e0a 2020 2020 2020 2020 3a70  mit)..        :p
+0002cae0: 6172 616d 2062 6f6f 6c20 7073 665f 636f  aram bool psf_co
+0002caf0: 7272 3a20 5365 7473 2077 6865 7468 6572  rr: Sets whether
+0002cb00: 2079 6f75 2077 6973 6820 746f 2072 6574   you wish to ret
+0002cb10: 7269 6576 6520 6120 5053 4620 636f 7272  rieve a PSF corr
+0002cb20: 6563 7465 6420 696d 6167 6520 6f72 206e  ected image or n
+0002cb30: 6f74 2e0a 2020 2020 2020 2020 3a70 6172  ot..        :par
+0002cb40: 616d 2073 7472 2070 7366 5f6d 6f64 656c  am str psf_model
+0002cb50: 3a20 4966 2074 6865 2069 6d61 6765 2079  : If the image y
+0002cb60: 6f75 2077 616e 7420 6973 2050 5346 2063  ou want is PSF c
+0002cb70: 6f72 7265 6374 6564 2c20 7468 6973 2069  orrected, this i
+0002cb80: 7320 7468 6520 5053 4620 6d6f 6465 6c20  s the PSF model 
+0002cb90: 7573 6564 2e0a 2020 2020 2020 2020 3a70  used..        :p
+0002cba0: 6172 616d 2069 6e74 2070 7366 5f62 696e  aram int psf_bin
+0002cbb0: 733a 2049 6620 7468 6520 696d 6167 6520  s: If the image 
+0002cbc0: 796f 7520 7761 6e74 2069 7320 5053 4620  you want is PSF 
+0002cbd0: 636f 7272 6563 7465 642c 2074 6869 7320  corrected, this 
+0002cbe0: 6973 2074 6865 206e 756d 6265 7220 6f66  is the number of
+0002cbf0: 2050 5346 7320 7065 720a 2020 2020 2020   PSFs per.      
+0002cc00: 2020 2020 2020 7369 6465 2069 6e20 7468        side in th
+0002cc10: 6520 5053 4620 6772 6964 2e0a 2020 2020  e PSF grid..    
+0002cc20: 2020 2020 3a70 6172 616d 2073 7472 2070      :param str p
+0002cc30: 7366 5f61 6c67 6f3a 2049 6620 7468 6520  sf_algo: If the 
+0002cc40: 696d 6167 6520 796f 7520 7761 6e74 2069  image you want i
+0002cc50: 7320 5053 4620 636f 7272 6563 7465 642c  s PSF corrected,
+0002cc60: 2074 6869 7320 6973 2074 6865 2061 6c67   this is the alg
+0002cc70: 6f72 6974 686d 2075 7365 642e 0a20 2020  orithm used..   
+0002cc80: 2020 2020 203a 7061 7261 6d20 696e 7420       :param int 
+0002cc90: 7073 665f 6974 6572 3a20 4966 2074 6865  psf_iter: If the
+0002cca0: 2069 6d61 6765 2079 6f75 2077 616e 7420   image you want 
+0002ccb0: 6973 2050 5346 2063 6f72 7265 6374 6564  is PSF corrected
+0002ccc0: 2c20 7468 6973 2069 7320 7468 6520 6e75  , this is the nu
+0002ccd0: 6d62 6572 206f 6620 6974 6572 6174 696f  mber of iteratio
+0002cce0: 6e73 2e0a 2020 2020 2020 2020 3a72 6574  ns..        :ret
+0002ccf0: 7572 6e3a 2041 6e20 5847 4120 496d 6167  urn: An XGA Imag
+0002cd00: 6520 6f62 6a65 6374 2028 6966 2074 6865  e object (if the
+0002cd10: 7265 2069 7320 616e 2065 7861 6374 206d  re is an exact m
+0002cd20: 6174 6368 292c 206f 7220 6120 6c69 7374  atch), or a list
+0002cd30: 206f 6620 5847 4120 496d 6167 6520 6f62   of XGA Image ob
+0002cd40: 6a65 6374 7320 2869 6620 7468 6572 650a  jects (if there.
+0002cd50: 2020 2020 2020 2020 2020 2020 7765 7265              were
+0002cd60: 206d 756c 7469 706c 6520 6d61 7463 6869   multiple matchi
+0002cd70: 6e67 2070 726f 6475 6374 7329 2e0a 2020  ng products)..  
+0002cd80: 2020 2020 2020 3a72 7479 7065 3a20 556e        :rtype: Un
+0002cd90: 696f 6e5b 496d 6167 652c 204c 6973 745b  ion[Image, List[
+0002cda0: 496d 6167 655d 5d0a 2020 2020 2020 2020  Image]].        
+0002cdb0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0002cdc0: 726e 2073 656c 662e 5f67 6574 5f70 686f  rn self._get_pho
+0002cdd0: 745f 7072 6f64 2822 696d 6167 6522 2c20  t_prod("image", 
+0002cde0: 6f62 735f 6964 2c20 696e 7374 2c20 6c6f  obs_id, inst, lo
+0002cdf0: 5f65 6e2c 2068 695f 656e 2c20 7073 665f  _en, hi_en, psf_
+0002ce00: 636f 7272 2c20 7073 665f 6d6f 6465 6c2c  corr, psf_model,
+0002ce10: 2070 7366 5f62 696e 732c 2070 7366 5f61   psf_bins, psf_a
+0002ce20: 6c67 6f2c 0a20 2020 2020 2020 2020 2020  lgo,.           
+0002ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce40: 2020 2020 2020 2020 7073 665f 6974 6572          psf_iter
+0002ce50: 290a 0a20 2020 2064 6566 2067 6574 5f65  )..    def get_e
+0002ce60: 7870 6d61 7073 2873 656c 662c 206f 6273  xpmaps(self, obs
+0002ce70: 5f69 643a 2073 7472 203d 204e 6f6e 652c  _id: str = None,
+0002ce80: 2069 6e73 743a 2073 7472 203d 204e 6f6e   inst: str = Non
+0002ce90: 652c 206c 6f5f 656e 3a20 5175 616e 7469  e, lo_en: Quanti
+0002cea0: 7479 203d 204e 6f6e 652c 2068 695f 656e  ty = None, hi_en
+0002ceb0: 3a20 5175 616e 7469 7479 203d 204e 6f6e  : Quantity = Non
+0002cec0: 6529 205c 0a20 2020 2020 2020 2020 2020  e) \.           
+0002ced0: 202d 3e20 556e 696f 6e5b 4578 704d 6170   -> Union[ExpMap
+0002cee0: 2c20 4c69 7374 5b45 7870 4d61 705d 5d3a  , List[ExpMap]]:
+0002cef0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0002cf00: 2020 2020 2041 206d 6574 686f 6420 746f       A method to
+0002cf10: 2072 6574 7269 6576 6520 5847 4120 4578   retrieve XGA Ex
+0002cf20: 704d 6170 206f 626a 6563 7473 2e20 5468  pMap objects. Th
+0002cf30: 6973 2073 7570 706f 7274 7320 7365 7474  is supports sett
+0002cf40: 696e 6720 7468 6520 656e 6572 6779 206c  ing the energy l
+0002cf50: 696d 6974 7320 6f66 2074 6865 2073 7065  imits of the spe
+0002cf60: 6369 6669 630a 2020 2020 2020 2020 6578  cific.        ex
+0002cf70: 706f 7375 7265 206d 6170 7320 796f 7520  posure maps you 
+0002cf80: 776f 756c 6420 6c69 6b65 2e20 4120 4e6f  would like. A No
+0002cf90: 5072 6f64 7563 7441 7661 696c 6162 6c65  ProductAvailable
+0002cfa0: 4572 726f 7220 6572 726f 7220 7769 6c6c  Error error will
+0002cfb0: 2062 6520 7261 6973 6564 2069 6620 6e6f   be raised if no
+0002cfc0: 206d 6174 6368 6573 2061 7265 2066 6f75   matches are fou
+0002cfd0: 6e64 2e0a 0a20 2020 2020 2020 203a 7061  nd...        :pa
+0002cfe0: 7261 6d20 7374 7220 6f62 735f 6964 3a20  ram str obs_id: 
+0002cff0: 4f70 7469 6f6e 616c 6c79 2c20 6120 7370  Optionally, a sp
+0002d000: 6563 6966 6963 206f 6273 5f69 6420 746f  ecific obs_id to
+0002d010: 2073 6561 7263 6820 666f 7220 6361 6e20   search for can 
+0002d020: 6265 2073 7570 706c 6965 642e 2054 6865  be supplied. The
+0002d030: 2064 6566 6175 6c74 2069 7320 4e6f 6e65   default is None
+0002d040: 2c0a 2020 2020 2020 2020 2020 2020 7768  ,.            wh
+0002d050: 6963 6820 6d65 616e 7320 616c 6c20 6578  ich means all ex
+0002d060: 706f 7375 7265 206d 6170 7320 6d61 7463  posure maps matc
+0002d070: 6869 6e67 2074 6865 206f 7468 6572 2063  hing the other c
+0002d080: 7269 7465 7269 6120 7769 6c6c 2062 6520  riteria will be 
+0002d090: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+0002d0a0: 2020 3a70 6172 616d 2073 7472 2069 6e73    :param str ins
+0002d0b0: 743a 204f 7074 696f 6e61 6c6c 792c 2061  t: Optionally, a
+0002d0c0: 2073 7065 6369 6669 6320 696e 7374 7275   specific instru
+0002d0d0: 6d65 6e74 2074 6f20 7365 6172 6368 2066  ment to search f
+0002d0e0: 6f72 2063 616e 2062 6520 7375 7070 6c69  or can be suppli
+0002d0f0: 6564 2e20 5468 6520 6465 6661 756c 7420  ed. The default 
+0002d100: 6973 204e 6f6e 652c 0a20 2020 2020 2020  is None,.       
+0002d110: 2020 2020 2077 6869 6368 206d 6561 6e73       which means
+0002d120: 2061 6c6c 2065 7870 6f73 7572 6520 6d61   all exposure ma
+0002d130: 7073 206d 6174 6368 696e 6720 7468 6520  ps matching the 
+0002d140: 6f74 6865 7220 6372 6974 6572 6961 2077  other criteria w
+0002d150: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
+0002d160: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0002d170: 5175 616e 7469 7479 206c 6f5f 656e 3a20  Quantity lo_en: 
+0002d180: 5468 6520 6c6f 7765 7220 656e 6572 6779  The lower energy
+0002d190: 206c 696d 6974 206f 6620 7468 6520 6578   limit of the ex
+0002d1a0: 706f 7375 7265 206d 6170 7320 796f 7520  posure maps you 
+0002d1b0: 7769 7368 2074 6f20 7265 7472 6965 7665  wish to retrieve
+0002d1c0: 2c20 7468 6520 6465 6661 756c 740a 2020  , the default.  
+0002d1d0: 2020 2020 2020 2020 2020 6973 204e 6f6e            is Non
+0002d1e0: 6520 2877 6869 6368 2077 696c 6c20 7265  e (which will re
+0002d1f0: 7472 6965 7665 2061 6c6c 2069 6d61 6765  trieve all image
+0002d200: 7320 7265 6761 7264 6c65 7373 206f 6620  s regardless of 
+0002d210: 656e 6572 6779 206c 696d 6974 292e 0a20  energy limit).. 
+0002d220: 2020 2020 2020 203a 7061 7261 6d20 5175         :param Qu
+0002d230: 616e 7469 7479 2068 695f 656e 3a20 5468  antity hi_en: Th
+0002d240: 6520 7570 7065 7220 656e 6572 6779 206c  e upper energy l
+0002d250: 696d 6974 206f 6620 7468 6520 6578 706f  imit of the expo
+0002d260: 7375 7265 206d 6170 7320 796f 7520 7769  sure maps you wi
+0002d270: 7368 2074 6f20 7265 7472 6965 7665 2c20  sh to retrieve, 
+0002d280: 7468 6520 6465 6661 756c 740a 2020 2020  the default.    
+0002d290: 2020 2020 2020 2020 6973 204e 6f6e 6520          is None 
+0002d2a0: 2877 6869 6368 2077 696c 6c20 7265 7472  (which will retr
+0002d2b0: 6965 7665 2061 6c6c 2069 6d61 6765 7320  ieve all images 
+0002d2c0: 7265 6761 7264 6c65 7373 206f 6620 656e  regardless of en
+0002d2d0: 6572 6779 206c 696d 6974 292e 0a20 2020  ergy limit)..   
+0002d2e0: 2020 2020 203a 7265 7475 726e 3a20 416e       :return: An
+0002d2f0: 2058 4741 2045 7870 4d61 7020 6f62 6a65   XGA ExpMap obje
+0002d300: 6374 2028 6966 2074 6865 7265 2069 7320  ct (if there is 
+0002d310: 616e 2065 7861 6374 206d 6174 6368 292c  an exact match),
+0002d320: 206f 7220 6120 6c69 7374 206f 6620 5847   or a list of XG
+0002d330: 4120 4578 704d 6170 206f 626a 6563 7473  A ExpMap objects
+0002d340: 2028 6966 2074 6865 7265 0a20 2020 2020   (if there.     
+0002d350: 2020 2020 2020 2077 6572 6520 6d75 6c74         were mult
+0002d360: 6970 6c65 206d 6174 6368 696e 6720 7072  iple matching pr
+0002d370: 6f64 7563 7473 292e 0a20 2020 2020 2020  oducts)..       
+0002d380: 203a 7274 7970 653a 2055 6e69 6f6e 5b45   :rtype: Union[E
+0002d390: 7870 4d61 702c 204c 6973 745b 4578 704d  xpMap, List[ExpM
+0002d3a0: 6170 5d5d 0a20 2020 2020 2020 2022 2222  ap]].        """
+0002d3b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002d3c0: 7365 6c66 2e5f 6765 745f 7068 6f74 5f70  self._get_phot_p
+0002d3d0: 726f 6428 2265 7870 6d61 7022 2c20 6f62  rod("expmap", ob
+0002d3e0: 735f 6964 2c20 696e 7374 2c20 6c6f 5f65  s_id, inst, lo_e
+0002d3f0: 6e2c 2068 695f 656e 2c20 4661 6c73 6529  n, hi_en, False)
+0002d400: 0a0a 2020 2020 6465 6620 6765 745f 7261  ..    def get_ra
+0002d410: 7465 6d61 7073 2873 656c 662c 206f 6273  temaps(self, obs
+0002d420: 5f69 643a 2073 7472 203d 204e 6f6e 652c  _id: str = None,
+0002d430: 2069 6e73 743a 2073 7472 203d 204e 6f6e   inst: str = Non
+0002d440: 652c 206c 6f5f 656e 3a20 5175 616e 7469  e, lo_en: Quanti
+0002d450: 7479 203d 204e 6f6e 652c 2068 695f 656e  ty = None, hi_en
+0002d460: 3a20 5175 616e 7469 7479 203d 204e 6f6e  : Quantity = Non
+0002d470: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0002d480: 2020 2020 2020 2020 7073 665f 636f 7272          psf_corr
+0002d490: 3a20 626f 6f6c 203d 2046 616c 7365 2c20  : bool = False, 
+0002d4a0: 7073 665f 6d6f 6465 6c3a 2073 7472 203d  psf_model: str =
+0002d4b0: 2022 454c 4c42 4554 4122 2c20 7073 665f   "ELLBETA", psf_
+0002d4c0: 6269 6e73 3a20 696e 7420 3d20 342c 2070  bins: int = 4, p
+0002d4d0: 7366 5f61 6c67 6f3a 2073 7472 203d 2022  sf_algo: str = "
+0002d4e0: 726c 222c 0a20 2020 2020 2020 2020 2020  rl",.           
+0002d4f0: 2020 2020 2020 2020 2020 7073 665f 6974            psf_it
+0002d500: 6572 3a20 696e 7420 3d20 3135 2920 2d3e  er: int = 15) ->
+0002d510: 2055 6e69 6f6e 5b52 6174 654d 6170 2c20   Union[RateMap, 
+0002d520: 4c69 7374 5b52 6174 654d 6170 5d5d 3a0a  List[RateMap]]:.
+0002d530: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0002d540: 2020 2020 4120 6d65 7468 6f64 2074 6f20      A method to 
+0002d550: 7265 7472 6965 7665 2058 4741 2052 6174  retrieve XGA Rat
+0002d560: 654d 6170 206f 626a 6563 7473 2e20 5468  eMap objects. Th
+0002d570: 6973 2073 7570 706f 7274 7320 7468 6520  is supports the 
+0002d580: 7265 7472 6965 7661 6c20 6f66 2062 6f74  retrieval of bot
+0002d590: 6820 5053 4620 636f 7272 6563 7465 6420  h PSF corrected 
+0002d5a0: 616e 6420 6e6f 6e2d 5053 460a 2020 2020  and non-PSF.    
+0002d5b0: 2020 2020 636f 7272 6563 7465 6420 7261      corrected ra
+0002d5c0: 7465 6d61 7073 2c20 6173 2077 656c 6c20  temaps, as well 
+0002d5d0: 6173 2073 6574 7469 6e67 2074 6865 2065  as setting the e
+0002d5e0: 6e65 7267 7920 6c69 6d69 7473 206f 6620  nergy limits of 
+0002d5f0: 7468 6520 7370 6563 6966 6963 2072 6174  the specific rat
+0002d600: 656d 6170 2079 6f75 2077 6f75 6c64 206c  emap you would l
+0002d610: 696b 652e 2041 0a20 2020 2020 2020 204e  ike. A.        N
+0002d620: 6f50 726f 6475 6374 4176 6169 6c61 626c  oProductAvailabl
+0002d630: 6545 7272 6f72 2065 7272 6f72 2077 696c  eError error wil
+0002d640: 6c20 6265 2072 6169 7365 6420 6966 206e  l be raised if n
+0002d650: 6f20 6d61 7463 6865 7320 6172 6520 666f  o matches are fo
+0002d660: 756e 642e 0a0a 2020 2020 2020 2020 3a70  und...        :p
+0002d670: 6172 616d 2073 7472 206f 6273 5f69 643a  aram str obs_id:
+0002d680: 204f 7074 696f 6e61 6c6c 792c 2061 2073   Optionally, a s
+0002d690: 7065 6369 6669 6320 6f62 735f 6964 2074  pecific obs_id t
+0002d6a0: 6f20 7365 6172 6368 2066 6f72 2063 616e  o search for can
+0002d6b0: 2062 6520 7375 7070 6c69 6564 2e20 5468   be supplied. Th
+0002d6c0: 6520 6465 6661 756c 7420 6973 204e 6f6e  e default is Non
+0002d6d0: 652c 0a20 2020 2020 2020 2020 2020 2077  e,.            w
+0002d6e0: 6869 6368 206d 6561 6e73 2061 6c6c 2072  hich means all r
+0002d6f0: 6174 656d 6170 7320 6d61 7463 6869 6e67  atemaps matching
+0002d700: 2074 6865 206f 7468 6572 2063 7269 7465   the other crite
+0002d710: 7269 6120 7769 6c6c 2062 6520 7265 7475  ria will be retu
+0002d720: 726e 6564 2e0a 2020 2020 2020 2020 3a70  rned..        :p
+0002d730: 6172 616d 2073 7472 2069 6e73 743a 204f  aram str inst: O
+0002d740: 7074 696f 6e61 6c6c 792c 2061 2073 7065  ptionally, a spe
+0002d750: 6369 6669 6320 696e 7374 7275 6d65 6e74  cific instrument
+0002d760: 2074 6f20 7365 6172 6368 2066 6f72 2063   to search for c
+0002d770: 616e 2062 6520 7375 7070 6c69 6564 2e20  an be supplied. 
+0002d780: 5468 6520 6465 6661 756c 7420 6973 204e  The default is N
+0002d790: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0002d7a0: 2077 6869 6368 206d 6561 6e73 2061 6c6c   which means all
+0002d7b0: 2072 6174 656d 6170 7320 6d61 7463 6869   ratemaps matchi
+0002d7c0: 6e67 2074 6865 206f 7468 6572 2063 7269  ng the other cri
+0002d7d0: 7465 7269 6120 7769 6c6c 2062 6520 7265  teria will be re
+0002d7e0: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
+0002d7f0: 3a70 6172 616d 2051 7561 6e74 6974 7920  :param Quantity 
+0002d800: 6c6f 5f65 6e3a 2054 6865 206c 6f77 6572  lo_en: The lower
+0002d810: 2065 6e65 7267 7920 6c69 6d69 7420 6f66   energy limit of
+0002d820: 2074 6865 2072 6174 656d 6170 7320 796f   the ratemaps yo
+0002d830: 7520 7769 7368 2074 6f20 7265 7472 6965  u wish to retrie
+0002d840: 7665 2c20 7468 6520 6465 6661 756c 740a  ve, the default.
+0002d850: 2020 2020 2020 2020 2020 2020 6973 204e              is N
+0002d860: 6f6e 6520 2877 6869 6368 2077 696c 6c20  one (which will 
+0002d870: 7265 7472 6965 7665 2061 6c6c 2072 6174  retrieve all rat
+0002d880: 656d 6170 7320 7265 6761 7264 6c65 7373  emaps regardless
+0002d890: 206f 6620 656e 6572 6779 206c 696d 6974   of energy limit
+0002d8a0: 292e 0a20 2020 2020 2020 203a 7061 7261  )..        :para
+0002d8b0: 6d20 5175 616e 7469 7479 2068 695f 656e  m Quantity hi_en
+0002d8c0: 3a20 5468 6520 7570 7065 7220 656e 6572  : The upper ener
+0002d8d0: 6779 206c 696d 6974 206f 6620 7468 6520  gy limit of the 
+0002d8e0: 7261 7465 6d61 7073 2079 6f75 2077 6973  ratemaps you wis
+0002d8f0: 6820 746f 2072 6574 7269 6576 652c 2074  h to retrieve, t
+0002d900: 6865 2064 6566 6175 6c74 0a20 2020 2020  he default.     
+0002d910: 2020 2020 2020 2069 7320 4e6f 6e65 2028         is None (
+0002d920: 7768 6963 6820 7769 6c6c 2072 6574 7269  which will retri
+0002d930: 6576 6520 616c 6c20 7261 7465 6d61 7073  eve all ratemaps
+0002d940: 2072 6567 6172 646c 6573 7320 6f66 2065   regardless of e
+0002d950: 6e65 7267 7920 6c69 6d69 7429 2e0a 2020  nergy limit)..  
+0002d960: 2020 2020 2020 3a70 6172 616d 2062 6f6f        :param boo
+0002d970: 6c20 7073 665f 636f 7272 3a20 5365 7473  l psf_corr: Sets
+0002d980: 2077 6865 7468 6572 2079 6f75 2077 6973   whether you wis
+0002d990: 6820 746f 2072 6574 7269 6576 6520 6120  h to retrieve a 
+0002d9a0: 5053 4620 636f 7272 6563 7465 6420 7261  PSF corrected ra
+0002d9b0: 7465 6d61 7020 6f72 206e 6f74 2e0a 2020  temap or not..  
+0002d9c0: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
+0002d9d0: 2070 7366 5f6d 6f64 656c 3a20 4966 2074   psf_model: If t
+0002d9e0: 6865 2072 6174 656d 6170 2079 6f75 2077  he ratemap you w
+0002d9f0: 616e 7420 6973 2050 5346 2063 6f72 7265  ant is PSF corre
+0002da00: 6374 6564 2c20 7468 6973 2069 7320 7468  cted, this is th
+0002da10: 6520 5053 4620 6d6f 6465 6c20 7573 6564  e PSF model used
+0002da20: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0002da30: 2069 6e74 2070 7366 5f62 696e 733a 2049   int psf_bins: I
+0002da40: 6620 7468 6520 7261 7465 6d61 7020 796f  f the ratemap yo
+0002da50: 7520 7761 6e74 2069 7320 5053 4620 636f  u want is PSF co
+0002da60: 7272 6563 7465 642c 2074 6869 7320 6973  rrected, this is
+0002da70: 2074 6865 206e 756d 6265 7220 6f66 2050   the number of P
+0002da80: 5346 7320 7065 720a 2020 2020 2020 2020  SFs per.        
+0002da90: 2020 2020 7369 6465 2069 6e20 7468 6520      side in the 
+0002daa0: 5053 4620 6772 6964 2e0a 2020 2020 2020  PSF grid..      
+0002dab0: 2020 3a70 6172 616d 2073 7472 2070 7366    :param str psf
+0002dac0: 5f61 6c67 6f3a 2049 6620 7468 6520 7261  _algo: If the ra
+0002dad0: 7465 6d61 7020 796f 7520 7761 6e74 2069  temap you want i
+0002dae0: 7320 5053 4620 636f 7272 6563 7465 642c  s PSF corrected,
+0002daf0: 2074 6869 7320 6973 2074 6865 2061 6c67   this is the alg
+0002db00: 6f72 6974 686d 2075 7365 642e 0a20 2020  orithm used..   
+0002db10: 2020 2020 203a 7061 7261 6d20 696e 7420       :param int 
+0002db20: 7073 665f 6974 6572 3a20 4966 2074 6865  psf_iter: If the
+0002db30: 2072 6174 656d 6170 2079 6f75 2077 616e   ratemap you wan
+0002db40: 7420 6973 2050 5346 2063 6f72 7265 6374  t is PSF correct
+0002db50: 6564 2c20 7468 6973 2069 7320 7468 6520  ed, this is the 
+0002db60: 6e75 6d62 6572 206f 6620 6974 6572 6174  number of iterat
+0002db70: 696f 6e73 2e0a 2020 2020 2020 2020 3a72  ions..        :r
+0002db80: 6574 7572 6e3a 2041 6e20 5847 4120 5261  eturn: An XGA Ra
+0002db90: 7465 4d61 7020 6f62 6a65 6374 2028 6966  teMap object (if
+0002dba0: 2074 6865 7265 2069 7320 616e 2065 7861   there is an exa
+0002dbb0: 6374 206d 6174 6368 292c 206f 7220 6120  ct match), or a 
+0002dbc0: 6c69 7374 206f 6620 5847 4120 5261 7465  list of XGA Rate
+0002dbd0: 4d61 7020 6f62 6a65 6374 7320 2869 6620  Map objects (if 
+0002dbe0: 7468 6572 650a 2020 2020 2020 2020 2020  there.          
+0002dbf0: 2020 7765 7265 206d 756c 7469 706c 6520    were multiple 
+0002dc00: 6d61 7463 6869 6e67 2070 726f 6475 6374  matching product
+0002dc10: 7329 2e0a 2020 2020 2020 2020 3a72 7479  s)..        :rty
+0002dc20: 7065 3a20 556e 696f 6e5b 5261 7465 4d61  pe: Union[RateMa
+0002dc30: 702c 204c 6973 745b 5261 7465 4d61 705d  p, List[RateMap]
+0002dc40: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
+0002dc50: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0002dc60: 662e 5f67 6574 5f70 686f 745f 7072 6f64  f._get_phot_prod
+0002dc70: 2822 7261 7465 6d61 7022 2c20 6f62 735f  ("ratemap", obs_
+0002dc80: 6964 2c20 696e 7374 2c20 6c6f 5f65 6e2c  id, inst, lo_en,
+0002dc90: 2068 695f 656e 2c20 7073 665f 636f 7272   hi_en, psf_corr
+0002dca0: 2c20 7073 665f 6d6f 6465 6c2c 2070 7366  , psf_model, psf
+0002dcb0: 5f62 696e 732c 2070 7366 5f61 6c67 6f2c  _bins, psf_algo,
+0002dcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dce0: 2020 2020 7073 665f 6974 6572 290a 0a20      psf_iter).. 
+0002dcf0: 2020 2064 6566 205f 6765 745f 6c63 5f70     def _get_lc_p
+0002dd00: 726f 6428 7365 6c66 2c20 6f75 7465 725f  rod(self, outer_
+0002dd10: 7261 6469 7573 3a20 556e 696f 6e5b 7374  radius: Union[st
+0002dd20: 722c 2051 7561 6e74 6974 795d 203d 204e  r, Quantity] = N
+0002dd30: 6f6e 652c 206f 6273 5f69 643a 2073 7472  one, obs_id: str
+0002dd40: 203d 204e 6f6e 652c 2069 6e73 743a 2073   = None, inst: s
+0002dd50: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
+0002dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dd70: 696e 6e65 725f 7261 6469 7573 3a20 556e  inner_radius: Un
+0002dd80: 696f 6e5b 7374 722c 2051 7561 6e74 6974  ion[str, Quantit
+0002dd90: 795d 203d 204e 6f6e 652c 206c 6f5f 656e  y] = None, lo_en
+0002dda0: 3a20 5175 616e 7469 7479 203d 204e 6f6e  : Quantity = Non
+0002ddb0: 652c 2068 695f 656e 3a20 5175 616e 7469  e, hi_en: Quanti
+0002ddc0: 7479 203d 204e 6f6e 652c 0a20 2020 2020  ty = None,.     
+0002ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dde0: 7469 6d65 5f62 696e 5f73 697a 653a 2051  time_bin_size: Q
+0002ddf0: 7561 6e74 6974 7920 3d20 4e6f 6e65 2920  uantity = None) 
+0002de00: 5c0a 2020 2020 2020 2020 2020 2020 2d3e  \.            ->
+0002de10: 2055 6e69 6f6e 5b4c 6967 6874 4375 7276   Union[LightCurv
+0002de20: 652c 204c 6973 745b 4c69 6768 7443 7572  e, List[LightCur
+0002de30: 7665 5d2c 2041 6767 7265 6761 7465 4c69  ve], AggregateLi
+0002de40: 6768 7443 7572 7665 2c20 4c69 7374 5b41  ghtCurve, List[A
+0002de50: 6767 7265 6761 7465 4c69 6768 7443 7572  ggregateLightCur
+0002de60: 7665 5d5d 3a0a 2020 2020 2020 2020 2222  ve]]:.        ""
+0002de70: 220a 2020 2020 2020 2020 4120 7072 6f74  ".        A prot
+0002de80: 6563 7465 6420 6d65 7468 6f64 2074 6f20  ected method to 
+0002de90: 7265 7472 6965 7665 2058 4741 204c 6967  retrieve XGA Lig
+0002dea0: 6874 4375 7276 6520 6f62 6a65 6374 732c  htCurve objects,
+0002deb0: 2074 6865 2075 7365 7220 7368 6f75 6c64   the user should
+0002dec0: 206e 6576 6572 2069 6e74 6572 6163 7420   never interact 
+0002ded0: 7769 7468 2074 6869 7320 6469 7265 6374  with this direct
+0002dee0: 6c79 2e0a 0a20 2020 2020 2020 203a 7061  ly...        :pa
+0002def0: 7261 6d20 7374 722f 5175 616e 7469 7479  ram str/Quantity
+0002df00: 206f 7574 6572 5f72 6164 6975 733a 2054   outer_radius: T
+0002df10: 6865 206e 616d 6520 6f72 2076 616c 7565  he name or value
+0002df20: 206f 6620 7468 6520 6f75 7465 7220 7261   of the outer ra
+0002df30: 6469 7573 2074 6861 7420 7761 7320 7573  dius that was us
+0002df40: 6564 2066 6f72 2074 6865 2067 656e 6572  ed for the gener
+0002df50: 6174 696f 6e20 6f66 0a20 2020 2020 2020  ation of.       
+0002df60: 2020 2020 2074 6865 206c 6967 6874 6375       the lightcu
+0002df70: 7276 6520 2866 6f72 2069 6e73 7461 6e63  rve (for instanc
+0002df80: 6520 2770 6f69 6e74 2720 776f 756c 6420  e 'point' would 
+0002df90: 6265 2061 6363 6570 7461 626c 6520 666f  be acceptable fo
+0002dfa0: 7220 6120 506f 696e 7453 6f75 7263 652c  r a PointSource,
+0002dfb0: 206f 7220 5175 616e 7469 7479 2831 3030   or Quantity(100
+0002dfc0: 2c20 276b 7063 2729 292e 0a20 2020 2020  , 'kpc'))..     
+0002dfd0: 2020 2020 2020 2044 6566 6175 6c74 2069         Default i
+0002dfe0: 7320 4e6f 6e65 2c20 6d65 616e 696e 6720  s None, meaning 
+0002dff0: 616c 6c20 6c69 6768 7463 7572 7665 7320  all lightcurves 
+0002e000: 7769 6c6c 2062 6520 7265 7472 6965 7665  will be retrieve
+0002e010: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
+0002e020: 6d20 7374 7220 6f62 735f 6964 3a20 4f70  m str obs_id: Op
+0002e030: 7469 6f6e 616c 6c79 2c20 6120 7370 6563  tionally, a spec
+0002e040: 6966 6963 206f 6273 5f69 6420 746f 2073  ific obs_id to s
+0002e050: 6561 7263 6820 666f 7220 6361 6e20 6265  earch for can be
+0002e060: 2073 7570 706c 6965 642e 2054 6865 2064   supplied. The d
+0002e070: 6566 6175 6c74 2069 7320 4e6f 6e65 2c0a  efault is None,.
+0002e080: 2020 2020 2020 2020 2020 2020 7768 6963              whic
+0002e090: 6820 6d65 616e 7320 616c 6c20 6c69 6768  h means all ligh
+0002e0a0: 7463 7572 7665 7320 6d61 7463 6869 6e67  tcurves matching
+0002e0b0: 2074 6865 206f 7468 6572 2063 7269 7465   the other crite
+0002e0c0: 7269 6120 7769 6c6c 2062 6520 7265 7475  ria will be retu
+0002e0d0: 726e 6564 2e0a 2020 2020 2020 2020 3a70  rned..        :p
+0002e0e0: 6172 616d 2073 7472 2069 6e73 743a 204f  aram str inst: O
+0002e0f0: 7074 696f 6e61 6c6c 792c 2061 2073 7065  ptionally, a spe
+0002e100: 6369 6669 6320 696e 7374 7275 6d65 6e74  cific instrument
+0002e110: 2074 6f20 7365 6172 6368 2066 6f72 2063   to search for c
+0002e120: 616e 2062 6520 7375 7070 6c69 6564 2e20  an be supplied. 
+0002e130: 5468 6520 6465 6661 756c 7420 6973 204e  The default is N
+0002e140: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0002e150: 2077 6869 6368 206d 6561 6e73 2061 6c6c   which means all
+0002e160: 206c 6967 6874 6375 7276 6573 206d 6174   lightcurves mat
+0002e170: 6368 696e 6720 7468 6520 6f74 6865 7220  ching the other 
+0002e180: 6372 6974 6572 6961 2077 696c 6c20 6265  criteria will be
+0002e190: 2072 6574 7572 6e65 642e 0a20 2020 2020   returned..     
+0002e1a0: 2020 203a 7061 7261 6d20 7374 722f 5175     :param str/Qu
+0002e1b0: 616e 7469 7479 2069 6e6e 6572 5f72 6164  antity inner_rad
+0002e1c0: 6975 733a 2054 6865 206e 616d 6520 6f72  ius: The name or
+0002e1d0: 2076 616c 7565 206f 6620 7468 6520 696e   value of the in
+0002e1e0: 6e65 7220 7261 6469 7573 2074 6861 7420  ner radius that 
+0002e1f0: 7761 7320 7573 6564 2066 6f72 2074 6865  was used for the
+0002e200: 2067 656e 6572 6174 696f 6e20 6f66 0a20   generation of. 
+0002e210: 2020 2020 2020 2020 2020 2074 6865 206c             the l
+0002e220: 6967 6874 6375 7276 6520 2866 6f72 2069  ightcurve (for i
+0002e230: 6e73 7461 6e63 6520 2770 6f69 6e74 2720  nstance 'point' 
+0002e240: 776f 756c 6420 6265 2061 6363 6570 7461  would be accepta
+0002e250: 626c 6520 666f 7220 6120 506f 696e 7453  ble for a PointS
+0002e260: 6f75 7263 652c 206f 7220 5175 616e 7469  ource, or Quanti
+0002e270: 7479 2830 2c20 276b 7063 2729 292e 0a20  ty(0, 'kpc')).. 
+0002e280: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+0002e290: 6c74 2069 7320 4e6f 6e65 2c20 6d65 616e  lt is None, mean
+0002e2a0: 696e 6720 616c 6c20 6c69 6768 7463 7572  ing all lightcur
+0002e2b0: 7665 7320 7769 6c6c 2062 6520 7265 7472  ves will be retr
+0002e2c0: 6965 7665 642e 0a20 2020 2020 2020 203a  ieved..        :
+0002e2d0: 7061 7261 6d20 5175 616e 7469 7479 206c  param Quantity l
+0002e2e0: 6f5f 656e 3a20 5468 6520 6c6f 7765 7220  o_en: The lower 
+0002e2f0: 656e 6572 6779 206c 696d 6974 206f 6620  energy limit of 
+0002e300: 7468 6520 6c69 6768 7463 7572 7665 7320  the lightcurves 
+0002e310: 796f 7520 7769 7368 2074 6f20 7265 7472  you wish to retr
+0002e320: 6965 7665 2c20 7468 6520 6465 6661 756c  ieve, the defaul
+0002e330: 740a 2020 2020 2020 2020 2020 2020 6973  t.            is
+0002e340: 204e 6f6e 6520 2877 6869 6368 2077 696c   None (which wil
+0002e350: 6c20 7265 7472 6965 7665 2061 6c6c 206c  l retrieve all l
+0002e360: 6967 6874 6375 7276 6573 2072 6567 6172  ightcurves regar
+0002e370: 646c 6573 7320 6f66 2065 6e65 7267 7920  dless of energy 
+0002e380: 6c69 6d69 7429 2e0a 2020 2020 2020 2020  limit)..        
+0002e390: 3a70 6172 616d 2051 7561 6e74 6974 7920  :param Quantity 
+0002e3a0: 6869 5f65 6e3a 2054 6865 2075 7070 6572  hi_en: The upper
+0002e3b0: 2065 6e65 7267 7920 6c69 6d69 7420 6f66   energy limit of
+0002e3c0: 2074 6865 206c 6967 6874 6375 7276 6573   the lightcurves
+0002e3d0: 2079 6f75 2077 6973 6820 746f 2072 6574   you wish to ret
+0002e3e0: 7269 6576 652c 2074 6865 2064 6566 6175  rieve, the defau
+0002e3f0: 6c74 0a20 2020 2020 2020 2020 2020 2069  lt.            i
+0002e400: 7320 4e6f 6e65 2028 7768 6963 6820 7769  s None (which wi
+0002e410: 6c6c 2072 6574 7269 6576 6520 616c 6c20  ll retrieve all 
+0002e420: 6c69 6768 7463 7572 7665 7320 7265 6761  lightcurves rega
+0002e430: 7264 6c65 7373 206f 6620 656e 6572 6779  rdless of energy
+0002e440: 206c 696d 6974 292e 0a20 2020 2020 2020   limit)..       
+0002e450: 203a 7061 7261 6d20 5175 616e 7469 7479   :param Quantity
+0002e460: 2074 696d 655f 6269 6e5f 7369 7a65 3a20   time_bin_size: 
+0002e470: 5468 6520 7469 6d65 2062 696e 2073 697a  The time bin siz
+0002e480: 6520 7573 6564 2074 6f20 6765 6e65 7261  e used to genera
+0002e490: 7465 2074 6865 2064 6573 6972 6564 206c  te the desired l
+0002e4a0: 6967 6874 6375 7276 652e 2054 6865 2064  ightcurve. The d
+0002e4b0: 6566 6175 6c74 2076 616c 7565 0a20 2020  efault value.   
+0002e4c0: 2020 2020 2020 2020 2069 7320 4e6f 6e65           is None
+0002e4d0: 2c20 696e 2077 6869 6368 2063 6173 6520  , in which case 
+0002e4e0: 616c 6c20 6c69 6768 7463 7572 7665 7320  all lightcurves 
+0002e4f0: 6d61 7463 6869 6e67 206f 7468 6572 2063  matching other c
+0002e500: 7269 7465 7269 6120 7769 6c6c 2062 6520  riteria will be 
+0002e510: 7265 7472 6965 7665 642e 0a20 2020 2020  retrieved..     
+0002e520: 2020 203a 7265 7475 726e 3a20 416e 2058     :return: An X
+0002e530: 4741 204c 6967 6874 4375 7276 6520 6f62  GA LightCurve ob
+0002e540: 6a65 6374 2028 6966 2074 6865 7265 2069  ject (if there i
+0002e550: 7320 616e 2065 7861 6374 206d 6174 6368  s an exact match
+0002e560: 292c 206f 7220 6120 6c69 7374 206f 6620  ), or a list of 
+0002e570: 5847 4120 4c69 6768 7443 7572 7665 206f  XGA LightCurve o
+0002e580: 626a 6563 7473 2028 6966 2074 6865 7265  bjects (if there
+0002e590: 0a20 2020 2020 2020 2020 2020 2077 6572  .            wer
+0002e5a0: 6520 6d75 6c74 6970 6c65 206d 6174 6368  e multiple match
+0002e5b0: 696e 6720 7072 6f64 7563 7473 292c 206f  ing products), o
+0002e5c0: 7220 6120 7369 6e67 6c65 2f6c 6973 7420  r a single/list 
+0002e5d0: 6f66 2041 6767 7265 6761 7465 4c69 6768  of AggregateLigh
+0002e5e0: 7443 7572 7665 206f 626a 6563 7473 2e0a  tCurve objects..
+0002e5f0: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
+0002e600: 556e 696f 6e5b 4c69 6768 7443 7572 7665  Union[LightCurve
+0002e610: 2c20 4c69 7374 5b4c 6967 6874 4375 7276  , List[LightCurv
+0002e620: 655d 2c20 4167 6772 6567 6174 654c 6967  e], AggregateLig
+0002e630: 6874 4375 7276 652c 204c 6973 745b 4167  htCurve, List[Ag
+0002e640: 6772 6567 6174 654c 6967 6874 4375 7276  gregateLightCurv
+0002e650: 655d 5d0a 2020 2020 2020 2020 2222 220a  e]].        """.
+0002e660: 2020 2020 2020 2020 2320 5365 7420 7570          # Set up
+0002e670: 2073 6561 7263 6820 7374 7269 6e67 7320   search strings 
+0002e680: 2866 6f72 2074 6865 2070 726f 6475 6374  (for the product
+0002e690: 2073 746f 7261 6765 206b 6579 7329 2066   storage keys) f
+0002e6a0: 6f72 2074 6865 2069 6e6e 6572 2061 6e64  or the inner and
+0002e6b0: 206f 7574 6572 2072 6164 6969 2068 6572   outer radii her
+0002e6c0: 652e 2054 6865 2064 6566 6175 6c74 204e  e. The default N
+0002e6d0: 6f6e 650a 2020 2020 2020 2020 2320 2076  one.        #  v
+0002e6e0: 616c 7565 206a 7573 7420 6372 6561 7465  alue just create
+0002e6f0: 7320 6120 6b65 7920 7468 6174 206c 6f6f  s a key that loo
+0002e700: 6b73 2066 6f72 2074 6865 2027 7269 2720  ks for the 'ri' 
+0002e710: 6f72 2027 726f 2720 7072 6563 7572 736f  or 'ro' precurso
+0002e720: 7220 746f 2074 6865 2076 616c 7565 2069  r to the value i
+0002e730: 6e20 7468 6520 6b65 792c 2069 2e65 2e20  n the key, i.e. 
+0002e740: 6974 2064 6f65 736e 2774 0a20 2020 2020  it doesn't.     
+0002e750: 2020 2023 2020 646f 2061 6e79 7468 696e     #  do anythin
+0002e760: 6720 2d20 7765 2061 6c73 6f20 6d61 6b65  g - we also make
+0002e770: 2073 7572 6520 7468 6174 2061 6e79 2072   sure that any r
+0002e780: 6164 6969 2070 6173 7365 6420 6279 2074  adii passed by t
+0002e790: 6865 2075 7365 7220 6172 6520 636f 6e76  he user are conv
+0002e7a0: 6572 7465 6420 7072 6f70 6572 6c79 0a20  erted properly. 
+0002e7b0: 2020 2020 2020 2069 6620 696e 6e65 725f         if inner_
+0002e7c0: 7261 6469 7573 2069 7320 6e6f 7420 4e6f  radius is not No
+0002e7d0: 6e65 2061 6e64 2069 7369 6e73 7461 6e63  ne and isinstanc
+0002e7e0: 6528 696e 6e65 725f 7261 6469 7573 2c20  e(inner_radius, 
+0002e7f0: 5175 616e 7469 7479 293a 0a20 2020 2020  Quantity):.     
+0002e800: 2020 2020 2020 2069 6e6e 5f72 6164 5f73         inn_rad_s
+0002e810: 6561 7263 6820 3d20 275f 7269 7b7d 5f27  earch = '_ri{}_'
+0002e820: 2e66 6f72 6d61 7428 7365 6c66 2e63 6f6e  .format(self.con
+0002e830: 7665 7274 5f72 6164 6975 7328 696e 6e65  vert_radius(inne
+0002e840: 725f 7261 6469 7573 2c20 2764 6567 2729  r_radius, 'deg')
+0002e850: 2e76 616c 7565 290a 2020 2020 2020 2020  .value).        
+0002e860: 656c 6966 2069 6e6e 6572 5f72 6164 6975  elif inner_radiu
+0002e870: 7320 6973 206e 6f74 204e 6f6e 6520 616e  s is not None an
+0002e880: 6420 6973 696e 7374 616e 6365 2869 6e6e  d isinstance(inn
+0002e890: 6572 5f72 6164 6975 732c 2073 7472 293a  er_radius, str):
+0002e8a0: 0a20 2020 2020 2020 2020 2020 2069 6e6e  .            inn
+0002e8b0: 5f72 6164 5f73 6561 7263 6820 3d20 275f  _rad_search = '_
+0002e8c0: 7269 7b7d 5f27 2e66 6f72 6d61 7428 7365  ri{}_'.format(se
+0002e8d0: 6c66 2e67 6574 5f72 6164 6975 7328 696e  lf.get_radius(in
+0002e8e0: 6e65 725f 7261 6469 7573 2c20 2764 6567  ner_radius, 'deg
+0002e8f0: 2729 2e76 616c 7565 290a 2020 2020 2020  ').value).      
+0002e900: 2020 656c 6966 2069 6e6e 6572 5f72 6164    elif inner_rad
+0002e910: 6975 7320 6973 204e 6f6e 653a 0a20 2020  ius is None:.   
+0002e920: 2020 2020 2020 2020 2069 6e6e 5f72 6164           inn_rad
+0002e930: 5f73 6561 7263 6820 3d20 225f 7269 220a  _search = "_ri".
+0002e940: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002e950: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0002e960: 5479 7065 4572 726f 7228 2259 6f75 206d  TypeError("You m
+0002e970: 6179 206f 6e6c 7920 7061 7373 2061 2071  ay only pass a q
+0002e980: 7561 6e74 6974 7920 6f72 2061 2073 7472  uantity or a str
+0002e990: 696e 6720 6173 2069 6e6e 6572 5f72 6164  ing as inner_rad
+0002e9a0: 6975 7322 290a 0a20 2020 2020 2020 2069  ius")..        i
+0002e9b0: 6620 6f75 7465 725f 7261 6469 7573 2069  f outer_radius i
+0002e9c0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2069  s not None and i
+0002e9d0: 7369 6e73 7461 6e63 6528 6f75 7465 725f  sinstance(outer_
+0002e9e0: 7261 6469 7573 2c20 5175 616e 7469 7479  radius, Quantity
+0002e9f0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+0002ea00: 7574 5f72 6164 5f73 6561 7263 6820 3d20  ut_rad_search = 
+0002ea10: 275f 726f 7b7d 5f27 2e66 6f72 6d61 7428  '_ro{}_'.format(
+0002ea20: 7365 6c66 2e63 6f6e 7665 7274 5f72 6164  self.convert_rad
+0002ea30: 6975 7328 6f75 7465 725f 7261 6469 7573  ius(outer_radius
+0002ea40: 2c20 2764 6567 2729 2e76 616c 7565 290a  , 'deg').value).
+0002ea50: 2020 2020 2020 2020 656c 6966 206f 7574          elif out
+0002ea60: 6572 5f72 6164 6975 7320 6973 206e 6f74  er_radius is not
+0002ea70: 204e 6f6e 6520 616e 6420 6973 696e 7374   None and isinst
+0002ea80: 616e 6365 286f 7574 6572 5f72 6164 6975  ance(outer_radiu
+0002ea90: 732c 2073 7472 293a 0a20 2020 2020 2020  s, str):.       
+0002eaa0: 2020 2020 206f 7574 5f72 6164 5f73 6561       out_rad_sea
+0002eab0: 7263 6820 3d20 275f 726f 7b7d 5f27 2e66  rch = '_ro{}_'.f
+0002eac0: 6f72 6d61 7428 7365 6c66 2e67 6574 5f72  ormat(self.get_r
+0002ead0: 6164 6975 7328 6f75 7465 725f 7261 6469  adius(outer_radi
+0002eae0: 7573 2c20 2764 6567 2729 2e76 616c 7565  us, 'deg').value
+0002eaf0: 290a 2020 2020 2020 2020 656c 6966 206f  ).        elif o
+0002eb00: 7574 6572 5f72 6164 6975 7320 6973 204e  uter_radius is N
+0002eb10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002eb20: 206f 7574 5f72 6164 5f73 6561 7263 6820   out_rad_search 
+0002eb30: 3d20 225f 726f 220a 2020 2020 2020 2020  = "_ro".        
+0002eb40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002eb50: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+0002eb60: 7228 2259 6f75 206d 6179 206f 6e6c 7920  r("You may only 
+0002eb70: 7061 7373 2061 2071 7561 6e74 6974 7920  pass a quantity 
+0002eb80: 6f72 2061 2073 7472 696e 6720 6173 206f  or a string as o
+0002eb90: 7574 6572 5f72 6164 6975 7322 290a 0a20  uter_radius").. 
+0002eba0: 2020 2020 2020 2023 2043 6865 636b 2074         # Check t
+0002ebb0: 6f20 6d61 6b65 2073 7572 6520 7468 6174  o make sure that
+0002ebc0: 2074 6865 2074 696d 6520 6269 6e20 7369   the time bin si
+0002ebd0: 7a65 2069 7320 6120 6c65 6761 6c20 7661  ze is a legal va
+0002ebe0: 6c75 652c 2061 6e64 2073 6574 2075 7020  lue, and set up 
+0002ebf0: 6120 7365 6172 6368 2073 7472 696e 6720  a search string 
+0002ec00: 666f 7220 7468 6520 7469 6d65 2062 696e  for the time bin
+0002ec10: 0a20 2020 2020 2020 2023 2020 7369 7a65  .        #  size
+0002ec20: 2069 6e20 6f72 6465 7220 746f 206e 6172   in order to nar
+0002ec30: 726f 7720 646f 776e 2074 6865 206c 6967  row down the lig
+0002ec40: 6874 6375 7276 6573 2074 6f20 6a75 7374  htcurves to just
+0002ec50: 2074 6865 206f 6e65 7320 7468 6174 2074   the ones that t
+0002ec60: 6865 2075 7365 7220 7761 6e74 730a 2020  he user wants.  
+0002ec70: 2020 2020 2020 6966 2074 696d 655f 6269        if time_bi
+0002ec80: 6e5f 7369 7a65 2069 7320 6e6f 7420 4e6f  n_size is not No
+0002ec90: 6e65 2061 6e64 206e 6f74 2074 696d 655f  ne and not time_
+0002eca0: 6269 6e5f 7369 7a65 2e75 6e69 742e 6973  bin_size.unit.is
+0002ecb0: 5f65 7175 6976 616c 656e 7428 2773 2729  _equivalent('s')
+0002ecc0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0002ecd0: 6973 6520 556e 6974 436f 6e76 6572 7369  ise UnitConversi
+0002ece0: 6f6e 4572 726f 7228 2254 6865 2027 7469  onError("The 'ti
+0002ecf0: 6d65 5f62 696e 5f73 697a 6527 2061 7267  me_bin_size' arg
+0002ed00: 756d 656e 7420 6d75 7374 2062 6520 636f  ument must be co
+0002ed10: 6e76 6572 7469 626c 6520 746f 2073 6563  nvertible to sec
+0002ed20: 6f6e 6473 2e22 290a 2020 2020 2020 2020  onds.").        
+0002ed30: 656c 6966 2074 696d 655f 6269 6e5f 7369  elif time_bin_si
+0002ed40: 7a65 2069 7320 4e6f 6e65 3a0a 2020 2020  ze is None:.    
+0002ed50: 2020 2020 2020 2020 7469 6d65 5f62 696e          time_bin
+0002ed60: 5f73 6561 7263 6820 3d20 275f 7469 6d65  _search = '_time
+0002ed70: 6269 6e27 0a20 2020 2020 2020 2065 6c73  bin'.        els
+0002ed80: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+0002ed90: 696d 655f 6269 6e5f 7365 6172 6368 203d  ime_bin_search =
+0002eda0: 2027 5f74 696d 6562 696e 7b7d 272e 666f   '_timebin{}'.fo
+0002edb0: 726d 6174 2874 696d 655f 6269 6e5f 7369  rmat(time_bin_si
+0002edc0: 7a65 2e74 6f28 2773 2729 2e76 616c 7565  ze.to('s').value
+0002edd0: 290a 0a20 2020 2020 2020 2023 2053 6574  )..        # Set
+0002ede0: 7469 6e67 2075 7020 7468 6520 656e 6572  ting up the ener
+0002edf0: 6779 2062 616e 6420 7365 6172 6368 2073  gy band search s
+0002ee00: 7472 696e 6720 2d20 6966 206f 6e65 2062  tring - if one b
+0002ee10: 6f75 6e64 2069 7320 7370 6563 6966 6965  ound is specifie
+0002ee20: 6420 7468 656e 2074 6865 206f 7468 6572  d then the other
+0002ee30: 2068 6173 2074 6f20 6265 2061 7320 7765   has to be as we
+0002ee40: 6c6c 2c20 490a 2020 2020 2020 2020 2320  ll, I.        # 
+0002ee50: 2064 6964 6e27 7420 7468 696e 6b20 6974   didn't think it
+0002ee60: 206d 6164 6520 7365 6e73 6520 6f74 6865   made sense othe
+0002ee70: 7277 6973 650a 2020 2020 2020 2020 6966  rwise.        if
+0002ee80: 2061 6e79 285b 6c6f 5f65 6e20 6973 206e   any([lo_en is n
+0002ee90: 6f74 204e 6f6e 652c 2068 695f 656e 2069  ot None, hi_en i
+0002eea0: 7320 6e6f 7420 4e6f 6e65 5d29 2061 6e64  s not None]) and
+0002eeb0: 206e 6f74 2061 6c6c 285b 6c6f 5f65 6e20   not all([lo_en 
+0002eec0: 6973 206e 6f74 204e 6f6e 652c 2068 695f  is not None, hi_
+0002eed0: 656e 2069 7320 6e6f 7420 4e6f 6e65 5d29  en is not None])
+0002eee0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0002eef0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+0002ef00: 5468 6520 276c 6f5f 656e 2720 616e 6420  The 'lo_en' and 
+0002ef10: 2768 695f 656e 2720 7661 6c75 6573 206d  'hi_en' values m
+0002ef20: 7573 7420 6569 7468 6572 2062 6f74 6820  ust either both 
+0002ef30: 6265 204e 6f6e 652c 206f 7220 626f 7468  be None, or both
+0002ef40: 2062 6520 616e 2065 6e65 7267 7920 7661   be an energy va
+0002ef50: 6c75 652e 2229 0a20 2020 2020 2020 2069  lue.").        i
+0002ef60: 6620 286c 6f5f 656e 2069 7320 6e6f 7420  f (lo_en is not 
+0002ef70: 4e6f 6e65 2061 6e64 206e 6f74 206c 6f5f  None and not lo_
+0002ef80: 656e 2e75 6e69 742e 6973 5f65 7175 6976  en.unit.is_equiv
+0002ef90: 616c 656e 7428 276b 6556 2729 2920 6f72  alent('keV')) or
+0002efa0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0002efb0: 2020 2028 6869 5f65 6e20 6973 206e 6f74     (hi_en is not
+0002efc0: 204e 6f6e 6520 616e 6420 6e6f 7420 6869   None and not hi
+0002efd0: 5f65 6e2e 756e 6974 2e69 735f 6571 7569  _en.unit.is_equi
+0002efe0: 7661 6c65 6e74 2827 6b65 5627 2929 3a0a  valent('keV')):.
+0002eff0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0002f000: 6520 556e 6974 436f 6e76 6572 7369 6f6e  e UnitConversion
+0002f010: 4572 726f 7228 2254 6865 2027 6c6f 5f65  Error("The 'lo_e
+0002f020: 6e27 2061 6e64 2027 6869 5f65 6e27 2061  n' and 'hi_en' a
+0002f030: 7267 756d 656e 7473 206d 7573 7420 6265  rguments must be
+0002f040: 2063 6f6e 7665 7274 6962 6c65 2074 6f20   convertible to 
+0002f050: 6b65 562e 2229 0a20 2020 2020 2020 2023  keV.").        #
+0002f060: 2049 6620 6569 7468 6572 2069 7320 4e6f   If either is No
+0002f070: 6e65 2074 6865 6e20 7765 206b 6e6f 7720  ne then we know 
+0002f080: 626f 7468 2061 7265 2062 6563 6175 7365  both are because
+0002f090: 2077 6520 6368 6563 6b65 6420 6561 726c   we checked earl
+0002f0a0: 6965 720a 2020 2020 2020 2020 656c 6966  ier.        elif
+0002f0b0: 206c 6f5f 656e 2069 7320 4e6f 6e65 3a0a   lo_en is None:.
+0002f0c0: 2020 2020 2020 2020 2020 2020 656e 5f73              en_s
+0002f0d0: 6561 7263 6820 3d20 2762 6f75 6e64 5f27  earch = 'bound_'
+0002f0e0: 0a20 2020 2020 2020 2065 6c69 6620 6c6f  .        elif lo
+0002f0f0: 5f65 6e20 6973 206e 6f74 204e 6f6e 653a  _en is not None:
+0002f100: 0a20 2020 2020 2020 2020 2020 2065 6e5f  .            en_
+0002f110: 7365 6172 6368 203d 2027 626f 756e 645f  search = 'bound_
+0002f120: 7b6c 7d2d 7b75 7d27 2e66 6f72 6d61 7428  {l}-{u}'.format(
+0002f130: 6c3d 6c6f 5f65 6e2e 746f 2827 6b65 5627  l=lo_en.to('keV'
+0002f140: 292e 7661 6c75 652c 2075 3d68 695f 656e  ).value, u=hi_en
+0002f150: 2e74 6f28 276b 6556 2729 2e76 616c 7565  .to('keV').value
+0002f160: 290a 0a20 2020 2020 2020 2069 6620 6f62  )..        if ob
+0002f170: 735f 6964 203d 3d20 2763 6f6d 6269 6e65  s_id == 'combine
+0002f180: 6427 3a0a 2020 2020 2020 2020 2020 2020  d':.            
+0002f190: 7365 6172 6368 5f6b 6579 203d 2027 636f  search_key = 'co
+0002f1a0: 6d62 696e 6564 5f6c 6967 6874 6375 7276  mbined_lightcurv
+0002f1b0: 6527 0a20 2020 2020 2020 2065 6c73 653a  e'.        else:
+0002f1c0: 0a20 2020 2020 2020 2020 2020 2073 6561  .            sea
+0002f1d0: 7263 685f 6b65 7920 3d20 276c 6967 6874  rch_key = 'light
+0002f1e0: 6375 7276 6527 0a20 2020 2020 2020 2023  curve'.        #
+0002f1f0: 2047 7261 6262 696e 6720 6576 6572 7920   Grabbing every 
+0002f200: 7369 6e67 6c65 206c 6967 6874 6375 7276  single lightcurv
+0002f210: 6520 7468 6174 206d 6174 6368 6573 204f  e that matches O
+0002f220: 6273 4944 2061 6e64 2069 6e73 7420 7061  bsID and inst pa
+0002f230: 7373 6564 2062 7920 7468 6520 7573 6572  ssed by the user
+0002f240: 2028 7265 6d65 6d62 6572 2074 6865 7920   (remember they 
+0002f250: 636f 756c 6420 6265 0a20 2020 2020 2020  could be.       
+0002f260: 2023 2020 4e6f 6e65 2076 616c 7565 732c   #  None values,
+0002f270: 2069 6e64 6565 6420 7468 6579 2061 7265   indeed they are
+0002f280: 2062 7920 6465 6661 756c 7429 202d 2077   by default) - w
+0002f290: 6527 6c6c 2074 6865 6e20 7377 6565 7020  e'll then sweep 
+0002f2a0: 7468 726f 7567 6820 7768 6174 6576 6572  through whatever
+0002f2b0: 206c 6973 7420 6973 2072 6574 7572 6e65   list is returne
+0002f2c0: 6420 616e 640a 2020 2020 2020 2020 2320  d and.        # 
+0002f2d0: 206e 6172 726f 7720 7468 656d 2064 6f77   narrow them dow
+0002f2e0: 6e0a 2020 2020 2020 2020 616c 6c5f 6c63  n.        all_lc
+0002f2f0: 7320 3d20 7365 6c66 2e67 6574 5f70 726f  s = self.get_pro
+0002f300: 6475 6374 7328 7365 6172 6368 5f6b 6579  ducts(search_key
+0002f310: 2c20 6f62 735f 6964 2c20 696e 7374 290a  , obs_id, inst).
+0002f320: 2020 2020 2020 2020 2320 4974 2077 6173          # It was
+0002f330: 2067 6574 7469 6e67 2074 6f20 7468 6520   getting to the 
+0002f340: 706f 696e 7420 7768 6572 6520 6120 6c69  point where a li
+0002f350: 7374 2063 6f6d 7072 6568 656e 7369 6f6e  st comprehension
+0002f360: 2077 6173 206c 6573 7320 7265 6164 6162   was less readab
+0002f370: 6c65 2074 6861 6e20 6120 666f 7220 6c6f  le than a for lo
+0002f380: 6f70 2c20 7061 7274 6963 756c 6172 6c79  op, particularly
+0002f390: 0a20 2020 2020 2020 2023 2020 7769 7468  .        #  with
+0002f3a0: 2074 6865 2070 6174 7465 726e 206c 6f67   the pattern log
+0002f3b0: 6963 2c20 736f 2049 2063 6861 6e67 6564  ic, so I changed
+0002f3c0: 2069 7420 746f 2074 6869 730a 2020 2020   it to this.    
+0002f3d0: 2020 2020 6d61 7463 6865 645f 7072 6f64      matched_prod
+0002f3e0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
+0002f3f0: 6f72 206c 6320 696e 2061 6c6c 5f6c 6373  or lc in all_lcs
+0002f400: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0002f410: 206f 7574 5f72 6164 5f73 6561 7263 6820   out_rad_search 
+0002f420: 696e 206c 632e 7374 6f72 6167 655f 6b65  in lc.storage_ke
+0002f430: 7920 616e 6420 696e 6e5f 7261 645f 7365  y and inn_rad_se
+0002f440: 6172 6368 2069 6e20 6c63 2e73 746f 7261  arch in lc.stora
+0002f450: 6765 5f6b 6579 2061 6e64 205c 0a20 2020  ge_key and \.   
+0002f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f470: 2074 696d 655f 6269 6e5f 7365 6172 6368   time_bin_search
+0002f480: 2069 6e20 6c63 2e73 746f 7261 6765 5f6b   in lc.storage_k
+0002f490: 6579 2061 6e64 2065 6e5f 7365 6172 6368  ey and en_search
+0002f4a0: 2069 6e20 6c63 2e73 746f 7261 6765 5f6b   in lc.storage_k
+0002f4b0: 6579 3a0a 2020 2020 2020 2020 2020 2020  ey:.            
+0002f4c0: 2020 2020 6d61 7463 6865 645f 7072 6f64      matched_prod
+0002f4d0: 732e 6170 7065 6e64 286c 6329 0a0a 2020  s.append(lc)..  
+0002f4e0: 2020 2020 2020 6966 206c 656e 286d 6174        if len(mat
+0002f4f0: 6368 6564 5f70 726f 6473 2920 3d3d 2030  ched_prods) == 0
+0002f500: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0002f510: 6973 6520 4e6f 5072 6f64 7563 7441 7661  ise NoProductAva
+0002f520: 696c 6162 6c65 4572 726f 7228 2243 616e  ilableError("Can
+0002f530: 6e6f 7420 6669 6e64 2061 6e79 206c 6967  not find any lig
+0002f540: 6874 6375 7276 6573 206d 6174 6368 696e  htcurves matchin
+0002f550: 6720 796f 7572 2069 6e70 7574 2e22 290a  g your input.").
+0002f560: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002f570: 6d61 7463 6865 645f 7072 6f64 730a 0a20  matched_prods.. 
+0002f580: 2020 2064 6566 2067 6574 5f6c 6967 6874     def get_light
+0002f590: 6375 7276 6573 2873 656c 662c 206f 7574  curves(self, out
+0002f5a0: 6572 5f72 6164 6975 733a 2055 6e69 6f6e  er_radius: Union
+0002f5b0: 5b73 7472 2c20 5175 616e 7469 7479 5d20  [str, Quantity] 
+0002f5c0: 3d20 4e6f 6e65 2c20 6f62 735f 6964 3a20  = None, obs_id: 
+0002f5d0: 7374 7220 3d20 4e6f 6e65 2c20 696e 7374  str = None, inst
+0002f5e0: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
+0002f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f600: 2020 2020 2020 696e 6e65 725f 7261 6469        inner_radi
+0002f610: 7573 3a20 556e 696f 6e5b 7374 722c 2051  us: Union[str, Q
+0002f620: 7561 6e74 6974 795d 203d 204e 6f6e 652c  uantity] = None,
+0002f630: 206c 6f5f 656e 3a20 5175 616e 7469 7479   lo_en: Quantity
+0002f640: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0002f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f660: 2068 695f 656e 3a20 5175 616e 7469 7479   hi_en: Quantity
+0002f670: 203d 204e 6f6e 652c 2074 696d 655f 6269   = None, time_bi
+0002f680: 6e5f 7369 7a65 3a20 5175 616e 7469 7479  n_size: Quantity
+0002f690: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0002f6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f6b0: 2070 6174 7465 726e 3a20 556e 696f 6e5b   pattern: Union[
+0002f6c0: 6469 6374 2c20 7374 725d 203d 2027 6465  dict, str] = 'de
+0002f6d0: 6661 756c 7427 2920 2d3e 2055 6e69 6f6e  fault') -> Union
+0002f6e0: 5b4c 6967 6874 4375 7276 652c 204c 6973  [LightCurve, Lis
+0002f6f0: 745b 4c69 6768 7443 7572 7665 5d5d 3a0a  t[LightCurve]]:.
+0002f700: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0002f710: 2020 2020 4120 6d65 7468 6f64 2074 6f20      A method to 
+0002f720: 7265 7472 6965 7665 2058 4741 204c 6967  retrieve XGA Lig
+0002f730: 6874 4375 7276 6520 6f62 6a65 6374 732e  htCurve objects.
+0002f740: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0002f750: 2073 7472 2f51 7561 6e74 6974 7920 6f75   str/Quantity ou
+0002f760: 7465 725f 7261 6469 7573 3a20 5468 6520  ter_radius: The 
+0002f770: 6e61 6d65 206f 7220 7661 6c75 6520 6f66  name or value of
+0002f780: 2074 6865 206f 7574 6572 2072 6164 6975   the outer radiu
+0002f790: 7320 7468 6174 2077 6173 2075 7365 6420  s that was used 
+0002f7a0: 666f 7220 7468 6520 6765 6e65 7261 7469  for the generati
+0002f7b0: 6f6e 206f 660a 2020 2020 2020 2020 2020  on of.          
+0002f7c0: 2020 7468 6520 6c69 6768 7463 7572 7665    the lightcurve
+0002f7d0: 2028 666f 7220 696e 7374 616e 6365 2027   (for instance '
+0002f7e0: 706f 696e 7427 2077 6f75 6c64 2062 6520  point' would be 
+0002f7f0: 6163 6365 7074 6162 6c65 2066 6f72 2061  acceptable for a
+0002f800: 2050 6f69 6e74 536f 7572 6365 2c20 6f72   PointSource, or
+0002f810: 2051 7561 6e74 6974 7928 3130 302c 2027   Quantity(100, '
+0002f820: 6b70 6327 2929 2e0a 2020 2020 2020 2020  kpc'))..        
+0002f830: 2020 2020 4465 6661 756c 7420 6973 204e      Default is N
+0002f840: 6f6e 652c 206d 6561 6e69 6e67 2061 6c6c  one, meaning all
+0002f850: 206c 6967 6874 6375 7276 6573 2077 696c   lightcurves wil
+0002f860: 6c20 6265 2072 6574 7269 6576 6564 2e0a  l be retrieved..
+0002f870: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+0002f880: 7472 206f 6273 5f69 643a 204f 7074 696f  tr obs_id: Optio
+0002f890: 6e61 6c6c 792c 2061 2073 7065 6369 6669  nally, a specifi
+0002f8a0: 6320 6f62 735f 6964 2074 6f20 7365 6172  c obs_id to sear
+0002f8b0: 6368 2066 6f72 2063 616e 2062 6520 7375  ch for can be su
+0002f8c0: 7070 6c69 6564 2e20 5468 6520 6465 6661  pplied. The defa
+0002f8d0: 756c 7420 6973 204e 6f6e 652c 0a20 2020  ult is None,.   
+0002f8e0: 2020 2020 2020 2020 2077 6869 6368 206d           which m
+0002f8f0: 6561 6e73 2061 6c6c 206c 6967 6874 6375  eans all lightcu
+0002f900: 7276 6573 206d 6174 6368 696e 6720 7468  rves matching th
+0002f910: 6520 6f74 6865 7220 6372 6974 6572 6961  e other criteria
+0002f920: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
+0002f930: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
+0002f940: 6d20 7374 7220 696e 7374 3a20 4f70 7469  m str inst: Opti
+0002f950: 6f6e 616c 6c79 2c20 6120 7370 6563 6966  onally, a specif
+0002f960: 6963 2069 6e73 7472 756d 656e 7420 746f  ic instrument to
+0002f970: 2073 6561 7263 6820 666f 7220 6361 6e20   search for can 
+0002f980: 6265 2073 7570 706c 6965 642e 2054 6865  be supplied. The
+0002f990: 2064 6566 6175 6c74 2069 7320 4e6f 6e65   default is None
+0002f9a0: 2c0a 2020 2020 2020 2020 2020 2020 7768  ,.            wh
+0002f9b0: 6963 6820 6d65 616e 7320 616c 6c20 6c69  ich means all li
+0002f9c0: 6768 7463 7572 7665 7320 6d61 7463 6869  ghtcurves matchi
+0002f9d0: 6e67 2074 6865 206f 7468 6572 2063 7269  ng the other cri
+0002f9e0: 7465 7269 6120 7769 6c6c 2062 6520 7265  teria will be re
+0002f9f0: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
+0002fa00: 3a70 6172 616d 2073 7472 2f51 7561 6e74  :param str/Quant
+0002fa10: 6974 7920 696e 6e65 725f 7261 6469 7573  ity inner_radius
+0002fa20: 3a20 5468 6520 6e61 6d65 206f 7220 7661  : The name or va
+0002fa30: 6c75 6520 6f66 2074 6865 2069 6e6e 6572  lue of the inner
+0002fa40: 2072 6164 6975 7320 7468 6174 2077 6173   radius that was
+0002fa50: 2075 7365 6420 666f 7220 7468 6520 6765   used for the ge
+0002fa60: 6e65 7261 7469 6f6e 206f 660a 2020 2020  neration of.    
+0002fa70: 2020 2020 2020 2020 7468 6520 6c69 6768          the ligh
+0002fa80: 7463 7572 7665 2028 666f 7220 696e 7374  tcurve (for inst
+0002fa90: 616e 6365 2027 706f 696e 7427 2077 6f75  ance 'point' wou
+0002faa0: 6c64 2062 6520 6163 6365 7074 6162 6c65  ld be acceptable
+0002fab0: 2066 6f72 2061 2050 6f69 6e74 536f 7572   for a PointSour
+0002fac0: 6365 2c20 6f72 2051 7561 6e74 6974 7928  ce, or Quantity(
+0002fad0: 302c 2027 6b70 6327 2929 2e0a 2020 2020  0, 'kpc'))..    
+0002fae0: 2020 2020 2020 2020 4465 6661 756c 7420          Default 
+0002faf0: 6973 204e 6f6e 652c 206d 6561 6e69 6e67  is None, meaning
+0002fb00: 2061 6c6c 206c 6967 6874 6375 7276 6573   all lightcurves
+0002fb10: 2077 696c 6c20 6265 2072 6574 7269 6576   will be retriev
+0002fb20: 6564 2e0a 2020 2020 2020 2020 3a70 6172  ed..        :par
+0002fb30: 616d 2051 7561 6e74 6974 7920 6c6f 5f65  am Quantity lo_e
+0002fb40: 6e3a 2054 6865 206c 6f77 6572 2065 6e65  n: The lower ene
+0002fb50: 7267 7920 6c69 6d69 7420 6f66 2074 6865  rgy limit of the
+0002fb60: 206c 6967 6874 6375 7276 6573 2079 6f75   lightcurves you
+0002fb70: 2077 6973 6820 746f 2072 6574 7269 6576   wish to retriev
+0002fb80: 652c 2074 6865 2064 6566 6175 6c74 0a20  e, the default. 
+0002fb90: 2020 2020 2020 2020 2020 2069 7320 4e6f             is No
+0002fba0: 6e65 2028 7768 6963 6820 7769 6c6c 2072  ne (which will r
+0002fbb0: 6574 7269 6576 6520 616c 6c20 6c69 6768  etrieve all ligh
+0002fbc0: 7463 7572 7665 7320 7265 6761 7264 6c65  tcurves regardle
+0002fbd0: 7373 206f 6620 656e 6572 6779 206c 696d  ss of energy lim
+0002fbe0: 6974 292e 0a20 2020 2020 2020 203a 7061  it)..        :pa
+0002fbf0: 7261 6d20 5175 616e 7469 7479 2068 695f  ram Quantity hi_
+0002fc00: 656e 3a20 5468 6520 7570 7065 7220 656e  en: The upper en
+0002fc10: 6572 6779 206c 696d 6974 206f 6620 7468  ergy limit of th
+0002fc20: 6520 6c69 6768 7463 7572 7665 7320 796f  e lightcurves yo
+0002fc30: 7520 7769 7368 2074 6f20 7265 7472 6965  u wish to retrie
+0002fc40: 7665 2c20 7468 6520 6465 6661 756c 740a  ve, the default.
+0002fc50: 2020 2020 2020 2020 2020 2020 6973 204e              is N
+0002fc60: 6f6e 6520 2877 6869 6368 2077 696c 6c20  one (which will 
+0002fc70: 7265 7472 6965 7665 2061 6c6c 206c 6967  retrieve all lig
+0002fc80: 6874 6375 7276 6573 2072 6567 6172 646c  htcurves regardl
+0002fc90: 6573 7320 6f66 2065 6e65 7267 7920 6c69  ess of energy li
+0002fca0: 6d69 7429 2e0a 2020 2020 2020 2020 3a70  mit)..        :p
+0002fcb0: 6172 616d 2051 7561 6e74 6974 7920 7469  aram Quantity ti
+0002fcc0: 6d65 5f62 696e 5f73 697a 653a 2054 6865  me_bin_size: The
+0002fcd0: 2074 696d 6520 6269 6e20 7369 7a65 2075   time bin size u
+0002fce0: 7365 6420 746f 2067 656e 6572 6174 6520  sed to generate 
+0002fcf0: 7468 6520 6465 7369 7265 6420 6c69 6768  the desired ligh
+0002fd00: 7463 7572 7665 2e20 5468 6520 6465 6661  tcurve. The defa
+0002fd10: 756c 7420 7661 6c75 650a 2020 2020 2020  ult value.      
+0002fd20: 2020 2020 2020 6973 204e 6f6e 652c 2069        is None, i
+0002fd30: 6e20 7768 6963 6820 6361 7365 2061 6c6c  n which case all
+0002fd40: 206c 6967 6874 6375 7276 6573 206d 6174   lightcurves mat
+0002fd50: 6368 696e 6720 6f74 6865 7220 6372 6974  ching other crit
+0002fd60: 6572 6961 2077 696c 6c20 6265 2072 6574  eria will be ret
+0002fd70: 7269 6576 6564 2e0a 2020 2020 2020 2020  rieved..        
+0002fd80: 3a70 6172 616d 2064 6963 7420 7061 7474  :param dict patt
+0002fd90: 6572 6e3a 2045 7665 6e74 2073 656c 6563  ern: Event selec
+0002fda0: 7469 6f6e 2070 6174 7465 726e 7320 7573  tion patterns us
+0002fdb0: 6564 2074 6f20 6372 6561 7465 206c 6967  ed to create lig
+0002fdc0: 6874 6375 7276 6573 206f 6620 696e 7465  htcurves of inte
+0002fdd0: 7265 7374 2e20 5468 6520 6465 6661 756c  rest. The defaul
+0002fde0: 7420 7661 6c75 6520 6973 0a20 2020 2020  t value is.     
+0002fdf0: 2020 2020 2020 2027 6465 6661 756c 7427         'default'
+0002fe00: 2077 6869 6368 2075 7365 7320 7468 6520   which uses the 
+0002fe10: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
+0002fe20: 6f72 2067 656e 6572 6174 696e 6720 6c69  or generating li
+0002fe30: 6768 7463 7572 7665 7320 666f 7220 6469  ghtcurves for di
+0002fe40: 6666 6572 656e 7420 696e 7374 7275 6d65  fferent instrume
+0002fe50: 6e74 732c 206f 7220 796f 750a 2020 2020  nts, or you.    
+0002fe60: 2020 2020 2020 2020 6361 6e20 7061 7373          can pass
+0002fe70: 2061 2064 6963 7469 6f6e 6172 7920 7769   a dictionary wi
+0002fe80: 7468 2070 6174 7465 726e 7320 696e 3b20  th patterns in; 
+0002fe90: 652e 672e 207b 2770 6e27 3a20 273c 3d34  e.g. {'pn': '<=4
+0002fea0: 272c 2027 6d6f 7327 3a20 273c 3d31 3227  ', 'mos': '<=12'
+0002feb0: 7d2e 2059 6f75 2063 616e 2061 6c73 6f20  }. You can also 
+0002fec0: 7061 7373 204e 6f6e 652c 2077 6869 6368  pass None, which
+0002fed0: 0a20 2020 2020 2020 2020 2020 206d 6561  .            mea
+0002fee0: 6e73 2061 6c6c 206c 6967 6874 2063 7572  ns all light cur
+0002fef0: 7665 7320 6d61 7463 6869 6e67 206f 7468  ves matching oth
+0002ff00: 6572 2073 6561 7263 6820 7465 726d 7320  er search terms 
+0002ff10: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
+0002ff20: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+0002ff30: 6e3a 2041 6e20 5847 4120 4c69 6768 7443  n: An XGA LightC
+0002ff40: 7572 7665 206f 626a 6563 7420 2869 6620  urve object (if 
+0002ff50: 7468 6572 6520 6973 2061 6e20 6578 6163  there is an exac
+0002ff60: 7420 6d61 7463 6829 2c20 6f72 2061 206c  t match), or a l
+0002ff70: 6973 7420 6f66 2058 4741 204c 6967 6874  ist of XGA Light
+0002ff80: 4375 7276 6520 6f62 6a65 6374 7320 2869  Curve objects (i
+0002ff90: 6620 7468 6572 650a 2020 2020 2020 2020  f there.        
+0002ffa0: 2020 2020 7765 7265 206d 756c 7469 706c      were multipl
+0002ffb0: 6520 6d61 7463 6869 6e67 2070 726f 6475  e matching produ
+0002ffc0: 6374 7329 2e0a 2020 2020 2020 2020 3a72  cts)..        :r
+0002ffd0: 7479 7065 3a20 556e 696f 6e5b 4c69 6768  type: Union[Ligh
+0002ffe0: 7443 7572 7665 2c20 4c69 7374 5b4c 6967  tCurve, List[Lig
+0002fff0: 6874 4375 7276 655d 5d0a 2020 2020 2020  htCurve]].      
+00030000: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00030010: 6f6d 2078 6761 2e73 6173 2069 6d70 6f72  om xga.sas impor
+00030020: 7420 6368 6563 6b5f 7061 7474 6572 6e0a  t check_pattern.
+00030030: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
+00030040: 5468 6973 2069 7320 584d 4d20 7370 6563  This is XMM spec
+00030050: 6966 6963 2062 6563 6175 7365 206f 6620  ific because of 
+00030060: 7468 6520 7061 7474 6572 6e73 2063 7572  the patterns cur
+00030070: 7265 6e74 6c79 0a20 2020 2020 2020 2023  rently.        #
+00030080: 2054 6869 7320 6973 2077 6865 7265 2077   This is where w
+00030090: 6520 7365 7420 7570 2074 6865 2073 6561  e set up the sea
+000300a0: 7263 6820 7374 7269 6e67 2066 6f72 2074  rch string for t
+000300b0: 6865 2070 6174 7465 726e 7320 7370 6563  he patterns spec
+000300c0: 6966 6965 6420 6279 2074 6865 2075 7365  ified by the use
+000300d0: 722e 0a20 2020 2020 2020 2069 6620 7061  r..        if pa
+000300e0: 7474 6572 6e20 6973 204e 6f6e 653a 0a20  ttern is None:. 
+000300f0: 2020 2020 2020 2020 2020 2070 6174 745f             patt_
+00030100: 7365 6172 6368 203d 2022 5f70 6174 7465  search = "_patte
+00030110: 726e 220a 2020 2020 2020 2020 656c 6966  rn".        elif
+00030120: 2069 7369 6e73 7461 6e63 6528 7061 7474   isinstance(patt
+00030130: 6572 6e2c 2073 7472 293a 0a20 2020 2020  ern, str):.     
+00030140: 2020 2020 2020 2070 6174 7465 726e 203d         pattern =
+00030150: 207b 2770 6e27 3a20 273c 3d34 272c 2027   {'pn': '<=4', '
+00030160: 6d6f 7327 3a20 273c 3d31 3227 7d0a 2020  mos': '<=12'}.  
+00030170: 2020 2020 2020 2020 2020 7061 7474 5f73            patt_s
+00030180: 6561 7263 6820 3d20 7b69 6e73 743a 2022  earch = {inst: "
+00030190: 5f70 6174 7465 726e 2220 2b20 6368 6563  _pattern" + chec
+000301a0: 6b5f 7061 7474 6572 6e28 7061 7474 295b  k_pattern(patt)[
+000301b0: 315d 2066 6f72 2069 6e73 742c 2070 6174  1] for inst, pat
+000301c0: 7420 696e 2070 6174 7465 726e 2e69 7465  t in pattern.ite
+000301d0: 6d73 2829 7d0a 2020 2020 2020 2020 656c  ms()}.        el
+000301e0: 6966 2069 7369 6e73 7461 6e63 6528 7061  if isinstance(pa
+000301f0: 7474 6572 6e2c 2064 6963 7429 3a0a 2020  ttern, dict):.  
+00030200: 2020 2020 2020 2020 2020 6966 2027 6d6f            if 'mo
+00030210: 7331 2720 696e 206c 6973 7428 7061 7474  s1' in list(patt
+00030220: 6572 6e2e 6b65 7973 2829 2920 6f72 2027  ern.keys()) or '
+00030230: 6d6f 7332 2720 696e 206c 6973 7428 7061  mos2' in list(pa
+00030240: 7474 6572 6e2e 6b65 7973 2829 293a 0a20  ttern.keys()):. 
+00030250: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00030260: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00030270: 2253 7065 6369 6669 6320 4d4f 5320 696e  "Specific MOS in
+00030280: 7374 7275 6d65 6e74 7320 646f 206e 6f74  struments do not
+00030290: 206e 6565 6420 746f 2062 6520 7370 6563   need to be spec
+000302a0: 6966 6965 6420 666f 7220 2770 6174 7465  ified for 'patte
+000302b0: 726e 273b 2069 2e65 2e20 7468 6572 6520  rn'; i.e. there 
+000302c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000302d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000302e0: 2020 2022 7368 6f75 6c64 2062 6520 6f6e     "should be on
+000302f0: 6520 656e 7472 7920 666f 7220 276d 6f73  e entry for 'mos
+00030300: 272e 2229 0a20 2020 2020 2020 2020 2020  '.").           
+00030310: 2070 6174 7465 726e 203d 207b 696e 7374   pattern = {inst
+00030320: 3a20 7061 7474 2e72 6570 6c61 6365 2827  : patt.replace('
+00030330: 2027 2c20 2727 2920 666f 7220 696e 7374   ', '') for inst
+00030340: 2c20 7061 7474 2069 6e20 7061 7474 6572  , patt in patter
+00030350: 6e2e 6974 656d 7328 297d 0a20 2020 2020  n.items()}.     
+00030360: 2020 2020 2020 2070 6174 745f 7365 6172         patt_sear
+00030370: 6368 203d 207b 696e 7374 3a20 225f 7061  ch = {inst: "_pa
+00030380: 7474 6572 6e22 202b 2063 6865 636b 5f70  ttern" + check_p
+00030390: 6174 7465 726e 2870 6174 7429 5b31 5d20  attern(patt)[1] 
+000303a0: 666f 7220 696e 7374 2c20 7061 7474 2069  for inst, patt i
+000303b0: 6e20 7061 7474 6572 6e2e 6974 656d 7328  n pattern.items(
+000303c0: 297d 0a20 2020 2020 2020 2065 6c73 653a  )}.        else:
+000303d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000303e0: 7365 2054 7970 6545 7272 6f72 2822 5468  se TypeError("Th
+000303f0: 6520 2770 6174 7465 726e 2720 6172 6775  e 'pattern' argu
+00030400: 6d65 6e74 206d 7573 7420 6265 2065 6974  ment must be eit
+00030410: 6865 7220 2764 6566 6175 6c74 272c 206f  her 'default', o
+00030420: 7220 6120 6469 6374 696f 6e61 7279 2077  r a dictionary w
+00030430: 6865 7265 2074 6865 206b 6579 7320 6172  here the keys ar
+00030440: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+00030450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030460: 2269 6e73 7472 756d 656e 7420 6e61 6d65  "instrument name
+00030470: 7320 616e 6420 7661 6c75 6573 2061 7265  s and values are
+00030480: 2073 7472 696e 6720 7061 7474 6572 6e73   string patterns
+00030490: 2e22 290a 0a20 2020 2020 2020 2023 204a  .")..        # J
+000304a0: 7573 7420 6d61 6b65 7320 7468 6520 7365  ust makes the se
+000304b0: 6172 6368 2065 6173 6965 7220 646f 776e  arch easier down
+000304c0: 2074 6865 206c 696e 650a 2020 2020 2020   the line.      
+000304d0: 2020 6966 2027 6d6f 7327 2069 6e20 7061    if 'mos' in pa
+000304e0: 7474 5f73 6561 7263 683a 0a20 2020 2020  tt_search:.     
+000304f0: 2020 2020 2020 2070 6174 745f 7365 6172         patt_sear
+00030500: 6368 2e75 7064 6174 6528 7b27 6d6f 7331  ch.update({'mos1
+00030510: 273a 2070 6174 745f 7365 6172 6368 5b27  ': patt_search['
+00030520: 6d6f 7327 5d2c 2027 6d6f 7332 273a 2070  mos'], 'mos2': p
+00030530: 6174 745f 7365 6172 6368 5b27 6d6f 7327  att_search['mos'
+00030540: 5d7d 290a 0a20 2020 2020 2020 2073 6f6d  ]})..        som
+00030550: 655f 6c63 7320 3d20 7365 6c66 2e5f 6765  e_lcs = self._ge
+00030560: 745f 6c63 5f70 726f 6428 6f75 7465 725f  t_lc_prod(outer_
+00030570: 7261 6469 7573 2c20 6f62 735f 6964 2c20  radius, obs_id, 
+00030580: 696e 7374 2c20 696e 6e65 725f 7261 6469  inst, inner_radi
+00030590: 7573 2c20 6c6f 5f65 6e2c 2068 695f 656e  us, lo_en, hi_en
+000305a0: 2c20 7469 6d65 5f62 696e 5f73 697a 6529  , time_bin_size)
+000305b0: 0a20 2020 2020 2020 206d 6174 6368 6564  .        matched
+000305c0: 5f70 726f 6473 203d 205b 5d0a 2020 2020  _prods = [].    
+000305d0: 2020 2020 666f 7220 6c63 2069 6e20 736f      for lc in so
+000305e0: 6d65 5f6c 6373 3a0a 2020 2020 2020 2020  me_lcs:.        
+000305f0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00030600: 6528 7061 7474 5f73 6561 7263 682c 2073  e(patt_search, s
+00030610: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
+00030620: 2020 2020 2072 656c 5f70 6174 745f 7365       rel_patt_se
+00030630: 6172 6368 203d 2070 6174 745f 7365 6172  arch = patt_sear
+00030640: 6368 0a20 2020 2020 2020 2020 2020 2065  ch.            e
+00030650: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00030660: 2020 2020 2072 656c 5f70 6174 745f 7365       rel_patt_se
+00030670: 6172 6368 203d 2070 6174 745f 7365 6172  arch = patt_sear
+00030680: 6368 5b6c 632e 696e 7374 7275 6d65 6e74  ch[lc.instrument
+00030690: 5d0a 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+000306a0: 6620 7265 6c5f 7061 7474 5f73 6561 7263  f rel_patt_searc
+000306b0: 6820 696e 206c 632e 7374 6f72 6167 655f  h in lc.storage_
+000306c0: 6b65 793a 0a20 2020 2020 2020 2020 2020  key:.           
+000306d0: 2020 2020 206d 6174 6368 6564 5f70 726f       matched_pro
+000306e0: 6473 2e61 7070 656e 6428 6c63 290a 0a20  ds.append(lc).. 
+000306f0: 2020 2020 2020 2069 6620 6c65 6e28 6d61         if len(ma
+00030700: 7463 6865 645f 7072 6f64 7329 203d 3d20  tched_prods) == 
+00030710: 313a 0a20 2020 2020 2020 2020 2020 206d  1:.            m
+00030720: 6174 6368 6564 5f70 726f 6473 203d 206d  atched_prods = m
+00030730: 6174 6368 6564 5f70 726f 6473 5b30 5d0a  atched_prods[0].
+00030740: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
+00030750: 286d 6174 6368 6564 5f70 726f 6473 2920  (matched_prods) 
+00030760: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00030770: 2020 7261 6973 6520 4e6f 5072 6f64 7563    raise NoProduc
+00030780: 7441 7661 696c 6162 6c65 4572 726f 7228  tAvailableError(
+00030790: 2243 616e 6e6f 7420 6669 6e64 2061 6e79  "Cannot find any
+000307a0: 206c 6967 6874 6375 7276 6573 206d 6174   lightcurves mat
+000307b0: 6368 696e 6720 796f 7572 2069 6e70 7574  ching your input
+000307c0: 2e22 290a 0a20 2020 2020 2020 2072 6574  .")..        ret
+000307d0: 7572 6e20 6d61 7463 6865 645f 7072 6f64  urn matched_prod
+000307e0: 730a 0a20 2020 2064 6566 2067 6574 5f63  s..    def get_c
+000307f0: 6f6d 6269 6e65 645f 6c69 6768 7463 7572  ombined_lightcur
+00030800: 7665 7328 7365 6c66 2c20 6f75 7465 725f  ves(self, outer_
+00030810: 7261 6469 7573 3a20 556e 696f 6e5b 7374  radius: Union[st
+00030820: 722c 2051 7561 6e74 6974 795d 203d 204e  r, Quantity] = N
+00030830: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00030840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030850: 2020 2020 2020 696e 6e65 725f 7261 6469        inner_radi
+00030860: 7573 3a20 556e 696f 6e5b 7374 722c 2051  us: Union[str, Q
+00030870: 7561 6e74 6974 795d 203d 204e 6f6e 652c  uantity] = None,
+00030880: 206c 6f5f 656e 3a20 5175 616e 7469 7479   lo_en: Quantity
+00030890: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000308a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000308b0: 2020 2020 2020 2020 2020 6869 5f65 6e3a            hi_en:
+000308c0: 2051 7561 6e74 6974 7920 3d20 4e6f 6e65   Quantity = None
+000308d0: 2c20 7469 6d65 5f62 696e 5f73 697a 653a  , time_bin_size:
+000308e0: 2051 7561 6e74 6974 7920 3d20 4e6f 6e65   Quantity = None
+000308f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00030900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030910: 2020 2070 6174 7465 726e 3a20 556e 696f     pattern: Unio
+00030920: 6e5b 6469 6374 2c20 7374 725d 203d 2022  n[dict, str] = "
+00030930: 6465 6661 756c 7422 2920 5c0a 2020 2020  default") \.    
+00030940: 2020 2020 2020 2020 2d3e 2055 6e69 6f6e          -> Union
+00030950: 5b41 6767 7265 6761 7465 4c69 6768 7443  [AggregateLightC
+00030960: 7572 7665 2c20 4c69 7374 5b41 6767 7265  urve, List[Aggre
+00030970: 6761 7465 4c69 6768 7443 7572 7665 5d5d  gateLightCurve]]
+00030980: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00030990: 2020 2020 2020 4120 6d65 7468 6f64 2074        A method t
+000309a0: 6f20 7265 7472 6965 7665 2058 4741 2041  o retrieve XGA A
+000309b0: 6767 7265 6761 7465 4c69 6768 7443 7572  ggregateLightCur
+000309c0: 7665 206f 626a 6563 7473 2028 692e 652e  ve objects (i.e.
+000309d0: 206c 6967 6874 6375 7276 6573 2066 6f72   lightcurves for
+000309e0: 2074 6869 7320 6f62 6a65 6374 2074 6861   this object tha
+000309f0: 7420 7765 7265 2067 656e 6572 6174 6564  t were generated
+00030a00: 2061 740a 2020 2020 2020 2020 7468 6520   at.        the 
+00030a10: 7361 6d65 2074 696d 6520 616e 6420 6861  same time and ha
+00030a20: 7665 2062 6565 6e20 7061 636b 6167 6564  ve been packaged
+00030a30: 2074 6f67 6574 6865 7229 2e0a 0a20 2020   together)...   
+00030a40: 2020 2020 203a 7061 7261 6d20 7374 722f       :param str/
+00030a50: 5175 616e 7469 7479 206f 7574 6572 5f72  Quantity outer_r
+00030a60: 6164 6975 733a 2054 6865 206e 616d 6520  adius: The name 
+00030a70: 6f72 2076 616c 7565 206f 6620 7468 6520  or value of the 
+00030a80: 6f75 7465 7220 7261 6469 7573 2074 6861  outer radius tha
+00030a90: 7420 7761 7320 7573 6564 2066 6f72 2074  t was used for t
+00030aa0: 6865 2067 656e 6572 6174 696f 6e20 6f66  he generation of
+00030ab0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00030ac0: 2061 6767 7265 6761 7465 206c 6967 6874   aggregate light
+00030ad0: 6375 7276 6520 2866 6f72 2069 6e73 7461  curve (for insta
+00030ae0: 6e63 6520 2770 6f69 6e74 2720 776f 756c  nce 'point' woul
+00030af0: 6420 6265 2061 6363 6570 7461 626c 6520  d be acceptable 
+00030b00: 666f 7220 6120 506f 696e 7453 6f75 7263  for a PointSourc
+00030b10: 652c 206f 720a 2020 2020 2020 2020 2020  e, or.          
+00030b20: 2020 5175 616e 7469 7479 2831 3030 2c20    Quantity(100, 
+00030b30: 276b 7063 2729 292e 2044 6566 6175 6c74  'kpc')). Default
+00030b40: 2069 7320 4e6f 6e65 2c20 6d65 616e 696e   is None, meanin
+00030b50: 6720 616c 6c20 6167 6772 6567 6174 6520  g all aggregate 
+00030b60: 6c69 6768 7463 7572 7665 7320 7769 6c6c  lightcurves will
+00030b70: 2062 6520 7265 7472 6965 7665 642e 0a20   be retrieved.. 
+00030b80: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+00030b90: 722f 5175 616e 7469 7479 2069 6e6e 6572  r/Quantity inner
+00030ba0: 5f72 6164 6975 733a 2054 6865 206e 616d  _radius: The nam
+00030bb0: 6520 6f72 2076 616c 7565 206f 6620 7468  e or value of th
+00030bc0: 6520 696e 6e65 7220 7261 6469 7573 2074  e inner radius t
+00030bd0: 6861 7420 7761 7320 7573 6564 2066 6f72  hat was used for
+00030be0: 2074 6865 2067 656e 6572 6174 696f 6e20   the generation 
+00030bf0: 6f66 0a20 2020 2020 2020 2020 2020 2074  of.            t
+00030c00: 6865 2061 6767 7265 6761 7465 206c 6967  he aggregate lig
+00030c10: 6874 6375 7276 6520 2866 6f72 2069 6e73  htcurve (for ins
+00030c20: 7461 6e63 6520 2770 6f69 6e74 2720 776f  tance 'point' wo
+00030c30: 756c 6420 6265 2061 6363 6570 7461 626c  uld be acceptabl
+00030c40: 6520 666f 7220 6120 506f 696e 7453 6f75  e for a PointSou
+00030c50: 7263 652c 206f 720a 2020 2020 2020 2020  rce, or.        
+00030c60: 2020 2020 5175 616e 7469 7479 2830 2c20      Quantity(0, 
+00030c70: 276b 7063 2729 292e 2044 6566 6175 6c74  'kpc')). Default
+00030c80: 2069 7320 4e6f 6e65 2c20 6d65 616e 696e   is None, meanin
+00030c90: 6720 616c 6c20 6167 6772 6567 6174 6520  g all aggregate 
+00030ca0: 6c69 6768 7463 7572 7665 7320 7769 6c6c  lightcurves will
+00030cb0: 2062 6520 7265 7472 6965 7665 642e 0a20   be retrieved.. 
+00030cc0: 2020 2020 2020 203a 7061 7261 6d20 5175         :param Qu
+00030cd0: 616e 7469 7479 206c 6f5f 656e 3a20 5468  antity lo_en: Th
+00030ce0: 6520 6c6f 7765 7220 656e 6572 6779 206c  e lower energy l
+00030cf0: 696d 6974 206f 6620 7468 6520 6167 6772  imit of the aggr
+00030d00: 6567 6174 6520 6c69 6768 7463 7572 7665  egate lightcurve
+00030d10: 7320 796f 7520 7769 7368 2074 6f20 7265  s you wish to re
+00030d20: 7472 6965 7665 2c20 7468 6520 6465 6661  trieve, the defa
+00030d30: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
+00030d40: 6973 204e 6f6e 6520 2877 6869 6368 2077  is None (which w
+00030d50: 696c 6c20 7265 7472 6965 7665 2061 6c6c  ill retrieve all
+00030d60: 2061 6767 7265 6761 7465 206c 6967 6874   aggregate light
+00030d70: 6375 7276 6573 2072 6567 6172 646c 6573  curves regardles
+00030d80: 7320 6f66 2065 6e65 7267 7920 6c69 6d69  s of energy limi
+00030d90: 7429 2e0a 2020 2020 2020 2020 3a70 6172  t)..        :par
+00030da0: 616d 2051 7561 6e74 6974 7920 6869 5f65  am Quantity hi_e
+00030db0: 6e3a 2054 6865 2075 7070 6572 2065 6e65  n: The upper ene
+00030dc0: 7267 7920 6c69 6d69 7420 6f66 2074 6865  rgy limit of the
+00030dd0: 2061 6767 7265 6761 7465 206c 6967 6874   aggregate light
+00030de0: 6375 7276 6573 2079 6f75 2077 6973 6820  curves you wish 
+00030df0: 746f 2072 6574 7269 6576 652c 2074 6865  to retrieve, the
+00030e00: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
+00030e10: 2020 2020 2069 7320 4e6f 6e65 2028 7768       is None (wh
+00030e20: 6963 6820 7769 6c6c 2072 6574 7269 6576  ich will retriev
+00030e30: 6520 616c 6c20 6167 6772 6567 6174 6520  e all aggregate 
+00030e40: 6c69 6768 7463 7572 7665 7320 7265 6761  lightcurves rega
+00030e50: 7264 6c65 7373 206f 6620 656e 6572 6779  rdless of energy
+00030e60: 206c 696d 6974 292e 0a20 2020 2020 2020   limit)..       
+00030e70: 203a 7061 7261 6d20 5175 616e 7469 7479   :param Quantity
+00030e80: 2074 696d 655f 6269 6e5f 7369 7a65 3a20   time_bin_size: 
+00030e90: 5468 6520 7469 6d65 2062 696e 2073 697a  The time bin siz
+00030ea0: 6520 7573 6564 2074 6f20 6765 6e65 7261  e used to genera
+00030eb0: 7465 2074 6865 2064 6573 6972 6564 2061  te the desired a
+00030ec0: 6767 7265 6761 7465 206c 6967 6874 6375  ggregate lightcu
+00030ed0: 7276 652e 2054 6865 0a20 2020 2020 2020  rve. The.       
+00030ee0: 2020 2020 2064 6566 6175 6c74 2076 616c       default val
+00030ef0: 7565 2069 7320 4e6f 6e65 2c20 696e 2077  ue is None, in w
+00030f00: 6869 6368 2063 6173 6520 616c 6c20 6167  hich case all ag
+00030f10: 6772 6567 6174 6520 6c69 6768 7463 7572  gregate lightcur
+00030f20: 7665 7320 6d61 7463 6869 6e67 206f 7468  ves matching oth
+00030f30: 6572 2063 7269 7465 7269 6120 7769 6c6c  er criteria will
+00030f40: 2062 6520 7265 7472 6965 7665 642e 0a20   be retrieved.. 
+00030f50: 2020 2020 2020 203a 7061 7261 6d20 6469         :param di
+00030f60: 6374 2070 6174 7465 726e 3a20 4576 656e  ct pattern: Even
+00030f70: 7420 7365 6c65 6374 696f 6e20 7061 7474  t selection patt
+00030f80: 6572 6e73 2075 7365 6420 746f 2063 7265  erns used to cre
+00030f90: 6174 6520 6167 6772 6567 6174 6520 6c69  ate aggregate li
+00030fa0: 6768 7463 7572 7665 7320 6f66 2069 6e74  ghtcurves of int
+00030fb0: 6572 6573 742e 2054 6865 2064 6566 6175  erest. The defau
+00030fc0: 6c74 0a20 2020 2020 2020 2020 2020 2069  lt.            i
+00030fd0: 7320 2764 6566 6175 6c74 2720 7768 6963  s 'default' whic
+00030fe0: 6820 7573 6573 2074 6865 2064 6566 6175  h uses the defau
+00030ff0: 6c74 2076 616c 7565 7320 666f 7220 6765  lt values for ge
+00031000: 6e65 7261 7469 6e67 206c 6967 6874 6375  nerating lightcu
+00031010: 7276 6573 2066 6f72 2064 6966 6665 7265  rves for differe
+00031020: 6e74 2069 6e73 7472 756d 656e 7473 2c20  nt instruments, 
+00031030: 6f72 2079 6f75 0a20 2020 2020 2020 2020  or you.         
+00031040: 2020 2063 616e 2070 6173 7320 6120 6469     can pass a di
+00031050: 6374 696f 6e61 7279 2077 6974 6820 7061  ctionary with pa
+00031060: 7474 6572 6e73 2069 6e3b 2065 2e67 2e20  tterns in; e.g. 
+00031070: 7b27 706e 273a 2027 3c3d 3427 2c20 276d  {'pn': '<=4', 'm
+00031080: 6f73 273a 2027 3c3d 3132 277d 2e20 596f  os': '<=12'}. Yo
+00031090: 7520 6361 6e20 616c 736f 2070 6173 7320  u can also pass 
+000310a0: 4e6f 6e65 2c20 7768 6963 680a 2020 2020  None, which.    
+000310b0: 2020 2020 2020 2020 6d65 616e 7320 616c          means al
+000310c0: 6c20 6167 6772 6567 6174 6520 206c 6967  l aggregate  lig
+000310d0: 6874 2063 7572 7665 7320 6d61 7463 6869  ht curves matchi
+000310e0: 6e67 206f 7468 6572 2073 6561 7263 6820  ng other search 
+000310f0: 7465 726d 7320 7769 6c6c 2062 6520 7265  terms will be re
+00031100: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
+00031110: 3a72 6574 7572 6e3a 2041 6e20 5847 4120  :return: An XGA 
+00031120: 4167 6772 6567 6174 654c 6967 6874 4375  AggregateLightCu
+00031130: 7276 6520 6f62 6a65 6374 2028 6966 2074  rve object (if t
+00031140: 6865 7265 2069 7320 616e 2065 7861 6374  here is an exact
+00031150: 206d 6174 6368 292c 206f 7220 6120 6c69   match), or a li
+00031160: 7374 206f 6620 5847 4120 4167 6772 6567  st of XGA Aggreg
+00031170: 6174 654c 6967 6874 4375 7276 650a 2020  ateLightCurve.  
+00031180: 2020 2020 2020 2020 2020 6f62 6a65 6374            object
+00031190: 7320 2869 6620 7468 6572 6520 7765 7265  s (if there were
+000311a0: 206d 756c 7469 706c 6520 6d61 7463 6869   multiple matchi
+000311b0: 6e67 2070 726f 6475 6374 7329 2e0a 2020  ng products)..  
+000311c0: 2020 2020 2020 3a72 7479 7065 3a20 556e        :rtype: Un
+000311d0: 696f 6e5b 4167 6772 6567 6174 654c 6967  ion[AggregateLig
+000311e0: 6874 4375 7276 652c 204c 6973 745b 4167  htCurve, List[Ag
+000311f0: 6772 6567 6174 654c 6967 6874 4375 7276  gregateLightCurv
+00031200: 655d 5d0a 2020 2020 2020 2020 2222 220a  e]].        """.
+00031210: 2020 2020 2020 2020 6672 6f6d 2078 6761          from xga
+00031220: 2e73 6173 2069 6d70 6f72 7420 6368 6563  .sas import chec
+00031230: 6b5f 7061 7474 6572 6e0a 0a20 2020 2020  k_pattern..     
+00031240: 2020 2023 2054 4f44 4f20 5468 6973 2069     # TODO This i
+00031250: 7320 584d 4d20 7370 6563 6966 6963 2062  s XMM specific b
+00031260: 6563 6175 7365 206f 6620 7468 6520 7061  ecause of the pa
+00031270: 7474 6572 6e73 2063 7572 7265 6e74 6c79  tterns currently
+00031280: 0a20 2020 2020 2020 2023 2054 6869 7320  .        # This 
+00031290: 6973 2077 6865 7265 2077 6520 7365 7420  is where we set 
+000312a0: 7570 2074 6865 2073 6561 7263 6820 7374  up the search st
+000312b0: 7269 6e67 2066 6f72 2074 6865 2070 6174  ring for the pat
+000312c0: 7465 726e 7320 7370 6563 6966 6965 6420  terns specified 
+000312d0: 6279 2074 6865 2075 7365 722e 0a20 2020  by the user..   
+000312e0: 2020 2020 2069 6620 7061 7474 6572 6e20       if pattern 
+000312f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00031300: 2020 2020 2070 6174 745f 7365 6172 6368       patt_search
+00031310: 203d 2022 7061 7474 6572 6e22 0a20 2020   = "pattern".   
+00031320: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00031330: 616e 6365 2870 6174 7465 726e 2c20 7374  ance(pattern, st
+00031340: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00031350: 7061 7474 6572 6e20 3d20 7b27 706e 273a  pattern = {'pn':
+00031360: 2027 3c3d 3427 2c20 276d 6f73 273a 2027   '<=4', 'mos': '
+00031370: 3c3d 3132 277d 0a20 2020 2020 2020 2020  <=12'}.         
+00031380: 2020 2070 6174 745f 7365 6172 6368 203d     patt_search =
+00031390: 207b 696e 7374 3a20 225f 7b69 7d70 6174   {inst: "_{i}pat
+000313a0: 7465 726e 222e 666f 726d 6174 2869 3d69  tern".format(i=i
+000313b0: 6e73 7429 202b 2063 6865 636b 5f70 6174  nst) + check_pat
+000313c0: 7465 726e 2870 6174 7429 5b31 5d0a 2020  tern(patt)[1].  
+000313d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000313e0: 2020 2020 2020 2020 2066 6f72 2069 6e73           for ins
+000313f0: 742c 2070 6174 7420 696e 2070 6174 7465  t, patt in patte
+00031400: 726e 2e69 7465 6d73 2829 7d0a 2020 2020  rn.items()}.    
+00031410: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+00031420: 6e63 6528 7061 7474 6572 6e2c 2064 6963  nce(pattern, dic
+00031430: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00031440: 6966 2027 6d6f 7331 2720 696e 206c 6973  if 'mos1' in lis
+00031450: 7428 7061 7474 6572 6e2e 6b65 7973 2829  t(pattern.keys()
+00031460: 2920 6f72 2027 6d6f 7332 2720 696e 206c  ) or 'mos2' in l
+00031470: 6973 7428 7061 7474 6572 6e2e 6b65 7973  ist(pattern.keys
+00031480: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+00031490: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000314a0: 4572 726f 7228 2253 7065 6369 6669 6320  Error("Specific 
+000314b0: 4d4f 5320 696e 7374 7275 6d65 6e74 7320  MOS instruments 
+000314c0: 646f 206e 6f74 206e 6565 6420 746f 2062  do not need to b
+000314d0: 6520 7370 6563 6966 6965 6420 666f 7220  e specified for 
+000314e0: 2770 6174 7465 726e 273b 2069 2e65 2e20  'pattern'; i.e. 
+000314f0: 7468 6572 6520 220a 2020 2020 2020 2020  there ".        
+00031500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031510: 2020 2020 2020 2020 2022 7368 6f75 6c64           "should
+00031520: 2062 6520 6f6e 6520 656e 7472 7920 666f   be one entry fo
+00031530: 7220 276d 6f73 272e 2229 0a20 2020 2020  r 'mos'.").     
+00031540: 2020 2020 2020 2070 6174 7465 726e 203d         pattern =
+00031550: 207b 696e 7374 3a20 7061 7474 2e72 6570   {inst: patt.rep
+00031560: 6c61 6365 2827 2027 2c20 2727 2920 666f  lace(' ', '') fo
+00031570: 7220 696e 7374 2c20 7061 7474 2069 6e20  r inst, patt in 
+00031580: 7061 7474 6572 6e2e 6974 656d 7328 297d  pattern.items()}
+00031590: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+000315a0: 745f 7365 6172 6368 203d 207b 696e 7374  t_search = {inst
+000315b0: 3a20 225f 7b69 7d70 6174 7465 726e 222e  : "_{i}pattern".
+000315c0: 666f 726d 6174 2869 3d69 6e73 7429 202b  format(i=inst) +
+000315d0: 2063 6865 636b 5f70 6174 7465 726e 2870   check_pattern(p
+000315e0: 6174 7429 5b31 5d0a 2020 2020 2020 2020  att)[1].        
+000315f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031600: 2020 2066 6f72 2069 6e73 742c 2070 6174     for inst, pat
+00031610: 7420 696e 2070 6174 7465 726e 2e69 7465  t in pattern.ite
+00031620: 6d73 2829 7d0a 2020 2020 2020 2020 656c  ms()}.        el
+00031630: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00031640: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+00031650: 2254 6865 2027 7061 7474 6572 6e27 2061  "The 'pattern' a
+00031660: 7267 756d 656e 7420 6d75 7374 2062 6520  rgument must be 
+00031670: 6569 7468 6572 2027 6465 6661 756c 7427  either 'default'
+00031680: 2c20 6f72 2061 2064 6963 7469 6f6e 6172  , or a dictionar
+00031690: 7920 7768 6572 6520 7468 6520 6b65 7973  y where the keys
+000316a0: 2061 7265 2022 0a20 2020 2020 2020 2020   are ".         
+000316b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000316c0: 2020 2022 696e 7374 7275 6d65 6e74 206e     "instrument n
+000316d0: 616d 6573 2061 6e64 2076 616c 7565 7320  ames and values 
+000316e0: 6172 6520 7374 7269 6e67 2070 6174 7465  are string patte
+000316f0: 726e 732e 2229 0a0a 2020 2020 2020 2020  rns.")..        
+00031700: 2320 5573 6520 7468 6520 696e 7465 726e  # Use the intern
+00031710: 616c 2066 756e 6374 696f 6e20 746f 2066  al function to f
+00031720: 696e 6420 7468 6520 636f 6d62 696e 6564  ind the combined
+00031730: 206c 6967 6874 2063 7572 7665 732c 2074   light curves, t
+00031740: 6865 6e20 6170 706c 7920 7061 7474 6572  hen apply patter
+00031750: 6e20 6368 6563 6b73 2061 6674 6572 0a20  n checks after. 
+00031760: 2020 2020 2020 2073 6f6d 655f 6c63 7320         some_lcs 
+00031770: 3d20 7365 6c66 2e5f 6765 745f 6c63 5f70  = self._get_lc_p
+00031780: 726f 6428 6f75 7465 725f 7261 6469 7573  rod(outer_radius
+00031790: 2c20 2763 6f6d 6269 6e65 6427 2c20 4e6f  , 'combined', No
+000317a0: 6e65 2c20 696e 6e65 725f 7261 6469 7573  ne, inner_radius
+000317b0: 2c20 6c6f 5f65 6e2c 2068 695f 656e 2c20  , lo_en, hi_en, 
+000317c0: 7469 6d65 5f62 696e 5f73 697a 6529 0a20  time_bin_size). 
+000317d0: 2020 2020 2020 206d 6174 6368 6564 5f70         matched_p
+000317e0: 726f 6473 203d 205b 5d0a 2020 2020 2020  rods = [].      
+000317f0: 2020 666f 7220 6c63 2069 6e20 736f 6d65    for lc in some
+00031800: 5f6c 6373 3a0a 2020 2020 2020 2020 2020  _lcs:.          
+00031810: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00031820: 7061 7474 5f73 6561 7263 682c 2073 7472  patt_search, str
+00031830: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00031840: 2020 2072 656c 5f70 6174 745f 7365 6172     rel_patt_sear
+00031850: 6368 203d 205b 7061 7474 5f73 6561 7263  ch = [patt_searc
+00031860: 685d 0a20 2020 2020 2020 2020 2020 2065  h].            e
+00031870: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00031880: 2020 2020 2072 656c 5f70 6174 745f 7365       rel_patt_se
+00031890: 6172 6368 203d 205b 7061 7474 2066 6f72  arch = [patt for
+000318a0: 2069 6e73 742c 2070 6174 7420 696e 2070   inst, patt in p
+000318b0: 6174 745f 7365 6172 6368 2e69 7465 6d73  att_search.items
+000318c0: 2829 5d0a 0a20 2020 2020 2020 2020 2020  ()]..           
+000318d0: 2069 6620 616c 6c28 5b72 7073 2069 6e20   if all([rps in 
+000318e0: 6c63 2e73 746f 7261 6765 5f6b 6579 2066  lc.storage_key f
+000318f0: 6f72 2072 7073 2069 6e20 7265 6c5f 7061  or rps in rel_pa
+00031900: 7474 5f73 6561 7263 685d 293a 0a20 2020  tt_search]):.   
+00031910: 2020 2020 2020 2020 2020 2020 206d 6174               mat
+00031920: 6368 6564 5f70 726f 6473 2e61 7070 656e  ched_prods.appen
+00031930: 6428 6c63 290a 0a20 2020 2020 2020 2069  d(lc)..        i
+00031940: 6620 6c65 6e28 6d61 7463 6865 645f 7072  f len(matched_pr
+00031950: 6f64 7329 203d 3d20 313a 0a20 2020 2020  ods) == 1:.     
+00031960: 2020 2020 2020 206d 6174 6368 6564 5f70         matched_p
+00031970: 726f 6473 203d 206d 6174 6368 6564 5f70  rods = matched_p
+00031980: 726f 6473 5b30 5d0a 2020 2020 2020 2020  rods[0].        
+00031990: 656c 6966 206c 656e 286d 6174 6368 6564  elif len(matched
+000319a0: 5f70 726f 6473 2920 3d3d 2030 3a0a 2020  _prods) == 0:.  
+000319b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000319c0: 4e6f 5072 6f64 7563 7441 7661 696c 6162  NoProductAvailab
+000319d0: 6c65 4572 726f 7228 2243 616e 6e6f 7420  leError("Cannot 
+000319e0: 6669 6e64 2061 6e79 206c 6967 6874 6375  find any lightcu
+000319f0: 7276 6573 206d 6174 6368 696e 6720 796f  rves matching yo
+00031a00: 7572 2069 6e70 7574 2e22 290a 0a20 2020  ur input.")..   
+00031a10: 2020 2020 2072 6574 7572 6e20 6d61 7463       return matc
+00031a20: 6865 645f 7072 6f64 730a 0a20 2020 2023  hed_prods..    #
+00031a30: 2054 6865 2063 6f6d 6269 6e65 6420 7068   The combined ph
+00031a40: 6f74 6f6d 6574 7269 6320 7072 6f64 7563  otometric produc
+00031a50: 7473 2064 6f6e 2774 2072 6561 6c6c 7920  ts don't really 
+00031a60: 4e45 4544 2074 6865 6972 206f 776e 2067  NEED their own g
+00031a70: 6574 206d 6574 686f 6473 2c20 6275 7420  et methods, but 
+00031a80: 4920 6669 6775 7265 6420 4920 776f 756c  I figured I woul
+00031a90: 6420 6a75 7374 2066 6f72 0a20 2020 2023  d just for.    #
+00031aa0: 2020 636c 6172 6974 7927 7320 7361 6b65    clarity's sake
+00031ab0: 0a20 2020 2064 6566 2067 6574 5f63 6f6d  .    def get_com
+00031ac0: 6269 6e65 645f 696d 6167 6573 2873 656c  bined_images(sel
+00031ad0: 662c 206c 6f5f 656e 3a20 5175 616e 7469  f, lo_en: Quanti
+00031ae0: 7479 203d 204e 6f6e 652c 2068 695f 656e  ty = None, hi_en
+00031af0: 3a20 5175 616e 7469 7479 203d 204e 6f6e  : Quantity = Non
+00031b00: 652c 2070 7366 5f63 6f72 723a 2062 6f6f  e, psf_corr: boo
+00031b10: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+00031b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031b30: 2020 2020 2020 2070 7366 5f6d 6f64 656c         psf_model
+00031b40: 3a20 7374 7220 3d20 2245 4c4c 4245 5441  : str = "ELLBETA
+00031b50: 222c 2070 7366 5f62 696e 733a 2069 6e74  ", psf_bins: int
+00031b60: 203d 2034 2c20 7073 665f 616c 676f 3a20   = 4, psf_algo: 
+00031b70: 7374 7220 3d20 2272 6c22 2c0a 2020 2020  str = "rl",.    
+00031b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031b90: 2020 2020 2020 2020 7073 665f 6974 6572          psf_iter
+00031ba0: 3a20 696e 7420 3d20 3135 2920 2d3e 2055  : int = 15) -> U
+00031bb0: 6e69 6f6e 5b49 6d61 6765 2c20 4c69 7374  nion[Image, List
+00031bc0: 5b49 6d61 6765 5d5d 3a0a 2020 2020 2020  [Image]]:.      
+00031bd0: 2020 2222 220a 2020 2020 2020 2020 4120    """.        A 
+00031be0: 6d65 7468 6f64 2074 6f20 7265 7472 6965  method to retrie
+00031bf0: 7665 2063 6f6d 6269 6e65 6420 5847 4120  ve combined XGA 
+00031c00: 496d 6167 6520 6f62 6a65 6374 732c 2061  Image objects, a
+00031c10: 7320 696e 2074 686f 7365 2069 6d61 6765  s in those image
+00031c20: 7320 7468 6174 2068 6176 6520 6265 656e  s that have been
+00031c30: 2063 7265 6174 6564 2062 790a 2020 2020   created by.    
+00031c40: 2020 2020 6d65 7267 696e 6720 616c 6c20      merging all 
+00031c50: 6176 6169 6c61 626c 6520 6461 7461 2066  available data f
+00031c60: 6f72 2074 6869 7320 736f 7572 6365 2e20  or this source. 
+00031c70: 5468 6973 2073 7570 706f 7274 7320 7468  This supports th
+00031c80: 6520 7265 7472 6965 7661 6c20 6f66 2062  e retrieval of b
+00031c90: 6f74 6820 5053 4620 636f 7272 6563 7465  oth PSF correcte
+00031ca0: 6420 616e 6420 6e6f 6e2d 5053 460a 2020  d and non-PSF.  
+00031cb0: 2020 2020 2020 636f 7272 6563 7465 6420        corrected 
+00031cc0: 696d 6167 6573 2c20 6173 2077 656c 6c20  images, as well 
+00031cd0: 6173 2073 6574 7469 6e67 2074 6865 2065  as setting the e
+00031ce0: 6e65 7267 7920 6c69 6d69 7473 206f 6620  nergy limits of 
+00031cf0: 7468 6520 7370 6563 6966 6963 2069 6d61  the specific ima
+00031d00: 6765 2079 6f75 2077 6f75 6c64 206c 696b  ge you would lik
+00031d10: 652e 2041 0a20 2020 2020 2020 204e 6f50  e. A.        NoP
+00031d20: 726f 6475 6374 4176 6169 6c61 626c 6545  roductAvailableE
+00031d30: 7272 6f72 2065 7272 6f72 2077 696c 6c20  rror error will 
+00031d40: 6265 2072 6169 7365 6420 6966 206e 6f20  be raised if no 
+00031d50: 6d61 7463 6865 7320 6172 6520 666f 756e  matches are foun
+00031d60: 642e 0a0a 2020 2020 2020 2020 3a70 6172  d...        :par
+00031d70: 616d 2051 7561 6e74 6974 7920 6c6f 5f65  am Quantity lo_e
+00031d80: 6e3a 2054 6865 206c 6f77 6572 2065 6e65  n: The lower ene
+00031d90: 7267 7920 6c69 6d69 7420 6f66 2074 6865  rgy limit of the
+00031da0: 2069 6d61 6765 2079 6f75 2077 6973 6820   image you wish 
+00031db0: 746f 2072 6574 7269 6576 652c 2074 6865  to retrieve, the
+00031dc0: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
+00031dd0: 2020 2020 2069 7320 4e6f 6e65 2028 7768       is None (wh
+00031de0: 6963 6820 7769 6c6c 2072 6574 7269 6576  ich will retriev
+00031df0: 6520 616c 6c20 696d 6167 6573 2072 6567  e all images reg
+00031e00: 6172 646c 6573 7320 6f66 2065 6e65 7267  ardless of energ
+00031e10: 7920 6c69 6d69 7429 2e0a 2020 2020 2020  y limit)..      
+00031e20: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
+00031e30: 7920 6869 5f65 6e3a 2054 6865 2075 7070  y hi_en: The upp
+00031e40: 6572 2065 6e65 7267 7920 6c69 6d69 7420  er energy limit 
+00031e50: 6f66 2074 6865 2069 6d61 6765 2079 6f75  of the image you
+00031e60: 2077 6973 6820 746f 2072 6574 7269 6576   wish to retriev
+00031e70: 652c 2074 6865 2064 6566 6175 6c74 0a20  e, the default. 
+00031e80: 2020 2020 2020 2020 2020 2069 7320 4e6f             is No
+00031e90: 6e65 2028 7768 6963 6820 7769 6c6c 2072  ne (which will r
+00031ea0: 6574 7269 6576 6520 616c 6c20 696d 6167  etrieve all imag
+00031eb0: 6573 2072 6567 6172 646c 6573 7320 6f66  es regardless of
+00031ec0: 2065 6e65 7267 7920 6c69 6d69 7429 2e0a   energy limit)..
+00031ed0: 2020 2020 2020 2020 3a70 6172 616d 2062          :param b
+00031ee0: 6f6f 6c20 7073 665f 636f 7272 3a20 5365  ool psf_corr: Se
+00031ef0: 7473 2077 6865 7468 6572 2079 6f75 2077  ts whether you w
+00031f00: 6973 6820 746f 2072 6574 7269 6576 6520  ish to retrieve 
+00031f10: 6120 5053 4620 636f 7272 6563 7465 6420  a PSF corrected 
+00031f20: 696d 6167 6520 6f72 206e 6f74 2e0a 2020  image or not..  
+00031f30: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
+00031f40: 2070 7366 5f6d 6f64 656c 3a20 4966 2074   psf_model: If t
+00031f50: 6865 2069 6d61 6765 2079 6f75 2077 616e  he image you wan
+00031f60: 7420 6973 2050 5346 2063 6f72 7265 6374  t is PSF correct
+00031f70: 6564 2c20 7468 6973 2069 7320 7468 6520  ed, this is the 
+00031f80: 5053 4620 6d6f 6465 6c20 7573 6564 2e0a  PSF model used..
+00031f90: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
+00031fa0: 6e74 2070 7366 5f62 696e 733a 2049 6620  nt psf_bins: If 
+00031fb0: 7468 6520 696d 6167 6520 796f 7520 7761  the image you wa
+00031fc0: 6e74 2069 7320 5053 4620 636f 7272 6563  nt is PSF correc
+00031fd0: 7465 642c 2074 6869 7320 6973 2074 6865  ted, this is the
+00031fe0: 206e 756d 6265 7220 6f66 2050 5346 7320   number of PSFs 
+00031ff0: 7065 720a 2020 2020 2020 2020 2020 2020  per.            
+00032000: 7369 6465 2069 6e20 7468 6520 5053 4620  side in the PSF 
+00032010: 6772 6964 2e0a 2020 2020 2020 2020 3a70  grid..        :p
+00032020: 6172 616d 2073 7472 2070 7366 5f61 6c67  aram str psf_alg
+00032030: 6f3a 2049 6620 7468 6520 696d 6167 6520  o: If the image 
+00032040: 796f 7520 7761 6e74 2069 7320 5053 4620  you want is PSF 
+00032050: 636f 7272 6563 7465 642c 2074 6869 7320  corrected, this 
+00032060: 6973 2074 6865 2061 6c67 6f72 6974 686d  is the algorithm
+00032070: 2075 7365 642e 0a20 2020 2020 2020 203a   used..        :
+00032080: 7061 7261 6d20 696e 7420 7073 665f 6974  param int psf_it
+00032090: 6572 3a20 4966 2074 6865 2069 6d61 6765  er: If the image
+000320a0: 2079 6f75 2077 616e 7420 6973 2050 5346   you want is PSF
+000320b0: 2063 6f72 7265 6374 6564 2c20 7468 6973   corrected, this
+000320c0: 2069 7320 7468 6520 6e75 6d62 6572 206f   is the number o
+000320d0: 6620 6974 6572 6174 696f 6e73 2e0a 2020  f iterations..  
+000320e0: 2020 2020 2020 3a72 6574 7572 6e3a 2041        :return: A
+000320f0: 6e20 5847 4120 496d 6167 6520 6f62 6a65  n XGA Image obje
+00032100: 6374 2028 6966 2074 6865 7265 2069 7320  ct (if there is 
+00032110: 616e 2065 7861 6374 206d 6174 6368 292c  an exact match),
+00032120: 206f 7220 6120 6c69 7374 206f 6620 5847   or a list of XG
+00032130: 4120 496d 6167 6520 6f62 6a65 6374 7320  A Image objects 
+00032140: 2869 6620 7468 6572 650a 2020 2020 2020  (if there.      
+00032150: 2020 2020 2020 7765 7265 206d 756c 7469        were multi
+00032160: 706c 6520 6d61 7463 6869 6e67 2070 726f  ple matching pro
+00032170: 6475 6374 7329 2e0a 2020 2020 2020 2020  ducts)..        
+00032180: 3a72 7479 7065 3a20 556e 696f 6e5b 496d  :rtype: Union[Im
+00032190: 6167 652c 204c 6973 745b 496d 6167 655d  age, List[Image]
+000321a0: 5d0a 2020 2020 2020 2020 2222 220a 0a20  ].        """.. 
+000321b0: 2020 2020 2020 2023 2043 6865 636b 7320         # Checks 
+000321c0: 746f 206d 616b 6520 7375 7265 2074 6861  to make sure tha
+000321d0: 7420 616e 2061 6c6c 6f77 6564 2063 6f6d  t an allowed com
+000321e0: 6269 6e61 7469 6f6e 206f 6620 6c6f 5f65  bination of lo_e
+000321f0: 6e20 616e 6420 6869 5f65 6e20 6861 7320  n and hi_en has 
+00032200: 6265 656e 2070 6173 7365 642e 0a20 2020  been passed..   
+00032210: 2020 2020 2069 6620 616c 6c28 5b6c 6f5f       if all([lo_
+00032220: 656e 2069 7320 4e6f 6e65 2c20 6869 5f65  en is None, hi_e
+00032230: 6e20 6973 204e 6f6e 655d 293a 0a20 2020  n is None]):.   
+00032240: 2020 2020 2020 2020 2023 2053 6574 7320           # Sets 
+00032250: 6120 666c 6167 2074 6f20 7465 6c6c 2074  a flag to tell t
+00032260: 6865 2072 6573 7420 6f66 2074 6865 206d  he rest of the m
+00032270: 6574 686f 6420 7768 6574 6865 7220 7765  ethod whether we
+00032280: 2068 6176 6520 656e 6572 6779 206c 696d   have energy lim
+00032290: 7320 6f72 206e 6f74 0a20 2020 2020 2020  s or not.       
+000322a0: 2020 2020 2077 6974 685f 6c69 6d73 203d       with_lims =
+000322b0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+000322c0: 2020 2065 6e65 7267 795f 6b65 7920 3d20     energy_key = 
+000322d0: 4e6f 6e65 0a20 2020 2020 2020 2065 6c69  None.        eli
+000322e0: 6620 616c 6c28 5b6c 6f5f 656e 2069 7320  f all([lo_en is 
+000322f0: 6e6f 7420 4e6f 6e65 2c20 6869 5f65 6e20  not None, hi_en 
+00032300: 6973 206e 6f74 204e 6f6e 655d 293a 0a20  is not None]):. 
+00032310: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+00032320: 6c69 6d73 203d 2054 7275 650a 2020 2020  lims = True.    
+00032330: 2020 2020 2020 2020 2320 5765 2068 6176          # We hav
+00032340: 6520 656e 6572 6779 206c 696d 6974 7320  e energy limits 
+00032350: 6865 7265 2073 6f20 7765 2061 7373 656d  here so we assem
+00032360: 626c 6520 7468 6520 6b65 7920 7468 6174  ble the key that
+00032370: 2064 6573 6372 6962 6573 2074 6865 2065   describes the e
+00032380: 6e65 7267 7920 7261 6e67 650a 2020 2020  nergy range.    
+00032390: 2020 2020 2020 2020 656e 6572 6779 5f6b          energy_k
+000323a0: 6579 203d 2022 626f 756e 645f 7b6c 7d2d  ey = "bound_{l}-
+000323b0: 7b68 7d22 2e66 6f72 6d61 7428 6c3d 6c6f  {h}".format(l=lo
+000323c0: 5f65 6e2e 746f 2827 6b65 5627 292e 7661  _en.to('keV').va
+000323d0: 6c75 652c 2068 3d68 695f 656e 2e74 6f28  lue, h=hi_en.to(
+000323e0: 276b 6556 2729 2e76 616c 7565 290a 2020  'keV').value).  
+000323f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00032400: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00032410: 6c75 6545 7272 6f72 2822 6c6f 5f65 6e20  lueError("lo_en 
+00032420: 616e 6420 6869 5f65 6e20 6d75 7374 2062  and hi_en must b
+00032430: 6520 6569 7468 6572 2042 4f54 4820 4e6f  e either BOTH No
+00032440: 6e65 206f 7220 424f 5448 2061 6e20 4173  ne or BOTH an As
+00032450: 7472 6f70 7920 7175 616e 7469 7479 2e22  tropy quantity."
+00032460: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
+00032470: 7765 2061 7265 206c 6f6f 6b69 6e67 2066  we are looking f
+00032480: 6f72 2061 2050 5346 2063 6f72 7265 6374  or a PSF correct
+00032490: 6564 2069 6d61 6765 2074 6865 6e20 7765  ed image then we
+000324a0: 2061 7373 656d 626c 6520 7468 6520 6578   assemble the ex
+000324b0: 7472 6120 6b65 7920 7769 7468 2050 5346  tra key with PSF
+000324c0: 2064 6574 6169 6c73 0a20 2020 2020 2020   details.       
+000324d0: 2069 6620 7073 665f 636f 7272 3a0a 2020   if psf_corr:.  
+000324e0: 2020 2020 2020 2020 2020 6578 7472 615f            extra_
+000324f0: 6b65 7920 3d20 225f 2220 2b20 7073 665f  key = "_" + psf_
+00032500: 6d6f 6465 6c20 2b20 225f 2220 2b20 7374  model + "_" + st
+00032510: 7228 7073 665f 6269 6e73 2920 2b20 225f  r(psf_bins) + "_
+00032520: 2220 2b20 7073 665f 616c 676f 202b 2073  " + psf_algo + s
+00032530: 7472 2870 7366 5f69 7465 7229 0a0a 2020  tr(psf_iter)..  
+00032540: 2020 2020 2020 6966 206e 6f74 2070 7366        if not psf
+00032550: 5f63 6f72 7220 616e 6420 7769 7468 5f6c  _corr and with_l
+00032560: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
+00032570: 2023 2053 696d 706c 6573 7420 6361 7365   # Simplest case
+00032580: 2c20 6a75 7374 2063 616c 6c69 6e67 2067  , just calling g
+00032590: 6574 5f70 726f 6475 6374 7320 616e 6420  et_products and 
+000325a0: 7061 7373 696e 6720 696e 206f 7572 2069  passing in our i
+000325b0: 6e66 6f72 6d61 7469 6f6e 0a20 2020 2020  nformation.     
+000325c0: 2020 2020 2020 206d 6174 6368 6564 5f70         matched_p
+000325d0: 726f 6473 203d 2073 656c 662e 6765 745f  rods = self.get_
+000325e0: 7072 6f64 7563 7473 2827 636f 6d62 696e  products('combin
+000325f0: 6564 5f69 6d61 6765 272c 2065 7874 7261  ed_image', extra
+00032600: 5f6b 6579 3d65 6e65 7267 795f 6b65 7929  _key=energy_key)
+00032610: 0a20 2020 2020 2020 2065 6c69 6620 6e6f  .        elif no
+00032620: 7420 7073 665f 636f 7272 2061 6e64 206e  t psf_corr and n
+00032630: 6f74 2077 6974 685f 6c69 6d73 3a0a 2020  ot with_lims:.  
+00032640: 2020 2020 2020 2020 2020 6272 6f61 645f            broad_
+00032650: 6d61 7463 6865 7320 3d20 7365 6c66 2e67  matches = self.g
+00032660: 6574 5f70 726f 6475 6374 7328 2263 6f6d  et_products("com
+00032670: 6269 6e65 645f 696d 6167 6522 290a 2020  bined_image").  
+00032680: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
+00032690: 645f 7072 6f64 7320 3d20 5b70 2066 6f72  d_prods = [p for
+000326a0: 2070 2069 6e20 6272 6f61 645f 6d61 7463   p in broad_matc
+000326b0: 6865 7320 6966 206e 6f74 2070 2e70 7366  hes if not p.psf
+000326c0: 5f63 6f72 7265 6374 6564 5d0a 2020 2020  _corrected].    
+000326d0: 2020 2020 656c 6966 2070 7366 5f63 6f72      elif psf_cor
+000326e0: 7220 616e 6420 7769 7468 5f6c 696d 733a  r and with_lims:
+000326f0: 0a20 2020 2020 2020 2020 2020 2023 2048  .            # H
+00032700: 6572 6520 7765 206e 6565 6420 746f 2061  ere we need to a
+00032710: 6464 2074 6865 2065 7874 7261 206b 6579  dd the extra key
+00032720: 2074 6f20 7468 6520 656e 6572 6779 206b   to the energy k
+00032730: 6579 0a20 2020 2020 2020 2020 2020 206d  ey.            m
+00032740: 6174 6368 6564 5f70 726f 6473 203d 2073  atched_prods = s
+00032750: 656c 662e 6765 745f 7072 6f64 7563 7473  elf.get_products
+00032760: 2827 636f 6d62 696e 6564 5f69 6d61 6765  ('combined_image
+00032770: 272c 2065 7874 7261 5f6b 6579 3d65 6e65  ', extra_key=ene
+00032780: 7267 795f 6b65 7920 2b20 6578 7472 615f  rgy_key + extra_
+00032790: 6b65 7929 0a20 2020 2020 2020 2065 6c69  key).        eli
+000327a0: 6620 7073 665f 636f 7272 2061 6e64 206e  f psf_corr and n
+000327b0: 6f74 2077 6974 685f 6c69 6d73 3a0a 2020  ot with_lims:.  
+000327c0: 2020 2020 2020 2020 2020 2320 4865 7265            # Here
+000327d0: 2077 6520 646f 6e27 7420 6b6e 6f77 2074   we don't know t
+000327e0: 6865 2065 6e65 7267 7920 6b65 792c 2073  he energy key, s
+000327f0: 6f20 7765 2068 6176 6520 746f 206c 6f6f  o we have to loo
+00032800: 6b20 666f 7220 7061 7274 6961 6c20 6d61  k for partial ma
+00032810: 7463 6865 7320 696e 2074 6865 2067 6574  tches in the get
+00032820: 5f70 726f 6475 6374 7320 7265 7475 726e  _products return
+00032830: 0a20 2020 2020 2020 2020 2020 2062 726f  .            bro
+00032840: 6164 5f6d 6174 6368 6573 203d 2073 656c  ad_matches = sel
+00032850: 662e 6765 745f 7072 6f64 7563 7473 2827  f.get_products('
+00032860: 636f 6d62 696e 6564 5f69 6d61 6765 272c  combined_image',
+00032870: 2065 7874 7261 5f6b 6579 3d4e 6f6e 652c   extra_key=None,
+00032880: 206a 7573 745f 6f62 6a3d 4661 6c73 6529   just_obj=False)
+00032890: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
+000328a0: 6368 6564 5f70 726f 6473 203d 205b 705b  ched_prods = [p[
+000328b0: 2d31 5d20 666f 7220 7020 696e 2062 726f  -1] for p in bro
+000328c0: 6164 5f6d 6174 6368 6573 2069 6620 6578  ad_matches if ex
+000328d0: 7472 615f 6b65 7920 696e 2070 5b2d 325d  tra_key in p[-2]
+000328e0: 5d0a 0a20 2020 2020 2020 2069 6620 6c65  ]..        if le
+000328f0: 6e28 6d61 7463 6865 645f 7072 6f64 7329  n(matched_prods)
+00032900: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00032910: 2020 206d 6174 6368 6564 5f70 726f 6473     matched_prods
+00032920: 203d 206d 6174 6368 6564 5f70 726f 6473   = matched_prods
+00032930: 5b30 5d0a 2020 2020 2020 2020 656c 6966  [0].        elif
+00032940: 206c 656e 286d 6174 6368 6564 5f70 726f   len(matched_pro
+00032950: 6473 2920 3d3d 2030 3a0a 2020 2020 2020  ds) == 0:.      
+00032960: 2020 2020 2020 7261 6973 6520 4e6f 5072        raise NoPr
+00032970: 6f64 7563 7441 7661 696c 6162 6c65 4572  oductAvailableEr
+00032980: 726f 7228 2243 616e 6e6f 7420 6669 6e64  ror("Cannot find
+00032990: 2061 6e79 2063 6f6d 6269 6e65 6420 696d   any combined im
+000329a0: 6167 6573 206d 6174 6368 696e 6720 796f  ages matching yo
+000329b0: 7572 2069 6e70 7574 2e22 290a 0a20 2020  ur input.")..   
+000329c0: 2020 2020 2072 6574 7572 6e20 6d61 7463       return matc
+000329d0: 6865 645f 7072 6f64 730a 0a20 2020 2064  hed_prods..    d
+000329e0: 6566 2067 6574 5f63 6f6d 6269 6e65 645f  ef get_combined_
+000329f0: 6578 706d 6170 7328 7365 6c66 2c20 6c6f  expmaps(self, lo
+00032a00: 5f65 6e3a 2051 7561 6e74 6974 7920 3d20  _en: Quantity = 
+00032a10: 4e6f 6e65 2c20 6869 5f65 6e3a 2051 7561  None, hi_en: Qua
+00032a20: 6e74 6974 7920 3d20 4e6f 6e65 2920 2d3e  ntity = None) ->
+00032a30: 2055 6e69 6f6e 5b45 7870 4d61 702c 204c   Union[ExpMap, L
+00032a40: 6973 745b 4578 704d 6170 5d5d 3a0a 2020  ist[ExpMap]]:.  
+00032a50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00032a60: 2020 4120 6d65 7468 6f64 2074 6f20 7265    A method to re
+00032a70: 7472 6965 7665 2063 6f6d 6269 6e65 6420  trieve combined 
+00032a80: 5847 4120 4578 704d 6170 206f 626a 6563  XGA ExpMap objec
+00032a90: 7473 2c20 6173 2069 6e20 7468 6f73 6520  ts, as in those 
+00032aa0: 6578 706f 7375 7265 206d 6170 7320 7468  exposure maps th
+00032ab0: 6174 2068 6176 6520 6265 656e 2063 7265  at have been cre
+00032ac0: 6174 6564 2062 790a 2020 2020 2020 2020  ated by.        
+00032ad0: 6d65 7267 696e 6720 616c 6c20 6176 6169  merging all avai
+00032ae0: 6c61 626c 6520 6461 7461 2066 6f72 2074  lable data for t
+00032af0: 6869 7320 736f 7572 6365 2e20 5468 6973  his source. This
+00032b00: 2073 7570 706f 7274 7320 7365 7474 696e   supports settin
+00032b10: 6720 7468 6520 656e 6572 6779 206c 696d  g the energy lim
+00032b20: 6974 7320 6f66 2074 6865 2073 7065 6369  its of the speci
+00032b30: 6669 630a 2020 2020 2020 2020 6578 706f  fic.        expo
+00032b40: 7375 7265 206d 6170 7320 796f 7520 776f  sure maps you wo
+00032b50: 756c 6420 6c69 6b65 2e20 4120 4e6f 5072  uld like. A NoPr
+00032b60: 6f64 7563 7441 7661 696c 6162 6c65 4572  oductAvailableEr
+00032b70: 726f 7220 6572 726f 7220 7769 6c6c 2062  ror error will b
+00032b80: 6520 7261 6973 6564 2069 6620 6e6f 206d  e raised if no m
+00032b90: 6174 6368 6573 2061 7265 2066 6f75 6e64  atches are found
+00032ba0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+00032bb0: 6d20 5175 616e 7469 7479 206c 6f5f 656e  m Quantity lo_en
+00032bc0: 3a20 5468 6520 6c6f 7765 7220 656e 6572  : The lower ener
+00032bd0: 6779 206c 696d 6974 206f 6620 7468 6520  gy limit of the 
+00032be0: 6578 706f 7375 7265 206d 6170 7320 796f  exposure maps yo
+00032bf0: 7520 7769 7368 2074 6f20 7265 7472 6965  u wish to retrie
+00032c00: 7665 2c20 7468 6520 6465 6661 756c 740a  ve, the default.
+00032c10: 2020 2020 2020 2020 2020 2020 6973 204e              is N
+00032c20: 6f6e 6520 2877 6869 6368 2077 696c 6c20  one (which will 
+00032c30: 7265 7472 6965 7665 2061 6c6c 2069 6d61  retrieve all ima
+00032c40: 6765 7320 7265 6761 7264 6c65 7373 206f  ges regardless o
+00032c50: 6620 656e 6572 6779 206c 696d 6974 292e  f energy limit).
+00032c60: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00032c70: 5175 616e 7469 7479 2068 695f 656e 3a20  Quantity hi_en: 
+00032c80: 5468 6520 7570 7065 7220 656e 6572 6779  The upper energy
+00032c90: 206c 696d 6974 206f 6620 7468 6520 6578   limit of the ex
+00032ca0: 706f 7375 7265 206d 6170 7320 796f 7520  posure maps you 
+00032cb0: 7769 7368 2074 6f20 7265 7472 6965 7665  wish to retrieve
+00032cc0: 2c20 7468 6520 6465 6661 756c 740a 2020  , the default.  
+00032cd0: 2020 2020 2020 2020 2020 6973 204e 6f6e            is Non
+00032ce0: 6520 2877 6869 6368 2077 696c 6c20 7265  e (which will re
+00032cf0: 7472 6965 7665 2061 6c6c 2069 6d61 6765  trieve all image
+00032d00: 7320 7265 6761 7264 6c65 7373 206f 6620  s regardless of 
+00032d10: 656e 6572 6779 206c 696d 6974 292e 0a20  energy limit).. 
+00032d20: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+00032d30: 416e 2058 4741 2045 7870 4d61 7020 6f62  An XGA ExpMap ob
+00032d40: 6a65 6374 2028 6966 2074 6865 7265 2069  ject (if there i
+00032d50: 7320 616e 2065 7861 6374 206d 6174 6368  s an exact match
+00032d60: 292c 206f 7220 6120 6c69 7374 206f 6620  ), or a list of 
+00032d70: 5847 4120 496d 6167 6520 6f62 6a65 6374  XGA Image object
+00032d80: 7320 2869 6620 7468 6572 650a 2020 2020  s (if there.    
+00032d90: 2020 2020 2020 2020 7765 7265 206d 756c          were mul
+00032da0: 7469 706c 6520 6d61 7463 6869 6e67 2070  tiple matching p
+00032db0: 726f 6475 6374 7329 2e0a 2020 2020 2020  roducts)..      
+00032dc0: 2020 3a72 7479 7065 3a20 556e 696f 6e5b    :rtype: Union[
+00032dd0: 4578 704d 6170 2c20 4c69 7374 5b45 7870  ExpMap, List[Exp
+00032de0: 4d61 705d 5d0a 2020 2020 2020 2020 2222  Map]].        ""
+00032df0: 220a 2020 2020 2020 2020 6966 2061 6c6c  ".        if all
+00032e00: 285b 6c6f 5f65 6e20 6973 204e 6f6e 652c  ([lo_en is None,
+00032e10: 2068 695f 656e 2069 7320 4e6f 6e65 5d29   hi_en is None])
+00032e20: 3a0a 2020 2020 2020 2020 2020 2020 656e  :.            en
+00032e30: 6572 6779 5f6b 6579 203d 204e 6f6e 650a  ergy_key = None.
+00032e40: 2020 2020 2020 2020 656c 6966 2061 6c6c          elif all
+00032e50: 285b 6c6f 5f65 6e20 6973 206e 6f74 204e  ([lo_en is not N
+00032e60: 6f6e 652c 2068 695f 656e 2069 7320 6e6f  one, hi_en is no
+00032e70: 7420 4e6f 6e65 5d29 3a0a 2020 2020 2020  t None]):.      
+00032e80: 2020 2020 2020 656e 6572 6779 5f6b 6579        energy_key
+00032e90: 203d 2022 626f 756e 645f 7b6c 7d2d 7b68   = "bound_{l}-{h
+00032ea0: 7d22 2e66 6f72 6d61 7428 6c3d 6c6f 5f65  }".format(l=lo_e
+00032eb0: 6e2e 746f 2827 6b65 5627 292e 7661 6c75  n.to('keV').valu
+00032ec0: 652c 2068 3d68 695f 656e 2e74 6f28 276b  e, h=hi_en.to('k
+00032ed0: 6556 2729 2e76 616c 7565 290a 2020 2020  eV').value).    
+00032ee0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00032ef0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00032f00: 6545 7272 6f72 2822 6c6f 5f65 6e20 616e  eError("lo_en an
+00032f10: 6420 6869 5f65 6e20 6d75 7374 2062 6520  d hi_en must be 
+00032f20: 6569 7468 6572 2042 4f54 4820 4e6f 6e65  either BOTH None
+00032f30: 206f 7220 424f 5448 2061 6e20 4173 7472   or BOTH an Astr
+00032f40: 6f70 7920 7175 616e 7469 7479 2e22 290a  opy quantity.").
+00032f50: 0a20 2020 2020 2020 206d 6174 6368 6564  .        matched
+00032f60: 5f70 726f 6473 203d 2073 656c 662e 6765  _prods = self.ge
+00032f70: 745f 7072 6f64 7563 7473 2827 636f 6d62  t_products('comb
+00032f80: 696e 6564 5f65 7870 6d61 7027 2c20 6578  ined_expmap', ex
+00032f90: 7472 615f 6b65 793d 656e 6572 6779 5f6b  tra_key=energy_k
+00032fa0: 6579 290a 2020 2020 2020 2020 6966 206c  ey).        if l
+00032fb0: 656e 286d 6174 6368 6564 5f70 726f 6473  en(matched_prods
+00032fc0: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+00032fd0: 2020 2020 6d61 7463 6865 645f 7072 6f64      matched_prod
+00032fe0: 7320 3d20 6d61 7463 6865 645f 7072 6f64  s = matched_prod
+00032ff0: 735b 305d 0a20 2020 2020 2020 2065 6c69  s[0].        eli
+00033000: 6620 6c65 6e28 6d61 7463 6865 645f 7072  f len(matched_pr
+00033010: 6f64 7329 203d 3d20 303a 0a20 2020 2020  ods) == 0:.     
+00033020: 2020 2020 2020 2072 6169 7365 204e 6f50         raise NoP
+00033030: 726f 6475 6374 4176 6169 6c61 626c 6545  roductAvailableE
+00033040: 7272 6f72 2822 4361 6e6e 6f74 2066 696e  rror("Cannot fin
+00033050: 6420 616e 7920 636f 6d62 696e 6564 2065  d any combined e
+00033060: 7870 6f73 7572 6520 6d61 7073 206d 6174  xposure maps mat
+00033070: 6368 696e 6720 796f 7572 2069 6e70 7574  ching your input
+00033080: 2e22 290a 0a20 2020 2020 2020 2072 6574  .")..        ret
+00033090: 7572 6e20 6d61 7463 6865 645f 7072 6f64  urn matched_prod
+000330a0: 730a 0a20 2020 2064 6566 2067 6574 5f63  s..    def get_c
+000330b0: 6f6d 6269 6e65 645f 7261 7465 6d61 7073  ombined_ratemaps
+000330c0: 2873 656c 662c 206c 6f5f 656e 3a20 5175  (self, lo_en: Qu
+000330d0: 616e 7469 7479 203d 204e 6f6e 652c 2068  antity = None, h
+000330e0: 695f 656e 3a20 5175 616e 7469 7479 203d  i_en: Quantity =
+000330f0: 204e 6f6e 652c 2020 7073 665f 636f 7272   None,  psf_corr
+00033100: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00033110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033120: 2020 2020 2020 2020 2020 2020 2020 7073                ps
+00033130: 665f 6d6f 6465 6c3a 2073 7472 203d 2022  f_model: str = "
+00033140: 454c 4c42 4554 4122 2c20 7073 665f 6269  ELLBETA", psf_bi
+00033150: 6e73 3a20 696e 7420 3d20 342c 2070 7366  ns: int = 4, psf
+00033160: 5f61 6c67 6f3a 2073 7472 203d 2022 726c  _algo: str = "rl
+00033170: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00033180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033190: 2070 7366 5f69 7465 723a 2069 6e74 203d   psf_iter: int =
+000331a0: 2031 3529 202d 3e20 556e 696f 6e5b 5261   15) -> Union[Ra
+000331b0: 7465 4d61 702c 204c 6973 745b 5261 7465  teMap, List[Rate
+000331c0: 4d61 705d 5d3a 0a20 2020 2020 2020 2022  Map]]:.        "
+000331d0: 2222 0a20 2020 2020 2020 2041 206d 6574  "".        A met
+000331e0: 686f 6420 746f 2072 6574 7269 6576 6520  hod to retrieve 
+000331f0: 636f 6d62 696e 6564 2058 4741 2052 6174  combined XGA Rat
+00033200: 654d 6170 206f 626a 6563 7473 2c20 6173  eMap objects, as
+00033210: 2069 6e20 7468 6f73 6520 7261 7465 6d61   in those ratema
+00033220: 7020 7468 6174 2068 6176 6520 6265 656e  p that have been
+00033230: 2063 7265 6174 6564 2062 790a 2020 2020   created by.    
+00033240: 2020 2020 6d65 7267 696e 6720 616c 6c20      merging all 
+00033250: 6176 6169 6c61 626c 6520 6461 7461 2066  available data f
+00033260: 6f72 2074 6869 7320 736f 7572 6365 2e20  or this source. 
+00033270: 5468 6973 2073 7570 706f 7274 7320 7468  This supports th
+00033280: 6520 7265 7472 6965 7661 6c20 6f66 2062  e retrieval of b
+00033290: 6f74 6820 5053 4620 636f 7272 6563 7465  oth PSF correcte
+000332a0: 6420 616e 6420 6e6f 6e2d 5053 460a 2020  d and non-PSF.  
+000332b0: 2020 2020 2020 636f 7272 6563 7465 6420        corrected 
+000332c0: 7261 7465 6d61 7073 2c20 6173 2077 656c  ratemaps, as wel
+000332d0: 6c20 6173 2073 6574 7469 6e67 2074 6865  l as setting the
+000332e0: 2065 6e65 7267 7920 6c69 6d69 7473 206f   energy limits o
+000332f0: 6620 7468 6520 7370 6563 6966 6963 2072  f the specific r
+00033300: 6174 656d 6170 2079 6f75 2077 6f75 6c64  atemap you would
+00033310: 206c 696b 652e 2041 0a20 2020 2020 2020   like. A.       
+00033320: 204e 6f50 726f 6475 6374 4176 6169 6c61   NoProductAvaila
+00033330: 626c 6545 7272 6f72 2065 7272 6f72 2077  bleError error w
+00033340: 696c 6c20 6265 2072 6169 7365 6420 6966  ill be raised if
+00033350: 206e 6f20 6d61 7463 6865 7320 6172 6520   no matches are 
+00033360: 666f 756e 642e 0a0a 2020 2020 2020 2020  found...        
+00033370: 3a70 6172 616d 2051 7561 6e74 6974 7920  :param Quantity 
+00033380: 6c6f 5f65 6e3a 2054 6865 206c 6f77 6572  lo_en: The lower
+00033390: 2065 6e65 7267 7920 6c69 6d69 7420 6f66   energy limit of
+000333a0: 2074 6865 2072 6174 656d 6170 7320 796f   the ratemaps yo
+000333b0: 7520 7769 7368 2074 6f20 7265 7472 6965  u wish to retrie
+000333c0: 7665 2c20 7468 6520 6465 6661 756c 740a  ve, the default.
+000333d0: 2020 2020 2020 2020 2020 2020 6973 204e              is N
+000333e0: 6f6e 6520 2877 6869 6368 2077 696c 6c20  one (which will 
+000333f0: 7265 7472 6965 7665 2061 6c6c 2072 6174  retrieve all rat
+00033400: 656d 6170 7320 7265 6761 7264 6c65 7373  emaps regardless
+00033410: 206f 6620 656e 6572 6779 206c 696d 6974   of energy limit
+00033420: 292e 0a20 2020 2020 2020 203a 7061 7261  )..        :para
+00033430: 6d20 5175 616e 7469 7479 2068 695f 656e  m Quantity hi_en
+00033440: 3a20 5468 6520 7570 7065 7220 656e 6572  : The upper ener
+00033450: 6779 206c 696d 6974 206f 6620 7468 6520  gy limit of the 
+00033460: 7261 7465 6d61 7073 2079 6f75 2077 6973  ratemaps you wis
+00033470: 6820 746f 2072 6574 7269 6576 652c 2074  h to retrieve, t
+00033480: 6865 2064 6566 6175 6c74 0a20 2020 2020  he default.     
+00033490: 2020 2020 2020 2069 7320 4e6f 6e65 2028         is None (
+000334a0: 7768 6963 6820 7769 6c6c 2072 6574 7269  which will retri
+000334b0: 6576 6520 616c 6c20 7261 7465 6d61 7073  eve all ratemaps
+000334c0: 2072 6567 6172 646c 6573 7320 6f66 2065   regardless of e
+000334d0: 6e65 7267 7920 6c69 6d69 7429 2e0a 2020  nergy limit)..  
+000334e0: 2020 2020 2020 3a70 6172 616d 2062 6f6f        :param boo
+000334f0: 6c20 7073 665f 636f 7272 3a20 5365 7473  l psf_corr: Sets
+00033500: 2077 6865 7468 6572 2079 6f75 2077 6973   whether you wis
+00033510: 6820 746f 2072 6574 7269 6576 6520 6120  h to retrieve a 
+00033520: 5053 4620 636f 7272 6563 7465 6420 7261  PSF corrected ra
+00033530: 7465 6d61 7020 6f72 206e 6f74 2e0a 2020  temap or not..  
+00033540: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
+00033550: 2070 7366 5f6d 6f64 656c 3a20 4966 2074   psf_model: If t
+00033560: 6865 2072 6174 656d 6170 2079 6f75 2077  he ratemap you w
+00033570: 616e 7420 6973 2050 5346 2063 6f72 7265  ant is PSF corre
+00033580: 6374 6564 2c20 7468 6973 2069 7320 7468  cted, this is th
+00033590: 6520 5053 4620 6d6f 6465 6c20 7573 6564  e PSF model used
+000335a0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+000335b0: 2069 6e74 2070 7366 5f62 696e 733a 2049   int psf_bins: I
+000335c0: 6620 7468 6520 7261 7465 6d61 7020 796f  f the ratemap yo
+000335d0: 7520 7761 6e74 2069 7320 5053 4620 636f  u want is PSF co
+000335e0: 7272 6563 7465 642c 2074 6869 7320 6973  rrected, this is
+000335f0: 2074 6865 206e 756d 6265 7220 6f66 2050   the number of P
+00033600: 5346 7320 7065 720a 2020 2020 2020 2020  SFs per.        
+00033610: 2020 2020 7369 6465 2069 6e20 7468 6520      side in the 
+00033620: 5053 4620 6772 6964 2e0a 2020 2020 2020  PSF grid..      
+00033630: 2020 3a70 6172 616d 2073 7472 2070 7366    :param str psf
+00033640: 5f61 6c67 6f3a 2049 6620 7468 6520 7261  _algo: If the ra
+00033650: 7465 6d61 7020 796f 7520 7761 6e74 2069  temap you want i
+00033660: 7320 5053 4620 636f 7272 6563 7465 642c  s PSF corrected,
+00033670: 2074 6869 7320 6973 2074 6865 2061 6c67   this is the alg
+00033680: 6f72 6974 686d 2075 7365 642e 0a20 2020  orithm used..   
+00033690: 2020 2020 203a 7061 7261 6d20 696e 7420       :param int 
+000336a0: 7073 665f 6974 6572 3a20 4966 2074 6865  psf_iter: If the
+000336b0: 2072 6174 656d 6170 2079 6f75 2077 616e   ratemap you wan
+000336c0: 7420 6973 2050 5346 2063 6f72 7265 6374  t is PSF correct
+000336d0: 6564 2c20 7468 6973 2069 7320 7468 6520  ed, this is the 
+000336e0: 6e75 6d62 6572 206f 6620 6974 6572 6174  number of iterat
+000336f0: 696f 6e73 2e0a 2020 2020 2020 2020 3a72  ions..        :r
+00033700: 6574 7572 6e3a 2041 6e20 5847 4120 5261  eturn: An XGA Ra
+00033710: 7465 4d61 7020 6f62 6a65 6374 2028 6966  teMap object (if
+00033720: 2074 6865 7265 2069 7320 616e 2065 7861   there is an exa
+00033730: 6374 206d 6174 6368 292c 206f 7220 6120  ct match), or a 
+00033740: 6c69 7374 206f 6620 5847 4120 5261 7465  list of XGA Rate
+00033750: 4d61 7020 6f62 6a65 6374 7320 2869 6620  Map objects (if 
+00033760: 7468 6572 650a 2020 2020 2020 2020 2020  there.          
+00033770: 2020 7765 7265 206d 756c 7469 706c 6520    were multiple 
+00033780: 6d61 7463 6869 6e67 2070 726f 6475 6374  matching product
+00033790: 7329 2e0a 2020 2020 2020 2020 3a72 7479  s)..        :rty
+000337a0: 7065 3a20 556e 696f 6e5b 5261 7465 4d61  pe: Union[RateMa
+000337b0: 702c 204c 6973 745b 5261 7465 4d61 705d  p, List[RateMap]
+000337c0: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
+000337d0: 2020 2020 2020 2320 5468 6973 2066 756e        # This fun
+000337e0: 6374 696f 6e20 6973 2065 7373 656e 7469  ction is essenti
+000337f0: 616c 6c79 2069 6465 6e74 6963 616c 2074  ally identical t
+00033800: 6f20 6765 745f 696d 6167 6573 2c20 6275  o get_images, bu
+00033810: 7420 4927 6d20 676f 696e 6720 746f 2062  t I'm going to b
+00033820: 6520 6c61 7a79 2061 6e64 206e 6f74 2077  e lazy and not w
+00033830: 7269 7465 0a20 2020 2020 2020 2023 2020  rite.        #  
+00033840: 6120 7365 7061 7261 7465 2069 6e74 6572  a separate inter
+00033850: 6e61 6c20 6675 6e63 7469 6f6e 2074 6f20  nal function to 
+00033860: 646f 2062 6f74 682e 0a0a 2020 2020 2020  do both...      
+00033870: 2020 2320 4368 6563 6b73 2074 6f20 6d61    # Checks to ma
+00033880: 6b65 2073 7572 6520 7468 6174 2061 6e20  ke sure that an 
+00033890: 616c 6c6f 7765 6420 636f 6d62 696e 6174  allowed combinat
+000338a0: 696f 6e20 6f66 206c 6f5f 656e 2061 6e64  ion of lo_en and
+000338b0: 2068 695f 656e 2068 6173 2062 6565 6e20   hi_en has been 
+000338c0: 7061 7373 6564 2e0a 2020 2020 2020 2020  passed..        
+000338d0: 6966 2061 6c6c 285b 6c6f 5f65 6e20 6973  if all([lo_en is
+000338e0: 204e 6f6e 652c 2068 695f 656e 2069 7320   None, hi_en is 
+000338f0: 4e6f 6e65 5d29 3a0a 2020 2020 2020 2020  None]):.        
+00033900: 2020 2020 2320 5365 7473 2061 2066 6c61      # Sets a fla
+00033910: 6720 746f 2074 656c 6c20 7468 6520 7265  g to tell the re
+00033920: 7374 206f 6620 7468 6520 6d65 7468 6f64  st of the method
+00033930: 2077 6865 7468 6572 2077 6520 6861 7665   whether we have
+00033940: 2065 6e65 7267 7920 6c69 6d73 206f 7220   energy lims or 
+00033950: 6e6f 740a 2020 2020 2020 2020 2020 2020  not.            
+00033960: 7769 7468 5f6c 696d 7320 3d20 4661 6c73  with_lims = Fals
+00033970: 650a 2020 2020 2020 2020 2020 2020 656e  e.            en
+00033980: 6572 6779 5f6b 6579 203d 204e 6f6e 650a  ergy_key = None.
+00033990: 2020 2020 2020 2020 656c 6966 2061 6c6c          elif all
+000339a0: 285b 6c6f 5f65 6e20 6973 206e 6f74 204e  ([lo_en is not N
+000339b0: 6f6e 652c 2068 695f 656e 2069 7320 6e6f  one, hi_en is no
+000339c0: 7420 4e6f 6e65 5d29 3a0a 2020 2020 2020  t None]):.      
+000339d0: 2020 2020 2020 7769 7468 5f6c 696d 7320        with_lims 
+000339e0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+000339f0: 2020 2023 2057 6520 6861 7665 2065 6e65     # We have ene
+00033a00: 7267 7920 6c69 6d69 7473 2068 6572 6520  rgy limits here 
+00033a10: 736f 2077 6520 6173 7365 6d62 6c65 2074  so we assemble t
+00033a20: 6865 206b 6579 2074 6861 7420 6465 7363  he key that desc
+00033a30: 7269 6265 7320 7468 6520 656e 6572 6779  ribes the energy
+00033a40: 2072 616e 6765 0a20 2020 2020 2020 2020   range.         
+00033a50: 2020 2065 6e65 7267 795f 6b65 7920 3d20     energy_key = 
+00033a60: 2262 6f75 6e64 5f7b 6c7d 2d7b 687d 222e  "bound_{l}-{h}".
+00033a70: 666f 726d 6174 286c 3d6c 6f5f 656e 2e74  format(l=lo_en.t
+00033a80: 6f28 276b 6556 2729 2e76 616c 7565 2c20  o('keV').value, 
+00033a90: 683d 6869 5f65 6e2e 746f 2827 6b65 5627  h=hi_en.to('keV'
+00033aa0: 292e 7661 6c75 6529 0a20 2020 2020 2020  ).value).       
+00033ab0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00033ac0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00033ad0: 726f 7228 226c 6f5f 656e 2061 6e64 2068  ror("lo_en and h
+00033ae0: 695f 656e 206d 7573 7420 6265 2065 6974  i_en must be eit
+00033af0: 6865 7220 424f 5448 204e 6f6e 6520 6f72  her BOTH None or
+00033b00: 2042 4f54 4820 616e 2041 7374 726f 7079   BOTH an Astropy
+00033b10: 2071 7561 6e74 6974 792e 2229 0a0a 2020   quantity.")..  
+00033b20: 2020 2020 2020 2320 4966 2077 6520 6172        # If we ar
+00033b30: 6520 6c6f 6f6b 696e 6720 666f 7220 6120  e looking for a 
+00033b40: 5053 4620 636f 7272 6563 7465 6420 7261  PSF corrected ra
+00033b50: 7465 6d61 7020 7468 656e 2077 6520 6173  temap then we as
+00033b60: 7365 6d62 6c65 2074 6865 2065 7874 7261  semble the extra
+00033b70: 206b 6579 2077 6974 6820 5053 4620 6465   key with PSF de
+00033b80: 7461 696c 730a 2020 2020 2020 2020 6966  tails.        if
+00033b90: 2070 7366 5f63 6f72 723a 0a20 2020 2020   psf_corr:.     
+00033ba0: 2020 2020 2020 2065 7874 7261 5f6b 6579         extra_key
+00033bb0: 203d 2022 5f22 202b 2070 7366 5f6d 6f64   = "_" + psf_mod
+00033bc0: 656c 202b 2022 5f22 202b 2073 7472 2870  el + "_" + str(p
+00033bd0: 7366 5f62 696e 7329 202b 2022 5f22 202b  sf_bins) + "_" +
+00033be0: 2070 7366 5f61 6c67 6f20 2b20 7374 7228   psf_algo + str(
+00033bf0: 7073 665f 6974 6572 290a 0a20 2020 2020  psf_iter)..     
+00033c00: 2020 2069 6620 6e6f 7420 7073 665f 636f     if not psf_co
+00033c10: 7272 2061 6e64 2077 6974 685f 6c69 6d73  rr and with_lims
+00033c20: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00033c30: 5369 6d70 6c65 7374 2063 6173 652c 206a  Simplest case, j
+00033c40: 7573 7420 6361 6c6c 696e 6720 6765 745f  ust calling get_
+00033c50: 7072 6f64 7563 7473 2061 6e64 2070 6173  products and pas
+00033c60: 7369 6e67 2069 6e20 6f75 7220 696e 666f  sing in our info
+00033c70: 726d 6174 696f 6e0a 2020 2020 2020 2020  rmation.        
+00033c80: 2020 2020 6d61 7463 6865 645f 7072 6f64      matched_prod
+00033c90: 7320 3d20 7365 6c66 2e67 6574 5f70 726f  s = self.get_pro
+00033ca0: 6475 6374 7328 2763 6f6d 6269 6e65 645f  ducts('combined_
+00033cb0: 7261 7465 6d61 7027 2c20 6578 7472 615f  ratemap', extra_
+00033cc0: 6b65 793d 656e 6572 6779 5f6b 6579 290a  key=energy_key).
+00033cd0: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+00033ce0: 2070 7366 5f63 6f72 7220 616e 6420 6e6f   psf_corr and no
+00033cf0: 7420 7769 7468 5f6c 696d 733a 0a20 2020  t with_lims:.   
+00033d00: 2020 2020 2020 2020 2062 726f 6164 5f6d           broad_m
+00033d10: 6174 6368 6573 203d 2073 656c 662e 6765  atches = self.ge
+00033d20: 745f 7072 6f64 7563 7473 2822 636f 6d62  t_products("comb
+00033d30: 696e 6564 5f72 6174 656d 6170 2229 0a20  ined_ratemap"). 
+00033d40: 2020 2020 2020 2020 2020 206d 6174 6368             match
+00033d50: 6564 5f70 726f 6473 203d 205b 7020 666f  ed_prods = [p fo
+00033d60: 7220 7020 696e 2062 726f 6164 5f6d 6174  r p in broad_mat
+00033d70: 6368 6573 2069 6620 6e6f 7420 702e 7073  ches if not p.ps
+00033d80: 665f 636f 7272 6563 7465 645d 0a20 2020  f_corrected].   
+00033d90: 2020 2020 2065 6c69 6620 7073 665f 636f       elif psf_co
+00033da0: 7272 2061 6e64 2077 6974 685f 6c69 6d73  rr and with_lims
+00033db0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00033dc0: 4865 7265 2077 6520 6e65 6564 2074 6f20  Here we need to 
+00033dd0: 6164 6420 7468 6520 6578 7472 6120 6b65  add the extra ke
+00033de0: 7920 746f 2074 6865 2065 6e65 7267 7920  y to the energy 
+00033df0: 6b65 790a 2020 2020 2020 2020 2020 2020  key.            
+00033e00: 6d61 7463 6865 645f 7072 6f64 7320 3d20  matched_prods = 
+00033e10: 7365 6c66 2e67 6574 5f70 726f 6475 6374  self.get_product
+00033e20: 7328 2763 6f6d 6269 6e65 645f 7261 7465  s('combined_rate
+00033e30: 6d61 7027 2c20 6578 7472 615f 6b65 793d  map', extra_key=
+00033e40: 656e 6572 6779 5f6b 6579 202b 2065 7874  energy_key + ext
+00033e50: 7261 5f6b 6579 290a 2020 2020 2020 2020  ra_key).        
+00033e60: 656c 6966 2070 7366 5f63 6f72 7220 616e  elif psf_corr an
+00033e70: 6420 6e6f 7420 7769 7468 5f6c 696d 733a  d not with_lims:
+00033e80: 0a20 2020 2020 2020 2020 2020 2023 2048  .            # H
+00033e90: 6572 6520 7765 2064 6f6e 2774 206b 6e6f  ere we don't kno
+00033ea0: 7720 7468 6520 656e 6572 6779 206b 6579  w the energy key
+00033eb0: 2c20 736f 2077 6520 6861 7665 2074 6f20  , so we have to 
+00033ec0: 6c6f 6f6b 2066 6f72 2070 6172 7469 616c  look for partial
+00033ed0: 206d 6174 6368 6573 2069 6e20 7468 6520   matches in the 
+00033ee0: 6765 745f 7072 6f64 7563 7473 2072 6574  get_products ret
+00033ef0: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
+00033f00: 6272 6f61 645f 6d61 7463 6865 7320 3d20  broad_matches = 
+00033f10: 7365 6c66 2e67 6574 5f70 726f 6475 6374  self.get_product
+00033f20: 7328 2763 6f6d 6269 6e65 645f 7261 7465  s('combined_rate
+00033f30: 6d61 7027 2c20 6578 7472 615f 6b65 793d  map', extra_key=
+00033f40: 4e6f 6e65 2c20 6a75 7374 5f6f 626a 3d46  None, just_obj=F
+00033f50: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+00033f60: 2020 6d61 7463 6865 645f 7072 6f64 7320    matched_prods 
+00033f70: 3d20 5b70 5b2d 315d 2066 6f72 2070 2069  = [p[-1] for p i
+00033f80: 6e20 6272 6f61 645f 6d61 7463 6865 7320  n broad_matches 
+00033f90: 6966 2065 7874 7261 5f6b 6579 2069 6e20  if extra_key in 
+00033fa0: 705b 2d32 5d5d 0a0a 2020 2020 2020 2020  p[-2]]..        
+00033fb0: 6966 206c 656e 286d 6174 6368 6564 5f70  if len(matched_p
+00033fc0: 726f 6473 2920 3d3d 2031 3a0a 2020 2020  rods) == 1:.    
+00033fd0: 2020 2020 2020 2020 6d61 7463 6865 645f          matched_
+00033fe0: 7072 6f64 7320 3d20 6d61 7463 6865 645f  prods = matched_
+00033ff0: 7072 6f64 735b 305d 0a20 2020 2020 2020  prods[0].       
+00034000: 2065 6c69 6620 6c65 6e28 6d61 7463 6865   elif len(matche
+00034010: 645f 7072 6f64 7329 203d 3d20 303a 0a20  d_prods) == 0:. 
+00034020: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00034030: 204e 6f50 726f 6475 6374 4176 6169 6c61   NoProductAvaila
+00034040: 626c 6545 7272 6f72 2822 4361 6e6e 6f74  bleError("Cannot
+00034050: 2066 696e 6420 616e 7920 636f 6d62 696e   find any combin
+00034060: 6564 2072 6174 656d 6170 7320 6d61 7463  ed ratemaps matc
+00034070: 6869 6e67 2079 6f75 7220 696e 7075 742e  hing your input.
+00034080: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
+00034090: 726e 206d 6174 6368 6564 5f70 726f 6473  rn matched_prods
+000340a0: 0a0a 2020 2020 6465 6620 5f67 6574 5f70  ..    def _get_p
+000340b0: 726f 665f 7072 6f64 2873 656c 662c 2073  rof_prod(self, s
+000340c0: 6561 7263 685f 6b65 793a 2073 7472 2c20  earch_key: str, 
+000340d0: 6f62 735f 6964 3a20 7374 7220 3d20 4e6f  obs_id: str = No
+000340e0: 6e65 2c20 696e 7374 3a20 7374 7220 3d20  ne, inst: str = 
+000340f0: 4e6f 6e65 2c20 6365 6e74 7261 6c5f 636f  None, central_co
+00034100: 6f72 643a 2051 7561 6e74 6974 7920 3d20  ord: Quantity = 
+00034110: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+00034120: 2020 2020 2020 2020 2020 2020 2072 6164               rad
+00034130: 6969 3a20 5175 616e 7469 7479 203d 204e  ii: Quantity = N
+00034140: 6f6e 652c 206c 6f5f 656e 3a20 5175 616e  one, lo_en: Quan
+00034150: 7469 7479 203d 204e 6f6e 652c 2068 695f  tity = None, hi_
+00034160: 656e 3a20 5175 616e 7469 7479 203d 204e  en: Quantity = N
+00034170: 6f6e 6529 205c 0a20 2020 2020 2020 2020  one) \.         
+00034180: 2020 202d 3e20 556e 696f 6e5b 4261 7365     -> Union[Base
+00034190: 5072 6f66 696c 6531 442c 204c 6973 745b  Profile1D, List[
+000341a0: 4261 7365 5072 6f66 696c 6531 445d 5d3a  BaseProfile1D]]:
+000341b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000341c0: 2020 2020 2054 6865 2069 6e74 6572 6e61       The interna
+000341d0: 6c20 6d65 7468 6f64 2077 6869 6368 2069  l method which i
+000341e0: 7320 7468 6520 6775 7473 206f 6620 6765  s the guts of ge
+000341f0: 745f 7072 6f66 696c 6573 2061 6e64 2067  t_profiles and g
+00034200: 6574 5f63 6f6d 6269 6e65 645f 7072 6f66  et_combined_prof
+00034210: 696c 6573 2e20 4974 2070 6172 7365 7320  iles. It parses 
+00034220: 7468 6520 696e 7075 7420 616e 640a 2020  the input and.  
+00034230: 2020 2020 2020 7365 6172 6368 6573 2066        searches f
+00034240: 6f72 2066 756c 6c20 616e 6420 7061 7274  or full and part
+00034250: 6961 6c20 6d61 7463 6865 7320 696e 2074  ial matches in t
+00034260: 6869 7320 736f 7572 6365 2773 2070 726f  his source's pro
+00034270: 6475 6374 2073 746f 7261 6765 2073 7472  duct storage str
+00034280: 7563 7475 7265 2e0a 0a20 2020 2020 2020  ucture...       
+00034290: 203a 7061 7261 6d20 7374 7220 7365 6172   :param str sear
+000342a0: 6368 5f6b 6579 3a20 5468 6520 6578 6163  ch_key: The exac
+000342b0: 7420 7365 6172 6368 206b 6579 2077 6869  t search key whi
+000342c0: 6368 2064 6566 696e 6564 2070 726f 6669  ch defined profi
+000342d0: 6c65 2074 7970 652c 2061 6e64 2077 6865  le type, and whe
+000342e0: 7468 6572 2069 7420 6973 2063 6f6d 6269  ther it is combi
+000342f0: 6e65 6420 6f72 206e 6f74 2e0a 2020 2020  ned or not..    
+00034300: 2020 2020 3a70 6172 616d 2073 7472 206f      :param str o
+00034310: 6273 5f69 643a 204f 7074 696f 6e61 6c6c  bs_id: Optionall
+00034320: 792c 2061 2073 7065 6369 6669 6320 6f62  y, a specific ob
+00034330: 735f 6964 2074 6f20 7365 6172 6368 2066  s_id to search f
+00034340: 6f72 2063 616e 2062 6520 7375 7070 6c69  or can be suppli
+00034350: 6564 2e20 5468 6520 6465 6661 756c 7420  ed. The default 
+00034360: 6973 204e 6f6e 652c 0a20 2020 2020 2020  is None,.       
+00034370: 2020 2020 2077 6869 6368 206d 6561 6e73       which means
+00034380: 2061 6c6c 2070 726f 6669 6c65 7320 6d61   all profiles ma
+00034390: 7463 6869 6e67 2074 6865 206f 7468 6572  tching the other
+000343a0: 2063 7269 7465 7269 6120 7769 6c6c 2062   criteria will b
+000343b0: 6520 7265 7475 726e 6564 2e0a 2020 2020  e returned..    
+000343c0: 2020 2020 3a70 6172 616d 2073 7472 2069      :param str i
+000343d0: 6e73 743a 204f 7074 696f 6e61 6c6c 792c  nst: Optionally,
+000343e0: 2061 2073 7065 6369 6669 6320 696e 7374   a specific inst
+000343f0: 7275 6d65 6e74 2074 6f20 7365 6172 6368  rument to search
+00034400: 2066 6f72 2063 616e 2062 6520 7375 7070   for can be supp
+00034410: 6c69 6564 2e20 5468 6520 6465 6661 756c  lied. The defaul
+00034420: 7420 6973 204e 6f6e 652c 0a20 2020 2020  t is None,.     
+00034430: 2020 2020 2020 2077 6869 6368 206d 6561         which mea
+00034440: 6e73 2061 6c6c 2070 726f 6669 6c65 7320  ns all profiles 
+00034450: 6d61 7463 6869 6e67 2074 6865 206f 7468  matching the oth
+00034460: 6572 2063 7269 7465 7269 6120 7769 6c6c  er criteria will
+00034470: 2062 6520 7265 7475 726e 6564 2e0a 2020   be returned..  
+00034480: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
+00034490: 6e74 6974 7920 6365 6e74 7261 6c5f 636f  ntity central_co
+000344a0: 6f72 643a 2054 6865 2063 656e 7472 616c  ord: The central
+000344b0: 2063 6f6f 7264 696e 6174 6520 6f66 2074   coordinate of t
+000344c0: 6865 2070 726f 6669 6c65 2079 6f75 2077  he profile you w
+000344d0: 6973 6820 746f 2072 6574 7269 6576 652c  ish to retrieve,
+000344e0: 2074 6865 2064 6566 6175 6c74 0a20 2020   the default.   
+000344f0: 2020 2020 2020 2020 2069 7320 4e6f 6e65           is None
+00034500: 2077 6869 6368 206d 6561 6e73 2074 6865   which means the
+00034510: 206d 6574 686f 6420 7769 6c6c 2075 7365   method will use
+00034520: 2074 6865 2064 6566 6175 6c74 2063 6f6f   the default coo
+00034530: 7264 696e 6174 6520 6f66 2074 6869 7320  rdinate of this 
+00034540: 736f 7572 6365 2e0a 2020 2020 2020 2020  source..        
+00034550: 3a70 6172 616d 2051 7561 6e74 6974 7920  :param Quantity 
+00034560: 7261 6469 693a 2054 6865 2063 656e 7472  radii: The centr
+00034570: 616c 2072 6164 6969 206f 6620 7468 6520  al radii of the 
+00034580: 7072 6f66 696c 6520 706f 696e 7473 2c20  profile points, 
+00034590: 6974 2069 7320 6e6f 7420 6c69 6b65 6c79  it is not likely
+000345a0: 2074 6861 7420 7468 6973 206f 7074 696f   that this optio
+000345b0: 6e20 7769 6c6c 2062 650a 2020 2020 2020  n will be.      
+000345c0: 2020 2020 2020 7573 6564 206f 6674 656e        used often
+000345d0: 2061 7320 796f 7520 6c69 6b65 6c79 2077   as you likely w
+000345e0: 6f6e 2774 206b 6e6f 7720 7468 6520 7261  on't know the ra
+000345f0: 6469 616c 2076 616c 7565 7320 6120 7072  dial values a pr
+00034600: 696f 7269 2e0a 2020 2020 2020 2020 3a70  iori..        :p
+00034610: 6172 616d 2051 7561 6e74 6974 7920 6c6f  aram Quantity lo
+00034620: 5f65 6e3a 2054 6865 206c 6f77 6572 2065  _en: The lower e
+00034630: 6e65 7267 7920 626f 756e 6420 6f66 2074  nergy bound of t
+00034640: 6865 2070 726f 6669 6c65 2079 6f75 2077  he profile you w
+00034650: 6973 6820 746f 2072 6574 7269 6576 6520  ish to retrieve 
+00034660: 2869 6620 6170 706c 6963 6162 6c65 292c  (if applicable),
+00034670: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
+00034680: 2020 2020 2069 7320 4e6f 6e65 2c20 616e       is None, an
+00034690: 6420 6966 2074 6869 7320 6172 6775 6d65  d if this argume
+000346a0: 6e74 2069 7320 7061 7373 6564 2068 695f  nt is passed hi_
+000346b0: 656e 206d 7573 7420 6265 2074 6f6f 2e0a  en must be too..
+000346c0: 2020 2020 2020 2020 3a70 6172 616d 2051          :param Q
+000346d0: 7561 6e74 6974 7920 6869 5f65 6e3a 2054  uantity hi_en: T
+000346e0: 6865 2068 6967 6865 7220 656e 6572 6779  he higher energy
+000346f0: 2062 6f75 6e64 206f 6620 7468 6520 7072   bound of the pr
+00034700: 6f66 696c 6520 796f 7520 7769 7368 2074  ofile you wish t
+00034710: 6f20 7265 7472 6965 7665 2028 6966 2061  o retrieve (if a
+00034720: 7070 6c69 6361 626c 6529 2c20 6465 6661  pplicable), defa
+00034730: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
+00034740: 6973 204e 6f6e 652c 2061 6e64 2069 6620  is None, and if 
+00034750: 7468 6973 2061 7267 756d 656e 7420 6973  this argument is
+00034760: 2070 6173 7365 6420 6c6f 5f65 6e20 6d75   passed lo_en mu
+00034770: 7374 2062 6520 746f 6f2e 0a20 2020 2020  st be too..     
+00034780: 2020 203a 7265 7475 726e 3a20 416e 2058     :return: An X
+00034790: 4741 2070 726f 6669 6c65 206f 626a 6563  GA profile objec
+000347a0: 7420 2869 6620 7468 6572 6520 6973 2061  t (if there is a
+000347b0: 6e20 6578 6163 7420 6d61 7463 6829 2c20  n exact match), 
+000347c0: 6f72 2061 206c 6973 7420 6f66 2058 4741  or a list of XGA
+000347d0: 2070 726f 6669 6c65 206f 626a 6563 7473   profile objects
+000347e0: 2028 6966 2074 6865 7265 0a20 2020 2020   (if there.     
+000347f0: 2020 2020 2020 2077 6572 6520 6d75 6c74         were mult
+00034800: 6970 6c65 206d 6174 6368 696e 6720 7072  iple matching pr
+00034810: 6f64 7563 7473 292e 0a20 2020 2020 2020  oducts)..       
+00034820: 203a 7274 7970 653a 2055 6e69 6f6e 5b42   :rtype: Union[B
+00034830: 6173 6550 726f 6669 6c65 3144 2c20 4c69  aseProfile1D, Li
+00034840: 7374 5b42 6173 6550 726f 6669 6c65 3144  st[BaseProfile1D
+00034850: 5d5d 0a20 2020 2020 2020 2022 2222 0a20  ]].        """. 
+00034860: 2020 2020 2020 2069 6620 616c 6c28 5b6c         if all([l
+00034870: 6f5f 656e 2069 7320 4e6f 6e65 2c20 6869  o_en is None, hi
+00034880: 5f65 6e20 6973 204e 6f6e 655d 293a 0a20  _en is None]):. 
+00034890: 2020 2020 2020 2020 2020 2065 6e65 7267             energ
+000348a0: 795f 6b65 7920 3d20 225f 220a 2020 2020  y_key = "_".    
+000348b0: 2020 2020 656c 6966 2061 6c6c 285b 6c6f      elif all([lo
+000348c0: 5f65 6e20 6973 206e 6f74 204e 6f6e 652c  _en is not None,
+000348d0: 2068 695f 656e 2069 7320 6e6f 7420 4e6f   hi_en is not No
+000348e0: 6e65 5d29 3a0a 2020 2020 2020 2020 2020  ne]):.          
+000348f0: 2020 656e 6572 6779 5f6b 6579 203d 2022    energy_key = "
+00034900: 626f 756e 645f 7b6c 7d2d 7b68 7d5f 222e  bound_{l}-{h}_".
+00034910: 666f 726d 6174 286c 3d6c 6f5f 656e 2e74  format(l=lo_en.t
+00034920: 6f28 276b 6556 2729 2e76 616c 7565 2c20  o('keV').value, 
+00034930: 683d 6869 5f65 6e2e 746f 2827 6b65 5627  h=hi_en.to('keV'
+00034940: 292e 7661 6c75 6529 0a20 2020 2020 2020  ).value).       
+00034950: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00034960: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00034970: 726f 7228 226c 6f5f 656e 2061 6e64 2068  ror("lo_en and h
+00034980: 695f 656e 206d 7573 7420 6265 2065 6974  i_en must be eit
+00034990: 6865 7220 424f 5448 204e 6f6e 6520 6f72  her BOTH None or
+000349a0: 2042 4f54 4820 616e 2041 7374 726f 7079   BOTH an Astropy
+000349b0: 2071 7561 6e74 6974 792e 2229 0a0a 2020   quantity.")..  
+000349c0: 2020 2020 2020 6966 2063 656e 7472 616c        if central
+000349d0: 5f63 6f6f 7264 2069 7320 4e6f 6e65 3a0a  _coord is None:.
+000349e0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+000349f0: 7261 6c5f 636f 6f72 6420 3d20 7365 6c66  ral_coord = self
+00034a00: 2e64 6566 6175 6c74 5f63 6f6f 7264 0a20  .default_coord. 
+00034a10: 2020 2020 2020 2063 656e 5f63 6875 6e6b         cen_chunk
+00034a20: 203d 2022 7261 7b72 7d5f 6465 637b 647d   = "ra{r}_dec{d}
+00034a30: 5f22 2e66 6f72 6d61 7428 723d 6365 6e74  _".format(r=cent
+00034a40: 7261 6c5f 636f 6f72 645b 305d 2e76 616c  ral_coord[0].val
+00034a50: 7565 2c20 643d 6365 6e74 7261 6c5f 636f  ue, d=central_co
+00034a60: 6f72 645b 315d 2e76 616c 7565 290a 0a20  ord[1].value).. 
+00034a70: 2020 2020 2020 2069 6620 7261 6469 6920         if radii 
+00034a80: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00034a90: 2020 2020 2020 2020 2072 6164 6969 203d           radii =
+00034aa0: 2073 656c 662e 636f 6e76 6572 745f 7261   self.convert_ra
+00034ab0: 6469 7573 2872 6164 6969 2c20 2764 6567  dius(radii, 'deg
+00034ac0: 2729 0a20 2020 2020 2020 2020 2020 2072  ').            r
+00034ad0: 6164 5f63 6875 6e6b 203d 2022 7222 202b  ad_chunk = "r" +
+00034ae0: 2022 5f22 2e6a 6f69 6e28 7261 6469 692e   "_".join(radii.
+00034af0: 7661 6c75 652e 6173 7479 7065 2873 7472  value.astype(str
+00034b00: 2929 0a20 2020 2020 2020 2020 2020 2072  )).            r
+00034b10: 6164 5f69 6e66 6f20 3d20 5472 7565 0a20  ad_info = True. 
+00034b20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00034b30: 2020 2020 2020 2020 2072 6164 5f69 6e66           rad_inf
+00034b40: 6f20 3d20 4661 6c73 650a 0a20 2020 2020  o = False..     
+00034b50: 2020 2062 726f 6164 5f70 726f 6473 203d     broad_prods =
+00034b60: 2073 656c 662e 6765 745f 7072 6f64 7563   self.get_produc
+00034b70: 7473 2873 6561 7263 685f 6b65 792c 206f  ts(search_key, o
+00034b80: 6273 5f69 642c 2069 6e73 742c 206a 7573  bs_id, inst, jus
+00034b90: 745f 6f62 6a3d 4661 6c73 6529 0a20 2020  t_obj=False).   
+00034ba0: 2020 2020 206d 6174 6368 6564 5f70 726f       matched_pro
+00034bb0: 6473 203d 205b 5d0a 2020 2020 2020 2020  ds = [].        
+00034bc0: 666f 7220 7020 696e 2062 726f 6164 5f70  for p in broad_p
+00034bd0: 726f 6473 3a0a 2020 2020 2020 2020 2020  rods:.          
+00034be0: 2020 7261 645f 7374 7220 3d20 705b 2d32    rad_str = p[-2
+00034bf0: 5d2e 7370 6c69 7428 225f 7374 2229 5b30  ].split("_st")[0
+00034c00: 5d2e 7370 6c69 7428 6365 6e5f 6368 756e  ].split(cen_chun
+00034c10: 6b29 5b2d 315d 0a0a 2020 2020 2020 2020  k)[-1]..        
+00034c20: 2020 2020 6966 2063 656e 5f63 6875 6e6b      if cen_chunk
+00034c30: 2069 6e20 705b 2d32 5d20 616e 6420 656e   in p[-2] and en
+00034c40: 6572 6779 5f6b 6579 2069 6e20 705b 2d32  ergy_key in p[-2
+00034c50: 5d20 616e 6420 7261 645f 696e 666f 2061  ] and rad_info a
+00034c60: 6e64 2072 6164 5f73 7472 203d 3d20 7261  nd rad_str == ra
+00034c70: 645f 6368 756e 6b3a 0a20 2020 2020 2020  d_chunk:.       
+00034c80: 2020 2020 2020 2020 206d 6174 6368 6564           matched
+00034c90: 5f70 726f 6473 2e61 7070 656e 6428 705b  _prods.append(p[
+00034ca0: 2d31 5d29 0a20 2020 2020 2020 2020 2020  -1]).           
+00034cb0: 2065 6c69 6620 6365 6e5f 6368 756e 6b20   elif cen_chunk 
+00034cc0: 696e 2070 5b2d 325d 2061 6e64 2065 6e65  in p[-2] and ene
+00034cd0: 7267 795f 6b65 7920 696e 2070 5b2d 325d  rgy_key in p[-2]
+00034ce0: 2061 6e64 206e 6f74 2072 6164 5f69 6e66   and not rad_inf
+00034cf0: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
+00034d00: 2020 206d 6174 6368 6564 5f70 726f 6473     matched_prods
+00034d10: 2e61 7070 656e 6428 705b 2d31 5d29 0a0a  .append(p[-1])..
+00034d20: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+00034d30: 6174 6368 6564 5f70 726f 6473 0a0a 2020  atched_prods..  
+00034d40: 2020 6465 6620 6765 745f 7072 6f66 696c    def get_profil
+00034d50: 6573 2873 656c 662c 2070 726f 6669 6c65  es(self, profile
+00034d60: 5f74 7970 653a 2073 7472 2c20 6f62 735f  _type: str, obs_
+00034d70: 6964 3a20 7374 7220 3d20 4e6f 6e65 2c20  id: str = None, 
+00034d80: 696e 7374 3a20 7374 7220 3d20 4e6f 6e65  inst: str = None
+00034d90: 2c20 6365 6e74 7261 6c5f 636f 6f72 643a  , central_coord:
+00034da0: 2051 7561 6e74 6974 7920 3d20 4e6f 6e65   Quantity = None
+00034db0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00034dc0: 2020 2020 2020 2072 6164 6969 3a20 5175         radii: Qu
+00034dd0: 616e 7469 7479 203d 204e 6f6e 652c 206c  antity = None, l
+00034de0: 6f5f 656e 3a20 5175 616e 7469 7479 203d  o_en: Quantity =
+00034df0: 204e 6f6e 652c 2068 695f 656e 3a20 5175   None, hi_en: Qu
+00034e00: 616e 7469 7479 203d 204e 6f6e 6529 205c  antity = None) \
+00034e10: 0a20 2020 2020 2020 2020 2020 202d 3e20  .            -> 
+00034e20: 556e 696f 6e5b 4261 7365 5072 6f66 696c  Union[BaseProfil
+00034e30: 6531 442c 204c 6973 745b 4261 7365 5072  e1D, List[BasePr
+00034e40: 6f66 696c 6531 445d 5d3a 0a20 2020 2020  ofile1D]]:.     
+00034e50: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+00034e60: 6869 7320 6973 2074 6865 2067 656e 6572  his is the gener
+00034e70: 6963 2067 6574 206d 6574 686f 6420 666f  ic get method fo
+00034e80: 7220 5847 4120 7072 6f66 696c 6520 6f62  r XGA profile ob
+00034e90: 6a65 6374 7320 7374 6f72 6564 2069 6e20  jects stored in 
+00034ea0: 7468 6973 2073 6f75 7263 652e 2059 6f75  this source. You
+00034eb0: 2073 7469 6c6c 206d 7573 7420 7265 6d65   still must reme
+00034ec0: 6d62 6572 0a20 2020 2020 2020 2074 6865  mber.        the
+00034ed0: 2070 726f 6669 6c65 2074 7970 6520 7661   profile type va
+00034ee0: 6c75 6520 746f 2075 7365 2069 742c 2062  lue to use it, b
+00034ef0: 7574 206f 6e63 6520 656e 7465 7265 6420  ut once entered 
+00034f00: 6974 2077 696c 6c20 7265 7475 726e 2061  it will return a
+00034f10: 206c 6973 7420 6f66 2061 6c6c 206d 6174   list of all mat
+00034f20: 6368 696e 6720 7072 6f66 696c 6573 2028  ching profiles (
+00034f30: 6f72 2061 0a20 2020 2020 2020 2073 696e  or a.        sin
+00034f40: 676c 6520 6f62 6a65 6374 2069 6620 6f6e  gle object if on
+00034f50: 6c79 206f 6e65 206d 6174 6368 2069 7320  ly one match is 
+00034f60: 666f 756e 6429 2e0a 0a20 2020 2020 2020  found)...       
+00034f70: 203a 7061 7261 6d20 7374 7220 7072 6f66   :param str prof
+00034f80: 696c 655f 7479 7065 3a20 5468 6520 7374  ile_type: The st
+00034f90: 7269 6e67 2070 726f 6669 6c65 2074 7970  ring profile typ
+00034fa0: 6520 6f66 2074 6865 2070 726f 6669 6c65  e of the profile
+00034fb0: 2873 2920 796f 7520 7769 7368 2074 6f20  (s) you wish to 
+00034fc0: 7265 7472 6965 7665 2e0a 2020 2020 2020  retrieve..      
+00034fd0: 2020 3a70 6172 616d 2073 7472 206f 6273    :param str obs
+00034fe0: 5f69 643a 204f 7074 696f 6e61 6c6c 792c  _id: Optionally,
+00034ff0: 2061 2073 7065 6369 6669 6320 6f62 735f   a specific obs_
+00035000: 6964 2074 6f20 7365 6172 6368 2066 6f72  id to search for
+00035010: 2063 616e 2062 6520 7375 7070 6c69 6564   can be supplied
+00035020: 2e20 5468 6520 6465 6661 756c 7420 6973  . The default is
+00035030: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00035040: 2020 2077 6869 6368 206d 6561 6e73 2061     which means a
+00035050: 6c6c 2070 726f 6669 6c65 7320 6d61 7463  ll profiles matc
+00035060: 6869 6e67 2074 6865 206f 7468 6572 2063  hing the other c
+00035070: 7269 7465 7269 6120 7769 6c6c 2062 6520  riteria will be 
+00035080: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+00035090: 2020 3a70 6172 616d 2073 7472 2069 6e73    :param str ins
+000350a0: 743a 204f 7074 696f 6e61 6c6c 792c 2061  t: Optionally, a
+000350b0: 2073 7065 6369 6669 6320 696e 7374 7275   specific instru
+000350c0: 6d65 6e74 2074 6f20 7365 6172 6368 2066  ment to search f
+000350d0: 6f72 2063 616e 2062 6520 7375 7070 6c69  or can be suppli
+000350e0: 6564 2e20 5468 6520 6465 6661 756c 7420  ed. The default 
+000350f0: 6973 204e 6f6e 652c 0a20 2020 2020 2020  is None,.       
+00035100: 2020 2020 2077 6869 6368 206d 6561 6e73       which means
+00035110: 2061 6c6c 2070 726f 6669 6c65 7320 6d61   all profiles ma
+00035120: 7463 6869 6e67 2074 6865 206f 7468 6572  tching the other
+00035130: 2063 7269 7465 7269 6120 7769 6c6c 2062   criteria will b
+00035140: 6520 7265 7475 726e 6564 2e0a 2020 2020  e returned..    
+00035150: 2020 2020 3a70 6172 616d 2051 7561 6e74      :param Quant
+00035160: 6974 7920 6365 6e74 7261 6c5f 636f 6f72  ity central_coor
+00035170: 643a 2054 6865 2063 656e 7472 616c 2063  d: The central c
+00035180: 6f6f 7264 696e 6174 6520 6f66 2074 6865  oordinate of the
+00035190: 2070 726f 6669 6c65 2079 6f75 2077 6973   profile you wis
+000351a0: 6820 746f 2072 6574 7269 6576 652c 2074  h to retrieve, t
+000351b0: 6865 2064 6566 6175 6c74 0a20 2020 2020  he default.     
+000351c0: 2020 2020 2020 2069 7320 4e6f 6e65 2077         is None w
+000351d0: 6869 6368 206d 6561 6e73 2074 6865 206d  hich means the m
+000351e0: 6574 686f 6420 7769 6c6c 2075 7365 2074  ethod will use t
+000351f0: 6865 2064 6566 6175 6c74 2063 6f6f 7264  he default coord
+00035200: 696e 6174 6520 6f66 2074 6869 7320 736f  inate of this so
+00035210: 7572 6365 2e0a 2020 2020 2020 2020 3a70  urce..        :p
+00035220: 6172 616d 2051 7561 6e74 6974 7920 7261  aram Quantity ra
+00035230: 6469 693a 2054 6865 2063 656e 7472 616c  dii: The central
+00035240: 2072 6164 6969 206f 6620 7468 6520 7072   radii of the pr
+00035250: 6f66 696c 6520 706f 696e 7473 2c20 6974  ofile points, it
+00035260: 2069 7320 6e6f 7420 6c69 6b65 6c79 2074   is not likely t
+00035270: 6861 7420 7468 6973 206f 7074 696f 6e20  hat this option 
+00035280: 7769 6c6c 2062 650a 2020 2020 2020 2020  will be.        
+00035290: 2020 2020 7573 6564 206f 6674 656e 2061      used often a
+000352a0: 7320 796f 7520 6c69 6b65 6c79 2077 6f6e  s you likely won
+000352b0: 2774 206b 6e6f 7720 7468 6520 7261 6469  't know the radi
+000352c0: 616c 2076 616c 7565 7320 6120 7072 696f  al values a prio
+000352d0: 7269 2e0a 2020 2020 2020 2020 3a70 6172  ri..        :par
+000352e0: 616d 2051 7561 6e74 6974 7920 6c6f 5f65  am Quantity lo_e
+000352f0: 6e3a 2054 6865 206c 6f77 6572 2065 6e65  n: The lower ene
+00035300: 7267 7920 626f 756e 6420 6f66 2074 6865  rgy bound of the
+00035310: 2070 726f 6669 6c65 2079 6f75 2077 6973   profile you wis
+00035320: 6820 746f 2072 6574 7269 6576 6520 2869  h to retrieve (i
+00035330: 6620 6170 706c 6963 6162 6c65 292c 2064  f applicable), d
+00035340: 6566 6175 6c74 0a20 2020 2020 2020 2020  efault.         
+00035350: 2020 2069 7320 4e6f 6e65 2c20 616e 6420     is None, and 
+00035360: 6966 2074 6869 7320 6172 6775 6d65 6e74  if this argument
+00035370: 2069 7320 7061 7373 6564 2068 695f 656e   is passed hi_en
+00035380: 206d 7573 7420 6265 2074 6f6f 2e0a 2020   must be too..  
+00035390: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
+000353a0: 6e74 6974 7920 6869 5f65 6e3a 2054 6865  ntity hi_en: The
+000353b0: 2068 6967 6865 7220 656e 6572 6779 2062   higher energy b
+000353c0: 6f75 6e64 206f 6620 7468 6520 7072 6f66  ound of the prof
+000353d0: 696c 6520 796f 7520 7769 7368 2074 6f20  ile you wish to 
+000353e0: 7265 7472 6965 7665 2028 6966 2061 7070  retrieve (if app
+000353f0: 6c69 6361 626c 6529 2c20 6465 6661 756c  licable), defaul
+00035400: 740a 2020 2020 2020 2020 2020 2020 6973  t.            is
+00035410: 204e 6f6e 652c 2061 6e64 2069 6620 7468   None, and if th
+00035420: 6973 2061 7267 756d 656e 7420 6973 2070  is argument is p
+00035430: 6173 7365 6420 6c6f 5f65 6e20 6d75 7374  assed lo_en must
+00035440: 2062 6520 746f 6f2e 0a20 2020 2020 2020   be too..       
+00035450: 203a 7265 7475 726e 3a20 416e 2058 4741   :return: An XGA
+00035460: 2070 726f 6669 6c65 206f 626a 6563 7420   profile object 
+00035470: 2869 6620 7468 6572 6520 6973 2061 6e20  (if there is an 
+00035480: 6578 6163 7420 6d61 7463 6829 2c20 6f72  exact match), or
+00035490: 2061 206c 6973 7420 6f66 2058 4741 2070   a list of XGA p
+000354a0: 726f 6669 6c65 206f 626a 6563 7473 2028  rofile objects (
+000354b0: 6966 2074 6865 7265 0a20 2020 2020 2020  if there.       
+000354c0: 2020 2020 2077 6572 6520 6d75 6c74 6970       were multip
+000354d0: 6c65 206d 6174 6368 696e 6720 7072 6f64  le matching prod
+000354e0: 7563 7473 292e 0a20 2020 2020 2020 203a  ucts)..        :
+000354f0: 7274 7970 653a 2055 6e69 6f6e 5b42 6173  rtype: Union[Bas
+00035500: 6550 726f 6669 6c65 3144 2c20 4c69 7374  eProfile1D, List
+00035510: 5b42 6173 6550 726f 6669 6c65 3144 5d5d  [BaseProfile1D]]
+00035520: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00035530: 2020 2020 2069 6620 2270 726f 6669 6c65       if "profile
+00035540: 2220 696e 2070 726f 6669 6c65 5f74 7970  " in profile_typ
+00035550: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
+00035560: 6172 6e28 2254 6865 2070 726f 6669 6c65  arn("The profile
+00035570: 5f74 7970 6520 796f 7520 7061 7373 6564  _type you passed
+00035580: 2063 6f6e 7461 696e 7320 7468 6520 776f   contains the wo
+00035590: 7264 2027 7072 6f66 696c 6527 2c20 7768  rd 'profile', wh
+000355a0: 6963 6820 6973 2061 7070 656e 6465 6420  ich is appended 
+000355b0: 6f6e 746f 2022 0a20 2020 2020 2020 2020  onto ".         
+000355c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000355d0: 2022 6120 7072 6f66 696c 6520 7479 7065   "a profile type
+000355e0: 2062 7920 5847 412c 2079 6f75 206e 6565   by XGA, you nee
+000355f0: 6420 746f 2074 7279 2074 6869 7320 6167  d to try this ag
+00035600: 6169 6e20 7769 7468 6f75 7420 7072 6f66  ain without prof
+00035610: 696c 6520 6f6e 2074 6865 2065 6e64 2c20  ile on the end, 
+00035620: 756e 6c65 7373 220a 2020 2020 2020 2020  unless".        
+00035630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035640: 2020 2220 796f 7520 6761 7665 2061 2067    " you gave a g
+00035650: 656e 6572 6963 2070 726f 6669 6c65 2061  eneric profile a
+00035660: 2074 7970 6520 7769 7468 2027 7072 6f66   type with 'prof
+00035670: 696c 6527 2069 6e2e 222c 2073 7461 636b  ile' in.", stack
+00035680: 6c65 7665 6c3d 3229 0a0a 2020 2020 2020  level=2)..      
+00035690: 2020 7365 6172 6368 5f6b 6579 203d 2070    search_key = p
+000356a0: 726f 6669 6c65 5f74 7970 6520 2b20 225f  rofile_type + "_
+000356b0: 7072 6f66 696c 6522 0a20 2020 2020 2020  profile".       
+000356c0: 2069 6620 616c 6c28 5b6f 6273 5f69 6420   if all([obs_id 
+000356d0: 6973 204e 6f6e 652c 2069 6e73 7420 6973  is None, inst is
+000356e0: 204e 6f6e 655d 293a 0a20 2020 2020 2020   None]):.       
+000356f0: 2020 2020 2073 6561 7263 685f 6b65 7920       search_key 
+00035700: 3d20 2263 6f6d 6269 6e65 645f 2220 2b20  = "combined_" + 
+00035710: 7365 6172 6368 5f6b 6579 0a0a 2020 2020  search_key..    
+00035720: 2020 2020 7365 6172 6368 5f6b 6579 203d      search_key =
+00035730: 2070 726f 6669 6c65 5f74 7970 6520 2b20   profile_type + 
+00035740: 225f 7072 6f66 696c 6522 0a20 2020 2020  "_profile".     
+00035750: 2020 2069 6620 7365 6172 6368 5f6b 6579     if search_key
+00035760: 206e 6f74 2069 6e20 414c 4c4f 5745 445f   not in ALLOWED_
+00035770: 5052 4f44 5543 5453 3a0a 2020 2020 2020  PRODUCTS:.      
+00035780: 2020 2020 2020 7761 726e 2822 7b7d 2073        warn("{} s
+00035790: 6565 6d73 2074 6f20 6265 2061 2063 7573  eems to be a cus
+000357a0: 746f 6d20 7072 6f66 696c 652c 206e 6f74  tom profile, not
+000357b0: 2061 6e20 5847 4120 6465 6661 756c 7420   an XGA default 
+000357c0: 7479 7065 2e20 4966 2074 6869 7320 6973  type. If this is
+000357d0: 206e 6f74 2022 0a20 2020 2020 2020 2020   not ".         
+000357e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000357f0: 2022 7472 7565 2074 6865 6e20 796f 7520   "true then you 
+00035800: 6861 7665 2070 6173 7365 6420 616e 2069  have passed an i
+00035810: 6e76 616c 6964 2070 726f 6669 6c65 2074  nvalid profile t
+00035820: 7970 652e 222e 666f 726d 6174 2873 6561  ype.".format(sea
+00035830: 7263 685f 6b65 7929 2c20 7374 6163 6b6c  rch_key), stackl
+00035840: 6576 656c 3d32 290a 0a20 2020 2020 2020  evel=2)..       
+00035850: 206d 6174 6368 6564 5f70 726f 6473 203d   matched_prods =
+00035860: 2073 656c 662e 5f67 6574 5f70 726f 665f   self._get_prof_
+00035870: 7072 6f64 2873 6561 7263 685f 6b65 792c  prod(search_key,
+00035880: 206f 6273 5f69 642c 2069 6e73 742c 2063   obs_id, inst, c
+00035890: 656e 7472 616c 5f63 6f6f 7264 2c20 7261  entral_coord, ra
+000358a0: 6469 692c 206c 6f5f 656e 2c20 6869 5f65  dii, lo_en, hi_e
+000358b0: 6e29 0a20 2020 2020 2020 2069 6620 6c65  n).        if le
+000358c0: 6e28 6d61 7463 6865 645f 7072 6f64 7329  n(matched_prods)
+000358d0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+000358e0: 2020 206d 6174 6368 6564 5f70 726f 6473     matched_prods
+000358f0: 203d 206d 6174 6368 6564 5f70 726f 6473   = matched_prods
+00035900: 5b30 5d0a 2020 2020 2020 2020 656c 6966  [0].        elif
+00035910: 206c 656e 286d 6174 6368 6564 5f70 726f   len(matched_pro
+00035920: 6473 2920 3d3d 2030 3a0a 2020 2020 2020  ds) == 0:.      
+00035930: 2020 2020 2020 7261 6973 6520 4e6f 5072        raise NoPr
+00035940: 6f64 7563 7441 7661 696c 6162 6c65 4572  oductAvailableEr
+00035950: 726f 7228 2243 616e 6e6f 7420 6669 6e64  ror("Cannot find
+00035960: 2061 6e79 207b 707d 2070 726f 6669 6c65   any {p} profile
+00035970: 7320 6d61 7463 6869 6e67 2079 6f75 7220  s matching your 
+00035980: 696e 7075 742e 222e 666f 726d 6174 2870  input.".format(p
+00035990: 3d70 726f 6669 6c65 5f74 7970 6529 290a  =profile_type)).
+000359a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000359b0: 6d61 7463 6865 645f 7072 6f64 730a 0a20  matched_prods.. 
+000359c0: 2020 2064 6566 2067 6574 5f63 6f6d 6269     def get_combi
+000359d0: 6e65 645f 7072 6f66 696c 6573 2873 656c  ned_profiles(sel
+000359e0: 662c 2070 726f 6669 6c65 5f74 7970 653a  f, profile_type:
+000359f0: 2073 7472 2c20 6365 6e74 7261 6c5f 636f   str, central_co
+00035a00: 6f72 643a 2051 7561 6e74 6974 7920 3d20  ord: Quantity = 
+00035a10: 4e6f 6e65 2c20 7261 6469 693a 2051 7561  None, radii: Qua
+00035a20: 6e74 6974 7920 3d20 4e6f 6e65 2c0a 2020  ntity = None,.  
+00035a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035a40: 2020 2020 2020 2020 2020 2020 6c6f 5f65              lo_e
+00035a50: 6e3a 2051 7561 6e74 6974 7920 3d20 4e6f  n: Quantity = No
+00035a60: 6e65 2c20 6869 5f65 6e3a 2051 7561 6e74  ne, hi_en: Quant
+00035a70: 6974 7920 3d20 4e6f 6e65 2920 5c0a 2020  ity = None) \.  
+00035a80: 2020 2020 2020 2020 2020 2d3e 2055 6e69            -> Uni
+00035a90: 6f6e 5b42 6173 6550 726f 6669 6c65 3144  on[BaseProfile1D
+00035aa0: 2c20 4c69 7374 5b42 6173 6550 726f 6669  , List[BaseProfi
+00035ab0: 6c65 3144 5d5d 3a0a 2020 2020 2020 2020  le1D]]:.        
+00035ac0: 2222 220a 2020 2020 2020 2020 5468 6520  """.        The 
+00035ad0: 6765 6e65 7269 6320 6765 7420 6d65 7468  generic get meth
+00035ae0: 6f64 2066 6f72 2058 4741 2070 726f 6669  od for XGA profi
+00035af0: 6c65 7320 6d61 6465 2075 7369 6e67 2061  les made using a
+00035b00: 6c6c 2061 7661 696c 6162 6c65 2064 6174  ll available dat
+00035b10: 6120 7768 6963 6820 6172 6520 7374 6f72  a which are stor
+00035b20: 6564 2069 6e20 7468 6973 2073 6f75 7263  ed in this sourc
+00035b30: 652e 0a20 2020 2020 2020 2059 6f75 2073  e..        You s
+00035b40: 7469 6c6c 206d 7573 7420 7265 6d65 6d62  till must rememb
+00035b50: 6572 2074 6865 2070 726f 6669 6c65 2074  er the profile t
+00035b60: 7970 6520 7661 6c75 6520 746f 2075 7365  ype value to use
+00035b70: 2069 742c 2062 7574 206f 6e63 6520 656e   it, but once en
+00035b80: 7465 7265 6420 6974 2077 696c 6c20 7265  tered it will re
+00035b90: 7475 726e 2061 206c 6973 740a 2020 2020  turn a list.    
+00035ba0: 2020 2020 6f66 2061 6c6c 206d 6174 6368      of all match
+00035bb0: 696e 6720 7072 6f66 696c 6573 2028 6f72  ing profiles (or
+00035bc0: 2061 2073 696e 676c 6520 6f62 6a65 6374   a single object
+00035bd0: 2069 6620 6f6e 6c79 206f 6e65 206d 6174   if only one mat
+00035be0: 6368 2069 7320 666f 756e 6429 2e0a 0a20  ch is found)... 
+00035bf0: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+00035c00: 7220 7072 6f66 696c 655f 7479 7065 3a20  r profile_type: 
+00035c10: 5468 6520 7374 7269 6e67 2070 726f 6669  The string profi
+00035c20: 6c65 2074 7970 6520 6f66 2074 6865 2070  le type of the p
+00035c30: 726f 6669 6c65 2873 2920 796f 7520 7769  rofile(s) you wi
+00035c40: 7368 2074 6f20 7265 7472 6965 7665 2e0a  sh to retrieve..
+00035c50: 2020 2020 2020 2020 3a70 6172 616d 2051          :param Q
+00035c60: 7561 6e74 6974 7920 6365 6e74 7261 6c5f  uantity central_
+00035c70: 636f 6f72 643a 2054 6865 2063 656e 7472  coord: The centr
+00035c80: 616c 2063 6f6f 7264 696e 6174 6520 6f66  al coordinate of
+00035c90: 2074 6865 2070 726f 6669 6c65 2079 6f75   the profile you
+00035ca0: 2077 6973 6820 746f 2072 6574 7269 6576   wish to retriev
+00035cb0: 652c 2074 6865 2064 6566 6175 6c74 0a20  e, the default. 
+00035cc0: 2020 2020 2020 2020 2020 2069 7320 4e6f             is No
+00035cd0: 6e65 2077 6869 6368 206d 6561 6e73 2074  ne which means t
+00035ce0: 6865 206d 6574 686f 6420 7769 6c6c 2075  he method will u
+00035cf0: 7365 2074 6865 2064 6566 6175 6c74 2063  se the default c
+00035d00: 6f6f 7264 696e 6174 6520 6f66 2074 6869  oordinate of thi
+00035d10: 7320 736f 7572 6365 2e0a 2020 2020 2020  s source..      
+00035d20: 2020 3a70 6172 616d 2051 7561 6e74 6974    :param Quantit
+00035d30: 7920 7261 6469 693a 2054 6865 2063 656e  y radii: The cen
+00035d40: 7472 616c 2072 6164 6969 206f 6620 7468  tral radii of th
+00035d50: 6520 7072 6f66 696c 6520 706f 696e 7473  e profile points
+00035d60: 2c20 6974 2069 7320 6e6f 7420 6c69 6b65  , it is not like
+00035d70: 6c79 2074 6861 7420 7468 6973 206f 7074  ly that this opt
+00035d80: 696f 6e20 7769 6c6c 2062 650a 2020 2020  ion will be.    
+00035d90: 2020 2020 2020 2020 7573 6564 206f 6674          used oft
+00035da0: 656e 2061 7320 796f 7520 6c69 6b65 6c79  en as you likely
+00035db0: 2077 6f6e 2774 206b 6e6f 7720 7468 6520   won't know the 
+00035dc0: 7261 6469 616c 2076 616c 7565 7320 6120  radial values a 
+00035dd0: 7072 696f 7269 2e0a 2020 2020 2020 2020  priori..        
+00035de0: 3a70 6172 616d 2051 7561 6e74 6974 7920  :param Quantity 
+00035df0: 6c6f 5f65 6e3a 2054 6865 206c 6f77 6572  lo_en: The lower
+00035e00: 2065 6e65 7267 7920 626f 756e 6420 6f66   energy bound of
+00035e10: 2074 6865 2070 726f 6669 6c65 2079 6f75   the profile you
+00035e20: 2077 6973 6820 746f 2072 6574 7269 6576   wish to retriev
+00035e30: 6520 2869 6620 6170 706c 6963 6162 6c65  e (if applicable
+00035e40: 292c 2064 6566 6175 6c74 0a20 2020 2020  ), default.     
+00035e50: 2020 2020 2020 2069 7320 4e6f 6e65 2c20         is None, 
+00035e60: 616e 6420 6966 2074 6869 7320 6172 6775  and if this argu
+00035e70: 6d65 6e74 2069 7320 7061 7373 6564 2068  ment is passed h
+00035e80: 695f 656e 206d 7573 7420 6265 2074 6f6f  i_en must be too
+00035e90: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00035ea0: 2051 7561 6e74 6974 7920 6869 5f65 6e3a   Quantity hi_en:
+00035eb0: 2054 6865 2068 6967 6865 7220 656e 6572   The higher ener
+00035ec0: 6779 2062 6f75 6e64 206f 6620 7468 6520  gy bound of the 
+00035ed0: 7072 6f66 696c 6520 796f 7520 7769 7368  profile you wish
+00035ee0: 2074 6f20 7265 7472 6965 7665 2028 6966   to retrieve (if
+00035ef0: 2061 7070 6c69 6361 626c 6529 2c20 6465   applicable), de
+00035f00: 6661 756c 740a 2020 2020 2020 2020 2020  fault.          
+00035f10: 2020 6973 204e 6f6e 652c 2061 6e64 2069    is None, and i
+00035f20: 6620 7468 6973 2061 7267 756d 656e 7420  f this argument 
+00035f30: 6973 2070 6173 7365 6420 6c6f 5f65 6e20  is passed lo_en 
+00035f40: 6d75 7374 2062 6520 746f 6f2e 0a20 2020  must be too..   
+00035f50: 2020 2020 203a 7265 7475 726e 3a20 416e       :return: An
+00035f60: 2058 4741 2070 726f 6669 6c65 206f 626a   XGA profile obj
+00035f70: 6563 7420 2869 6620 7468 6572 6520 6973  ect (if there is
+00035f80: 2061 6e20 6578 6163 7420 6d61 7463 6829   an exact match)
+00035f90: 2c20 6f72 2061 206c 6973 7420 6f66 2058  , or a list of X
+00035fa0: 4741 2070 726f 6669 6c65 206f 626a 6563  GA profile objec
+00035fb0: 7473 2028 6966 2074 6865 7265 0a20 2020  ts (if there.   
+00035fc0: 2020 2020 2020 2020 2077 6572 6520 6d75           were mu
+00035fd0: 6c74 6970 6c65 206d 6174 6368 696e 6720  ltiple matching 
+00035fe0: 7072 6f64 7563 7473 292e 0a20 2020 2020  products)..     
+00035ff0: 2020 203a 7274 7970 653a 2055 6e69 6f6e     :rtype: Union
+00036000: 5b42 6173 6550 726f 6669 6c65 3144 2c20  [BaseProfile1D, 
+00036010: 4c69 7374 5b42 6173 6550 726f 6669 6c65  List[BaseProfile
+00036020: 3144 5d5d 0a20 2020 2020 2020 2022 2222  1D]].        """
+00036030: 0a20 2020 2020 2020 2069 6620 2270 726f  .        if "pro
+00036040: 6669 6c65 2220 696e 2070 726f 6669 6c65  file" in profile
+00036050: 5f74 7970 653a 0a20 2020 2020 2020 2020  _type:.         
+00036060: 2020 2077 6172 6e28 2254 6865 2070 726f     warn("The pro
+00036070: 6669 6c65 5f74 7970 6520 796f 7520 7061  file_type you pa
+00036080: 7373 6564 2063 6f6e 7461 696e 7320 7468  ssed contains th
+00036090: 6520 776f 7264 2027 7072 6f66 696c 6527  e word 'profile'
+000360a0: 2c20 7768 6963 6820 6973 2061 7070 656e  , which is appen
+000360b0: 6465 6420 6f6e 746f 2022 0a20 2020 2020  ded onto ".     
+000360c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000360d0: 2020 2020 2022 6120 7072 6f66 696c 6520       "a profile 
+000360e0: 7479 7065 2062 7920 5847 412c 2079 6f75  type by XGA, you
+000360f0: 206e 6565 6420 746f 2074 7279 2074 6869   need to try thi
+00036100: 7320 6167 6169 6e20 7769 7468 6f75 7420  s again without 
+00036110: 7072 6f66 696c 6520 6f6e 2074 6865 2065  profile on the e
+00036120: 6e64 2c20 756e 6c65 7373 220a 2020 2020  nd, unless".    
+00036130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036140: 2020 2020 2020 2220 796f 7520 6761 7665        " you gave
+00036150: 2061 2067 656e 6572 6963 2070 726f 6669   a generic profi
+00036160: 6c65 2061 2074 7970 6520 7769 7468 2027  le a type with '
+00036170: 7072 6f66 696c 6527 2069 6e2e 222c 2073  profile' in.", s
+00036180: 7461 636b 6c65 7665 6c3d 3229 0a0a 2020  tacklevel=2)..  
+00036190: 2020 2020 2020 7365 6172 6368 5f6b 6579        search_key
+000361a0: 203d 2022 636f 6d62 696e 6564 5f22 202b   = "combined_" +
+000361b0: 2070 726f 6669 6c65 5f74 7970 6520 2b20   profile_type + 
+000361c0: 225f 7072 6f66 696c 6522 0a0a 2020 2020  "_profile"..    
+000361d0: 2020 2020 6966 2073 6561 7263 685f 6b65      if search_ke
+000361e0: 7920 6e6f 7420 696e 2041 4c4c 4f57 4544  y not in ALLOWED
+000361f0: 5f50 524f 4455 4354 533a 0a20 2020 2020  _PRODUCTS:.     
+00036200: 2020 2020 2020 2077 6172 6e28 2254 6861         warn("Tha
+00036210: 7420 7072 6f66 696c 6520 7479 7065 2073  t profile type s
+00036220: 6565 6d73 2074 6f20 6265 2061 2063 7573  eems to be a cus
+00036230: 746f 6d20 7072 6f66 696c 652c 206e 6f74  tom profile, not
+00036240: 2061 6e20 5847 4120 6465 6661 756c 7420   an XGA default 
+00036250: 7479 7065 2e20 4966 2074 6869 7320 6973  type. If this is
+00036260: 206e 6f74 2022 0a20 2020 2020 2020 2020   not ".         
+00036270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036280: 2022 7472 7565 2074 6865 6e20 796f 7520   "true then you 
+00036290: 6861 7665 2070 6173 7365 6420 616e 2069  have passed an i
+000362a0: 6e76 616c 6964 2070 726f 6669 6c65 2074  nvalid profile t
+000362b0: 7970 652e 222c 2073 7461 636b 6c65 7665  ype.", stackleve
+000362c0: 6c3d 3229 0a0a 2020 2020 2020 2020 6d61  l=2)..        ma
+000362d0: 7463 6865 645f 7072 6f64 7320 3d20 7365  tched_prods = se
+000362e0: 6c66 2e5f 6765 745f 7072 6f66 5f70 726f  lf._get_prof_pro
+000362f0: 6428 7365 6172 6368 5f6b 6579 2c20 4e6f  d(search_key, No
+00036300: 6e65 2c20 4e6f 6e65 2c20 6365 6e74 7261  ne, None, centra
+00036310: 6c5f 636f 6f72 642c 2072 6164 6969 2c20  l_coord, radii, 
+00036320: 6c6f 5f65 6e2c 2068 695f 656e 290a 2020  lo_en, hi_en).  
+00036330: 2020 2020 2020 6966 206c 656e 286d 6174        if len(mat
+00036340: 6368 6564 5f70 726f 6473 2920 3d3d 2031  ched_prods) == 1
+00036350: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+00036360: 7463 6865 645f 7072 6f64 7320 3d20 6d61  tched_prods = ma
+00036370: 7463 6865 645f 7072 6f64 735b 305d 0a20  tched_prods[0]. 
+00036380: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
+00036390: 6d61 7463 6865 645f 7072 6f64 7329 203d  matched_prods) =
+000363a0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+000363b0: 2072 6169 7365 204e 6f50 726f 6475 6374   raise NoProduct
+000363c0: 4176 6169 6c61 626c 6545 7272 6f72 2822  AvailableError("
+000363d0: 4361 6e6e 6f74 2066 696e 6420 616e 7920  Cannot find any 
+000363e0: 636f 6d62 696e 6564 207b 707d 2070 726f  combined {p} pro
+000363f0: 6669 6c65 7320 6d61 7463 6869 6e67 2079  files matching y
+00036400: 6f75 7220 220a 2020 2020 2020 2020 2020  our ".          
+00036410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036430: 2269 6e70 7574 2e22 2e66 6f72 6d61 7428  "input.".format(
+00036440: 703d 7072 6f66 696c 655f 7479 7065 2929  p=profile_type))
+00036450: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00036460: 206d 6174 6368 6564 5f70 726f 6473 0a0a   matched_prods..
+00036470: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+00036480: 2020 6465 6620 6669 7474 6564 5f6d 6f64    def fitted_mod
+00036490: 656c 7328 7365 6c66 2920 2d3e 204c 6973  els(self) -> Lis
+000364a0: 745b 7374 725d 3a0a 2020 2020 2020 2020  t[str]:.        
+000364b0: 2222 220a 2020 2020 2020 2020 5468 6973  """.        This
+000364c0: 2070 726f 7065 7274 7920 6379 636c 6573   property cycles
+000364d0: 2074 6872 6f75 6768 2061 6c6c 2074 6865   through all the
+000364e0: 2061 7661 696c 6162 6c65 2066 6974 2072   available fit r
+000364f0: 6573 756c 7473 2c20 616e 6420 6669 6e64  esults, and find
+00036500: 7320 7468 6520 756e 6971 7565 206e 616d  s the unique nam
+00036510: 6573 206f 6620 5853 5045 4320 6d6f 6465  es of XSPEC mode
+00036520: 6c73 0a20 2020 2020 2020 2074 6861 7420  ls.        that 
+00036530: 6861 7665 2062 6565 6e20 6669 7474 6564  have been fitted
+00036540: 2074 6f20 7468 6973 2073 6f75 7263 652e   to this source.
+00036550: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00036560: 6e3a 2041 206c 6973 7420 6f66 206d 6f64  n: A list of mod
+00036570: 656c 206e 616d 6573 2e0a 2020 2020 2020  el names..      
+00036580: 2020 3a72 7479 7065 3a20 4c69 7374 5b73    :rtype: List[s
+00036590: 7472 5d0a 2020 2020 2020 2020 2222 220a  tr].        """.
+000365a0: 2020 2020 2020 2020 6d6f 6465 6c73 203d          models =
+000365b0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+000365c0: 735f 6b65 7920 696e 2073 656c 662e 5f66  s_key in self._f
+000365d0: 6974 5f72 6573 756c 7473 3a0a 2020 2020  it_results:.    
+000365e0: 2020 2020 2020 2020 6d6f 6465 6c73 202b          models +
+000365f0: 3d20 6c69 7374 2873 656c 662e 5f66 6974  = list(self._fit
+00036600: 5f72 6573 756c 7473 5b73 5f6b 6579 5d2e  _results[s_key].
+00036610: 6b65 7973 2829 290a 0a20 2020 2020 2020  keys())..       
+00036620: 2072 6574 7572 6e20 6d6f 6465 6c73 0a0a   return models..
+00036630: 2020 2020 6465 6620 736e 725f 7261 6e6b      def snr_rank
+00036640: 696e 6728 7365 6c66 2c20 6f75 7465 725f  ing(self, outer_
+00036650: 7261 6469 7573 3a20 556e 696f 6e5b 5175  radius: Union[Qu
+00036660: 616e 7469 7479 2c20 7374 725d 2c20 6c6f  antity, str], lo
+00036670: 5f65 6e3a 2051 7561 6e74 6974 7920 3d20  _en: Quantity = 
+00036680: 4e6f 6e65 2c20 6869 5f65 6e3a 2051 7561  None, hi_en: Qua
+00036690: 6e74 6974 7920 3d20 4e6f 6e65 2c0a 2020  ntity = None,.  
+000366a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000366b0: 2020 616c 6c6f 775f 6e65 6761 7469 7665    allow_negative
+000366c0: 3a20 626f 6f6c 203d 2046 616c 7365 2920  : bool = False) 
+000366d0: 2d3e 2054 7570 6c65 5b6e 702e 6e64 6172  -> Tuple[np.ndar
+000366e0: 7261 792c 206e 702e 6e64 6172 7261 795d  ray, np.ndarray]
+000366f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00036700: 2020 2020 2020 5468 6973 206d 6574 686f        This metho
+00036710: 6420 6765 6e65 7261 7465 7320 6120 6c69  d generates a li
+00036720: 7374 206f 6620 4f62 7349 442d 496e 7374  st of ObsID-Inst
+00036730: 7275 6d65 6e74 2070 6169 7273 2c20 6f72  rument pairs, or
+00036740: 6465 7265 6420 6279 2074 6865 2073 6967  dered by the sig
+00036750: 6e61 6c20 746f 206e 6f69 7365 206d 6561  nal to noise mea
+00036760: 7375 7265 6420 666f 7220 7468 650a 2020  sured for the.  
+00036770: 2020 2020 2020 6769 7665 6e20 7265 6769        given regi
+00036780: 6f6e 2c20 7769 7468 2065 6c65 6d65 6e74  on, with element
+00036790: 207a 6572 6f20 6265 696e 6720 7468 6520   zero being the 
+000367a0: 6c6f 7765 7374 2053 4e52 2c20 616e 6420  lowest SNR, and 
+000367b0: 656c 656d 656e 7420 4e20 6265 696e 6720  element N being 
+000367c0: 7468 6520 6869 6768 6573 742e 0a0a 2020  the highest...  
+000367d0: 2020 2020 2020 3a70 6172 616d 2051 7561        :param Qua
+000367e0: 6e74 6974 792f 7374 7220 6f75 7465 725f  ntity/str outer_
+000367f0: 7261 6469 7573 3a20 5468 6520 7261 6469  radius: The radi
+00036800: 7573 2074 6861 7420 534e 5220 7368 6f75  us that SNR shou
+00036810: 6c64 2062 6520 6361 6c63 756c 6174 6564  ld be calculated
+00036820: 2077 6974 6869 6e2c 2074 6869 7320 6361   within, this ca
+00036830: 6e20 6569 7468 6572 2062 6520 610a 2020  n either be a.  
+00036840: 2020 2020 2020 2020 2020 6e61 6d65 6420            named 
+00036850: 7261 6469 7573 2073 7563 6820 6173 2072  radius such as r
+00036860: 3530 302c 206f 7220 616e 2061 7374 726f  500, or an astro
+00036870: 7079 2051 7561 6e74 6974 792e 0a20 2020  py Quantity..   
+00036880: 2020 2020 203a 7061 7261 6d20 5175 616e       :param Quan
+00036890: 7469 7479 206c 6f5f 656e 3a20 5468 6520  tity lo_en: The 
+000368a0: 6c6f 7765 7220 656e 6572 6779 2062 6f75  lower energy bou
+000368b0: 6e64 206f 6620 7468 6520 7261 7465 6d61  nd of the ratema
+000368c0: 7020 746f 2075 7365 2074 6f20 6361 6c63  p to use to calc
+000368d0: 756c 6174 6520 7468 6520 534e 522e 2044  ulate the SNR. D
+000368e0: 6566 6175 6c74 2069 7320 4e6f 6e65 2c0a  efault is None,.
+000368f0: 2020 2020 2020 2020 2020 2020 696e 2077              in w
+00036900: 6869 6368 2063 6173 6520 7468 6520 6c6f  hich case the lo
+00036910: 7765 7220 656e 6572 6779 2062 6f75 6e64  wer energy bound
+00036920: 2066 6f72 2070 6561 6b20 6669 6e64 696e   for peak findin
+00036930: 6720 7769 6c6c 2062 6520 7573 6564 2028  g will be used (
+00036940: 6465 6661 756c 7420 6973 2030 2e35 6b65  default is 0.5ke
+00036950: 5629 2e0a 2020 2020 2020 2020 3a70 6172  V)..        :par
+00036960: 616d 2051 7561 6e74 6974 7920 6869 5f65  am Quantity hi_e
+00036970: 6e3a 2054 6865 2075 7070 6572 2065 6e65  n: The upper ene
+00036980: 7267 7920 626f 756e 6420 6f66 2074 6865  rgy bound of the
+00036990: 2072 6174 656d 6170 2074 6f20 7573 6520   ratemap to use 
+000369a0: 746f 2063 616c 6375 6c61 7465 2074 6865  to calculate the
+000369b0: 2053 4e52 2e20 4465 6661 756c 7420 6973   SNR. Default is
+000369c0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+000369d0: 2020 2069 6e20 7768 6963 6820 6361 7365     in which case
+000369e0: 2074 6865 2075 7070 6572 2065 6e65 7267   the upper energ
+000369f0: 7920 626f 756e 6420 666f 7220 7065 616b  y bound for peak
+00036a00: 2066 696e 6469 6e67 2077 696c 6c20 6265   finding will be
+00036a10: 2075 7365 6420 2864 6566 6175 6c74 2069   used (default i
+00036a20: 7320 322e 306b 6556 292e 0a20 2020 2020  s 2.0keV)..     
+00036a30: 2020 203a 7061 7261 6d20 626f 6f6c 2061     :param bool a
+00036a40: 6c6c 6f77 5f6e 6567 6174 6976 653a 2053  llow_negative: S
+00036a50: 686f 756c 6420 7069 7865 6c73 2069 6e20  hould pixels in 
+00036a60: 7468 6520 6261 636b 6772 6f75 6e64 2073  the background s
+00036a70: 7562 7472 6163 7465 6420 636f 756e 7420  ubtracted count 
+00036a80: 6d61 7020 6265 2061 6c6c 6f77 6564 2074  map be allowed t
+00036a90: 6f20 676f 2062 656c 6f77 0a20 2020 2020  o go below.     
+00036aa0: 2020 2020 2020 207a 6572 6f2c 2077 6869         zero, whi
+00036ab0: 6368 2072 6573 756c 7473 2069 6e20 6120  ch results in a 
+00036ac0: 6c6f 7765 7220 7369 676e 616c 2074 6f20  lower signal to 
+00036ad0: 6e6f 6973 6520 2861 6e64 2063 616e 2072  noise (and can r
+00036ae0: 6573 756c 7420 696e 2061 206e 6567 6174  esult in a negat
+00036af0: 6976 6520 7369 676e 616c 2074 6f20 6e6f  ive signal to no
+00036b00: 6973 6529 2e0a 2020 2020 2020 2020 3a72  ise)..        :r
+00036b10: 6574 7572 6e3a 2054 776f 2061 7272 6179  eturn: Two array
+00036b20: 732c 2074 6865 2066 6972 7374 2061 6e20  s, the first an 
+00036b30: 4e20 6279 2032 2061 7272 6179 2c20 7769  N by 2 array, wi
+00036b40: 7468 2074 6865 204f 6273 4944 2c20 496e  th the ObsID, In
+00036b50: 7374 7275 6d65 6e74 2063 6f6d 6269 6e61  strument combina
+00036b60: 7469 6f6e 7320 696e 206f 7264 6572 0a20  tions in order. 
+00036b70: 2020 2020 2020 2020 2020 206f 6620 6173             of as
+00036b80: 6365 6e64 696e 6720 7369 676e 616c 2074  cending signal t
+00036b90: 6f20 6e6f 6973 652c 2074 6865 6e20 616e  o noise, then an
+00036ba0: 2061 7272 6179 2063 6f6e 7461 696e 696e   array containin
+00036bb0: 6720 7468 6520 6f72 6465 7220 534e 5220  g the order SNR 
+00036bc0: 7261 7469 6f73 2e0a 2020 2020 2020 2020  ratios..        
+00036bd0: 3a72 7479 7065 3a20 5475 706c 655b 6e70  :rtype: Tuple[np
+00036be0: 2e6e 6461 7272 6179 2c20 6e70 2e6e 6461  .ndarray, np.nda
+00036bf0: 7272 6179 5d0a 2020 2020 2020 2020 2222  rray].        ""
+00036c00: 220a 2020 2020 2020 2020 2320 5365 7420  ".        # Set 
+00036c10: 7570 2073 6f6d 6520 6c69 7374 7320 666f  up some lists fo
+00036c20: 7220 7468 6520 4f62 7349 442d 496e 7374  r the ObsID-Inst
+00036c30: 7275 6d65 6e74 2063 6f6d 626f 7320 616e  rument combos an
+00036c40: 6420 7468 6569 7220 534e 5273 2072 6573  d their SNRs res
+00036c50: 7065 6374 6976 656c 790a 2020 2020 2020  pectively.      
+00036c60: 2020 6f62 735f 696e 7374 203d 205b 5d0a    obs_inst = [].
+00036c70: 2020 2020 2020 2020 736e 7273 203d 205b          snrs = [
+00036c80: 5d0a 2020 2020 2020 2020 2320 5765 206c  ].        # We l
+00036c90: 6f6f 7020 7468 726f 7567 6820 7468 6520  oop through the 
+00036ca0: 4f62 7349 4473 2061 7373 6f63 6961 7465  ObsIDs associate
+00036cb0: 6420 7769 7468 2074 6869 7320 736f 7572  d with this sour
+00036cc0: 6365 2061 6e64 2074 6865 2069 6e73 7472  ce and the instr
+00036cd0: 756d 656e 7473 2061 7373 6f63 6961 7465  uments associate
+00036ce0: 6420 7769 7468 2074 686f 7365 204f 6273  d with those Obs
+00036cf0: 4944 730a 2020 2020 2020 2020 666f 7220  IDs.        for 
+00036d00: 6f62 735f 6964 2069 6e20 7365 6c66 2e69  obs_id in self.i
+00036d10: 6e73 7472 756d 656e 7473 3a0a 2020 2020  nstruments:.    
+00036d20: 2020 2020 2020 2020 666f 7220 696e 7374          for inst
+00036d30: 2069 6e20 7365 6c66 2e69 6e73 7472 756d   in self.instrum
+00036d40: 656e 7473 5b6f 6273 5f69 645d 3a0a 2020  ents[obs_id]:.  
+00036d50: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00036d60: 5573 6520 6f75 7220 6861 6e64 7920 6765  Use our handy ge
+00036d70: 745f 736e 7220 6d65 7468 6f64 2074 6f20  t_snr method to 
+00036d80: 6361 6c63 756c 6174 6520 7468 6520 534e  calculate the SN
+00036d90: 5273 2077 6520 7761 6e74 2c20 7468 656e  Rs we want, then
+00036da0: 2061 6464 2074 6861 7420 616e 6420 7468   add that and th
+00036db0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00036dc0: 2020 2320 204f 6273 4944 2d69 6e73 7420    #  ObsID-inst 
+00036dd0: 636f 6d62 6f20 696e 746f 2074 6865 6972  combo into their
+00036de0: 2072 6573 7065 6374 6976 6520 6c69 7374   respective list
+00036df0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00036e00: 2020 736e 7273 2e61 7070 656e 6428 7365    snrs.append(se
+00036e10: 6c66 2e67 6574 5f73 6e72 286f 7574 6572  lf.get_snr(outer
+00036e20: 5f72 6164 6975 732c 2073 656c 662e 6465  _radius, self.de
+00036e30: 6661 756c 745f 636f 6f72 642c 206c 6f5f  fault_coord, lo_
+00036e40: 656e 2c20 6869 5f65 6e2c 206f 6273 5f69  en, hi_en, obs_i
+00036e50: 642c 2069 6e73 742c 0a20 2020 2020 2020  d, inst,.       
+00036e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036e80: 2020 616c 6c6f 775f 6e65 6761 7469 7665    allow_negative
+00036e90: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00036ea0: 2020 206f 6273 5f69 6e73 742e 6170 7065     obs_inst.appe
+00036eb0: 6e64 285b 6f62 735f 6964 2c20 696e 7374  nd([obs_id, inst
+00036ec0: 5d29 0a0a 2020 2020 2020 2020 2320 4d61  ])..        # Ma
+00036ed0: 6b65 206f 7572 2073 746f 7261 6765 206c  ke our storage l
+00036ee0: 6973 7473 2069 6e74 6f20 6172 7261 7973  ists into arrays
+00036ef0: 2c20 6561 7369 6572 2074 6f20 776f 726b  , easier to work
+00036f00: 2077 6974 6820 7468 6174 2077 6179 0a20   with that way. 
+00036f10: 2020 2020 2020 206f 6273 5f69 6e73 7420         obs_inst 
+00036f20: 3d20 6e70 2e61 7272 6179 286f 6273 5f69  = np.array(obs_i
+00036f30: 6e73 7429 0a20 2020 2020 2020 2073 6e72  nst).        snr
+00036f40: 7320 3d20 6e70 2e61 7272 6179 2873 6e72  s = np.array(snr
+00036f50: 7329 0a0a 2020 2020 2020 2020 2320 5765  s)..        # We
+00036f60: 2077 616e 7420 746f 206f 7264 6572 2074   want to order t
+00036f70: 6865 206f 7574 7075 7420 6279 2053 4e52  he output by SNR
+00036f80: 2c20 7769 7468 2074 6865 206c 6f77 6573  , with the lowes
+00036f90: 7420 6265 696e 6720 6669 7273 7420 616e  t being first an
+00036fa0: 6420 7468 6520 6869 6768 6573 7420 6265  d the highest be
+00036fb0: 696e 6720 6c61 7374 2c20 736f 2077 650a  ing last, so we.
+00036fc0: 2020 2020 2020 2020 2320 2075 7365 2061          #  use a
+00036fd0: 206e 756d 7079 2066 756e 6374 696f 6e20   numpy function 
+00036fe0: 746f 206f 7574 7075 7420 7468 6520 696e  to output the in
+00036ff0: 6465 7820 6f72 6465 7220 6e65 6564 6564  dex order needed
+00037000: 2074 6f20 7265 2d6f 7264 6572 206f 7572   to re-order our
+00037010: 2074 776f 2061 7272 6179 730a 2020 2020   two arrays.    
+00037020: 2020 2020 7265 6f72 6465 725f 736e 7273      reorder_snrs
+00037030: 203d 206e 702e 6172 6773 6f72 7428 736e   = np.argsort(sn
+00037040: 7273 290a 2020 2020 2020 2020 2320 5468  rs).        # Th
+00037050: 656e 2077 6520 7573 6520 7468 6174 2074  en we use that t
+00037060: 6f20 7265 2d6f 7264 6572 2074 6865 6d0a  o re-order them.
+00037070: 2020 2020 2020 2020 736e 7273 203d 2073          snrs = s
+00037080: 6e72 735b 7265 6f72 6465 725f 736e 7273  nrs[reorder_snrs
+00037090: 5d0a 2020 2020 2020 2020 6f62 735f 696e  ].        obs_in
+000370a0: 7374 203d 206f 6273 5f69 6e73 745b 7265  st = obs_inst[re
+000370b0: 6f72 6465 725f 736e 7273 5d0a 0a20 2020  order_snrs]..   
+000370c0: 2020 2020 2023 2041 6e64 2072 6574 7572       # And retur
+000370d0: 6e20 6f75 7220 6f72 6465 7265 6420 6469  n our ordered di
+000370e0: 6374 696f 6e61 7269 6573 0a20 2020 2020  ctionaries.     
+000370f0: 2020 2072 6574 7572 6e20 6f62 735f 696e     return obs_in
+00037100: 7374 2c20 736e 7273 0a0a 2020 2020 6465  st, snrs..    de
+00037110: 6620 636f 756e 745f 7261 6e6b 696e 6728  f count_ranking(
+00037120: 7365 6c66 2c20 6f75 7465 725f 7261 6469  self, outer_radi
+00037130: 7573 3a20 556e 696f 6e5b 5175 616e 7469  us: Union[Quanti
+00037140: 7479 2c20 7374 725d 2c20 6c6f 5f65 6e3a  ty, str], lo_en:
+00037150: 2051 7561 6e74 6974 7920 3d20 4e6f 6e65   Quantity = None
+00037160: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00037170: 2020 2020 2020 2020 6869 5f65 6e3a 2051          hi_en: Q
+00037180: 7561 6e74 6974 7920 3d20 4e6f 6e65 2920  uantity = None) 
+00037190: 2d3e 2054 7570 6c65 5b6e 702e 6e64 6172  -> Tuple[np.ndar
+000371a0: 7261 792c 2051 7561 6e74 6974 795d 3a0a  ray, Quantity]:.
+000371b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000371c0: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
+000371d0: 6765 6e65 7261 7465 7320 6120 6c69 7374  generates a list
+000371e0: 206f 6620 4f62 7349 442d 496e 7374 7275   of ObsID-Instru
+000371f0: 6d65 6e74 2070 6169 7273 2c20 6f72 6465  ment pairs, orde
+00037200: 7265 6420 6279 2074 6865 2063 6f75 6e74  red by the count
+00037210: 7320 6d65 6173 7572 6564 2066 6f72 2074  s measured for t
+00037220: 6865 0a20 2020 2020 2020 2067 6976 656e  he.        given
+00037230: 2072 6567 696f 6e2c 2077 6974 6820 656c   region, with el
+00037240: 656d 656e 7420 7a65 726f 2062 6569 6e67  ement zero being
+00037250: 2074 6865 206c 6f77 6573 7420 636f 756e   the lowest coun
+00037260: 7473 2c20 616e 6420 656c 656d 656e 7420  ts, and element 
+00037270: 4e20 6265 696e 6720 7468 6520 6869 6768  N being the high
+00037280: 6573 742e 0a0a 2020 2020 2020 2020 3a70  est...        :p
+00037290: 6172 616d 2051 7561 6e74 6974 792f 7374  aram Quantity/st
+000372a0: 7220 6f75 7465 725f 7261 6469 7573 3a20  r outer_radius: 
+000372b0: 5468 6520 7261 6469 7573 2074 6861 7420  The radius that 
+000372c0: 636f 756e 7473 2073 686f 756c 6420 6265  counts should be
+000372d0: 2063 616c 6375 6c61 7465 6420 7769 7468   calculated with
+000372e0: 696e 2c20 7468 6973 2063 616e 2065 6974  in, this can eit
+000372f0: 6865 7220 6265 2061 0a20 2020 2020 2020  her be a.       
+00037300: 2020 2020 206e 616d 6564 2072 6164 6975       named radiu
+00037310: 7320 7375 6368 2061 7320 7235 3030 2c20  s such as r500, 
+00037320: 6f72 2061 6e20 6173 7472 6f70 7920 5175  or an astropy Qu
+00037330: 616e 7469 7479 2e0a 2020 2020 2020 2020  antity..        
+00037340: 3a70 6172 616d 2051 7561 6e74 6974 7920  :param Quantity 
+00037350: 6c6f 5f65 6e3a 2054 6865 206c 6f77 6572  lo_en: The lower
+00037360: 2065 6e65 7267 7920 626f 756e 6420 6f66   energy bound of
+00037370: 2074 6865 2072 6174 656d 6170 2074 6f20   the ratemap to 
+00037380: 7573 6520 746f 2063 616c 6375 6c61 7465  use to calculate
+00037390: 2074 6865 2063 6f75 6e74 732e 2044 6566   the counts. Def
+000373a0: 6175 6c74 2069 7320 4e6f 6e65 2c0a 2020  ault is None,.  
+000373b0: 2020 2020 2020 2020 2020 696e 2077 6869            in whi
+000373c0: 6368 2063 6173 6520 7468 6520 6c6f 7765  ch case the lowe
+000373d0: 7220 656e 6572 6779 2062 6f75 6e64 2066  r energy bound f
+000373e0: 6f72 2070 6561 6b20 6669 6e64 696e 6720  or peak finding 
+000373f0: 7769 6c6c 2062 6520 7573 6564 2028 6465  will be used (de
+00037400: 6661 756c 7420 6973 2030 2e35 6b65 5629  fault is 0.5keV)
+00037410: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00037420: 2051 7561 6e74 6974 7920 6869 5f65 6e3a   Quantity hi_en:
+00037430: 2054 6865 2075 7070 6572 2065 6e65 7267   The upper energ
+00037440: 7920 626f 756e 6420 6f66 2074 6865 2072  y bound of the r
+00037450: 6174 656d 6170 2074 6f20 7573 6520 746f  atemap to use to
+00037460: 2063 616c 6375 6c61 7465 2074 6865 2063   calculate the c
+00037470: 6f75 6e74 732e 2044 6566 6175 6c74 2069  ounts. Default i
+00037480: 7320 4e6f 6e65 2c0a 2020 2020 2020 2020  s None,.        
+00037490: 2020 2020 696e 2077 6869 6368 2063 6173      in which cas
+000374a0: 6520 7468 6520 7570 7065 7220 656e 6572  e the upper ener
+000374b0: 6779 2062 6f75 6e64 2066 6f72 2070 6561  gy bound for pea
+000374c0: 6b20 6669 6e64 696e 6720 7769 6c6c 2062  k finding will b
+000374d0: 6520 7573 6564 2028 6465 6661 756c 7420  e used (default 
+000374e0: 6973 2032 2e30 6b65 5629 2e0a 2020 2020  is 2.0keV)..    
+000374f0: 2020 2020 3a72 6574 7572 6e3a 2054 776f      :return: Two
+00037500: 2061 7272 6179 732c 2074 6865 2066 6972   arrays, the fir
+00037510: 7374 2061 6e20 4e20 6279 2032 2061 7272  st an N by 2 arr
+00037520: 6179 2c20 7769 7468 2074 6865 204f 6273  ay, with the Obs
+00037530: 4944 2c20 496e 7374 7275 6d65 6e74 2063  ID, Instrument c
+00037540: 6f6d 6269 6e61 7469 6f6e 7320 696e 206f  ombinations in o
+00037550: 7264 6572 0a20 2020 2020 2020 2020 2020  rder.           
+00037560: 206f 6620 6173 6365 6e64 696e 6720 636f   of ascending co
+00037570: 756e 7473 2c20 7468 656e 2061 6e20 6172  unts, then an ar
+00037580: 7261 7920 636f 6e74 6169 6e69 6e67 2074  ray containing t
+00037590: 6865 206f 7264 6572 2063 6f75 6e74 7320  he order counts 
+000375a0: 7261 7469 6f73 2e0a 2020 2020 2020 2020  ratios..        
+000375b0: 3a72 7479 7065 3a20 5475 706c 655b 6e70  :rtype: Tuple[np
+000375c0: 2e6e 6461 7272 6179 2c20 5175 616e 7469  .ndarray, Quanti
+000375d0: 7479 5d0a 2020 2020 2020 2020 2222 220a  ty].        """.
+000375e0: 2020 2020 2020 2020 2320 5365 7420 7570          # Set up
+000375f0: 2073 6f6d 6520 6c69 7374 7320 666f 7220   some lists for 
+00037600: 7468 6520 4f62 7349 442d 496e 7374 7275  the ObsID-Instru
+00037610: 6d65 6e74 2063 6f6d 626f 7320 616e 6420  ment combos and 
+00037620: 7468 6569 7220 636e 7473 2072 6573 7065  their cnts respe
+00037630: 6374 6976 656c 790a 2020 2020 2020 2020  ctively.        
+00037640: 6f62 735f 696e 7374 203d 205b 5d0a 2020  obs_inst = [].  
+00037650: 2020 2020 2020 636e 7473 203d 205b 5d0a        cnts = [].
+00037660: 2020 2020 2020 2020 2320 5765 206c 6f6f          # We loo
+00037670: 7020 7468 726f 7567 6820 7468 6520 4f62  p through the Ob
+00037680: 7349 4473 2061 7373 6f63 6961 7465 6420  sIDs associated 
+00037690: 7769 7468 2074 6869 7320 736f 7572 6365  with this source
+000376a0: 2061 6e64 2074 6865 2069 6e73 7472 756d   and the instrum
+000376b0: 656e 7473 2061 7373 6f63 6961 7465 6420  ents associated 
+000376c0: 7769 7468 2074 686f 7365 204f 6273 4944  with those ObsID
+000376d0: 730a 2020 2020 2020 2020 666f 7220 6f62  s.        for ob
+000376e0: 735f 6964 2069 6e20 7365 6c66 2e69 6e73  s_id in self.ins
+000376f0: 7472 756d 656e 7473 3a0a 2020 2020 2020  truments:.      
+00037700: 2020 2020 2020 666f 7220 696e 7374 2069        for inst i
+00037710: 6e20 7365 6c66 2e69 6e73 7472 756d 656e  n self.instrumen
+00037720: 7473 5b6f 6273 5f69 645d 3a0a 2020 2020  ts[obs_id]:.    
+00037730: 2020 2020 2020 2020 2020 2020 636e 7473              cnts
+00037740: 2e61 7070 656e 6428 7365 6c66 2e67 6574  .append(self.get
+00037750: 5f63 6f75 6e74 7328 6f75 7465 725f 7261  _counts(outer_ra
+00037760: 6469 7573 2c20 7365 6c66 2e64 6566 6175  dius, self.defau
+00037770: 6c74 5f63 6f6f 7264 2c20 6c6f 5f65 6e2c  lt_coord, lo_en,
+00037780: 2068 695f 656e 2c20 6f62 735f 6964 2c20   hi_en, obs_id, 
+00037790: 696e 7374 2929 0a20 2020 2020 2020 2020  inst)).         
+000377a0: 2020 2020 2020 206f 6273 5f69 6e73 742e         obs_inst.
+000377b0: 6170 7065 6e64 285b 6f62 735f 6964 2c20  append([obs_id, 
+000377c0: 696e 7374 5d29 0a0a 2020 2020 2020 2020  inst])..        
+000377d0: 2320 4d61 6b65 206f 7572 2073 746f 7261  # Make our stora
+000377e0: 6765 206c 6973 7473 2069 6e74 6f20 6172  ge lists into ar
+000377f0: 7261 7973 2c20 6561 7369 6572 2074 6f20  rays, easier to 
+00037800: 776f 726b 2077 6974 6820 7468 6174 2077  work with that w
+00037810: 6179 0a20 2020 2020 2020 206f 6273 5f69  ay.        obs_i
+00037820: 6e73 7420 3d20 6e70 2e61 7272 6179 286f  nst = np.array(o
+00037830: 6273 5f69 6e73 7429 0a20 2020 2020 2020  bs_inst).       
+00037840: 2063 6e74 7320 3d20 5175 616e 7469 7479   cnts = Quantity
+00037850: 2863 6e74 7329 0a0a 2020 2020 2020 2020  (cnts)..        
+00037860: 2320 5765 2077 616e 7420 746f 206f 7264  # We want to ord
+00037870: 6572 2074 6865 206f 7574 7075 7420 6279  er the output by
+00037880: 2063 6f75 6e74 732c 2077 6974 6820 7468   counts, with th
+00037890: 6520 6c6f 7765 7374 2062 6569 6e67 2066  e lowest being f
+000378a0: 6972 7374 2061 6e64 2074 6865 2068 6967  irst and the hig
+000378b0: 6865 7374 2062 6569 6e67 206c 6173 742c  hest being last,
+000378c0: 2073 6f20 7765 0a20 2020 2020 2020 2023   so we.        #
+000378d0: 2020 7573 6520 6120 6e75 6d70 7920 6675    use a numpy fu
+000378e0: 6e63 7469 6f6e 2074 6f20 6f75 7470 7574  nction to output
+000378f0: 2074 6865 2069 6e64 6578 206f 7264 6572   the index order
+00037900: 206e 6565 6465 6420 746f 2072 652d 6f72   needed to re-or
+00037910: 6465 7220 6f75 7220 7477 6f20 6172 7261  der our two arra
+00037920: 7973 0a20 2020 2020 2020 2072 656f 7264  ys.        reord
+00037930: 6572 5f63 6e74 7320 3d20 6e70 2e61 7267  er_cnts = np.arg
+00037940: 736f 7274 2863 6e74 7329 0a20 2020 2020  sort(cnts).     
+00037950: 2020 2023 2054 6865 6e20 7765 2075 7365     # Then we use
+00037960: 2074 6861 7420 746f 2072 652d 6f72 6465   that to re-orde
+00037970: 7220 7468 656d 0a20 2020 2020 2020 2063  r them.        c
+00037980: 6e74 7320 3d20 636e 7473 5b72 656f 7264  nts = cnts[reord
+00037990: 6572 5f63 6e74 735d 0a20 2020 2020 2020  er_cnts].       
+000379a0: 206f 6273 5f69 6e73 7420 3d20 6f62 735f   obs_inst = obs_
+000379b0: 696e 7374 5b72 656f 7264 6572 5f63 6e74  inst[reorder_cnt
+000379c0: 735d 0a0a 2020 2020 2020 2020 2320 416e  s]..        # An
+000379d0: 6420 7265 7475 726e 206f 7572 206f 7264  d return our ord
+000379e0: 6572 6564 2064 6963 7469 6f6e 6172 6965  ered dictionarie
+000379f0: 7327 0a20 2020 2020 2020 2072 6574 7572  s'.        retur
+00037a00: 6e20 6f62 735f 696e 7374 2c20 636e 7473  n obs_inst, cnts
+00037a10: 0a0a 2020 2020 6465 6620 6f66 6673 6574  ..    def offset
+00037a20: 2873 656c 662c 206f 6666 5f75 6e69 743a  (self, off_unit:
+00037a30: 2055 6e69 6f6e 5b55 6e69 742c 2073 7472   Union[Unit, str
+00037a40: 5d20 3d20 2261 7263 6d69 6e22 2920 2d3e  ] = "arcmin") ->
+00037a50: 2051 7561 6e74 6974 793a 0a20 2020 2020   Quantity:.     
+00037a60: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+00037a70: 6869 7320 6d65 7468 6f64 2063 616c 6375  his method calcu
+00037a80: 6c61 7465 7320 7468 6520 7365 7061 7261  lates the separa
+00037a90: 7469 6f6e 2062 6574 7765 656e 2074 6865  tion between the
+00037aa0: 2075 7365 7220 7375 7070 6c69 6564 2072   user supplied r
+00037ab0: 615f 6465 6320 636f 6f72 6469 6e61 7465  a_dec coordinate
+00037ac0: 732c 2061 6e64 2074 6865 2070 6561 6b0a  s, and the peak.
+00037ad0: 2020 2020 2020 2020 636f 6f72 6469 6e61          coordina
+00037ae0: 7465 7320 696e 2074 6865 2072 6571 7565  tes in the reque
+00037af0: 7374 6564 206f 6666 5f75 6e69 742e 2049  sted off_unit. I
+00037b00: 6620 7468 6572 6520 6973 206e 6f20 7065  f there is no pe
+00037b10: 616b 2061 7474 7269 6275 7465 2061 6e64  ak attribute and
+00037b20: 2065 7272 6f72 2077 696c 6c20 6265 2074   error will be t
+00037b30: 6872 6f77 6e2c 2061 6e64 2069 6620 6e6f  hrown, and if no
+00037b40: 0a20 2020 2020 2020 2070 6561 6b20 6861  .        peak ha
+00037b50: 7320 6265 656e 2063 616c 6375 6c61 7465  s been calculate
+00037b60: 6420 7468 656e 2074 6865 2072 6573 756c  d then the resul
+00037b70: 7420 7769 6c6c 2062 6520 302e 0a0a 2020  t will be 0...  
+00037b80: 2020 2020 2020 3a70 6172 616d 2055 6e69        :param Uni
+00037b90: 742f 7374 7220 6f66 665f 756e 6974 3a20  t/str off_unit: 
+00037ba0: 5468 6520 756e 6974 2074 6861 7420 7468  The unit that th
+00037bb0: 6520 6f66 6673 6574 2073 686f 756c 6420  e offset should 
+00037bc0: 6265 2069 6e2e 0a20 2020 2020 2020 203a  be in..        :
+00037bd0: 7265 7475 726e 3a20 5468 6520 6f66 6673  return: The offs
+00037be0: 6574 2062 6574 7765 656e 2072 615f 6465  et between ra_de
+00037bf0: 6320 616e 6420 7065 616b 2c20 696e 2074  c and peak, in t
+00037c00: 6865 2072 6571 7565 7374 6564 2075 6e69  he requested uni
+00037c10: 742e 0a20 2020 2020 2020 203a 7274 7970  t..        :rtyp
+00037c20: 653a 2051 7561 6e74 6974 790a 2020 2020  e: Quantity.    
+00037c30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00037c40: 2320 4368 6563 6b20 7468 6174 2074 6865  # Check that the
+00037c50: 2073 6f75 7263 6520 6861 7320 6120 7065   source has a pe
+00037c60: 616b 2061 7474 7269 6275 7465 2074 6f20  ak attribute to 
+00037c70: 6665 7463 682c 206f 7468 6572 7769 7365  fetch, otherwise
+00037c80: 2074 6872 6f77 2065 7272 6f72 0a20 2020   throw error.   
+00037c90: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
+00037ca0: 7474 7228 7365 6c66 2c20 2770 6561 6b27  ttr(self, 'peak'
+00037cb0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00037cc0: 6169 7365 2041 7474 7269 6275 7465 4572  aise AttributeEr
+00037cd0: 726f 7228 2254 6869 7320 736f 7572 6365  ror("This source
+00037ce0: 2064 6f65 7320 6e6f 7420 6861 7665 2061   does not have a
+00037cf0: 2070 6561 6b20 6174 7472 6962 7574 652c   peak attribute,
+00037d00: 2061 6e64 2073 6f20 616e 206f 6666 7365   and so an offse
+00037d10: 7420 6361 6e6e 6f74 2062 6520 6361 6c63  t cannot be calc
+00037d20: 756c 6174 6564 2e22 290a 0a20 2020 2020  ulated.")..     
+00037d30: 2020 2023 2043 616c 6375 6c61 7465 2074     # Calculate t
+00037d40: 6865 2065 7563 6c69 6465 616e 2064 6973  he euclidean dis
+00037d50: 7461 6e63 6520 6265 7477 6565 6e20 7261  tance between ra
+00037d60: 5f64 6563 2061 6e64 2070 6561 6b0a 2020  _dec and peak.  
+00037d70: 2020 2020 2020 7365 7020 3d20 6e70 2e73        sep = np.s
+00037d80: 7172 7428 6162 7328 7365 6c66 2e72 615f  qrt(abs(self.ra_
+00037d90: 6465 635b 305d 202d 2073 656c 662e 7065  dec[0] - self.pe
+00037da0: 616b 5b30 5d29 202a 2a20 3220 2b20 6162  ak[0]) ** 2 + ab
+00037db0: 7328 7365 6c66 2e72 615f 6465 635b 315d  s(self.ra_dec[1]
+00037dc0: 202d 2073 656c 662e 7065 616b 5b31 5d29   - self.peak[1])
+00037dd0: 202a 2a20 3229 0a20 2020 2020 2020 2023   ** 2).        #
+00037de0: 2043 6f6e 7665 7274 2074 6865 2073 6570   Convert the sep
+00037df0: 6172 6174 696f 6e20 746f 2074 6865 2072  aration to the r
+00037e00: 6571 7565 7374 6564 2075 6e69 7420 2d20  equested unit - 
+00037e10: 7468 6973 2077 696c 6c20 7468 726f 7720  this will throw 
+00037e20: 616e 2065 7272 6f72 2069 6620 7468 6520  an error if the 
+00037e30: 756e 6974 2069 7320 7374 7570 6964 0a20  unit is stupid. 
+00037e40: 2020 2020 2020 2063 6f6e 765f 7365 7020         conv_sep 
+00037e50: 3d20 7365 6c66 2e63 6f6e 7665 7274 5f72  = self.convert_r
+00037e60: 6164 6975 7328 7365 702c 206f 6666 5f75  adius(sep, off_u
+00037e70: 6e69 7429 0a0a 2020 2020 2020 2020 2320  nit)..        # 
+00037e80: 5265 7475 726e 2074 6865 2063 6f6e 7665  Return the conve
+00037e90: 7274 6564 2073 6570 6172 6174 696f 6e0a  rted separation.
+00037ea0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00037eb0: 6f6e 765f 7365 700a 0a20 2020 2040 7072  onv_sep..    @pr
+00037ec0: 6f70 6572 7479 0a20 2020 2064 6566 2070  operty.    def p
+00037ed0: 6561 6b5f 6c6f 5f65 6e28 7365 6c66 2920  eak_lo_en(self) 
+00037ee0: 2d3e 2051 7561 6e74 6974 793a 0a20 2020  -> Quantity:.   
+00037ef0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00037f00: 2054 6869 7320 7072 6f70 6572 7479 2072   This property r
+00037f10: 6574 7572 6e73 2074 6865 206c 6f77 6572  eturns the lower
+00037f20: 2065 6e65 7267 7920 626f 756e 6420 6f66   energy bound of
+00037f30: 2074 6865 2069 6d61 6765 2075 7365 6420   the image used 
+00037f40: 666f 7220 7065 616b 2066 696e 6469 6e67  for peak finding
+00037f50: 2e0a 0a20 2020 2020 2020 203a 7265 7475  ...        :retu
+00037f60: 726e 3a20 4120 7175 616e 7469 7479 2063  rn: A quantity c
+00037f70: 6f6e 7461 696e 696e 6720 7468 6520 6c6f  ontaining the lo
+00037f80: 7765 7220 656e 6572 6779 206c 696d 6974  wer energy limit
+00037f90: 2075 7365 6420 666f 7220 7065 616b 2066   used for peak f
+00037fa0: 696e 6469 6e67 2e0a 2020 2020 2020 2020  inding..        
+00037fb0: 3a72 7479 7065 3a20 5175 616e 7469 7479  :rtype: Quantity
+00037fc0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00037fd0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00037fe0: 2e5f 7065 616b 5f6c 6f5f 656e 0a0a 2020  ._peak_lo_en..  
+00037ff0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00038000: 6465 6620 7065 616b 5f68 695f 656e 2873  def peak_hi_en(s
+00038010: 656c 6629 202d 3e20 5175 616e 7469 7479  elf) -> Quantity
+00038020: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00038030: 2020 2020 2020 5468 6973 2070 726f 7065        This prope
+00038040: 7274 7920 7265 7475 726e 7320 7468 6520  rty returns the 
+00038050: 7570 7065 7220 656e 6572 6779 2062 6f75  upper energy bou
+00038060: 6e64 206f 6620 7468 6520 696d 6167 6520  nd of the image 
+00038070: 7573 6564 2066 6f72 2070 6561 6b20 6669  used for peak fi
+00038080: 6e64 696e 672e 0a0a 2020 2020 2020 2020  nding...        
+00038090: 3a72 6574 7572 6e3a 2041 2071 7561 6e74  :return: A quant
+000380a0: 6974 7920 636f 6e74 6169 6e69 6e67 2074  ity containing t
+000380b0: 6865 2075 7070 6572 2065 6e65 7267 7920  he upper energy 
+000380c0: 6c69 6d69 7420 7573 6564 2066 6f72 2070  limit used for p
+000380d0: 6561 6b20 6669 6e64 696e 672e 0a20 2020  eak finding..   
+000380e0: 2020 2020 203a 7274 7970 653a 2051 7561       :rtype: Qua
+000380f0: 6e74 6974 790a 2020 2020 2020 2020 2222  ntity.        ""
+00038100: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00038110: 2073 656c 662e 5f70 6561 6b5f 6869 5f65   self._peak_hi_e
+00038120: 6e0a 0a20 2020 2040 7072 6f70 6572 7479  n..    @property
+00038130: 0a20 2020 2064 6566 2075 7365 5f70 6561  .    def use_pea
+00038140: 6b28 7365 6c66 2920 2d3e 2062 6f6f 6c3a  k(self) -> bool:
+00038150: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00038160: 2020 2020 2054 6869 7320 7072 6f70 6572       This proper
+00038170: 7479 2073 686f 7773 2077 6865 7468 6572  ty shows whether
+00038180: 2061 2070 6172 7469 6375 6c61 7220 5847   a particular XG
+00038190: 4120 736f 7572 6365 206f 626a 6563 7420  A source object 
+000381a0: 6861 7320 6265 656e 2073 6574 7570 2074  has been setup t
+000381b0: 6f20 7573 6520 7065 616b 2063 6f6f 7264  o use peak coord
+000381c0: 696e 6174 6573 0a20 2020 2020 2020 206f  inates.        o
+000381d0: 7220 6e6f 742e 2054 6865 2070 726f 7065  r not. The prope
+000381e0: 7274 7920 6973 2065 6974 6865 7220 5472  rty is either Tr
+000381f0: 7565 2c20 4661 6c73 652c 206f 7220 4e6f  ue, False, or No
+00038200: 6e65 2028 6966 2069 7473 2061 2042 6173  ne (if its a Bas
+00038210: 6553 6f75 7263 6529 2e0a 0a20 2020 2020  eSource)...     
+00038220: 2020 203a 7265 7475 726e 3a20 4966 2074     :return: If t
+00038230: 6865 2073 6f75 7263 6520 6973 2073 6574  he source is set
+00038240: 2074 6f20 7573 6520 7065 616b 732c 2054   to use peaks, T
+00038250: 7275 652c 206f 7468 6572 7769 7365 2046  rue, otherwise F
+00038260: 616c 7365 2e0a 2020 2020 2020 2020 3a72  alse..        :r
+00038270: 7479 7065 3a20 626f 6f6c 0a20 2020 2020  type: bool.     
+00038280: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00038290: 6574 7572 6e20 7365 6c66 2e5f 7573 655f  eturn self._use_
+000382a0: 7065 616b 0a0a 2020 2020 4070 726f 7065  peak..    @prope
+000382b0: 7274 790a 2020 2020 6465 6620 7375 7070  rty.    def supp
+000382c0: 7265 7373 6564 5f77 6172 6e69 6e67 7328  ressed_warnings(
+000382d0: 7365 6c66 2920 2d3e 204c 6973 745b 7374  self) -> List[st
+000382e0: 725d 3a0a 2020 2020 2020 2020 2222 220a  r]:.        """.
+000382f0: 2020 2020 2020 2020 4120 7072 6f70 6572          A proper
+00038300: 7479 2067 6574 7465 7220 2877 6974 6820  ty getter (with 
+00038310: 6e6f 2073 6574 7465 7229 2066 6f72 2074  no setter) for t
+00038320: 6865 2077 6172 6e69 6e67 7320 7468 6174  he warnings that
+00038330: 2068 6176 6520 6265 656e 2073 7570 7072   have been suppr
+00038340: 6573 7365 6420 6672 6f6d 2064 6973 706c  essed from displ
+00038350: 6179 2074 6f20 7468 6520 7573 6572 2061  ay to the user a
+00038360: 730a 2020 2020 2020 2020 7468 6520 736f  s.        the so
+00038370: 7572 6365 2077 6173 2064 6563 6c61 7265  urce was declare
+00038380: 6420 6173 2061 206d 656d 6265 7220 6f66  d as a member of
+00038390: 2061 2073 616d 706c 652e 0a0a 2020 2020   a sample...    
+000383a0: 2020 2020 3a72 6574 7572 6e3a 2054 6865      :return: The
+000383b0: 206c 6973 7420 6f66 2073 7570 7072 6573   list of suppres
+000383c0: 7365 6420 7761 726e 696e 6773 2066 6f72  sed warnings for
+000383d0: 2074 6869 7320 736f 7572 6365 2e0a 2020   this source..  
+000383e0: 2020 2020 2020 3a72 7479 7065 3a20 4c69        :rtype: Li
+000383f0: 7374 5b73 7472 5d0a 2020 2020 2020 2020  st[str].        
+00038400: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+00038410: 6f74 2073 656c 662e 5f73 616d 705f 6d65  ot self._samp_me
+00038420: 6d62 6572 3a0a 2020 2020 2020 2020 2020  mber:.          
+00038430: 2020 7261 6973 6520 4e6f 7453 616d 706c    raise NotSampl
+00038440: 654d 656d 6265 7245 7272 6f72 2822 5468  eMemberError("Th
+00038450: 6520 736f 7572 6365 2066 6f72 207b 6e7d  e source for {n}
+00038460: 2069 7320 6e6f 7420 6120 6d65 6d62 6572   is not a member
+00038470: 206f 6620 6120 7361 6d70 6c65 2c20 616e   of a sample, an
+00038480: 6420 6173 2073 7563 6820 7761 726e 696e  d as such warnin
+00038490: 6773 2068 6176 6520 220a 2020 2020 2020  gs have ".      
+000384a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000384b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000384c0: 2022 6e6f 7420 6265 656e 2073 7570 7072   "not been suppr
+000384d0: 6573 7365 642e 222e 666f 726d 6174 286e  essed.".format(n
+000384e0: 3d73 656c 662e 6e61 6d65 2929 0a20 2020  =self.name)).   
+000384f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00038500: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00038510: 6c66 2e5f 7375 7070 5f77 6172 6e0a 0a20  lf._supp_warn.. 
+00038520: 2020 2064 6566 2069 6e66 6f28 7365 6c66     def info(self
+00038530: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00038540: 2020 2020 2020 2056 6572 7920 7369 6d70         Very simp
+00038550: 6c65 2066 756e 6374 696f 6e20 7468 6174  le function that
+00038560: 206a 7573 7420 7072 696e 7473 2061 2073   just prints a s
+00038570: 756d 6d61 7279 206f 6620 696d 706f 7274  ummary of import
+00038580: 616e 7420 696e 666f 726d 6174 696f 6e20  ant information 
+00038590: 7265 6c61 7465 6420 746f 2074 6865 2073  related to the s
+000385a0: 6f75 7263 6520 6f62 6a65 6374 2e2e 0a20  ource object... 
+000385b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000385c0: 2020 2070 7269 6e74 2822 5c6e 2d2d 2d2d     print("\n----
+000385d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000385e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000385f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00038600: 2d22 290a 2020 2020 2020 2020 7072 696e  -").        prin
+00038610: 7428 2253 6f75 7263 6520 4e61 6d65 202d  t("Source Name -
+00038620: 207b 7d22 2e66 6f72 6d61 7428 7365 6c66   {}".format(self
+00038630: 2e5f 6e61 6d65 2929 0a20 2020 2020 2020  ._name)).       
+00038640: 2070 7269 6e74 2822 5573 6572 2043 6f6f   print("User Coo
+00038650: 7264 696e 6174 6573 202d 2028 7b30 7d2c  rdinates - ({0},
+00038660: 207b 317d 2920 6465 6772 6565 7322 2e66   {1}) degrees".f
+00038670: 6f72 6d61 7428 2a73 656c 662e 5f72 615f  ormat(*self._ra_
+00038680: 6465 6329 290a 2020 2020 2020 2020 6966  dec)).        if
+00038690: 2073 656c 662e 5f75 7365 5f70 6561 6b20   self._use_peak 
+000386a0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+000386b0: 7365 6c66 2e5f 7573 655f 7065 616b 3a0a  self._use_peak:.
+000386c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000386d0: 7428 2258 2d72 6179 2050 6561 6b20 2d20  t("X-ray Peak - 
+000386e0: 287b 307d 2c20 7b31 7d29 2064 6567 7265  ({0}, {1}) degre
+000386f0: 6573 222e 666f 726d 6174 282a 7365 6c66  es".format(*self
+00038700: 2e5f 7065 616b 735b 2263 6f6d 6269 6e65  ._peaks["combine
+00038710: 6422 5d2e 7661 6c75 6529 290a 2020 2020  d"].value)).    
+00038720: 2020 2020 7072 696e 7428 226e 4820 2d20      print("nH - 
+00038730: 7b7d 222e 666f 726d 6174 2873 656c 662e  {}".format(self.
+00038740: 6e48 2929 0a20 2020 2020 2020 2069 6620  nH)).        if 
+00038750: 7365 6c66 2e5f 7265 6473 6869 6674 2069  self._redshift i
+00038760: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00038770: 2020 2020 2020 2020 7072 696e 7428 2252          print("R
+00038780: 6564 7368 6966 7420 2d20 7b7d 222e 666f  edshift - {}".fo
+00038790: 726d 6174 2872 6f75 6e64 2873 656c 662e  rmat(round(self.
+000387a0: 5f72 6564 7368 6966 742c 2033 2929 290a  _redshift, 3))).
+000387b0: 2020 2020 2020 2020 7072 696e 7428 2258          print("X
+000387c0: 4d4d 204f 6273 4944 7320 2d20 7b7d 222e  MM ObsIDs - {}".
+000387d0: 666f 726d 6174 2873 656c 662e 5f5f 6c65  format(self.__le
+000387e0: 6e5f 5f28 2929 290a 2020 2020 2020 2020  n__())).        
+000387f0: 7072 696e 7428 2250 4e20 4f62 7365 7276  print("PN Observ
+00038800: 6174 696f 6e73 202d 207b 7d22 2e66 6f72  ations - {}".for
+00038810: 6d61 7428 7365 6c66 2e6e 756d 5f70 6e5f  mat(self.num_pn_
+00038820: 6f62 7329 290a 2020 2020 2020 2020 7072  obs)).        pr
+00038830: 696e 7428 224d 4f53 3120 4f62 7365 7276  int("MOS1 Observ
+00038840: 6174 696f 6e73 202d 207b 7d22 2e66 6f72  ations - {}".for
+00038850: 6d61 7428 7365 6c66 2e6e 756d 5f6d 6f73  mat(self.num_mos
+00038860: 315f 6f62 7329 290a 2020 2020 2020 2020  1_obs)).        
+00038870: 7072 696e 7428 224d 4f53 3220 4f62 7365  print("MOS2 Obse
+00038880: 7276 6174 696f 6e73 202d 207b 7d22 2e66  rvations - {}".f
+00038890: 6f72 6d61 7428 7365 6c66 2e6e 756d 5f6d  ormat(self.num_m
+000388a0: 6f73 325f 6f62 7329 290a 2020 2020 2020  os2_obs)).      
+000388b0: 2020 7072 696e 7428 224f 6e2d 4178 6973    print("On-Axis
+000388c0: 202d 207b 7d22 2e66 6f72 6d61 7428 6c65   - {}".format(le
+000388d0: 6e28 7365 6c66 2e5f 6f6e 6178 6973 2929  n(self._onaxis))
+000388e0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+000388f0: 2257 6974 6820 7265 6769 6f6e 7320 2d20  "With regions - 
+00038900: 7b7d 222e 666f 726d 6174 286c 656e 2873  {}".format(len(s
+00038910: 656c 662e 5f69 6e69 7469 616c 5f72 6567  elf._initial_reg
+00038920: 696f 6e73 2929 290a 2020 2020 2020 2020  ions))).        
+00038930: 7072 696e 7428 2254 6f74 616c 2072 6567  print("Total reg
+00038940: 696f 6e73 202d 207b 7d22 2e66 6f72 6d61  ions - {}".forma
+00038950: 7428 7375 6d28 5b6c 656e 2873 656c 662e  t(sum([len(self.
+00038960: 5f69 6e69 7469 616c 5f72 6567 696f 6e73  _initial_regions
+00038970: 5b6f 5d29 2066 6f72 206f 2069 6e20 7365  [o]) for o in se
+00038980: 6c66 2e5f 696e 6974 6961 6c5f 7265 6769  lf._initial_regi
+00038990: 6f6e 735d 2929 290a 2020 2020 2020 2020  ons]))).        
+000389a0: 7072 696e 7428 224f 6273 2077 6974 6820  print("Obs with 
+000389b0: 3120 6465 7465 6374 696f 6e20 2d20 7b7d  1 detection - {}
+000389c0: 222e 666f 726d 6174 2873 756d 285b 3120  ".format(sum([1 
+000389d0: 666f 7220 6f20 696e 2073 656c 662e 5f69  for o in self._i
+000389e0: 6e69 7469 616c 5f72 6567 696f 6e5f 6d61  nitial_region_ma
+000389f0: 7463 6865 7320 6966 0a20 2020 2020 2020  tches if.       
+00038a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038a20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00038a30: 662e 5f69 6e69 7469 616c 5f72 6567 696f  f._initial_regio
+00038a40: 6e5f 6d61 7463 6865 735b 6f5d 2e73 756d  n_matches[o].sum
+00038a50: 2829 203d 3d20 315d 2929 290a 2020 2020  () == 1]))).    
+00038a60: 2020 2020 7072 696e 7428 224f 6273 2077      print("Obs w
+00038a70: 6974 6820 3e31 206d 6174 6368 6573 202d  ith >1 matches -
+00038a80: 207b 7d22 2e66 6f72 6d61 7428 7375 6d28   {}".format(sum(
+00038a90: 5b31 2066 6f72 206f 2069 6e20 7365 6c66  [1 for o in self
+00038aa0: 2e5f 696e 6974 6961 6c5f 7265 6769 6f6e  ._initial_region
+00038ab0: 5f6d 6174 6368 6573 2069 660a 2020 2020  _matches if.    
+00038ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038af0: 2073 656c 662e 5f69 6e69 7469 616c 5f72   self._initial_r
+00038b00: 6567 696f 6e5f 6d61 7463 6865 735b 6f5d  egion_matches[o]
+00038b10: 2e73 756d 2829 203e 2031 5d29 2929 0a20  .sum() > 1]))). 
+00038b20: 2020 2020 2020 2023 2049 6620 6120 636f         # If a co
+00038b30: 6d62 696e 6564 2065 7870 6f73 7572 6520  mbined exposure 
+00038b40: 6d61 7020 6578 6973 7473 2c20 7765 276c  map exists, we'l
+00038b50: 6c20 7573 6520 6974 2074 6f20 6769 7665  l use it to give
+00038b60: 2074 6865 2075 7365 7220 616e 2069 6465   the user an ide
+00038b70: 6120 6f66 2074 6865 2074 6f74 616c 2065  a of the total e
+00038b80: 7870 6f73 7572 650a 2020 2020 2020 2020  xposure.        
+00038b90: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00038ba0: 2065 7820 3d20 7365 6c66 2e67 6574 5f63   ex = self.get_c
+00038bb0: 6f6d 6269 6e65 645f 6578 706d 6170 7328  ombined_expmaps(
+00038bc0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00038bd0: 2069 7369 6e73 7461 6e63 6528 6578 2c20   isinstance(ex, 
+00038be0: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+00038bf0: 2020 2020 2020 2065 7820 3d20 6578 5b30         ex = ex[0
+00038c00: 5d0a 2020 2020 2020 2020 2020 2020 7072  ].            pr
+00038c10: 696e 7428 2254 6f74 616c 2065 7870 6f73  int("Total expos
+00038c20: 7572 6520 2d20 7b7d 222e 666f 726d 6174  ure - {}".format
+00038c30: 2865 782e 6765 745f 6578 7028 7365 6c66  (ex.get_exp(self
+00038c40: 2e72 615f 6465 6329 2e74 6f28 276b 7327  .ra_dec).to('ks'
+00038c50: 292e 726f 756e 6428 3229 2929 0a20 2020  ).round(2))).   
+00038c60: 2020 2020 2065 7863 6570 7420 4e6f 5072       except NoPr
+00038c70: 6f64 7563 7441 7661 696c 6162 6c65 4572  oductAvailableEr
+00038c80: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00038c90: 2070 6173 730a 2020 2020 2020 2020 7072   pass.        pr
+00038ca0: 696e 7428 2249 6d61 6765 7320 6173 736f  int("Images asso
+00038cb0: 6369 6174 6564 202d 207b 7d22 2e66 6f72  ciated - {}".for
+00038cc0: 6d61 7428 6c65 6e28 7365 6c66 2e67 6574  mat(len(self.get
+00038cd0: 5f70 726f 6475 6374 7328 2269 6d61 6765  _products("image
+00038ce0: 2229 2929 290a 2020 2020 2020 2020 7072  ")))).        pr
+00038cf0: 696e 7428 2245 7870 6f73 7572 6520 6d61  int("Exposure ma
+00038d00: 7073 2061 7373 6f63 6961 7465 6420 2d20  ps associated - 
+00038d10: 7b7d 222e 666f 726d 6174 286c 656e 2873  {}".format(len(s
+00038d20: 656c 662e 6765 745f 7072 6f64 7563 7473  elf.get_products
+00038d30: 2822 6578 706d 6170 2229 2929 290a 2020  ("expmap")))).  
+00038d40: 2020 2020 2020 7072 696e 7428 2243 6f6d        print("Com
+00038d50: 6269 6e65 6420 5261 7465 6d61 7073 2061  bined Ratemaps a
+00038d60: 7373 6f63 6961 7465 6420 2d20 7b7d 222e  ssociated - {}".
+00038d70: 666f 726d 6174 286c 656e 2873 656c 662e  format(len(self.
+00038d80: 6765 745f 7072 6f64 7563 7473 2822 636f  get_products("co
+00038d90: 6d62 696e 6564 5f72 6174 656d 6170 2229  mbined_ratemap")
+00038da0: 2929 290a 2020 2020 2020 2020 7072 696e  ))).        prin
+00038db0: 7428 2253 7065 6374 7261 2061 7373 6f63  t("Spectra assoc
+00038dc0: 6961 7465 6420 2d20 7b7d 222e 666f 726d  iated - {}".form
+00038dd0: 6174 286c 656e 2873 656c 662e 6765 745f  at(len(self.get_
+00038de0: 7072 6f64 7563 7473 2822 7370 6563 7472  products("spectr
+00038df0: 756d 2229 2929 290a 0a20 2020 2020 2020  um"))))..       
+00038e00: 2069 6620 6c65 6e28 7365 6c66 2e5f 6669   if len(self._fi
+00038e10: 745f 7265 7375 6c74 7329 2021 3d20 303a  t_results) != 0:
+00038e20: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00038e30: 6e74 2822 4669 7474 6564 204d 6f64 656c  nt("Fitted Model
+00038e40: 7320 2d20 7b7d 222e 666f 726d 6174 2822  s - {}".format("
+00038e50: 207c 2022 2e6a 6f69 6e28 7365 6c66 2e66   | ".join(self.f
+00038e60: 6974 7465 645f 6d6f 6465 6c73 2929 290a  itted_models))).
+00038e70: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00038e80: 2e5f 7265 6769 6f6e 7320 6973 206e 6f74  ._regions is not
+00038e90: 204e 6f6e 6520 616e 6420 2263 7573 746f   None and "custo
+00038ea0: 6d22 2069 6e20 7365 6c66 2e5f 7261 6469  m" in self._radi
+00038eb0: 693a 0a20 2020 2020 2020 2020 2020 2069  i:.            i
+00038ec0: 6620 7365 6c66 2e5f 7265 6473 6869 6674  f self._redshift
+00038ed0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00038ee0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00038ef0: 6769 6f6e 5f72 6164 6975 7320 3d20 616e  gion_radius = an
+00038f00: 675f 746f 5f72 6164 2873 656c 662e 5f63  g_to_rad(self._c
+00038f10: 7573 746f 6d5f 7265 6769 6f6e 5f72 6164  ustom_region_rad
+00038f20: 6975 732c 2073 656c 662e 5f72 6564 7368  ius, self._redsh
+00038f30: 6966 742c 2063 6f73 6d6f 3d73 656c 662e  ift, cosmo=self.
+00038f40: 5f63 6f73 6d6f 290a 2020 2020 2020 2020  _cosmo).        
+00038f50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00038f60: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+00038f70: 5f72 6164 6975 7320 3d20 7365 6c66 2e5f  _radius = self._
+00038f80: 6375 7374 6f6d 5f72 6567 696f 6e5f 7261  custom_region_ra
+00038f90: 6469 7573 2e74 6f28 2264 6567 2229 0a20  dius.to("deg"). 
+00038fa0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00038fb0: 2822 4375 7374 6f6d 2052 6567 696f 6e20  ("Custom Region 
+00038fc0: 5261 6469 7573 202d 207b 7d22 2e66 6f72  Radius - {}".for
+00038fd0: 6d61 7428 7265 6769 6f6e 5f72 6164 6975  mat(region_radiu
+00038fe0: 732e 726f 756e 6428 3229 2929 0a20 2020  s.round(2))).   
+00038ff0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00039000: 7365 6c66 2e67 6574 5f70 726f 6475 6374  self.get_product
+00039010: 7328 2763 6f6d 6269 6e65 645f 696d 6167  s('combined_imag
+00039020: 6527 2929 2021 3d20 303a 0a20 2020 2020  e')) != 0:.     
+00039030: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00039040: 2822 4375 7374 6f6d 2052 6567 696f 6e20  ("Custom Region 
+00039050: 534e 5220 2d20 7b7d 222e 666f 726d 6174  SNR - {}".format
+00039060: 2873 656c 662e 6765 745f 736e 7228 2263  (self.get_snr("c
+00039070: 7573 746f 6d22 2c20 7365 6c66 2e5f 6465  ustom", self._de
+00039080: 6661 756c 745f 636f 6f72 6429 2e72 6f75  fault_coord).rou
+00039090: 6e64 2832 2929 290a 0a20 2020 2020 2020  nd(2)))..       
+000390a0: 2069 6620 7365 6c66 2e5f 7232 3030 2069   if self._r200 i
+000390b0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000390c0: 2020 2020 2020 2020 7072 696e 7428 2252          print("R
+000390d0: 3230 3020 2d20 7b7d 222e 666f 726d 6174  200 - {}".format
+000390e0: 2873 656c 662e 5f72 3230 302e 726f 756e  (self._r200.roun
+000390f0: 6428 3229 2929 0a20 2020 2020 2020 2020  d(2))).         
+00039100: 2020 2069 6620 6c65 6e28 7365 6c66 2e67     if len(self.g
+00039110: 6574 5f70 726f 6475 6374 7328 2763 6f6d  et_products('com
+00039120: 6269 6e65 645f 696d 6167 6527 2929 2021  bined_image')) !
+00039130: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00039140: 2020 2020 2070 7269 6e74 2822 5232 3030       print("R200
+00039150: 2053 4e52 202d 207b 7d22 2e66 6f72 6d61   SNR - {}".forma
+00039160: 7428 7365 6c66 2e67 6574 5f73 6e72 2822  t(self.get_snr("
+00039170: 7232 3030 222c 2073 656c 662e 5f64 6566  r200", self._def
+00039180: 6175 6c74 5f63 6f6f 7264 292e 726f 756e  ault_coord).roun
+00039190: 6428 3229 2929 0a20 2020 2020 2020 2069  d(2))).        i
+000391a0: 6620 7365 6c66 2e5f 7235 3030 2069 7320  f self._r500 is 
+000391b0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000391c0: 2020 2020 2020 7072 696e 7428 2252 3530        print("R50
+000391d0: 3020 2d20 7b7d 222e 666f 726d 6174 2873  0 - {}".format(s
+000391e0: 656c 662e 5f72 3530 302e 726f 756e 6428  elf._r500.round(
+000391f0: 3229 2929 0a20 2020 2020 2020 2020 2020  2))).           
+00039200: 2069 6620 6c65 6e28 7365 6c66 2e67 6574   if len(self.get
+00039210: 5f70 726f 6475 6374 7328 2763 6f6d 6269  _products('combi
+00039220: 6e65 645f 696d 6167 6527 2929 2021 3d20  ned_image')) != 
+00039230: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00039240: 2020 2070 7269 6e74 2822 5235 3030 2053     print("R500 S
+00039250: 4e52 202d 207b 7d22 2e66 6f72 6d61 7428  NR - {}".format(
+00039260: 7365 6c66 2e67 6574 5f73 6e72 2822 7235  self.get_snr("r5
+00039270: 3030 222c 2073 656c 662e 5f64 6566 6175  00", self._defau
+00039280: 6c74 5f63 6f6f 7264 292e 726f 756e 6428  lt_coord).round(
+00039290: 3229 2929 0a20 2020 2020 2020 2069 6620  2))).        if 
+000392a0: 7365 6c66 2e5f 7232 3530 3020 6973 206e  self._r2500 is n
+000392b0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000392c0: 2020 2020 2070 7269 6e74 2822 5232 3530       print("R250
+000392d0: 3020 2d20 7b7d 222e 666f 726d 6174 2873  0 - {}".format(s
+000392e0: 656c 662e 5f72 3235 3030 2e72 6f75 6e64  elf._r2500.round
+000392f0: 2832 2929 290a 2020 2020 2020 2020 2020  (2))).          
+00039300: 2020 6966 206c 656e 2873 656c 662e 6765    if len(self.ge
+00039310: 745f 7072 6f64 7563 7473 2827 636f 6d62  t_products('comb
+00039320: 696e 6564 5f69 6d61 6765 2729 2920 213d  ined_image')) !=
+00039330: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00039340: 2020 2020 7072 696e 7428 2252 3235 3030      print("R2500
+00039350: 2053 4e52 202d 207b 7d22 2e66 6f72 6d61   SNR - {}".forma
+00039360: 7428 7365 6c66 2e67 6574 5f73 6e72 2822  t(self.get_snr("
+00039370: 7232 3530 3022 2c20 7365 6c66 2e5f 6465  r2500", self._de
+00039380: 6661 756c 745f 636f 6f72 6429 2e72 6f75  fault_coord).rou
+00039390: 6e64 2832 2929 290a 0a20 2020 2020 2020  nd(2)))..       
+000393a0: 2023 2054 6865 7265 2773 2070 726f 6261   # There's proba
+000393b0: 626c 7920 6120 6e65 6174 6572 2077 6179  bly a neater way
+000393c0: 206f 6620 646f 696e 6720 7468 6520 6f62   of doing the ob
+000393d0: 7365 7276 6162 6c65 7320 2d20 6d61 7962  servables - mayb
+000393e0: 6520 6120 666f 726d 6174 7469 6e67 2066  e a formatting f
+000393f0: 756e 6374 696f 6e3f 0a20 2020 2020 2020  unction?.       
+00039400: 2069 6620 7365 6c66 2e5f 7269 6368 6e65   if self._richne
+00039410: 7373 2069 7320 6e6f 7420 4e6f 6e65 2061  ss is not None a
+00039420: 6e64 2073 656c 662e 5f72 6963 686e 6573  nd self._richnes
+00039430: 735f 6572 7220 6973 206e 6f74 204e 6f6e  s_err is not Non
+00039440: 6520 5c0a 2020 2020 2020 2020 2020 2020  e \.            
+00039450: 2020 2020 616e 6420 6e6f 7420 6973 696e      and not isin
+00039460: 7374 616e 6365 2873 656c 662e 5f72 6963  stance(self._ric
+00039470: 686e 6573 735f 6572 722c 2028 6c69 7374  hness_err, (list
+00039480: 2c20 7475 706c 652c 206e 6461 7272 6179  , tuple, ndarray
+00039490: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+000394a0: 7072 696e 7428 2252 6963 686e 6573 7320  print("Richness 
+000394b0: 2d20 7b30 7dc2 b17b 317d 222e 666f 726d  - {0}..{1}".form
+000394c0: 6174 2873 656c 662e 5f72 6963 686e 6573  at(self._richnes
+000394d0: 732e 726f 756e 6428 3229 2c20 7365 6c66  s.round(2), self
+000394e0: 2e5f 7269 6368 6e65 7373 5f65 7272 2e72  ._richness_err.r
+000394f0: 6f75 6e64 2832 2929 290a 2020 2020 2020  ound(2))).      
+00039500: 2020 656c 6966 2073 656c 662e 5f72 6963    elif self._ric
+00039510: 686e 6573 7320 6973 206e 6f74 204e 6f6e  hness is not Non
+00039520: 6520 616e 6420 7365 6c66 2e5f 7269 6368  e and self._rich
+00039530: 6e65 7373 5f65 7272 2069 7320 6e6f 7420  ness_err is not 
+00039540: 4e6f 6e65 205c 0a20 2020 2020 2020 2020  None \.         
+00039550: 2020 2020 2020 2061 6e64 2069 7369 6e73         and isins
+00039560: 7461 6e63 6528 7365 6c66 2e5f 7269 6368  tance(self._rich
+00039570: 6e65 7373 5f65 7272 2c20 286c 6973 742c  ness_err, (list,
+00039580: 2074 7570 6c65 2c20 6e64 6172 7261 7929   tuple, ndarray)
+00039590: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+000395a0: 7269 6e74 2822 5269 6368 6e65 7373 202d  rint("Richness -
+000395b0: 207b 307d 202d 7b31 7d2b 7b32 7d22 2e66   {0} -{1}+{2}".f
+000395c0: 6f72 6d61 7428 7365 6c66 2e5f 7269 6368  ormat(self._rich
+000395d0: 6e65 7373 2e72 6f75 6e64 2832 292c 2073  ness.round(2), s
+000395e0: 656c 662e 5f72 6963 686e 6573 735f 6572  elf._richness_er
+000395f0: 725b 305d 2e72 6f75 6e64 2832 292c 0a20  r[0].round(2),. 
+00039600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039630: 2020 7365 6c66 2e5f 7269 6368 6e65 7373    self._richness
+00039640: 5f65 7272 5b31 5d2e 726f 756e 6428 3229  _err[1].round(2)
+00039650: 2929 0a20 2020 2020 2020 2065 6c69 6620  )).        elif 
+00039660: 7365 6c66 2e5f 7269 6368 6e65 7373 2069  self._richness i
+00039670: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
+00039680: 656c 662e 5f72 6963 686e 6573 735f 6572  elf._richness_er
+00039690: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
+000396a0: 2020 2020 2020 2070 7269 6e74 2822 5269         print("Ri
+000396b0: 6368 6e65 7373 202d 207b 307d 222e 666f  chness - {0}".fo
+000396c0: 726d 6174 2873 656c 662e 5f72 6963 686e  rmat(self._richn
+000396d0: 6573 732e 726f 756e 6428 3229 2929 0a0a  ess.round(2)))..
+000396e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000396f0: 5f77 6c5f 6d61 7373 2069 7320 6e6f 7420  _wl_mass is not 
+00039700: 4e6f 6e65 2061 6e64 2073 656c 662e 5f77  None and self._w
+00039710: 6c5f 6d61 7373 5f65 7272 2069 7320 6e6f  l_mass_err is no
+00039720: 7420 4e6f 6e65 205c 0a20 2020 2020 2020  t None \.       
+00039730: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
+00039740: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00039750: 2e5f 776c 5f6d 6173 735f 6572 722c 2028  ._wl_mass_err, (
+00039760: 6c69 7374 2c20 7475 706c 652c 206e 6461  list, tuple, nda
+00039770: 7272 6179 2929 3a0a 2020 2020 2020 2020  rray)):.        
+00039780: 2020 2020 7072 696e 7428 2257 6561 6b20      print("Weak 
+00039790: 4c65 6e73 696e 6720 4d61 7373 202d 207b  Lensing Mass - {
+000397a0: 307d c2b1 7b31 7d22 2e66 6f72 6d61 7428  0}..{1}".format(
+000397b0: 7365 6c66 2e5f 776c 5f6d 6173 732c 2073  self._wl_mass, s
+000397c0: 656c 662e 5f72 6963 686e 6573 735f 6572  elf._richness_er
+000397d0: 7229 290a 2020 2020 2020 2020 656c 6966  r)).        elif
+000397e0: 2073 656c 662e 5f77 6c5f 6d61 7373 2069   self._wl_mass i
+000397f0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
+00039800: 656c 662e 5f77 6c5f 6d61 7373 5f65 7272  elf._wl_mass_err
+00039810: 2069 7320 6e6f 7420 4e6f 6e65 205c 0a20   is not None \. 
+00039820: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00039830: 6e64 2069 7369 6e73 7461 6e63 6528 7365  nd isinstance(se
+00039840: 6c66 2e5f 776c 5f6d 6173 735f 6572 722c  lf._wl_mass_err,
+00039850: 2028 6c69 7374 2c20 7475 706c 652c 206e   (list, tuple, n
+00039860: 6461 7272 6179 2929 3a0a 2020 2020 2020  darray)):.      
+00039870: 2020 2020 2020 7072 696e 7428 2257 6561        print("Wea
+00039880: 6b20 4c65 6e73 696e 6720 4d61 7373 202d  k Lensing Mass -
+00039890: 207b 307d 202d 7b31 7d2b 7b32 7d22 2e66   {0} -{1}+{2}".f
+000398a0: 6f72 6d61 7428 7365 6c66 2e5f 776c 5f6d  ormat(self._wl_m
+000398b0: 6173 732c 2073 656c 662e 5f77 6c5f 6d61  ass, self._wl_ma
+000398c0: 7373 5f65 7272 5b30 5d2c 0a20 2020 2020  ss_err[0],.     
+000398d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000398e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000398f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039900: 2020 2020 2020 2073 656c 662e 5f77 6c5f         self._wl_
+00039910: 6d61 7373 5f65 7272 5b31 5d29 290a 2020  mass_err[1])).  
+00039920: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+00039930: 5f77 6c5f 6d61 7373 2069 7320 6e6f 7420  _wl_mass is not 
+00039940: 4e6f 6e65 2061 6e64 2073 656c 662e 5f77  None and self._w
+00039950: 6c5f 6d61 7373 5f65 7272 2069 7320 4e6f  l_mass_err is No
+00039960: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00039970: 7072 696e 7428 2257 6561 6b20 4c65 6e73  print("Weak Lens
+00039980: 696e 6720 4d61 7373 202d 207b 307d 222e  ing Mass - {0}".
+00039990: 666f 726d 6174 2873 656c 662e 5f77 6c5f  format(self._wl_
+000399a0: 6d61 7373 2929 0a0a 2020 2020 2020 2020  mass))..        
+000399b0: 6966 2027 6765 745f 7465 6d70 6572 6174  if 'get_temperat
+000399c0: 7572 6527 2069 6e20 6469 7228 7365 6c66  ure' in dir(self
+000399d0: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
+000399e0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000399f0: 2020 2020 7478 203d 2073 656c 662e 6765      tx = self.ge
+00039a00: 745f 7465 6d70 6572 6174 7572 6528 2772  t_temperature('r
+00039a10: 3530 3027 2c20 2763 6f6e 7374 616e 742a  500', 'constant*
+00039a20: 7462 6162 732a 6170 6563 2729 2e76 616c  tbabs*apec').val
+00039a30: 7565 2e72 6f75 6e64 2832 290a 2020 2020  ue.round(2).    
+00039a40: 2020 2020 2020 2020 2020 2020 2320 4a75              # Ju
+00039a50: 7374 2061 7665 7261 6765 2074 6865 2075  st average the u
+00039a60: 6e63 6572 7461 696e 7479 2066 6f72 2074  ncertainty for t
+00039a70: 6869 730a 2020 2020 2020 2020 2020 2020  his.            
+00039a80: 2020 2020 7072 696e 7428 2252 3530 3020      print("R500 
+00039a90: 5478 202d 207b 307d c2b1 7b31 7d5b 6b65  Tx - {0}..{1}[ke
+00039aa0: 565d 222e 666f 726d 6174 2874 785b 305d  V]".format(tx[0]
+00039ab0: 2c20 7478 5b31 3a5d 2e6d 6561 6e28 292e  , tx[1:].mean().
+00039ac0: 726f 756e 6428 3229 2929 0a20 2020 2020  round(2))).     
+00039ad0: 2020 2020 2020 2065 7863 6570 7420 284d         except (M
+00039ae0: 6f64 656c 4e6f 7441 7373 6f63 6961 7465  odelNotAssociate
+00039af0: 6445 7272 6f72 2c20 4e6f 5072 6f64 7563  dError, NoProduc
+00039b00: 7441 7661 696c 6162 6c65 4572 726f 7229  tAvailableError)
+00039b10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00039b20: 2020 7061 7373 0a0a 2020 2020 2020 2020    pass..        
+00039b30: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00039b40: 2020 2020 2020 2020 206c 7820 3d20 7365           lx = se
+00039b50: 6c66 2e67 6574 5f6c 756d 696e 6f73 6974  lf.get_luminosit
+00039b60: 6965 7328 2772 3530 3027 2c20 2763 6f6e  ies('r500', 'con
+00039b70: 7374 616e 742a 7462 6162 732a 6170 6563  stant*tbabs*apec
+00039b80: 272c 206c 6f5f 656e 3d51 7561 6e74 6974  ', lo_en=Quantit
+00039b90: 7928 302e 352c 2027 6b65 5627 292c 0a20  y(0.5, 'keV'),. 
+00039ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039bc0: 2020 2020 2020 2020 2020 6869 5f65 6e3d            hi_en=
+00039bd0: 5175 616e 7469 7479 2832 2e30 2c20 276b  Quantity(2.0, 'k
+00039be0: 6556 2729 292e 746f 2827 3130 5e34 3420  eV')).to('10^44 
+00039bf0: 6572 672f 7327 292e 7661 6c75 652e 726f  erg/s').value.ro
+00039c00: 756e 6428 3229 0a20 2020 2020 2020 2020  und(2).         
+00039c10: 2020 2020 2020 2070 7269 6e74 2822 5235         print("R5
+00039c20: 3030 2030 2e35 2d32 2e30 6b65 5620 4c78  00 0.5-2.0keV Lx
+00039c30: 202d 207b 307d c2b1 7b31 7d5b 652b 3434   - {0}..{1}[e+44
+00039c40: 2065 7267 2f73 5d22 2e66 6f72 6d61 7428   erg/s]".format(
+00039c50: 6c78 5b30 5d2c 206c 785b 313a 5d2e 6d65  lx[0], lx[1:].me
+00039c60: 616e 2829 2e72 6f75 6e64 2832 2929 290a  an().round(2))).
+00039c70: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00039c80: 6570 7420 284d 6f64 656c 4e6f 7441 7373  ept (ModelNotAss
+00039c90: 6f63 6961 7465 6445 7272 6f72 2c20 4e6f  ociatedError, No
+00039ca0: 5072 6f64 7563 7441 7661 696c 6162 6c65  ProductAvailable
+00039cb0: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+00039cc0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00039cd0: 2020 2020 2070 7269 6e74 2822 2d2d 2d2d       print("----
+00039ce0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00039cf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00039d00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00039d10: 2d5c 6e22 290a 0a20 2020 2064 6566 205f  -\n")..    def _
+00039d20: 5f6c 656e 5f5f 2873 656c 6629 202d 3e20  _len__(self) -> 
+00039d30: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+00039d40: 0a20 2020 2020 2020 204d 6574 686f 6420  .        Method 
+00039d50: 746f 2072 6574 7572 6e20 7468 6520 6c65  to return the le
+00039d60: 6e67 7468 206f 6620 7468 6520 7072 6f64  ngth of the prod
+00039d70: 7563 7473 2064 6963 7469 6f6e 6172 7920  ucts dictionary 
+00039d80: 2877 6869 6368 206d 6561 6e73 2074 6865  (which means the
+00039d90: 206e 756d 6265 7220 6f66 0a20 2020 2020   number of.     
+00039da0: 2020 2069 6e64 6976 6964 7561 6c20 4f62     individual Ob
+00039db0: 7349 4473 2061 7373 6f63 6961 7465 6420  sIDs associated 
+00039dc0: 7769 7468 2074 6869 7320 736f 7572 6365  with this source
+00039dd0: 292c 2077 6865 6e20 6c65 6e28 2920 6973  ), when len() is
+00039de0: 2063 616c 6c65 6420 6f6e 2061 6e20 696e   called on an in
+00039df0: 7374 616e 6365 206f 6620 7468 6973 2063  stance of this c
+00039e00: 6c61 7373 2e0a 0a20 2020 2020 2020 203a  lass...        :
+00039e10: 7265 7475 726e 3a20 5468 6520 696e 7465  return: The inte
+00039e20: 6765 7220 6c65 6e67 7468 206f 6620 7468  ger length of th
+00039e30: 6520 746f 7020 6c65 7665 6c20 6f66 2074  e top level of t
+00039e40: 6865 205f 7072 6f64 7563 7473 206e 6573  he _products nes
+00039e50: 7465 6420 6469 6374 696f 6e61 7279 2e0a  ted dictionary..
+00039e60: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
+00039e70: 696e 740a 2020 2020 2020 2020 2222 220a  int.        """.
+00039e80: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00039e90: 656e 2873 656c 662e 6f62 735f 6964 7329  en(self.obs_ids)
+00039ea0: 0a0a 0a23 2057 6173 2067 6f69 6e67 2074  ...# Was going t
+00039eb0: 6f20 7772 6974 6520 7468 6973 2061 7320  o write this as 
+00039ec0: 6120 7375 6263 6c61 7373 206f 6620 4261  a subclass of Ba
+00039ed0: 7365 536f 7572 6365 2c20 6173 2069 7420  seSource, as it 
+00039ee0: 7769 6c6c 2062 6568 6176 6520 6c61 7267  will behave larg
+00039ef0: 656c 7920 7468 6520 7361 6d65 2c20 6275  ely the same, bu
+00039f00: 7420 4920 646f 6e27 740a 2320 2077 616e  t I don't.#  wan
+00039f10: 7420 6974 2064 6563 6c61 7269 6e67 2058  t it declaring X
+00039f20: 4741 2070 726f 6475 6374 7320 666f 7220  GA products for 
+00039f30: 7465 6e73 206f 6620 7468 6f75 7361 6e64  tens of thousand
+00039f40: 7320 6f66 2069 6d61 6765 7320 6574 632e  s of images etc.
+00039f50: 0a23 2041 7320 7375 6368 2077 696c 6c20  .# As such will 
+00039f60: 7265 706c 6963 6174 6520 7468 6520 6261  replicate the ba
+00039f70: 7365 2066 756e 6374 696f 6e61 6c69 7479  se functionality
+00039f80: 206f 6620 4261 7365 536f 7572 6365 2074   of BaseSource t
+00039f90: 6861 7420 7769 6c6c 2061 6c6c 6f77 2065  hat will allow e
+00039fa0: 7673 656c 6563 745f 696d 6167 652c 2065  vselect_image, e
+00039fb0: 7870 6d61 702c 2063 6966 6275 696c 640a  xpmap, cifbuild.
+00039fc0: 2320 5341 5320 7772 6170 7065 7273 2074  # SAS wrappers t
+00039fd0: 6f20 776f 726b 2e0a 2320 5468 6973 2064  o work..# This d
+00039fe0: 6f65 7320 6861 7665 2061 206c 6f74 206f  oes have a lot o
+00039ff0: 6620 7374 7261 6967 6874 2063 6f70 6965  f straight copie
+0003a000: 6420 636f 6465 2066 726f 6d20 4261 7365  d code from Base
+0003a010: 536f 7572 6365 2c20 6275 7420 4920 646f  Source, but I do
+0003a020: 6e27 7420 6d69 6e64 2069 6e20 7468 6973  n't mind in this
+0003a030: 2069 6e73 7461 6e63 650a 636c 6173 7320   instance.class 
+0003a040: 4e75 6c6c 536f 7572 6365 3a0a 2020 2020  NullSource:.    
+0003a050: 2222 220a 2020 2020 4120 7573 6566 756c  """.    A useful
+0003a060: 2c20 6275 7420 7665 7279 206c 696d 6974  , but very limit
+0003a070: 6564 2c20 736f 7572 6365 2063 6c61 7373  ed, source class
+0003a080: 2e20 4279 2064 6566 6175 6c74 2074 6869  . By default thi
+0003a090: 7320 736f 7572 6365 2063 6c61 7373 2077  s source class w
+0003a0a0: 696c 6c20 696e 636c 7564 6520 616c 6c20  ill include all 
+0003a0b0: 4f62 7349 4473 2070 7265 7365 6e74 2069  ObsIDs present i
+0003a0c0: 6e20 7468 650a 2020 2020 5847 4120 6365  n the.    XGA ce
+0003a0d0: 6e73 7573 2c20 616e 6420 6173 2073 7563  nsus, and as suc
+0003a0e0: 6820 6361 6e20 6265 2075 7365 6420 666f  h can be used fo
+0003a0f0: 7220 6275 6c6b 2067 656e 6572 6174 696f  r bulk generatio
+0003a100: 6e20 6f66 2053 4153 2070 726f 6475 6374  n of SAS product
+0003a110: 732e 2049 7420 6361 6e20 616c 736f 2062  s. It can also b
+0003a120: 6520 6d61 6465 2074 6f20 6f6e 6c79 2069  e made to only i
+0003a130: 6e63 6c75 6465 0a20 2020 2063 6572 7461  nclude.    certa
+0003a140: 696e 204f 6273 4944 732e 0a0a 0a20 2020  in ObsIDs....   
+0003a150: 203a 7061 7261 6d20 4c69 7374 206f 6273   :param List obs
+0003a160: 3a20 416e 206f 7074 696f 6e61 6c20 6c69  : An optional li
+0003a170: 7374 206f 6620 4f62 7349 4473 2074 6f20  st of ObsIDs to 
+0003a180: 696e 636c 7564 6520 696e 2074 6865 204e  include in the N
+0003a190: 756c 6c53 6f75 7263 652c 206f 7468 6572  ullSource, other
+0003a1a0: 7769 7365 2061 6c6c 2061 7661 696c 6162  wise all availab
+0003a1b0: 6c65 204f 6273 4944 730a 2020 2020 2020  le ObsIDs.      
+0003a1c0: 2020 7769 6c6c 2062 6520 696e 636c 7564    will be includ
+0003a1d0: 6564 2e0a 2020 2020 2222 220a 2020 2020  ed..    """.    
+0003a1e0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0003a1f0: 662c 206f 6273 3a20 4c69 7374 5b73 7472  f, obs: List[str
+0003a200: 5d20 3d20 4e6f 6e65 293a 0a20 2020 2020  ] = None):.     
+0003a210: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+0003a220: 6865 206d 6574 686f 6420 7573 6564 2074  he method used t
+0003a230: 6f20 696e 6974 6961 7465 2074 6865 204e  o initiate the N
+0003a240: 756c 6c53 6f75 7263 6520 636c 6173 732e  ullSource class.
+0003a250: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0003a260: 2020 2020 2023 2054 6f20 6669 6e64 2061       # To find a
+0003a270: 6c6c 2063 656e 7375 7320 656e 7472 6965  ll census entrie
+0003a280: 7320 7769 7468 206e 6f6e 2d6e 6120 636f  s with non-na co
+0003a290: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
+0003a2a0: 2020 636c 6561 6e65 645f 6365 6e73 7573    cleaned_census
+0003a2b0: 203d 2043 454e 5355 532e 6472 6f70 6e61   = CENSUS.dropna
+0003a2c0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+0003a2d0: 5f72 615f 6465 6320 3d20 6e70 2e61 7272  _ra_dec = np.arr
+0003a2e0: 6179 285b 4e6f 6e65 2c20 4e6f 6e65 5d29  ay([None, None])
+0003a2f0: 0a20 2020 2020 2020 2023 2054 6865 2075  .        # The u
+0003a300: 7365 7220 6361 6e20 7370 6563 6966 7920  ser can specify 
+0003a310: 4f62 7349 4473 2074 6f20 6173 736f 6369  ObsIDs to associ
+0003a320: 6174 6520 7769 7468 2074 6865 204e 756c  ate with the Nul
+0003a330: 6c53 6f75 7263 652c 206f 7220 6173 736f  lSource, or asso
+0003a340: 6369 6174 6520 616c 6c0a 2020 2020 2020  ciate all.      
+0003a350: 2020 2320 206f 6620 7468 656d 2062 7920    #  of them by 
+0003a360: 6c65 6176 696e 6720 6974 2061 7320 4e6f  leaving it as No
+0003a370: 6e65 0a20 2020 2020 2020 2069 6620 6f62  ne.        if ob
+0003a380: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+0003a390: 2020 2020 2020 2073 656c 662e 5f6e 616d         self._nam
+0003a3a0: 6520 3d20 2241 6c6c 4f62 7365 7276 6174  e = "AllObservat
+0003a3b0: 696f 6e73 220a 2020 2020 2020 2020 2020  ions".          
+0003a3c0: 2020 6f62 7320 3d20 636c 6561 6e65 645f    obs = cleaned_
+0003a3d0: 6365 6e73 7573 5b22 4f62 7349 4422 5d2e  census["ObsID"].
+0003a3e0: 7661 6c75 6573 0a20 2020 2020 2020 2065  values.        e
+0003a3f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0003a400: 2023 2049 206b 6e6f 7720 7468 6973 2069   # I know this i
+0003a410: 7320 616e 2075 676c 7920 6e65 7374 6564  s an ugly nested
+0003a420: 2069 6620 7374 6174 656d 656e 7473 2c20   if statements, 
+0003a430: 6275 7420 4920 6f6e 6c79 2077 616e 7465  but I only wante
+0003a440: 6420 746f 2072 756e 206f 6273 5f63 6865  d to run obs_che
+0003a450: 636b 206f 6e63 650a 2020 2020 2020 2020  ck once.        
+0003a460: 2020 2020 6f62 7320 3d20 6e70 2e61 7272      obs = np.arr
+0003a470: 6179 286f 6273 290a 2020 2020 2020 2020  ay(obs).        
+0003a480: 2020 2020 6f62 735f 6368 6563 6b20 3d20      obs_check = 
+0003a490: 5b6f 2069 6e20 636c 6561 6e65 645f 6365  [o in cleaned_ce
+0003a4a0: 6e73 7573 5b22 4f62 7349 4422 5d2e 7661  nsus["ObsID"].va
+0003a4b0: 6c75 6573 2066 6f72 206f 2069 6e20 6f62  lues for o in ob
+0003a4c0: 735d 0a20 2020 2020 2020 2020 2020 2023  s].            #
+0003a4d0: 2049 6620 616c 6c20 7573 6572 2065 6e74   If all user ent
+0003a4e0: 6572 6564 204f 6273 4944 7320 6172 6520  ered ObsIDs are 
+0003a4f0: 696e 2074 6865 2063 656e 7375 732c 2074  in the census, t
+0003a500: 6865 6e20 616c 6c20 6973 2066 696e 650a  hen all is fine.
+0003a510: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+0003a520: 6c6c 286f 6273 5f63 6865 636b 293a 0a20  ll(obs_check):. 
+0003a530: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003a540: 656c 662e 5f6e 616d 6520 3d20 227b 7d4f  elf._name = "{}O
+0003a550: 6273 6572 7661 7469 6f6e 7322 2e66 6f72  bservations".for
+0003a560: 6d61 7428 6c65 6e28 6f62 7329 290a 2020  mat(len(obs)).  
+0003a570: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
+0003a580: 6865 7920 6172 656e 2774 2061 6c6c 2069  hey aren't all i
+0003a590: 6e20 7468 6520 6365 6e73 7573 2074 6865  n the census the
+0003a5a0: 6e20 7468 6174 2069 7320 6465 6369 6465  n that is decide
+0003a5b0: 646c 7920 6e6f 7420 6669 6e65 0a20 2020  dly not fine.   
+0003a5c0: 2020 2020 2020 2020 2065 6c69 6620 6e6f           elif no
+0003a5d0: 7420 616c 6c28 6f62 735f 6368 6563 6b29  t all(obs_check)
+0003a5e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003a5f0: 2020 6e6f 745f 7661 6c69 6420 3d20 6e70    not_valid = np
+0003a600: 2e61 7272 6179 286f 6273 295b 7e6e 702e  .array(obs)[~np.
+0003a610: 6172 7261 7928 6f62 735f 6368 6563 6b29  array(obs_check)
+0003a620: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0003a630: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0003a640: 6f72 2822 5468 6520 666f 6c6c 6f77 696e  or("The followin
+0003a650: 6720 6172 6520 6e6f 7420 7072 6573 656e  g are not presen
+0003a660: 7420 696e 2074 6865 2058 4741 2063 656e  t in the XGA cen
+0003a670: 7375 732c 2022 0a20 2020 2020 2020 2020  sus, ".         
+0003a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a690: 2020 2020 2020 2020 227b 7d22 2e66 6f72          "{}".for
+0003a6a0: 6d61 7428 222c 2022 2e6a 6f69 6e28 6e6f  mat(", ".join(no
+0003a6b0: 745f 7661 6c69 6429 2929 0a0a 2020 2020  t_valid)))..    
+0003a6c0: 2020 2020 2320 4669 6e64 206f 7574 2077      # Find out w
+0003a6d0: 6869 6368 0a20 2020 2020 2020 2069 6e73  hich.        ins
+0003a6e0: 7472 756d 656e 7473 203d 207b 6f3a 205b  truments = {o: [
+0003a6f0: 5d20 666f 7220 6f20 696e 206f 6273 7d0a  ] for o in obs}.
+0003a700: 2020 2020 2020 2020 666f 7220 6f20 696e          for o in
+0003a710: 206f 6273 3a0a 2020 2020 2020 2020 2020   obs:.          
+0003a720: 2020 6966 2063 6c65 616e 6564 5f63 656e    if cleaned_cen
+0003a730: 7375 735b 636c 6561 6e65 645f 6365 6e73  sus[cleaned_cens
+0003a740: 7573 5b22 4f62 7349 4422 5d20 3d3d 206f  us["ObsID"] == o
+0003a750: 5d5b 2255 5345 5f50 4e22 5d2e 7661 6c75  ]["USE_PN"].valu
+0003a760: 6573 5b30 5d3a 0a20 2020 2020 2020 2020  es[0]:.         
+0003a770: 2020 2020 2020 2069 6e73 7472 756d 656e         instrumen
+0003a780: 7473 5b6f 5d2e 6170 7065 6e64 2822 706e  ts[o].append("pn
+0003a790: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+0003a7a0: 6620 636c 6561 6e65 645f 6365 6e73 7573  f cleaned_census
+0003a7b0: 5b63 6c65 616e 6564 5f63 656e 7375 735b  [cleaned_census[
+0003a7c0: 224f 6273 4944 225d 203d 3d20 6f5d 5b22  "ObsID"] == o]["
+0003a7d0: 5553 455f 4d4f 5331 225d 2e76 616c 7565  USE_MOS1"].value
+0003a7e0: 735b 305d 3a0a 2020 2020 2020 2020 2020  s[0]:.          
+0003a7f0: 2020 2020 2020 696e 7374 7275 6d65 6e74        instrument
+0003a800: 735b 6f5d 2e61 7070 656e 6428 226d 6f73  s[o].append("mos
+0003a810: 3122 290a 2020 2020 2020 2020 2020 2020  1").            
+0003a820: 6966 2063 6c65 616e 6564 5f63 656e 7375  if cleaned_censu
+0003a830: 735b 636c 6561 6e65 645f 6365 6e73 7573  s[cleaned_census
+0003a840: 5b22 4f62 7349 4422 5d20 3d3d 206f 5d5b  ["ObsID"] == o][
+0003a850: 2255 5345 5f4d 4f53 3222 5d2e 7661 6c75  "USE_MOS2"].valu
+0003a860: 6573 5b30 5d3a 0a20 2020 2020 2020 2020  es[0]:.         
+0003a870: 2020 2020 2020 2069 6e73 7472 756d 656e         instrumen
+0003a880: 7473 5b6f 5d2e 6170 7065 6e64 2822 6d6f  ts[o].append("mo
+0003a890: 7332 2229 0a0a 2020 2020 2020 2020 2320  s2")..        # 
+0003a8a0: 5468 6973 2063 6865 636b 7320 7468 6174  This checks that
+0003a8b0: 2074 6865 206f 6273 6572 7661 7469 6f6e   the observation
+0003a8c0: 7320 6861 7665 2061 7420 6c65 6173 7420  s have at least 
+0003a8d0: 6f6e 6520 7573 6162 6c65 2069 6e73 7472  one usable instr
+0003a8e0: 756d 656e 740a 2020 2020 2020 2020 7365  ument.        se
+0003a8f0: 6c66 2e5f 6f62 7320 3d20 5b6f 2066 6f72  lf._obs = [o for
+0003a900: 206f 2069 6e20 6f62 7320 6966 206c 656e   o in obs if len
+0003a910: 2869 6e73 7472 756d 656e 7473 5b6f 5d29  (instruments[o])
+0003a920: 203e 2030 5d0a 2020 2020 2020 2020 7365   > 0].        se
+0003a930: 6c66 2e5f 696e 7374 7275 6d65 6e74 7320  lf._instruments 
+0003a940: 3d20 7b6f 3a20 696e 7374 7275 6d65 6e74  = {o: instrument
+0003a950: 735b 6f5d 2066 6f72 206f 2069 6e20 7365  s[o] for o in se
+0003a960: 6c66 2e5f 6f62 7320 6966 206c 656e 2869  lf._obs if len(i
+0003a970: 6e73 7472 756d 656e 7473 5b6f 5d29 203e  nstruments[o]) >
+0003a980: 2030 7d0a 0a20 2020 2020 2020 2023 2048   0}..        # H
+0003a990: 6572 6520 7765 2063 6865 636b 2074 6f20  ere we check to 
+0003a9a0: 6d61 6b65 2073 7572 6520 7468 6174 2074  make sure that t
+0003a9b0: 6865 7265 2069 7320 6174 206c 6561 7374  here is at least
+0003a9c0: 206f 6e65 2076 616c 6964 204f 6273 4944   one valid ObsID
+0003a9d0: 2072 656d 6169 6e69 6e67 0a20 2020 2020   remaining.     
+0003a9e0: 2020 2069 6620 6c65 6e28 7365 6c66 2e5f     if len(self._
+0003a9f0: 6f62 7329 203d 3d20 303a 0a20 2020 2020  obs) == 0:.     
+0003aa00: 2020 2020 2020 2072 6169 7365 204e 6f56         raise NoV
+0003aa10: 616c 6964 4f62 7365 7276 6174 696f 6e73  alidObservations
+0003aa20: 4572 726f 7228 2241 6674 6572 2063 6865  Error("After che
+0003aa30: 636b 7320 7573 696e 6720 7468 6520 5847  cks using the XG
+0003aa40: 4120 6365 6e73 7573 2c20 616c 6c20 4f62  A census, all Ob
+0003aa50: 7349 4473 2061 7373 6f63 6961 7465 6420  sIDs associated 
+0003aa60: 7769 7468 2074 6869 7320 220a 2020 2020  with this ".    
+0003aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aa90: 2020 2020 2020 2022 4e75 6c6c 536f 7572         "NullSour
+0003aaa0: 6365 2061 7265 2063 6f6e 7369 6465 7265  ce are considere
+0003aab0: 6420 756e 7573 6162 6c65 2e22 290a 0a20  d unusable.").. 
+0003aac0: 2020 2020 2020 2023 2054 6865 2053 4153         # The SAS
+0003aad0: 2067 656e 6572 6174 696f 6e20 726f 7574   generation rout
+0003aae0: 696e 6520 6d69 6768 7420 6e65 6564 2074  ine might need t
+0003aaf0: 6869 7320 696e 666f 726d 6174 696f 6e0a  his information.
+0003ab00: 2020 2020 2020 2020 7365 6c66 2e5f 6174          self._at
+0003ab10: 745f 6669 6c65 7320 3d20 7b6f 3a20 7867  t_files = {o: xg
+0003ab20: 615f 636f 6e66 5b22 584d 4d5f 4649 4c45  a_conf["XMM_FILE
+0003ab30: 5322 5d5b 2261 7474 6974 7564 655f 6669  S"]["attitude_fi
+0003ab40: 6c65 225d 2e66 6f72 6d61 7428 6f62 735f  le"].format(obs_
+0003ab50: 6964 3d6f 2920 666f 7220 6f20 696e 2073  id=o) for o in s
+0003ab60: 656c 662e 5f6f 6273 7d0a 0a20 2020 2020  elf._obs}..     
+0003ab70: 2020 2023 204e 6565 6420 7468 6520 6576     # Need the ev
+0003ab80: 656e 7420 6c69 7374 206f 626a 6563 7473  ent list objects
+0003ab90: 2064 6563 6c61 7265 6420 756e 666f 7274   declared unfort
+0003aba0: 756e 6174 656c 790a 2020 2020 2020 2020  unately.        
+0003abb0: 7365 6c66 2e5f 7072 6f64 7563 7473 203d  self._products =
+0003abc0: 207b 6f3a 207b 7d20 666f 7220 6f20 696e   {o: {} for o in
+0003abd0: 2073 656c 662e 5f6f 6273 7d0a 2020 2020   self._obs}.    
+0003abe0: 2020 2020 666f 7220 6f20 696e 2073 656c      for o in sel
+0003abf0: 662e 5f6f 6273 3a0a 2020 2020 2020 2020  f._obs:.        
+0003ac00: 2020 2020 666f 7220 696e 7374 2069 6e20      for inst in 
+0003ac10: 7365 6c66 2e5f 696e 7374 7275 6d65 6e74  self._instrument
+0003ac20: 735b 6f5d 3a0a 2020 2020 2020 2020 2020  s[o]:.          
+0003ac30: 2020 2020 2020 6576 745f 6b65 7920 3d20        evt_key = 
+0003ac40: 2263 6c65 616e 5f7b 7d5f 6576 7473 222e  "clean_{}_evts".
+0003ac50: 666f 726d 6174 2869 6e73 7429 0a20 2020  format(inst).   
+0003ac60: 2020 2020 2020 2020 2020 2020 2065 7674               evt
+0003ac70: 5f66 696c 6520 3d20 7867 615f 636f 6e66  _file = xga_conf
+0003ac80: 5b22 584d 4d5f 4649 4c45 5322 5d5b 6576  ["XMM_FILES"][ev
+0003ac90: 745f 6b65 795d 2e66 6f72 6d61 7428 6f62  t_key].format(ob
+0003aca0: 735f 6964 3d6f 290a 2020 2020 2020 2020  s_id=o).        
+0003acb0: 2020 2020 2020 2020 7365 6c66 2e5f 7072          self._pr
+0003acc0: 6f64 7563 7473 5b6f 5d5b 696e 7374 5d20  oducts[o][inst] 
+0003acd0: 3d20 7b22 6576 656e 7473 223a 2045 7665  = {"events": Eve
+0003ace0: 6e74 4c69 7374 2865 7674 5f66 696c 652c  ntList(evt_file,
+0003acf0: 206f 6273 5f69 643d 6f2c 2069 6e73 7472   obs_id=o, instr
+0003ad00: 756d 656e 743d 696e 7374 2c20 7374 646f  ument=inst, stdo
+0003ad10: 7574 5f73 7472 3d22 222c 0a20 2020 2020  ut_str="",.     
+0003ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad50: 2020 2020 2020 2020 2020 7374 6465 7272            stderr
+0003ad60: 5f73 7472 3d22 222c 2067 656e 5f63 6d64  _str="", gen_cmd
+0003ad70: 3d22 2229 7d0a 0a20 2020 2020 2020 2023  ="")}..        #
+0003ad80: 2054 6869 7320 6973 2061 2071 7565 7565   This is a queue
+0003ad90: 2066 6f72 2070 726f 6475 6374 7320 746f   for products to
+0003ada0: 2062 6520 6765 6e65 7261 7465 6420 666f   be generated fo
+0003adb0: 7220 7468 6973 2073 6f75 7263 652c 2077  r this source, w
+0003adc0: 696c 6c20 6265 2061 206e 756d 7079 2061  ill be a numpy a
+0003add0: 7272 6179 2069 6e20 7072 6163 7469 7365  rray in practise
+0003ade0: 2e0a 2020 2020 2020 2020 2320 4974 656d  ..        # Item
+0003adf0: 7320 696e 2074 6865 2073 616d 6520 726f  s in the same ro
+0003ae00: 7720 7769 6c6c 2061 6c6c 2062 6520 6765  w will all be ge
+0003ae10: 6e65 7261 7465 6420 696e 2070 6172 616c  nerated in paral
+0003ae20: 6c65 6c2c 2077 6865 7265 6173 2069 7465  lel, whereas ite
+0003ae30: 6d73 2069 6e20 7468 6520 7361 6d65 2063  ms in the same c
+0003ae40: 6f6c 756d 6e20 7769 6c6c 0a20 2020 2020  olumn will.     
+0003ae50: 2020 2023 2062 6520 636f 6d62 696e 6564     # be combined
+0003ae60: 2069 6e74 6f20 6120 636f 6d6d 616e 6420   into a command 
+0003ae70: 7374 6163 6b20 616e 6420 7275 6e20 696e  stack and run in
+0003ae80: 206f 7264 6572 2e0a 2020 2020 2020 2020   order..        
+0003ae90: 7365 6c66 2e71 7565 7565 203d 204e 6f6e  self.queue = Non
+0003aea0: 650a 2020 2020 2020 2020 2320 416e 6f74  e.        # Anot
+0003aeb0: 6865 7220 6174 7472 6962 7574 6520 6465  her attribute de
+0003aec0: 7374 696e 6564 2074 6f20 6265 2061 6e20  stined to be an 
+0003aed0: 6172 7261 792c 2077 696c 6c20 636f 6e74  array, will cont
+0003aee0: 6169 6e20 7468 6520 6f75 7470 7574 2074  ain the output t
+0003aef0: 7970 6520 6f66 2065 6163 6820 636f 6d6d  ype of each comm
+0003af00: 616e 6420 7375 626d 6974 7465 6420 746f  and submitted to
+0003af10: 0a20 2020 2020 2020 2023 2074 6865 2071  .        # the q
+0003af20: 7565 7565 2061 7272 6179 2e0a 2020 2020  ueue array..    
+0003af30: 2020 2020 7365 6c66 2e71 7565 7565 5f74      self.queue_t
+0003af40: 7970 6520 3d20 4e6f 6e65 0a20 2020 2020  ype = None.     
+0003af50: 2020 2023 2054 6869 7320 636f 6e74 6169     # This contai
+0003af60: 6e73 2061 6e20 6172 7261 7920 6f66 2074  ns an array of t
+0003af70: 6865 2070 6174 6873 206f 6620 7468 6520  he paths of the 
+0003af80: 6669 6e61 6c20 6f75 7470 7574 206f 6620  final output of 
+0003af90: 6561 6368 2063 6f6d 6d61 6e64 2069 6e20  each command in 
+0003afa0: 7468 6520 7175 6575 650a 2020 2020 2020  the queue.      
+0003afb0: 2020 7365 6c66 2e71 7565 7565 5f70 6174    self.queue_pat
+0003afc0: 6820 3d20 4e6f 6e65 0a20 2020 2020 2020  h = None.       
+0003afd0: 2023 2054 6869 7320 636f 6e74 6169 6e73   # This contains
+0003afe0: 2061 6e20 6172 7261 7920 6f66 2074 6865   an array of the
+0003aff0: 2065 7874 7261 2069 6e66 6f72 6d61 7469   extra informati
+0003b000: 6f6e 206e 6565 6465 6420 746f 2069 6e73  on needed to ins
+0003b010: 7461 6e74 6961 7465 2063 6c61 7373 0a20  tantiate class. 
+0003b020: 2020 2020 2020 2023 2061 6674 6572 2074         # after t
+0003b030: 6865 2053 4153 2063 6f6d 6d61 6e64 2068  he SAS command h
+0003b040: 6173 2072 756e 0a20 2020 2020 2020 2073  as run.        s
+0003b050: 656c 662e 7175 6575 655f 6578 7472 615f  elf.queue_extra_
+0003b060: 696e 666f 203d 204e 6f6e 650a 0a20 2020  info = None..   
+0003b070: 2064 6566 2067 6574 5f61 7474 5f66 696c   def get_att_fil
+0003b080: 6528 7365 6c66 2c20 6f62 735f 6964 3a20  e(self, obs_id: 
+0003b090: 7374 7229 202d 3e20 7374 723a 0a20 2020  str) -> str:.   
+0003b0a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0003b0b0: 2046 6574 6368 6573 2074 6865 2070 6174   Fetches the pat
+0003b0c0: 6820 746f 2074 6865 2061 7474 6974 7564  h to the attitud
+0003b0d0: 6520 6669 6c65 2066 6f72 2061 6e20 584d  e file for an XM
+0003b0e0: 4d20 6f62 7365 7276 6174 696f 6e2e 0a0a  M observation...
+0003b0f0: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+0003b100: 6273 5f69 643a 2054 6865 204f 6273 4944  bs_id: The ObsID
+0003b110: 2074 6f20 6665 7463 6820 7468 6520 6174   to fetch the at
+0003b120: 7469 7475 6465 2066 696c 6520 666f 722e  titude file for.
+0003b130: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0003b140: 3a20 5468 6520 7061 7468 2074 6f20 7468  : The path to th
+0003b150: 6520 6174 7469 7475 6465 2066 696c 652e  e attitude file.
+0003b160: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
+0003b170: 2073 7472 0a20 2020 2020 2020 2022 2222   str.        """
+0003b180: 0a20 2020 2020 2020 2069 6620 6f62 735f  .        if obs_
+0003b190: 6964 206e 6f74 2069 6e20 7365 6c66 2e5f  id not in self._
+0003b1a0: 7072 6f64 7563 7473 3a0a 2020 2020 2020  products:.      
+0003b1b0: 2020 2020 2020 7261 6973 6520 4e6f 7441        raise NotA
+0003b1c0: 7373 6f63 6961 7465 6445 7272 6f72 2822  ssociatedError("
+0003b1d0: 7b6f 7d20 6973 206e 6f74 2061 7373 6f63  {o} is not assoc
+0003b1e0: 6961 7465 6420 7769 7468 207b 737d 222e  iated with {s}".
+0003b1f0: 666f 726d 6174 286f 3d6f 6273 5f69 642c  format(o=obs_id,
+0003b200: 2073 3d73 656c 662e 6e61 6d65 2929 0a20   s=self.name)). 
+0003b210: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003b220: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003b230: 7365 6c66 2e5f 6174 745f 6669 6c65 735b  self._att_files[
+0003b240: 6f62 735f 6964 5d0a 0a20 2020 2040 7072  obs_id]..    @pr
+0003b250: 6f70 6572 7479 0a20 2020 2064 6566 206f  operty.    def o
+0003b260: 6273 5f69 6473 2873 656c 6629 202d 3e20  bs_ids(self) -> 
+0003b270: 4c69 7374 5b73 7472 5d3a 0a20 2020 2020  List[str]:.     
+0003b280: 2020 2022 2222 0a20 2020 2020 2020 2050     """.        P
+0003b290: 726f 7065 7274 7920 6765 7474 6572 2066  roperty getter f
+0003b2a0: 6f72 204f 6273 4944 7320 6173 736f 6369  or ObsIDs associ
+0003b2b0: 6174 6564 2077 6974 6820 7468 6973 2073  ated with this s
+0003b2c0: 6f75 7263 6520 7468 6174 2061 7265 2063  ource that are c
+0003b2d0: 6f6e 6669 726d 6564 2074 6f20 6861 7665  onfirmed to have
+0003b2e0: 2065 7665 6e74 7320 6669 6c65 732e 0a0a   events files...
+0003b2f0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+0003b300: 2041 206c 6973 7420 6f66 2074 6865 2061   A list of the a
+0003b310: 7373 6f63 6961 7465 6420 584d 4d20 4f62  ssociated XMM Ob
+0003b320: 7349 4473 2e0a 2020 2020 2020 2020 3a72  sIDs..        :r
+0003b330: 7479 7065 3a20 4c69 7374 5b73 7472 5d0a  type: List[str].
+0003b340: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0003b350: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0003b360: 5f6f 6273 0a0a 2020 2020 4070 726f 7065  _obs..    @prope
+0003b370: 7274 790a 2020 2020 6465 6620 696e 7374  rty.    def inst
+0003b380: 7275 6d65 6e74 7328 7365 6c66 2920 2d3e  ruments(self) ->
+0003b390: 2044 6963 743a 0a20 2020 2020 2020 2022   Dict:.        "
+0003b3a0: 2222 0a20 2020 2020 2020 2041 2070 726f  "".        A pro
+0003b3b0: 7065 7274 7920 6f66 2061 2073 6f75 7263  perty of a sourc
+0003b3c0: 6520 7468 6174 2064 6574 6169 6c73 2077  e that details w
+0003b3d0: 6869 6368 2069 6e73 7472 756d 656e 7473  hich instruments
+0003b3e0: 2068 6176 6520 7661 6c69 6420 6461 7461   have valid data
+0003b3f0: 2066 6f72 2077 6869 6368 206f 6273 6572   for which obser
+0003b400: 7661 7469 6f6e 732e 0a0a 2020 2020 2020  vations...      
+0003b410: 2020 3a72 6574 7572 6e3a 2041 2064 6963    :return: A dic
+0003b420: 7469 6f6e 6172 7920 6f66 204f 6273 4944  tionary of ObsID
+0003b430: 7320 616e 6420 7468 6569 7220 6173 736f  s and their asso
+0003b440: 6369 6174 6564 2076 616c 6964 2069 6e73  ciated valid ins
+0003b450: 7472 756d 656e 7473 2e0a 2020 2020 2020  truments..      
+0003b460: 2020 3a72 7479 7065 3a20 4469 6374 0a20    :rtype: Dict. 
+0003b470: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0003b480: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0003b490: 696e 7374 7275 6d65 6e74 730a 0a20 2020  instruments..   
+0003b4a0: 2064 6566 2075 7064 6174 655f 7175 6575   def update_queu
+0003b4b0: 6528 7365 6c66 2c20 636d 645f 6172 723a  e(self, cmd_arr:
+0003b4c0: 206e 702e 6e64 6172 7261 792c 2070 5f74   np.ndarray, p_t
+0003b4d0: 7970 655f 6172 723a 206e 702e 6e64 6172  ype_arr: np.ndar
+0003b4e0: 7261 792c 2070 5f70 6174 685f 6172 723a  ray, p_path_arr:
+0003b4f0: 206e 702e 6e64 6172 7261 792c 0a20 2020   np.ndarray,.   
+0003b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b510: 2020 6578 7472 615f 696e 666f 3a20 6e70    extra_info: np
+0003b520: 2e6e 6461 7272 6179 2c20 7374 6163 6b3a  .ndarray, stack:
+0003b530: 2062 6f6f 6c20 3d20 4661 6c73 6529 3a0a   bool = False):.
+0003b540: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0003b550: 2020 2020 536d 616c 6c20 6675 6e63 7469      Small functi
+0003b560: 6f6e 2074 6f20 7570 6461 7465 2074 6865  on to update the
+0003b570: 206e 756d 7079 2061 7272 6179 2074 6861   numpy array tha
+0003b580: 7420 6d61 6b65 7320 7570 2074 6865 2071  t makes up the q
+0003b590: 7565 7565 206f 6620 7072 6f64 7563 7473  ueue of products
+0003b5a0: 2074 6f20 6265 2067 656e 6572 6174 6564   to be generated
+0003b5b0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0003b5c0: 6d20 6e70 2e6e 6461 7272 6179 2063 6d64  m np.ndarray cmd
+0003b5d0: 5f61 7272 3a20 4172 7261 7920 636f 6e74  _arr: Array cont
+0003b5e0: 6169 6e69 6e67 2053 4153 2063 6f6d 6d61  aining SAS comma
+0003b5f0: 6e64 732e 0a20 2020 2020 2020 203a 7061  nds..        :pa
+0003b600: 7261 6d20 6e70 2e6e 6461 7272 6179 2070  ram np.ndarray p
+0003b610: 5f74 7970 655f 6172 723a 2041 7272 6179  _type_arr: Array
+0003b620: 206f 6620 7072 6f64 7563 7420 7479 7065   of product type
+0003b630: 2069 6465 6e74 6966 6965 7273 2066 6f72   identifiers for
+0003b640: 2074 6865 2070 726f 6475 6374 7320 6765   the products ge
+0003b650: 6e65 7261 7465 640a 2020 2020 2020 2020  nerated.        
+0003b660: 2020 2020 6279 2074 6865 2063 6d64 2061      by the cmd a
+0003b670: 7272 6179 2e20 652e 672e 2069 6d61 6765  rray. e.g. image
+0003b680: 206f 7220 6578 706d 6170 2e0a 2020 2020   or expmap..    
+0003b690: 2020 2020 3a70 6172 616d 206e 702e 6e64      :param np.nd
+0003b6a0: 6172 7261 7920 705f 7061 7468 5f61 7272  array p_path_arr
+0003b6b0: 3a20 4172 7261 7920 6f66 2066 696e 616c  : Array of final
+0003b6c0: 2070 726f 6475 6374 2070 6174 6873 2069   product paths i
+0003b6d0: 6620 636d 6420 6973 2073 7563 6365 7373  f cmd is success
+0003b6e0: 6675 6c0a 2020 2020 2020 2020 3a70 6172  ful.        :par
+0003b6f0: 616d 206e 702e 6e64 6172 7261 7920 6578  am np.ndarray ex
+0003b700: 7472 615f 696e 666f 3a20 4172 7261 7920  tra_info: Array 
+0003b710: 6f66 2065 7874 7261 2069 6e66 6f72 6d61  of extra informa
+0003b720: 7469 6f6e 2064 6963 7469 6f6e 6172 6965  tion dictionarie
+0003b730: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
+0003b740: 2073 7461 636b 3a20 5368 6f75 6c64 2074   stack: Should t
+0003b750: 6865 7365 2063 6f6d 6d61 6e64 7320 6265  hese commands be
+0003b760: 2065 7865 6375 7465 6420 6166 7465 7220   executed after 
+0003b770: 6120 7072 6563 6564 696e 6720 6c69 6e65  a preceding line
+0003b780: 206f 6620 636f 6d6d 616e 6473 2c0a 2020   of commands,.  
+0003b790: 2020 2020 2020 2020 2020 6f72 2061 7420            or at 
+0003b7a0: 7468 6520 7361 6d65 2074 696d 652e 0a20  the same time.. 
+0003b7b0: 2020 2020 2020 203a 7265 7475 726e 3a0a         :return:.
+0003b7c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0003b7d0: 2020 2020 6966 2073 656c 662e 7175 6575      if self.queu
+0003b7e0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+0003b7f0: 2020 2020 2020 2023 2049 2063 6f75 6c64         # I could
+0003b800: 2068 6176 6520 646f 6e65 2061 6c6c 206f   have done all o
+0003b810: 6620 7468 6573 6520 696e 206f 6e65 2061  f these in one a
+0003b820: 7272 6179 2077 6974 6820 3320 6469 6d65  rray with 3 dime
+0003b830: 6e73 696f 6e73 2c20 6275 7420 6665 6c74  nsions, but felt
+0003b840: 2074 6869 7320 7761 7320 6561 7369 6572   this was easier
+0003b850: 2074 6f20 7265 6164 0a20 2020 2020 2020   to read.       
+0003b860: 2020 2020 2023 2061 6e64 2077 6974 6820       # and with 
+0003b870: 6e6f 2072 6561 6c20 7065 7266 6f72 6d61  no real performa
+0003b880: 6e63 6520 7065 6e61 6c74 790a 2020 2020  nce penalty.    
+0003b890: 2020 2020 2020 2020 7365 6c66 2e71 7565          self.que
+0003b8a0: 7565 203d 2063 6d64 5f61 7272 0a20 2020  ue = cmd_arr.   
+0003b8b0: 2020 2020 2020 2020 2073 656c 662e 7175           self.qu
+0003b8c0: 6575 655f 7479 7065 203d 2070 5f74 7970  eue_type = p_typ
+0003b8d0: 655f 6172 720a 2020 2020 2020 2020 2020  e_arr.          
+0003b8e0: 2020 7365 6c66 2e71 7565 7565 5f70 6174    self.queue_pat
+0003b8f0: 6820 3d20 705f 7061 7468 5f61 7272 0a20  h = p_path_arr. 
+0003b900: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003b910: 7175 6575 655f 6578 7472 615f 696e 666f  queue_extra_info
+0003b920: 203d 2065 7874 7261 5f69 6e66 6f0a 2020   = extra_info.  
+0003b930: 2020 2020 2020 656c 6966 2073 7461 636b        elif stack
+0003b940: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0003b950: 6c66 2e71 7565 7565 203d 206e 702e 7673  lf.queue = np.vs
+0003b960: 7461 636b 2828 7365 6c66 2e71 7565 7565  tack((self.queue
+0003b970: 2c20 636d 645f 6172 7229 290a 2020 2020  , cmd_arr)).    
+0003b980: 2020 2020 2020 2020 7365 6c66 2e71 7565          self.que
+0003b990: 7565 5f74 7970 6520 3d20 6e70 2e76 7374  ue_type = np.vst
+0003b9a0: 6163 6b28 2873 656c 662e 7175 6575 655f  ack((self.queue_
+0003b9b0: 7479 7065 2c20 705f 7479 7065 5f61 7272  type, p_type_arr
+0003b9c0: 2929 0a20 2020 2020 2020 2020 2020 2073  )).            s
+0003b9d0: 656c 662e 7175 6575 655f 7061 7468 203d  elf.queue_path =
+0003b9e0: 206e 702e 7673 7461 636b 2828 7365 6c66   np.vstack((self
+0003b9f0: 2e71 7565 7565 5f70 6174 682c 2070 5f70  .queue_path, p_p
+0003ba00: 6174 685f 6172 7229 290a 2020 2020 2020  ath_arr)).      
+0003ba10: 2020 2020 2020 7365 6c66 2e71 7565 7565        self.queue
+0003ba20: 5f65 7874 7261 5f69 6e66 6f20 3d20 6e70  _extra_info = np
+0003ba30: 2e76 7374 6163 6b28 2873 656c 662e 7175  .vstack((self.qu
+0003ba40: 6575 655f 6578 7472 615f 696e 666f 2c20  eue_extra_info, 
+0003ba50: 6578 7472 615f 696e 666f 2929 0a20 2020  extra_info)).   
+0003ba60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0003ba70: 2020 2020 2020 2073 656c 662e 7175 6575         self.queu
+0003ba80: 6520 3d20 6e70 2e61 7070 656e 6428 7365  e = np.append(se
+0003ba90: 6c66 2e71 7565 7565 2c20 636d 645f 6172  lf.queue, cmd_ar
+0003baa0: 722c 2061 7869 733d 3029 0a20 2020 2020  r, axis=0).     
+0003bab0: 2020 2020 2020 2073 656c 662e 7175 6575         self.queu
+0003bac0: 655f 7479 7065 203d 206e 702e 6170 7065  e_type = np.appe
+0003bad0: 6e64 2873 656c 662e 7175 6575 655f 7479  nd(self.queue_ty
+0003bae0: 7065 2c20 705f 7479 7065 5f61 7272 2c20  pe, p_type_arr, 
+0003baf0: 6178 6973 3d30 290a 2020 2020 2020 2020  axis=0).        
+0003bb00: 2020 2020 7365 6c66 2e71 7565 7565 5f70      self.queue_p
+0003bb10: 6174 6820 3d20 6e70 2e61 7070 656e 6428  ath = np.append(
+0003bb20: 7365 6c66 2e71 7565 7565 5f70 6174 682c  self.queue_path,
+0003bb30: 2070 5f70 6174 685f 6172 722c 2061 7869   p_path_arr, axi
+0003bb40: 733d 3029 0a20 2020 2020 2020 2020 2020  s=0).           
+0003bb50: 2073 656c 662e 7175 6575 655f 6578 7472   self.queue_extr
+0003bb60: 615f 696e 666f 203d 206e 702e 6170 7065  a_info = np.appe
+0003bb70: 6e64 2873 656c 662e 7175 6575 655f 6578  nd(self.queue_ex
+0003bb80: 7472 615f 696e 666f 2c20 6578 7472 615f  tra_info, extra_
+0003bb90: 696e 666f 2c20 6178 6973 3d30 290a 0a20  info, axis=0).. 
+0003bba0: 2020 2064 6566 2067 6574 5f71 7565 7565     def get_queue
+0003bbb0: 2873 656c 6629 202d 3e20 5475 706c 655b  (self) -> Tuple[
+0003bbc0: 4c69 7374 5b73 7472 5d2c 204c 6973 745b  List[str], List[
+0003bbd0: 7374 725d 2c20 4c69 7374 5b4c 6973 745b  str], List[List[
+0003bbe0: 7374 725d 5d2c 204c 6973 745b 6469 6374  str]], List[dict
+0003bbf0: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
+0003bc00: 2020 2020 2020 2020 4361 6c6c 696e 6720          Calling 
+0003bc10: 7468 6973 2069 6e64 6963 6174 6573 2074  this indicates t
+0003bc20: 6861 7420 7468 6520 7175 6575 6520 6973  hat the queue is
+0003bc30: 2061 626f 7574 2074 6f20 6265 2070 726f   about to be pro
+0003bc40: 6365 7373 6564 2c20 736f 2074 6869 7320  cessed, so this 
+0003bc50: 6675 6e63 7469 6f6e 2063 6f6d 6269 6e65  function combine
+0003bc60: 7320 5341 530a 2020 2020 2020 2020 636f  s SAS.        co
+0003bc70: 6d6d 616e 6473 2061 6c6f 6e67 2063 6f6c  mmands along col
+0003bc80: 756d 6e73 2028 636f 6d6d 616e 6420 7374  umns (command st
+0003bc90: 6163 6b73 292c 2061 6e64 2072 6574 7572  acks), and retur
+0003bca0: 6e73 204e 2053 4153 2063 6f6d 6d61 6e64  ns N SAS command
+0003bcb0: 7320 746f 2062 6520 7275 6e20 636f 6e63  s to be run conc
+0003bcc0: 7572 7265 6e74 6c79 2c0a 2020 2020 2020  urrently,.      
+0003bcd0: 2020 7768 6572 6520 4e20 6973 2074 6865    where N is the
+0003bce0: 206e 756d 6265 7220 6f66 2063 6f6c 756d   number of colum
+0003bcf0: 6e73 2e0a 0a20 2020 2020 2020 203a 7265  ns...        :re
+0003bd00: 7475 726e 3a20 4c69 7374 206f 6620 7374  turn: List of st
+0003bd10: 7269 6e67 732c 2077 6865 7265 2074 6865  rings, where the
+0003bd20: 2073 7472 696e 6773 2061 7265 2062 6173   strings are bas
+0003bd30: 6820 636f 6d6d 616e 6473 2074 6f20 7275  h commands to ru
+0003bd40: 6e20 5341 5320 7072 6f63 6564 7572 6573  n SAS procedures
+0003bd50: 2c20 616e 6f74 6865 720a 2020 2020 2020  , another.      
+0003bd60: 2020 2020 2020 6c69 7374 206f 6620 7374        list of st
+0003bd70: 7269 6e67 732c 2077 6865 7265 2074 6865  rings, where the
+0003bd80: 2073 7472 696e 6773 2061 7265 2065 7870   strings are exp
+0003bd90: 6563 7465 6420 6f75 7470 7574 2074 7970  ected output typ
+0003bda0: 6573 2066 6f72 2074 6865 2063 6f6d 6d61  es for the comma
+0003bdb0: 6e64 732c 2061 206c 6973 7420 6f66 0a20  nds, a list of. 
+0003bdc0: 2020 2020 2020 2020 2020 206c 6973 7473             lists
+0003bdd0: 206f 6620 7374 7269 6e67 732c 2077 6865   of strings, whe
+0003bde0: 7265 2074 6865 2073 7472 696e 6773 2061  re the strings a
+0003bdf0: 7265 2065 7870 6563 7465 6420 6f75 7470  re expected outp
+0003be00: 7574 2070 6174 6873 2066 6f72 2070 726f  ut paths for pro
+0003be10: 6475 6374 7320 6f66 2074 6865 2053 4153  ducts of the SAS
+0003be20: 2063 6f6d 6d61 6e64 732e 0a20 2020 2020   commands..     
+0003be30: 2020 203a 7274 7970 653a 2054 7570 6c65     :rtype: Tuple
+0003be40: 5b4c 6973 745b 7374 725d 2c20 4c69 7374  [List[str], List
+0003be50: 5b73 7472 5d2c 204c 6973 745b 4c69 7374  [str], List[List
+0003be60: 5b73 7472 5d5d 5d0a 2020 2020 2020 2020  [str]]].        
+0003be70: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
+0003be80: 656c 662e 7175 6575 6520 6973 204e 6f6e  elf.queue is Non
+0003be90: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+0003bea0: 2054 6869 7320 7265 7475 726e 7320 656d   This returns em
+0003beb0: 7074 7920 6c69 7374 7320 6966 2074 6865  pty lists if the
+0003bec0: 2071 7565 7565 2069 7320 756e 6465 6669   queue is undefi
+0003bed0: 6e65 640a 2020 2020 2020 2020 2020 2020  ned.            
+0003bee0: 7072 6f63 6573 7365 645f 636d 6473 203d  processed_cmds =
+0003bef0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0003bf00: 7479 7065 7320 3d20 5b5d 0a20 2020 2020  types = [].     
+0003bf10: 2020 2020 2020 2070 6174 6873 203d 205b         paths = [
+0003bf20: 5d0a 2020 2020 2020 2020 2020 2020 6578  ].            ex
+0003bf30: 7472 6173 203d 205b 5d0a 2020 2020 2020  tras = [].      
+0003bf40: 2020 656c 6966 206c 656e 2873 656c 662e    elif len(self.
+0003bf50: 7175 6575 652e 7368 6170 6529 203d 3d20  queue.shape) == 
+0003bf60: 3120 6f72 2073 656c 662e 7175 6575 652e  1 or self.queue.
+0003bf70: 7368 6170 655b 315d 203c 3d20 313a 0a20  shape[1] <= 1:. 
+0003bf80: 2020 2020 2020 2020 2020 2070 726f 6365             proce
+0003bf90: 7373 6564 5f63 6d64 7320 3d20 6c69 7374  ssed_cmds = list
+0003bfa0: 2873 656c 662e 7175 6575 6529 0a20 2020  (self.queue).   
+0003bfb0: 2020 2020 2020 2020 2074 7970 6573 203d           types =
+0003bfc0: 206c 6973 7428 7365 6c66 2e71 7565 7565   list(self.queue
+0003bfd0: 5f74 7970 6529 0a20 2020 2020 2020 2020  _type).         
+0003bfe0: 2020 2070 6174 6873 203d 205b 5b73 7472     paths = [[str
+0003bff0: 2870 6174 6829 5d20 666f 7220 7061 7468  (path)] for path
+0003c000: 2069 6e20 7365 6c66 2e71 7565 7565 5f70   in self.queue_p
+0003c010: 6174 685d 0a20 2020 2020 2020 2020 2020  ath].           
+0003c020: 2065 7874 7261 7320 3d20 6c69 7374 2873   extras = list(s
+0003c030: 656c 662e 7175 6575 655f 6578 7472 615f  elf.queue_extra_
+0003c040: 696e 666f 290a 2020 2020 2020 2020 656c  info).        el
+0003c050: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0003c060: 7072 6f63 6573 7365 645f 636d 6473 203d  processed_cmds =
+0003c070: 205b 223b 222e 6a6f 696e 2863 6f6c 2920   [";".join(col) 
+0003c080: 666f 7220 636f 6c20 696e 2073 656c 662e  for col in self.
+0003c090: 7175 6575 652e 545d 0a20 2020 2020 2020  queue.T].       
+0003c0a0: 2020 2020 2074 7970 6573 203d 206c 6973       types = lis
+0003c0b0: 7428 7365 6c66 2e71 7565 7565 5f74 7970  t(self.queue_typ
+0003c0c0: 655b 2d31 2c20 3a5d 290a 2020 2020 2020  e[-1, :]).      
+0003c0d0: 2020 2020 2020 7061 7468 7320 3d20 5b6c        paths = [l
+0003c0e0: 6973 7428 636f 6c2e 6173 7479 7065 2873  ist(col.astype(s
+0003c0f0: 7472 2929 2066 6f72 2063 6f6c 2069 6e20  tr)) for col in 
+0003c100: 7365 6c66 2e71 7565 7565 5f70 6174 682e  self.queue_path.
+0003c110: 545d 0a20 2020 2020 2020 2020 2020 2065  T].            e
+0003c120: 7874 7261 7320 3d20 5b5d 0a20 2020 2020  xtras = [].     
+0003c130: 2020 2020 2020 2066 6f72 2063 6f6c 2069         for col i
+0003c140: 6e20 7365 6c66 2e71 7565 7565 5f70 6174  n self.queue_pat
+0003c150: 682e 543a 0a20 2020 2020 2020 2020 2020  h.T:.           
+0003c160: 2020 2020 2023 2054 6869 7320 6e65 7374       # This nest
+0003c170: 6564 2064 6963 7469 6f6e 6172 7920 636f  ed dictionary co
+0003c180: 6d70 7265 6865 6e73 696f 6e20 636f 6d62  mprehension comb
+0003c190: 696e 6573 2061 2063 6f6c 756d 6e20 6f66  ines a column of
+0003c1a0: 2065 7874 7261 2069 6e66 6f72 6d61 7469   extra informati
+0003c1b0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+0003c1c0: 2020 2023 2064 6963 7469 6f6e 6172 6965     # dictionarie
+0003c1d0: 7320 696e 746f 206f 6e65 2c20 666f 7220  s into one, for 
+0003c1e0: 6561 7365 206f 6620 6163 6365 7373 2e0a  ease of access..
+0003c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c200: 636f 6d62 5f65 7874 7261 203d 207b 6b3a  comb_extra = {k:
+0003c210: 2076 2066 6f72 2065 7874 5f64 6963 7420   v for ext_dict 
+0003c220: 696e 2063 6f6c 2066 6f72 206b 2c20 7620  in col for k, v 
+0003c230: 696e 2065 7874 5f64 6963 742e 6974 656d  in ext_dict.item
+0003c240: 7328 297d 0a20 2020 2020 2020 2020 2020  s()}.           
+0003c250: 2020 2020 2065 7874 7261 732e 6170 7065       extras.appe
+0003c260: 6e64 2863 6f6d 625f 6578 7472 6129 0a0a  nd(comb_extra)..
+0003c270: 2020 2020 2020 2020 2320 5468 6973 2069          # This i
+0003c280: 7320 6f6e 6c79 206c 696b 656c 7920 746f  s only likely to
+0003c290: 2062 6520 6361 6c6c 6564 2077 6865 6e20   be called when 
+0003c2a0: 7072 6f63 6573 7369 6e67 2069 7320 6265  processing is be
+0003c2b0: 6769 6e6e 696e 672c 2073 6f20 7468 6973  ginning, so this
+0003c2c0: 2077 696c 6c20 7769 7065 2074 6865 2071   will wipe the q
+0003c2d0: 7565 7565 2e0a 2020 2020 2020 2020 7365  ueue..        se
+0003c2e0: 6c66 2e71 7565 7565 203d 204e 6f6e 650a  lf.queue = None.
+0003c2f0: 2020 2020 2020 2020 7365 6c66 2e71 7565          self.que
+0003c300: 7565 5f74 7970 6520 3d20 4e6f 6e65 0a20  ue_type = None. 
+0003c310: 2020 2020 2020 2073 656c 662e 7175 6575         self.queu
+0003c320: 655f 7061 7468 203d 204e 6f6e 650a 2020  e_path = None.  
+0003c330: 2020 2020 2020 7365 6c66 2e71 7565 7565        self.queue
+0003c340: 5f65 7874 7261 5f69 6e66 6f20 3d20 4e6f  _extra_info = No
+0003c350: 6e65 0a20 2020 2020 2020 2023 2054 6865  ne.        # The
+0003c360: 2072 6574 7572 6e65 6420 7061 7468 7320   returned paths 
+0003c370: 6172 6520 6c69 7374 7320 6f66 2073 7472  are lists of str
+0003c380: 696e 6773 2062 6563 6175 7365 2077 6520  ings because we 
+0003c390: 7761 6e74 2074 6f20 696e 636c 7564 6520  want to include 
+0003c3a0: 6576 6572 7920 6669 6c65 2069 6e20 6120  every file in a 
+0003c3b0: 7374 6163 6b20 746f 2062 6520 6162 6c65  stack to be able
+0003c3c0: 0a20 2020 2020 2020 2023 2074 6f20 6368  .        # to ch
+0003c3d0: 6563 6b20 7468 6174 2065 7869 7374 730a  eck that exists.
+0003c3e0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+0003c3f0: 726f 6365 7373 6564 5f63 6d64 732c 2074  rocessed_cmds, t
+0003c400: 7970 6573 2c20 7061 7468 732c 2065 7874  ypes, paths, ext
+0003c410: 7261 730a 0a20 2020 2064 6566 2075 7064  ras..    def upd
+0003c420: 6174 655f 7072 6f64 7563 7473 2873 656c  ate_products(sel
+0003c430: 662c 2070 726f 645f 6f62 6a3a 2042 6173  f, prod_obj: Bas
+0003c440: 6550 726f 6475 6374 293a 0a20 2020 2020  eProduct):.     
+0003c450: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+0003c460: 6869 7320 6d65 7468 6f64 2077 696c 6c20  his method will 
+0003c470: 4f4e 4c59 2073 746f 7265 2069 6d61 6765  ONLY store image
+0003c480: 7320 616e 6420 6578 706f 7375 7265 206d  s and exposure m
+0003c490: 6170 732e 2049 6465 616c 6c79 2049 2077  aps. Ideally I w
+0003c4a0: 6f75 6c64 6e27 7420 7374 6f72 6520 7468  ouldn't store th
+0003c4b0: 656d 2061 7320 7072 6f64 7563 7420 6f62  em as product ob
+0003c4c0: 6a65 6374 730a 2020 2020 2020 2020 6174  jects.        at
+0003c4d0: 2061 6c6c 2c20 6275 7420 756e 666f 7274   all, but unfort
+0003c4e0: 756e 6174 656c 7920 6578 706f 7375 7265  unately exposure
+0003c4f0: 206d 6170 7320 7265 7175 6972 6520 616e   maps require an
+0003c500: 2069 6d61 6765 2074 6f20 6265 2067 656e   image to be gen
+0003c510: 6572 6174 6564 2e20 556e 6c69 6b65 2061  erated. Unlike a
+0003c520: 6c6c 206f 7468 6572 2073 6f75 7263 6520  ll other source 
+0003c530: 636c 6173 7365 732c 0a20 2020 2020 2020  classes,.       
+0003c540: 2072 6174 656d 6170 7320 7769 6c6c 206e   ratemaps will n
+0003c550: 6f74 2062 6520 6765 6e65 7261 7465 6420  ot be generated 
+0003c560: 7768 656e 206d 6174 6368 696e 6720 696d  when matching im
+0003c570: 6167 6573 2061 6e64 2065 7870 6f73 7572  ages and exposur
+0003c580: 6520 6d61 7073 2061 7265 2061 6464 6564  e maps are added
+0003c590: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0003c5a0: 6d20 4261 7365 5072 6f64 7563 7420 7072  m BaseProduct pr
+0003c5b0: 6f64 5f6f 626a 3a20 5468 6520 6e65 7720  od_obj: The new 
+0003c5c0: 7072 6f64 7563 7420 6f62 6a65 6374 2074  product object t
+0003c5d0: 6f20 6265 2061 6464 6564 2074 6f20 7468  o be added to th
+0003c5e0: 6520 736f 7572 6365 206f 626a 6563 742e  e source object.
+0003c5f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0003c600: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+0003c610: 7374 616e 6365 2870 726f 645f 6f62 6a2c  stance(prod_obj,
+0003c620: 2028 4261 7365 5072 6f64 7563 742c 2042   (BaseProduct, B
+0003c630: 6173 6541 6767 7265 6761 7465 5072 6f64  aseAggregateProd
+0003c640: 7563 7429 2920 616e 6420 7072 6f64 5f6f  uct)) and prod_o
+0003c650: 626a 2069 7320 6e6f 7420 4e6f 6e65 3a0a  bj is not None:.
+0003c660: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0003c670: 6520 5479 7065 4572 726f 7228 224f 6e6c  e TypeError("Onl
+0003c680: 7920 7072 6f64 7563 7420 6f62 6a65 6374  y product object
+0003c690: 7320 6361 6e20 6265 2061 7373 6967 6e65  s can be assigne
+0003c6a0: 6420 746f 2073 6f75 7263 6573 2e22 290a  d to sources.").
+0003c6b0: 2020 2020 2020 2020 656c 6966 2070 726f          elif pro
+0003c6c0: 645f 6f62 6a2e 7479 7065 2021 3d20 2769  d_obj.type != 'i
+0003c6d0: 6d61 6765 2720 616e 6420 7072 6f64 5f6f  mage' and prod_o
+0003c6e0: 626a 2e74 7970 6520 213d 2027 6578 706d  bj.type != 'expm
+0003c6f0: 6170 273a 0a20 2020 2020 2020 2020 2020  ap':.           
+0003c700: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+0003c710: 2822 4f6e 6c79 2069 6d61 6765 7320 616e  ("Only images an
+0003c720: 6420 6578 706f 7375 7265 206d 6170 7320  d exposure maps 
+0003c730: 6361 6e20 6265 2073 746f 7265 6420 696e  can be stored in
+0003c740: 2061 204e 756c 6c53 6f75 7263 652c 207b   a NullSource, {
+0003c750: 7d20 6f62 6a65 6374 7320 220a 2020 2020  } objects ".    
+0003c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c770: 2020 2020 2020 2020 2263 616e 6e6f 7422          "cannot"
+0003c780: 2e66 6f72 6d61 7428 7072 6f64 5f6f 626a  .format(prod_obj
+0003c790: 2e74 7970 6529 290a 0a20 2020 2020 2020  .type))..       
+0003c7a0: 2069 6620 7072 6f64 5f6f 626a 2069 7320   if prod_obj is 
+0003c7b0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0003c7c0: 2020 2020 2020 656e 5f62 6e64 7320 3d20        en_bnds = 
+0003c7d0: 7072 6f64 5f6f 626a 2e65 6e65 7267 795f  prod_obj.energy_
+0003c7e0: 626f 756e 6473 0a20 2020 2020 2020 2020  bounds.         
+0003c7f0: 2020 2065 7874 7261 5f6b 6579 203d 2022     extra_key = "
+0003c800: 626f 756e 645f 7b6c 7d2d 7b75 7d22 2e66  bound_{l}-{u}".f
+0003c810: 6f72 6d61 7428 6c3d 666c 6f61 7428 656e  ormat(l=float(en
+0003c820: 5f62 6e64 735b 305d 2e76 616c 7565 292c  _bnds[0].value),
+0003c830: 2075 3d66 6c6f 6174 2865 6e5f 626e 6473   u=float(en_bnds
+0003c840: 5b31 5d2e 7661 6c75 6529 290a 2020 2020  [1].value)).    
+0003c850: 2020 2020 2020 2020 2320 4173 2074 6865          # As the
+0003c860: 2065 7874 7261 5f6b 6579 2076 6172 6961   extra_key varia
+0003c870: 626c 6520 6361 6e20 6265 2061 6c74 6572  ble can be alter
+0003c880: 6564 2069 6620 7468 6520 496d 6167 6520  ed if the Image 
+0003c890: 6973 2050 5346 2063 6f72 7265 6374 6564  is PSF corrected
+0003c8a0: 2c20 4927 6c6c 2061 6c73 6f20 6d61 6b65  , I'll also make
+0003c8b0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+0003c8c0: 7468 6973 2076 6172 6961 626c 6520 7769  this variable wi
+0003c8d0: 7468 206a 7573 7420 7468 6520 656e 6572  th just the ener
+0003c8e0: 6779 206b 6579 0a20 2020 2020 2020 2020  gy key.         
+0003c8f0: 2020 2065 6e5f 6b65 7920 3d20 2262 6f75     en_key = "bou
+0003c900: 6e64 5f7b 6c7d 2d7b 757d 222e 666f 726d  nd_{l}-{u}".form
+0003c910: 6174 286c 3d66 6c6f 6174 2865 6e5f 626e  at(l=float(en_bn
+0003c920: 6473 5b30 5d2e 7661 6c75 6529 2c20 753d  ds[0].value), u=
+0003c930: 666c 6f61 7428 656e 5f62 6e64 735b 315d  float(en_bnds[1]
+0003c940: 2e76 616c 7565 2929 0a0a 2020 2020 2020  .value))..      
+0003c950: 2020 2020 2020 2320 5365 636f 6e64 6172        # Secondar
+0003c960: 7920 6368 6563 6b69 6e67 2073 7465 7020  y checking step 
+0003c970: 6e6f 7720 4927 7665 2061 6464 6564 2050  now I've added P
+0003c980: 5346 2063 6f72 7265 6374 696f 6e0a 2020  SF correction.  
+0003c990: 2020 2020 2020 2020 2020 6966 2074 7970            if typ
+0003c9a0: 6528 7072 6f64 5f6f 626a 2920 3d3d 2049  e(prod_obj) == I
+0003c9b0: 6d61 6765 2061 6e64 2070 726f 645f 6f62  mage and prod_ob
+0003c9c0: 6a2e 7073 665f 636f 7272 6563 7465 643a  j.psf_corrected:
+0003c9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c9e0: 2065 7874 7261 5f6b 6579 202b 3d20 225f   extra_key += "_
+0003c9f0: 2220 2b20 7072 6f64 5f6f 626a 2e70 7366  " + prod_obj.psf
+0003ca00: 5f6d 6f64 656c 202b 2022 5f22 202b 2073  _model + "_" + s
+0003ca10: 7472 2870 726f 645f 6f62 6a2e 7073 665f  tr(prod_obj.psf_
+0003ca20: 6269 6e73 2920 2b20 225f 2220 2b20 7072  bins) + "_" + pr
+0003ca30: 6f64 5f6f 626a 2e70 7366 5f61 6c67 6f72  od_obj.psf_algor
+0003ca40: 6974 686d 202b 205c 0a20 2020 2020 2020  ithm + \.       
+0003ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ca60: 2020 2020 2020 7374 7228 7072 6f64 5f6f        str(prod_o
+0003ca70: 626a 2e70 7366 5f69 7465 7261 7469 6f6e  bj.psf_iteration
+0003ca80: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+0003ca90: 2320 416c 6c20 696e 666f 726d 6174 696f  # All informatio
+0003caa0: 6e20 6162 6f75 7420 7768 6572 6520 746f  n about where to
+0003cab0: 2070 6c61 6365 2069 7420 696e 206f 7572   place it in our
+0003cac0: 2073 746f 7261 6765 2068 6965 7261 7263   storage hierarc
+0003cad0: 6879 2063 616e 2062 6520 7075 6c6c 6564  hy can be pulled
+0003cae0: 2066 726f 6d20 7468 6520 7072 6f64 7563   from the produc
+0003caf0: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
+0003cb00: 6f62 6a65 6374 2069 7473 656c 660a 2020  object itself.  
+0003cb10: 2020 2020 2020 2020 2020 6f62 735f 6964            obs_id
+0003cb20: 203d 2070 726f 645f 6f62 6a2e 6f62 735f   = prod_obj.obs_
+0003cb30: 6964 0a20 2020 2020 2020 2020 2020 2069  id.            i
+0003cb40: 6e73 7420 3d20 7072 6f64 5f6f 626a 2e69  nst = prod_obj.i
+0003cb50: 6e73 7472 756d 656e 740a 2020 2020 2020  nstrument.      
+0003cb60: 2020 2020 2020 705f 7479 7065 203d 2070        p_type = p
+0003cb70: 726f 645f 6f62 6a2e 7479 7065 0a0a 2020  rod_obj.type..  
+0003cb80: 2020 2020 2020 2020 2020 2320 446f 7562            # Doub
+0003cb90: 6c65 2063 6865 636b 2074 6861 7420 736f  le check that so
+0003cba0: 6d65 7468 696e 6720 6973 2074 7279 696e  mething is tryin
+0003cbb0: 6720 746f 2061 6464 2070 726f 6475 6374  g to add product
+0003cbc0: 7320 6672 6f6d 2061 6e6f 7468 6572 2073  s from another s
+0003cbd0: 6f75 7263 6520 746f 2074 6865 2063 7572  ource to the cur
+0003cbe0: 7265 6e74 206f 6e65 2e0a 2020 2020 2020  rent one..      
+0003cbf0: 2020 2020 2020 6966 206f 6273 5f69 6420        if obs_id 
+0003cc00: 213d 2022 636f 6d62 696e 6564 2220 616e  != "combined" an
+0003cc10: 6420 6f62 735f 6964 206e 6f74 2069 6e20  d obs_id not in 
+0003cc20: 7365 6c66 2e5f 7072 6f64 7563 7473 3a0a  self._products:.
+0003cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cc40: 7261 6973 6520 4e6f 7441 7373 6f63 6961  raise NotAssocia
+0003cc50: 7465 6445 7272 6f72 2822 7b6f 7d20 6973  tedError("{o} is
+0003cc60: 206e 6f74 2061 7373 6f63 6961 7465 6420   not associated 
+0003cc70: 7769 7468 2074 6869 7320 6e75 6c6c 2073  with this null s
+0003cc80: 6f75 7263 652e 222e 666f 726d 6174 286f  ource.".format(o
+0003cc90: 3d6f 6273 5f69 6429 290a 2020 2020 2020  =obs_id)).      
+0003cca0: 2020 2020 2020 656c 6966 2069 6e73 7420        elif inst 
+0003ccb0: 213d 2022 636f 6d62 696e 6564 2220 616e  != "combined" an
+0003ccc0: 6420 696e 7374 206e 6f74 2069 6e20 7365  d inst not in se
+0003ccd0: 6c66 2e5f 7072 6f64 7563 7473 5b6f 6273  lf._products[obs
+0003cce0: 5f69 645d 3a0a 2020 2020 2020 2020 2020  _id]:.          
+0003ccf0: 2020 2020 2020 7261 6973 6520 4e6f 7441        raise NotA
+0003cd00: 7373 6f63 6961 7465 6445 7272 6f72 280a  ssociatedError(.
+0003cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cd20: 2020 2020 227b 697d 2069 7320 6e6f 7420      "{i} is not 
+0003cd30: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
+0003cd40: 584d 4d20 6f62 7365 7276 6174 696f 6e20  XMM observation 
+0003cd50: 7b6f 7d22 2e66 6f72 6d61 7428 693d 696e  {o}".format(i=in
+0003cd60: 7374 2c20 6f3d 6f62 735f 6964 2929 0a0a  st, o=obs_id))..
+0003cd70: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0003cd80: 7874 7261 5f6b 6579 206e 6f74 2069 6e20  xtra_key not in 
+0003cd90: 7365 6c66 2e5f 7072 6f64 7563 7473 5b6f  self._products[o
+0003cda0: 6273 5f69 645d 5b69 6e73 745d 3a0a 2020  bs_id][inst]:.  
+0003cdb0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0003cdc0: 6c66 2e5f 7072 6f64 7563 7473 5b6f 6273  lf._products[obs
+0003cdd0: 5f69 645d 5b69 6e73 745d 5b65 7874 7261  _id][inst][extra
+0003cde0: 5f6b 6579 5d20 3d20 7b7d 0a20 2020 2020  _key] = {}.     
+0003cdf0: 2020 2020 2020 2073 656c 662e 5f70 726f         self._pro
+0003ce00: 6475 6374 735b 6f62 735f 6964 5d5b 696e  ducts[obs_id][in
+0003ce10: 7374 5d5b 6578 7472 615f 6b65 795d 5b70  st][extra_key][p
+0003ce20: 5f74 7970 655d 203d 2070 726f 645f 6f62  _type] = prod_ob
+0003ce30: 6a0a 0a20 2020 2064 6566 2067 6574 5f70  j..    def get_p
+0003ce40: 726f 6475 6374 7328 7365 6c66 2c20 705f  roducts(self, p_
+0003ce50: 7479 7065 3a20 7374 722c 206f 6273 5f69  type: str, obs_i
+0003ce60: 643a 2073 7472 203d 204e 6f6e 652c 2069  d: str = None, i
+0003ce70: 6e73 743a 2073 7472 203d 204e 6f6e 652c  nst: str = None,
+0003ce80: 2065 7874 7261 5f6b 6579 3a20 7374 7220   extra_key: str 
+0003ce90: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0003cea0: 2020 2020 2020 2020 2020 2020 206a 7573               jus
+0003ceb0: 745f 6f62 6a3a 2062 6f6f 6c20 3d20 5472  t_obj: bool = Tr
+0003cec0: 7565 2920 2d3e 204c 6973 745b 4261 7365  ue) -> List[Base
+0003ced0: 5072 6f64 7563 745d 3a0a 2020 2020 2020  Product]:.      
+0003cee0: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
+0003cef0: 6973 2069 7320 7468 6520 6765 7474 6572  is is the getter
+0003cf00: 2066 6f72 2074 6865 2070 726f 6475 6374   for the product
+0003cf10: 7320 6461 7461 2073 7472 7563 7475 7265  s data structure
+0003cf20: 206f 6620 536f 7572 6365 206f 626a 6563   of Source objec
+0003cf30: 7473 2e20 5061 7373 696e 6720 6120 2770  ts. Passing a 'p
+0003cf40: 726f 6475 6374 2074 7970 6527 0a20 2020  roduct type'.   
+0003cf50: 2020 2020 2073 7563 6820 6173 2027 6576       such as 'ev
+0003cf60: 656e 7473 2720 6f72 2027 696d 6167 6573  ents' or 'images
+0003cf70: 2720 7769 6c6c 2072 6574 7572 6e20 6576  ' will return ev
+0003cf80: 6572 7920 6d61 7463 6869 6e67 2065 6e74  ery matching ent
+0003cf90: 7279 2069 6e20 7468 6520 7072 6f64 7563  ry in the produc
+0003cfa0: 7473 2064 6174 6120 7374 7275 6374 7572  ts data structur
+0003cfb0: 652e 0a0a 2020 2020 2020 2020 3a70 6172  e...        :par
+0003cfc0: 616d 2073 7472 2070 5f74 7970 653a 2050  am str p_type: P
+0003cfd0: 726f 6475 6374 2074 7970 6520 6964 656e  roduct type iden
+0003cfe0: 7469 6669 6572 2e20 652e 672e 2069 6d61  tifier. e.g. ima
+0003cff0: 6765 206f 7220 6578 706d 6170 2e0a 2020  ge or expmap..  
+0003d000: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
+0003d010: 206f 6273 5f69 643a 204f 7074 696f 6e61   obs_id: Optiona
+0003d020: 6c6c 792c 2061 2073 7065 6369 6669 6320  lly, a specific 
+0003d030: 6f62 735f 6964 2074 6f20 7365 6172 6368  obs_id to search
+0003d040: 2063 616e 2062 6520 7375 7070 6c69 6564   can be supplied
+0003d050: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0003d060: 2073 7472 2069 6e73 743a 204f 7074 696f   str inst: Optio
+0003d070: 6e61 6c6c 792c 2061 2073 7065 6369 6669  nally, a specifi
+0003d080: 6320 696e 7374 7275 6d65 6e74 2074 6f20  c instrument to 
+0003d090: 7365 6172 6368 2063 616e 2062 6520 7375  search can be su
+0003d0a0: 7070 6c69 6564 2e0a 2020 2020 2020 2020  pplied..        
+0003d0b0: 3a70 6172 616d 2073 7472 2065 7874 7261  :param str extra
+0003d0c0: 5f6b 6579 3a20 4f70 7469 6f6e 616c 6c79  _key: Optionally
+0003d0d0: 2c20 616e 2065 7874 7261 206b 6579 2028  , an extra key (
+0003d0e0: 6c69 6b65 2061 6e20 656e 6572 6779 2062  like an energy b
+0003d0f0: 6f75 6e64 2920 6361 6e20 6265 2073 7570  ound) can be sup
+0003d100: 706c 6965 642e 0a20 2020 2020 2020 203a  plied..        :
+0003d110: 7061 7261 6d20 626f 6f6c 206a 7573 745f  param bool just_
+0003d120: 6f62 6a3a 2041 2062 6f6f 6c65 616e 2066  obj: A boolean f
+0003d130: 6c61 6720 7468 6174 2063 6f6e 7472 6f6c  lag that control
+0003d140: 7320 7768 6574 6865 7220 7468 6973 206d  s whether this m
+0003d150: 6574 686f 6420 7265 7475 726e 7320 6a75  ethod returns ju
+0003d160: 7374 2074 6865 2070 726f 6475 6374 206f  st the product o
+0003d170: 626a 6563 7473 2c0a 2020 2020 2020 2020  bjects,.        
+0003d180: 2020 2020 6f72 2074 6865 206f 7468 6572      or the other
+0003d190: 2069 6e66 6f72 6d61 7469 6f6e 2074 6861   information tha
+0003d1a0: 7420 676f 6573 2077 6974 6820 6974 206c  t goes with it l
+0003d1b0: 696b 6520 4f62 7349 4420 616e 6420 696e  ike ObsID and in
+0003d1c0: 7374 7275 6d65 6e74 2e0a 2020 2020 2020  strument..      
+0003d1d0: 2020 3a72 6574 7572 6e3a 204c 6973 7420    :return: List 
+0003d1e0: 6f66 206d 6174 6368 696e 6720 7072 6f64  of matching prod
+0003d1f0: 7563 7473 2e0a 2020 2020 2020 2020 3a72  ucts..        :r
+0003d200: 7479 7065 3a20 4c69 7374 5b42 6173 6550  type: List[BaseP
+0003d210: 726f 6475 6374 5d0a 2020 2020 2020 2020  roduct].        
+0003d220: 2222 220a 0a20 2020 2020 2020 2064 6566  """..        def
+0003d230: 2075 6e70 6163 6b5f 6c69 7374 2874 6f5f   unpack_list(to_
+0003d240: 756e 7061 636b 3a20 6c69 7374 293a 0a20  unpack: list):. 
+0003d250: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
+0003d260: 2020 2020 2020 2020 2020 2041 2072 6563             A rec
+0003d270: 7572 7369 7665 2066 756e 6374 696f 6e20  ursive function 
+0003d280: 746f 2067 6f20 7468 726f 7567 6820 6576  to go through ev
+0003d290: 6572 7920 6c61 7965 7220 6f66 2061 206e  ery layer of a n
+0003d2a0: 6573 7465 6420 6c69 7374 2061 6e64 2066  ested list and f
+0003d2b0: 6c61 7474 656e 2069 7420 616c 6c20 6f75  latten it all ou
+0003d2c0: 742e 2049 740a 2020 2020 2020 2020 2020  t. It.          
+0003d2d0: 2020 646f 6573 6e27 7420 7265 7475 726e    doesn't return
+0003d2e0: 2061 6e79 7468 696e 6720 6265 6361 7573   anything becaus
+0003d2f0: 6520 746f 206d 616b 6520 6c69 6665 2065  e to make life e
+0003d300: 6173 6965 7220 7468 6520 2772 6573 756c  asier the 'resul
+0003d310: 7473 2720 6172 6520 6170 7065 6e64 6564  ts' are appended
+0003d320: 2074 6f20 6120 7661 7269 6162 6c65 0a20   to a variable. 
+0003d330: 2020 2020 2020 2020 2020 2069 6e20 7468             in th
+0003d340: 6520 6e61 6d65 7370 6163 6520 6162 6f76  e namespace abov
+0003d350: 6520 7468 6973 206f 6e65 2e0a 0a20 2020  e this one...   
+0003d360: 2020 2020 2020 2020 203a 7061 7261 6d20           :param 
+0003d370: 6c69 7374 2074 6f5f 756e 7061 636b 3a20  list to_unpack: 
+0003d380: 5468 6520 6c69 7374 2074 6861 7420 6e65  The list that ne
+0003d390: 6564 7320 756e 7061 636b 696e 672e 0a20  eds unpacking.. 
+0003d3a0: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
+0003d3b0: 2020 2020 2020 2020 2020 2023 204d 7573             # Mus
+0003d3c0: 7420 6974 6572 6174 6520 7468 726f 7567  t iterate throug
+0003d3d0: 6820 7468 6520 6769 7665 6e20 6c69 7374  h the given list
+0003d3e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0003d3f0: 2065 6e74 7279 2069 6e20 746f 5f75 6e70   entry in to_unp
+0003d400: 6163 6b3a 0a20 2020 2020 2020 2020 2020  ack:.           
+0003d410: 2020 2020 2023 2049 6620 7468 6520 6375       # If the cu
+0003d420: 7272 656e 7420 656c 656d 656e 7420 6973  rrent element is
+0003d430: 206e 6f74 2061 206c 6973 7420 7468 656e   not a list then
+0003d440: 2061 6c6c 2069 7320 6368 696c 6c2c 2074   all is chill, t
+0003d450: 6869 7320 656c 656d 656e 7420 6973 2072  his element is r
+0003d460: 6561 6479 2066 6f72 2061 7070 656e 6469  eady for appendi
+0003d470: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
+0003d480: 2020 2023 2074 6f20 7468 6520 6669 6e61     # to the fina
+0003d490: 6c20 6c69 7374 0a20 2020 2020 2020 2020  l list.         
+0003d4a0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0003d4b0: 696e 7374 616e 6365 2865 6e74 7279 2c20  instance(entry, 
+0003d4c0: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+0003d4d0: 2020 2020 2020 2020 2020 206f 7574 2e61             out.a
+0003d4e0: 7070 656e 6428 656e 7472 7929 0a20 2020  ppend(entry).   
+0003d4f0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0003d500: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0003d510: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+0003d520: 6375 7272 656e 7420 656c 656d 656e 7420  current element 
+0003d530: 4953 2061 206c 6973 742c 2074 6865 6e20  IS a list, then 
+0003d540: 6f62 7669 6f75 736c 7920 7765 2073 7469  obviously we sti
+0003d550: 6c6c 2068 6176 6520 6d6f 7265 2075 6e70  ll have more unp
+0003d560: 6163 6b69 6e67 2074 6f20 646f 2c0a 2020  acking to do,.  
+0003d570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d580: 2020 2320 736f 2077 6520 6361 6c6c 2074    # so we call t
+0003d590: 6869 7320 6675 6e63 7469 6f6e 2072 6563  his function rec
+0003d5a0: 7572 7369 7665 6c79 2e0a 2020 2020 2020  ursively..      
+0003d5b0: 2020 2020 2020 2020 2020 2020 2020 756e                un
+0003d5c0: 7061 636b 5f6c 6973 7428 656e 7472 7929  pack_list(entry)
+0003d5d0: 0a0a 2020 2020 2020 2020 6966 206f 6273  ..        if obs
+0003d5e0: 5f69 6420 6e6f 7420 696e 2073 656c 662e  _id not in self.
+0003d5f0: 5f70 726f 6475 6374 7320 616e 6420 6f62  _products and ob
+0003d600: 735f 6964 2069 7320 6e6f 7420 4e6f 6e65  s_id is not None
+0003d610: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0003d620: 6973 6520 4e6f 7441 7373 6f63 6961 7465  ise NotAssociate
+0003d630: 6445 7272 6f72 2822 7b6f 7d20 6973 206e  dError("{o} is n
+0003d640: 6f74 2061 7373 6f63 6961 7465 6420 7769  ot associated wi
+0003d650: 7468 207b 737d 2e22 2e66 6f72 6d61 7428  th {s}.".format(
+0003d660: 6f3d 6f62 735f 6964 2c20 733d 7365 6c66  o=obs_id, s=self
+0003d670: 2e6e 616d 6529 290a 2020 2020 2020 2020  .name)).        
+0003d680: 656c 6966 2069 6e73 7420 6e6f 7420 696e  elif inst not in
+0003d690: 2058 4d4d 5f49 4e53 5420 616e 6420 696e   XMM_INST and in
+0003d6a0: 7374 2069 7320 6e6f 7420 4e6f 6e65 3a0a  st is not None:.
+0003d6b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0003d6c0: 6520 5661 6c75 6545 7272 6f72 2822 7b7d  e ValueError("{}
+0003d6d0: 2069 7320 6e6f 7420 616e 2061 6c6c 6f77   is not an allow
+0003d6e0: 6564 2069 6e73 7472 756d 656e 7422 2e66  ed instrument".f
+0003d6f0: 6f72 6d61 7428 696e 7374 2929 0a0a 2020  ormat(inst))..  
+0003d700: 2020 2020 2020 6d61 7463 6865 7320 3d20        matches = 
+0003d710: 5b5d 0a20 2020 2020 2020 2023 2049 7465  [].        # Ite
+0003d720: 7261 7465 7320 7468 726f 7567 6820 7468  rates through th
+0003d730: 6520 6469 6374 2073 6561 7263 6820 7265  e dict search re
+0003d740: 7475 726e 2c20 6275 7420 6561 6368 206d  turn, but each m
+0003d750: 6174 6368 2069 7320 6c69 6b65 6c79 2074  atch is likely t
+0003d760: 6f20 6265 2061 2076 6572 7920 6e65 7374  o be a very nest
+0003d770: 6564 206c 6973 742c 0a20 2020 2020 2020  ed list,.       
+0003d780: 2023 2077 6974 6820 7468 6520 6465 6772   # with the degr
+0003d790: 6565 206f 6620 6e65 7374 696e 6720 6465  ee of nesting de
+0003d7a0: 7065 6e64 616e 7420 6f6e 2070 726f 6475  pendant on produ
+0003d7b0: 6374 2074 7970 6520 2861 7320 6576 656e  ct type (as even
+0003d7c0: 7420 6c69 7374 7320 6c69 7665 2061 206c  t lists live a l
+0003d7d0: 6576 656c 2075 7020 6672 6f6d 0a20 2020  evel up from.   
+0003d7e0: 2020 2020 2023 2069 6d61 6765 7320 666f       # images fo
+0003d7f0: 7220 696e 7374 616e 6365 0a20 2020 2020  r instance.     
+0003d800: 2020 2066 6f72 206d 6174 6368 2069 6e20     for match in 
+0003d810: 6469 6374 5f73 6561 7263 6828 705f 7479  dict_search(p_ty
+0003d820: 7065 2c20 7365 6c66 2e5f 7072 6f64 7563  pe, self._produc
+0003d830: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
+0003d840: 206f 7574 203d 205b 5d0a 2020 2020 2020   out = [].      
+0003d850: 2020 2020 2020 756e 7061 636b 5f6c 6973        unpack_lis
+0003d860: 7428 6d61 7463 6829 0a20 2020 2020 2020  t(match).       
+0003d870: 2020 2020 2023 204f 6e6c 7920 6170 7065       # Only appe
+0003d880: 6e64 7320 6966 2074 6869 7320 7061 7274  nds if this part
+0003d890: 6963 756c 6172 206d 6174 6368 2069 7320  icular match is 
+0003d8a0: 666f 7220 7468 6520 6f62 735f 6964 2061  for the obs_id a
+0003d8b0: 6e64 2069 6e73 7472 756d 656e 7420 7061  nd instrument pa
+0003d8c0: 7373 6564 2074 6f20 7468 6973 206d 6574  ssed to this met
+0003d8d0: 686f 640a 2020 2020 2020 2020 2020 2020  hod.            
+0003d8e0: 2320 5468 6f75 6768 2061 6c6c 206d 6174  # Though all mat
+0003d8f0: 6368 6573 2077 696c 6c20 6265 2072 6574  ches will be ret
+0003d900: 7572 6e65 6420 6966 206e 6f20 6f62 735f  urned if no obs_
+0003d910: 6964 2f69 6e73 7420 6973 2070 6173 7365  id/inst is passe
+0003d920: 640a 2020 2020 2020 2020 2020 2020 6966  d.            if
+0003d930: 2028 6f62 735f 6964 203d 3d20 6f75 745b   (obs_id == out[
+0003d940: 305d 206f 7220 6f62 735f 6964 2069 7320  0] or obs_id is 
+0003d950: 4e6f 6e65 2920 616e 6420 2869 6e73 7420  None) and (inst 
+0003d960: 3d3d 206f 7574 5b31 5d20 6f72 2069 6e73  == out[1] or ins
+0003d970: 7420 6973 204e 6f6e 6529 205c 0a20 2020  t is None) \.   
+0003d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d990: 2061 6e64 2028 6578 7472 615f 6b65 7920   and (extra_key 
+0003d9a0: 696e 206f 7574 206f 7220 6578 7472 615f  in out or extra_
+0003d9b0: 6b65 7920 6973 204e 6f6e 6529 2061 6e64  key is None) and
+0003d9c0: 206e 6f74 206a 7573 745f 6f62 6a3a 0a20   not just_obj:. 
+0003d9d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0003d9e0: 6174 6368 6573 2e61 7070 656e 6428 6f75  atches.append(ou
+0003d9f0: 7429 0a20 2020 2020 2020 2020 2020 2065  t).            e
+0003da00: 6c69 6620 286f 6273 5f69 6420 3d3d 206f  lif (obs_id == o
+0003da10: 7574 5b30 5d20 6f72 206f 6273 5f69 6420  ut[0] or obs_id 
+0003da20: 6973 204e 6f6e 6529 2061 6e64 2028 696e  is None) and (in
+0003da30: 7374 203d 3d20 6f75 745b 315d 206f 7220  st == out[1] or 
+0003da40: 696e 7374 2069 7320 4e6f 6e65 2920 5c0a  inst is None) \.
+0003da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003da60: 2020 2020 616e 6420 2865 7874 7261 5f6b      and (extra_k
+0003da70: 6579 2069 6e20 6f75 7420 6f72 2065 7874  ey in out or ext
+0003da80: 7261 5f6b 6579 2069 7320 4e6f 6e65 2920  ra_key is None) 
+0003da90: 616e 6420 6a75 7374 5f6f 626a 3a0a 2020  and just_obj:.  
+0003daa0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0003dab0: 7463 6865 732e 6170 7065 6e64 286f 7574  tches.append(out
+0003dac0: 5b2d 315d 290a 2020 2020 2020 2020 7265  [-1]).        re
+0003dad0: 7475 726e 206d 6174 6368 6573 0a0a 2020  turn matches..  
+0003dae0: 2020 2320 5468 6973 2069 7320 7573 6564    # This is used
+0003daf0: 2074 6f20 6e61 6d65 2066 696c 6573 2061   to name files a
+0003db00: 6e64 2064 6972 6563 746f 7269 6573 2073  nd directories s
+0003db10: 6f20 7468 6973 2069 7320 6e6f 7420 616c  o this is not al
+0003db20: 6c6f 7765 6420 746f 2063 6861 6e67 652e  lowed to change.
+0003db30: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+0003db40: 2020 2064 6566 206e 616d 6528 7365 6c66     def name(self
+0003db50: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+0003db60: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
+0003db70: 6520 6e61 6d65 206f 6620 7468 6520 736f  e name of the so
+0003db80: 7572 6365 2c20 6569 7468 6572 2067 6976  urce, either giv
+0003db90: 656e 2061 7420 696e 6974 6961 6c69 7361  en at initialisa
+0003dba0: 7469 6f6e 206f 7220 6765 6e65 7261 7465  tion or generate
+0003dbb0: 6420 6672 6f6d 2074 6865 2075 7365 722d  d from the user-
+0003dbc0: 7375 7070 6c69 6564 2063 6f6f 7264 696e  supplied coordin
+0003dbd0: 6174 6573 2e0a 0a20 2020 2020 2020 203a  ates...        :
+0003dbe0: 7265 7475 726e 3a20 5468 6520 6e61 6d65  return: The name
+0003dbf0: 206f 6620 7468 6520 736f 7572 6365 2e0a   of the source..
+0003dc00: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
+0003dc10: 7374 720a 2020 2020 2020 2020 2222 220a  str.        """.
+0003dc20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0003dc30: 656c 662e 5f6e 616d 650a 0a20 2020 2040  elf._name..    @
+0003dc40: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+0003dc50: 206e 756d 5f70 6e5f 6f62 7328 7365 6c66   num_pn_obs(self
+0003dc60: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+0003dc70: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
+0003dc80: 7474 6572 206d 6574 686f 6420 7468 6174  tter method that
+0003dc90: 2067 6976 6573 2074 6865 206e 756d 6265   gives the numbe
+0003dca0: 7220 6f66 2050 4e20 6f62 7365 7276 6174  r of PN observat
+0003dcb0: 696f 6e73 2e0a 0a20 2020 2020 2020 203a  ions...        :
+0003dcc0: 7265 7475 726e 3a20 496e 7465 6765 7220  return: Integer 
+0003dcd0: 6e75 6d62 6572 206f 6620 504e 206f 6273  number of PN obs
+0003dce0: 6572 7661 7469 6f6e 7320 6173 736f 6369  ervations associ
+0003dcf0: 6174 6564 2077 6974 6820 7468 6973 2073  ated with this s
+0003dd00: 6f75 7263 650a 2020 2020 2020 2020 3a72  ource.        :r
+0003dd10: 7479 7065 3a20 696e 740a 2020 2020 2020  type: int.      
+0003dd20: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0003dd30: 7475 726e 206c 656e 285b 6f20 666f 7220  turn len([o for 
+0003dd40: 6f20 696e 2073 656c 662e 6f62 735f 6964  o in self.obs_id
+0003dd50: 7320 6966 2027 706e 2720 696e 2073 656c  s if 'pn' in sel
+0003dd60: 662e 5f70 726f 6475 6374 735b 6f5d 5d29  f._products[o]])
+0003dd70: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+0003dd80: 2020 2020 6465 6620 6e75 6d5f 6d6f 7331      def num_mos1
+0003dd90: 5f6f 6273 2873 656c 6629 202d 3e20 696e  _obs(self) -> in
+0003dda0: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+0003ddb0: 2020 2020 2020 2047 6574 7465 7220 6d65         Getter me
+0003ddc0: 7468 6f64 2074 6861 7420 6769 7665 7320  thod that gives 
+0003ddd0: 7468 6520 6e75 6d62 6572 206f 6620 4d4f  the number of MO
+0003dde0: 5331 206f 6273 6572 7661 7469 6f6e 732e  S1 observations.
+0003ddf0: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+0003de00: 6e3a 2049 6e74 6567 6572 206e 756d 6265  n: Integer numbe
+0003de10: 7220 6f66 204d 4f53 3120 6f62 7365 7276  r of MOS1 observ
+0003de20: 6174 696f 6e73 2061 7373 6f63 6961 7465  ations associate
+0003de30: 6420 7769 7468 2074 6869 7320 736f 7572  d with this sour
+0003de40: 6365 0a20 2020 2020 2020 203a 7274 7970  ce.        :rtyp
+0003de50: 653a 2069 6e74 0a20 2020 2020 2020 2022  e: int.        "
+0003de60: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0003de70: 6e20 6c65 6e28 5b6f 2066 6f72 206f 2069  n len([o for o i
+0003de80: 6e20 7365 6c66 2e6f 6273 5f69 6473 2069  n self.obs_ids i
+0003de90: 6620 276d 6f73 3127 2069 6e20 7365 6c66  f 'mos1' in self
+0003dea0: 2e5f 7072 6f64 7563 7473 5b6f 5d5d 290a  ._products[o]]).
+0003deb0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+0003dec0: 2020 2064 6566 206e 756d 5f6d 6f73 325f     def num_mos2_
+0003ded0: 6f62 7328 7365 6c66 2920 2d3e 2069 6e74  obs(self) -> int
+0003dee0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0003def0: 2020 2020 2020 4765 7474 6572 206d 6574        Getter met
+0003df00: 686f 6420 7468 6174 2067 6976 6573 2074  hod that gives t
+0003df10: 6865 206e 756d 6265 7220 6f66 204d 4f53  he number of MOS
+0003df20: 3220 6f62 7365 7276 6174 696f 6e73 2e0a  2 observations..
+0003df30: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0003df40: 3a20 496e 7465 6765 7220 6e75 6d62 6572  : Integer number
+0003df50: 206f 6620 4d4f 5332 206f 6273 6572 7661   of MOS2 observa
+0003df60: 7469 6f6e 7320 6173 736f 6369 6174 6564  tions associated
+0003df70: 2077 6974 6820 7468 6973 2073 6f75 7263   with this sourc
+0003df80: 650a 2020 2020 2020 2020 3a72 7479 7065  e.        :rtype
+0003df90: 3a20 696e 740a 2020 2020 2020 2020 2222  : int.        ""
+0003dfa0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+0003dfb0: 206c 656e 285b 6f20 666f 7220 6f20 696e   len([o for o in
+0003dfc0: 2073 656c 662e 6f62 735f 6964 7320 6966   self.obs_ids if
+0003dfd0: 2027 6d6f 7332 2720 696e 2073 656c 662e   'mos2' in self.
+0003dfe0: 5f70 726f 6475 6374 735b 6f5d 5d29 0a0a  _products[o]])..
+0003dff0: 2020 2020 6465 6620 696e 666f 2873 656c      def info(sel
+0003e000: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0003e010: 2020 2020 2020 2020 4a75 7374 2070 7269          Just pri
+0003e020: 6e74 7320 6120 636f 7570 6c65 206f 6620  nts a couple of 
+0003e030: 7069 6563 6573 206f 6620 696e 666f 726d  pieces of inform
+0003e040: 6174 696f 6e20 6162 6f75 7420 7468 6520  ation about the 
+0003e050: 4e75 6c6c 536f 7572 6365 0a20 2020 2020  NullSource.     
+0003e060: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+0003e070: 7269 6e74 2822 5c6e 2d2d 2d2d 2d2d 2d2d  rint("\n--------
+0003e080: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 0003e090: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0003e0a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0003e0b0: 2d2d 2d2d 2d2d 2d2d 2d5c 6e22 290a 0a20  ---------\n").. 
-0003e0c0: 2020 2064 6566 205f 5f6c 656e 5f5f 2873     def __len__(s
-0003e0d0: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
-0003e0e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0003e0f0: 204d 6574 686f 6420 746f 2072 6574 7572   Method to retur
-0003e100: 6e20 7468 6520 6c65 6e67 7468 206f 6620  n the length of 
-0003e110: 7468 6520 7072 6f64 7563 7473 2064 6963  the products dic
-0003e120: 7469 6f6e 6172 7920 2877 6869 6368 206d  tionary (which m
-0003e130: 6561 6e73 2074 6865 206e 756d 6265 7220  eans the number 
-0003e140: 6f66 0a20 2020 2020 2020 2069 6e64 6976  of.        indiv
-0003e150: 6964 7561 6c20 4f62 7349 4473 2061 7373  idual ObsIDs ass
-0003e160: 6f63 6961 7465 6420 7769 7468 2074 6869  ociated with thi
-0003e170: 7320 736f 7572 6365 292c 2077 6865 6e20  s source), when 
-0003e180: 6c65 6e28 2920 6973 2063 616c 6c65 6420  len() is called 
-0003e190: 6f6e 2061 6e20 696e 7374 616e 6365 206f  on an instance o
-0003e1a0: 6620 7468 6973 2063 6c61 7373 2e0a 0a20  f this class... 
-0003e1b0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0003e1c0: 5468 6520 696e 7465 6765 7220 6c65 6e67  The integer leng
-0003e1d0: 7468 206f 6620 7468 6520 746f 7020 6c65  th of the top le
-0003e1e0: 7665 6c20 6f66 2074 6865 205f 7072 6f64  vel of the _prod
-0003e1f0: 7563 7473 206e 6573 7465 6420 6469 6374  ucts nested dict
-0003e200: 696f 6e61 7279 2e0a 2020 2020 2020 2020  ionary..        
-0003e210: 3a72 7479 7065 3a20 696e 740a 2020 2020  :rtype: int.    
-0003e220: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0003e230: 7265 7475 726e 206c 656e 2873 656c 662e  return len(self.
-0003e240: 6f62 735f 6964 7329 0a                   obs_ids).
+0003e0a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d22 290a  -------------").
+0003e0b0: 2020 2020 2020 2020 7072 696e 7428 2253          print("S
+0003e0c0: 6f75 7263 6520 4e61 6d65 202d 207b 7d22  ource Name - {}"
+0003e0d0: 2e66 6f72 6d61 7428 7365 6c66 2e5f 6e61  .format(self._na
+0003e0e0: 6d65 2929 0a20 2020 2020 2020 2070 7269  me)).        pri
+0003e0f0: 6e74 2822 584d 4d20 4f62 7349 4473 202d  nt("XMM ObsIDs -
+0003e100: 207b 7d22 2e66 6f72 6d61 7428 7365 6c66   {}".format(self
+0003e110: 2e5f 5f6c 656e 5f5f 2829 2929 0a20 2020  .__len__())).   
+0003e120: 2020 2020 2070 7269 6e74 2822 504e 204f       print("PN O
+0003e130: 6273 6572 7661 7469 6f6e 7320 2d20 7b7d  bservations - {}
+0003e140: 222e 666f 726d 6174 2873 656c 662e 6e75  ".format(self.nu
+0003e150: 6d5f 706e 5f6f 6273 2929 0a20 2020 2020  m_pn_obs)).     
+0003e160: 2020 2070 7269 6e74 2822 4d4f 5331 204f     print("MOS1 O
+0003e170: 6273 6572 7661 7469 6f6e 7320 2d20 7b7d  bservations - {}
+0003e180: 222e 666f 726d 6174 2873 656c 662e 6e75  ".format(self.nu
+0003e190: 6d5f 6d6f 7331 5f6f 6273 2929 0a20 2020  m_mos1_obs)).   
+0003e1a0: 2020 2020 2070 7269 6e74 2822 4d4f 5332       print("MOS2
+0003e1b0: 204f 6273 6572 7661 7469 6f6e 7320 2d20   Observations - 
+0003e1c0: 7b7d 222e 666f 726d 6174 2873 656c 662e  {}".format(self.
+0003e1d0: 6e75 6d5f 6d6f 7332 5f6f 6273 2929 0a20  num_mos2_obs)). 
+0003e1e0: 2020 2020 2020 2070 7269 6e74 2822 2d2d         print("--
+0003e1f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0003e200: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0003e210: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0003e220: 2d2d 2d5c 6e22 290a 0a20 2020 2064 6566  ---\n")..    def
+0003e230: 205f 5f6c 656e 5f5f 2873 656c 6629 202d   __len__(self) -
+0003e240: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
+0003e250: 2222 0a20 2020 2020 2020 204d 6574 686f  "".        Metho
+0003e260: 6420 746f 2072 6574 7572 6e20 7468 6520  d to return the 
+0003e270: 6c65 6e67 7468 206f 6620 7468 6520 7072  length of the pr
+0003e280: 6f64 7563 7473 2064 6963 7469 6f6e 6172  oducts dictionar
+0003e290: 7920 2877 6869 6368 206d 6561 6e73 2074  y (which means t
+0003e2a0: 6865 206e 756d 6265 7220 6f66 0a20 2020  he number of.   
+0003e2b0: 2020 2020 2069 6e64 6976 6964 7561 6c20       individual 
+0003e2c0: 4f62 7349 4473 2061 7373 6f63 6961 7465  ObsIDs associate
+0003e2d0: 6420 7769 7468 2074 6869 7320 736f 7572  d with this sour
+0003e2e0: 6365 292c 2077 6865 6e20 6c65 6e28 2920  ce), when len() 
+0003e2f0: 6973 2063 616c 6c65 6420 6f6e 2061 6e20  is called on an 
+0003e300: 696e 7374 616e 6365 206f 6620 7468 6973  instance of this
+0003e310: 2063 6c61 7373 2e0a 0a20 2020 2020 2020   class...       
+0003e320: 203a 7265 7475 726e 3a20 5468 6520 696e   :return: The in
+0003e330: 7465 6765 7220 6c65 6e67 7468 206f 6620  teger length of 
+0003e340: 7468 6520 746f 7020 6c65 7665 6c20 6f66  the top level of
+0003e350: 2074 6865 205f 7072 6f64 7563 7473 206e   the _products n
+0003e360: 6573 7465 6420 6469 6374 696f 6e61 7279  ested dictionary
+0003e370: 2e0a 2020 2020 2020 2020 3a72 7479 7065  ..        :rtype
+0003e380: 3a20 696e 740a 2020 2020 2020 2020 2222  : int.        ""
+0003e390: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+0003e3a0: 206c 656e 2873 656c 662e 6f62 735f 6964   len(self.obs_id
+0003e3b0: 7329 0a                                  s).
```

### Comparing `xga-0.4.3/xga/sources/extended.py` & `xga-0.4.4/xga/sources/extended.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sources/general.py` & `xga-0.4.4/xga/sources/general.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sources/point.py` & `xga-0.4.4/xga/sources/point.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sourcetools/_common.py` & `xga-0.4.4/xga/sourcetools/_common.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sourcetools/density.py` & `xga-0.4.4/xga/sourcetools/density.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sourcetools/deproj.py` & `xga-0.4.4/xga/sourcetools/deproj.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sourcetools/entropy.py` & `xga-0.4.4/xga/sourcetools/entropy.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sourcetools/mass.py` & `xga-0.4.4/xga/sourcetools/mass.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sourcetools/match.py` & `xga-0.4.4/xga/sourcetools/match.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sourcetools/misc.py` & `xga-0.4.4/xga/sourcetools/misc.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sourcetools/stack.py` & `xga-0.4.4/xga/sourcetools/stack.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/sourcetools/temperature.py` & `xga-0.4.4/xga/sourcetools/temperature.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/tools/clusters/LT.py` & `xga-0.4.4/xga/tools/clusters/LT.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 #  This code is a part of X-ray: Generate and Analyse (XGA), a module designed for the XMM Cluster Survey (XCS).
-#  Last modified by David J Turner (turne540@msu.edu) 30/11/2023, 21:30. Copyright (c) The Contributors
+#  Last modified by David J Turner (turne540@msu.edu) 27/02/2024, 09:52. Copyright (c) The Contributors
 from typing import Tuple
 from warnings import warn
 
 import numpy as np
 import pandas as pd
 from astropy.cosmology import Cosmology
 from astropy.units import Quantity, Unit, UnitConversionError
@@ -26,15 +26,16 @@
                                     min_iter: int = 3, max_iter: int = 10, rad_temp_rel: ScalingRelation = arnaud_r500,
                                     lum_en: Quantity = Quantity([[0.5, 2.0], [0.01, 100.0]], "keV"),
                                     core_excised: bool = False, freeze_nh: bool = True, freeze_met: bool = True,
                                     freeze_temp: bool = False, start_temp: Quantity = Quantity(3.0, 'keV'),
                                     temp_lum_rel: ScalingRelation = xcs_sdss_r500_52_TL,
                                     lo_en: Quantity = Quantity(0.3, "keV"), hi_en: Quantity = Quantity(7.9, "keV"),
                                     group_spec: bool = True, min_counts: int = 5, min_sn: float = None,
-                                    over_sample: float = None, save_samp_results_path: str = None,
+                                    over_sample: float = None, back_inn_rad_factor: float = 1.05,
+                                    back_out_rad_factor: float = 1.5, save_samp_results_path: str = None,
                                     save_rad_history_path: str = None, cosmo: Cosmology = DEFAULT_COSMO,
                                     timeout: Quantity = Quantity(1, 'hr'), num_cores: int = NUM_CORES) \
         -> Tuple[ClusterSample, pd.DataFrame, pd.DataFrame]:
     """
     This is the XGA pipeline for measuring overdensity radii, and the temperatures and luminosities within the
     radii, for a sample of clusters. No knowledge of the overdensity radii of the clusters is required
     beforehand, only the position and redshift of the objects. A name is also required for each of them.
@@ -109,14 +110,18 @@
     :param bool group_spec: A boolean flag that sets whether generated spectra are grouped or not.
     :param float min_counts: If generating a grouped spectrum, this is the minimum number of counts per channel.
         To disable minimum counts set this parameter to None.
     :param float min_sn: If generating a grouped spectrum, this is the minimum signal to noise in each channel.
         To disable minimum signal to noise set this parameter to None.
     :param float over_sample: The minimum energy resolution for each group, set to None to disable. e.g. if
         over_sample=3 then the minimum width of a group is 1/3 of the resolution FWHM at that energy.
+    :param float back_inn_rad_factor: This factor is multiplied by an analysis region radius, and gives the inner
+        radius for the background region. Default is 1.05.
+    :param float back_out_rad_factor: This factor is multiplied by an analysis region radius, and gives the outer
+        radius for the background region. Default is 1.5.
     :param str save_samp_results_path: The path to save the final results (temperatures, luminosities, radii) to.
         The default is None, in which case no file will be created. This information is also returned from this
         function.
     :param str save_rad_history_path: The path to save the radii history for all clusters. This specifies what the
         estimated radius was for each cluster at each iteration step, in kpc. The default is None, in which case no
         file will be created. This information is also returned from this function.
     :param Cosmology cosmo: The cosmology to use for sample declaration, and thus for all analysis. The default
@@ -243,15 +248,16 @@
     # Keeps track of the current iteration number
     iter_num = 0
 
     # Set up the ClusterSample to be used for this process (I did consider setting up a new one each time but that
     #  adds overhead, and I think that this way should work fine).
     samp = ClusterSample(sample_data['ra'].values, sample_data['dec'].values, sample_data['redshift'].values,
                          sample_data['name'].values, use_peak=use_peak, peak_find_method=peak_find_method,
-                         clean_obs_threshold=0.7, clean_obs_reg=o_dens, load_fits=False, cosmology=cosmo, **o_dens_arg)
+                         clean_obs_threshold=0.7, clean_obs_reg=o_dens, load_fits=False, cosmology=cosmo,
+                         back_inn_rad_factor=back_inn_rad_factor, back_out_rad_factor=back_out_rad_factor, **o_dens_arg)
 
     # As it is possible some clusters in the sample_data dataframe don't actually have X-ray data, we copy
     #  the sample_data and cut it down, so it only contains entries for clusters that were loaded in the sample at the
     #  beginning of this process
     loaded_samp_data = sample_data.copy()
     loaded_samp_data = loaded_samp_data[loaded_samp_data['name'].isin(samp.names)]
 
@@ -259,14 +265,20 @@
     acc_rad = np.full(len(samp), False)
 
     # In this dictionary we're going to keep a record of the radius history for all clusters for each step. The
     #  keys are names, and the initial setup will have the start aperture as the first entry in the list of
     #  radii for each cluster
     rad_hist = {n: [start_aperture.value] for n in samp.names}
 
+    # This will hopefully be eventually replaced with GalaxyCluster instances storing their own overdensity radius
+    #  errors, but for now we use a quantity to keep track of the uncertainties we calculate for the radii. We
+    #  initially set it up as None because then we can create an appropriately sized quantity after the first run
+    #  of spectrum generation, taking into account any systems that failed for some reason
+    cur_rad_errs = None
+
     # This while loop (never thought I'd be using one of them in XGA!) will keep going either until all radii have been
     #  accepted OR until we reach the maximum number  of iterations
     while acc_rad.sum() != len(samp) and iter_num < max_iter:
         # We have a try-except looking for SAS generation errors - they will only be thrown once all the spectrum
         #  generation processes have finished, so we know that the spectra that didn't throw an error exist and
         #  are fine
         try:
@@ -316,34 +328,54 @@
                          over_sample=over_sample, one_rmf=False, num_cores=num_cores, timeout=timeout,
                          start_temp=start_temp, freeze_temp=freeze_temp)
 
         # This is for the standard use of this pipeline, where the temperature has been allowed to vary during the
         #  spectral fit - as such we are reading out the measured temperatures here
         if not freeze_temp:
             # Just reading out the temperatures, not the uncertainties at the moment
-            txs = samp.Tx(samp.get_radius(o_dens), quality_checks=False, group_spec=group_spec, min_counts=min_counts,
-                          min_sn=min_sn, over_sample=over_sample)[:, 0]
+            tx_all = samp.Tx(samp.get_radius(o_dens), quality_checks=False, group_spec=group_spec, min_counts=min_counts,
+                             min_sn=min_sn, over_sample=over_sample)
+            txs = tx_all[:, 0]
+            tx_errs = tx_all[:, 1]
         # But, if the pipeline has been run in frozen temperature mode then there ARE no temperatures to read out, so
         #  the temperature-luminosity scaling relation has to step in for us, and we just need to read out Lxs
         else:
-            lxs = samp.Lx(samp.get_radius(o_dens), quality_checks=False, group_spec=group_spec, min_counts=min_counts,
-                          min_sn=min_sn, over_sample=over_sample, lo_en=rel_lum_bounds[0],
-                          hi_en=rel_lum_bounds[1])[:, 0]
-            txs = temp_lum_rel.predict(lxs, samp.redshifts, cosmo)
+            lx_all = samp.Lx(samp.get_radius(o_dens), quality_checks=False, group_spec=group_spec,
+                             min_counts=min_counts, min_sn=min_sn, over_sample=over_sample, lo_en=rel_lum_bounds[0],
+                             hi_en=rel_lum_bounds[1])
+            lxs = lx_all[:, 0]
+            lx_errs = lx_all[:, 1:]
+            # We can also propagate errors in the predict method - so we pass the lx_errs
+            tx_all = temp_lum_rel.predict(lxs, samp.redshifts, cosmo, lx_errs)
+            txs = tx_all[:, 0]
+            tx_errs = tx_all[:, 1]
 
         # This uses the scaling relation to predict the overdensity radius from the measured temperatures
-        pr_rs = rad_temp_rel.predict(txs, samp.redshifts, samp.cosmo)
+        pr_rs_all = rad_temp_rel.predict(txs, samp.redshifts, samp.cosmo, tx_errs)
+        pr_rs = pr_rs_all[:, 0]
+        pr_r_errs = pr_rs_all[:, 1]
 
         # It is possible that some of these radius entries are going to be NaN - the result of NaN temperature values
         #  passed through the 'predict' method of the scaling relation. As such we identify any NaN results and
         #  remove the radii from the pr_rs array as we're going to do the same for the clusters in the sample
         bad_pr_rs = np.where(np.isnan(pr_rs))[0]
         pr_rs = np.delete(pr_rs, bad_pr_rs)
+        pr_r_errs = np.delete(pr_r_errs, bad_pr_rs)
         acc_rad = np.delete(acc_rad, bad_pr_rs)
 
+        # If this is the first iteration then cur_rad_errs will be None, and we need to set up a quantity that is the
+        #  same length as the sample (which could be smaller than it was initially because of spectrum generation
+        #  failures or some such thing)
+        if cur_rad_errs is None:
+            cur_rad_errs = pr_r_errs
+        else:
+            # Have to trim the cur_rad_errs array to match, as we don't currently store overdensity radius errors within
+            #  source classes
+            cur_rad_errs = np.delete(cur_rad_errs, bad_pr_rs)
+
         # I am also actually going to remove the clusters with NaN results from the sample - if the NaN was caused
         #  by something like a fit not converging then it's going to keep trying over and over again and that could
         #  slow everything down.
         # I make sure not to try to remove clusters which I've ALREADY removed further up because their spectral
         #  generation failed.
         for name in samp.names[bad_pr_rs]:
             del samp[name]
@@ -351,18 +383,22 @@
         # There was probably a more elegant way to do this, but if the pipeline is operating in frozen temperature mode
         #  I read out the lxs from the current sample, and convert them into temperature estimations using the
         #  temperature-luminosity scaling relation. Those estimates are set as the start_temp value, and so will be
         #  fed into the next spectral fit as the frozen temperature value
         # This HAS to go here because it is after sources have been deleted from the sample (if any are) and BEFORE
         #  the overdensity radius calculated from this iteration is added to the sources
         if freeze_temp:
-            lxs = samp.Lx(samp.get_radius(o_dens), quality_checks=False, group_spec=group_spec,
-                          min_counts=min_counts, min_sn=min_sn, over_sample=over_sample, lo_en=rel_lum_bounds[0],
-                          hi_en=rel_lum_bounds[1])[:, 0]
-            start_temp = temp_lum_rel.predict(lxs, samp.redshifts, cosmo)
+            all_lx = samp.Lx(samp.get_radius(o_dens), quality_checks=False, group_spec=group_spec,
+                             min_counts=min_counts, min_sn=min_sn, over_sample=over_sample, lo_en=rel_lum_bounds[0],
+                             hi_en=rel_lum_bounds[1])
+            lxs = all_lx[:, 0]
+            lx_errs = all_lx[:, 1]
+            all_start_temp = temp_lum_rel.predict(lxs, samp.redshifts, cosmo, lx_errs)
+            start_temp = all_start_temp[:, 0]
+            start_temp_errs = all_start_temp[:, 1]
 
         # The basis of this method is that we measure a temperature, starting in some user-specified fixed aperture,
         #  and then use that to predict an overdensity radius (something far more useful than a fixed aperture). This
         #  process is repeated until the radius fraction converges to within the user-specified limit.
         # It should also be noted that each cluster is made to iterate at least `min_iter` times, nothing will be
         #  allowed to just accept the first result
         rad_rat = pr_rs / samp.get_radius(o_dens)
@@ -370,14 +406,21 @@
         # Make a copy of the currently set radius values from the sample - these will then be modified with the
         #  new predicted values if the particular cluster's radius isn't already considered 'accepted' - i.e. it
         #  reached the required convergence in a previous iteration
         new_rads = samp.get_radius(o_dens).copy()
         # The clusters which DON'T have previously accepted radii have their radii updated from those predicted from
         #  temperature
         new_rads[~acc_rad] = pr_rs[~acc_rad]
+
+        # Then that process is repeated for the radius errors, which are not currently stored by the GalaxyClusters
+        new_rad_errs = cur_rad_errs.copy()
+        new_rad_errs[~acc_rad] = pr_r_errs[~acc_rad]
+        # Yes I know...
+        cur_rad_errs = new_rad_errs
+
         # Use the new radius value inferred from the temperature + scaling relation and add it to the ClusterSample (or
         #  just re-adding the same value as is already here if that radius has converged and been accepted).
         if o_dens == 'r500':
             samp.r500 = new_rads
         elif o_dens == 'r2500':
             samp.r2500 = new_rads
         elif o_dens == 'r200':
@@ -399,15 +442,15 @@
     if iter_num == max_iter:
         warn("The radius measurement process reached the maximum number of iterations; as such one or more clusters "
              "may have unconverged radii.", stacklevel=2)
 
     # This is probably unnecessary, but rather than rely on ordering staying the same, I am making a lookup
     #  dictionary for the start temperatures IF the pipeline was operating in frozen-temperature mode
     if freeze_temp:
-        start_temp_lookup = {sn: start_temp[sn_ind] for sn_ind, sn in enumerate(samp.names)}
+        start_temp_lookup = {sn: [start_temp[sn_ind], start_temp_errs[sn_ind]] for sn_ind, sn in enumerate(samp.names)}
 
     # At this point we've exited the loop - the final radii have been decided on. However, we cannot guarantee that
     #  the final radii have had spectra generated/fit for them, so we run single_temp_apec again one last time
     single_temp_apec(samp, samp.get_radius(o_dens), lum_en=lum_en, freeze_nh=freeze_nh, freeze_met=freeze_met,
                      lo_en=lo_en, hi_en=hi_en, group_spec=group_spec, min_counts=min_counts, min_sn=min_sn,
                      over_sample=over_sample, one_rmf=False, num_cores=num_cores, start_temp=start_temp,
                      freeze_temp=freeze_temp)
@@ -427,19 +470,20 @@
         # We're iterating through the rows of the sample information passed in, because we want there to be an
         #  entry even if the LT pipeline didn't succeed. As such we have to check if the current row's cluster
         #  is actually still a part of the sample
         if row['name'] in samp.names:
             # Grab the relevant source out of the ClusterSample object
             rel_src = samp[row['name']]
             rel_rad = rel_src.get_radius(o_dens, 'kpc')
+            rel_rad_err = cur_rad_errs[np.where(samp.names == rel_src.name)[0]]
 
             # These will be to store the read-out temperature and luminosity values, and their corresponding
             #  column names for the dataframe - we make sure that the measure radius is present in the data
-            vals = [rel_rad.value]
-            cols = [o_dens]
+            vals = [rel_rad.value, rel_rad_err.value]
+            cols = [o_dens, o_dens + '+-']
 
             # If the user let XGA determine a peak coordinate for the cluster, we will need to add it to the results
             #  as all the spectra for the cluster were generated with that as the central point
             if use_peak:
                 vals += [*rel_src.peak.value]
                 cols += ['peak_ra', 'peak_dec']
 
@@ -457,18 +501,17 @@
                     # We add columns with informative names
                     cols += ['Tx' + o_dens[1:] + p_fix for p_fix in ['', '-', '+']]
 
                 # If operating in frozen-temperature mode however, we can't extract a temperature from the XGA
                 #  sources - instead we use the look-up dictionary for the final temperatures arrived at by feeding
                 #  the luminosity into a temperature-luminosity relation.
                 else:
-                    # I am going to make a distinction in the column name for temperatures arrived at by this
-                    #  route - there are also currently no uncertainties
-                    vals += [start_temp_lookup[rel_src.name].value]
-                    cols += ['froz_Tx' + o_dens[1:]]
+                    # Will make a distinction in the column name for temperatures arrived at by this route
+                    vals += [start_temp_lookup[rel_src.name][0].value, start_temp_lookup[rel_src.name][1].value]
+                    cols += ['froz_Tx' + o_dens[1:], 'froz_Tx' + o_dens[1:] + '+-']
 
                 # Cycle through every available luminosity, this will return all luminosities in all energy bands
                 #  requested by the user with lum_en
                 for lum_name, lum in rel_src.get_luminosities(rel_rad, group_spec=group_spec,
                                                               min_counts=min_counts, min_sn=min_sn,
                                                               over_sample=over_sample).items():
                     # The luminosity and its uncertainties gets added to the values list
```

### Comparing `xga-0.4.3/xga/utils.py` & `xga-0.4.4/xga/utils.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec/fakeit.py` & `xga-0.4.4/xga/xspec/fakeit.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec/fit/_common.py` & `xga-0.4.4/xga/xspec/fit/_common.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec/fit/general.py` & `xga-0.4.4/xga/xspec/fit/general.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec/fit/profile.py` & `xga-0.4.4/xga/xspec/fit/profile.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec/run.py` & `xga-0.4.4/xga/xspec/run.py`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec_scripts/cr_conv_calc.xcm` & `xga-0.4.4/xga/xspec_scripts/cr_conv_calc.xcm`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec_scripts/crossarf_xspec_fit.xcm` & `xga-0.4.4/xga/xspec_scripts/crossarf_xspec_fit.xcm`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec_scripts/general_xspec_fit.xcm` & `xga-0.4.4/xga/xspec_scripts/general_xspec_fit.xcm`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec_scripts/get_pars.tcl` & `xga-0.4.4/xga/xspec_scripts/get_pars.tcl`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga/xspec_scripts/xga_extract.tcl` & `xga-0.4.4/xga/xspec_scripts/xga_extract.tcl`

 * *Files identical despite different names*

### Comparing `xga-0.4.3/xga.egg-info/PKG-INFO` & `xga-0.4.4/xga.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: xga
-Version: 0.4.3
+Version: 0.4.4
 Summary: Python package to easily generate and analyse XMM data products
 Home-page: http://github.com/DavidT3/XGA
 Author: David Turner
 Author-email: david.turner@sussex.ac.uk
 License: UNKNOWN
 Description: <p align="center">
             <img src="https://raw.githubusercontent.com/DavidT3/XGA/master/xga/files/long_xga_logo.png" width="500">
```

### Comparing `xga-0.4.3/xga.egg-info/SOURCES.txt` & `xga-0.4.4/xga.egg-info/SOURCES.txt`

 * *Files 1% similar despite different names*

```diff
@@ -50,14 +50,15 @@
 xga/relations/fit.py
 xga/relations/clusters/LT.py
 xga/relations/clusters/Lλ.py
 xga/relations/clusters/MT.py
 xga/relations/clusters/Mλ.py
 xga/relations/clusters/RT.py
 xga/relations/clusters/TL.py
+xga/relations/clusters/Tλ.py
 xga/relations/clusters/__init__.py
 xga/samples/__init__.py
 xga/samples/base.py
 xga/samples/extended.py
 xga/samples/general.py
 xga/samples/point.py
 xga/sas/__init__.py
```

