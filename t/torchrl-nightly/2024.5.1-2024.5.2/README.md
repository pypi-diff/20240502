# Comparing `tmp/torchrl_nightly-2024.5.1-cp39-cp39-win_amd64.whl.zip` & `tmp/torchrl_nightly-2024.5.2-cp39-cp39-win_amd64.whl.zip`

## zipinfo {}

```diff
@@ -1,162 +1,162 @@
-Zip file size: 901974 bytes, number of entries: 160
--rw-rw-rw-  2.0 fat      183 b- defN 24-May-01 11:18 build_tools/__init__.py
--rw-rw-rw-  2.0 fat      245 b- defN 24-May-01 11:18 build_tools/setup_helpers/__init__.py
--rw-rw-rw-  2.0 fat     6085 b- defN 24-May-01 11:18 build_tools/setup_helpers/extension.py
--rw-rw-rw-  2.0 fat     1452 b- defN 24-May-01 11:18 torchrl/__init__.py
--rw-rw-rw-  2.0 fat     1240 b- defN 24-May-01 11:18 torchrl/_extension.py
--rw-rw-rw-  2.0 fat   373760 b- defN 24-May-01 11:20 torchrl/_torchrl.pyd
--rw-rw-rw-  2.0 fat    26867 b- defN 24-May-01 11:18 torchrl/_utils.py
--rw-rw-rw-  2.0 fat       84 b- defN 24-May-01 11:19 torchrl/version.py
--rw-rw-rw-  2.0 fat      394 b- defN 24-May-01 11:18 torchrl/collectors/__init__.py
--rw-rw-rw-  2.0 fat   134396 b- defN 24-May-01 11:18 torchrl/collectors/collectors.py
--rw-rw-rw-  2.0 fat     8610 b- defN 24-May-01 11:18 torchrl/collectors/utils.py
--rw-rw-rw-  2.0 fat      412 b- defN 24-May-01 11:18 torchrl/collectors/distributed/__init__.py
--rw-rw-rw-  2.0 fat      674 b- defN 24-May-01 11:18 torchrl/collectors/distributed/default_configs.py
--rw-rw-rw-  2.0 fat    40438 b- defN 24-May-01 11:18 torchrl/collectors/distributed/generic.py
--rw-rw-rw-  2.0 fat    33423 b- defN 24-May-01 11:18 torchrl/collectors/distributed/ray.py
--rw-rw-rw-  2.0 fat    34183 b- defN 24-May-01 11:18 torchrl/collectors/distributed/rpc.py
--rw-rw-rw-  2.0 fat    26560 b- defN 24-May-01 11:18 torchrl/collectors/distributed/sync.py
--rw-rw-rw-  2.0 fat     6402 b- defN 24-May-01 11:18 torchrl/collectors/distributed/utils.py
--rw-rw-rw-  2.0 fat     1653 b- defN 24-May-01 11:18 torchrl/data/__init__.py
--rw-rw-rw-  2.0 fat   171719 b- defN 24-May-01 11:18 torchrl/data/tensor_specs.py
--rw-rw-rw-  2.0 fat    12387 b- defN 24-May-01 11:18 torchrl/data/utils.py
--rw-rw-rw-  2.0 fat      593 b- defN 24-May-01 11:18 torchrl/data/datasets/__init__.py
--rw-rw-rw-  2.0 fat    41201 b- defN 24-May-01 11:18 torchrl/data/datasets/atari_dqn.py
--rw-rw-rw-  2.0 fat    16294 b- defN 24-May-01 11:18 torchrl/data/datasets/common.py
--rw-rw-rw-  2.0 fat    20080 b- defN 24-May-01 11:18 torchrl/data/datasets/d4rl.py
--rw-rw-rw-  2.0 fat    22721 b- defN 24-May-01 11:18 torchrl/data/datasets/d4rl_infos.py
--rw-rw-rw-  2.0 fat    14633 b- defN 24-May-01 11:18 torchrl/data/datasets/gen_dgrl.py
--rw-rw-rw-  2.0 fat    21337 b- defN 24-May-01 11:18 torchrl/data/datasets/minari_data.py
--rw-rw-rw-  2.0 fat     7190 b- defN 24-May-01 11:18 torchrl/data/datasets/openml.py
--rw-rw-rw-  2.0 fat    33991 b- defN 24-May-01 11:18 torchrl/data/datasets/openx.py
--rw-rw-rw-  2.0 fat    17017 b- defN 24-May-01 11:18 torchrl/data/datasets/roboset.py
--rw-rw-rw-  2.0 fat      312 b- defN 24-May-01 11:18 torchrl/data/datasets/utils.py
--rw-rw-rw-  2.0 fat    18687 b- defN 24-May-01 11:18 torchrl/data/datasets/vd4rl.py
--rw-rw-rw-  2.0 fat      219 b- defN 24-May-01 11:18 torchrl/data/postprocs/__init__.py
--rw-rw-rw-  2.0 fat    11627 b- defN 24-May-01 11:18 torchrl/data/postprocs/postprocs.py
--rw-rw-rw-  2.0 fat      953 b- defN 24-May-01 11:18 torchrl/data/replay_buffers/__init__.py
--rw-rw-rw-  2.0 fat    76136 b- defN 24-May-01 11:18 torchrl/data/replay_buffers/replay_buffers.py
--rw-rw-rw-  2.0 fat    87065 b- defN 24-May-01 11:18 torchrl/data/replay_buffers/samplers.py
--rw-rw-rw-  2.0 fat    58160 b- defN 24-May-01 11:18 torchrl/data/replay_buffers/storages.py
--rw-rw-rw-  2.0 fat     2954 b- defN 24-May-01 11:18 torchrl/data/replay_buffers/utils.py
--rw-rw-rw-  2.0 fat    24261 b- defN 24-May-01 11:18 torchrl/data/replay_buffers/writers.py
--rw-rw-rw-  2.0 fat      508 b- defN 24-May-01 11:18 torchrl/data/rlhf/__init__.py
--rw-rw-rw-  2.0 fat    20989 b- defN 24-May-01 11:18 torchrl/data/rlhf/dataset.py
--rw-rw-rw-  2.0 fat     8617 b- defN 24-May-01 11:18 torchrl/data/rlhf/prompt.py
--rw-rw-rw-  2.0 fat     8668 b- defN 24-May-01 11:18 torchrl/data/rlhf/reward.py
--rw-rw-rw-  2.0 fat    24134 b- defN 24-May-01 11:18 torchrl/data/rlhf/utils.py
--rw-rw-rw-  2.0 fat     2482 b- defN 24-May-01 11:18 torchrl/envs/__init__.py
--rw-rw-rw-  2.0 fat    85060 b- defN 24-May-01 11:18 torchrl/envs/batched_envs.py
--rw-rw-rw-  2.0 fat   134853 b- defN 24-May-01 11:18 torchrl/envs/common.py
--rw-rw-rw-  2.0 fat     7661 b- defN 24-May-01 11:18 torchrl/envs/env_creator.py
--rw-rw-rw-  2.0 fat    21850 b- defN 24-May-01 11:18 torchrl/envs/gym_like.py
--rw-rw-rw-  2.0 fat    68344 b- defN 24-May-01 11:18 torchrl/envs/utils.py
--rw-rw-rw-  2.0 fat      339 b- defN 24-May-01 11:18 torchrl/envs/vec_envs.py
--rw-rw-rw-  2.0 fat      874 b- defN 24-May-01 11:18 torchrl/envs/libs/__init__.py
--rw-rw-rw-  2.0 fat    10400 b- defN 24-May-01 11:18 torchrl/envs/libs/_gym_utils.py
--rw-rw-rw-  2.0 fat    24078 b- defN 24-May-01 11:18 torchrl/envs/libs/brax.py
--rw-rw-rw-  2.0 fat    20968 b- defN 24-May-01 11:18 torchrl/envs/libs/dm_control.py
--rw-rw-rw-  2.0 fat    16723 b- defN 24-May-01 11:18 torchrl/envs/libs/envpool.py
--rw-rw-rw-  2.0 fat    62433 b- defN 24-May-01 11:18 torchrl/envs/libs/gym.py
--rw-rw-rw-  2.0 fat     5437 b- defN 24-May-01 11:18 torchrl/envs/libs/habitat.py
--rw-rw-rw-  2.0 fat     6954 b- defN 24-May-01 11:18 torchrl/envs/libs/isaacgym.py
--rw-rw-rw-  2.0 fat     5333 b- defN 24-May-01 11:18 torchrl/envs/libs/jax_utils.py
--rw-rw-rw-  2.0 fat    38178 b- defN 24-May-01 11:18 torchrl/envs/libs/jumanji.py
--rw-rw-rw-  2.0 fat    26778 b- defN 24-May-01 11:18 torchrl/envs/libs/meltingpot.py
--rw-rw-rw-  2.0 fat     6019 b- defN 24-May-01 11:18 torchrl/envs/libs/openml.py
--rw-rw-rw-  2.0 fat    47103 b- defN 24-May-01 11:18 torchrl/envs/libs/pettingzoo.py
--rw-rw-rw-  2.0 fat    16194 b- defN 24-May-01 11:18 torchrl/envs/libs/robohive.py
--rw-rw-rw-  2.0 fat    29939 b- defN 24-May-01 11:18 torchrl/envs/libs/smacv2.py
--rw-rw-rw-  2.0 fat     5316 b- defN 24-May-01 11:18 torchrl/envs/libs/utils.py
--rw-rw-rw-  2.0 fat    36083 b- defN 24-May-01 11:18 torchrl/envs/libs/vmas.py
--rw-rw-rw-  2.0 fat      273 b- defN 24-May-01 11:18 torchrl/envs/model_based/__init__.py
--rw-rw-rw-  2.0 fat     7907 b- defN 24-May-01 11:18 torchrl/envs/model_based/common.py
--rw-rw-rw-  2.0 fat     3487 b- defN 24-May-01 11:18 torchrl/envs/model_based/dreamer.py
--rw-rw-rw-  2.0 fat     1473 b- defN 24-May-01 11:18 torchrl/envs/transforms/__init__.py
--rw-rw-rw-  2.0 fat     1485 b- defN 24-May-01 11:18 torchrl/envs/transforms/functional.py
--rw-rw-rw-  2.0 fat    10062 b- defN 24-May-01 11:18 torchrl/envs/transforms/gym_transforms.py
--rw-rw-rw-  2.0 fat    13933 b- defN 24-May-01 11:18 torchrl/envs/transforms/r3m.py
--rw-rw-rw-  2.0 fat     7684 b- defN 24-May-01 11:18 torchrl/envs/transforms/rb_transforms.py
--rw-rw-rw-  2.0 fat    10085 b- defN 24-May-01 11:18 torchrl/envs/transforms/rlhf.py
--rw-rw-rw-  2.0 fat   343262 b- defN 24-May-01 11:18 torchrl/envs/transforms/transforms.py
--rw-rw-rw-  2.0 fat     2094 b- defN 24-May-01 11:18 torchrl/envs/transforms/utils.py
--rw-rw-rw-  2.0 fat    10883 b- defN 24-May-01 11:18 torchrl/envs/transforms/vc1.py
--rw-rw-rw-  2.0 fat    15290 b- defN 24-May-01 11:18 torchrl/envs/transforms/vip.py
--rw-rw-rw-  2.0 fat     1903 b- defN 24-May-01 11:18 torchrl/modules/__init__.py
--rw-rw-rw-  2.0 fat      681 b- defN 24-May-01 11:18 torchrl/modules/distributions/__init__.py
--rw-rw-rw-  2.0 fat    21547 b- defN 24-May-01 11:18 torchrl/modules/distributions/continuous.py
--rw-rw-rw-  2.0 fat    17803 b- defN 24-May-01 11:18 torchrl/modules/distributions/discrete.py
--rw-rw-rw-  2.0 fat     6123 b- defN 24-May-01 11:18 torchrl/modules/distributions/truncated_normal.py
--rw-rw-rw-  2.0 fat     6115 b- defN 24-May-01 11:18 torchrl/modules/distributions/utils.py
--rw-rw-rw-  2.0 fat      884 b- defN 24-May-01 11:18 torchrl/modules/models/__init__.py
--rw-rw-rw-  2.0 fat     6727 b- defN 24-May-01 11:18 torchrl/modules/models/decision_transformer.py
--rw-rw-rw-  2.0 fat    21920 b- defN 24-May-01 11:18 torchrl/modules/models/exploration.py
--rw-rw-rw-  2.0 fat    14291 b- defN 24-May-01 11:18 torchrl/modules/models/model_based.py
--rw-rw-rw-  2.0 fat    66963 b- defN 24-May-01 11:18 torchrl/modules/models/models.py
--rw-rw-rw-  2.0 fat    37131 b- defN 24-May-01 11:18 torchrl/modules/models/multiagent.py
--rw-rw-rw-  2.0 fat     6520 b- defN 24-May-01 11:18 torchrl/modules/models/rlhf.py
--rw-rw-rw-  2.0 fat     5221 b- defN 24-May-01 11:18 torchrl/modules/models/utils.py
--rw-rw-rw-  2.0 fat      281 b- defN 24-May-01 11:18 torchrl/modules/planners/__init__.py
--rw-rw-rw-  2.0 fat     9784 b- defN 24-May-01 11:18 torchrl/modules/planners/cem.py
--rw-rw-rw-  2.0 fat     2451 b- defN 24-May-01 11:18 torchrl/modules/planners/common.py
--rw-rw-rw-  2.0 fat    11047 b- defN 24-May-01 11:18 torchrl/modules/planners/mppi.py
--rw-rw-rw-  2.0 fat     1056 b- defN 24-May-01 11:18 torchrl/modules/tensordict_module/__init__.py
--rw-rw-rw-  2.0 fat   105738 b- defN 24-May-01 11:18 torchrl/modules/tensordict_module/actors.py
--rw-rw-rw-  2.0 fat    21933 b- defN 24-May-01 11:18 torchrl/modules/tensordict_module/common.py
--rw-rw-rw-  2.0 fat    30492 b- defN 24-May-01 11:18 torchrl/modules/tensordict_module/exploration.py
--rw-rw-rw-  2.0 fat    12045 b- defN 24-May-01 11:18 torchrl/modules/tensordict_module/probabilistic.py
--rw-rw-rw-  2.0 fat    57588 b- defN 24-May-01 11:18 torchrl/modules/tensordict_module/rnn.py
--rw-rw-rw-  2.0 fat     5804 b- defN 24-May-01 11:18 torchrl/modules/tensordict_module/sequence.py
--rw-rw-rw-  2.0 fat     1360 b- defN 24-May-01 11:18 torchrl/modules/tensordict_module/world_models.py
--rw-rw-rw-  2.0 fat     1046 b- defN 24-May-01 11:18 torchrl/modules/utils/__init__.py
--rw-rw-rw-  2.0 fat     2435 b- defN 24-May-01 11:18 torchrl/modules/utils/mappings.py
--rw-rw-rw-  2.0 fat        0 b- defN 24-May-01 11:18 torchrl/modules/utils/utils.py
--rw-rw-rw-  2.0 fat     1047 b- defN 24-May-01 11:18 torchrl/objectives/__init__.py
--rw-rw-rw-  2.0 fat    24345 b- defN 24-May-01 11:18 torchrl/objectives/a2c.py
--rw-rw-rw-  2.0 fat    20668 b- defN 24-May-01 11:18 torchrl/objectives/common.py
--rw-rw-rw-  2.0 fat    53644 b- defN 24-May-01 11:18 torchrl/objectives/cql.py
--rw-rw-rw-  2.0 fat    17227 b- defN 24-May-01 11:18 torchrl/objectives/ddpg.py
--rw-rw-rw-  2.0 fat    12662 b- defN 24-May-01 11:18 torchrl/objectives/decision_transformer.py
--rw-rw-rw-  2.0 fat    19010 b- defN 24-May-01 11:18 torchrl/objectives/deprecated.py
--rw-rw-rw-  2.0 fat    28303 b- defN 24-May-01 11:18 torchrl/objectives/dqn.py
--rw-rw-rw-  2.0 fat    18156 b- defN 24-May-01 11:18 torchrl/objectives/dreamer.py
--rw-rw-rw-  2.0 fat     2155 b- defN 24-May-01 11:18 torchrl/objectives/functional.py
--rw-rw-rw-  2.0 fat    39036 b- defN 24-May-01 11:18 torchrl/objectives/iql.py
--rw-rw-rw-  2.0 fat    51682 b- defN 24-May-01 11:18 torchrl/objectives/ppo.py
--rw-rw-rw-  2.0 fat    27125 b- defN 24-May-01 11:18 torchrl/objectives/redq.py
--rw-rw-rw-  2.0 fat    21557 b- defN 24-May-01 11:18 torchrl/objectives/reinforce.py
--rw-rw-rw-  2.0 fat    56606 b- defN 24-May-01 11:18 torchrl/objectives/sac.py
--rw-rw-rw-  2.0 fat    21944 b- defN 24-May-01 11:18 torchrl/objectives/td3.py
--rw-rw-rw-  2.0 fat    19336 b- defN 24-May-01 11:18 torchrl/objectives/utils.py
--rw-rw-rw-  2.0 fat      217 b- defN 24-May-01 11:18 torchrl/objectives/multiagent/__init__.py
--rw-rw-rw-  2.0 fat    17154 b- defN 24-May-01 11:18 torchrl/objectives/multiagent/qmixer.py
--rw-rw-rw-  2.0 fat      384 b- defN 24-May-01 11:18 torchrl/objectives/value/__init__.py
--rw-rw-rw-  2.0 fat    77377 b- defN 24-May-01 11:18 torchrl/objectives/value/advantages.py
--rw-rw-rw-  2.0 fat    50043 b- defN 24-May-01 11:18 torchrl/objectives/value/functional.py
--rw-rw-rw-  2.0 fat      317 b- defN 24-May-01 11:18 torchrl/objectives/value/pg.py
--rw-rw-rw-  2.0 fat    13444 b- defN 24-May-01 11:18 torchrl/objectives/value/utils.py
--rw-rw-rw-  2.0 fat      342 b- defN 24-May-01 11:18 torchrl/record/__init__.py
--rw-rw-rw-  2.0 fat    22236 b- defN 24-May-01 11:18 torchrl/record/recorder.py
--rw-rw-rw-  2.0 fat      405 b- defN 24-May-01 11:18 torchrl/record/loggers/__init__.py
--rw-rw-rw-  2.0 fat     1182 b- defN 24-May-01 11:18 torchrl/record/loggers/common.py
--rw-rw-rw-  2.0 fat     8232 b- defN 24-May-01 11:18 torchrl/record/loggers/csv.py
--rw-rw-rw-  2.0 fat     4600 b- defN 24-May-01 11:18 torchrl/record/loggers/mlflow.py
--rw-rw-rw-  2.0 fat     4944 b- defN 24-May-01 11:18 torchrl/record/loggers/tensorboard.py
--rw-rw-rw-  2.0 fat     2398 b- defN 24-May-01 11:18 torchrl/record/loggers/utils.py
--rw-rw-rw-  2.0 fat     7974 b- defN 24-May-01 11:18 torchrl/record/loggers/wandb.py
--rw-rw-rw-  2.0 fat      467 b- defN 24-May-01 11:18 torchrl/trainers/__init__.py
--rw-rw-rw-  2.0 fat    51838 b- defN 24-May-01 11:18 torchrl/trainers/trainers.py
--rw-rw-rw-  2.0 fat      701 b- defN 24-May-01 11:18 torchrl/trainers/helpers/__init__.py
--rw-rw-rw-  2.0 fat    19326 b- defN 24-May-01 11:18 torchrl/trainers/helpers/collectors.py
--rw-rw-rw-  2.0 fat    22336 b- defN 24-May-01 11:18 torchrl/trainers/helpers/envs.py
--rw-rw-rw-  2.0 fat     1275 b- defN 24-May-01 11:18 torchrl/trainers/helpers/logger.py
--rw-rw-rw-  2.0 fat     5389 b- defN 24-May-01 11:18 torchrl/trainers/helpers/losses.py
--rw-rw-rw-  2.0 fat    22664 b- defN 24-May-01 11:18 torchrl/trainers/helpers/models.py
--rw-rw-rw-  2.0 fat     1985 b- defN 24-May-01 11:18 torchrl/trainers/helpers/replay_buffer.py
--rw-rw-rw-  2.0 fat    12385 b- defN 24-May-01 11:18 torchrl/trainers/helpers/trainers.py
--rw-rw-rw-  2.0 fat     1119 b- defN 24-May-01 11:20 torchrl_nightly-2024.5.1.dist-info/LICENSE
--rw-rw-rw-  2.0 fat    32621 b- defN 24-May-01 11:20 torchrl_nightly-2024.5.1.dist-info/METADATA
--rw-rw-rw-  2.0 fat      100 b- defN 24-May-01 11:20 torchrl_nightly-2024.5.1.dist-info/WHEEL
--rw-rw-rw-  2.0 fat       20 b- defN 24-May-01 11:20 torchrl_nightly-2024.5.1.dist-info/top_level.txt
--rw-rw-r--  2.0 fat    14366 b- defN 24-May-01 11:20 torchrl_nightly-2024.5.1.dist-info/RECORD
-160 files, 3836064 bytes uncompressed, 879310 bytes compressed:  77.1%
+Zip file size: 902210 bytes, number of entries: 160
+-rw-rw-rw-  2.0 fat      183 b- defN 24-May-02 11:18 build_tools/__init__.py
+-rw-rw-rw-  2.0 fat      245 b- defN 24-May-02 11:18 build_tools/setup_helpers/__init__.py
+-rw-rw-rw-  2.0 fat     6085 b- defN 24-May-02 11:18 build_tools/setup_helpers/extension.py
+-rw-rw-rw-  2.0 fat     1452 b- defN 24-May-02 11:18 torchrl/__init__.py
+-rw-rw-rw-  2.0 fat     1240 b- defN 24-May-02 11:18 torchrl/_extension.py
+-rw-rw-rw-  2.0 fat   373760 b- defN 24-May-02 11:21 torchrl/_torchrl.pyd
+-rw-rw-rw-  2.0 fat    26867 b- defN 24-May-02 11:18 torchrl/_utils.py
+-rw-rw-rw-  2.0 fat       84 b- defN 24-May-02 11:20 torchrl/version.py
+-rw-rw-rw-  2.0 fat      394 b- defN 24-May-02 11:18 torchrl/collectors/__init__.py
+-rw-rw-rw-  2.0 fat   134396 b- defN 24-May-02 11:18 torchrl/collectors/collectors.py
+-rw-rw-rw-  2.0 fat     8610 b- defN 24-May-02 11:18 torchrl/collectors/utils.py
+-rw-rw-rw-  2.0 fat      412 b- defN 24-May-02 11:18 torchrl/collectors/distributed/__init__.py
+-rw-rw-rw-  2.0 fat      674 b- defN 24-May-02 11:18 torchrl/collectors/distributed/default_configs.py
+-rw-rw-rw-  2.0 fat    40438 b- defN 24-May-02 11:18 torchrl/collectors/distributed/generic.py
+-rw-rw-rw-  2.0 fat    33423 b- defN 24-May-02 11:18 torchrl/collectors/distributed/ray.py
+-rw-rw-rw-  2.0 fat    34183 b- defN 24-May-02 11:18 torchrl/collectors/distributed/rpc.py
+-rw-rw-rw-  2.0 fat    26560 b- defN 24-May-02 11:18 torchrl/collectors/distributed/sync.py
+-rw-rw-rw-  2.0 fat     6402 b- defN 24-May-02 11:18 torchrl/collectors/distributed/utils.py
+-rw-rw-rw-  2.0 fat     1653 b- defN 24-May-02 11:18 torchrl/data/__init__.py
+-rw-rw-rw-  2.0 fat   171719 b- defN 24-May-02 11:18 torchrl/data/tensor_specs.py
+-rw-rw-rw-  2.0 fat    12387 b- defN 24-May-02 11:18 torchrl/data/utils.py
+-rw-rw-rw-  2.0 fat      593 b- defN 24-May-02 11:18 torchrl/data/datasets/__init__.py
+-rw-rw-rw-  2.0 fat    41201 b- defN 24-May-02 11:18 torchrl/data/datasets/atari_dqn.py
+-rw-rw-rw-  2.0 fat    16294 b- defN 24-May-02 11:18 torchrl/data/datasets/common.py
+-rw-rw-rw-  2.0 fat    20080 b- defN 24-May-02 11:18 torchrl/data/datasets/d4rl.py
+-rw-rw-rw-  2.0 fat    22721 b- defN 24-May-02 11:18 torchrl/data/datasets/d4rl_infos.py
+-rw-rw-rw-  2.0 fat    14633 b- defN 24-May-02 11:18 torchrl/data/datasets/gen_dgrl.py
+-rw-rw-rw-  2.0 fat    21337 b- defN 24-May-02 11:18 torchrl/data/datasets/minari_data.py
+-rw-rw-rw-  2.0 fat     7190 b- defN 24-May-02 11:18 torchrl/data/datasets/openml.py
+-rw-rw-rw-  2.0 fat    33991 b- defN 24-May-02 11:18 torchrl/data/datasets/openx.py
+-rw-rw-rw-  2.0 fat    17017 b- defN 24-May-02 11:18 torchrl/data/datasets/roboset.py
+-rw-rw-rw-  2.0 fat      312 b- defN 24-May-02 11:18 torchrl/data/datasets/utils.py
+-rw-rw-rw-  2.0 fat    18687 b- defN 24-May-02 11:18 torchrl/data/datasets/vd4rl.py
+-rw-rw-rw-  2.0 fat      219 b- defN 24-May-02 11:18 torchrl/data/postprocs/__init__.py
+-rw-rw-rw-  2.0 fat    11627 b- defN 24-May-02 11:18 torchrl/data/postprocs/postprocs.py
+-rw-rw-rw-  2.0 fat      953 b- defN 24-May-02 11:18 torchrl/data/replay_buffers/__init__.py
+-rw-rw-rw-  2.0 fat    76136 b- defN 24-May-02 11:18 torchrl/data/replay_buffers/replay_buffers.py
+-rw-rw-rw-  2.0 fat    87065 b- defN 24-May-02 11:18 torchrl/data/replay_buffers/samplers.py
+-rw-rw-rw-  2.0 fat    58160 b- defN 24-May-02 11:18 torchrl/data/replay_buffers/storages.py
+-rw-rw-rw-  2.0 fat     2954 b- defN 24-May-02 11:18 torchrl/data/replay_buffers/utils.py
+-rw-rw-rw-  2.0 fat    24261 b- defN 24-May-02 11:18 torchrl/data/replay_buffers/writers.py
+-rw-rw-rw-  2.0 fat      508 b- defN 24-May-02 11:18 torchrl/data/rlhf/__init__.py
+-rw-rw-rw-  2.0 fat    20989 b- defN 24-May-02 11:18 torchrl/data/rlhf/dataset.py
+-rw-rw-rw-  2.0 fat     8617 b- defN 24-May-02 11:18 torchrl/data/rlhf/prompt.py
+-rw-rw-rw-  2.0 fat     8668 b- defN 24-May-02 11:18 torchrl/data/rlhf/reward.py
+-rw-rw-rw-  2.0 fat    24134 b- defN 24-May-02 11:18 torchrl/data/rlhf/utils.py
+-rw-rw-rw-  2.0 fat     2482 b- defN 24-May-02 11:18 torchrl/envs/__init__.py
+-rw-rw-rw-  2.0 fat    85060 b- defN 24-May-02 11:18 torchrl/envs/batched_envs.py
+-rw-rw-rw-  2.0 fat   134853 b- defN 24-May-02 11:18 torchrl/envs/common.py
+-rw-rw-rw-  2.0 fat     7661 b- defN 24-May-02 11:18 torchrl/envs/env_creator.py
+-rw-rw-rw-  2.0 fat    21850 b- defN 24-May-02 11:18 torchrl/envs/gym_like.py
+-rw-rw-rw-  2.0 fat    68344 b- defN 24-May-02 11:18 torchrl/envs/utils.py
+-rw-rw-rw-  2.0 fat      339 b- defN 24-May-02 11:18 torchrl/envs/vec_envs.py
+-rw-rw-rw-  2.0 fat      874 b- defN 24-May-02 11:18 torchrl/envs/libs/__init__.py
+-rw-rw-rw-  2.0 fat    10400 b- defN 24-May-02 11:18 torchrl/envs/libs/_gym_utils.py
+-rw-rw-rw-  2.0 fat    24078 b- defN 24-May-02 11:18 torchrl/envs/libs/brax.py
+-rw-rw-rw-  2.0 fat    20968 b- defN 24-May-02 11:18 torchrl/envs/libs/dm_control.py
+-rw-rw-rw-  2.0 fat    16723 b- defN 24-May-02 11:18 torchrl/envs/libs/envpool.py
+-rw-rw-rw-  2.0 fat    62823 b- defN 24-May-02 11:18 torchrl/envs/libs/gym.py
+-rw-rw-rw-  2.0 fat     5437 b- defN 24-May-02 11:18 torchrl/envs/libs/habitat.py
+-rw-rw-rw-  2.0 fat     6954 b- defN 24-May-02 11:18 torchrl/envs/libs/isaacgym.py
+-rw-rw-rw-  2.0 fat     5333 b- defN 24-May-02 11:18 torchrl/envs/libs/jax_utils.py
+-rw-rw-rw-  2.0 fat    38178 b- defN 24-May-02 11:18 torchrl/envs/libs/jumanji.py
+-rw-rw-rw-  2.0 fat    26778 b- defN 24-May-02 11:18 torchrl/envs/libs/meltingpot.py
+-rw-rw-rw-  2.0 fat     6019 b- defN 24-May-02 11:18 torchrl/envs/libs/openml.py
+-rw-rw-rw-  2.0 fat    47103 b- defN 24-May-02 11:18 torchrl/envs/libs/pettingzoo.py
+-rw-rw-rw-  2.0 fat    16194 b- defN 24-May-02 11:18 torchrl/envs/libs/robohive.py
+-rw-rw-rw-  2.0 fat    29939 b- defN 24-May-02 11:18 torchrl/envs/libs/smacv2.py
+-rw-rw-rw-  2.0 fat     5316 b- defN 24-May-02 11:18 torchrl/envs/libs/utils.py
+-rw-rw-rw-  2.0 fat    36083 b- defN 24-May-02 11:18 torchrl/envs/libs/vmas.py
+-rw-rw-rw-  2.0 fat      273 b- defN 24-May-02 11:18 torchrl/envs/model_based/__init__.py
+-rw-rw-rw-  2.0 fat     7907 b- defN 24-May-02 11:18 torchrl/envs/model_based/common.py
+-rw-rw-rw-  2.0 fat     3487 b- defN 24-May-02 11:18 torchrl/envs/model_based/dreamer.py
+-rw-rw-rw-  2.0 fat     1473 b- defN 24-May-02 11:18 torchrl/envs/transforms/__init__.py
+-rw-rw-rw-  2.0 fat     1485 b- defN 24-May-02 11:18 torchrl/envs/transforms/functional.py
+-rw-rw-rw-  2.0 fat    10062 b- defN 24-May-02 11:18 torchrl/envs/transforms/gym_transforms.py
+-rw-rw-rw-  2.0 fat    13933 b- defN 24-May-02 11:18 torchrl/envs/transforms/r3m.py
+-rw-rw-rw-  2.0 fat     7684 b- defN 24-May-02 11:18 torchrl/envs/transforms/rb_transforms.py
+-rw-rw-rw-  2.0 fat    10085 b- defN 24-May-02 11:18 torchrl/envs/transforms/rlhf.py
+-rw-rw-rw-  2.0 fat   343890 b- defN 24-May-02 11:18 torchrl/envs/transforms/transforms.py
+-rw-rw-rw-  2.0 fat     2094 b- defN 24-May-02 11:18 torchrl/envs/transforms/utils.py
+-rw-rw-rw-  2.0 fat    10883 b- defN 24-May-02 11:18 torchrl/envs/transforms/vc1.py
+-rw-rw-rw-  2.0 fat    15290 b- defN 24-May-02 11:18 torchrl/envs/transforms/vip.py
+-rw-rw-rw-  2.0 fat     1903 b- defN 24-May-02 11:18 torchrl/modules/__init__.py
+-rw-rw-rw-  2.0 fat      681 b- defN 24-May-02 11:18 torchrl/modules/distributions/__init__.py
+-rw-rw-rw-  2.0 fat    21427 b- defN 24-May-02 11:18 torchrl/modules/distributions/continuous.py
+-rw-rw-rw-  2.0 fat    17803 b- defN 24-May-02 11:18 torchrl/modules/distributions/discrete.py
+-rw-rw-rw-  2.0 fat     6123 b- defN 24-May-02 11:18 torchrl/modules/distributions/truncated_normal.py
+-rw-rw-rw-  2.0 fat     6115 b- defN 24-May-02 11:18 torchrl/modules/distributions/utils.py
+-rw-rw-rw-  2.0 fat      884 b- defN 24-May-02 11:18 torchrl/modules/models/__init__.py
+-rw-rw-rw-  2.0 fat     6727 b- defN 24-May-02 11:18 torchrl/modules/models/decision_transformer.py
+-rw-rw-rw-  2.0 fat    21920 b- defN 24-May-02 11:18 torchrl/modules/models/exploration.py
+-rw-rw-rw-  2.0 fat    14291 b- defN 24-May-02 11:18 torchrl/modules/models/model_based.py
+-rw-rw-rw-  2.0 fat    66963 b- defN 24-May-02 11:18 torchrl/modules/models/models.py
+-rw-rw-rw-  2.0 fat    37131 b- defN 24-May-02 11:18 torchrl/modules/models/multiagent.py
+-rw-rw-rw-  2.0 fat     6520 b- defN 24-May-02 11:18 torchrl/modules/models/rlhf.py
+-rw-rw-rw-  2.0 fat     5221 b- defN 24-May-02 11:18 torchrl/modules/models/utils.py
+-rw-rw-rw-  2.0 fat      281 b- defN 24-May-02 11:18 torchrl/modules/planners/__init__.py
+-rw-rw-rw-  2.0 fat     9784 b- defN 24-May-02 11:18 torchrl/modules/planners/cem.py
+-rw-rw-rw-  2.0 fat     2451 b- defN 24-May-02 11:18 torchrl/modules/planners/common.py
+-rw-rw-rw-  2.0 fat    11047 b- defN 24-May-02 11:18 torchrl/modules/planners/mppi.py
+-rw-rw-rw-  2.0 fat     1056 b- defN 24-May-02 11:18 torchrl/modules/tensordict_module/__init__.py
+-rw-rw-rw-  2.0 fat   105738 b- defN 24-May-02 11:18 torchrl/modules/tensordict_module/actors.py
+-rw-rw-rw-  2.0 fat    21933 b- defN 24-May-02 11:18 torchrl/modules/tensordict_module/common.py
+-rw-rw-rw-  2.0 fat    30492 b- defN 24-May-02 11:18 torchrl/modules/tensordict_module/exploration.py
+-rw-rw-rw-  2.0 fat    12045 b- defN 24-May-02 11:18 torchrl/modules/tensordict_module/probabilistic.py
+-rw-rw-rw-  2.0 fat    57588 b- defN 24-May-02 11:18 torchrl/modules/tensordict_module/rnn.py
+-rw-rw-rw-  2.0 fat     5804 b- defN 24-May-02 11:18 torchrl/modules/tensordict_module/sequence.py
+-rw-rw-rw-  2.0 fat     1360 b- defN 24-May-02 11:18 torchrl/modules/tensordict_module/world_models.py
+-rw-rw-rw-  2.0 fat     1046 b- defN 24-May-02 11:18 torchrl/modules/utils/__init__.py
+-rw-rw-rw-  2.0 fat     2435 b- defN 24-May-02 11:18 torchrl/modules/utils/mappings.py
+-rw-rw-rw-  2.0 fat        0 b- defN 24-May-02 11:18 torchrl/modules/utils/utils.py
+-rw-rw-rw-  2.0 fat     1047 b- defN 24-May-02 11:18 torchrl/objectives/__init__.py
+-rw-rw-rw-  2.0 fat    24345 b- defN 24-May-02 11:18 torchrl/objectives/a2c.py
+-rw-rw-rw-  2.0 fat    20668 b- defN 24-May-02 11:18 torchrl/objectives/common.py
+-rw-rw-rw-  2.0 fat    53644 b- defN 24-May-02 11:18 torchrl/objectives/cql.py
+-rw-rw-rw-  2.0 fat    17227 b- defN 24-May-02 11:18 torchrl/objectives/ddpg.py
+-rw-rw-rw-  2.0 fat    12662 b- defN 24-May-02 11:18 torchrl/objectives/decision_transformer.py
+-rw-rw-rw-  2.0 fat    19010 b- defN 24-May-02 11:18 torchrl/objectives/deprecated.py
+-rw-rw-rw-  2.0 fat    28303 b- defN 24-May-02 11:18 torchrl/objectives/dqn.py
+-rw-rw-rw-  2.0 fat    18156 b- defN 24-May-02 11:18 torchrl/objectives/dreamer.py
+-rw-rw-rw-  2.0 fat     2155 b- defN 24-May-02 11:18 torchrl/objectives/functional.py
+-rw-rw-rw-  2.0 fat    39036 b- defN 24-May-02 11:18 torchrl/objectives/iql.py
+-rw-rw-rw-  2.0 fat    51682 b- defN 24-May-02 11:18 torchrl/objectives/ppo.py
+-rw-rw-rw-  2.0 fat    27125 b- defN 24-May-02 11:18 torchrl/objectives/redq.py
+-rw-rw-rw-  2.0 fat    21557 b- defN 24-May-02 11:18 torchrl/objectives/reinforce.py
+-rw-rw-rw-  2.0 fat    56606 b- defN 24-May-02 11:18 torchrl/objectives/sac.py
+-rw-rw-rw-  2.0 fat    21944 b- defN 24-May-02 11:18 torchrl/objectives/td3.py
+-rw-rw-rw-  2.0 fat    19336 b- defN 24-May-02 11:18 torchrl/objectives/utils.py
+-rw-rw-rw-  2.0 fat      217 b- defN 24-May-02 11:18 torchrl/objectives/multiagent/__init__.py
+-rw-rw-rw-  2.0 fat    17154 b- defN 24-May-02 11:18 torchrl/objectives/multiagent/qmixer.py
+-rw-rw-rw-  2.0 fat      384 b- defN 24-May-02 11:18 torchrl/objectives/value/__init__.py
+-rw-rw-rw-  2.0 fat    77377 b- defN 24-May-02 11:18 torchrl/objectives/value/advantages.py
+-rw-rw-rw-  2.0 fat    50043 b- defN 24-May-02 11:18 torchrl/objectives/value/functional.py
+-rw-rw-rw-  2.0 fat      317 b- defN 24-May-02 11:18 torchrl/objectives/value/pg.py
+-rw-rw-rw-  2.0 fat    13444 b- defN 24-May-02 11:18 torchrl/objectives/value/utils.py
+-rw-rw-rw-  2.0 fat      342 b- defN 24-May-02 11:18 torchrl/record/__init__.py
+-rw-rw-rw-  2.0 fat    22236 b- defN 24-May-02 11:18 torchrl/record/recorder.py
+-rw-rw-rw-  2.0 fat      405 b- defN 24-May-02 11:18 torchrl/record/loggers/__init__.py
+-rw-rw-rw-  2.0 fat     1182 b- defN 24-May-02 11:18 torchrl/record/loggers/common.py
+-rw-rw-rw-  2.0 fat     8232 b- defN 24-May-02 11:18 torchrl/record/loggers/csv.py
+-rw-rw-rw-  2.0 fat     4600 b- defN 24-May-02 11:18 torchrl/record/loggers/mlflow.py
+-rw-rw-rw-  2.0 fat     4944 b- defN 24-May-02 11:18 torchrl/record/loggers/tensorboard.py
+-rw-rw-rw-  2.0 fat     2398 b- defN 24-May-02 11:18 torchrl/record/loggers/utils.py
+-rw-rw-rw-  2.0 fat     7974 b- defN 24-May-02 11:18 torchrl/record/loggers/wandb.py
+-rw-rw-rw-  2.0 fat      467 b- defN 24-May-02 11:18 torchrl/trainers/__init__.py
+-rw-rw-rw-  2.0 fat    51838 b- defN 24-May-02 11:18 torchrl/trainers/trainers.py
+-rw-rw-rw-  2.0 fat      701 b- defN 24-May-02 11:18 torchrl/trainers/helpers/__init__.py
+-rw-rw-rw-  2.0 fat    19326 b- defN 24-May-02 11:18 torchrl/trainers/helpers/collectors.py
+-rw-rw-rw-  2.0 fat    22336 b- defN 24-May-02 11:18 torchrl/trainers/helpers/envs.py
+-rw-rw-rw-  2.0 fat     1275 b- defN 24-May-02 11:18 torchrl/trainers/helpers/logger.py
+-rw-rw-rw-  2.0 fat     5389 b- defN 24-May-02 11:18 torchrl/trainers/helpers/losses.py
+-rw-rw-rw-  2.0 fat    22664 b- defN 24-May-02 11:18 torchrl/trainers/helpers/models.py
+-rw-rw-rw-  2.0 fat     1985 b- defN 24-May-02 11:18 torchrl/trainers/helpers/replay_buffer.py
+-rw-rw-rw-  2.0 fat    12385 b- defN 24-May-02 11:18 torchrl/trainers/helpers/trainers.py
+-rw-rw-rw-  2.0 fat     1119 b- defN 24-May-02 11:21 torchrl_nightly-2024.5.2.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat    32621 b- defN 24-May-02 11:21 torchrl_nightly-2024.5.2.dist-info/METADATA
+-rw-rw-rw-  2.0 fat      100 b- defN 24-May-02 11:21 torchrl_nightly-2024.5.2.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat       20 b- defN 24-May-02 11:21 torchrl_nightly-2024.5.2.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat    14366 b- defN 24-May-02 11:21 torchrl_nightly-2024.5.2.dist-info/RECORD
+160 files, 3836962 bytes uncompressed, 879546 bytes compressed:  77.1%
```

## zipnote {}

```diff
@@ -459,23 +459,23 @@
 
 Filename: torchrl/trainers/helpers/replay_buffer.py
 Comment: 
 
 Filename: torchrl/trainers/helpers/trainers.py
 Comment: 
 
-Filename: torchrl_nightly-2024.5.1.dist-info/LICENSE
+Filename: torchrl_nightly-2024.5.2.dist-info/LICENSE
 Comment: 
 
-Filename: torchrl_nightly-2024.5.1.dist-info/METADATA
+Filename: torchrl_nightly-2024.5.2.dist-info/METADATA
 Comment: 
 
-Filename: torchrl_nightly-2024.5.1.dist-info/WHEEL
+Filename: torchrl_nightly-2024.5.2.dist-info/WHEEL
 Comment: 
 
-Filename: torchrl_nightly-2024.5.1.dist-info/top_level.txt
+Filename: torchrl_nightly-2024.5.2.dist-info/top_level.txt
 Comment: 
 
-Filename: torchrl_nightly-2024.5.1.dist-info/RECORD
+Filename: torchrl_nightly-2024.5.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## torchrl/version.py

```diff
@@ -1,2 +1,2 @@
-__version__ = '2024.5.1'
-git_version = '711a4ee6446e000af020c001652ffe689482960c'
+__version__ = '2024.5.2'
+git_version = '7109a3f16f0792ab89f2d6ca736376078c73dd33'
```

## torchrl/envs/libs/gym.py

```diff
@@ -911,15 +911,18 @@
             self._seed_calls_reset = True
         except TypeError as err:
             warnings.warn(
                 f"reset with seed kwarg returned an exception: {err}.\n"
                 f"Calling env.seed from now on."
             )
             self._seed_calls_reset = False
-            self._env.seed(seed=seed)
+            try:
+                self._env.seed(seed=seed)
+            except AttributeError as err2:
+                raise err from err2
 
     @implement_for("gymnasium")
     def _set_seed_initial(self, seed: int) -> None:  # noqa: F811
         try:
             self.reset(seed=seed)
             self._seed_calls_reset = True
         except TypeError as err:
@@ -1150,22 +1153,27 @@
 
     def _reset(
         self, tensordict: TensorDictBase | None = None, **kwargs
     ) -> TensorDictBase:
         if self._is_batched:
             # batched (aka 'vectorized') env reset is a bit special: envs are
             # automatically reset. What we do here is just to check if _reset
-            # is present. If it is not, we just reset. Otherwise we just skip.
+            # is present. If it is not, we just reset. Otherwise, we just skip.
             if tensordict is None:
-                return super()._reset(tensordict)
+                return super()._reset(tensordict, **kwargs)
             reset = tensordict.get("_reset", None)
-            if reset is None:
-                return super()._reset(tensordict)
-            elif reset is not None:
-                return tensordict.exclude("_reset")
+            if reset is not None:
+                # we must copy the tensordict because the transform
+                # expects a tuple (tensordict, tensordict_reset) where the
+                # first still carries a _reset
+                tensordict = tensordict.exclude("_reset")
+            if reset is None or reset.all():
+                return super()._reset(tensordict, **kwargs)
+            else:
+                return tensordict
         return super()._reset(tensordict, **kwargs)
 
 
 ACCEPTED_TYPE_ERRORS = {
     "render_mode": "__init__() got an unexpected keyword argument 'render_mode'",
     "frame_skip": "unexpected keyword argument 'frameskip'",
 }
```

## torchrl/envs/transforms/transforms.py

```diff
@@ -18179,3276 +18179,3316 @@
 00047020: 2020 646f 6e65 203d 2064 6f6e 652e 7669    done = done.vi
 00047030: 6577 5f61 7328 7265 7365 7429 0d0a 2020  ew_as(reset)..  
 00047040: 2020 2020 2020 6966 2028 0d0a 2020 2020        if (..    
 00047050: 2020 2020 2020 2020 7265 7365 7420 6973          reset is
 00047060: 206e 6f74 2064 6f6e 650d 0a20 2020 2020   not done..     
 00047070: 2020 2020 2020 2061 6e64 2028 7265 7365         and (rese
 00047080: 7420 213d 2064 6f6e 6529 2e61 6e79 2829  t != done).any()
-00047090: 0d0a 2020 2020 2020 2020 2020 2020 616e  ..            an
-000470a0: 6420 286e 6f74 2072 6573 6574 2e61 6c6c  d (not reset.all
-000470b0: 2829 206f 7220 6e6f 7420 7265 7365 742e  () or not reset.
-000470c0: 616e 7928 2929 0d0a 2020 2020 2020 2020  any())..        
-000470d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000470e0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-000470f0: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
-00047100: 2020 2020 2022 4361 6e6e 6f74 2070 6172       "Cannot par
-00047110: 7469 616c 6c79 2072 6573 6574 2061 2067  tially reset a g
-00047120: 796d 286e 6173 6975 6d29 2061 7379 6e63  ym(nasium) async
-00047130: 2065 6e76 2077 6974 6820 6120 7265 7365   env with a rese
-00047140: 7420 6d61 736b 2074 6861 7420 646f 6573  t mask that does
-00047150: 206e 6f74 206d 6174 6368 2074 6865 2064   not match the d
-00047160: 6f6e 6520 6d61 736b 2e20 220d 0a20 2020  one mask. "..   
-00047170: 2020 2020 2020 2020 2020 2020 2066 2247               f"G
-00047180: 6f74 2072 6573 6574 3d7b 7265 7365 747d  ot reset={reset}
-00047190: 5c6e 616e 6420 646f 6e65 3d7b 646f 6e65  \nand done={done
-000471a0: 7d22 0d0a 2020 2020 2020 2020 2020 2020  }"..            
-000471b0: 290d 0a20 2020 2020 2020 2023 2069 6620  )..        # if 
-000471c0: 6e6f 7420 7265 7365 742e 616e 7928 292c  not reset.any(),
-000471d0: 2077 6520 646f 6e27 7420 6e65 6564 2074   we don't need t
-000471e0: 6f20 646f 2061 6e79 7468 696e 672e 0d0a  o do anything...
-000471f0: 2020 2020 2020 2020 2320 6966 2072 6573          # if res
-00047200: 6574 2e61 6c6c 2829 2c20 7765 2064 6f6e  et.all(), we don
-00047210: 2774 2065 6974 6865 7220 2862 6320 4779  't either (bc Gy
-00047220: 6d57 7261 7070 6572 2077 696c 6c20 6361  mWrapper will ca
-00047230: 6c6c 2061 2070 6c61 696e 2072 6573 6574  ll a plain reset
-00047240: 292e 0d0a 2020 2020 2020 2020 6966 2072  )...        if r
-00047250: 6573 6574 2069 7320 6e6f 7420 4e6f 6e65  eset is not None
-00047260: 2061 6e64 2072 6573 6574 2e61 6e79 2829   and reset.any()
-00047270: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00047280: 6176 6564 5f6e 6578 7420 3d20 7365 6c66  aved_next = self
-00047290: 2e5f 6d65 6d6f 5b22 7361 7665 645f 6e65  ._memo["saved_ne
-000472a0: 7874 225d 0d0a 2020 2020 2020 2020 2020  xt"]..          
-000472b0: 2020 2320 7265 7365 7420 3d20 7265 7365    # reset = rese
-000472c0: 742e 7669 6577 2874 656e 736f 7264 6963  t.view(tensordic
-000472d0: 742e 7368 6170 6529 0d0a 2020 2020 2020  t.shape)..      
-000472e0: 2020 2020 2020 2320 7765 2068 6176 6520        # we have 
-000472f0: 6120 6461 7461 2063 6f6e 7461 696e 6572  a data container
-00047300: 2066 726f 6d20 7468 6520 7072 6576 696f   from the previo
-00047310: 7573 2063 616c 6c20 746f 2073 7465 700d  us call to step.
-00047320: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-00047330: 6861 7420 636f 6e74 6169 6e73 2070 6172  hat contains par
-00047340: 7420 6f66 2074 6865 206f 6273 6572 7661  t of the observa
-00047350: 7469 6f6e 2077 6520 6e65 6564 2e0d 0a20  tion we need... 
-00047360: 2020 2020 2020 2020 2020 2023 2057 6520             # We 
-00047370: 6361 6e20 7361 6665 6c79 2070 6c61 6365  can safely place
-00047380: 2074 6865 6d20 6261 636b 2069 6e20 7468   them back in th
-00047390: 6520 7265 7365 7420 7265 7375 6c74 2074  e reset result t
-000473a0: 656e 736f 7264 6963 743a 0d0a 2020 2020  ensordict:..    
-000473b0: 2020 2020 2020 2020 2320 696e 2065 6e76          # in env
-000473c0: 2e72 6f6c 6c6f 7574 2829 2c20 7468 6520  .rollout(), the 
-000473d0: 7265 7375 6c74 206f 6620 7265 7365 7428  result of reset(
-000473e0: 2920 6973 2061 7373 756d 6564 2074 6f20  ) is assumed to 
-000473f0: 6265 206a 7573 740d 0a20 2020 2020 2020  be just..       
-00047400: 2020 2020 2023 2074 6865 2074 6420 6672       # the td fr
-00047410: 6f6d 2070 7265 7669 6f75 7320 7374 6570  om previous step
-00047420: 2077 6974 6820 7570 6461 7465 6420 7661   with updated va
-00047430: 6c75 6573 2066 726f 6d20 7265 7365 742e  lues from reset.
-00047440: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00047450: 496e 206f 7572 2063 6173 652c 2069 7420  In our case, it 
-00047460: 7769 6c6c 2061 6c77 6179 7320 6265 2074  will always be t
-00047470: 6865 2063 6173 6520 7468 6174 2061 6c6c  he case that all
-00047480: 2074 6865 7365 2076 616c 7565 730d 0a20   these values.. 
-00047490: 2020 2020 2020 2020 2020 2023 2061 7265             # are
-000474a0: 2070 726f 7065 726c 7920 7365 742e 0d0a   properly set...
-000474b0: 2020 2020 2020 2020 2020 2020 2320 636f              # co
-000474c0: 6c6c 6563 746f 7273 2065 7665 6e20 7461  llectors even ta
-000474d0: 6b65 2063 6172 6520 6f66 2064 6f69 6e67  ke care of doing
-000474e0: 2061 6e20 6578 7472 6120 6d61 736b 696e   an extra maskin
-000474f0: 6720 736f 2069 7427 7320 6576 656e 0d0a  g so it's even..
-00047500: 2020 2020 2020 2020 2020 2020 2320 7361              # sa
-00047510: 6665 722e 0d0a 2020 2020 2020 2020 2020  fer...          
-00047520: 2020 7465 6e73 6f72 6469 6374 5f72 6573    tensordict_res
-00047530: 6574 2e75 7064 6174 6528 7361 7665 645f  et.update(saved_
-00047540: 6e65 7874 290d 0a20 2020 2020 2020 2020  next)..         
-00047550: 2020 2066 6f72 2064 6f6e 655f 6b65 7920     for done_key 
-00047560: 696e 2073 656c 662e 646f 6e65 5f6b 6579  in self.done_key
-00047570: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00047580: 2020 2020 2320 4d61 6b65 2073 7572 6520      # Make sure 
-00047590: 7468 6174 2061 6c6c 2064 6f6e 6520 6172  that all done ar
-000475a0: 6520 4661 6c73 650d 0a20 2020 2020 2020  e False..       
-000475b0: 2020 2020 2020 2020 2064 6f6e 6520 3d20           done = 
-000475c0: 7465 6e73 6f72 6469 6374 2e67 6574 2864  tensordict.get(d
-000475d0: 6f6e 655f 6b65 792c 204e 6f6e 6529 0d0a  one_key, None)..
-000475e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000475f0: 6966 2064 6f6e 6520 6973 206e 6f74 204e  if done is not N
-00047600: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00047610: 2020 2020 2020 2020 2020 646f 6e65 203d            done =
-00047620: 2064 6f6e 652e 636c 6f6e 6528 292e 6669   done.clone().fi
-00047630: 6c6c 5f28 3029 0d0a 2020 2020 2020 2020  ll_(0)..        
-00047640: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00047650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047660: 2020 2064 6f6e 6520 3d20 746f 7263 682e     done = torch.
-00047670: 7a65 726f 7328 0d0a 2020 2020 2020 2020  zeros(..        
-00047680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047690: 282a 7465 6e73 6f72 6469 6374 2e62 6174  (*tensordict.bat
-000476a0: 6368 5f73 697a 652c 2031 292c 0d0a 2020  ch_size, 1),..  
-000476b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000476c0: 2020 2020 2020 6465 7669 6365 3d74 656e        device=ten
-000476d0: 736f 7264 6963 742e 6465 7669 6365 2c0d  sordict.device,.
-000476e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000476f0: 2020 2020 2020 2020 2064 7479 7065 3d74           dtype=t
-00047700: 6f72 6368 2e62 6f6f 6c2c 0d0a 2020 2020  orch.bool,..    
-00047710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047720: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00047730: 2020 2074 656e 736f 7264 6963 742e 7365     tensordict.se
-00047740: 7428 646f 6e65 5f6b 6579 2c20 646f 6e65  t(done_key, done
-00047750: 290d 0a20 2020 2020 2020 2074 656e 736f  )..        tenso
-00047760: 7264 6963 745f 7265 7365 742e 706f 7028  rdict_reset.pop(
-00047770: 7365 6c66 2e66 696e 616c 5f6e 616d 652c  self.final_name,
-00047780: 204e 6f6e 6529 0d0a 2020 2020 2020 2020   None)..        
-00047790: 7265 7475 726e 2074 656e 736f 7264 6963  return tensordic
-000477a0: 745f 7265 7365 740d 0a0d 0a20 2020 2040  t_reset....    @
-000477b0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-000477c0: 6620 646f 6e65 5f6b 6579 7328 7365 6c66  f done_keys(self
-000477d0: 2920 2d3e 204c 6973 745b 4e65 7374 6564  ) -> List[Nested
-000477e0: 4b65 795d 3a0d 0a20 2020 2020 2020 206b  Key]:..        k
-000477f0: 6579 7320 3d20 7365 6c66 2e5f 5f64 6963  eys = self.__dic
-00047800: 745f 5f2e 6765 7428 225f 646f 6e65 5f6b  t__.get("_done_k
-00047810: 6579 7322 2c20 4e6f 6e65 290d 0a20 2020  eys", None)..   
-00047820: 2020 2020 2069 6620 6b65 7973 2069 7320       if keys is 
-00047830: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00047840: 2020 206b 6579 7320 3d20 7365 6c66 2e70     keys = self.p
-00047850: 6172 656e 742e 646f 6e65 5f6b 6579 730d  arent.done_keys.
-00047860: 0a20 2020 2020 2020 2020 2020 2023 2077  .            # w
-00047870: 6520 6a75 7374 2077 616e 7420 7468 6520  e just want the 
-00047880: 2264 6f6e 6522 206b 6579 0d0a 2020 2020  "done" key..    
-00047890: 2020 2020 2020 2020 5f64 6f6e 655f 6b65          _done_ke
-000478a0: 7973 203d 205b 5d0d 0a20 2020 2020 2020  ys = []..       
-000478b0: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-000478c0: 6b65 7973 3a0d 0a20 2020 2020 2020 2020  keys:..         
-000478d0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-000478e0: 696e 7374 616e 6365 286b 6579 2c20 7475  instance(key, tu
-000478f0: 706c 6529 3a0d 0a20 2020 2020 2020 2020  ple):..         
-00047900: 2020 2020 2020 2020 2020 206b 6579 203d             key =
-00047910: 2028 6b65 792c 290d 0a20 2020 2020 2020   (key,)..       
-00047920: 2020 2020 2020 2020 2069 6620 6b65 795b           if key[
-00047930: 2d31 5d20 3d3d 2022 646f 6e65 223a 0d0a  -1] == "done":..
-00047940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047950: 2020 2020 5f64 6f6e 655f 6b65 7973 2e61      _done_keys.a
-00047960: 7070 656e 6428 756e 7261 7665 6c5f 6b65  ppend(unravel_ke
-00047970: 7928 6b65 7929 290d 0a20 2020 2020 2020  y(key))..       
-00047980: 2020 2020 2069 6620 6e6f 7420 6c65 6e28       if not len(
-00047990: 5f64 6f6e 655f 6b65 7973 293a 0d0a 2020  _done_keys):..  
-000479a0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000479b0: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-000479c0: 2822 436f 756c 6420 6e6f 7420 6669 6e64  ("Could not find
-000479d0: 2061 2027 646f 6e65 2720 6b65 7920 696e   a 'done' key in
-000479e0: 2074 6865 2065 6e76 2073 7065 6373 2e22   the env specs."
-000479f0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00047a00: 656c 662e 5f64 6f6e 655f 6b65 7973 203d  elf._done_keys =
-00047a10: 205f 646f 6e65 5f6b 6579 730d 0a20 2020   _done_keys..   
-00047a20: 2020 2020 2072 6574 7572 6e20 6b65 7973       return keys
-00047a30: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00047a40: 790d 0a20 2020 2064 6566 206f 6273 5f6b  y..    def obs_k
-00047a50: 6579 7328 7365 6c66 2920 2d3e 204c 6973  eys(self) -> Lis
-00047a60: 745b 4e65 7374 6564 4b65 795d 3a0d 0a20  t[NestedKey]:.. 
-00047a70: 2020 2020 2020 206b 6579 7320 3d20 7365         keys = se
-00047a80: 6c66 2e5f 5f64 6963 745f 5f2e 6765 7428  lf.__dict__.get(
-00047a90: 225f 6f62 735f 6b65 7973 222c 204e 6f6e  "_obs_keys", Non
-00047aa0: 6529 0d0a 2020 2020 2020 2020 6966 206b  e)..        if k
-00047ab0: 6579 7320 6973 204e 6f6e 653a 0d0a 2020  eys is None:..  
-00047ac0: 2020 2020 2020 2020 2020 6b65 7973 203d            keys =
-00047ad0: 206c 6973 7428 7365 6c66 2e70 6172 656e   list(self.paren
-00047ae0: 742e 6f62 7365 7276 6174 696f 6e5f 7370  t.observation_sp
-00047af0: 6563 2e6b 6579 7328 5472 7565 2c20 5472  ec.keys(True, Tr
-00047b00: 7565 2929 0d0a 2020 2020 2020 2020 2020  ue))..          
-00047b10: 2020 7365 6c66 2e5f 6f62 735f 6b65 7973    self._obs_keys
-00047b20: 203d 206b 6579 730d 0a20 2020 2020 2020   = keys..       
-00047b30: 2072 6574 7572 6e20 6b65 7973 0d0a 0d0a   return keys....
-00047b40: 2020 2020 6465 6620 7472 616e 7366 6f72      def transfor
-00047b50: 6d5f 6f62 7365 7276 6174 696f 6e5f 7370  m_observation_sp
-00047b60: 6563 2873 656c 662c 206f 6273 6572 7661  ec(self, observa
-00047b70: 7469 6f6e 5f73 7065 633a 2054 656e 736f  tion_spec: Tenso
-00047b80: 7253 7065 6329 202d 3e20 5465 6e73 6f72  rSpec) -> Tensor
-00047b90: 5370 6563 3a0d 0a20 2020 2020 2020 2069  Spec:..        i
-00047ba0: 6620 7365 6c66 2e66 696e 616c 5f6e 616d  f self.final_nam
-00047bb0: 6520 696e 206f 6273 6572 7661 7469 6f6e  e in observation
-00047bc0: 5f73 7065 632e 6b65 7973 2854 7275 6529  _spec.keys(True)
-00047bd0: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-00047be0: 656c 206f 6273 6572 7661 7469 6f6e 5f73  el observation_s
-00047bf0: 7065 635b 7365 6c66 2e66 696e 616c 5f6e  pec[self.final_n
-00047c00: 616d 655d 0d0a 2020 2020 2020 2020 7265  ame]..        re
-00047c10: 7475 726e 206f 6273 6572 7661 7469 6f6e  turn observation
-00047c20: 5f73 7065 630d 0a0d 0a20 2020 2064 6566  _spec....    def
-00047c30: 2066 6f72 7761 7264 2873 656c 662c 2074   forward(self, t
-00047c40: 656e 736f 7264 6963 743a 2054 656e 736f  ensordict: Tenso
-00047c50: 7244 6963 7442 6173 6529 202d 3e20 5465  rDictBase) -> Te
-00047c60: 6e73 6f72 4469 6374 4261 7365 3a0d 0a20  nsorDictBase:.. 
-00047c70: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
-00047c80: 7469 6d65 4572 726f 7228 464f 5257 4152  timeError(FORWAR
-00047c90: 445f 4e4f 545f 494d 504c 454d 454e 5445  D_NOT_IMPLEMENTE
-00047ca0: 442e 666f 726d 6174 2874 7970 6528 7365  D.format(type(se
-00047cb0: 6c66 2929 290d 0a0d 0a0d 0a63 6c61 7373  lf)))......class
-00047cc0: 2042 7572 6e49 6e54 7261 6e73 666f 726d   BurnInTransform
-00047cd0: 2854 7261 6e73 666f 726d 293a 0d0a 2020  (Transform):..  
-00047ce0: 2020 2222 2254 7261 6e73 666f 726d 2074    """Transform t
-00047cf0: 6f20 7061 7274 6961 6c6c 7920 6275 726e  o partially burn
-00047d00: 2d69 6e20 6461 7461 2073 6571 7565 6e63  -in data sequenc
-00047d10: 6573 2e0d 0a0d 0a20 2020 2054 6869 7320  es.....    This 
-00047d20: 7472 616e 7366 6f72 6d20 6973 2075 7365  transform is use
-00047d30: 6675 6c20 746f 206f 6274 6169 6e20 7570  ful to obtain up
-00047d40: 2d74 6f2d 6461 7465 2072 6563 7572 7265  -to-date recurre
-00047d50: 6e74 2073 7461 7465 7320 7768 656e 0d0a  nt states when..
-00047d60: 2020 2020 7468 6579 2061 7265 206e 6f74      they are not
-00047d70: 2061 7661 696c 6162 6c65 2e20 4974 2062   available. It b
-00047d80: 7572 6e73 2d69 6e20 6120 6e75 6d62 6572  urns-in a number
-00047d90: 206f 6620 7374 6570 7320 616c 6f6e 6720   of steps along 
-00047da0: 7468 6520 7469 6d65 2064 696d 656e 7369  the time dimensi
-00047db0: 6f6e 0d0a 2020 2020 6672 6f6d 2073 616d  on..    from sam
-00047dc0: 706c 6564 2073 6571 7565 6e74 6961 6c20  pled sequential 
-00047dd0: 6461 7461 2073 6c69 6365 7320 616e 6420  data slices and 
-00047de0: 7265 7475 7273 2074 6865 2072 656d 6169  returs the remai
-00047df0: 6e69 6e67 2064 6174 6120 7365 7175 656e  ning data sequen
-00047e00: 6365 2077 6974 680d 0a20 2020 2074 6865  ce with..    the
-00047e10: 2062 7572 6e74 2d69 6e20 6461 7461 2069   burnt-in data i
-00047e20: 6e20 6974 7320 696e 6974 6961 6c20 7469  n its initial ti
-00047e30: 6d65 2073 7465 702e 2054 6869 7320 7472  me step. This tr
-00047e40: 616e 7366 6f72 6d20 6973 2069 6e74 656e  ansform is inten
-00047e50: 6465 6420 746f 2062 6520 7573 6564 2061  ded to be used a
-00047e60: 7320 610d 0a20 2020 2072 6570 6c61 7920  s a..    replay 
-00047e70: 6275 6666 6572 2074 7261 6e73 666f 726d  buffer transform
-00047e80: 2c20 6e6f 7420 6173 2061 6e20 656e 7669  , not as an envi
-00047e90: 726f 6e6d 656e 7420 7472 616e 7366 6f72  ronment transfor
-00047ea0: 6d2e 0d0a 0d0a 2020 2020 4172 6773 3a0d  m.....    Args:.
-00047eb0: 0a20 2020 2020 2020 206d 6f64 756c 6573  .        modules
-00047ec0: 2028 7365 7175 656e 6365 206f 6620 5465   (sequence of Te
-00047ed0: 6e73 6f72 4469 6374 4d6f 6475 6c65 293a  nsorDictModule):
-00047ee0: 2041 206c 6973 7420 6f66 206d 6f64 756c   A list of modul
-00047ef0: 6573 2075 7365 6420 746f 2062 7572 6e2d  es used to burn-
-00047f00: 696e 2064 6174 6120 7365 7175 656e 6365  in data sequence
-00047f10: 732e 0d0a 2020 2020 2020 2020 6275 726e  s...        burn
-00047f20: 5f69 6e20 2869 6e74 293a 2054 6865 206e  _in (int): The n
-00047f30: 756d 6265 7220 6f66 2074 696d 6520 7374  umber of time st
-00047f40: 6570 7320 746f 2062 7572 6e20 696e 2e0d  eps to burn in..
-00047f50: 0a20 2020 2020 2020 206f 7574 5f6b 6579  .        out_key
-00047f60: 7320 2873 6571 7565 6e63 6520 6f66 204e  s (sequence of N
-00047f70: 6573 7465 644b 6579 2c20 6f70 7469 6f6e  estedKey, option
-00047f80: 616c 293a 2064 6573 7469 6e61 7469 6f6e  al): destination
-00047f90: 206b 6579 732e 2044 6566 6175 6c74 7320   keys. Defaults 
-00047fa0: 746f 0d0a 2020 2020 2020 2020 616c 6c20  to..        all 
-00047fb0: 7468 6520 6d6f 6475 6c65 7320 606f 7574  the modules `out
-00047fc0: 5f6b 6579 7360 2074 6861 7420 706f 696e  _keys` that poin
-00047fd0: 7420 746f 2074 6865 206e 6578 7420 7469  t to the next ti
-00047fe0: 6d65 2073 7465 7020 2865 2e67 2e20 6022  me step (e.g. `"
-00047ff0: 6869 6464 656e 2260 2069 6620 600d 0a20  hidden"` if `.. 
-00048000: 2020 2020 2020 2028 226e 6578 7422 2c20         ("next", 
-00048010: 2268 6964 6465 6e22 2960 2069 7320 7061  "hidden")` is pa
-00048020: 7274 206f 6620 7468 6520 606f 7574 5f6b  rt of the `out_k
-00048030: 6579 7360 206f 6620 6120 6d6f 6475 6c65  eys` of a module
-00048040: 292e 0d0a 0d0a 2020 2020 2e2e 206e 6f74  ).....    .. not
-00048050: 653a 3a0d 0a20 2020 2020 2020 2054 6869  e::..        Thi
-00048060: 7320 7472 616e 7366 6f72 6d20 6578 7065  s transform expe
-00048070: 6374 7320 6173 2069 6e70 7574 7320 5465  cts as inputs Te
-00048080: 6e73 6f72 4469 6374 7320 7769 7468 2069  nsorDicts with i
-00048090: 7473 206c 6173 7420 6469 6d65 6e73 696f  ts last dimensio
-000480a0: 6e20 6265 696e 6720 7468 650d 0a20 2020  n being the..   
-000480b0: 2020 2020 2074 696d 6520 6469 6d65 6e73       time dimens
-000480c0: 696f 6e2e 2049 7420 616c 736f 2020 6173  ion. It also  as
-000480d0: 7375 6d65 7320 7468 6174 2061 6c6c 2070  sumes that all p
-000480e0: 726f 7669 6465 6420 6d6f 6475 6c65 7320  rovided modules 
-000480f0: 6361 6e20 7072 6f63 6573 730d 0a20 2020  can process..   
-00048100: 2020 2020 2073 6571 7565 6e74 6961 6c20       sequential 
-00048110: 6461 7461 2e0d 0a0d 0a20 2020 2045 7861  data.....    Exa
-00048120: 6d70 6c65 733a 0d0a 2020 2020 2020 2020  mples:..        
-00048130: 3e3e 3e20 696d 706f 7274 2074 6f72 6368  >>> import torch
-00048140: 0d0a 2020 2020 2020 2020 3e3e 3e20 6672  ..        >>> fr
-00048150: 6f6d 2074 656e 736f 7264 6963 7420 696d  om tensordict im
-00048160: 706f 7274 2054 656e 736f 7244 6963 740d  port TensorDict.
-00048170: 0a20 2020 2020 2020 203e 3e3e 2066 726f  .        >>> fro
-00048180: 6d20 746f 7263 6872 6c2e 656e 7673 2e74  m torchrl.envs.t
-00048190: 7261 6e73 666f 726d 7320 696d 706f 7274  ransforms import
-000481a0: 2042 7572 6e49 6e54 7261 6e73 666f 726d   BurnInTransform
-000481b0: 0d0a 2020 2020 2020 2020 3e3e 3e20 6672  ..        >>> fr
-000481c0: 6f6d 2074 6f72 6368 726c 2e6d 6f64 756c  om torchrl.modul
-000481d0: 6573 2069 6d70 6f72 7420 4752 554d 6f64  es import GRUMod
-000481e0: 756c 650d 0a20 2020 2020 2020 203e 3e3e  ule..        >>>
-000481f0: 2067 7275 5f6d 6f64 756c 6520 3d20 4752   gru_module = GR
-00048200: 554d 6f64 756c 6528 0d0a 2020 2020 2020  UModule(..      
-00048210: 2020 2e2e 2e20 2020 2020 696e 7075 745f    ...     input_
-00048220: 7369 7a65 3d31 302c 0d0a 2020 2020 2020  size=10,..      
-00048230: 2020 2e2e 2e20 2020 2020 6869 6464 656e    ...     hidden
-00048240: 5f73 697a 653d 3130 2c0d 0a20 2020 2020  _size=10,..     
-00048250: 2020 202e 2e2e 2020 2020 2069 6e5f 6b65     ...     in_ke
-00048260: 7973 3d5b 226f 6273 6572 7661 7469 6f6e  ys=["observation
-00048270: 222c 2022 6869 6464 656e 225d 2c0d 0a20  ", "hidden"],.. 
-00048280: 2020 2020 2020 202e 2e2e 2020 2020 206f         ...     o
-00048290: 7574 5f6b 6579 733d 5b22 696e 7465 726d  ut_keys=["interm
-000482a0: 6564 6961 7465 222c 2028 226e 6578 7422  ediate", ("next"
-000482b0: 2c20 2268 6964 6465 6e22 295d 2c0d 0a20  , "hidden")],.. 
-000482c0: 2020 2020 2020 202e 2e2e 2029 2e73 6574         ... ).set
-000482d0: 5f72 6563 7572 7265 6e74 5f6d 6f64 6528  _recurrent_mode(
-000482e0: 5472 7565 290d 0a20 2020 2020 2020 203e  True)..        >
-000482f0: 3e3e 2062 7572 6e5f 696e 5f74 7261 6e73  >> burn_in_trans
-00048300: 666f 726d 203d 2042 7572 6e49 6e54 7261  form = BurnInTra
-00048310: 6e73 666f 726d 280d 0a20 2020 2020 2020  nsform(..       
-00048320: 202e 2e2e 2020 2020 206d 6f64 756c 6573   ...     modules
-00048330: 3d5b 6772 755f 6d6f 6475 6c65 5d2c 0d0a  =[gru_module],..
-00048340: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00048350: 6275 726e 5f69 6e3d 352c 0d0a 2020 2020  burn_in=5,..    
-00048360: 2020 2020 2e2e 2e20 290d 0a20 2020 2020      ... )..     
-00048370: 2020 203e 3e3e 2074 6420 3d20 5465 6e73     >>> td = Tens
-00048380: 6f72 4469 6374 287b 0d0a 2020 2020 2020  orDict({..      
-00048390: 2020 2e2e 2e20 2020 2020 226f 6273 6572    ...     "obser
-000483a0: 7661 7469 6f6e 223a 2074 6f72 6368 2e72  vation": torch.r
-000483b0: 616e 646e 2832 2c20 3130 2c20 3130 292c  andn(2, 10, 10),
-000483c0: 0d0a 2020 2020 2020 2020 2e2e 2e20 2020  ..        ...   
-000483d0: 2020 2022 6869 6464 656e 223a 2074 6f72     "hidden": tor
-000483e0: 6368 2e72 616e 646e 2832 2c20 3130 2c20  ch.randn(2, 10, 
-000483f0: 6772 755f 6d6f 6475 6c65 2e67 7275 2e6e  gru_module.gru.n
-00048400: 756d 5f6c 6179 6572 732c 2031 3029 2c0d  um_layers, 10),.
-00048410: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-00048420: 2020 2269 735f 696e 6974 223a 2074 6f72    "is_init": tor
-00048430: 6368 2e7a 6572 6f73 2832 2c20 3130 2c20  ch.zeros(2, 10, 
-00048440: 3129 2c0d 0a20 2020 2020 2020 202e 2e2e  1),..        ...
-00048450: 207d 2c20 6261 7463 685f 7369 7a65 3d5b   }, batch_size=[
-00048460: 322c 2031 305d 290d 0a20 2020 2020 2020  2, 10])..       
-00048470: 203e 3e3e 2074 6420 3d20 6275 726e 5f69   >>> td = burn_i
-00048480: 6e5f 7472 616e 7366 6f72 6d28 7464 290d  n_transform(td).
-00048490: 0a20 2020 2020 2020 203e 3e3e 2074 642e  .        >>> td.
-000484a0: 7368 6170 650d 0a20 2020 2020 2020 2074  shape..        t
-000484b0: 6f72 6368 2e53 697a 6528 5b32 2c20 355d  orch.Size([2, 5]
-000484c0: 290d 0a20 2020 2020 2020 203e 3e3e 2074  )..        >>> t
-000484d0: 642e 6765 7428 2268 6964 6465 6e22 292e  d.get("hidden").
-000484e0: 6162 7328 292e 7375 6d28 290d 0a20 2020  abs().sum()..   
-000484f0: 2020 2020 2074 656e 736f 7228 3836 2e33       tensor(86.3
-00048500: 3030 3829 0d0a 0d0a 2020 2020 2020 2020  008)....        
-00048510: 3e3e 3e20 6672 6f6d 2074 6f72 6368 726c  >>> from torchrl
-00048520: 2e64 6174 6120 696d 706f 7274 204c 617a  .data import Laz
-00048530: 794d 656d 6d61 7053 746f 7261 6765 2c20  yMemmapStorage, 
-00048540: 5465 6e73 6f72 4469 6374 5265 706c 6179  TensorDictReplay
-00048550: 4275 6666 6572 0d0a 2020 2020 2020 2020  Buffer..        
-00048560: 3e3e 3e20 6275 6666 6572 203d 2054 656e  >>> buffer = Ten
-00048570: 736f 7244 6963 7452 6570 6c61 7942 7566  sorDictReplayBuf
-00048580: 6665 7228 0d0a 2020 2020 2020 2020 2e2e  fer(..        ..
-00048590: 2e20 2020 2020 7374 6f72 6167 653d 4c61  .     storage=La
-000485a0: 7a79 4d65 6d6d 6170 5374 6f72 6167 6528  zyMemmapStorage(
-000485b0: 3229 2c0d 0a20 2020 2020 2020 202e 2e2e  2),..        ...
-000485c0: 2020 2020 2062 6174 6368 5f73 697a 653d       batch_size=
-000485d0: 312c 0d0a 2020 2020 2020 2020 2e2e 2e20  1,..        ... 
-000485e0: 290d 0a20 2020 2020 2020 203e 3e3e 2062  )..        >>> b
-000485f0: 7566 6665 722e 6170 7065 6e64 5f74 7261  uffer.append_tra
-00048600: 6e73 666f 726d 2862 7572 6e5f 696e 5f74  nsform(burn_in_t
-00048610: 7261 6e73 666f 726d 290d 0a20 2020 2020  ransform)..     
-00048620: 2020 203e 3e3e 2074 6420 3d20 5465 6e73     >>> td = Tens
-00048630: 6f72 4469 6374 287b 0d0a 2020 2020 2020  orDict({..      
-00048640: 2020 2e2e 2e20 2020 2020 226f 6273 6572    ...     "obser
-00048650: 7661 7469 6f6e 223a 2074 6f72 6368 2e72  vation": torch.r
-00048660: 616e 646e 2832 2c20 3130 2c20 3130 292c  andn(2, 10, 10),
-00048670: 0d0a 2020 2020 2020 2020 2e2e 2e20 2020  ..        ...   
-00048680: 2020 2022 6869 6464 656e 223a 2074 6f72     "hidden": tor
-00048690: 6368 2e72 616e 646e 2832 2c20 3130 2c20  ch.randn(2, 10, 
-000486a0: 6772 755f 6d6f 6475 6c65 2e67 7275 2e6e  gru_module.gru.n
-000486b0: 756d 5f6c 6179 6572 732c 2031 3029 2c0d  um_layers, 10),.
-000486c0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-000486d0: 2020 2269 735f 696e 6974 223a 2074 6f72    "is_init": tor
-000486e0: 6368 2e7a 6572 6f73 2832 2c20 3130 2c20  ch.zeros(2, 10, 
-000486f0: 3129 2c0d 0a20 2020 2020 2020 202e 2e2e  1),..        ...
-00048700: 207d 2c20 6261 7463 685f 7369 7a65 3d5b   }, batch_size=[
-00048710: 322c 2031 305d 290d 0a20 2020 2020 2020  2, 10])..       
-00048720: 203e 3e3e 2062 7566 6665 722e 6578 7465   >>> buffer.exte
-00048730: 6e64 2874 6429 0d0a 2020 2020 2020 2020  nd(td)..        
-00048740: 3e3e 3e20 7464 203d 2062 7566 6665 722e  >>> td = buffer.
-00048750: 7361 6d70 6c65 2831 290d 0a20 2020 2020  sample(1)..     
-00048760: 2020 203e 3e3e 2074 642e 7368 6170 650d     >>> td.shape.
-00048770: 0a20 2020 2020 2020 2074 6f72 6368 2e53  .        torch.S
-00048780: 697a 6528 5b31 2c20 355d 290d 0a20 2020  ize([1, 5])..   
-00048790: 2020 2020 203e 3e3e 2074 642e 6765 7428       >>> td.get(
-000487a0: 2268 6964 6465 6e22 292e 6162 7328 292e  "hidden").abs().
-000487b0: 7375 6d28 290d 0a20 2020 2020 2020 2074  sum()..        t
-000487c0: 656e 736f 7228 3337 2e30 3334 3429 0d0a  ensor(37.0344)..
-000487d0: 2020 2020 2222 220d 0a0d 0a20 2020 2069      """....    i
-000487e0: 6e76 6572 7469 626c 6520 3d20 4661 6c73  nvertible = Fals
-000487f0: 650d 0a0d 0a20 2020 2064 6566 205f 5f69  e....    def __i
-00048800: 6e69 745f 5f28 0d0a 2020 2020 2020 2020  nit__(..        
-00048810: 7365 6c66 2c0d 0a20 2020 2020 2020 206d  self,..        m
-00048820: 6f64 756c 6573 3a20 5365 7175 656e 6365  odules: Sequence
-00048830: 5b54 656e 736f 7244 6963 744d 6f64 756c  [TensorDictModul
-00048840: 6542 6173 655d 2c0d 0a20 2020 2020 2020  eBase],..       
-00048850: 2062 7572 6e5f 696e 3a20 696e 742c 0d0a   burn_in: int,..
-00048860: 2020 2020 2020 2020 6f75 745f 6b65 7973          out_keys
-00048870: 3a20 5365 7175 656e 6365 5b4e 6573 7465  : Sequence[Neste
-00048880: 644b 6579 5d20 7c20 4e6f 6e65 203d 204e  dKey] | None = N
-00048890: 6f6e 652c 0d0a 2020 2020 293a 0d0a 2020  one,..    ):..  
-000488a0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-000488b0: 6e73 7461 6e63 6528 6d6f 6475 6c65 732c  nstance(modules,
-000488c0: 2053 6571 7565 6e63 6529 3a0d 0a20 2020   Sequence):..   
-000488d0: 2020 2020 2020 2020 206d 6f64 756c 6573           modules
-000488e0: 203d 205b 6d6f 6475 6c65 735d 0d0a 0d0a   = [modules]....
-000488f0: 2020 2020 2020 2020 666f 7220 6d6f 6475          for modu
-00048900: 6c65 2069 6e20 6d6f 6475 6c65 733a 0d0a  le in modules:..
-00048910: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00048920: 6f74 2069 7369 6e73 7461 6e63 6528 6d6f  ot isinstance(mo
-00048930: 6475 6c65 2c20 5465 6e73 6f72 4469 6374  dule, TensorDict
-00048940: 4d6f 6475 6c65 4261 7365 293a 0d0a 2020  ModuleBase):..  
-00048950: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00048960: 6973 6520 5661 6c75 6545 7272 6f72 280d  ise ValueError(.
-00048970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048980: 2020 2020 2066 2241 6c6c 206d 6f64 756c       f"All modul
-00048990: 6573 206d 7573 7420 6265 2054 656e 736f  es must be Tenso
-000489a0: 7244 6963 744d 6f64 756c 6573 2c20 6275  rDictModules, bu
-000489b0: 7420 6120 7b74 7970 6528 6d6f 6475 6c65  t a {type(module
-000489c0: 297d 2077 6173 2070 726f 7669 6465 642e  )} was provided.
-000489d0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-000489e0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
-000489f0: 696e 5f6b 6579 7320 3d20 7365 7428 290d  in_keys = set().
-00048a00: 0a20 2020 2020 2020 2066 6f72 206d 6f64  .        for mod
-00048a10: 756c 6520 696e 206d 6f64 756c 6573 3a0d  ule in modules:.
-00048a20: 0a20 2020 2020 2020 2020 2020 2069 6e5f  .            in_
-00048a30: 6b65 7973 2e75 7064 6174 6528 6d6f 6475  keys.update(modu
-00048a40: 6c65 2e69 6e5f 6b65 7973 290d 0a0d 0a20  le.in_keys).... 
-00048a50: 2020 2020 2020 2069 6620 6f75 745f 6b65         if out_ke
-00048a60: 7973 2069 7320 4e6f 6e65 3a0d 0a20 2020  ys is None:..   
-00048a70: 2020 2020 2020 2020 206f 7574 5f6b 6579           out_key
-00048a80: 7320 3d20 7365 7428 290d 0a20 2020 2020  s = set()..     
-00048a90: 2020 2020 2020 2066 6f72 206d 6f64 756c         for modul
-00048aa0: 6520 696e 206d 6f64 756c 6573 3a0d 0a20  e in modules:.. 
-00048ab0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00048ac0: 6f72 206b 6579 2069 6e20 6d6f 6475 6c65  or key in module
-00048ad0: 2e6f 7574 5f6b 6579 733a 0d0a 2020 2020  .out_keys:..    
-00048ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048af0: 6966 206b 6579 5b30 5d20 3d3d 2022 6e65  if key[0] == "ne
-00048b00: 7874 223a 0d0a 2020 2020 2020 2020 2020  xt":..          
-00048b10: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00048b20: 745f 6b65 7973 2e61 6464 286b 6579 5b31  t_keys.add(key[1
-00048b30: 5d29 0d0a 2020 2020 2020 2020 656c 7365  ])..        else
-00048b40: 3a0d 0a20 2020 2020 2020 2020 2020 206f  :..            o
-00048b50: 7574 5f6b 6579 735f 203d 2073 6574 2829  ut_keys_ = set()
-00048b60: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00048b70: 7220 6b65 7920 696e 206f 7574 5f6b 6579  r key in out_key
+00047090: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000470a0: 6974 2063 616e 2068 6170 7065 6e20 7468  it can happen th
+000470b0: 6174 2061 6c6c 2061 7265 2072 6573 6574  at all are reset
+000470c0: 2c20 696e 2077 6869 6368 2063 6173 650d  , in which case.
+000470d0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
+000470e0: 7427 7320 6669 6e65 2028 646f 6573 6e27  t's fine (doesn'
+000470f0: 7420 6e65 6564 2074 6f20 6d61 7463 6820  t need to match 
+00047100: 646f 6e65 290d 0a20 2020 2020 2020 2020  done)..         
+00047110: 2020 2061 6e64 206e 6f74 2072 6573 6574     and not reset
+00047120: 2e61 6c6c 2829 0d0a 2020 2020 2020 2020  .all()..        
+00047130: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00047140: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+00047150: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
+00047160: 2020 2020 2022 4361 6e6e 6f74 2070 6172       "Cannot par
+00047170: 7469 616c 6c79 2072 6573 6574 2061 2067  tially reset a g
+00047180: 796d 286e 6173 6975 6d29 2061 7379 6e63  ym(nasium) async
+00047190: 2065 6e76 2077 6974 6820 6120 220d 0a20   env with a ".. 
+000471a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000471b0: 7265 7365 7420 6d61 736b 2074 6861 7420  reset mask that 
+000471c0: 646f 6573 206e 6f74 206d 6174 6368 2074  does not match t
+000471d0: 6865 2064 6f6e 6520 6d61 736b 2e20 220d  he done mask. ".
+000471e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000471f0: 2066 2247 6f74 2072 6573 6574 3d7b 7265   f"Got reset={re
+00047200: 7365 747d 5c6e 616e 6420 646f 6e65 3d7b  set}\nand done={
+00047210: 646f 6e65 7d22 0d0a 2020 2020 2020 2020  done}"..        
+00047220: 2020 2020 290d 0a20 2020 2020 2020 2023      )..        #
+00047230: 2069 6620 6e6f 7420 7265 7365 742e 616e   if not reset.an
+00047240: 7928 292c 2077 6520 646f 6e27 7420 6e65  y(), we don't ne
+00047250: 6564 2074 6f20 646f 2061 6e79 7468 696e  ed to do anythin
+00047260: 672e 0d0a 2020 2020 2020 2020 2320 6966  g...        # if
+00047270: 2072 6573 6574 2e61 6c6c 2829 2c20 7765   reset.all(), we
+00047280: 2064 6f6e 2774 2065 6974 6865 7220 2862   don't either (b
+00047290: 6320 4779 6d57 7261 7070 6572 2077 696c  c GymWrapper wil
+000472a0: 6c20 6361 6c6c 2061 2070 6c61 696e 2072  l call a plain r
+000472b0: 6573 6574 292e 0d0a 2020 2020 2020 2020  eset)...        
+000472c0: 6966 2072 6573 6574 2069 7320 6e6f 7420  if reset is not 
+000472d0: 4e6f 6e65 2061 6e64 2072 6573 6574 2e61  None and reset.a
+000472e0: 6e79 2829 3a0d 0a20 2020 2020 2020 2020  ny():..         
+000472f0: 2020 2073 6176 6564 5f6e 6578 7420 3d20     saved_next = 
+00047300: 7365 6c66 2e5f 6d65 6d6f 5b22 7361 7665  self._memo["save
+00047310: 645f 6e65 7874 225d 0d0a 2020 2020 2020  d_next"]..      
+00047320: 2020 2020 2020 6966 2073 6176 6564 5f6e        if saved_n
+00047330: 6578 7420 6973 204e 6f6e 653a 0d0a 2020  ext is None:..  
+00047340: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00047350: 2072 6573 6574 2e61 6c6c 2829 3a0d 0a20   reset.all():.. 
+00047360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047370: 2020 2023 2057 6527 7265 2066 696e 653a     # We're fine:
+00047380: 2074 6869 7320 6d65 616e 7320 7468 6174   this means that
+00047390: 2061 2066 756c 6c20 7265 7365 7420 7761   a full reset wa
+000473a0: 7320 7061 7373 6564 2061 6e64 2074 6865  s passed and the
+000473b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000473c0: 2020 2020 2020 2320 656e 7620 7761 7320        # env was 
+000473d0: 6d61 6e75 616c 6c79 2072 6573 6574 0d0a  manually reset..
+000473e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000473f0: 2020 2020 7465 6e73 6f72 6469 6374 5f72      tensordict_r
+00047400: 6573 6574 2e70 6f70 2873 656c 662e 6669  eset.pop(self.fi
+00047410: 6e61 6c5f 6e61 6d65 2c20 4e6f 6e65 290d  nal_name, None).
+00047420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047430: 2020 2020 2072 6574 7572 6e20 7465 6e73       return tens
+00047440: 6f72 6469 6374 5f72 6573 6574 0d0a 2020  ordict_reset..  
+00047450: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00047460: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
+00047470: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00047480: 2020 2020 2020 2022 4469 6420 6e6f 7420         "Did not 
+00047490: 6669 6e64 2061 2073 6176 6564 2074 656e  find a saved ten
+000474a0: 736f 7264 6963 7420 7768 696c 6520 7468  sordict while th
+000474b0: 6520 7265 7365 7420 6d61 736b 2077 6173  e reset mask was
+000474c0: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+000474d0: 2020 2020 2020 2020 6622 6e6f 7420 656d          f"not em
+000474e0: 7074 793a 2072 6573 6574 3d7b 7265 7365  pty: reset={rese
+000474f0: 747d 2e20 446f 6e65 2077 6173 207b 646f  t}. Done was {do
+00047500: 6e65 7d2e 220d 0a20 2020 2020 2020 2020  ne}."..         
+00047510: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00047520: 2020 2020 2020 2320 7265 7365 7420 3d20        # reset = 
+00047530: 7265 7365 742e 7669 6577 2874 656e 736f  reset.view(tenso
+00047540: 7264 6963 742e 7368 6170 6529 0d0a 2020  rdict.shape)..  
+00047550: 2020 2020 2020 2020 2020 2320 7765 2068            # we h
+00047560: 6176 6520 6120 6461 7461 2063 6f6e 7461  ave a data conta
+00047570: 696e 6572 2066 726f 6d20 7468 6520 7072  iner from the pr
+00047580: 6576 696f 7573 2063 616c 6c20 746f 2073  evious call to s
+00047590: 7465 700d 0a20 2020 2020 2020 2020 2020  tep..           
+000475a0: 2023 2074 6861 7420 636f 6e74 6169 6e73   # that contains
+000475b0: 2070 6172 7420 6f66 2074 6865 206f 6273   part of the obs
+000475c0: 6572 7661 7469 6f6e 2077 6520 6e65 6564  ervation we need
+000475d0: 2e0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+000475e0: 2057 6520 6361 6e20 7361 6665 6c79 2070   We can safely p
+000475f0: 6c61 6365 2074 6865 6d20 6261 636b 2069  lace them back i
+00047600: 6e20 7468 6520 7265 7365 7420 7265 7375  n the reset resu
+00047610: 6c74 2074 656e 736f 7264 6963 743a 0d0a  lt tensordict:..
+00047620: 2020 2020 2020 2020 2020 2020 2320 696e              # in
+00047630: 2065 6e76 2e72 6f6c 6c6f 7574 2829 2c20   env.rollout(), 
+00047640: 7468 6520 7265 7375 6c74 206f 6620 7265  the result of re
+00047650: 7365 7428 2920 6973 2061 7373 756d 6564  set() is assumed
+00047660: 2074 6f20 6265 206a 7573 740d 0a20 2020   to be just..   
+00047670: 2020 2020 2020 2020 2023 2074 6865 2074           # the t
+00047680: 6420 6672 6f6d 2070 7265 7669 6f75 7320  d from previous 
+00047690: 7374 6570 2077 6974 6820 7570 6461 7465  step with update
+000476a0: 6420 7661 6c75 6573 2066 726f 6d20 7265  d values from re
+000476b0: 7365 742e 0d0a 2020 2020 2020 2020 2020  set...          
+000476c0: 2020 2320 496e 206f 7572 2063 6173 652c    # In our case,
+000476d0: 2069 7420 7769 6c6c 2061 6c77 6179 7320   it will always 
+000476e0: 6265 2074 6865 2063 6173 6520 7468 6174  be the case that
+000476f0: 2061 6c6c 2074 6865 7365 2076 616c 7565   all these value
+00047700: 730d 0a20 2020 2020 2020 2020 2020 2023  s..            #
+00047710: 2061 7265 2070 726f 7065 726c 7920 7365   are properly se
+00047720: 742e 0d0a 2020 2020 2020 2020 2020 2020  t...            
+00047730: 2320 636f 6c6c 6563 746f 7273 2065 7665  # collectors eve
+00047740: 6e20 7461 6b65 2063 6172 6520 6f66 2064  n take care of d
+00047750: 6f69 6e67 2061 6e20 6578 7472 6120 6d61  oing an extra ma
+00047760: 736b 696e 6720 736f 2069 7427 7320 6576  sking so it's ev
+00047770: 656e 0d0a 2020 2020 2020 2020 2020 2020  en..            
+00047780: 2320 7361 6665 722e 0d0a 2020 2020 2020  # safer...      
+00047790: 2020 2020 2020 7465 6e73 6f72 6469 6374        tensordict
+000477a0: 5f72 6573 6574 2e75 7064 6174 6528 7361  _reset.update(sa
+000477b0: 7665 645f 6e65 7874 290d 0a20 2020 2020  ved_next)..     
+000477c0: 2020 2020 2020 2066 6f72 2064 6f6e 655f         for done_
+000477d0: 6b65 7920 696e 2073 656c 662e 646f 6e65  key in self.done
+000477e0: 5f6b 6579 733a 0d0a 2020 2020 2020 2020  _keys:..        
+000477f0: 2020 2020 2020 2020 2320 4d61 6b65 2073          # Make s
+00047800: 7572 6520 7468 6174 2061 6c6c 2064 6f6e  ure that all don
+00047810: 6520 6172 6520 4661 6c73 650d 0a20 2020  e are False..   
+00047820: 2020 2020 2020 2020 2020 2020 2064 6f6e               don
+00047830: 6520 3d20 7465 6e73 6f72 6469 6374 2e67  e = tensordict.g
+00047840: 6574 2864 6f6e 655f 6b65 792c 204e 6f6e  et(done_key, Non
+00047850: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00047860: 2020 2020 6966 2064 6f6e 6520 6973 206e      if done is n
+00047870: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00047880: 2020 2020 2020 2020 2020 2020 2020 646f                do
+00047890: 6e65 203d 2064 6f6e 652e 636c 6f6e 6528  ne = done.clone(
+000478a0: 292e 6669 6c6c 5f28 3029 0d0a 2020 2020  ).fill_(0)..    
+000478b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000478c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000478d0: 2020 2020 2020 2064 6f6e 6520 3d20 746f         done = to
+000478e0: 7263 682e 7a65 726f 7328 0d0a 2020 2020  rch.zeros(..    
+000478f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047900: 2020 2020 282a 7465 6e73 6f72 6469 6374      (*tensordict
+00047910: 2e62 6174 6368 5f73 697a 652c 2031 292c  .batch_size, 1),
+00047920: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00047930: 2020 2020 2020 2020 2020 6465 7669 6365            device
+00047940: 3d74 656e 736f 7264 6963 742e 6465 7669  =tensordict.devi
+00047950: 6365 2c0d 0a20 2020 2020 2020 2020 2020  ce,..           
+00047960: 2020 2020 2020 2020 2020 2020 2064 7479               dty
+00047970: 7065 3d74 6f72 6368 2e62 6f6f 6c2c 0d0a  pe=torch.bool,..
+00047980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047990: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+000479a0: 2020 2020 2020 2074 656e 736f 7264 6963         tensordic
+000479b0: 742e 7365 7428 646f 6e65 5f6b 6579 2c20  t.set(done_key, 
+000479c0: 646f 6e65 290d 0a20 2020 2020 2020 2074  done)..        t
+000479d0: 656e 736f 7264 6963 745f 7265 7365 742e  ensordict_reset.
+000479e0: 706f 7028 7365 6c66 2e66 696e 616c 5f6e  pop(self.final_n
+000479f0: 616d 652c 204e 6f6e 6529 0d0a 2020 2020  ame, None)..    
+00047a00: 2020 2020 7265 7475 726e 2074 656e 736f      return tenso
+00047a10: 7264 6963 745f 7265 7365 740d 0a0d 0a20  rdict_reset.... 
+00047a20: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00047a30: 2020 6465 6620 646f 6e65 5f6b 6579 7328    def done_keys(
+00047a40: 7365 6c66 2920 2d3e 204c 6973 745b 4e65  self) -> List[Ne
+00047a50: 7374 6564 4b65 795d 3a0d 0a20 2020 2020  stedKey]:..     
+00047a60: 2020 206b 6579 7320 3d20 7365 6c66 2e5f     keys = self._
+00047a70: 5f64 6963 745f 5f2e 6765 7428 225f 646f  _dict__.get("_do
+00047a80: 6e65 5f6b 6579 7322 2c20 4e6f 6e65 290d  ne_keys", None).
+00047a90: 0a20 2020 2020 2020 2069 6620 6b65 7973  .        if keys
+00047aa0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00047ab0: 2020 2020 2020 206b 6579 7320 3d20 7365         keys = se
+00047ac0: 6c66 2e70 6172 656e 742e 646f 6e65 5f6b  lf.parent.done_k
+00047ad0: 6579 730d 0a20 2020 2020 2020 2020 2020  eys..           
+00047ae0: 2023 2077 6520 6a75 7374 2077 616e 7420   # we just want 
+00047af0: 7468 6520 2264 6f6e 6522 206b 6579 0d0a  the "done" key..
+00047b00: 2020 2020 2020 2020 2020 2020 5f64 6f6e              _don
+00047b10: 655f 6b65 7973 203d 205b 5d0d 0a20 2020  e_keys = []..   
+00047b20: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+00047b30: 2069 6e20 6b65 7973 3a0d 0a20 2020 2020   in keys:..     
+00047b40: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00047b50: 7420 6973 696e 7374 616e 6365 286b 6579  t isinstance(key
+00047b60: 2c20 7475 706c 6529 3a0d 0a20 2020 2020  , tuple):..     
+00047b70: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00047b80: 6579 203d 2028 6b65 792c 290d 0a20 2020  ey = (key,)..   
+00047b90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00047ba0: 6b65 795b 2d31 5d20 3d3d 2022 646f 6e65  key[-1] == "done
+00047bb0: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
+00047bc0: 2020 2020 2020 2020 5f64 6f6e 655f 6b65          _done_ke
+00047bd0: 7973 2e61 7070 656e 6428 756e 7261 7665  ys.append(unrave
+00047be0: 6c5f 6b65 7928 6b65 7929 290d 0a20 2020  l_key(key))..   
+00047bf0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00047c00: 6c65 6e28 5f64 6f6e 655f 6b65 7973 293a  len(_done_keys):
+00047c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00047c20: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
+00047c30: 7272 6f72 2822 436f 756c 6420 6e6f 7420  rror("Could not 
+00047c40: 6669 6e64 2061 2027 646f 6e65 2720 6b65  find a 'done' ke
+00047c50: 7920 696e 2074 6865 2065 6e76 2073 7065  y in the env spe
+00047c60: 6373 2e22 290d 0a20 2020 2020 2020 2020  cs.")..         
+00047c70: 2020 2073 656c 662e 5f64 6f6e 655f 6b65     self._done_ke
+00047c80: 7973 203d 205f 646f 6e65 5f6b 6579 730d  ys = _done_keys.
+00047c90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00047ca0: 6b65 7973 0d0a 0d0a 2020 2020 4070 726f  keys....    @pro
+00047cb0: 7065 7274 790d 0a20 2020 2064 6566 206f  perty..    def o
+00047cc0: 6273 5f6b 6579 7328 7365 6c66 2920 2d3e  bs_keys(self) ->
+00047cd0: 204c 6973 745b 4e65 7374 6564 4b65 795d   List[NestedKey]
+00047ce0: 3a0d 0a20 2020 2020 2020 206b 6579 7320  :..        keys 
+00047cf0: 3d20 7365 6c66 2e5f 5f64 6963 745f 5f2e  = self.__dict__.
+00047d00: 6765 7428 225f 6f62 735f 6b65 7973 222c  get("_obs_keys",
+00047d10: 204e 6f6e 6529 0d0a 2020 2020 2020 2020   None)..        
+00047d20: 6966 206b 6579 7320 6973 204e 6f6e 653a  if keys is None:
+00047d30: 0d0a 2020 2020 2020 2020 2020 2020 6b65  ..            ke
+00047d40: 7973 203d 206c 6973 7428 7365 6c66 2e70  ys = list(self.p
+00047d50: 6172 656e 742e 6f62 7365 7276 6174 696f  arent.observatio
+00047d60: 6e5f 7370 6563 2e6b 6579 7328 5472 7565  n_spec.keys(True
+00047d70: 2c20 5472 7565 2929 0d0a 2020 2020 2020  , True))..      
+00047d80: 2020 2020 2020 7365 6c66 2e5f 6f62 735f        self._obs_
+00047d90: 6b65 7973 203d 206b 6579 730d 0a20 2020  keys = keys..   
+00047da0: 2020 2020 2072 6574 7572 6e20 6b65 7973       return keys
+00047db0: 0d0a 0d0a 2020 2020 6465 6620 7472 616e  ....    def tran
+00047dc0: 7366 6f72 6d5f 6f62 7365 7276 6174 696f  sform_observatio
+00047dd0: 6e5f 7370 6563 2873 656c 662c 206f 6273  n_spec(self, obs
+00047de0: 6572 7661 7469 6f6e 5f73 7065 633a 2054  ervation_spec: T
+00047df0: 656e 736f 7253 7065 6329 202d 3e20 5465  ensorSpec) -> Te
+00047e00: 6e73 6f72 5370 6563 3a0d 0a20 2020 2020  nsorSpec:..     
+00047e10: 2020 2069 6620 7365 6c66 2e66 696e 616c     if self.final
+00047e20: 5f6e 616d 6520 696e 206f 6273 6572 7661  _name in observa
+00047e30: 7469 6f6e 5f73 7065 632e 6b65 7973 2854  tion_spec.keys(T
+00047e40: 7275 6529 3a0d 0a20 2020 2020 2020 2020  rue):..         
+00047e50: 2020 2064 656c 206f 6273 6572 7661 7469     del observati
+00047e60: 6f6e 5f73 7065 635b 7365 6c66 2e66 696e  on_spec[self.fin
+00047e70: 616c 5f6e 616d 655d 0d0a 2020 2020 2020  al_name]..      
+00047e80: 2020 7265 7475 726e 206f 6273 6572 7661    return observa
+00047e90: 7469 6f6e 5f73 7065 630d 0a0d 0a20 2020  tion_spec....   
+00047ea0: 2064 6566 2066 6f72 7761 7264 2873 656c   def forward(sel
+00047eb0: 662c 2074 656e 736f 7264 6963 743a 2054  f, tensordict: T
+00047ec0: 656e 736f 7244 6963 7442 6173 6529 202d  ensorDictBase) -
+00047ed0: 3e20 5465 6e73 6f72 4469 6374 4261 7365  > TensorDictBase
+00047ee0: 3a0d 0a20 2020 2020 2020 2072 6169 7365  :..        raise
+00047ef0: 2052 756e 7469 6d65 4572 726f 7228 464f   RuntimeError(FO
+00047f00: 5257 4152 445f 4e4f 545f 494d 504c 454d  RWARD_NOT_IMPLEM
+00047f10: 454e 5445 442e 666f 726d 6174 2874 7970  ENTED.format(typ
+00047f20: 6528 7365 6c66 2929 290d 0a0d 0a0d 0a63  e(self)))......c
+00047f30: 6c61 7373 2042 7572 6e49 6e54 7261 6e73  lass BurnInTrans
+00047f40: 666f 726d 2854 7261 6e73 666f 726d 293a  form(Transform):
+00047f50: 0d0a 2020 2020 2222 2254 7261 6e73 666f  ..    """Transfo
+00047f60: 726d 2074 6f20 7061 7274 6961 6c6c 7920  rm to partially 
+00047f70: 6275 726e 2d69 6e20 6461 7461 2073 6571  burn-in data seq
+00047f80: 7565 6e63 6573 2e0d 0a0d 0a20 2020 2054  uences.....    T
+00047f90: 6869 7320 7472 616e 7366 6f72 6d20 6973  his transform is
+00047fa0: 2075 7365 6675 6c20 746f 206f 6274 6169   useful to obtai
+00047fb0: 6e20 7570 2d74 6f2d 6461 7465 2072 6563  n up-to-date rec
+00047fc0: 7572 7265 6e74 2073 7461 7465 7320 7768  urrent states wh
+00047fd0: 656e 0d0a 2020 2020 7468 6579 2061 7265  en..    they are
+00047fe0: 206e 6f74 2061 7661 696c 6162 6c65 2e20   not available. 
+00047ff0: 4974 2062 7572 6e73 2d69 6e20 6120 6e75  It burns-in a nu
+00048000: 6d62 6572 206f 6620 7374 6570 7320 616c  mber of steps al
+00048010: 6f6e 6720 7468 6520 7469 6d65 2064 696d  ong the time dim
+00048020: 656e 7369 6f6e 0d0a 2020 2020 6672 6f6d  ension..    from
+00048030: 2073 616d 706c 6564 2073 6571 7565 6e74   sampled sequent
+00048040: 6961 6c20 6461 7461 2073 6c69 6365 7320  ial data slices 
+00048050: 616e 6420 7265 7475 7273 2074 6865 2072  and returs the r
+00048060: 656d 6169 6e69 6e67 2064 6174 6120 7365  emaining data se
+00048070: 7175 656e 6365 2077 6974 680d 0a20 2020  quence with..   
+00048080: 2074 6865 2062 7572 6e74 2d69 6e20 6461   the burnt-in da
+00048090: 7461 2069 6e20 6974 7320 696e 6974 6961  ta in its initia
+000480a0: 6c20 7469 6d65 2073 7465 702e 2054 6869  l time step. Thi
+000480b0: 7320 7472 616e 7366 6f72 6d20 6973 2069  s transform is i
+000480c0: 6e74 656e 6465 6420 746f 2062 6520 7573  ntended to be us
+000480d0: 6564 2061 7320 610d 0a20 2020 2072 6570  ed as a..    rep
+000480e0: 6c61 7920 6275 6666 6572 2074 7261 6e73  lay buffer trans
+000480f0: 666f 726d 2c20 6e6f 7420 6173 2061 6e20  form, not as an 
+00048100: 656e 7669 726f 6e6d 656e 7420 7472 616e  environment tran
+00048110: 7366 6f72 6d2e 0d0a 0d0a 2020 2020 4172  sform.....    Ar
+00048120: 6773 3a0d 0a20 2020 2020 2020 206d 6f64  gs:..        mod
+00048130: 756c 6573 2028 7365 7175 656e 6365 206f  ules (sequence o
+00048140: 6620 5465 6e73 6f72 4469 6374 4d6f 6475  f TensorDictModu
+00048150: 6c65 293a 2041 206c 6973 7420 6f66 206d  le): A list of m
+00048160: 6f64 756c 6573 2075 7365 6420 746f 2062  odules used to b
+00048170: 7572 6e2d 696e 2064 6174 6120 7365 7175  urn-in data sequ
+00048180: 656e 6365 732e 0d0a 2020 2020 2020 2020  ences...        
+00048190: 6275 726e 5f69 6e20 2869 6e74 293a 2054  burn_in (int): T
+000481a0: 6865 206e 756d 6265 7220 6f66 2074 696d  he number of tim
+000481b0: 6520 7374 6570 7320 746f 2062 7572 6e20  e steps to burn 
+000481c0: 696e 2e0d 0a20 2020 2020 2020 206f 7574  in...        out
+000481d0: 5f6b 6579 7320 2873 6571 7565 6e63 6520  _keys (sequence 
+000481e0: 6f66 204e 6573 7465 644b 6579 2c20 6f70  of NestedKey, op
+000481f0: 7469 6f6e 616c 293a 2064 6573 7469 6e61  tional): destina
+00048200: 7469 6f6e 206b 6579 732e 2044 6566 6175  tion keys. Defau
+00048210: 6c74 7320 746f 0d0a 2020 2020 2020 2020  lts to..        
+00048220: 616c 6c20 7468 6520 6d6f 6475 6c65 7320  all the modules 
+00048230: 606f 7574 5f6b 6579 7360 2074 6861 7420  `out_keys` that 
+00048240: 706f 696e 7420 746f 2074 6865 206e 6578  point to the nex
+00048250: 7420 7469 6d65 2073 7465 7020 2865 2e67  t time step (e.g
+00048260: 2e20 6022 6869 6464 656e 2260 2069 6620  . `"hidden"` if 
+00048270: 600d 0a20 2020 2020 2020 2028 226e 6578  `..        ("nex
+00048280: 7422 2c20 2268 6964 6465 6e22 2960 2069  t", "hidden")` i
+00048290: 7320 7061 7274 206f 6620 7468 6520 606f  s part of the `o
+000482a0: 7574 5f6b 6579 7360 206f 6620 6120 6d6f  ut_keys` of a mo
+000482b0: 6475 6c65 292e 0d0a 0d0a 2020 2020 2e2e  dule).....    ..
+000482c0: 206e 6f74 653a 3a0d 0a20 2020 2020 2020   note::..       
+000482d0: 2054 6869 7320 7472 616e 7366 6f72 6d20   This transform 
+000482e0: 6578 7065 6374 7320 6173 2069 6e70 7574  expects as input
+000482f0: 7320 5465 6e73 6f72 4469 6374 7320 7769  s TensorDicts wi
+00048300: 7468 2069 7473 206c 6173 7420 6469 6d65  th its last dime
+00048310: 6e73 696f 6e20 6265 696e 6720 7468 650d  nsion being the.
+00048320: 0a20 2020 2020 2020 2074 696d 6520 6469  .        time di
+00048330: 6d65 6e73 696f 6e2e 2049 7420 616c 736f  mension. It also
+00048340: 2020 6173 7375 6d65 7320 7468 6174 2061    assumes that a
+00048350: 6c6c 2070 726f 7669 6465 6420 6d6f 6475  ll provided modu
+00048360: 6c65 7320 6361 6e20 7072 6f63 6573 730d  les can process.
+00048370: 0a20 2020 2020 2020 2073 6571 7565 6e74  .        sequent
+00048380: 6961 6c20 6461 7461 2e0d 0a0d 0a20 2020  ial data.....   
+00048390: 2045 7861 6d70 6c65 733a 0d0a 2020 2020   Examples:..    
+000483a0: 2020 2020 3e3e 3e20 696d 706f 7274 2074      >>> import t
+000483b0: 6f72 6368 0d0a 2020 2020 2020 2020 3e3e  orch..        >>
+000483c0: 3e20 6672 6f6d 2074 656e 736f 7264 6963  > from tensordic
+000483d0: 7420 696d 706f 7274 2054 656e 736f 7244  t import TensorD
+000483e0: 6963 740d 0a20 2020 2020 2020 203e 3e3e  ict..        >>>
+000483f0: 2066 726f 6d20 746f 7263 6872 6c2e 656e   from torchrl.en
+00048400: 7673 2e74 7261 6e73 666f 726d 7320 696d  vs.transforms im
+00048410: 706f 7274 2042 7572 6e49 6e54 7261 6e73  port BurnInTrans
+00048420: 666f 726d 0d0a 2020 2020 2020 2020 3e3e  form..        >>
+00048430: 3e20 6672 6f6d 2074 6f72 6368 726c 2e6d  > from torchrl.m
+00048440: 6f64 756c 6573 2069 6d70 6f72 7420 4752  odules import GR
+00048450: 554d 6f64 756c 650d 0a20 2020 2020 2020  UModule..       
+00048460: 203e 3e3e 2067 7275 5f6d 6f64 756c 6520   >>> gru_module 
+00048470: 3d20 4752 554d 6f64 756c 6528 0d0a 2020  = GRUModule(..  
+00048480: 2020 2020 2020 2e2e 2e20 2020 2020 696e        ...     in
+00048490: 7075 745f 7369 7a65 3d31 302c 0d0a 2020  put_size=10,..  
+000484a0: 2020 2020 2020 2e2e 2e20 2020 2020 6869        ...     hi
+000484b0: 6464 656e 5f73 697a 653d 3130 2c0d 0a20  dden_size=10,.. 
+000484c0: 2020 2020 2020 202e 2e2e 2020 2020 2069         ...     i
+000484d0: 6e5f 6b65 7973 3d5b 226f 6273 6572 7661  n_keys=["observa
+000484e0: 7469 6f6e 222c 2022 6869 6464 656e 225d  tion", "hidden"]
+000484f0: 2c0d 0a20 2020 2020 2020 202e 2e2e 2020  ,..        ...  
+00048500: 2020 206f 7574 5f6b 6579 733d 5b22 696e     out_keys=["in
+00048510: 7465 726d 6564 6961 7465 222c 2028 226e  termediate", ("n
+00048520: 6578 7422 2c20 2268 6964 6465 6e22 295d  ext", "hidden")]
+00048530: 2c0d 0a20 2020 2020 2020 202e 2e2e 2029  ,..        ... )
+00048540: 2e73 6574 5f72 6563 7572 7265 6e74 5f6d  .set_recurrent_m
+00048550: 6f64 6528 5472 7565 290d 0a20 2020 2020  ode(True)..     
+00048560: 2020 203e 3e3e 2062 7572 6e5f 696e 5f74     >>> burn_in_t
+00048570: 7261 6e73 666f 726d 203d 2042 7572 6e49  ransform = BurnI
+00048580: 6e54 7261 6e73 666f 726d 280d 0a20 2020  nTransform(..   
+00048590: 2020 2020 202e 2e2e 2020 2020 206d 6f64       ...     mod
+000485a0: 756c 6573 3d5b 6772 755f 6d6f 6475 6c65  ules=[gru_module
+000485b0: 5d2c 0d0a 2020 2020 2020 2020 2e2e 2e20  ],..        ... 
+000485c0: 2020 2020 6275 726e 5f69 6e3d 352c 0d0a      burn_in=5,..
+000485d0: 2020 2020 2020 2020 2e2e 2e20 290d 0a20          ... ).. 
+000485e0: 2020 2020 2020 203e 3e3e 2074 6420 3d20         >>> td = 
+000485f0: 5465 6e73 6f72 4469 6374 287b 0d0a 2020  TensorDict({..  
+00048600: 2020 2020 2020 2e2e 2e20 2020 2020 226f        ...     "o
+00048610: 6273 6572 7661 7469 6f6e 223a 2074 6f72  bservation": tor
+00048620: 6368 2e72 616e 646e 2832 2c20 3130 2c20  ch.randn(2, 10, 
+00048630: 3130 292c 0d0a 2020 2020 2020 2020 2e2e  10),..        ..
+00048640: 2e20 2020 2020 2022 6869 6464 656e 223a  .      "hidden":
+00048650: 2074 6f72 6368 2e72 616e 646e 2832 2c20   torch.randn(2, 
+00048660: 3130 2c20 6772 755f 6d6f 6475 6c65 2e67  10, gru_module.g
+00048670: 7275 2e6e 756d 5f6c 6179 6572 732c 2031  ru.num_layers, 1
+00048680: 3029 2c0d 0a20 2020 2020 2020 202e 2e2e  0),..        ...
+00048690: 2020 2020 2020 2269 735f 696e 6974 223a        "is_init":
+000486a0: 2074 6f72 6368 2e7a 6572 6f73 2832 2c20   torch.zeros(2, 
+000486b0: 3130 2c20 3129 2c0d 0a20 2020 2020 2020  10, 1),..       
+000486c0: 202e 2e2e 207d 2c20 6261 7463 685f 7369   ... }, batch_si
+000486d0: 7a65 3d5b 322c 2031 305d 290d 0a20 2020  ze=[2, 10])..   
+000486e0: 2020 2020 203e 3e3e 2074 6420 3d20 6275       >>> td = bu
+000486f0: 726e 5f69 6e5f 7472 616e 7366 6f72 6d28  rn_in_transform(
+00048700: 7464 290d 0a20 2020 2020 2020 203e 3e3e  td)..        >>>
+00048710: 2074 642e 7368 6170 650d 0a20 2020 2020   td.shape..     
+00048720: 2020 2074 6f72 6368 2e53 697a 6528 5b32     torch.Size([2
+00048730: 2c20 355d 290d 0a20 2020 2020 2020 203e  , 5])..        >
+00048740: 3e3e 2074 642e 6765 7428 2268 6964 6465  >> td.get("hidde
+00048750: 6e22 292e 6162 7328 292e 7375 6d28 290d  n").abs().sum().
+00048760: 0a20 2020 2020 2020 2074 656e 736f 7228  .        tensor(
+00048770: 3836 2e33 3030 3829 0d0a 0d0a 2020 2020  86.3008)....    
+00048780: 2020 2020 3e3e 3e20 6672 6f6d 2074 6f72      >>> from tor
+00048790: 6368 726c 2e64 6174 6120 696d 706f 7274  chrl.data import
+000487a0: 204c 617a 794d 656d 6d61 7053 746f 7261   LazyMemmapStora
+000487b0: 6765 2c20 5465 6e73 6f72 4469 6374 5265  ge, TensorDictRe
+000487c0: 706c 6179 4275 6666 6572 0d0a 2020 2020  playBuffer..    
+000487d0: 2020 2020 3e3e 3e20 6275 6666 6572 203d      >>> buffer =
+000487e0: 2054 656e 736f 7244 6963 7452 6570 6c61   TensorDictRepla
+000487f0: 7942 7566 6665 7228 0d0a 2020 2020 2020  yBuffer(..      
+00048800: 2020 2e2e 2e20 2020 2020 7374 6f72 6167    ...     storag
+00048810: 653d 4c61 7a79 4d65 6d6d 6170 5374 6f72  e=LazyMemmapStor
+00048820: 6167 6528 3229 2c0d 0a20 2020 2020 2020  age(2),..       
+00048830: 202e 2e2e 2020 2020 2062 6174 6368 5f73   ...     batch_s
+00048840: 697a 653d 312c 0d0a 2020 2020 2020 2020  ize=1,..        
+00048850: 2e2e 2e20 290d 0a20 2020 2020 2020 203e  ... )..        >
+00048860: 3e3e 2062 7566 6665 722e 6170 7065 6e64  >> buffer.append
+00048870: 5f74 7261 6e73 666f 726d 2862 7572 6e5f  _transform(burn_
+00048880: 696e 5f74 7261 6e73 666f 726d 290d 0a20  in_transform).. 
+00048890: 2020 2020 2020 203e 3e3e 2074 6420 3d20         >>> td = 
+000488a0: 5465 6e73 6f72 4469 6374 287b 0d0a 2020  TensorDict({..  
+000488b0: 2020 2020 2020 2e2e 2e20 2020 2020 226f        ...     "o
+000488c0: 6273 6572 7661 7469 6f6e 223a 2074 6f72  bservation": tor
+000488d0: 6368 2e72 616e 646e 2832 2c20 3130 2c20  ch.randn(2, 10, 
+000488e0: 3130 292c 0d0a 2020 2020 2020 2020 2e2e  10),..        ..
+000488f0: 2e20 2020 2020 2022 6869 6464 656e 223a  .      "hidden":
+00048900: 2074 6f72 6368 2e72 616e 646e 2832 2c20   torch.randn(2, 
+00048910: 3130 2c20 6772 755f 6d6f 6475 6c65 2e67  10, gru_module.g
+00048920: 7275 2e6e 756d 5f6c 6179 6572 732c 2031  ru.num_layers, 1
+00048930: 3029 2c0d 0a20 2020 2020 2020 202e 2e2e  0),..        ...
+00048940: 2020 2020 2020 2269 735f 696e 6974 223a        "is_init":
+00048950: 2074 6f72 6368 2e7a 6572 6f73 2832 2c20   torch.zeros(2, 
+00048960: 3130 2c20 3129 2c0d 0a20 2020 2020 2020  10, 1),..       
+00048970: 202e 2e2e 207d 2c20 6261 7463 685f 7369   ... }, batch_si
+00048980: 7a65 3d5b 322c 2031 305d 290d 0a20 2020  ze=[2, 10])..   
+00048990: 2020 2020 203e 3e3e 2062 7566 6665 722e       >>> buffer.
+000489a0: 6578 7465 6e64 2874 6429 0d0a 2020 2020  extend(td)..    
+000489b0: 2020 2020 3e3e 3e20 7464 203d 2062 7566      >>> td = buf
+000489c0: 6665 722e 7361 6d70 6c65 2831 290d 0a20  fer.sample(1).. 
+000489d0: 2020 2020 2020 203e 3e3e 2074 642e 7368         >>> td.sh
+000489e0: 6170 650d 0a20 2020 2020 2020 2074 6f72  ape..        tor
+000489f0: 6368 2e53 697a 6528 5b31 2c20 355d 290d  ch.Size([1, 5]).
+00048a00: 0a20 2020 2020 2020 203e 3e3e 2074 642e  .        >>> td.
+00048a10: 6765 7428 2268 6964 6465 6e22 292e 6162  get("hidden").ab
+00048a20: 7328 292e 7375 6d28 290d 0a20 2020 2020  s().sum()..     
+00048a30: 2020 2074 656e 736f 7228 3337 2e30 3334     tensor(37.034
+00048a40: 3429 0d0a 2020 2020 2222 220d 0a0d 0a20  4)..    """.... 
+00048a50: 2020 2069 6e76 6572 7469 626c 6520 3d20     invertible = 
+00048a60: 4661 6c73 650d 0a0d 0a20 2020 2064 6566  False....    def
+00048a70: 205f 5f69 6e69 745f 5f28 0d0a 2020 2020   __init__(..    
+00048a80: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
+00048a90: 2020 206d 6f64 756c 6573 3a20 5365 7175     modules: Sequ
+00048aa0: 656e 6365 5b54 656e 736f 7244 6963 744d  ence[TensorDictM
+00048ab0: 6f64 756c 6542 6173 655d 2c0d 0a20 2020  oduleBase],..   
+00048ac0: 2020 2020 2062 7572 6e5f 696e 3a20 696e       burn_in: in
+00048ad0: 742c 0d0a 2020 2020 2020 2020 6f75 745f  t,..        out_
+00048ae0: 6b65 7973 3a20 5365 7175 656e 6365 5b4e  keys: Sequence[N
+00048af0: 6573 7465 644b 6579 5d20 7c20 4e6f 6e65  estedKey] | None
+00048b00: 203d 204e 6f6e 652c 0d0a 2020 2020 293a   = None,..    ):
+00048b10: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00048b20: 2069 7369 6e73 7461 6e63 6528 6d6f 6475   isinstance(modu
+00048b30: 6c65 732c 2053 6571 7565 6e63 6529 3a0d  les, Sequence):.
+00048b40: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+00048b50: 756c 6573 203d 205b 6d6f 6475 6c65 735d  ules = [modules]
+00048b60: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
+00048b70: 6d6f 6475 6c65 2069 6e20 6d6f 6475 6c65  module in module
 00048b80: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00048b90: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00048ba0: 6528 6b65 792c 2074 7570 6c65 2920 616e  e(key, tuple) an
-00048bb0: 6420 6b65 795b 305d 203d 3d20 226e 6578  d key[0] == "nex
-00048bc0: 7422 3a0d 0a20 2020 2020 2020 2020 2020  t":..           
-00048bd0: 2020 2020 2020 2020 206b 6579 203d 206b           key = k
-00048be0: 6579 5b31 5d0d 0a20 2020 2020 2020 2020  ey[1]..         
-00048bf0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00048c00: 6e67 732e 7761 726e 280d 0a20 2020 2020  ngs.warn(..     
-00048c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048c20: 2020 2066 2254 6865 2027 6e65 7874 2720     f"The 'next' 
-00048c30: 6b65 7920 6973 206e 6f74 206e 6565 6465  key is not neede
-00048c40: 6420 696e 2074 6865 2042 7572 6e49 6e54  d in the BurnInT
-00048c50: 7261 6e73 666f 726d 2060 6f75 745f 6b65  ransform `out_ke
-00048c60: 7960 207b 6b65 797d 2061 6e64 2022 0d0a  y` {key} and "..
-00048c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048c80: 2020 2020 2020 2020 6622 7769 6c6c 2062          f"will b
-00048c90: 6520 6967 6e6f 7265 642e 2054 6869 7320  e ignored. This 
-00048ca0: 7472 616e 7366 6f72 6d20 616c 7265 6164  transform alread
-00048cb0: 7920 6173 7375 6d65 7320 7468 6174 2060  y assumes that `
-00048cc0: 6f75 745f 6b65 7973 6020 7769 6c6c 2062  out_keys` will b
-00048cd0: 6520 220d 0a20 2020 2020 2020 2020 2020  e "..           
-00048ce0: 2020 2020 2020 2020 2020 2020 2066 2272               f"r
-00048cf0: 6574 7269 6576 6564 2066 726f 6d20 7468  etrieved from th
-00048d00: 6520 6e65 7874 2074 696d 6520 7374 6570  e next time step
-00048d10: 206f 6620 7468 6520 6275 726e 742d 696e   of the burnt-in
-00048d20: 2064 6174 612e 220d 0a20 2020 2020 2020   data."..       
-00048d30: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00048d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048d50: 6f75 745f 6b65 7973 5f2e 6164 6428 6b65  out_keys_.add(ke
-00048d60: 7929 0d0a 2020 2020 2020 2020 2020 2020  y)..            
-00048d70: 6f75 745f 6b65 7973 203d 206f 7574 5f6b  out_keys = out_k
-00048d80: 6579 735f 0d0a 0d0a 2020 2020 2020 2020  eys_....        
-00048d90: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
-00048da0: 2869 6e5f 6b65 7973 3d69 6e5f 6b65 7973  (in_keys=in_keys
-00048db0: 2c20 6f75 745f 6b65 7973 3d6f 7574 5f6b  , out_keys=out_k
-00048dc0: 6579 7329 0d0a 2020 2020 2020 2020 7365  eys)..        se
-00048dd0: 6c66 2e6d 6f64 756c 6573 203d 206d 6f64  lf.modules = mod
-00048de0: 756c 6573 0d0a 2020 2020 2020 2020 7365  ules..        se
-00048df0: 6c66 2e62 7572 6e5f 696e 203d 2062 7572  lf.burn_in = bur
-00048e00: 6e5f 696e 0d0a 0d0a 2020 2020 6465 6620  n_in....    def 
-00048e10: 5f63 616c 6c28 7365 6c66 2c20 7465 6e73  _call(self, tens
-00048e20: 6f72 6469 6374 3a20 5465 6e73 6f72 4469  ordict: TensorDi
-00048e30: 6374 4261 7365 2920 2d3e 2054 656e 736f  ctBase) -> Tenso
-00048e40: 7244 6963 7442 6173 653a 0d0a 2020 2020  rDictBase:..    
-00048e50: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
-00048e60: 6545 7272 6f72 2822 4275 726e 496e 5472  eError("BurnInTr
-00048e70: 616e 7366 6f72 6d20 6361 6e20 6f6e 6c79  ansform can only
-00048e80: 2062 6520 6170 7065 6e64 6564 2074 6f20   be appended to 
-00048e90: 6120 5265 706c 6179 4275 6666 6572 2229  a ReplayBuffer")
-00048ea0: 0d0a 0d0a 2020 2020 6465 6620 5f73 7465  ....    def _ste
-00048eb0: 7028 0d0a 2020 2020 2020 2020 7365 6c66  p(..        self
-00048ec0: 2c20 7465 6e73 6f72 6469 6374 3a20 5465  , tensordict: Te
-00048ed0: 6e73 6f72 4469 6374 4261 7365 2c20 6e65  nsorDictBase, ne
-00048ee0: 7874 5f74 656e 736f 7264 6963 743a 2054  xt_tensordict: T
-00048ef0: 656e 736f 7244 6963 7442 6173 650d 0a20  ensorDictBase.. 
-00048f00: 2020 2029 202d 3e20 5465 6e73 6f72 4469     ) -> TensorDi
-00048f10: 6374 4261 7365 3a0d 0a20 2020 2020 2020  ctBase:..       
-00048f20: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
-00048f30: 726f 7228 2242 7572 6e49 6e54 7261 6e73  ror("BurnInTrans
-00048f40: 666f 726d 2063 616e 206f 6e6c 7920 6265  form can only be
-00048f50: 2061 7070 656e 6465 6420 746f 2061 2052   appended to a R
-00048f60: 6570 6c61 7942 7566 6665 722e 2229 0d0a  eplayBuffer.")..
-00048f70: 0d0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-00048f80: 6428 7365 6c66 2c20 7465 6e73 6f72 6469  d(self, tensordi
-00048f90: 6374 3a20 5465 6e73 6f72 4469 6374 4261  ct: TensorDictBa
-00048fa0: 7365 2920 2d3e 2054 656e 736f 7244 6963  se) -> TensorDic
-00048fb0: 7442 6173 653a 0d0a 0d0a 2020 2020 2020  tBase:....      
-00048fc0: 2020 6966 2073 656c 662e 6275 726e 5f69    if self.burn_i
-00048fd0: 6e20 3d3d 2030 3a0d 0a20 2020 2020 2020  n == 0:..       
-00048fe0: 2020 2020 2072 6574 7572 6e20 7465 6e73       return tens
-00048ff0: 6f72 6469 6374 0d0a 0d0a 2020 2020 2020  ordict....      
-00049000: 2020 7464 5f64 6576 6963 6520 3d20 7465    td_device = te
-00049010: 6e73 6f72 6469 6374 2e64 6576 6963 650d  nsordict.device.
-00049020: 0a20 2020 2020 2020 2042 2c20 542c 202a  .        B, T, *
-00049030: 6578 7472 615f 6469 6d73 203d 2074 656e  extra_dims = ten
-00049040: 736f 7264 6963 742e 6261 7463 685f 7369  sordict.batch_si
-00049050: 7a65 0d0a 0d0a 2020 2020 2020 2020 2320  ze....        # 
-00049060: 5370 6c69 7420 7468 6520 7465 6e73 6f72  Split the tensor
-00049070: 2064 6963 7420 696e 746f 2062 7572 6e2d   dict into burn-
-00049080: 696e 2064 6174 6120 616e 6420 7468 6520  in data and the 
-00049090: 7265 7374 2e0d 0a20 2020 2020 2020 2074  rest...        t
-000490a0: 645f 6275 726e 5f69 6e20 3d20 7465 6e73  d_burn_in = tens
-000490b0: 6f72 6469 6374 5b2e 2e2e 2c20 3a20 7365  ordict[..., : se
-000490c0: 6c66 2e62 7572 6e5f 696e 5d0d 0a20 2020  lf.burn_in]..   
-000490d0: 2020 2020 2074 645f 6f75 7420 3d20 7465       td_out = te
-000490e0: 6e73 6f72 6469 6374 5b2e 2e2e 2c20 7365  nsordict[..., se
-000490f0: 6c66 2e62 7572 6e5f 696e 203a 5d0d 0a0d  lf.burn_in :]...
-00049100: 0a20 2020 2020 2020 2023 2042 7572 6e20  .        # Burn 
-00049110: 696e 2074 6865 2072 6563 7572 7265 6e74  in the recurrent
-00049120: 2073 7461 7465 2e0d 0a20 2020 2020 2020   state...       
-00049130: 2077 6974 6820 746f 7263 682e 6e6f 5f67   with torch.no_g
-00049140: 7261 6428 293a 0d0a 2020 2020 2020 2020  rad():..        
-00049150: 2020 2020 666f 7220 6d6f 6475 6c65 2069      for module i
-00049160: 6e20 7365 6c66 2e6d 6f64 756c 6573 3a0d  n self.modules:.
-00049170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00049180: 206d 6f64 756c 655f 6465 7669 6365 203d   module_device =
-00049190: 206e 6578 7428 6d6f 6475 6c65 2e70 6172   next(module.par
-000491a0: 616d 6574 6572 7328 2929 2e64 6576 6963  ameters()).devic
-000491b0: 6520 6f72 204e 6f6e 650d 0a20 2020 2020  e or None..     
-000491c0: 2020 2020 2020 2020 2020 2074 645f 6275             td_bu
-000491d0: 726e 5f69 6e20 3d20 7464 5f62 7572 6e5f  rn_in = td_burn_
-000491e0: 696e 2e74 6f28 6d6f 6475 6c65 5f64 6576  in.to(module_dev
-000491f0: 6963 6529 0d0a 2020 2020 2020 2020 2020  ice)..          
-00049200: 2020 2020 2020 7464 5f62 7572 6e5f 696e        td_burn_in
-00049210: 203d 206d 6f64 756c 6528 7464 5f62 7572   = module(td_bur
-00049220: 6e5f 696e 290d 0a20 2020 2020 2020 2074  n_in)..        t
-00049230: 645f 6275 726e 5f69 6e20 3d20 7464 5f62  d_burn_in = td_b
-00049240: 7572 6e5f 696e 2e74 6f28 7464 5f64 6576  urn_in.to(td_dev
-00049250: 6963 6529 0d0a 0d0a 2020 2020 2020 2020  ice)....        
-00049260: 2320 5570 6461 7465 206f 7574 2054 656e  # Update out Ten
-00049270: 736f 7244 6963 7420 7769 7468 2074 6865  sorDict with the
-00049280: 2062 7572 6e74 2d69 6e20 6461 7461 2e0d   burnt-in data..
-00049290: 0a20 2020 2020 2020 2066 6f72 206f 7574  .        for out
-000492a0: 5f6b 6579 2069 6e20 7365 6c66 2e6f 7574  _key in self.out
-000492b0: 5f6b 6579 733a 0d0a 2020 2020 2020 2020  _keys:..        
-000492c0: 2020 2020 6966 206f 7574 5f6b 6579 206e      if out_key n
-000492d0: 6f74 2069 6e20 7464 5f6f 7574 2e6b 6579  ot in td_out.key
-000492e0: 7328 696e 636c 7564 655f 6e65 7374 6564  s(include_nested
-000492f0: 3d54 7275 6529 3a0d 0a20 2020 2020 2020  =True):..       
-00049300: 2020 2020 2020 2020 2074 645f 6f75 742e           td_out.
-00049310: 7365 7428 0d0a 2020 2020 2020 2020 2020  set(..          
-00049320: 2020 2020 2020 2020 2020 6f75 745f 6b65            out_ke
-00049330: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
-00049340: 2020 2020 2020 2020 746f 7263 682e 7a65          torch.ze
-00049350: 726f 7328 0d0a 2020 2020 2020 2020 2020  ros(..          
-00049360: 2020 2020 2020 2020 2020 2020 2020 422c                B,
-00049370: 2054 202d 2073 656c 662e 6275 726e 5f69   T - self.burn_i
-00049380: 6e2c 202a 7465 6e73 6f72 6469 6374 2e67  n, *tensordict.g
-00049390: 6574 286f 7574 5f6b 6579 292e 7368 6170  et(out_key).shap
-000493a0: 655b 323a 5d0d 0a20 2020 2020 2020 2020  e[2:]..         
-000493b0: 2020 2020 2020 2020 2020 2029 2c0d 0a20             ),.. 
-000493c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000493d0: 0d0a 2020 2020 2020 2020 2020 2020 7464  ..            td
-000493e0: 5f6f 7574 5b2e 2e2e 2c20 305d 5b6f 7574  _out[..., 0][out
-000493f0: 5f6b 6579 5d2e 636f 7079 5f28 7464 5f62  _key].copy_(td_b
-00049400: 7572 6e5f 696e 5b22 6e65 7874 225d 5b2e  urn_in["next"][.
-00049410: 2e2e 2c20 2d31 5d5b 6f75 745f 6b65 795d  .., -1][out_key]
-00049420: 290d 0a0d 0a20 2020 2020 2020 2072 6574  )....        ret
-00049430: 7572 6e20 7464 5f6f 7574 0d0a 0d0a 2020  urn td_out....  
-00049440: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
-00049450: 656c 6629 202d 3e20 7374 723a 0d0a 2020  elf) -> str:..  
-00049460: 2020 2020 2020 7265 7475 726e 2066 227b        return f"{
-00049470: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
-00049480: 5f6e 616d 655f 5f7d 2862 7572 6e5f 696e  _name__}(burn_in
-00049490: 3d7b 7365 6c66 2e62 7572 6e5f 696e 7d2c  ={self.burn_in},
-000494a0: 2069 6e5f 6b65 7973 3d7b 7365 6c66 2e69   in_keys={self.i
-000494b0: 6e5f 6b65 7973 7d2c 206f 7574 5f6b 6579  n_keys}, out_key
-000494c0: 733d 7b73 656c 662e 6f75 745f 6b65 7973  s={self.out_keys
-000494d0: 7d29 220d 0a0d 0a0d 0a63 6c61 7373 2053  })"......class S
-000494e0: 6967 6e54 7261 6e73 666f 726d 2854 7261  ignTransform(Tra
-000494f0: 6e73 666f 726d 293a 0d0a 2020 2020 2222  nsform):..    ""
-00049500: 2241 2074 7261 6e73 666f 726d 2074 6f20  "A transform to 
-00049510: 636f 6d70 7574 6520 7468 6520 7369 676e  compute the sign
-00049520: 7320 6f66 2054 656e 736f 7244 6963 7420  s of TensorDict 
-00049530: 7661 6c75 6573 2e0d 0a0d 0a20 2020 2054  values.....    T
-00049540: 6869 7320 7472 616e 7366 6f72 6d20 7265  his transform re
-00049550: 6164 7320 7468 6520 7465 6e73 6f72 7320  ads the tensors 
-00049560: 696e 2060 6069 6e5f 6b65 7973 6060 2061  in ``in_keys`` a
-00049570: 6e64 2060 6069 6e5f 6b65 7973 5f69 6e76  nd ``in_keys_inv
-00049580: 6060 2c20 636f 6d70 7574 6573 2074 6865  ``, computes the
-00049590: 0d0a 2020 2020 7369 676e 7320 6f66 2074  ..    signs of t
-000495a0: 6865 6972 2065 6c65 6d65 6e74 7320 616e  heir elements an
-000495b0: 6420 7772 6974 6573 2074 6865 2072 6573  d writes the res
-000495c0: 756c 7469 6e67 2073 6967 6e20 7465 6e73  ulting sign tens
-000495d0: 6f72 7320 746f 2060 606f 7574 5f6b 6579  ors to ``out_key
-000495e0: 7360 6020 616e 640d 0a20 2020 2060 606f  s`` and..    ``o
-000495f0: 7574 5f6b 6579 735f 696e 7660 6020 7265  ut_keys_inv`` re
-00049600: 7370 6563 7469 7665 6c79 2e0d 0a0d 0a20  spectively..... 
-00049610: 2020 2041 7267 733a 0d0a 2020 2020 2020     Args:..      
-00049620: 2020 696e 5f6b 6579 7320 286c 6973 7420    in_keys (list 
-00049630: 6f66 204e 6573 7465 644b 6579 7329 3a20  of NestedKeys): 
-00049640: 696e 7075 7420 656e 7472 6965 7320 2872  input entries (r
-00049650: 6561 6429 0d0a 2020 2020 2020 2020 6f75  ead)..        ou
-00049660: 745f 6b65 7973 2028 6c69 7374 206f 6620  t_keys (list of 
-00049670: 4e65 7374 6564 4b65 7973 293a 2069 6e70  NestedKeys): inp
-00049680: 7574 2065 6e74 7269 6573 2028 7772 6974  ut entries (writ
-00049690: 6529 0d0a 2020 2020 2020 2020 696e 5f6b  e)..        in_k
-000496a0: 6579 735f 696e 7620 286c 6973 7420 6f66  eys_inv (list of
-000496b0: 204e 6573 7465 644b 6579 7329 3a20 696e   NestedKeys): in
-000496c0: 7075 7420 656e 7472 6965 7320 2872 6561  put entries (rea
-000496d0: 6429 2064 7572 696e 6720 3a6d 6574 683a  d) during :meth:
-000496e0: 607e 2e69 6e76 6020 6361 6c6c 732e 0d0a  `~.inv` calls...
-000496f0: 2020 2020 2020 2020 6f75 745f 6b65 7973          out_keys
-00049700: 5f69 6e76 2028 6c69 7374 206f 6620 4e65  _inv (list of Ne
-00049710: 7374 6564 4b65 7973 293a 2069 6e70 7574  stedKeys): input
-00049720: 2065 6e74 7269 6573 2028 7772 6974 6529   entries (write)
-00049730: 2064 7572 696e 6720 3a6d 6574 683a 607e   during :meth:`~
-00049740: 2e69 6e76 6020 6361 6c6c 732e 0d0a 0d0a  .inv` calls.....
-00049750: 2020 2020 4578 616d 706c 6573 3a0d 0a20      Examples:.. 
-00049760: 2020 2020 2020 203e 3e3e 2066 726f 6d20         >>> from 
-00049770: 746f 7263 6872 6c2e 656e 7673 2069 6d70  torchrl.envs imp
-00049780: 6f72 7420 4779 6d45 6e76 2c20 5472 616e  ort GymEnv, Tran
-00049790: 7366 6f72 6d65 6445 6e76 2c20 5369 676e  sformedEnv, Sign
-000497a0: 5472 616e 7366 6f72 6d0d 0a20 2020 2020  Transform..     
-000497b0: 2020 203e 3e3e 2062 6173 655f 656e 7620     >>> base_env 
-000497c0: 3d20 4779 6d45 6e76 2822 5065 6e64 756c  = GymEnv("Pendul
-000497d0: 756d 2d76 3122 290d 0a20 2020 2020 2020  um-v1")..       
-000497e0: 203e 3e3e 2065 6e76 203d 2054 7261 6e73   >>> env = Trans
-000497f0: 666f 726d 6564 456e 7628 6261 7365 5f65  formedEnv(base_e
-00049800: 6e76 2c20 5369 676e 5472 616e 7366 6f72  nv, SignTransfor
-00049810: 6d28 696e 5f6b 6579 733d 5b27 6f62 7365  m(in_keys=['obse
-00049820: 7276 6174 696f 6e27 5d29 290d 0a20 2020  rvation']))..   
-00049830: 2020 2020 203e 3e3e 2072 203d 2065 6e76       >>> r = env
-00049840: 2e72 6f6c 6c6f 7574 2831 3030 290d 0a20  .rollout(100).. 
-00049850: 2020 2020 2020 203e 3e3e 206f 6273 203d         >>> obs =
-00049860: 2072 5b22 6f62 7365 7276 6174 696f 6e22   r["observation"
-00049870: 5d0d 0a20 2020 2020 2020 203e 3e3e 2061  ]..        >>> a
-00049880: 7373 6572 7420 2874 6f72 6368 2e6c 6f67  ssert (torch.log
-00049890: 6963 616c 5f6f 7228 746f 7263 682e 6c6f  ical_or(torch.lo
-000498a0: 6769 6361 6c5f 6f72 286f 6273 203d 3d20  gical_or(obs == 
-000498b0: 2d31 2c20 6f62 7320 3d3d 2031 292c 206f  -1, obs == 1), o
-000498c0: 6273 203d 3d20 302e 3029 292e 616c 6c28  bs == 0.0)).all(
-000498d0: 290d 0a20 2020 2022 2222 0d0a 0d0a 2020  )..    """....  
-000498e0: 2020 6465 6620 5f5f 696e 6974 5f5f 280d    def __init__(.
-000498f0: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
-00049900: 2020 2020 2020 2020 696e 5f6b 6579 733d          in_keys=
-00049910: 4e6f 6e65 2c0d 0a20 2020 2020 2020 206f  None,..        o
-00049920: 7574 5f6b 6579 733d 4e6f 6e65 2c0d 0a20  ut_keys=None,.. 
-00049930: 2020 2020 2020 2069 6e5f 6b65 7973 5f69         in_keys_i
-00049940: 6e76 3d4e 6f6e 652c 0d0a 2020 2020 2020  nv=None,..      
-00049950: 2020 6f75 745f 6b65 7973 5f69 6e76 3d4e    out_keys_inv=N
-00049960: 6f6e 652c 0d0a 2020 2020 293a 0d0a 2020  one,..    ):..  
-00049970: 2020 2020 2020 6966 2069 6e5f 6b65 7973        if in_keys
-00049980: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00049990: 2020 2020 2020 2069 6e5f 6b65 7973 203d         in_keys =
-000499a0: 205b 5d0d 0a20 2020 2020 2020 2069 6620   []..        if 
-000499b0: 6f75 745f 6b65 7973 2069 7320 4e6f 6e65  out_keys is None
-000499c0: 3a0d 0a20 2020 2020 2020 2020 2020 206f  :..            o
-000499d0: 7574 5f6b 6579 7320 3d20 636f 7079 2869  ut_keys = copy(i
-000499e0: 6e5f 6b65 7973 290d 0a20 2020 2020 2020  n_keys)..       
-000499f0: 2069 6620 696e 5f6b 6579 735f 696e 7620   if in_keys_inv 
-00049a00: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00049a10: 2020 2020 2020 696e 5f6b 6579 735f 696e        in_keys_in
-00049a20: 7620 3d20 5b5d 0d0a 2020 2020 2020 2020  v = []..        
-00049a30: 6966 206f 7574 5f6b 6579 735f 696e 7620  if out_keys_inv 
-00049a40: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00049a50: 2020 2020 2020 6f75 745f 6b65 7973 5f69        out_keys_i
-00049a60: 6e76 203d 2063 6f70 7928 696e 5f6b 6579  nv = copy(in_key
-00049a70: 735f 696e 7629 0d0a 2020 2020 2020 2020  s_inv)..        
-00049a80: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
-00049a90: 2869 6e5f 6b65 7973 2c20 6f75 745f 6b65  (in_keys, out_ke
-00049aa0: 7973 2c20 696e 5f6b 6579 735f 696e 762c  ys, in_keys_inv,
-00049ab0: 206f 7574 5f6b 6579 735f 696e 7629 0d0a   out_keys_inv)..
-00049ac0: 0d0a 2020 2020 6465 6620 5f61 7070 6c79  ..    def _apply
-00049ad0: 5f74 7261 6e73 666f 726d 2873 656c 662c  _transform(self,
-00049ae0: 206f 6273 3a20 746f 7263 682e 5465 6e73   obs: torch.Tens
-00049af0: 6f72 2920 2d3e 2074 6f72 6368 2e54 656e  or) -> torch.Ten
-00049b00: 736f 723a 0d0a 2020 2020 2020 2020 7265  sor:..        re
-00049b10: 7475 726e 206f 6273 2e73 6967 6e28 290d  turn obs.sign().
-00049b20: 0a0d 0a20 2020 2064 6566 205f 696e 765f  ...    def _inv_
-00049b30: 6170 706c 795f 7472 616e 7366 6f72 6d28  apply_transform(
-00049b40: 7365 6c66 2c20 7374 6174 653a 2074 6f72  self, state: tor
-00049b50: 6368 2e54 656e 736f 7229 202d 3e20 746f  ch.Tensor) -> to
-00049b60: 7263 682e 5465 6e73 6f72 3a0d 0a20 2020  rch.Tensor:..   
-00049b70: 2020 2020 2072 6574 7572 6e20 7374 6174       return stat
-00049b80: 652e 7369 676e 2829 0d0a 0d0a 2020 2020  e.sign()....    
-00049b90: 405f 6170 706c 795f 746f 5f63 6f6d 706f  @_apply_to_compo
-00049ba0: 7369 7465 0d0a 2020 2020 6465 6620 7472  site..    def tr
-00049bb0: 616e 7366 6f72 6d5f 6f62 7365 7276 6174  ansform_observat
-00049bc0: 696f 6e5f 7370 6563 2873 656c 662c 206f  ion_spec(self, o
-00049bd0: 6273 6572 7661 7469 6f6e 5f73 7065 633a  bservation_spec:
-00049be0: 2054 656e 736f 7253 7065 6329 202d 3e20   TensorSpec) -> 
-00049bf0: 5465 6e73 6f72 5370 6563 3a0d 0a20 2020  TensorSpec:..   
-00049c00: 2020 2020 2072 6574 7572 6e20 426f 756e       return Boun
-00049c10: 6465 6454 656e 736f 7253 7065 6328 0d0a  dedTensorSpec(..
-00049c20: 2020 2020 2020 2020 2020 2020 7368 6170              shap
-00049c30: 653d 6f62 7365 7276 6174 696f 6e5f 7370  e=observation_sp
-00049c40: 6563 2e73 6861 7065 2c0d 0a20 2020 2020  ec.shape,..     
-00049c50: 2020 2020 2020 2064 6576 6963 653d 6f62         device=ob
-00049c60: 7365 7276 6174 696f 6e5f 7370 6563 2e64  servation_spec.d
-00049c70: 6576 6963 652c 0d0a 2020 2020 2020 2020  evice,..        
-00049c80: 2020 2020 6474 7970 653d 6f62 7365 7276      dtype=observ
-00049c90: 6174 696f 6e5f 7370 6563 2e64 7479 7065  ation_spec.dtype
-00049ca0: 2c0d 0a20 2020 2020 2020 2020 2020 2068  ,..            h
-00049cb0: 6967 683d 312e 302c 0d0a 2020 2020 2020  igh=1.0,..      
-00049cc0: 2020 2020 2020 6c6f 773d 2d31 2e30 2c0d        low=-1.0,.
-00049cd0: 0a20 2020 2020 2020 2029 0d0a 0d0a 2020  .        )....  
-00049ce0: 2020 6465 6620 7472 616e 7366 6f72 6d5f    def transform_
-00049cf0: 7265 7761 7264 5f73 7065 6328 7365 6c66  reward_spec(self
-00049d00: 2c20 7265 7761 7264 5f73 7065 633a 2054  , reward_spec: T
-00049d10: 656e 736f 7253 7065 6329 202d 3e20 5465  ensorSpec) -> Te
-00049d20: 6e73 6f72 5370 6563 3a0d 0a20 2020 2020  nsorSpec:..     
-00049d30: 2020 2066 6f72 206b 6579 2069 6e20 7365     for key in se
-00049d40: 6c66 2e69 6e5f 6b65 7973 3a0d 0a20 2020  lf.in_keys:..   
-00049d50: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-00049d60: 696e 2073 656c 662e 7061 7265 6e74 2e72  in self.parent.r
-00049d70: 6577 6172 645f 6b65 7973 3a0d 0a20 2020  eward_keys:..   
-00049d80: 2020 2020 2020 2020 2020 2020 2073 7065               spe
-00049d90: 6320 3d20 7365 6c66 2e70 6172 656e 742e  c = self.parent.
-00049da0: 6f75 7470 7574 5f73 7065 635b 2266 756c  output_spec["ful
-00049db0: 6c5f 7265 7761 7264 5f73 7065 6322 5d5b  l_reward_spec"][
-00049dc0: 6b65 795d 0d0a 2020 2020 2020 2020 2020  key]..          
-00049dd0: 2020 2020 2020 7365 6c66 2e70 6172 656e        self.paren
-00049de0: 742e 6f75 7470 7574 5f73 7065 635b 2266  t.output_spec["f
-00049df0: 756c 6c5f 7265 7761 7264 5f73 7065 6322  ull_reward_spec"
-00049e00: 5d5b 6b65 795d 203d 2042 6f75 6e64 6564  ][key] = Bounded
-00049e10: 5465 6e73 6f72 5370 6563 280d 0a20 2020  TensorSpec(..   
-00049e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e30: 2073 6861 7065 3d73 7065 632e 7368 6170   shape=spec.shap
-00049e40: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00049e50: 2020 2020 2020 2020 6465 7669 6365 3d73          device=s
-00049e60: 7065 632e 6465 7669 6365 2c0d 0a20 2020  pec.device,..   
-00049e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e80: 2064 7479 7065 3d73 7065 632e 6474 7970   dtype=spec.dtyp
-00049e90: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00049ea0: 2020 2020 2020 2020 6869 6768 3d31 2e30          high=1.0
-00049eb0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00049ec0: 2020 2020 2020 206c 6f77 3d2d 312e 302c         low=-1.0,
-00049ed0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00049ee0: 2020 290d 0a20 2020 2020 2020 2072 6574    )..        ret
-00049ef0: 7572 6e20 7365 6c66 2e70 6172 656e 742e  urn self.parent.
-00049f00: 6f75 7470 7574 5f73 7065 635b 2266 756c  output_spec["ful
-00049f10: 6c5f 7265 7761 7264 5f73 7065 6322 5d0d  l_reward_spec"].
-00049f20: 0a0d 0a20 2020 2064 6566 205f 7265 7365  ...    def _rese
-00049f30: 7428 0d0a 2020 2020 2020 2020 7365 6c66  t(..        self
-00049f40: 2c20 7465 6e73 6f72 6469 6374 3a20 5465  , tensordict: Te
-00049f50: 6e73 6f72 4469 6374 4261 7365 2c20 7465  nsorDictBase, te
-00049f60: 6e73 6f72 6469 6374 5f72 6573 6574 3a20  nsordict_reset: 
-00049f70: 5465 6e73 6f72 4469 6374 4261 7365 0d0a  TensorDictBase..
-00049f80: 2020 2020 2920 2d3e 2054 656e 736f 7244      ) -> TensorD
-00049f90: 6963 7442 6173 653a 0d0a 2020 2020 2020  ictBase:..      
-00049fa0: 2020 7769 7468 205f 7365 745f 6d69 7373    with _set_miss
-00049fb0: 696e 675f 746f 6c65 7261 6e63 6528 7365  ing_tolerance(se
-00049fc0: 6c66 2c20 5472 7565 293a 0d0a 2020 2020  lf, True):..    
-00049fd0: 2020 2020 2020 2020 7465 6e73 6f72 6469          tensordi
-00049fe0: 6374 5f72 6573 6574 203d 2073 656c 662e  ct_reset = self.
-00049ff0: 5f63 616c 6c28 7465 6e73 6f72 6469 6374  _call(tensordict
-0004a000: 5f72 6573 6574 290d 0a20 2020 2020 2020  _reset)..       
-0004a010: 2072 6574 7572 6e20 7465 6e73 6f72 6469   return tensordi
-0004a020: 6374 5f72 6573 6574 0d0a 0d0a 0d0a 636c  ct_reset......cl
-0004a030: 6173 7320 5265 6d6f 7665 456d 7074 7953  ass RemoveEmptyS
-0004a040: 7065 6373 2854 7261 6e73 666f 726d 293a  pecs(Transform):
-0004a050: 0d0a 2020 2020 2222 2252 656d 6f76 6573  ..    """Removes
-0004a060: 2065 6d70 7479 2073 7065 6373 2061 6e64   empty specs and
-0004a070: 2063 6f6e 7465 6e74 2066 726f 6d20 616e   content from an
-0004a080: 2065 6e76 6972 6f6e 6d65 6e74 2e0d 0a0d   environment....
-0004a090: 0a20 2020 2045 7861 6d70 6c65 733a 0d0a  .    Examples:..
-0004a0a0: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
-0004a0b0: 7274 2074 6f72 6368 0d0a 2020 2020 2020  rt torch..      
-0004a0c0: 2020 3e3e 3e20 6672 6f6d 2074 656e 736f    >>> from tenso
-0004a0d0: 7264 6963 7420 696d 706f 7274 2054 656e  rdict import Ten
-0004a0e0: 736f 7244 6963 740d 0a20 2020 2020 2020  sorDict..       
-0004a0f0: 203e 3e3e 2066 726f 6d20 746f 7263 6872   >>> from torchr
-0004a100: 6c2e 6461 7461 2069 6d70 6f72 7420 556e  l.data import Un
-0004a110: 626f 756e 6465 6443 6f6e 7469 6e75 6f75  boundedContinuou
-0004a120: 7354 656e 736f 7253 7065 632c 2043 6f6d  sTensorSpec, Com
-0004a130: 706f 7369 7465 5370 6563 2c20 5c0d 0a20  positeSpec, \.. 
-0004a140: 2020 2020 2020 202e 2e2e 2020 2020 2044         ...     D
-0004a150: 6973 6372 6574 6554 656e 736f 7253 7065  iscreteTensorSpe
-0004a160: 630d 0a20 2020 2020 2020 203e 3e3e 2066  c..        >>> f
-0004a170: 726f 6d20 746f 7263 6872 6c2e 656e 7673  rom torchrl.envs
-0004a180: 2069 6d70 6f72 7420 456e 7642 6173 652c   import EnvBase,
-0004a190: 2054 7261 6e73 666f 726d 6564 456e 762c   TransformedEnv,
-0004a1a0: 2052 656d 6f76 6545 6d70 7479 5370 6563   RemoveEmptySpec
-0004a1b0: 730d 0a20 2020 2020 2020 203e 3e3e 0d0a  s..        >>>..
-0004a1c0: 2020 2020 2020 2020 3e3e 3e0d 0a20 2020          >>>..   
-0004a1d0: 2020 2020 203e 3e3e 2063 6c61 7373 2044       >>> class D
-0004a1e0: 756d 6d79 456e 7628 456e 7642 6173 6529  ummyEnv(EnvBase)
-0004a1f0: 3a0d 0a20 2020 2020 2020 202e 2e2e 2020  :..        ...  
-0004a200: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0004a210: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-0004a220: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0004a230: 202e 2e2e 2020 2020 2020 2020 2073 7570   ...         sup
-0004a240: 6572 2829 2e5f 5f69 6e69 745f 5f28 2a61  er().__init__(*a
-0004a250: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
-0004a260: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0004a270: 2020 2020 7365 6c66 2e6f 6273 6572 7661      self.observa
-0004a280: 7469 6f6e 5f73 7065 6320 3d20 436f 6d70  tion_spec = Comp
-0004a290: 6f73 6974 6553 7065 6328 0d0a 2020 2020  ositeSpec(..    
-0004a2a0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0004a2b0: 2020 2020 6f62 7365 7276 6174 696f 6e3d      observation=
-0004a2c0: 556e 626f 756e 6465 6443 6f6e 7469 6e75  UnboundedContinu
-0004a2d0: 6f75 7354 656e 736f 7253 7065 6328 282a  ousTensorSpec((*
-0004a2e0: 7365 6c66 2e62 6174 6368 5f73 697a 652c  self.batch_size,
-0004a2f0: 2033 2929 2c0d 0a20 2020 2020 2020 202e   3)),..        .
-0004a300: 2e2e 2020 2020 2020 2020 2020 2020 206f  ..             o
-0004a310: 7468 6572 3d43 6f6d 706f 7369 7465 5370  ther=CompositeSp
-0004a320: 6563 280d 0a20 2020 2020 2020 202e 2e2e  ec(..        ...
-0004a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a340: 2061 6e6f 7468 6572 5f6f 7468 6572 3d43   another_other=C
-0004a350: 6f6d 706f 7369 7465 5370 6563 2873 6861  ompositeSpec(sha
-0004a360: 7065 3d73 656c 662e 6261 7463 685f 7369  pe=self.batch_si
-0004a370: 7a65 292c 0d0a 2020 2020 2020 2020 2e2e  ze),..        ..
-0004a380: 2e20 2020 2020 2020 2020 2020 2020 2020  .               
-0004a390: 2020 7368 6170 653d 7365 6c66 2e62 6174    shape=self.bat
-0004a3a0: 6368 5f73 697a 652c 0d0a 2020 2020 2020  ch_size,..      
-0004a3b0: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
-0004a3c0: 2020 292c 0d0a 2020 2020 2020 2020 2e2e    ),..        ..
-0004a3d0: 2e20 2020 2020 2020 2020 2020 2020 7368  .             sh
-0004a3e0: 6170 653d 7365 6c66 2e62 6174 6368 5f73  ape=self.batch_s
-0004a3f0: 697a 652c 0d0a 2020 2020 2020 2020 2e2e  ize,..        ..
-0004a400: 2e20 2020 2020 2020 2020 290d 0a20 2020  .         )..   
-0004a410: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
-0004a420: 2073 656c 662e 6163 7469 6f6e 5f73 7065   self.action_spe
-0004a430: 6320 3d20 556e 626f 756e 6465 6443 6f6e  c = UnboundedCon
-0004a440: 7469 6e75 6f75 7354 656e 736f 7253 7065  tinuousTensorSpe
-0004a450: 6328 282a 7365 6c66 2e62 6174 6368 5f73  c((*self.batch_s
-0004a460: 697a 652c 2033 2929 0d0a 2020 2020 2020  ize, 3))..      
-0004a470: 2020 2e2e 2e20 2020 2020 2020 2020 7365    ...         se
-0004a480: 6c66 2e64 6f6e 655f 7370 6563 203d 2044  lf.done_spec = D
-0004a490: 6973 6372 6574 6554 656e 736f 7253 7065  iscreteTensorSpe
-0004a4a0: 6328 0d0a 2020 2020 2020 2020 2e2e 2e20  c(..        ... 
-0004a4b0: 2020 2020 2020 2020 2020 2020 322c 2028              2, (
-0004a4c0: 2a73 656c 662e 6261 7463 685f 7369 7a65  *self.batch_size
-0004a4d0: 2c20 3129 2c20 6474 7970 653d 746f 7263  , 1), dtype=torc
-0004a4e0: 682e 626f 6f6c 0d0a 2020 2020 2020 2020  h.bool..        
-0004a4f0: 2e2e 2e20 2020 2020 2020 2020 290d 0a20  ...         ).. 
-0004a500: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-0004a510: 2020 2073 656c 662e 6675 6c6c 5f64 6f6e     self.full_don
-0004a520: 655f 7370 6563 5b22 7472 756e 6361 7465  e_spec["truncate
-0004a530: 6422 5d20 3d20 7365 6c66 2e66 756c 6c5f  d"] = self.full_
-0004a540: 646f 6e65 5f73 7065 635b 0d0a 2020 2020  done_spec[..    
-0004a550: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0004a560: 2020 2020 2274 6572 6d69 6e61 7465 6422      "terminated"
-0004a570: 5d2e 636c 6f6e 6528 290d 0a20 2020 2020  ].clone()..     
-0004a580: 2020 202e 2e2e 2020 2020 2020 2020 2073     ...         s
-0004a590: 656c 662e 7265 7761 7264 5f73 7065 6320  elf.reward_spec 
-0004a5a0: 3d20 436f 6d70 6f73 6974 6553 7065 6328  = CompositeSpec(
-0004a5b0: 0d0a 2020 2020 2020 2020 2e2e 2e20 2020  ..        ...   
-0004a5c0: 2020 2020 2020 2020 2020 7265 7761 7264            reward
-0004a5d0: 3d55 6e62 6f75 6e64 6564 436f 6e74 696e  =UnboundedContin
-0004a5e0: 756f 7573 5465 6e73 6f72 5370 6563 282a  uousTensorSpec(*
-0004a5f0: 7365 6c66 2e62 6174 6368 5f73 697a 652c  self.batch_size,
-0004a600: 2031 292c 0d0a 2020 2020 2020 2020 2e2e   1),..        ..
-0004a610: 2e20 2020 2020 2020 2020 2020 2020 6f74  .             ot
-0004a620: 6865 725f 7265 7761 7264 3d43 6f6d 706f  her_reward=Compo
-0004a630: 7369 7465 5370 6563 2873 6861 7065 3d73  siteSpec(shape=s
-0004a640: 656c 662e 6261 7463 685f 7369 7a65 292c  elf.batch_size),
-0004a650: 0d0a 2020 2020 2020 2020 2e2e 2e20 2020  ..        ...   
-0004a660: 2020 2020 2020 2020 2020 7368 6170 653d            shape=
-0004a670: 7365 6c66 2e62 6174 6368 5f73 697a 650d  self.batch_size.
+00048b90: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00048ba0: 6528 6d6f 6475 6c65 2c20 5465 6e73 6f72  e(module, Tensor
+00048bb0: 4469 6374 4d6f 6475 6c65 4261 7365 293a  DictModuleBase):
+00048bc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00048bd0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00048be0: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
+00048bf0: 2020 2020 2020 2020 2066 2241 6c6c 206d           f"All m
+00048c00: 6f64 756c 6573 206d 7573 7420 6265 2054  odules must be T
+00048c10: 656e 736f 7244 6963 744d 6f64 756c 6573  ensorDictModules
+00048c20: 2c20 6275 7420 6120 7b74 7970 6528 6d6f  , but a {type(mo
+00048c30: 6475 6c65 297d 2077 6173 2070 726f 7669  dule)} was provi
+00048c40: 6465 642e 220d 0a20 2020 2020 2020 2020  ded."..         
+00048c50: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+00048c60: 2020 2020 696e 5f6b 6579 7320 3d20 7365      in_keys = se
+00048c70: 7428 290d 0a20 2020 2020 2020 2066 6f72  t()..        for
+00048c80: 206d 6f64 756c 6520 696e 206d 6f64 756c   module in modul
+00048c90: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+00048ca0: 2069 6e5f 6b65 7973 2e75 7064 6174 6528   in_keys.update(
+00048cb0: 6d6f 6475 6c65 2e69 6e5f 6b65 7973 290d  module.in_keys).
+00048cc0: 0a0d 0a20 2020 2020 2020 2069 6620 6f75  ...        if ou
+00048cd0: 745f 6b65 7973 2069 7320 4e6f 6e65 3a0d  t_keys is None:.
+00048ce0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+00048cf0: 5f6b 6579 7320 3d20 7365 7428 290d 0a20  _keys = set().. 
+00048d00: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
+00048d10: 6f64 756c 6520 696e 206d 6f64 756c 6573  odule in modules
+00048d20: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00048d30: 2020 2066 6f72 206b 6579 2069 6e20 6d6f     for key in mo
+00048d40: 6475 6c65 2e6f 7574 5f6b 6579 733a 0d0a  dule.out_keys:..
+00048d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d60: 2020 2020 6966 206b 6579 5b30 5d20 3d3d      if key[0] ==
+00048d70: 2022 6e65 7874 223a 0d0a 2020 2020 2020   "next":..      
+00048d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d90: 2020 6f75 745f 6b65 7973 2e61 6464 286b    out_keys.add(k
+00048da0: 6579 5b31 5d29 0d0a 2020 2020 2020 2020  ey[1])..        
+00048db0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00048dc0: 2020 206f 7574 5f6b 6579 735f 203d 2073     out_keys_ = s
+00048dd0: 6574 2829 0d0a 2020 2020 2020 2020 2020  et()..          
+00048de0: 2020 666f 7220 6b65 7920 696e 206f 7574    for key in out
+00048df0: 5f6b 6579 733a 0d0a 2020 2020 2020 2020  _keys:..        
+00048e00: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00048e10: 7461 6e63 6528 6b65 792c 2074 7570 6c65  tance(key, tuple
+00048e20: 2920 616e 6420 6b65 795b 305d 203d 3d20  ) and key[0] == 
+00048e30: 226e 6578 7422 3a0d 0a20 2020 2020 2020  "next":..       
+00048e40: 2020 2020 2020 2020 2020 2020 206b 6579               key
+00048e50: 203d 206b 6579 5b31 5d0d 0a20 2020 2020   = key[1]..     
+00048e60: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00048e70: 6172 6e69 6e67 732e 7761 726e 280d 0a20  arnings.warn(.. 
+00048e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048e90: 2020 2020 2020 2066 2254 6865 2027 6e65         f"The 'ne
+00048ea0: 7874 2720 6b65 7920 6973 206e 6f74 206e  xt' key is not n
+00048eb0: 6565 6465 6420 696e 2074 6865 2042 7572  eeded in the Bur
+00048ec0: 6e49 6e54 7261 6e73 666f 726d 2060 6f75  nInTransform `ou
+00048ed0: 745f 6b65 7960 207b 6b65 797d 2061 6e64  t_key` {key} and
+00048ee0: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+00048ef0: 2020 2020 2020 2020 2020 2020 6622 7769              f"wi
+00048f00: 6c6c 2062 6520 6967 6e6f 7265 642e 2054  ll be ignored. T
+00048f10: 6869 7320 7472 616e 7366 6f72 6d20 616c  his transform al
+00048f20: 7265 6164 7920 6173 7375 6d65 7320 7468  ready assumes th
+00048f30: 6174 2060 6f75 745f 6b65 7973 6020 7769  at `out_keys` wi
+00048f40: 6c6c 2062 6520 220d 0a20 2020 2020 2020  ll be "..       
+00048f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048f60: 2066 2272 6574 7269 6576 6564 2066 726f   f"retrieved fro
+00048f70: 6d20 7468 6520 6e65 7874 2074 696d 6520  m the next time 
+00048f80: 7374 6570 206f 6620 7468 6520 6275 726e  step of the burn
+00048f90: 742d 696e 2064 6174 612e 220d 0a20 2020  t-in data."..   
+00048fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048fb0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00048fc0: 2020 2020 6f75 745f 6b65 7973 5f2e 6164      out_keys_.ad
+00048fd0: 6428 6b65 7929 0d0a 2020 2020 2020 2020  d(key)..        
+00048fe0: 2020 2020 6f75 745f 6b65 7973 203d 206f      out_keys = o
+00048ff0: 7574 5f6b 6579 735f 0d0a 0d0a 2020 2020  ut_keys_....    
+00049000: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
+00049010: 6974 5f5f 2869 6e5f 6b65 7973 3d69 6e5f  it__(in_keys=in_
+00049020: 6b65 7973 2c20 6f75 745f 6b65 7973 3d6f  keys, out_keys=o
+00049030: 7574 5f6b 6579 7329 0d0a 2020 2020 2020  ut_keys)..      
+00049040: 2020 7365 6c66 2e6d 6f64 756c 6573 203d    self.modules =
+00049050: 206d 6f64 756c 6573 0d0a 2020 2020 2020   modules..      
+00049060: 2020 7365 6c66 2e62 7572 6e5f 696e 203d    self.burn_in =
+00049070: 2062 7572 6e5f 696e 0d0a 0d0a 2020 2020   burn_in....    
+00049080: 6465 6620 5f63 616c 6c28 7365 6c66 2c20  def _call(self, 
+00049090: 7465 6e73 6f72 6469 6374 3a20 5465 6e73  tensordict: Tens
+000490a0: 6f72 4469 6374 4261 7365 2920 2d3e 2054  orDictBase) -> T
+000490b0: 656e 736f 7244 6963 7442 6173 653a 0d0a  ensorDictBase:..
+000490c0: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+000490d0: 6e74 696d 6545 7272 6f72 2822 4275 726e  ntimeError("Burn
+000490e0: 496e 5472 616e 7366 6f72 6d20 6361 6e20  InTransform can 
+000490f0: 6f6e 6c79 2062 6520 6170 7065 6e64 6564  only be appended
+00049100: 2074 6f20 6120 5265 706c 6179 4275 6666   to a ReplayBuff
+00049110: 6572 2229 0d0a 0d0a 2020 2020 6465 6620  er")....    def 
+00049120: 5f73 7465 7028 0d0a 2020 2020 2020 2020  _step(..        
+00049130: 7365 6c66 2c20 7465 6e73 6f72 6469 6374  self, tensordict
+00049140: 3a20 5465 6e73 6f72 4469 6374 4261 7365  : TensorDictBase
+00049150: 2c20 6e65 7874 5f74 656e 736f 7264 6963  , next_tensordic
+00049160: 743a 2054 656e 736f 7244 6963 7442 6173  t: TensorDictBas
+00049170: 650d 0a20 2020 2029 202d 3e20 5465 6e73  e..    ) -> Tens
+00049180: 6f72 4469 6374 4261 7365 3a0d 0a20 2020  orDictBase:..   
+00049190: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
+000491a0: 6d65 4572 726f 7228 2242 7572 6e49 6e54  meError("BurnInT
+000491b0: 7261 6e73 666f 726d 2063 616e 206f 6e6c  ransform can onl
+000491c0: 7920 6265 2061 7070 656e 6465 6420 746f  y be appended to
+000491d0: 2061 2052 6570 6c61 7942 7566 6665 722e   a ReplayBuffer.
+000491e0: 2229 0d0a 0d0a 2020 2020 6465 6620 666f  ")....    def fo
+000491f0: 7277 6172 6428 7365 6c66 2c20 7465 6e73  rward(self, tens
+00049200: 6f72 6469 6374 3a20 5465 6e73 6f72 4469  ordict: TensorDi
+00049210: 6374 4261 7365 2920 2d3e 2054 656e 736f  ctBase) -> Tenso
+00049220: 7244 6963 7442 6173 653a 0d0a 0d0a 2020  rDictBase:....  
+00049230: 2020 2020 2020 6966 2073 656c 662e 6275        if self.bu
+00049240: 726e 5f69 6e20 3d3d 2030 3a0d 0a20 2020  rn_in == 0:..   
+00049250: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00049260: 7465 6e73 6f72 6469 6374 0d0a 0d0a 2020  tensordict....  
+00049270: 2020 2020 2020 7464 5f64 6576 6963 6520        td_device 
+00049280: 3d20 7465 6e73 6f72 6469 6374 2e64 6576  = tensordict.dev
+00049290: 6963 650d 0a20 2020 2020 2020 2042 2c20  ice..        B, 
+000492a0: 542c 202a 6578 7472 615f 6469 6d73 203d  T, *extra_dims =
+000492b0: 2074 656e 736f 7264 6963 742e 6261 7463   tensordict.batc
+000492c0: 685f 7369 7a65 0d0a 0d0a 2020 2020 2020  h_size....      
+000492d0: 2020 2320 5370 6c69 7420 7468 6520 7465    # Split the te
+000492e0: 6e73 6f72 2064 6963 7420 696e 746f 2062  nsor dict into b
+000492f0: 7572 6e2d 696e 2064 6174 6120 616e 6420  urn-in data and 
+00049300: 7468 6520 7265 7374 2e0d 0a20 2020 2020  the rest...     
+00049310: 2020 2074 645f 6275 726e 5f69 6e20 3d20     td_burn_in = 
+00049320: 7465 6e73 6f72 6469 6374 5b2e 2e2e 2c20  tensordict[..., 
+00049330: 3a20 7365 6c66 2e62 7572 6e5f 696e 5d0d  : self.burn_in].
+00049340: 0a20 2020 2020 2020 2074 645f 6f75 7420  .        td_out 
+00049350: 3d20 7465 6e73 6f72 6469 6374 5b2e 2e2e  = tensordict[...
+00049360: 2c20 7365 6c66 2e62 7572 6e5f 696e 203a  , self.burn_in :
+00049370: 5d0d 0a0d 0a20 2020 2020 2020 2023 2042  ]....        # B
+00049380: 7572 6e20 696e 2074 6865 2072 6563 7572  urn in the recur
+00049390: 7265 6e74 2073 7461 7465 2e0d 0a20 2020  rent state...   
+000493a0: 2020 2020 2077 6974 6820 746f 7263 682e       with torch.
+000493b0: 6e6f 5f67 7261 6428 293a 0d0a 2020 2020  no_grad():..    
+000493c0: 2020 2020 2020 2020 666f 7220 6d6f 6475          for modu
+000493d0: 6c65 2069 6e20 7365 6c66 2e6d 6f64 756c  le in self.modul
+000493e0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+000493f0: 2020 2020 206d 6f64 756c 655f 6465 7669       module_devi
+00049400: 6365 203d 206e 6578 7428 6d6f 6475 6c65  ce = next(module
+00049410: 2e70 6172 616d 6574 6572 7328 2929 2e64  .parameters()).d
+00049420: 6576 6963 6520 6f72 204e 6f6e 650d 0a20  evice or None.. 
+00049430: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00049440: 645f 6275 726e 5f69 6e20 3d20 7464 5f62  d_burn_in = td_b
+00049450: 7572 6e5f 696e 2e74 6f28 6d6f 6475 6c65  urn_in.to(module
+00049460: 5f64 6576 6963 6529 0d0a 2020 2020 2020  _device)..      
+00049470: 2020 2020 2020 2020 2020 7464 5f62 7572            td_bur
+00049480: 6e5f 696e 203d 206d 6f64 756c 6528 7464  n_in = module(td
+00049490: 5f62 7572 6e5f 696e 290d 0a20 2020 2020  _burn_in)..     
+000494a0: 2020 2074 645f 6275 726e 5f69 6e20 3d20     td_burn_in = 
+000494b0: 7464 5f62 7572 6e5f 696e 2e74 6f28 7464  td_burn_in.to(td
+000494c0: 5f64 6576 6963 6529 0d0a 0d0a 2020 2020  _device)....    
+000494d0: 2020 2020 2320 5570 6461 7465 206f 7574      # Update out
+000494e0: 2054 656e 736f 7244 6963 7420 7769 7468   TensorDict with
+000494f0: 2074 6865 2062 7572 6e74 2d69 6e20 6461   the burnt-in da
+00049500: 7461 2e0d 0a20 2020 2020 2020 2066 6f72  ta...        for
+00049510: 206f 7574 5f6b 6579 2069 6e20 7365 6c66   out_key in self
+00049520: 2e6f 7574 5f6b 6579 733a 0d0a 2020 2020  .out_keys:..    
+00049530: 2020 2020 2020 2020 6966 206f 7574 5f6b          if out_k
+00049540: 6579 206e 6f74 2069 6e20 7464 5f6f 7574  ey not in td_out
+00049550: 2e6b 6579 7328 696e 636c 7564 655f 6e65  .keys(include_ne
+00049560: 7374 6564 3d54 7275 6529 3a0d 0a20 2020  sted=True):..   
+00049570: 2020 2020 2020 2020 2020 2020 2074 645f               td_
+00049580: 6f75 742e 7365 7428 0d0a 2020 2020 2020  out.set(..      
+00049590: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+000495a0: 745f 6b65 792c 0d0a 2020 2020 2020 2020  t_key,..        
+000495b0: 2020 2020 2020 2020 2020 2020 746f 7263              torc
+000495c0: 682e 7a65 726f 7328 0d0a 2020 2020 2020  h.zeros(..      
+000495d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000495e0: 2020 422c 2054 202d 2073 656c 662e 6275    B, T - self.bu
+000495f0: 726e 5f69 6e2c 202a 7465 6e73 6f72 6469  rn_in, *tensordi
+00049600: 6374 2e67 6574 286f 7574 5f6b 6579 292e  ct.get(out_key).
+00049610: 7368 6170 655b 323a 5d0d 0a20 2020 2020  shape[2:]..     
+00049620: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00049630: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00049640: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00049650: 2020 7464 5f6f 7574 5b2e 2e2e 2c20 305d    td_out[..., 0]
+00049660: 5b6f 7574 5f6b 6579 5d2e 636f 7079 5f28  [out_key].copy_(
+00049670: 7464 5f62 7572 6e5f 696e 5b22 6e65 7874  td_burn_in["next
+00049680: 225d 5b2e 2e2e 2c20 2d31 5d5b 6f75 745f  "][..., -1][out_
+00049690: 6b65 795d 290d 0a0d 0a20 2020 2020 2020  key])....       
+000496a0: 2072 6574 7572 6e20 7464 5f6f 7574 0d0a   return td_out..
+000496b0: 0d0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+000496c0: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
+000496d0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000496e0: 2066 227b 7365 6c66 2e5f 5f63 6c61 7373   f"{self.__class
+000496f0: 5f5f 2e5f 5f6e 616d 655f 5f7d 2862 7572  __.__name__}(bur
+00049700: 6e5f 696e 3d7b 7365 6c66 2e62 7572 6e5f  n_in={self.burn_
+00049710: 696e 7d2c 2069 6e5f 6b65 7973 3d7b 7365  in}, in_keys={se
+00049720: 6c66 2e69 6e5f 6b65 7973 7d2c 206f 7574  lf.in_keys}, out
+00049730: 5f6b 6579 733d 7b73 656c 662e 6f75 745f  _keys={self.out_
+00049740: 6b65 7973 7d29 220d 0a0d 0a0d 0a63 6c61  keys})"......cla
+00049750: 7373 2053 6967 6e54 7261 6e73 666f 726d  ss SignTransform
+00049760: 2854 7261 6e73 666f 726d 293a 0d0a 2020  (Transform):..  
+00049770: 2020 2222 2241 2074 7261 6e73 666f 726d    """A transform
+00049780: 2074 6f20 636f 6d70 7574 6520 7468 6520   to compute the 
+00049790: 7369 676e 7320 6f66 2054 656e 736f 7244  signs of TensorD
+000497a0: 6963 7420 7661 6c75 6573 2e0d 0a0d 0a20  ict values..... 
+000497b0: 2020 2054 6869 7320 7472 616e 7366 6f72     This transfor
+000497c0: 6d20 7265 6164 7320 7468 6520 7465 6e73  m reads the tens
+000497d0: 6f72 7320 696e 2060 6069 6e5f 6b65 7973  ors in ``in_keys
+000497e0: 6060 2061 6e64 2060 6069 6e5f 6b65 7973  `` and ``in_keys
+000497f0: 5f69 6e76 6060 2c20 636f 6d70 7574 6573  _inv``, computes
+00049800: 2074 6865 0d0a 2020 2020 7369 676e 7320   the..    signs 
+00049810: 6f66 2074 6865 6972 2065 6c65 6d65 6e74  of their element
+00049820: 7320 616e 6420 7772 6974 6573 2074 6865  s and writes the
+00049830: 2072 6573 756c 7469 6e67 2073 6967 6e20   resulting sign 
+00049840: 7465 6e73 6f72 7320 746f 2060 606f 7574  tensors to ``out
+00049850: 5f6b 6579 7360 6020 616e 640d 0a20 2020  _keys`` and..   
+00049860: 2060 606f 7574 5f6b 6579 735f 696e 7660   ``out_keys_inv`
+00049870: 6020 7265 7370 6563 7469 7665 6c79 2e0d  ` respectively..
+00049880: 0a0d 0a20 2020 2041 7267 733a 0d0a 2020  ...    Args:..  
+00049890: 2020 2020 2020 696e 5f6b 6579 7320 286c        in_keys (l
+000498a0: 6973 7420 6f66 204e 6573 7465 644b 6579  ist of NestedKey
+000498b0: 7329 3a20 696e 7075 7420 656e 7472 6965  s): input entrie
+000498c0: 7320 2872 6561 6429 0d0a 2020 2020 2020  s (read)..      
+000498d0: 2020 6f75 745f 6b65 7973 2028 6c69 7374    out_keys (list
+000498e0: 206f 6620 4e65 7374 6564 4b65 7973 293a   of NestedKeys):
+000498f0: 2069 6e70 7574 2065 6e74 7269 6573 2028   input entries (
+00049900: 7772 6974 6529 0d0a 2020 2020 2020 2020  write)..        
+00049910: 696e 5f6b 6579 735f 696e 7620 286c 6973  in_keys_inv (lis
+00049920: 7420 6f66 204e 6573 7465 644b 6579 7329  t of NestedKeys)
+00049930: 3a20 696e 7075 7420 656e 7472 6965 7320  : input entries 
+00049940: 2872 6561 6429 2064 7572 696e 6720 3a6d  (read) during :m
+00049950: 6574 683a 607e 2e69 6e76 6020 6361 6c6c  eth:`~.inv` call
+00049960: 732e 0d0a 2020 2020 2020 2020 6f75 745f  s...        out_
+00049970: 6b65 7973 5f69 6e76 2028 6c69 7374 206f  keys_inv (list o
+00049980: 6620 4e65 7374 6564 4b65 7973 293a 2069  f NestedKeys): i
+00049990: 6e70 7574 2065 6e74 7269 6573 2028 7772  nput entries (wr
+000499a0: 6974 6529 2064 7572 696e 6720 3a6d 6574  ite) during :met
+000499b0: 683a 607e 2e69 6e76 6020 6361 6c6c 732e  h:`~.inv` calls.
+000499c0: 0d0a 0d0a 2020 2020 4578 616d 706c 6573  ....    Examples
+000499d0: 3a0d 0a20 2020 2020 2020 203e 3e3e 2066  :..        >>> f
+000499e0: 726f 6d20 746f 7263 6872 6c2e 656e 7673  rom torchrl.envs
+000499f0: 2069 6d70 6f72 7420 4779 6d45 6e76 2c20   import GymEnv, 
+00049a00: 5472 616e 7366 6f72 6d65 6445 6e76 2c20  TransformedEnv, 
+00049a10: 5369 676e 5472 616e 7366 6f72 6d0d 0a20  SignTransform.. 
+00049a20: 2020 2020 2020 203e 3e3e 2062 6173 655f         >>> base_
+00049a30: 656e 7620 3d20 4779 6d45 6e76 2822 5065  env = GymEnv("Pe
+00049a40: 6e64 756c 756d 2d76 3122 290d 0a20 2020  ndulum-v1")..   
+00049a50: 2020 2020 203e 3e3e 2065 6e76 203d 2054       >>> env = T
+00049a60: 7261 6e73 666f 726d 6564 456e 7628 6261  ransformedEnv(ba
+00049a70: 7365 5f65 6e76 2c20 5369 676e 5472 616e  se_env, SignTran
+00049a80: 7366 6f72 6d28 696e 5f6b 6579 733d 5b27  sform(in_keys=['
+00049a90: 6f62 7365 7276 6174 696f 6e27 5d29 290d  observation'])).
+00049aa0: 0a20 2020 2020 2020 203e 3e3e 2072 203d  .        >>> r =
+00049ab0: 2065 6e76 2e72 6f6c 6c6f 7574 2831 3030   env.rollout(100
+00049ac0: 290d 0a20 2020 2020 2020 203e 3e3e 206f  )..        >>> o
+00049ad0: 6273 203d 2072 5b22 6f62 7365 7276 6174  bs = r["observat
+00049ae0: 696f 6e22 5d0d 0a20 2020 2020 2020 203e  ion"]..        >
+00049af0: 3e3e 2061 7373 6572 7420 2874 6f72 6368  >> assert (torch
+00049b00: 2e6c 6f67 6963 616c 5f6f 7228 746f 7263  .logical_or(torc
+00049b10: 682e 6c6f 6769 6361 6c5f 6f72 286f 6273  h.logical_or(obs
+00049b20: 203d 3d20 2d31 2c20 6f62 7320 3d3d 2031   == -1, obs == 1
+00049b30: 292c 206f 6273 203d 3d20 302e 3029 292e  ), obs == 0.0)).
+00049b40: 616c 6c28 290d 0a20 2020 2022 2222 0d0a  all()..    """..
+00049b50: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00049b60: 5f5f 280d 0a20 2020 2020 2020 2073 656c  __(..        sel
+00049b70: 662c 0d0a 2020 2020 2020 2020 696e 5f6b  f,..        in_k
+00049b80: 6579 733d 4e6f 6e65 2c0d 0a20 2020 2020  eys=None,..     
+00049b90: 2020 206f 7574 5f6b 6579 733d 4e6f 6e65     out_keys=None
+00049ba0: 2c0d 0a20 2020 2020 2020 2069 6e5f 6b65  ,..        in_ke
+00049bb0: 7973 5f69 6e76 3d4e 6f6e 652c 0d0a 2020  ys_inv=None,..  
+00049bc0: 2020 2020 2020 6f75 745f 6b65 7973 5f69        out_keys_i
+00049bd0: 6e76 3d4e 6f6e 652c 0d0a 2020 2020 293a  nv=None,..    ):
+00049be0: 0d0a 2020 2020 2020 2020 6966 2069 6e5f  ..        if in_
+00049bf0: 6b65 7973 2069 7320 4e6f 6e65 3a0d 0a20  keys is None:.. 
+00049c00: 2020 2020 2020 2020 2020 2069 6e5f 6b65             in_ke
+00049c10: 7973 203d 205b 5d0d 0a20 2020 2020 2020  ys = []..       
+00049c20: 2069 6620 6f75 745f 6b65 7973 2069 7320   if out_keys is 
+00049c30: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00049c40: 2020 206f 7574 5f6b 6579 7320 3d20 636f     out_keys = co
+00049c50: 7079 2869 6e5f 6b65 7973 290d 0a20 2020  py(in_keys)..   
+00049c60: 2020 2020 2069 6620 696e 5f6b 6579 735f       if in_keys_
+00049c70: 696e 7620 6973 204e 6f6e 653a 0d0a 2020  inv is None:..  
+00049c80: 2020 2020 2020 2020 2020 696e 5f6b 6579            in_key
+00049c90: 735f 696e 7620 3d20 5b5d 0d0a 2020 2020  s_inv = []..    
+00049ca0: 2020 2020 6966 206f 7574 5f6b 6579 735f      if out_keys_
+00049cb0: 696e 7620 6973 204e 6f6e 653a 0d0a 2020  inv is None:..  
+00049cc0: 2020 2020 2020 2020 2020 6f75 745f 6b65            out_ke
+00049cd0: 7973 5f69 6e76 203d 2063 6f70 7928 696e  ys_inv = copy(in
+00049ce0: 5f6b 6579 735f 696e 7629 0d0a 2020 2020  _keys_inv)..    
+00049cf0: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
+00049d00: 6974 5f5f 2869 6e5f 6b65 7973 2c20 6f75  it__(in_keys, ou
+00049d10: 745f 6b65 7973 2c20 696e 5f6b 6579 735f  t_keys, in_keys_
+00049d20: 696e 762c 206f 7574 5f6b 6579 735f 696e  inv, out_keys_in
+00049d30: 7629 0d0a 0d0a 2020 2020 6465 6620 5f61  v)....    def _a
+00049d40: 7070 6c79 5f74 7261 6e73 666f 726d 2873  pply_transform(s
+00049d50: 656c 662c 206f 6273 3a20 746f 7263 682e  elf, obs: torch.
+00049d60: 5465 6e73 6f72 2920 2d3e 2074 6f72 6368  Tensor) -> torch
+00049d70: 2e54 656e 736f 723a 0d0a 2020 2020 2020  .Tensor:..      
+00049d80: 2020 7265 7475 726e 206f 6273 2e73 6967    return obs.sig
+00049d90: 6e28 290d 0a0d 0a20 2020 2064 6566 205f  n()....    def _
+00049da0: 696e 765f 6170 706c 795f 7472 616e 7366  inv_apply_transf
+00049db0: 6f72 6d28 7365 6c66 2c20 7374 6174 653a  orm(self, state:
+00049dc0: 2074 6f72 6368 2e54 656e 736f 7229 202d   torch.Tensor) -
+00049dd0: 3e20 746f 7263 682e 5465 6e73 6f72 3a0d  > torch.Tensor:.
+00049de0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00049df0: 7374 6174 652e 7369 676e 2829 0d0a 0d0a  state.sign()....
+00049e00: 2020 2020 405f 6170 706c 795f 746f 5f63      @_apply_to_c
+00049e10: 6f6d 706f 7369 7465 0d0a 2020 2020 6465  omposite..    de
+00049e20: 6620 7472 616e 7366 6f72 6d5f 6f62 7365  f transform_obse
+00049e30: 7276 6174 696f 6e5f 7370 6563 2873 656c  rvation_spec(sel
+00049e40: 662c 206f 6273 6572 7661 7469 6f6e 5f73  f, observation_s
+00049e50: 7065 633a 2054 656e 736f 7253 7065 6329  pec: TensorSpec)
+00049e60: 202d 3e20 5465 6e73 6f72 5370 6563 3a0d   -> TensorSpec:.
+00049e70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00049e80: 426f 756e 6465 6454 656e 736f 7253 7065  BoundedTensorSpe
+00049e90: 6328 0d0a 2020 2020 2020 2020 2020 2020  c(..            
+00049ea0: 7368 6170 653d 6f62 7365 7276 6174 696f  shape=observatio
+00049eb0: 6e5f 7370 6563 2e73 6861 7065 2c0d 0a20  n_spec.shape,.. 
+00049ec0: 2020 2020 2020 2020 2020 2064 6576 6963             devic
+00049ed0: 653d 6f62 7365 7276 6174 696f 6e5f 7370  e=observation_sp
+00049ee0: 6563 2e64 6576 6963 652c 0d0a 2020 2020  ec.device,..    
+00049ef0: 2020 2020 2020 2020 6474 7970 653d 6f62          dtype=ob
+00049f00: 7365 7276 6174 696f 6e5f 7370 6563 2e64  servation_spec.d
+00049f10: 7479 7065 2c0d 0a20 2020 2020 2020 2020  type,..         
+00049f20: 2020 2068 6967 683d 312e 302c 0d0a 2020     high=1.0,..  
+00049f30: 2020 2020 2020 2020 2020 6c6f 773d 2d31            low=-1
+00049f40: 2e30 2c0d 0a20 2020 2020 2020 2029 0d0a  .0,..        )..
+00049f50: 0d0a 2020 2020 6465 6620 7472 616e 7366  ..    def transf
+00049f60: 6f72 6d5f 7265 7761 7264 5f73 7065 6328  orm_reward_spec(
+00049f70: 7365 6c66 2c20 7265 7761 7264 5f73 7065  self, reward_spe
+00049f80: 633a 2054 656e 736f 7253 7065 6329 202d  c: TensorSpec) -
+00049f90: 3e20 5465 6e73 6f72 5370 6563 3a0d 0a20  > TensorSpec:.. 
+00049fa0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
+00049fb0: 6e20 7365 6c66 2e69 6e5f 6b65 7973 3a0d  n self.in_keys:.
+00049fc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00049fd0: 6b65 7920 696e 2073 656c 662e 7061 7265  key in self.pare
+00049fe0: 6e74 2e72 6577 6172 645f 6b65 7973 3a0d  nt.reward_keys:.
+00049ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a000: 2073 7065 6320 3d20 7365 6c66 2e70 6172   spec = self.par
+0004a010: 656e 742e 6f75 7470 7574 5f73 7065 635b  ent.output_spec[
+0004a020: 2266 756c 6c5f 7265 7761 7264 5f73 7065  "full_reward_spe
+0004a030: 6322 5d5b 6b65 795d 0d0a 2020 2020 2020  c"][key]..      
+0004a040: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0004a050: 6172 656e 742e 6f75 7470 7574 5f73 7065  arent.output_spe
+0004a060: 635b 2266 756c 6c5f 7265 7761 7264 5f73  c["full_reward_s
+0004a070: 7065 6322 5d5b 6b65 795d 203d 2042 6f75  pec"][key] = Bou
+0004a080: 6e64 6564 5465 6e73 6f72 5370 6563 280d  ndedTensorSpec(.
+0004a090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a0a0: 2020 2020 2073 6861 7065 3d73 7065 632e       shape=spec.
+0004a0b0: 7368 6170 652c 0d0a 2020 2020 2020 2020  shape,..        
+0004a0c0: 2020 2020 2020 2020 2020 2020 6465 7669              devi
+0004a0d0: 6365 3d73 7065 632e 6465 7669 6365 2c0d  ce=spec.device,.
+0004a0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a0f0: 2020 2020 2064 7479 7065 3d73 7065 632e       dtype=spec.
+0004a100: 6474 7970 652c 0d0a 2020 2020 2020 2020  dtype,..        
+0004a110: 2020 2020 2020 2020 2020 2020 6869 6768              high
+0004a120: 3d31 2e30 2c0d 0a20 2020 2020 2020 2020  =1.0,..         
+0004a130: 2020 2020 2020 2020 2020 206c 6f77 3d2d             low=-
+0004a140: 312e 302c 0d0a 2020 2020 2020 2020 2020  1.0,..          
+0004a150: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0004a160: 2072 6574 7572 6e20 7365 6c66 2e70 6172   return self.par
+0004a170: 656e 742e 6f75 7470 7574 5f73 7065 635b  ent.output_spec[
+0004a180: 2266 756c 6c5f 7265 7761 7264 5f73 7065  "full_reward_spe
+0004a190: 6322 5d0d 0a0d 0a20 2020 2064 6566 205f  c"]....    def _
+0004a1a0: 7265 7365 7428 0d0a 2020 2020 2020 2020  reset(..        
+0004a1b0: 7365 6c66 2c20 7465 6e73 6f72 6469 6374  self, tensordict
+0004a1c0: 3a20 5465 6e73 6f72 4469 6374 4261 7365  : TensorDictBase
+0004a1d0: 2c20 7465 6e73 6f72 6469 6374 5f72 6573  , tensordict_res
+0004a1e0: 6574 3a20 5465 6e73 6f72 4469 6374 4261  et: TensorDictBa
+0004a1f0: 7365 0d0a 2020 2020 2920 2d3e 2054 656e  se..    ) -> Ten
+0004a200: 736f 7244 6963 7442 6173 653a 0d0a 2020  sorDictBase:..  
+0004a210: 2020 2020 2020 7769 7468 205f 7365 745f        with _set_
+0004a220: 6d69 7373 696e 675f 746f 6c65 7261 6e63  missing_toleranc
+0004a230: 6528 7365 6c66 2c20 5472 7565 293a 0d0a  e(self, True):..
+0004a240: 2020 2020 2020 2020 2020 2020 7465 6e73              tens
+0004a250: 6f72 6469 6374 5f72 6573 6574 203d 2073  ordict_reset = s
+0004a260: 656c 662e 5f63 616c 6c28 7465 6e73 6f72  elf._call(tensor
+0004a270: 6469 6374 5f72 6573 6574 290d 0a20 2020  dict_reset)..   
+0004a280: 2020 2020 2072 6574 7572 6e20 7465 6e73       return tens
+0004a290: 6f72 6469 6374 5f72 6573 6574 0d0a 0d0a  ordict_reset....
+0004a2a0: 0d0a 636c 6173 7320 5265 6d6f 7665 456d  ..class RemoveEm
+0004a2b0: 7074 7953 7065 6373 2854 7261 6e73 666f  ptySpecs(Transfo
+0004a2c0: 726d 293a 0d0a 2020 2020 2222 2252 656d  rm):..    """Rem
+0004a2d0: 6f76 6573 2065 6d70 7479 2073 7065 6373  oves empty specs
+0004a2e0: 2061 6e64 2063 6f6e 7465 6e74 2066 726f   and content fro
+0004a2f0: 6d20 616e 2065 6e76 6972 6f6e 6d65 6e74  m an environment
+0004a300: 2e0d 0a0d 0a20 2020 2045 7861 6d70 6c65  .....    Example
+0004a310: 733a 0d0a 2020 2020 2020 2020 3e3e 3e20  s:..        >>> 
+0004a320: 696d 706f 7274 2074 6f72 6368 0d0a 2020  import torch..  
+0004a330: 2020 2020 2020 3e3e 3e20 6672 6f6d 2074        >>> from t
+0004a340: 656e 736f 7264 6963 7420 696d 706f 7274  ensordict import
+0004a350: 2054 656e 736f 7244 6963 740d 0a20 2020   TensorDict..   
+0004a360: 2020 2020 203e 3e3e 2066 726f 6d20 746f       >>> from to
+0004a370: 7263 6872 6c2e 6461 7461 2069 6d70 6f72  rchrl.data impor
+0004a380: 7420 556e 626f 756e 6465 6443 6f6e 7469  t UnboundedConti
+0004a390: 6e75 6f75 7354 656e 736f 7253 7065 632c  nuousTensorSpec,
+0004a3a0: 2043 6f6d 706f 7369 7465 5370 6563 2c20   CompositeSpec, 
+0004a3b0: 5c0d 0a20 2020 2020 2020 202e 2e2e 2020  \..        ...  
+0004a3c0: 2020 2044 6973 6372 6574 6554 656e 736f     DiscreteTenso
+0004a3d0: 7253 7065 630d 0a20 2020 2020 2020 203e  rSpec..        >
+0004a3e0: 3e3e 2066 726f 6d20 746f 7263 6872 6c2e  >> from torchrl.
+0004a3f0: 656e 7673 2069 6d70 6f72 7420 456e 7642  envs import EnvB
+0004a400: 6173 652c 2054 7261 6e73 666f 726d 6564  ase, Transformed
+0004a410: 456e 762c 2052 656d 6f76 6545 6d70 7479  Env, RemoveEmpty
+0004a420: 5370 6563 730d 0a20 2020 2020 2020 203e  Specs..        >
+0004a430: 3e3e 0d0a 2020 2020 2020 2020 3e3e 3e0d  >>..        >>>.
+0004a440: 0a20 2020 2020 2020 203e 3e3e 2063 6c61  .        >>> cla
+0004a450: 7373 2044 756d 6d79 456e 7628 456e 7642  ss DummyEnv(EnvB
+0004a460: 6173 6529 3a0d 0a20 2020 2020 2020 202e  ase):..        .
+0004a470: 2e2e 2020 2020 2064 6566 205f 5f69 6e69  ..     def __ini
+0004a480: 745f 5f28 7365 6c66 2c20 2a61 7267 732c  t__(self, *args,
+0004a490: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+0004a4a0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+0004a4b0: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
+0004a4c0: 5f28 2a61 7267 732c 202a 2a6b 7761 7267  _(*args, **kwarg
+0004a4d0: 7329 0d0a 2020 2020 2020 2020 2e2e 2e20  s)..        ... 
+0004a4e0: 2020 2020 2020 2020 7365 6c66 2e6f 6273          self.obs
+0004a4f0: 6572 7661 7469 6f6e 5f73 7065 6320 3d20  ervation_spec = 
+0004a500: 436f 6d70 6f73 6974 6553 7065 6328 0d0a  CompositeSpec(..
+0004a510: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0004a520: 2020 2020 2020 2020 6f62 7365 7276 6174          observat
+0004a530: 696f 6e3d 556e 626f 756e 6465 6443 6f6e  ion=UnboundedCon
+0004a540: 7469 6e75 6f75 7354 656e 736f 7253 7065  tinuousTensorSpe
+0004a550: 6328 282a 7365 6c66 2e62 6174 6368 5f73  c((*self.batch_s
+0004a560: 697a 652c 2033 2929 2c0d 0a20 2020 2020  ize, 3)),..     
+0004a570: 2020 202e 2e2e 2020 2020 2020 2020 2020     ...          
+0004a580: 2020 206f 7468 6572 3d43 6f6d 706f 7369     other=Composi
+0004a590: 7465 5370 6563 280d 0a20 2020 2020 2020  teSpec(..       
+0004a5a0: 202e 2e2e 2020 2020 2020 2020 2020 2020   ...            
+0004a5b0: 2020 2020 2061 6e6f 7468 6572 5f6f 7468       another_oth
+0004a5c0: 6572 3d43 6f6d 706f 7369 7465 5370 6563  er=CompositeSpec
+0004a5d0: 2873 6861 7065 3d73 656c 662e 6261 7463  (shape=self.batc
+0004a5e0: 685f 7369 7a65 292c 0d0a 2020 2020 2020  h_size),..      
+0004a5f0: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
+0004a600: 2020 2020 2020 7368 6170 653d 7365 6c66        shape=self
+0004a610: 2e62 6174 6368 5f73 697a 652c 0d0a 2020  .batch_size,..  
+0004a620: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+0004a630: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
+0004a640: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
+0004a650: 2020 7368 6170 653d 7365 6c66 2e62 6174    shape=self.bat
+0004a660: 6368 5f73 697a 652c 0d0a 2020 2020 2020  ch_size,..      
+0004a670: 2020 2e2e 2e20 2020 2020 2020 2020 290d    ...         ).
 0004a680: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0004a690: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-0004a6a0: 2020 2020 2e2e 2e0d 0a20 2020 2020 2020      .....       
-0004a6b0: 202e 2e2e 2020 2020 2064 6566 205f 7265   ...     def _re
-0004a6c0: 7365 7428 7365 6c66 2c20 7465 6e73 6f72  set(self, tensor
-0004a6d0: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
-0004a6e0: 2e2e 2e20 2020 2020 2020 2020 7265 7475  ...         retu
-0004a6f0: 726e 2073 656c 662e 6f62 7365 7276 6174  rn self.observat
-0004a700: 696f 6e5f 7370 6563 2e72 616e 6428 292e  ion_spec.rand().
-0004a710: 7570 6461 7465 2873 656c 662e 6675 6c6c  update(self.full
-0004a720: 5f64 6f6e 655f 7370 6563 2e7a 6572 6f28  _done_spec.zero(
-0004a730: 2929 0d0a 2020 2020 2020 2020 2e2e 2e0d  ))..        ....
-0004a740: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0004a750: 2064 6566 205f 7374 6570 2873 656c 662c   def _step(self,
-0004a760: 2074 656e 736f 7264 6963 7429 3a0d 0a20   tensordict):.. 
-0004a770: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-0004a780: 2020 2072 6574 7572 6e20 5465 6e73 6f72     return Tensor
-0004a790: 4469 6374 280d 0a20 2020 2020 2020 202e  Dict(..        .
-0004a7a0: 2e2e 2020 2020 2020 2020 2020 2020 207b  ..             {
-0004a7b0: 7d2c 0d0a 2020 2020 2020 2020 2e2e 2e20  },..        ... 
-0004a7c0: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-0004a7d0: 685f 7369 7a65 3d5b 5d0d 0a20 2020 2020  h_size=[]..     
-0004a7e0: 2020 202e 2e2e 2020 2020 2020 2020 2029     ...         )
-0004a7f0: 2e75 7064 6174 6528 7365 6c66 2e6f 6273  .update(self.obs
-0004a800: 6572 7661 7469 6f6e 5f73 7065 632e 7261  ervation_spec.ra
-0004a810: 6e64 2829 292e 7570 6461 7465 280d 0a20  nd()).update(.. 
-0004a820: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-0004a830: 2020 2020 2020 2073 656c 662e 6675 6c6c         self.full
-0004a840: 5f64 6f6e 655f 7370 6563 2e7a 6572 6f28  _done_spec.zero(
-0004a850: 290d 0a20 2020 2020 2020 202e 2e2e 2020  )..        ...  
-0004a860: 2020 2020 2020 2020 2020 2029 2e75 7064             ).upd
-0004a870: 6174 6528 7365 6c66 2e66 756c 6c5f 7265  ate(self.full_re
-0004a880: 7761 7264 5f73 7065 632e 7261 6e64 2829  ward_spec.rand()
-0004a890: 290d 0a20 2020 2020 2020 202e 2e2e 0d0a  )..        .....
-0004a8a0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0004a8b0: 6465 6620 5f73 6574 5f73 6565 6428 7365  def _set_seed(se
-0004a8c0: 6c66 2c20 7365 6564 293a 0d0a 2020 2020  lf, seed):..    
-0004a8d0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0004a8e0: 7265 7475 726e 2073 6565 6420 2b20 310d  return seed + 1.
-0004a8f0: 0a20 2020 2020 2020 203e 3e3e 0d0a 2020  .        >>>..  
-0004a900: 2020 2020 2020 3e3e 3e0d 0a20 2020 2020        >>>..     
-0004a910: 2020 203e 3e3e 2062 6173 655f 656e 7620     >>> base_env 
-0004a920: 3d20 4475 6d6d 7945 6e76 2829 0d0a 2020  = DummyEnv()..  
-0004a930: 2020 2020 2020 3e3e 3e20 7072 696e 7428        >>> print(
-0004a940: 6261 7365 5f65 6e76 2e72 6f6c 6c6f 7574  base_env.rollout
-0004a950: 2832 2929 0d0a 2020 2020 2020 2020 5465  (2))..        Te
-0004a960: 6e73 6f72 4469 6374 280d 0a20 2020 2020  nsorDict(..     
-0004a970: 2020 2020 2020 2066 6965 6c64 733d 7b0d         fields={.
-0004a980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004a990: 2061 6374 696f 6e3a 2054 656e 736f 7228   action: Tensor(
-0004a9a0: 7368 6170 653d 746f 7263 682e 5369 7a65  shape=torch.Size
-0004a9b0: 285b 322c 2033 5d29 2c20 6465 7669 6365  ([2, 3]), device
-0004a9c0: 3d63 7075 2c20 6474 7970 653d 746f 7263  =cpu, dtype=torc
-0004a9d0: 682e 666c 6f61 7433 322c 2069 735f 7368  h.float32, is_sh
-0004a9e0: 6172 6564 3d46 616c 7365 292c 0d0a 2020  ared=False),..  
-0004a9f0: 2020 2020 2020 2020 2020 2020 2020 646f                do
-0004aa00: 6e65 3a20 5465 6e73 6f72 2873 6861 7065  ne: Tensor(shape
-0004aa10: 3d74 6f72 6368 2e53 697a 6528 5b32 2c20  =torch.Size([2, 
-0004aa20: 315d 292c 2064 6576 6963 653d 6370 752c  1]), device=cpu,
-0004aa30: 2064 7479 7065 3d74 6f72 6368 2e62 6f6f   dtype=torch.boo
-0004aa40: 6c2c 2069 735f 7368 6172 6564 3d46 616c  l, is_shared=Fal
-0004aa50: 7365 292c 0d0a 2020 2020 2020 2020 2020  se),..          
-0004aa60: 2020 2020 2020 6e65 7874 3a20 5465 6e73        next: Tens
-0004aa70: 6f72 4469 6374 280d 0a20 2020 2020 2020  orDict(..       
-0004aa80: 2020 2020 2020 2020 2020 2020 2066 6965               fie
-0004aa90: 6c64 733d 7b0d 0a20 2020 2020 2020 2020  lds={..         
-0004aaa0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0004aab0: 6f6e 653a 2054 656e 736f 7228 7368 6170  one: Tensor(shap
-0004aac0: 653d 746f 7263 682e 5369 7a65 285b 322c  e=torch.Size([2,
-0004aad0: 2031 5d29 2c20 6465 7669 6365 3d63 7075   1]), device=cpu
-0004aae0: 2c20 6474 7970 653d 746f 7263 682e 626f  , dtype=torch.bo
-0004aaf0: 6f6c 2c20 6973 5f73 6861 7265 643d 4661  ol, is_shared=Fa
-0004ab00: 6c73 6529 2c0d 0a20 2020 2020 2020 2020  lse),..         
-0004ab10: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0004ab20: 6273 6572 7661 7469 6f6e 3a20 5465 6e73  bservation: Tens
-0004ab30: 6f72 2873 6861 7065 3d74 6f72 6368 2e53  or(shape=torch.S
-0004ab40: 697a 6528 5b32 2c20 335d 292c 2064 6576  ize([2, 3]), dev
-0004ab50: 6963 653d 6370 752c 2064 7479 7065 3d74  ice=cpu, dtype=t
-0004ab60: 6f72 6368 2e66 6c6f 6174 3332 2c20 6973  orch.float32, is
-0004ab70: 5f73 6861 7265 643d 4661 6c73 6529 2c0d  _shared=False),.
-0004ab80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ab90: 2020 2020 2020 2020 206f 7468 6572 3a20           other: 
-0004aba0: 5465 6e73 6f72 4469 6374 280d 0a20 2020  TensorDict(..   
-0004abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004abc0: 2020 2020 2020 2020 2066 6965 6c64 733d           fields=
-0004abd0: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
-0004abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004abf0: 2020 2061 6e6f 7468 6572 5f6f 7468 6572     another_other
-0004ac00: 3a20 5465 6e73 6f72 4469 6374 280d 0a20  : TensorDict(.. 
-0004ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac30: 2020 2066 6965 6c64 733d 7b0d 0a20 2020     fields={..   
-0004ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac60: 207d 2c0d 0a20 2020 2020 2020 2020 2020   },..           
-0004ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac80: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
-0004ac90: 697a 653d 746f 7263 682e 5369 7a65 285b  ize=torch.Size([
-0004aca0: 325d 292c 0d0a 2020 2020 2020 2020 2020  2]),..          
-0004acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004acc0: 2020 2020 2020 2020 2020 6465 7669 6365            device
-0004acd0: 3d63 7075 2c0d 0a20 2020 2020 2020 2020  =cpu,..         
-0004ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004acf0: 2020 2020 2020 2020 2020 2069 735f 7368             is_sh
-0004ad00: 6172 6564 3d46 616c 7365 297d 2c0d 0a20  ared=False)},.. 
+0004a690: 2020 2020 2073 656c 662e 6163 7469 6f6e       self.action
+0004a6a0: 5f73 7065 6320 3d20 556e 626f 756e 6465  _spec = Unbounde
+0004a6b0: 6443 6f6e 7469 6e75 6f75 7354 656e 736f  dContinuousTenso
+0004a6c0: 7253 7065 6328 282a 7365 6c66 2e62 6174  rSpec((*self.bat
+0004a6d0: 6368 5f73 697a 652c 2033 2929 0d0a 2020  ch_size, 3))..  
+0004a6e0: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+0004a6f0: 2020 7365 6c66 2e64 6f6e 655f 7370 6563    self.done_spec
+0004a700: 203d 2044 6973 6372 6574 6554 656e 736f   = DiscreteTenso
+0004a710: 7253 7065 6328 0d0a 2020 2020 2020 2020  rSpec(..        
+0004a720: 2e2e 2e20 2020 2020 2020 2020 2020 2020  ...             
+0004a730: 322c 2028 2a73 656c 662e 6261 7463 685f  2, (*self.batch_
+0004a740: 7369 7a65 2c20 3129 2c20 6474 7970 653d  size, 1), dtype=
+0004a750: 746f 7263 682e 626f 6f6c 0d0a 2020 2020  torch.bool..    
+0004a760: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+0004a770: 290d 0a20 2020 2020 2020 202e 2e2e 2020  )..        ...  
+0004a780: 2020 2020 2020 2073 656c 662e 6675 6c6c         self.full
+0004a790: 5f64 6f6e 655f 7370 6563 5b22 7472 756e  _done_spec["trun
+0004a7a0: 6361 7465 6422 5d20 3d20 7365 6c66 2e66  cated"] = self.f
+0004a7b0: 756c 6c5f 646f 6e65 5f73 7065 635b 0d0a  ull_done_spec[..
+0004a7c0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0004a7d0: 2020 2020 2020 2020 2274 6572 6d69 6e61          "termina
+0004a7e0: 7465 6422 5d2e 636c 6f6e 6528 290d 0a20  ted"].clone().. 
+0004a7f0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
+0004a800: 2020 2073 656c 662e 7265 7761 7264 5f73     self.reward_s
+0004a810: 7065 6320 3d20 436f 6d70 6f73 6974 6553  pec = CompositeS
+0004a820: 7065 6328 0d0a 2020 2020 2020 2020 2e2e  pec(..        ..
+0004a830: 2e20 2020 2020 2020 2020 2020 2020 7265  .             re
+0004a840: 7761 7264 3d55 6e62 6f75 6e64 6564 436f  ward=UnboundedCo
+0004a850: 6e74 696e 756f 7573 5465 6e73 6f72 5370  ntinuousTensorSp
+0004a860: 6563 282a 7365 6c66 2e62 6174 6368 5f73  ec(*self.batch_s
+0004a870: 697a 652c 2031 292c 0d0a 2020 2020 2020  ize, 1),..      
+0004a880: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
+0004a890: 2020 6f74 6865 725f 7265 7761 7264 3d43    other_reward=C
+0004a8a0: 6f6d 706f 7369 7465 5370 6563 2873 6861  ompositeSpec(sha
+0004a8b0: 7065 3d73 656c 662e 6261 7463 685f 7369  pe=self.batch_si
+0004a8c0: 7a65 292c 0d0a 2020 2020 2020 2020 2e2e  ze),..        ..
+0004a8d0: 2e20 2020 2020 2020 2020 2020 2020 7368  .             sh
+0004a8e0: 6170 653d 7365 6c66 2e62 6174 6368 5f73  ape=self.batch_s
+0004a8f0: 697a 650d 0a20 2020 2020 2020 202e 2e2e  ize..        ...
+0004a900: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0004a910: 2020 2020 2020 2020 2e2e 2e0d 0a20 2020          .....   
+0004a920: 2020 2020 202e 2e2e 2020 2020 2064 6566       ...     def
+0004a930: 205f 7265 7365 7428 7365 6c66 2c20 7465   _reset(self, te
+0004a940: 6e73 6f72 6469 6374 293a 0d0a 2020 2020  nsordict):..    
+0004a950: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+0004a960: 7265 7475 726e 2073 656c 662e 6f62 7365  return self.obse
+0004a970: 7276 6174 696f 6e5f 7370 6563 2e72 616e  rvation_spec.ran
+0004a980: 6428 292e 7570 6461 7465 2873 656c 662e  d().update(self.
+0004a990: 6675 6c6c 5f64 6f6e 655f 7370 6563 2e7a  full_done_spec.z
+0004a9a0: 6572 6f28 2929 0d0a 2020 2020 2020 2020  ero())..        
+0004a9b0: 2e2e 2e0d 0a20 2020 2020 2020 202e 2e2e  .....        ...
+0004a9c0: 2020 2020 2064 6566 205f 7374 6570 2873       def _step(s
+0004a9d0: 656c 662c 2074 656e 736f 7264 6963 7429  elf, tensordict)
+0004a9e0: 3a0d 0a20 2020 2020 2020 202e 2e2e 2020  :..        ...  
+0004a9f0: 2020 2020 2020 2072 6574 7572 6e20 5465         return Te
+0004aa00: 6e73 6f72 4469 6374 280d 0a20 2020 2020  nsorDict(..     
+0004aa10: 2020 202e 2e2e 2020 2020 2020 2020 2020     ...          
+0004aa20: 2020 207b 7d2c 0d0a 2020 2020 2020 2020     {},..        
+0004aa30: 2e2e 2e20 2020 2020 2020 2020 2020 2020  ...             
+0004aa40: 6261 7463 685f 7369 7a65 3d5b 5d0d 0a20  batch_size=[].. 
+0004aa50: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
+0004aa60: 2020 2029 2e75 7064 6174 6528 7365 6c66     ).update(self
+0004aa70: 2e6f 6273 6572 7661 7469 6f6e 5f73 7065  .observation_spe
+0004aa80: 632e 7261 6e64 2829 292e 7570 6461 7465  c.rand()).update
+0004aa90: 280d 0a20 2020 2020 2020 202e 2e2e 2020  (..        ...  
+0004aaa0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004aab0: 6675 6c6c 5f64 6f6e 655f 7370 6563 2e7a  full_done_spec.z
+0004aac0: 6572 6f28 290d 0a20 2020 2020 2020 202e  ero()..        .
+0004aad0: 2e2e 2020 2020 2020 2020 2020 2020 2029  ..             )
+0004aae0: 2e75 7064 6174 6528 7365 6c66 2e66 756c  .update(self.ful
+0004aaf0: 6c5f 7265 7761 7264 5f73 7065 632e 7261  l_reward_spec.ra
+0004ab00: 6e64 2829 290d 0a20 2020 2020 2020 202e  nd())..        .
+0004ab10: 2e2e 0d0a 2020 2020 2020 2020 2e2e 2e20  ....        ... 
+0004ab20: 2020 2020 6465 6620 5f73 6574 5f73 6565      def _set_see
+0004ab30: 6428 7365 6c66 2c20 7365 6564 293a 0d0a  d(self, seed):..
+0004ab40: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0004ab50: 2020 2020 7265 7475 726e 2073 6565 6420      return seed 
+0004ab60: 2b20 310d 0a20 2020 2020 2020 203e 3e3e  + 1..        >>>
+0004ab70: 0d0a 2020 2020 2020 2020 3e3e 3e0d 0a20  ..        >>>.. 
+0004ab80: 2020 2020 2020 203e 3e3e 2062 6173 655f         >>> base_
+0004ab90: 656e 7620 3d20 4475 6d6d 7945 6e76 2829  env = DummyEnv()
+0004aba0: 0d0a 2020 2020 2020 2020 3e3e 3e20 7072  ..        >>> pr
+0004abb0: 696e 7428 6261 7365 5f65 6e76 2e72 6f6c  int(base_env.rol
+0004abc0: 6c6f 7574 2832 2929 0d0a 2020 2020 2020  lout(2))..      
+0004abd0: 2020 5465 6e73 6f72 4469 6374 280d 0a20    TensorDict(.. 
+0004abe0: 2020 2020 2020 2020 2020 2066 6965 6c64             field
+0004abf0: 733d 7b0d 0a20 2020 2020 2020 2020 2020  s={..           
+0004ac00: 2020 2020 2061 6374 696f 6e3a 2054 656e       action: Ten
+0004ac10: 736f 7228 7368 6170 653d 746f 7263 682e  sor(shape=torch.
+0004ac20: 5369 7a65 285b 322c 2033 5d29 2c20 6465  Size([2, 3]), de
+0004ac30: 7669 6365 3d63 7075 2c20 6474 7970 653d  vice=cpu, dtype=
+0004ac40: 746f 7263 682e 666c 6f61 7433 322c 2069  torch.float32, i
+0004ac50: 735f 7368 6172 6564 3d46 616c 7365 292c  s_shared=False),
+0004ac60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004ac70: 2020 646f 6e65 3a20 5465 6e73 6f72 2873    done: Tensor(s
+0004ac80: 6861 7065 3d74 6f72 6368 2e53 697a 6528  hape=torch.Size(
+0004ac90: 5b32 2c20 315d 292c 2064 6576 6963 653d  [2, 1]), device=
+0004aca0: 6370 752c 2064 7479 7065 3d74 6f72 6368  cpu, dtype=torch
+0004acb0: 2e62 6f6f 6c2c 2069 735f 7368 6172 6564  .bool, is_shared
+0004acc0: 3d46 616c 7365 292c 0d0a 2020 2020 2020  =False),..      
+0004acd0: 2020 2020 2020 2020 2020 6e65 7874 3a20            next: 
+0004ace0: 5465 6e73 6f72 4469 6374 280d 0a20 2020  TensorDict(..   
+0004acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ad00: 2066 6965 6c64 733d 7b0d 0a20 2020 2020   fields={..     
 0004ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ad20: 2020 2020 2020 2020 2020 2062 6174 6368             batch
-0004ad30: 5f73 697a 653d 746f 7263 682e 5369 7a65  _size=torch.Size
-0004ad40: 285b 325d 292c 0d0a 2020 2020 2020 2020  ([2]),..        
-0004ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ad60: 2020 2020 6465 7669 6365 3d63 7075 2c0d      device=cpu,.
-0004ad70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ad80: 2020 2020 2020 2020 2020 2020 2069 735f               is_
-0004ad90: 7368 6172 6564 3d46 616c 7365 292c 0d0a  shared=False),..
-0004ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004adb0: 2020 2020 2020 2020 6f74 6865 725f 7265          other_re
-0004adc0: 7761 7264 3a20 5465 6e73 6f72 4469 6374  ward: TensorDict
-0004add0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0004ade0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0004adf0: 6965 6c64 733d 7b0d 0a20 2020 2020 2020  ields={..       
-0004ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ae10: 2020 2020 207d 2c0d 0a20 2020 2020 2020       },..       
-0004ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ae30: 2020 2020 2062 6174 6368 5f73 697a 653d       batch_size=
-0004ae40: 746f 7263 682e 5369 7a65 285b 325d 292c  torch.Size([2]),
-0004ae50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004ae60: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0004ae70: 7669 6365 3d63 7075 2c0d 0a20 2020 2020  vice=cpu,..     
-0004ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ae90: 2020 2020 2020 2069 735f 7368 6172 6564         is_shared
-0004aea0: 3d46 616c 7365 292c 0d0a 2020 2020 2020  =False),..      
-0004aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aec0: 2020 7265 7761 7264 3a20 5465 6e73 6f72    reward: Tensor
-0004aed0: 2873 6861 7065 3d74 6f72 6368 2e53 697a  (shape=torch.Siz
-0004aee0: 6528 5b32 2c20 315d 292c 2064 6576 6963  e([2, 1]), devic
-0004aef0: 653d 6370 752c 2064 7479 7065 3d74 6f72  e=cpu, dtype=tor
-0004af00: 6368 2e66 6c6f 6174 3332 2c20 6973 5f73  ch.float32, is_s
-0004af10: 6861 7265 643d 4661 6c73 6529 2c0d 0a20  hared=False),.. 
+0004ad20: 2020 2064 6f6e 653a 2054 656e 736f 7228     done: Tensor(
+0004ad30: 7368 6170 653d 746f 7263 682e 5369 7a65  shape=torch.Size
+0004ad40: 285b 322c 2031 5d29 2c20 6465 7669 6365  ([2, 1]), device
+0004ad50: 3d63 7075 2c20 6474 7970 653d 746f 7263  =cpu, dtype=torc
+0004ad60: 682e 626f 6f6c 2c20 6973 5f73 6861 7265  h.bool, is_share
+0004ad70: 643d 4661 6c73 6529 2c0d 0a20 2020 2020  d=False),..     
+0004ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ad90: 2020 206f 6273 6572 7661 7469 6f6e 3a20     observation: 
+0004ada0: 5465 6e73 6f72 2873 6861 7065 3d74 6f72  Tensor(shape=tor
+0004adb0: 6368 2e53 697a 6528 5b32 2c20 335d 292c  ch.Size([2, 3]),
+0004adc0: 2064 6576 6963 653d 6370 752c 2064 7479   device=cpu, dty
+0004add0: 7065 3d74 6f72 6368 2e66 6c6f 6174 3332  pe=torch.float32
+0004ade0: 2c20 6973 5f73 6861 7265 643d 4661 6c73  , is_shared=Fals
+0004adf0: 6529 2c0d 0a20 2020 2020 2020 2020 2020  e),..           
+0004ae00: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+0004ae10: 6572 3a20 5465 6e73 6f72 4469 6374 280d  er: TensorDict(.
+0004ae20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ae30: 2020 2020 2020 2020 2020 2020 2066 6965               fie
+0004ae40: 6c64 733d 7b0d 0a20 2020 2020 2020 2020  lds={..         
+0004ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ae60: 2020 2020 2020 2061 6e6f 7468 6572 5f6f         another_o
+0004ae70: 7468 6572 3a20 5465 6e73 6f72 4469 6374  ther: TensorDict
+0004ae80: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0004ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aea0: 2020 2020 2020 2066 6965 6c64 733d 7b0d         fields={.
+0004aeb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aed0: 2020 2020 207d 2c0d 0a20 2020 2020 2020       },..       
+0004aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aef0: 2020 2020 2020 2020 2020 2020 2062 6174               bat
+0004af00: 6368 5f73 697a 653d 746f 7263 682e 5369  ch_size=torch.Si
+0004af10: 7a65 285b 325d 292c 0d0a 2020 2020 2020  ze([2]),..      
 0004af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004af30: 2020 2020 2020 2074 6572 6d69 6e61 7465         terminate
-0004af40: 643a 2054 656e 736f 7228 7368 6170 653d  d: Tensor(shape=
-0004af50: 746f 7263 682e 5369 7a65 285b 322c 2031  torch.Size([2, 1
-0004af60: 5d29 2c20 6465 7669 6365 3d63 7075 2c20  ]), device=cpu, 
-0004af70: 6474 7970 653d 746f 7263 682e 626f 6f6c  dtype=torch.bool
-0004af80: 2c20 6973 5f73 6861 7265 643d 4661 6c73  , is_shared=Fals
-0004af90: 6529 2c0d 0a20 2020 2020 2020 2020 2020  e),..           
-0004afa0: 2020 2020 2020 2020 2020 2020 2074 7275               tru
-0004afb0: 6e63 6174 6564 3a20 5465 6e73 6f72 2873  ncated: Tensor(s
-0004afc0: 6861 7065 3d74 6f72 6368 2e53 697a 6528  hape=torch.Size(
-0004afd0: 5b32 2c20 315d 292c 2064 6576 6963 653d  [2, 1]), device=
-0004afe0: 6370 752c 2064 7479 7065 3d74 6f72 6368  cpu, dtype=torch
-0004aff0: 2e62 6f6f 6c2c 2069 735f 7368 6172 6564  .bool, is_shared
-0004b000: 3d46 616c 7365 297d 2c0d 0a20 2020 2020  =False)},..     
-0004b010: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0004b020: 6174 6368 5f73 697a 653d 746f 7263 682e  atch_size=torch.
-0004b030: 5369 7a65 285b 325d 292c 0d0a 2020 2020  Size([2]),..    
-0004b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b050: 6465 7669 6365 3d63 7075 2c0d 0a20 2020  device=cpu,..   
-0004b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b070: 2069 735f 7368 6172 6564 3d46 616c 7365   is_shared=False
-0004b080: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-0004b090: 2020 2020 6f62 7365 7276 6174 696f 6e3a      observation:
-0004b0a0: 2054 656e 736f 7228 7368 6170 653d 746f   Tensor(shape=to
-0004b0b0: 7263 682e 5369 7a65 285b 322c 2033 5d29  rch.Size([2, 3])
-0004b0c0: 2c20 6465 7669 6365 3d63 7075 2c20 6474  , device=cpu, dt
-0004b0d0: 7970 653d 746f 7263 682e 666c 6f61 7433  ype=torch.float3
-0004b0e0: 322c 2069 735f 7368 6172 6564 3d46 616c  2, is_shared=Fal
-0004b0f0: 7365 292c 0d0a 2020 2020 2020 2020 2020  se),..          
-0004b100: 2020 2020 2020 7465 726d 696e 6174 6564        terminated
-0004b110: 3a20 5465 6e73 6f72 2873 6861 7065 3d74  : Tensor(shape=t
-0004b120: 6f72 6368 2e53 697a 6528 5b32 2c20 315d  orch.Size([2, 1]
-0004b130: 292c 2064 6576 6963 653d 6370 752c 2064  ), device=cpu, d
-0004b140: 7479 7065 3d74 6f72 6368 2e62 6f6f 6c2c  type=torch.bool,
-0004b150: 2069 735f 7368 6172 6564 3d46 616c 7365   is_shared=False
-0004b160: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-0004b170: 2020 2020 7472 756e 6361 7465 643a 2054      truncated: T
-0004b180: 656e 736f 7228 7368 6170 653d 746f 7263  ensor(shape=torc
-0004b190: 682e 5369 7a65 285b 322c 2031 5d29 2c20  h.Size([2, 1]), 
-0004b1a0: 6465 7669 6365 3d63 7075 2c20 6474 7970  device=cpu, dtyp
-0004b1b0: 653d 746f 7263 682e 626f 6f6c 2c20 6973  e=torch.bool, is
-0004b1c0: 5f73 6861 7265 643d 4661 6c73 6529 7d2c  _shared=False)},
-0004b1d0: 0d0a 2020 2020 2020 2020 2020 2020 6261  ..            ba
-0004b1e0: 7463 685f 7369 7a65 3d74 6f72 6368 2e53  tch_size=torch.S
-0004b1f0: 697a 6528 5b32 5d29 2c0d 0a20 2020 2020  ize([2]),..     
-0004b200: 2020 2020 2020 2064 6576 6963 653d 6370         device=cp
-0004b210: 752c 0d0a 2020 2020 2020 2020 2020 2020  u,..            
-0004b220: 6973 5f73 6861 7265 643d 4661 6c73 6529  is_shared=False)
-0004b230: 0d0a 2020 2020 2020 2020 3e3e 3e20 6368  ..        >>> ch
-0004b240: 6563 6b5f 656e 765f 7370 6563 7328 6261  eck_env_specs(ba
-0004b250: 7365 5f65 6e76 290d 0a20 2020 2020 2020  se_env)..       
-0004b260: 203e 3e3e 2065 6e76 203d 2054 7261 6e73   >>> env = Trans
-0004b270: 666f 726d 6564 456e 7628 6261 7365 5f65  formedEnv(base_e
-0004b280: 6e76 2c20 5265 6d6f 7665 456d 7074 7953  nv, RemoveEmptyS
-0004b290: 7065 6373 2829 290d 0a20 2020 2020 2020  pecs())..       
-0004b2a0: 203e 3e3e 2070 7269 6e74 2865 6e76 2e72   >>> print(env.r
-0004b2b0: 6f6c 6c6f 7574 2832 2929 0d0a 2020 2020  ollout(2))..    
-0004b2c0: 2020 2020 5465 6e73 6f72 4469 6374 280d      TensorDict(.
-0004b2d0: 0a20 2020 2020 2020 2020 2020 2066 6965  .            fie
-0004b2e0: 6c64 733d 7b0d 0a20 2020 2020 2020 2020  lds={..         
-0004b2f0: 2020 2020 2020 2061 6374 696f 6e3a 2054         action: T
-0004b300: 656e 736f 7228 7368 6170 653d 746f 7263  ensor(shape=torc
-0004b310: 682e 5369 7a65 285b 322c 2033 5d29 2c20  h.Size([2, 3]), 
-0004b320: 6465 7669 6365 3d63 7075 2c20 6474 7970  device=cpu, dtyp
-0004b330: 653d 746f 7263 682e 666c 6f61 7433 322c  e=torch.float32,
-0004b340: 2069 735f 7368 6172 6564 3d46 616c 7365   is_shared=False
-0004b350: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-0004b360: 2020 2020 646f 6e65 3a20 5465 6e73 6f72      done: Tensor
-0004b370: 2873 6861 7065 3d74 6f72 6368 2e53 697a  (shape=torch.Siz
-0004b380: 6528 5b32 2c20 315d 292c 2064 6576 6963  e([2, 1]), devic
-0004b390: 653d 6370 752c 2064 7479 7065 3d74 6f72  e=cpu, dtype=tor
-0004b3a0: 6368 2e62 6f6f 6c2c 2069 735f 7368 6172  ch.bool, is_shar
-0004b3b0: 6564 3d46 616c 7365 292c 0d0a 2020 2020  ed=False),..    
-0004b3c0: 2020 2020 2020 2020 2020 2020 6e65 7874              next
-0004b3d0: 3a20 5465 6e73 6f72 4469 6374 280d 0a20  : TensorDict(.. 
-0004b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b3f0: 2020 2066 6965 6c64 733d 7b0d 0a20 2020     fields={..   
-0004b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b410: 2020 2020 2064 6f6e 653a 2054 656e 736f       done: Tenso
-0004b420: 7228 7368 6170 653d 746f 7263 682e 5369  r(shape=torch.Si
-0004b430: 7a65 285b 322c 2031 5d29 2c20 6465 7669  ze([2, 1]), devi
-0004b440: 6365 3d63 7075 2c20 6474 7970 653d 746f  ce=cpu, dtype=to
-0004b450: 7263 682e 626f 6f6c 2c20 6973 5f73 6861  rch.bool, is_sha
-0004b460: 7265 643d 4661 6c73 6529 2c0d 0a20 2020  red=False),..   
-0004b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b480: 2020 2020 206f 6273 6572 7661 7469 6f6e       observation
-0004b490: 3a20 5465 6e73 6f72 2873 6861 7065 3d74  : Tensor(shape=t
-0004b4a0: 6f72 6368 2e53 697a 6528 5b32 2c20 335d  orch.Size([2, 3]
-0004b4b0: 292c 2064 6576 6963 653d 6370 752c 2064  ), device=cpu, d
-0004b4c0: 7479 7065 3d74 6f72 6368 2e66 6c6f 6174  type=torch.float
-0004b4d0: 3332 2c20 6973 5f73 6861 7265 643d 4661  32, is_shared=Fa
-0004b4e0: 6c73 6529 2c0d 0a20 2020 2020 2020 2020  lse),..         
-0004b4f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004b500: 6577 6172 643a 2054 656e 736f 7228 7368  eward: Tensor(sh
-0004b510: 6170 653d 746f 7263 682e 5369 7a65 285b  ape=torch.Size([
-0004b520: 322c 2031 5d29 2c20 6465 7669 6365 3d63  2, 1]), device=c
-0004b530: 7075 2c20 6474 7970 653d 746f 7263 682e  pu, dtype=torch.
-0004b540: 666c 6f61 7433 322c 2069 735f 7368 6172  float32, is_shar
-0004b550: 6564 3d46 616c 7365 292c 0d0a 2020 2020  ed=False),..    
-0004b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b570: 2020 2020 7465 726d 696e 6174 6564 3a20      terminated: 
-0004b580: 5465 6e73 6f72 2873 6861 7065 3d74 6f72  Tensor(shape=tor
-0004b590: 6368 2e53 697a 6528 5b32 2c20 315d 292c  ch.Size([2, 1]),
-0004b5a0: 2064 6576 6963 653d 6370 752c 2064 7479   device=cpu, dty
-0004b5b0: 7065 3d74 6f72 6368 2e62 6f6f 6c2c 2069  pe=torch.bool, i
-0004b5c0: 735f 7368 6172 6564 3d46 616c 7365 292c  s_shared=False),
-0004b5d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004b5e0: 2020 2020 2020 2020 2020 7472 756e 6361            trunca
-0004b5f0: 7465 643a 2054 656e 736f 7228 7368 6170  ted: Tensor(shap
-0004b600: 653d 746f 7263 682e 5369 7a65 285b 322c  e=torch.Size([2,
-0004b610: 2031 5d29 2c20 6465 7669 6365 3d63 7075   1]), device=cpu
-0004b620: 2c20 6474 7970 653d 746f 7263 682e 626f  , dtype=torch.bo
-0004b630: 6f6c 2c20 6973 5f73 6861 7265 643d 4661  ol, is_shared=Fa
-0004b640: 6c73 6529 7d2c 0d0a 2020 2020 2020 2020  lse)},..        
-0004b650: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-0004b660: 685f 7369 7a65 3d74 6f72 6368 2e53 697a  h_size=torch.Siz
-0004b670: 6528 5b32 5d29 2c0d 0a20 2020 2020 2020  e([2]),..       
-0004b680: 2020 2020 2020 2020 2020 2020 2064 6576               dev
-0004b690: 6963 653d 6370 752c 0d0a 2020 2020 2020  ice=cpu,..      
-0004b6a0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-0004b6b0: 5f73 6861 7265 643d 4661 6c73 6529 2c0d  _shared=False),.
-0004b6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b6d0: 206f 6273 6572 7661 7469 6f6e 3a20 5465   observation: Te
-0004b6e0: 6e73 6f72 2873 6861 7065 3d74 6f72 6368  nsor(shape=torch
-0004b6f0: 2e53 697a 6528 5b32 2c20 335d 292c 2064  .Size([2, 3]), d
-0004b700: 6576 6963 653d 6370 752c 2064 7479 7065  evice=cpu, dtype
-0004b710: 3d74 6f72 6368 2e66 6c6f 6174 3332 2c20  =torch.float32, 
-0004b720: 6973 5f73 6861 7265 643d 4661 6c73 6529  is_shared=False)
-0004b730: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004b740: 2020 2074 6572 6d69 6e61 7465 643a 2054     terminated: T
-0004b750: 656e 736f 7228 7368 6170 653d 746f 7263  ensor(shape=torc
-0004b760: 682e 5369 7a65 285b 322c 2031 5d29 2c20  h.Size([2, 1]), 
-0004b770: 6465 7669 6365 3d63 7075 2c20 6474 7970  device=cpu, dtyp
-0004b780: 653d 746f 7263 682e 626f 6f6c 2c20 6973  e=torch.bool, is
-0004b790: 5f73 6861 7265 643d 4661 6c73 6529 2c0d  _shared=False),.
-0004b7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b7b0: 2074 7275 6e63 6174 6564 3a20 5465 6e73   truncated: Tens
-0004b7c0: 6f72 2873 6861 7065 3d74 6f72 6368 2e53  or(shape=torch.S
-0004b7d0: 697a 6528 5b32 2c20 315d 292c 2064 6576  ize([2, 1]), dev
-0004b7e0: 6963 653d 6370 752c 2064 7479 7065 3d74  ice=cpu, dtype=t
-0004b7f0: 6f72 6368 2e62 6f6f 6c2c 2069 735f 7368  orch.bool, is_sh
-0004b800: 6172 6564 3d46 616c 7365 297d 2c0d 0a20  ared=False)},.. 
-0004b810: 2020 2020 2020 2020 2020 2062 6174 6368             batch
-0004b820: 5f73 697a 653d 746f 7263 682e 5369 7a65  _size=torch.Size
-0004b830: 285b 325d 292c 0d0a 2020 2020 2020 2020  ([2]),..        
-0004b840: 2020 2020 6465 7669 6365 3d63 7075 2c0d      device=cpu,.
-0004b850: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
-0004b860: 7368 6172 6564 3d46 616c 7365 290d 0a20  shared=False).. 
-0004b870: 2020 2020 2020 2063 6865 636b 5f65 6e76         check_env
-0004b880: 5f73 7065 6373 2865 6e76 290d 0a20 2020  _specs(env)..   
-0004b890: 2022 2222 0d0a 0d0a 2020 2020 5f68 6173   """....    _has
-0004b8a0: 5f65 6d70 7479 5f69 6e70 7574 203d 2054  _empty_input = T
-0004b8b0: 7275 650d 0a0d 0a20 2020 2040 7374 6174  rue....    @stat
-0004b8c0: 6963 6d65 7468 6f64 0d0a 2020 2020 6465  icmethod..    de
-0004b8d0: 6620 5f73 6f72 7465 7228 6b65 795f 7661  f _sorter(key_va
-0004b8e0: 6c29 3a0d 0a20 2020 2020 2020 206b 6579  l):..        key
-0004b8f0: 2c20 5f20 3d20 6b65 795f 7661 6c0d 0a20  , _ = key_val.. 
-0004b900: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0004b910: 616e 6365 286b 6579 2c20 7374 7229 3a0d  ance(key, str):.
-0004b920: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0004b930: 7572 6e20 300d 0a20 2020 2020 2020 2072  urn 0..        r
-0004b940: 6574 7572 6e20 6c65 6e28 6b65 7929 0d0a  eturn len(key)..
-0004b950: 0d0a 2020 2020 6465 6620 7472 616e 7366  ..    def transf
-0004b960: 6f72 6d5f 6f75 7470 7574 5f73 7065 6328  orm_output_spec(
-0004b970: 7365 6c66 2c20 6f75 7470 7574 5f73 7065  self, output_spe
-0004b980: 633a 2043 6f6d 706f 7369 7465 5370 6563  c: CompositeSpec
-0004b990: 2920 2d3e 2043 6f6d 706f 7369 7465 5370  ) -> CompositeSp
-0004b9a0: 6563 3a0d 0a20 2020 2020 2020 2066 756c  ec:..        ful
-0004b9b0: 6c5f 646f 6e65 5f73 7065 6320 3d20 6f75  l_done_spec = ou
-0004b9c0: 7470 7574 5f73 7065 635b 2266 756c 6c5f  tput_spec["full_
-0004b9d0: 646f 6e65 5f73 7065 6322 5d0d 0a20 2020  done_spec"]..   
-0004b9e0: 2020 2020 2066 756c 6c5f 7265 7761 7264       full_reward
-0004b9f0: 5f73 7065 6320 3d20 6f75 7470 7574 5f73  _spec = output_s
-0004ba00: 7065 635b 2266 756c 6c5f 7265 7761 7264  pec["full_reward
-0004ba10: 5f73 7065 6322 5d0d 0a20 2020 2020 2020  _spec"]..       
-0004ba20: 2066 756c 6c5f 6f62 7365 7276 6174 696f   full_observatio
-0004ba30: 6e5f 7370 6563 203d 206f 7574 7075 745f  n_spec = output_
-0004ba40: 7370 6563 5b22 6675 6c6c 5f6f 6273 6572  spec["full_obser
-0004ba50: 7661 7469 6f6e 5f73 7065 6322 5d0d 0a20  vation_spec"].. 
-0004ba60: 2020 2020 2020 2023 2077 6520 7265 7665         # we reve
-0004ba70: 7273 6520 7468 696e 6773 2074 6f20 6d61  rse things to ma
-0004ba80: 6b65 2073 7572 6520 7765 2064 656c 6574  ke sure we delet
-0004ba90: 6520 7468 696e 6773 2066 726f 6d20 7468  e things from th
-0004baa0: 6520 6261 636b 0d0a 2020 2020 2020 2020  e back..        
-0004bab0: 666f 7220 6b65 792c 2073 7065 6320 696e  for key, spec in
-0004bac0: 2073 6f72 7465 6428 0d0a 2020 2020 2020   sorted(..      
-0004bad0: 2020 2020 2020 6675 6c6c 5f64 6f6e 655f        full_done_
-0004bae0: 7370 6563 2e69 7465 6d73 2854 7275 6529  spec.items(True)
-0004baf0: 2c20 6b65 793d 7365 6c66 2e5f 736f 7274  , key=self._sort
-0004bb00: 6572 2c20 7265 7665 7273 653d 5472 7565  er, reverse=True
-0004bb10: 0d0a 2020 2020 2020 2020 293a 0d0a 2020  ..        ):..  
-0004bb20: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-0004bb30: 6e73 7461 6e63 6528 7370 6563 2c20 436f  nstance(spec, Co
-0004bb40: 6d70 6f73 6974 6553 7065 6329 2061 6e64  mpositeSpec) and
-0004bb50: 2073 7065 632e 6973 5f65 6d70 7479 2829   spec.is_empty()
-0004bb60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004bb70: 2020 2064 656c 2066 756c 6c5f 646f 6e65     del full_done
-0004bb80: 5f73 7065 635b 6b65 795d 0d0a 0d0a 2020  _spec[key]....  
-0004bb90: 2020 2020 2020 666f 7220 6b65 792c 2073        for key, s
-0004bba0: 7065 6320 696e 2073 6f72 7465 6428 0d0a  pec in sorted(..
-0004bbb0: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
-0004bbc0: 5f6f 6273 6572 7661 7469 6f6e 5f73 7065  _observation_spe
-0004bbd0: 632e 6974 656d 7328 5472 7565 292c 206b  c.items(True), k
-0004bbe0: 6579 3d73 656c 662e 5f73 6f72 7465 722c  ey=self._sorter,
-0004bbf0: 2072 6576 6572 7365 3d54 7275 650d 0a20   reverse=True.. 
-0004bc00: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
-0004bc10: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0004bc20: 616e 6365 2873 7065 632c 2043 6f6d 706f  ance(spec, Compo
-0004bc30: 7369 7465 5370 6563 2920 616e 6420 7370  siteSpec) and sp
-0004bc40: 6563 2e69 735f 656d 7074 7928 293a 0d0a  ec.is_empty():..
-0004bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bc60: 6465 6c20 6675 6c6c 5f6f 6273 6572 7661  del full_observa
-0004bc70: 7469 6f6e 5f73 7065 635b 6b65 795d 0d0a  tion_spec[key]..
-0004bc80: 0d0a 2020 2020 2020 2020 666f 7220 6b65  ..        for ke
-0004bc90: 792c 2073 7065 6320 696e 2073 6f72 7465  y, spec in sorte
-0004bca0: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
-0004bcb0: 6675 6c6c 5f72 6577 6172 645f 7370 6563  full_reward_spec
-0004bcc0: 2e69 7465 6d73 2854 7275 6529 2c20 6b65  .items(True), ke
-0004bcd0: 793d 7365 6c66 2e5f 736f 7274 6572 2c20  y=self._sorter, 
-0004bce0: 7265 7665 7273 653d 5472 7565 0d0a 2020  reverse=True..  
-0004bcf0: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
-0004bd00: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0004bd10: 6e63 6528 7370 6563 2c20 436f 6d70 6f73  nce(spec, Compos
-0004bd20: 6974 6553 7065 6329 2061 6e64 2073 7065  iteSpec) and spe
-0004bd30: 632e 6973 5f65 6d70 7479 2829 3a0d 0a20  c.is_empty():.. 
-0004bd40: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0004bd50: 656c 2066 756c 6c5f 7265 7761 7264 5f73  el full_reward_s
-0004bd60: 7065 635b 6b65 795d 0d0a 2020 2020 2020  pec[key]..      
-0004bd70: 2020 7265 7475 726e 206f 7574 7075 745f    return output_
-0004bd80: 7370 6563 0d0a 0d0a 2020 2020 6465 6620  spec....    def 
-0004bd90: 7472 616e 7366 6f72 6d5f 696e 7075 745f  transform_input_
-0004bda0: 7370 6563 2873 656c 662c 2069 6e70 7574  spec(self, input
-0004bdb0: 5f73 7065 633a 2054 656e 736f 7253 7065  _spec: TensorSpe
-0004bdc0: 6329 202d 3e20 5465 6e73 6f72 5370 6563  c) -> TensorSpec
-0004bdd0: 3a0d 0a20 2020 2020 2020 2066 756c 6c5f  :..        full_
-0004bde0: 6163 7469 6f6e 5f73 7065 6320 3d20 696e  action_spec = in
-0004bdf0: 7075 745f 7370 6563 5b22 6675 6c6c 5f61  put_spec["full_a
-0004be00: 6374 696f 6e5f 7370 6563 225d 0d0a 2020  ction_spec"]..  
-0004be10: 2020 2020 2020 6675 6c6c 5f73 7461 7465        full_state
-0004be20: 5f73 7065 6320 3d20 696e 7075 745f 7370  _spec = input_sp
-0004be30: 6563 5b22 6675 6c6c 5f73 7461 7465 5f73  ec["full_state_s
-0004be40: 7065 6322 5d0d 0a20 2020 2020 2020 2023  pec"]..        #
-0004be50: 2077 6520 7265 7665 7273 6520 7468 696e   we reverse thin
-0004be60: 6773 2074 6f20 6d61 6b65 2073 7572 6520  gs to make sure 
-0004be70: 7765 2064 656c 6574 6520 7468 696e 6773  we delete things
-0004be80: 2066 726f 6d20 7468 6520 6261 636b 0d0a   from the back..
-0004be90: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0004bea0: 6861 735f 656d 7074 795f 696e 7075 7420  has_empty_input 
-0004beb0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-0004bec0: 2066 6f72 206b 6579 2c20 7370 6563 2069   for key, spec i
-0004bed0: 6e20 736f 7274 6564 280d 0a20 2020 2020  n sorted(..     
-0004bee0: 2020 2020 2020 2066 756c 6c5f 6163 7469         full_acti
-0004bef0: 6f6e 5f73 7065 632e 6974 656d 7328 5472  on_spec.items(Tr
-0004bf00: 7565 292c 206b 6579 3d73 656c 662e 5f73  ue), key=self._s
-0004bf10: 6f72 7465 722c 2072 6576 6572 7365 3d54  orter, reverse=T
-0004bf20: 7275 650d 0a20 2020 2020 2020 2029 3a0d  rue..        ):.
-0004bf30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0004bf40: 6973 696e 7374 616e 6365 2873 7065 632c  isinstance(spec,
-0004bf50: 2043 6f6d 706f 7369 7465 5370 6563 2920   CompositeSpec) 
-0004bf60: 616e 6420 7370 6563 2e69 735f 656d 7074  and spec.is_empt
-0004bf70: 7928 293a 0d0a 2020 2020 2020 2020 2020  y():..          
-0004bf80: 2020 2020 2020 7365 6c66 2e5f 6861 735f        self._has_
-0004bf90: 656d 7074 795f 696e 7075 7420 3d20 5472  empty_input = Tr
-0004bfa0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0004bfb0: 2020 2020 6465 6c20 6675 6c6c 5f61 6374      del full_act
-0004bfc0: 696f 6e5f 7370 6563 5b6b 6579 5d0d 0a0d  ion_spec[key]...
-0004bfd0: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
-0004bfe0: 2c20 7370 6563 2069 6e20 736f 7274 6564  , spec in sorted
-0004bff0: 280d 0a20 2020 2020 2020 2020 2020 2066  (..            f
-0004c000: 756c 6c5f 7374 6174 655f 7370 6563 2e69  ull_state_spec.i
-0004c010: 7465 6d73 2854 7275 6529 2c20 6b65 793d  tems(True), key=
-0004c020: 7365 6c66 2e5f 736f 7274 6572 2c20 7265  self._sorter, re
-0004c030: 7665 7273 653d 5472 7565 0d0a 2020 2020  verse=True..    
-0004c040: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
-0004c050: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0004c060: 6528 7370 6563 2c20 436f 6d70 6f73 6974  e(spec, Composit
-0004c070: 6553 7065 6329 2061 6e64 2073 7065 632e  eSpec) and spec.
-0004c080: 6973 5f65 6d70 7479 2829 3a0d 0a20 2020  is_empty():..   
-0004c090: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0004c0a0: 662e 5f68 6173 5f65 6d70 7479 5f69 6e70  f._has_empty_inp
-0004c0b0: 7574 203d 2054 7275 650d 0a20 2020 2020  ut = True..     
-0004c0c0: 2020 2020 2020 2020 2020 2064 656c 2066             del f
-0004c0d0: 756c 6c5f 7374 6174 655f 7370 6563 5b6b  ull_state_spec[k
-0004c0e0: 6579 5d0d 0a20 2020 2020 2020 2072 6574  ey]..        ret
-0004c0f0: 7572 6e20 696e 7075 745f 7370 6563 0d0a  urn input_spec..
-0004c100: 0d0a 2020 2020 6465 6620 5f69 6e76 5f63  ..    def _inv_c
-0004c110: 616c 6c28 7365 6c66 2c20 7465 6e73 6f72  all(self, tensor
-0004c120: 6469 6374 3a20 5465 6e73 6f72 4469 6374  dict: TensorDict
-0004c130: 4261 7365 2920 2d3e 2054 656e 736f 7244  Base) -> TensorD
-0004c140: 6963 7442 6173 653a 0d0a 2020 2020 2020  ictBase:..      
-0004c150: 2020 6966 2073 656c 662e 5f68 6173 5f65    if self._has_e
-0004c160: 6d70 7479 5f69 6e70 7574 3a0d 0a20 2020  mpty_input:..   
-0004c170: 2020 2020 2020 2020 2069 6e70 7574 5f73           input_s
-0004c180: 7065 6320 3d20 6765 7461 7474 7228 7365  pec = getattr(se
-0004c190: 6c66 2e70 6172 656e 742c 2022 696e 7075  lf.parent, "inpu
-0004c1a0: 745f 7370 6563 222c 204e 6f6e 6529 0d0a  t_spec", None)..
-0004c1b0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0004c1c0: 6e70 7574 5f73 7065 6320 6973 204e 6f6e  nput_spec is Non
-0004c1d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0004c1e0: 2020 2020 7265 7475 726e 2074 656e 736f      return tenso
-0004c1f0: 7264 6963 740d 0a0d 0a20 2020 2020 2020  rdict....       
-0004c200: 2020 2020 2066 756c 6c5f 6163 7469 6f6e       full_action
-0004c210: 5f73 7065 6320 3d20 696e 7075 745f 7370  _spec = input_sp
-0004c220: 6563 5b22 6675 6c6c 5f61 6374 696f 6e5f  ec["full_action_
-0004c230: 7370 6563 225d 0d0a 2020 2020 2020 2020  spec"]..        
-0004c240: 2020 2020 6675 6c6c 5f73 7461 7465 5f73      full_state_s
-0004c250: 7065 6320 3d20 696e 7075 745f 7370 6563  pec = input_spec
-0004c260: 5b22 6675 6c6c 5f73 7461 7465 5f73 7065  ["full_state_spe
-0004c270: 6322 5d0d 0a20 2020 2020 2020 2020 2020  c"]..           
-0004c280: 2023 2077 6520 7265 7665 7273 6520 7468   # we reverse th
-0004c290: 696e 6773 2074 6f20 6d61 6b65 2073 7572  ings to make sur
-0004c2a0: 6520 7765 2064 656c 6574 6520 7468 696e  e we delete thin
-0004c2b0: 6773 2066 726f 6d20 7468 6520 6261 636b  gs from the back
-0004c2c0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0004c2d0: 666f 7220 6b65 792c 2073 7065 6320 696e  for key, spec in
-0004c2e0: 2073 6f72 7465 6428 0d0a 2020 2020 2020   sorted(..      
-0004c2f0: 2020 2020 2020 2020 2020 6675 6c6c 5f61            full_a
-0004c300: 6374 696f 6e5f 7370 6563 2e69 7465 6d73  ction_spec.items
-0004c310: 2854 7275 6529 2c20 6b65 793d 7365 6c66  (True), key=self
-0004c320: 2e5f 736f 7274 6572 2c20 7265 7665 7273  ._sorter, revers
-0004c330: 653d 5472 7565 0d0a 2020 2020 2020 2020  e=True..        
-0004c340: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
-0004c350: 2020 2020 2020 2020 6966 2028 0d0a 2020          if (..  
-0004c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c370: 2020 6973 696e 7374 616e 6365 2873 7065    isinstance(spe
-0004c380: 632c 2043 6f6d 706f 7369 7465 5370 6563  c, CompositeSpec
-0004c390: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004c3a0: 2020 2020 2020 2061 6e64 2073 7065 632e         and spec.
-0004c3b0: 6973 5f65 6d70 7479 2829 0d0a 2020 2020  is_empty()..    
-0004c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c3d0: 616e 6420 6b65 7920 6e6f 7420 696e 2074  and key not in t
-0004c3e0: 656e 736f 7264 6963 742e 6b65 7973 2854  ensordict.keys(T
-0004c3f0: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-0004c400: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
-0004c410: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0004c420: 6e73 6f72 6469 6374 2e63 7265 6174 655f  nsordict.create_
-0004c430: 6e65 7374 6564 286b 6579 290d 0a0d 0a20  nested(key).... 
-0004c440: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-0004c450: 6579 2c20 7370 6563 2069 6e20 736f 7274  ey, spec in sort
-0004c460: 6564 280d 0a20 2020 2020 2020 2020 2020  ed(..           
-0004c470: 2020 2020 2066 756c 6c5f 7374 6174 655f       full_state_
-0004c480: 7370 6563 2e69 7465 6d73 2854 7275 6529  spec.items(True)
-0004c490: 2c20 6b65 793d 7365 6c66 2e5f 736f 7274  , key=self._sort
-0004c4a0: 6572 2c20 7265 7665 7273 653d 5472 7565  er, reverse=True
-0004c4b0: 0d0a 2020 2020 2020 2020 2020 2020 293a  ..            ):
-0004c4c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004c4d0: 2020 6966 2028 0d0a 2020 2020 2020 2020    if (..        
-0004c4e0: 2020 2020 2020 2020 2020 2020 6973 696e              isin
-0004c4f0: 7374 616e 6365 2873 7065 632c 2043 6f6d  stance(spec, Com
-0004c500: 706f 7369 7465 5370 6563 290d 0a20 2020  positeSpec)..   
-0004c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c520: 2061 6e64 2073 7065 632e 6973 5f65 6d70   and spec.is_emp
-0004c530: 7479 2829 0d0a 2020 2020 2020 2020 2020  ty()..          
-0004c540: 2020 2020 2020 2020 2020 616e 6420 6b65            and ke
-0004c550: 7920 6e6f 7420 696e 2074 656e 736f 7264  y not in tensord
-0004c560: 6963 742e 6b65 7973 2854 7275 6529 0d0a  ict.keys(True)..
-0004c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c580: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0004c590: 2020 2020 2020 2020 7465 6e73 6f72 6469          tensordi
-0004c5a0: 6374 2e63 7265 6174 655f 6e65 7374 6564  ct.create_nested
-0004c5b0: 286b 6579 290d 0a20 2020 2020 2020 2072  (key)..        r
-0004c5c0: 6574 7572 6e20 7465 6e73 6f72 6469 6374  eturn tensordict
-0004c5d0: 0d0a 0d0a 2020 2020 6465 6620 5f63 616c  ....    def _cal
-0004c5e0: 6c28 7365 6c66 2c20 7465 6e73 6f72 6469  l(self, tensordi
-0004c5f0: 6374 3a20 5465 6e73 6f72 4469 6374 4261  ct: TensorDictBa
-0004c600: 7365 2920 2d3e 2054 656e 736f 7244 6963  se) -> TensorDic
-0004c610: 7442 6173 653a 0d0a 2020 2020 2020 2020  tBase:..        
-0004c620: 666f 7220 6b65 792c 2076 616c 7565 2069  for key, value i
-0004c630: 6e20 736f 7274 6564 280d 0a20 2020 2020  n sorted(..     
-0004c640: 2020 2020 2020 2074 656e 736f 7264 6963         tensordic
-0004c650: 742e 6974 656d 7328 5472 7565 292c 206b  t.items(True), k
-0004c660: 6579 3d73 656c 662e 5f73 6f72 7465 722c  ey=self._sorter,
-0004c670: 2072 6576 6572 7365 3d54 7275 650d 0a20   reverse=True.. 
-0004c680: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
-0004c690: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
-0004c6a0: 2020 2020 2020 2020 2020 2020 2069 735f               is_
-0004c6b0: 7465 6e73 6f72 5f63 6f6c 6c65 6374 696f  tensor_collectio
-0004c6c0: 6e28 7661 6c75 6529 0d0a 2020 2020 2020  n(value)..      
-0004c6d0: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
-0004c6e0: 7420 6973 696e 7374 616e 6365 2876 616c  t isinstance(val
-0004c6f0: 7565 2c20 4e6f 6e54 656e 736f 7244 6174  ue, NonTensorDat
-0004c700: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-0004c710: 2020 2020 616e 6420 7661 6c75 652e 6973      and value.is
-0004c720: 5f65 6d70 7479 2829 0d0a 2020 2020 2020  _empty()..      
-0004c730: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
-0004c740: 2020 2020 2020 2020 2020 6465 6c20 7465            del te
-0004c750: 6e73 6f72 6469 6374 5b6b 6579 5d0d 0a20  nsordict[key].. 
-0004c760: 2020 2020 2020 2072 6574 7572 6e20 7465         return te
-0004c770: 6e73 6f72 6469 6374 0d0a 0d0a 2020 2020  nsordict....    
-0004c780: 6465 6620 5f72 6573 6574 280d 0a20 2020  def _reset(..   
-0004c790: 2020 2020 2073 656c 662c 2074 656e 736f       self, tenso
-0004c7a0: 7264 6963 743a 2054 656e 736f 7244 6963  rdict: TensorDic
-0004c7b0: 7442 6173 652c 2074 656e 736f 7264 6963  tBase, tensordic
-0004c7c0: 745f 7265 7365 743a 2054 656e 736f 7244  t_reset: TensorD
-0004c7d0: 6963 7442 6173 650d 0a20 2020 2029 202d  ictBase..    ) -
-0004c7e0: 3e20 5465 6e73 6f72 4469 6374 4261 7365  > TensorDictBase
-0004c7f0: 3a0d 0a20 2020 2020 2020 2022 2222 5265  :..        """Re
-0004c800: 7365 7473 2061 2074 7261 6e73 666f 726d  sets a transform
-0004c810: 2069 6620 6974 2069 7320 7374 6174 6566   if it is statef
-0004c820: 756c 2e22 2222 0d0a 2020 2020 2020 2020  ul."""..        
-0004c830: 7265 7475 726e 2073 656c 662e 5f63 616c  return self._cal
-0004c840: 6c28 7465 6e73 6f72 6469 6374 5f72 6573  l(tensordict_res
-0004c850: 6574 290d 0a0d 0a20 2020 2066 6f72 7761  et)....    forwa
-0004c860: 7264 203d 205f 6361 6c6c 0d0a 0d0a 0d0a  rd = _call......
-0004c870: 636c 6173 7320 5f49 6e76 6572 7454 7261  class _InvertTra
-0004c880: 6e73 666f 726d 2854 7261 6e73 666f 726d  nsform(Transform
-0004c890: 293a 0d0a 2020 2020 5f4d 4953 5349 4e47  ):..    _MISSING
-0004c8a0: 5f54 5241 4e53 464f 524d 5f45 5252 4f52  _TRANSFORM_ERROR
-0004c8b0: 203d 2028 0d0a 2020 2020 2020 2020 2254   = (..        "T
-0004c8c0: 6865 7265 2069 7320 6e6f 7420 6765 6e65  here is not gene
-0004c8d0: 7269 6320 7275 6c65 2074 6f20 696e 7665  ric rule to inve
-0004c8e0: 7274 2061 2073 7065 6320 7472 616e 7366  rt a spec transf
-0004c8f0: 6f72 6d2e 2022 0d0a 2020 2020 2020 2020  orm. "..        
-0004c900: 2250 6c65 6173 6520 6669 6c65 2061 6e20  "Please file an 
-0004c910: 6973 7375 6520 6f6e 2067 6974 6875 6220  issue on github 
-0004c920: 746f 2067 6574 2068 656c 702e 220d 0a20  to get help.".. 
-0004c930: 2020 2029 0d0a 0d0a 2020 2020 6465 6620     )....    def 
-0004c940: 5f5f 696e 6974 5f5f 2873 656c 662c 2074  __init__(self, t
-0004c950: 7261 6e73 666f 726d 3a20 5472 616e 7366  ransform: Transf
-0004c960: 6f72 6d29 3a0d 0a20 2020 2020 2020 2073  orm):..        s
-0004c970: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
-0004c980: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0004c990: 7472 616e 7366 6f72 6d20 3d20 7472 616e  transform = tran
-0004c9a0: 7366 6f72 6d0d 0a0d 0a20 2020 2040 7072  sform....    @pr
-0004c9b0: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-0004c9c0: 696e 5f6b 6579 7328 7365 6c66 293a 0d0a  in_keys(self):..
-0004c9d0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0004c9e0: 656c 662e 7472 616e 7366 6f72 6d2e 696e  elf.transform.in
-0004c9f0: 5f6b 6579 735f 696e 760d 0a0d 0a20 2020  _keys_inv....   
-0004ca00: 2040 696e 5f6b 6579 732e 7365 7474 6572   @in_keys.setter
-0004ca10: 0d0a 2020 2020 6465 6620 696e 5f6b 6579  ..    def in_key
-0004ca20: 7328 7365 6c66 2c20 7661 6c75 6529 3a0d  s(self, value):.
-0004ca30: 0a20 2020 2020 2020 2069 6620 7661 6c75  .        if valu
-0004ca40: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-0004ca50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0004ca60: 6520 5275 6e74 696d 6545 7272 6f72 2822  e RuntimeError("
-0004ca70: 4361 6e6e 6f74 2073 6574 206e 6f6e 2d6e  Cannot set non-n
-0004ca80: 756c 6c20 7661 6c75 6520 696e 2069 6e5f  ull value in in_
-0004ca90: 6b65 7973 2e22 290d 0a0d 0a20 2020 2040  keys.")....    @
-0004caa0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-0004cab0: 6620 696e 5f6b 6579 735f 696e 7628 7365  f in_keys_inv(se
-0004cac0: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
-0004cad0: 7475 726e 2073 656c 662e 7472 616e 7366  turn self.transf
-0004cae0: 6f72 6d2e 696e 5f6b 6579 730d 0a0d 0a20  orm.in_keys.... 
-0004caf0: 2020 2040 696e 5f6b 6579 735f 696e 762e     @in_keys_inv.
-0004cb00: 7365 7474 6572 0d0a 2020 2020 6465 6620  setter..    def 
-0004cb10: 696e 5f6b 6579 735f 696e 7628 7365 6c66  in_keys_inv(self
-0004cb20: 2c20 7661 6c75 6529 3a0d 0a20 2020 2020  , value):..     
-0004cb30: 2020 2069 6620 7661 6c75 6520 6973 206e     if value is n
-0004cb40: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-0004cb50: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
-0004cb60: 696d 6545 7272 6f72 2822 4361 6e6e 6f74  imeError("Cannot
-0004cb70: 2073 6574 206e 6f6e 2d6e 756c 6c20 7661   set non-null va
-0004cb80: 6c75 6520 696e 2069 6e5f 6b65 7973 5f69  lue in in_keys_i
-0004cb90: 6e76 2e22 290d 0a0d 0a20 2020 2040 7072  nv.")....    @pr
-0004cba0: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-0004cbb0: 6f75 745f 6b65 7973 2873 656c 6629 3a0d  out_keys(self):.
-0004cbc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0004cbd0: 7365 6c66 2e74 7261 6e73 666f 726d 2e6f  self.transform.o
-0004cbe0: 7574 5f6b 6579 735f 696e 760d 0a0d 0a20  ut_keys_inv.... 
-0004cbf0: 2020 2040 6f75 745f 6b65 7973 2e73 6574     @out_keys.set
-0004cc00: 7465 720d 0a20 2020 2064 6566 206f 7574  ter..    def out
-0004cc10: 5f6b 6579 7328 7365 6c66 2c20 7661 6c75  _keys(self, valu
-0004cc20: 6529 3a0d 0a20 2020 2020 2020 2069 6620  e):..        if 
-0004cc30: 7661 6c75 6520 6973 206e 6f74 204e 6f6e  value is not Non
-0004cc40: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0004cc50: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-0004cc60: 6f72 2822 4361 6e6e 6f74 2073 6574 206e  or("Cannot set n
-0004cc70: 6f6e 2d6e 756c 6c20 7661 6c75 6520 696e  on-null value in
-0004cc80: 206f 7574 5f6b 6579 732e 2229 0d0a 0d0a   out_keys.")....
-0004cc90: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
-0004cca0: 2020 2064 6566 206f 7574 5f6b 6579 735f     def out_keys_
-0004ccb0: 696e 7628 7365 6c66 293a 0d0a 2020 2020  inv(self):..    
-0004ccc0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0004ccd0: 7472 616e 7366 6f72 6d2e 6f75 745f 6b65  transform.out_ke
-0004cce0: 7973 0d0a 0d0a 2020 2020 406f 7574 5f6b  ys....    @out_k
-0004ccf0: 6579 735f 696e 762e 7365 7474 6572 0d0a  eys_inv.setter..
-0004cd00: 2020 2020 6465 6620 6f75 745f 6b65 7973      def out_keys
-0004cd10: 5f69 6e76 2873 656c 662c 2076 616c 7565  _inv(self, value
-0004cd20: 293a 0d0a 2020 2020 2020 2020 6966 2076  ):..        if v
-0004cd30: 616c 7565 2069 7320 6e6f 7420 4e6f 6e65  alue is not None
-0004cd40: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0004cd50: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
-0004cd60: 7228 2243 616e 6e6f 7420 7365 7420 6e6f  r("Cannot set no
-0004cd70: 6e2d 6e75 6c6c 2076 616c 7565 2069 6e20  n-null value in 
-0004cd80: 6f75 745f 6b65 7973 5f69 6e76 2e22 290d  out_keys_inv.").
-0004cd90: 0a0d 0a20 2020 2064 6566 2066 6f72 7761  ...    def forwa
-0004cda0: 7264 2873 656c 662c 2074 656e 736f 7264  rd(self, tensord
-0004cdb0: 6963 743a 2054 656e 736f 7244 6963 7442  ict: TensorDictB
-0004cdc0: 6173 6529 202d 3e20 5465 6e73 6f72 4469  ase) -> TensorDi
-0004cdd0: 6374 4261 7365 3a0d 0a20 2020 2020 2020  ctBase:..       
-0004cde0: 2072 6574 7572 6e20 7365 6c66 2e74 7261   return self.tra
-0004cdf0: 6e73 666f 726d 2e69 6e76 2874 656e 736f  nsform.inv(tenso
-0004ce00: 7264 6963 7429 0d0a 0d0a 2020 2020 6465  rdict)....    de
-0004ce10: 6620 696e 7628 7365 6c66 2c20 7465 6e73  f inv(self, tens
-0004ce20: 6f72 6469 6374 3a20 5465 6e73 6f72 4469  ordict: TensorDi
-0004ce30: 6374 4261 7365 2920 2d3e 2054 656e 736f  ctBase) -> Tenso
-0004ce40: 7244 6963 7442 6173 653a 0d0a 2020 2020  rDictBase:..    
-0004ce50: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0004ce60: 7472 616e 7366 6f72 6d2e 666f 7277 6172  transform.forwar
-0004ce70: 6428 7465 6e73 6f72 6469 6374 290d 0a0d  d(tensordict)...
-0004ce80: 0a20 2020 2064 6566 205f 6361 6c6c 2873  .    def _call(s
-0004ce90: 656c 662c 2074 656e 736f 7264 6963 743a  elf, tensordict:
-0004cea0: 2054 656e 736f 7244 6963 7442 6173 6529   TensorDictBase)
-0004ceb0: 202d 3e20 5465 6e73 6f72 4469 6374 4261   -> TensorDictBa
-0004cec0: 7365 3a0d 0a20 2020 2020 2020 2072 6574  se:..        ret
-0004ced0: 7572 6e20 7365 6c66 2e74 7261 6e73 666f  urn self.transfo
-0004cee0: 726d 2e5f 696e 765f 6361 6c6c 2874 656e  rm._inv_call(ten
-0004cef0: 736f 7264 6963 7429 0d0a 0d0a 2020 2020  sordict)....    
-0004cf00: 6465 6620 5f69 6e76 5f63 616c 6c28 7365  def _inv_call(se
-0004cf10: 6c66 2c20 7465 6e73 6f72 6469 6374 3a20  lf, tensordict: 
-0004cf20: 5465 6e73 6f72 4469 6374 4261 7365 2920  TensorDictBase) 
-0004cf30: 2d3e 2054 656e 736f 7244 6963 7442 6173  -> TensorDictBas
-0004cf40: 653a 0d0a 2020 2020 2020 2020 7265 7475  e:..        retu
-0004cf50: 726e 2073 656c 662e 7472 616e 7366 6f72  rn self.transfor
-0004cf60: 6d2e 5f63 616c 6c28 7465 6e73 6f72 6469  m._call(tensordi
-0004cf70: 6374 290d 0a0d 0a20 2020 2064 6566 2074  ct)....    def t
-0004cf80: 7261 6e73 666f 726d 5f6f 6273 6572 7661  ransform_observa
-0004cf90: 7469 6f6e 5f73 7065 6328 7365 6c66 2c20  tion_spec(self, 
-0004cfa0: 6f62 7365 7276 6174 696f 6e5f 7370 6563  observation_spec
-0004cfb0: 3a20 5465 6e73 6f72 5370 6563 2920 2d3e  : TensorSpec) ->
-0004cfc0: 2054 656e 736f 7253 7065 633a 0d0a 2020   TensorSpec:..  
-0004cfd0: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
-0004cfe0: 696d 6545 7272 6f72 2873 656c 662e 5f4d  imeError(self._M
-0004cff0: 4953 5349 4e47 5f54 5241 4e53 464f 524d  ISSING_TRANSFORM
-0004d000: 5f45 5252 4f52 290d 0a0d 0a20 2020 2064  _ERROR)....    d
-0004d010: 6566 2074 7261 6e73 666f 726d 5f73 7461  ef transform_sta
-0004d020: 7465 5f73 7065 6328 7365 6c66 2c20 7374  te_spec(self, st
-0004d030: 6174 655f 7370 6563 3a20 5465 6e73 6f72  ate_spec: Tensor
-0004d040: 5370 6563 2920 2d3e 2054 656e 736f 7253  Spec) -> TensorS
-0004d050: 7065 633a 0d0a 2020 2020 2020 2020 7261  pec:..        ra
-0004d060: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-0004d070: 2873 656c 662e 5f4d 4953 5349 4e47 5f54  (self._MISSING_T
-0004d080: 5241 4e53 464f 524d 5f45 5252 4f52 290d  RANSFORM_ERROR).
-0004d090: 0a0d 0a20 2020 2064 6566 2074 7261 6e73  ...    def trans
-0004d0a0: 666f 726d 5f72 6577 6172 645f 7370 6563  form_reward_spec
-0004d0b0: 2873 656c 662c 2072 6577 6172 645f 7370  (self, reward_sp
-0004d0c0: 6563 3a20 5465 6e73 6f72 5370 6563 2920  ec: TensorSpec) 
-0004d0d0: 2d3e 2054 656e 736f 7253 7065 633a 0d0a  -> TensorSpec:..
-0004d0e0: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
-0004d0f0: 6e74 696d 6545 7272 6f72 2873 656c 662e  ntimeError(self.
-0004d100: 5f4d 4953 5349 4e47 5f54 5241 4e53 464f  _MISSING_TRANSFO
-0004d110: 524d 5f45 5252 4f52 290d 0a0d 0a20 2020  RM_ERROR)....   
-0004d120: 2064 6566 2074 7261 6e73 666f 726d 5f61   def transform_a
-0004d130: 6374 696f 6e5f 7370 6563 2873 656c 662c  ction_spec(self,
-0004d140: 2061 6374 696f 6e5f 7370 6563 3a20 5465   action_spec: Te
-0004d150: 6e73 6f72 5370 6563 2920 2d3e 2054 656e  nsorSpec) -> Ten
-0004d160: 736f 7253 7065 633a 0d0a 2020 2020 2020  sorSpec:..      
-0004d170: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
-0004d180: 7272 6f72 2873 656c 662e 5f4d 4953 5349  rror(self._MISSI
-0004d190: 4e47 5f54 5241 4e53 464f 524d 5f45 5252  NG_TRANSFORM_ERR
-0004d1a0: 4f52 290d 0a0d 0a20 2020 2064 6566 2074  OR)....    def t
-0004d1b0: 7261 6e73 666f 726d 5f64 6f6e 655f 7370  ransform_done_sp
-0004d1c0: 6563 2873 656c 662c 2064 6f6e 655f 7370  ec(self, done_sp
-0004d1d0: 6563 3a20 5465 6e73 6f72 5370 6563 2920  ec: TensorSpec) 
-0004d1e0: 2d3e 2054 656e 736f 7253 7065 633a 0d0a  -> TensorSpec:..
-0004d1f0: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
-0004d200: 6e74 696d 6545 7272 6f72 2873 656c 662e  ntimeError(self.
-0004d210: 5f4d 4953 5349 4e47 5f54 5241 4e53 464f  _MISSING_TRANSFO
-0004d220: 524d 5f45 5252 4f52 290d 0a0d 0a0d 0a63  RM_ERROR)......c
-0004d230: 6c61 7373 205f 4361 6c6c 6162 6c65 5472  lass _CallableTr
-0004d240: 616e 7366 6f72 6d28 5472 616e 7366 6f72  ansform(Transfor
-0004d250: 6d29 3a0d 0a20 2020 2023 2041 2077 7261  m):..    # A wra
-0004d260: 7070 6572 2061 726f 756e 6420 6120 6375  pper around a cu
-0004d270: 7374 6f6d 2063 616c 6c61 626c 6520 746f  stom callable to
-0004d280: 206d 616b 6520 6974 2070 6f73 7369 626c   make it possibl
-0004d290: 6520 746f 2074 7261 6e73 666f 726d 2061  e to transform a
-0004d2a0: 6e79 2064 6174 6120 7479 7065 0d0a 2020  ny data type..  
-0004d2b0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0004d2c0: 656c 662c 2066 756e 6329 3a0d 0a20 2020  elf, func):..   
-0004d2d0: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
-0004d2e0: 6e69 745f 5f28 290d 0a20 2020 2020 2020  nit__()..       
-0004d2f0: 2073 656c 662e 6675 6e63 203d 2066 756e   self.func = fun
-0004d300: 630d 0a0d 0a20 2020 2064 6566 2066 6f72  c....    def for
-0004d310: 7761 7264 2873 656c 662c 202a 6172 6773  ward(self, *args
-0004d320: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0004d330: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0004d340: 662e 6675 6e63 282a 6172 6773 2c20 2a2a  f.func(*args, **
-0004d350: 6b77 6172 6773 290d 0a0d 0a20 2020 2064  kwargs)....    d
-0004d360: 6566 205f 6361 6c6c 2873 656c 662c 2074  ef _call(self, t
-0004d370: 656e 736f 7264 6963 743a 2054 656e 736f  ensordict: Tenso
-0004d380: 7244 6963 7442 6173 6529 3a0d 0a20 2020  rDictBase):..   
-0004d390: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0004d3a0: 2e66 756e 6328 7465 6e73 6f72 6469 6374  .func(tensordict
-0004d3b0: 290d 0a0d 0a20 2020 2064 6566 205f 696e  )....    def _in
-0004d3c0: 765f 6361 6c6c 2873 656c 662c 2074 656e  v_call(self, ten
-0004d3d0: 736f 7264 6963 743a 2054 656e 736f 7244  sordict: TensorD
-0004d3e0: 6963 7442 6173 6529 202d 3e20 5465 6e73  ictBase) -> Tens
-0004d3f0: 6f72 4469 6374 4261 7365 3a0d 0a20 2020  orDictBase:..   
-0004d400: 2020 2020 2072 6574 7572 6e20 7465 6e73       return tens
-0004d410: 6f72 6469 6374 0d0a 0d0a 2020 2020 6465  ordict....    de
-0004d420: 6620 5f72 6573 6574 280d 0a20 2020 2020  f _reset(..     
-0004d430: 2020 2073 656c 662c 2074 656e 736f 7264     self, tensord
-0004d440: 6963 743a 2054 656e 736f 7244 6963 7442  ict: TensorDictB
-0004d450: 6173 652c 2074 656e 736f 7264 6963 745f  ase, tensordict_
-0004d460: 7265 7365 743a 2054 656e 736f 7244 6963  reset: TensorDic
-0004d470: 7442 6173 650d 0a20 2020 2029 202d 3e20  tBase..    ) -> 
-0004d480: 5465 6e73 6f72 4469 6374 4261 7365 3a0d  TensorDictBase:.
-0004d490: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0004d4a0: 7365 6c66 2e5f 6361 6c6c 2874 656e 736f  self._call(tenso
-0004d4b0: 7264 6963 745f 7265 7365 7429 0d0a 0d0a  rdict_reset)....
-0004d4c0: 0d0a 636c 6173 7320 4261 7463 6853 697a  ..class BatchSiz
-0004d4d0: 6554 7261 6e73 666f 726d 2854 7261 6e73  eTransform(Trans
-0004d4e0: 666f 726d 293a 0d0a 2020 2020 2222 2241  form):..    """A
-0004d4f0: 2074 7261 6e73 666f 726d 2074 6f20 6d6f   transform to mo
-0004d500: 6469 6679 2074 6865 2062 6174 6368 2d73  dify the batch-s
-0004d510: 697a 6520 6f66 2061 6e20 656e 7669 726f  ize of an enviro
-0004d520: 6e6d 742e 0d0a 0d0a 2020 2020 5468 6973  nmt.....    This
-0004d530: 2074 7261 6e73 666f 726d 2068 6173 2074   transform has t
-0004d540: 776f 2064 6973 7469 6e63 7420 7573 6167  wo distinct usag
-0004d550: 6573 3a20 6974 2063 616e 2062 6520 7573  es: it can be us
-0004d560: 6564 2074 6f20 7365 7420 7468 650d 0a20  ed to set the.. 
-0004d570: 2020 2062 6174 6368 2d73 697a 6520 666f     batch-size fo
-0004d580: 7220 6e6f 6e2d 6261 7463 682d 6c6f 636b  r non-batch-lock
-0004d590: 6564 2028 652e 672e 2073 7461 7465 6c65  ed (e.g. statele
-0004d5a0: 7373 2920 656e 7669 726f 6e6d 656e 7473  ss) environments
-0004d5b0: 2074 6f0d 0a20 2020 2065 6e61 626c 6520   to..    enable 
-0004d5c0: 6461 7461 2063 6f6c 6c65 6374 696f 6e20  data collection 
-0004d5d0: 7573 696e 6720 6461 7461 2063 6f6c 6c65  using data colle
-0004d5e0: 6374 6f72 732e 2049 7420 6361 6e20 616c  ctors. It can al
-0004d5f0: 736f 2062 6520 7573 6564 0d0a 2020 2020  so be used..    
-0004d600: 746f 206d 6f64 6966 7920 7468 6520 6261  to modify the ba
-0004d610: 7463 682d 7369 7a65 206f 6620 616e 2065  tch-size of an e
-0004d620: 6e76 6972 6f6e 6d65 6e74 2028 652e 672e  nvironment (e.g.
-0004d630: 2073 7175 6565 7a65 2c20 756e 7371 7565   squeeze, unsque
-0004d640: 657a 6520 6f72 0d0a 2020 2020 7265 7368  eze or..    resh
-0004d650: 6170 6529 2e0d 0a0d 0a20 2020 2054 6869  ape).....    Thi
-0004d660: 7320 7472 616e 7366 6f72 6d20 6d6f 6469  s transform modi
-0004d670: 6669 6573 2074 6865 2065 6e76 6972 6f6e  fies the environ
-0004d680: 6d65 6e74 2062 6174 6368 2d73 697a 6520  ment batch-size 
-0004d690: 746f 206d 6174 6368 2074 6865 206f 6e65  to match the one
-0004d6a0: 2070 726f 7669 6465 642e 0d0a 2020 2020   provided...    
-0004d6b0: 4974 2065 7870 6563 7473 2074 6865 2070  It expects the p
-0004d6c0: 6172 656e 7420 656e 7669 726f 6e6d 656e  arent environmen
-0004d6d0: 7420 6261 7463 682d 7369 7a65 2074 6f20  t batch-size to 
-0004d6e0: 6265 2065 7870 616e 6461 626c 6520 746f  be expandable to
-0004d6f0: 2074 6865 0d0a 2020 2020 7072 6f76 6964   the..    provid
-0004d700: 6564 206f 6e65 2e0d 0a0d 0a20 2020 204b  ed one.....    K
-0004d710: 6579 776f 7264 2041 7267 733a 0d0a 2020  eyword Args:..  
-0004d720: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
-0004d730: 2028 746f 7263 682e 5369 7a65 206f 7220   (torch.Size or 
-0004d740: 6571 7569 7661 6c65 6e74 2c20 6f70 7469  equivalent, opti
-0004d750: 6f6e 616c 293a 2074 6865 206e 6577 2062  onal): the new b
-0004d760: 6174 6368 2d73 697a 6520 6f66 2074 6865  atch-size of the
-0004d770: 2065 6e76 6972 6f6e 6d65 6e74 2e0d 0a20   environment... 
-0004d780: 2020 2020 2020 2020 2020 2045 7863 6c75             Exclu
-0004d790: 7369 7665 2077 6974 6820 6060 7265 7368  sive with ``resh
-0004d7a0: 6170 655f 666e 6060 2e0d 0a20 2020 2020  ape_fn``...     
-0004d7b0: 2020 2072 6573 6861 7065 5f66 6e20 2863     reshape_fn (c
-0004d7c0: 616c 6c61 626c 652c 206f 7074 696f 6e61  allable, optiona
-0004d7d0: 6c29 3a20 6120 6361 6c6c 6162 6c65 2074  l): a callable t
-0004d7e0: 6f20 6d6f 6469 6679 2074 6865 2065 6e76  o modify the env
-0004d7f0: 6972 6f6e 6d65 6e74 2062 6174 6368 2d73  ironment batch-s
-0004d800: 697a 652e 0d0a 2020 2020 2020 2020 2020  ize...          
-0004d810: 2020 4578 636c 7573 6976 6520 7769 7468    Exclusive with
-0004d820: 2060 6062 6174 6368 5f73 697a 6560 602e   ``batch_size``.
-0004d830: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0004d840: 2e2e 206e 6f74 653a 3a20 4375 7272 656e  .. note:: Curren
-0004d850: 746c 792c 2074 7261 6e73 666f 726d 6174  tly, transformat
-0004d860: 696f 6e73 2069 6e76 6f6c 7669 6e67 0d0a  ions involving..
-0004d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d880: 6060 7265 7368 6170 6560 602c 2060 6066  ``reshape``, ``f
-0004d890: 6c61 7474 656e 6060 2c20 6060 756e 666c  latten``, ``unfl
-0004d8a0: 6174 7465 6e60 602c 2060 6073 7175 6565  atten``, ``squee
-0004d8b0: 7a65 6060 2061 6e64 2060 6075 6e73 7175  ze`` and ``unsqu
-0004d8c0: 6565 7a65 6060 0d0a 2020 2020 2020 2020  eeze``..        
-0004d8d0: 2020 2020 2020 2020 6172 6520 7375 7070          are supp
-0004d8e0: 6f72 7465 642e 2049 6620 616e 6f74 6865  orted. If anothe
-0004d8f0: 7220 7265 7368 6170 6520 6f70 6572 6174  r reshape operat
-0004d900: 696f 6e20 6973 2072 6571 7569 7265 642c  ion is required,
-0004d910: 2070 6c65 6173 6520 7375 626d 6974 0d0a   please submit..
-0004d920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d930: 6120 6665 6174 7572 6520 7265 7175 6573  a feature reques
-0004d940: 7420 6f6e 2054 6f72 6368 524c 2067 6974  t on TorchRL git
-0004d950: 6875 622e 0d0a 0d0a 2020 2020 2020 2020  hub.....        
-0004d960: 7265 7365 745f 6675 6e63 2028 6361 6c6c  reset_func (call
-0004d970: 6162 6c65 2c20 6f70 7469 6f6e 616c 293a  able, optional):
-0004d980: 2061 2066 756e 6374 696f 6e20 7468 6174   a function that
-0004d990: 2070 726f 6475 6365 7320 6120 7265 7365   produces a rese
-0004d9a0: 7420 7465 6e73 6f72 6469 6374 2e0d 0a20  t tensordict... 
-0004d9b0: 2020 2020 2020 2020 2020 2054 6865 2073             The s
-0004d9c0: 6967 6e61 7475 7265 206d 7573 7420 6d61  ignature must ma
-0004d9d0: 7463 6820 6060 4361 6c6c 6162 6c65 5b5b  tch ``Callable[[
-0004d9e0: 5465 6e73 6f72 4469 6374 4261 7365 2c20  TensorDictBase, 
-0004d9f0: 5465 6e73 6f72 4469 6374 4261 7365 5d2c  TensorDictBase],
-0004da00: 2054 656e 736f 7244 6963 7442 6173 655d   TensorDictBase]
-0004da10: 6060 0d0a 2020 2020 2020 2020 2020 2020  ``..            
-0004da20: 7768 6572 6520 7468 6520 6669 7273 7420  where the first 
-0004da30: 696e 7075 7420 6172 6775 6d65 6e74 2069  input argument i
-0004da40: 7320 7468 6520 6f70 7469 6f6e 616c 2074  s the optional t
-0004da50: 656e 736f 7264 6963 7420 7061 7373 6564  ensordict passed
-0004da60: 2074 6f20 7468 650d 0a20 2020 2020 2020   to the..       
-0004da70: 2020 2020 2065 6e76 6972 6f6e 6d65 6e74       environment
-0004da80: 2064 7572 696e 6720 7468 6520 6361 6c6c   during the call
-0004da90: 2074 6f20 3a6d 6574 683a 607e 456e 7642   to :meth:`~EnvB
-0004daa0: 6173 652e 7265 7365 7460 2061 6e64 2074  ase.reset` and t
-0004dab0: 6865 2073 6563 6f6e 640d 0a20 2020 2020  he second..     
-0004dac0: 2020 2020 2020 2069 7320 7468 6520 6f75         is the ou
-0004dad0: 7470 7574 206f 6620 6060 5472 616e 7366  tput of ``Transf
-0004dae0: 6f72 6d65 6445 6e76 2e62 6173 655f 656e  ormedEnv.base_en
-0004daf0: 762e 7265 7365 7460 602e 2049 7420 6361  v.reset``. It ca
-0004db00: 6e20 616c 736f 2073 7570 706f 7274 2061  n also support a
-0004db10: 6e0d 0a20 2020 2020 2020 2020 2020 206f  n..            o
-0004db20: 7074 696f 6e61 6c20 6060 656e 7660 6020  ptional ``env`` 
-0004db30: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-0004db40: 2069 6620 6060 656e 765f 6b77 6172 673d   if ``env_kwarg=
-0004db50: 5472 7565 6060 2e0d 0a20 2020 2020 2020  True``...       
-0004db60: 2065 6e76 5f6b 7761 7267 2028 626f 6f6c   env_kwarg (bool
-0004db70: 2c20 6f70 7469 6f6e 616c 293a 2069 6620  , optional): if 
-0004db80: 6060 5472 7565 6060 2c20 6060 7265 7365  ``True``, ``rese
-0004db90: 745f 6675 6e63 6060 206d 7573 7420 7375  t_func`` must su
-0004dba0: 7070 6f72 7420 610d 0a20 2020 2020 2020  pport a..       
-0004dbb0: 2020 2020 2060 6065 6e76 6060 206b 6579       ``env`` key
-0004dbc0: 776f 7264 2061 7267 756d 656e 742e 2044  word argument. D
-0004dbd0: 6566 6175 6c74 7320 746f 2060 6046 616c  efaults to ``Fal
-0004dbe0: 7365 6060 2e20 5468 6520 656e 7620 7061  se``. The env pa
-0004dbf0: 7373 6564 2077 696c 6c0d 0a20 2020 2020  ssed will..     
-0004dc00: 2020 2020 2020 2062 6520 7468 6520 656e         be the en
-0004dc10: 7620 6163 636f 6d70 616e 6965 6420 6279  v accompanied by
-0004dc20: 2069 7473 2074 7261 6e73 666f 726d 2e0d   its transform..
-0004dc30: 0a0d 0a20 2020 2045 7861 6d70 6c65 3a0d  ...    Example:.
-0004dc40: 0a20 2020 2020 2020 203e 3e3e 2023 2043  .        >>> # C
-0004dc50: 6861 6e67 696e 6720 7468 6520 6261 7463  hanging the batc
-0004dc60: 682d 7369 7a65 2077 6974 6820 6120 6675  h-size with a fu
-0004dc70: 6e63 7469 6f6e 0d0a 2020 2020 2020 2020  nction..        
-0004dc80: 3e3e 3e20 6672 6f6d 2074 6f72 6368 726c  >>> from torchrl
-0004dc90: 2e65 6e76 7320 696d 706f 7274 2047 796d  .envs import Gym
-0004dca0: 456e 760d 0a20 2020 2020 2020 203e 3e3e  Env..        >>>
-0004dcb0: 2062 6173 655f 656e 7620 3d20 4779 6d45   base_env = GymE
-0004dcc0: 6e76 2822 4361 7274 506f 6c65 2d76 3122  nv("CartPole-v1"
-0004dcd0: 290d 0a20 2020 2020 2020 203e 3e3e 2065  )..        >>> e
-0004dce0: 6e76 203d 2054 7261 6e73 666f 726d 6564  nv = Transformed
-0004dcf0: 456e 7628 6261 7365 5f65 6e76 2c20 4261  Env(base_env, Ba
-0004dd00: 7463 6853 697a 6554 7261 6e73 666f 726d  tchSizeTransform
-0004dd10: 2872 6573 6861 7065 5f66 6e3d 6c61 6d62  (reshape_fn=lamb
-0004dd20: 6461 2064 6174 613a 2064 6174 612e 7265  da data: data.re
-0004dd30: 7368 6170 6528 312c 2031 2929 290d 0a20  shape(1, 1))).. 
-0004dd40: 2020 2020 2020 203e 3e3e 2065 6e76 2e72         >>> env.r
-0004dd50: 6f6c 6c6f 7574 2834 290d 0a20 2020 2020  ollout(4)..     
-0004dd60: 2020 203e 3e3e 2023 2053 6574 7469 6e67     >>> # Setting
-0004dd70: 2074 6865 2073 6861 7065 206f 6620 6120   the shape of a 
-0004dd80: 7374 6174 656c 6573 7320 656e 7669 726f  stateless enviro
-0004dd90: 6e6d 656e 740d 0a20 2020 2020 2020 203e  nment..        >
-0004dda0: 3e3e 2063 6c61 7373 204d 7945 6e76 2845  >> class MyEnv(E
-0004ddb0: 6e76 4261 7365 293a 0d0a 2020 2020 2020  nvBase):..      
-0004ddc0: 2020 2e2e 2e20 2020 2020 6261 7463 685f    ...     batch_
-0004ddd0: 6c6f 636b 6564 203d 2046 616c 7365 0d0a  locked = False..
-0004dde0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0004ddf0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0004de00: 6629 3a0d 0a20 2020 2020 2020 202e 2e2e  f):..        ...
-0004de10: 2020 2020 2020 2020 2073 7570 6572 2829           super()
-0004de20: 2e5f 5f69 6e69 745f 5f28 290d 0a20 2020  .__init__()..   
-0004de30: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
-0004de40: 2073 656c 662e 6f62 7365 7276 6174 696f   self.observatio
-0004de50: 6e5f 7370 6563 203d 2043 6f6d 706f 7369  n_spec = Composi
-0004de60: 7465 5370 6563 286f 6273 6572 7661 7469  teSpec(observati
-0004de70: 6f6e 3d55 6e62 6f75 6e64 6564 436f 6e74  on=UnboundedCont
-0004de80: 696e 756f 7573 5465 6e73 6f72 5370 6563  inuousTensorSpec
-0004de90: 2833 2929 0d0a 2020 2020 2020 2020 2e2e  (3))..        ..
-0004dea0: 2e20 2020 2020 2020 2020 7365 6c66 2e72  .         self.r
-0004deb0: 6577 6172 645f 7370 6563 203d 2055 6e62  eward_spec = Unb
-0004dec0: 6f75 6e64 6564 436f 6e74 696e 756f 7573  oundedContinuous
-0004ded0: 5465 6e73 6f72 5370 6563 2831 290d 0a20  TensorSpec(1).. 
-0004dee0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-0004def0: 2020 2073 656c 662e 6163 7469 6f6e 5f73     self.action_s
-0004df00: 7065 6320 3d20 556e 626f 756e 6465 6443  pec = UnboundedC
-0004df10: 6f6e 7469 6e75 6f75 7354 656e 736f 7253  ontinuousTensorS
-0004df20: 7065 6328 3129 0d0a 2020 2020 2020 2020  pec(1)..        
-0004df30: 2e2e 2e0d 0a20 2020 2020 2020 202e 2e2e  .....        ...
-0004df40: 2020 2020 2064 6566 205f 7265 7365 7428       def _reset(
-0004df50: 7365 6c66 2c20 7465 6e73 6f72 6469 6374  self, tensordict
-0004df60: 3a20 5465 6e73 6f72 4469 6374 4261 7365  : TensorDictBase
-0004df70: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2054  , **kwargs) -> T
-0004df80: 656e 736f 7244 6963 7442 6173 653a 0d0a  ensorDictBase:..
-0004df90: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0004dfa0: 2020 2020 7465 6e73 6f72 6469 6374 5f62      tensordict_b
-0004dfb0: 6174 6368 5f73 697a 6520 3d20 7465 6e73  atch_size = tens
-0004dfc0: 6f72 6469 6374 2e62 6174 6368 5f73 697a  ordict.batch_siz
-0004dfd0: 6520 6966 2074 656e 736f 7264 6963 7420  e if tensordict 
-0004dfe0: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-0004dff0: 2074 6f72 6368 2e53 697a 6528 5b5d 290d   torch.Size([]).
-0004e000: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0004e010: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-0004e020: 6c66 2e6f 6273 6572 7661 7469 6f6e 5f73  lf.observation_s
-0004e030: 7065 632e 7261 6e64 2874 656e 736f 7264  pec.rand(tensord
-0004e040: 6963 745f 6261 7463 685f 7369 7a65 290d  ict_batch_size).
-0004e050: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0004e060: 2020 2020 2072 6573 756c 742e 7570 6461       result.upda
-0004e070: 7465 2873 656c 662e 6675 6c6c 5f64 6f6e  te(self.full_don
-0004e080: 655f 7370 6563 2e7a 6572 6f28 7465 6e73  e_spec.zero(tens
-0004e090: 6f72 6469 6374 5f62 6174 6368 5f73 697a  ordict_batch_siz
-0004e0a0: 6529 290d 0a20 2020 2020 2020 202e 2e2e  e))..        ...
-0004e0b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0004e0c0: 7265 7375 6c74 0d0a 2020 2020 2020 2020  result..        
-0004e0d0: 2e2e 2e0d 0a20 2020 2020 2020 202e 2e2e  .....        ...
-0004e0e0: 2020 2020 2064 6566 205f 7374 6570 280d       def _step(.
-0004e0f0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0004e100: 2020 2020 2073 656c 662c 0d0a 2020 2020       self,..    
-0004e110: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0004e120: 7465 6e73 6f72 6469 6374 3a20 5465 6e73  tensordict: Tens
-0004e130: 6f72 4469 6374 4261 7365 2c0d 0a20 2020  orDictBase,..   
-0004e140: 2020 2020 202e 2e2e 2020 2020 2029 202d       ...     ) -
-0004e150: 3e20 5465 6e73 6f72 4469 6374 4261 7365  > TensorDictBase
-0004e160: 3a0d 0a20 2020 2020 2020 202e 2e2e 2020  :..        ...  
-0004e170: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0004e180: 7365 6c66 2e6f 6273 6572 7661 7469 6f6e  self.observation
-0004e190: 5f73 7065 632e 7261 6e64 2874 656e 736f  _spec.rand(tenso
-0004e1a0: 7264 6963 742e 6261 7463 685f 7369 7a65  rdict.batch_size
-0004e1b0: 290d 0a20 2020 2020 2020 202e 2e2e 2020  )..        ...  
-0004e1c0: 2020 2020 2020 2072 6573 756c 742e 7570         result.up
-0004e1d0: 6461 7465 2873 656c 662e 6675 6c6c 5f64  date(self.full_d
-0004e1e0: 6f6e 655f 7370 6563 2e7a 6572 6f28 7465  one_spec.zero(te
-0004e1f0: 6e73 6f72 6469 6374 2e62 6174 6368 5f73  nsordict.batch_s
-0004e200: 697a 6529 290d 0a20 2020 2020 2020 202e  ize))..        .
-0004e210: 2e2e 2020 2020 2020 2020 2072 6573 756c  ..         resul
-0004e220: 742e 7570 6461 7465 2873 656c 662e 6675  t.update(self.fu
-0004e230: 6c6c 5f72 6577 6172 645f 7370 6563 2e7a  ll_reward_spec.z
-0004e240: 6572 6f28 7465 6e73 6f72 6469 6374 2e62  ero(tensordict.b
-0004e250: 6174 6368 5f73 697a 6529 290d 0a20 2020  atch_size))..   
-0004e260: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
-0004e270: 2072 6574 7572 6e20 7265 7375 6c74 0d0a   return result..
-0004e280: 2020 2020 2020 2020 2e2e 2e0d 0a20 2020          .....   
-0004e290: 2020 2020 202e 2e2e 2020 2020 2064 6566       ...     def
-0004e2a0: 205f 7365 745f 7365 6564 2873 656c 662c   _set_seed(self,
-0004e2b0: 2073 6565 643a 204f 7074 696f 6e61 6c5b   seed: Optional[
-0004e2c0: 696e 745d 293a 0d0a 2020 2020 2020 2020  int]):..        
-0004e2d0: 2e2e 2e20 2020 2020 2020 2020 7061 7373  ...         pass
-0004e2e0: 0d0a 2020 2020 2020 2020 2e2e 2e0d 0a20  ..        ..... 
-0004e2f0: 2020 2020 2020 203e 3e3e 2065 6e76 203d         >>> env =
-0004e300: 2054 7261 6e73 666f 726d 6564 456e 7628   TransformedEnv(
-0004e310: 4d79 456e 7628 292c 2042 6174 6368 5369  MyEnv(), BatchSi
-0004e320: 7a65 5472 616e 7366 6f72 6d28 5b35 5d29  zeTransform([5])
-0004e330: 290d 0a20 2020 2020 2020 203e 3e3e 2061  )..        >>> a
-0004e340: 7373 6572 7420 656e 762e 6261 7463 685f  ssert env.batch_
-0004e350: 7369 7a65 203d 3d20 746f 7263 682e 5369  size == torch.Si
-0004e360: 7a65 285b 355d 290d 0a20 2020 2020 2020  ze([5])..       
-0004e370: 203e 3e3e 2061 7373 6572 7420 656e 762e   >>> assert env.
-0004e380: 726f 6c6c 6f75 7428 3130 292e 7368 6170  rollout(10).shap
-0004e390: 6520 3d3d 2074 6f72 6368 2e53 697a 6528  e == torch.Size(
-0004e3a0: 5b35 2c20 3130 5d29 0d0a 0d0a 2020 2020  [5, 10])....    
-0004e3b0: 5468 6520 6060 7265 7365 745f 6675 6e63  The ``reset_func
-0004e3c0: 6060 2063 616e 2063 7265 6174 6520 6120  `` can create a 
-0004e3d0: 7465 6e73 6f72 6469 6374 2077 6974 6820  tensordict with 
-0004e3e0: 7468 6520 6465 7369 7265 6420 6261 7463  the desired batc
-0004e3f0: 682d 7369 7a65 2c20 616c 6c6f 7769 6e67  h-size, allowing
-0004e400: 2066 6f72 0d0a 2020 2020 6120 6669 6e65   for..    a fine
-0004e410: 2d67 7261 696e 6564 2072 6573 6574 2063  -grained reset c
-0004e420: 616c 6c3a 0d0a 0d0a 2020 2020 2020 2020  all:....        
-0004e430: 3e3e 3e20 6465 6620 7265 7365 745f 6675  >>> def reset_fu
-0004e440: 6e63 2874 656e 736f 7264 6963 742c 2074  nc(tensordict, t
-0004e450: 656e 736f 7264 6963 745f 7265 7365 742c  ensordict_reset,
-0004e460: 2065 6e76 293a 0d0a 2020 2020 2020 2020   env):..        
-0004e470: 2e2e 2e20 2020 2020 7265 7375 6c74 203d  ...     result =
-0004e480: 2065 6e76 2e6f 6273 6572 7661 7469 6f6e   env.observation
-0004e490: 5f73 7065 632e 7261 6e64 2829 0d0a 2020  _spec.rand()..  
-0004e4a0: 2020 2020 2020 2e2e 2e20 2020 2020 7265        ...     re
-0004e4b0: 7375 6c74 2e75 7064 6174 6528 656e 762e  sult.update(env.
-0004e4c0: 6675 6c6c 5f64 6f6e 655f 7370 6563 2e7a  full_done_spec.z
-0004e4d0: 6572 6f28 2929 0d0a 2020 2020 2020 2020  ero())..        
-0004e4e0: 2e2e 2e20 2020 2020 6173 7365 7274 2072  ...     assert r
-0004e4f0: 6573 756c 742e 6261 7463 685f 7369 7a65  esult.batch_size
-0004e500: 2021 3d20 746f 7263 682e 5369 7a65 285b   != torch.Size([
-0004e510: 5d29 0d0a 2020 2020 2020 2020 2e2e 2e20  ])..        ... 
-0004e520: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0004e530: 740d 0a20 2020 2020 2020 203e 3e3e 2065  t..        >>> e
-0004e540: 6e76 203d 2054 7261 6e73 666f 726d 6564  nv = Transformed
-0004e550: 456e 7628 4d79 456e 7628 292c 2042 6174  Env(MyEnv(), Bat
-0004e560: 6368 5369 7a65 5472 616e 7366 6f72 6d28  chSizeTransform(
-0004e570: 5b35 5d2c 2072 6573 6574 5f66 756e 633d  [5], reset_func=
-0004e580: 7265 7365 745f 6675 6e63 2c20 656e 765f  reset_func, env_
-0004e590: 6b77 6172 673d 5472 7565 2929 0d0a 2020  kwarg=True))..  
-0004e5a0: 2020 2020 2020 3e3e 3e20 7072 696e 7428        >>> print(
-0004e5b0: 656e 762e 726f 6c6c 6f75 7428 3229 290d  env.rollout(2)).
-0004e5c0: 0a20 2020 2020 2020 2054 656e 736f 7244  .        TensorD
-0004e5d0: 6963 7428 0d0a 2020 2020 2020 2020 2020  ict(..          
-0004e5e0: 2020 6669 656c 6473 3d7b 0d0a 2020 2020    fields={..    
-0004e5f0: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-0004e600: 6f6e 3a20 5465 6e73 6f72 2873 6861 7065  on: Tensor(shape
-0004e610: 3d74 6f72 6368 2e53 697a 6528 5b35 2c20  =torch.Size([5, 
-0004e620: 322c 2031 5d29 2c20 6465 7669 6365 3d63  2, 1]), device=c
-0004e630: 7075 2c20 6474 7970 653d 746f 7263 682e  pu, dtype=torch.
-0004e640: 666c 6f61 7433 322c 2069 735f 7368 6172  float32, is_shar
-0004e650: 6564 3d46 616c 7365 292c 0d0a 2020 2020  ed=False),..    
-0004e660: 2020 2020 2020 2020 2020 2020 646f 6e65              done
-0004e670: 3a20 5465 6e73 6f72 2873 6861 7065 3d74  : Tensor(shape=t
-0004e680: 6f72 6368 2e53 697a 6528 5b35 2c20 322c  orch.Size([5, 2,
-0004e690: 2031 5d29 2c20 6465 7669 6365 3d63 7075   1]), device=cpu
-0004e6a0: 2c20 6474 7970 653d 746f 7263 682e 626f  , dtype=torch.bo
-0004e6b0: 6f6c 2c20 6973 5f73 6861 7265 643d 4661  ol, is_shared=Fa
-0004e6c0: 6c73 6529 2c0d 0a20 2020 2020 2020 2020  lse),..         
-0004e6d0: 2020 2020 2020 206e 6578 743a 2054 656e         next: Ten
-0004e6e0: 736f 7244 6963 7428 0d0a 2020 2020 2020  sorDict(..      
-0004e6f0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0004e700: 656c 6473 3d7b 0d0a 2020 2020 2020 2020  elds={..        
-0004e710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e720: 646f 6e65 3a20 5465 6e73 6f72 2873 6861  done: Tensor(sha
-0004e730: 7065 3d74 6f72 6368 2e53 697a 6528 5b35  pe=torch.Size([5
-0004e740: 2c20 322c 2031 5d29 2c20 6465 7669 6365  , 2, 1]), device
-0004e750: 3d63 7075 2c20 6474 7970 653d 746f 7263  =cpu, dtype=torc
-0004e760: 682e 626f 6f6c 2c20 6973 5f73 6861 7265  h.bool, is_share
-0004e770: 643d 4661 6c73 6529 2c0d 0a20 2020 2020  d=False),..     
-0004e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e790: 2020 206f 6273 6572 7661 7469 6f6e 3a20     observation: 
-0004e7a0: 5465 6e73 6f72 2873 6861 7065 3d74 6f72  Tensor(shape=tor
-0004e7b0: 6368 2e53 697a 6528 5b35 2c20 322c 2033  ch.Size([5, 2, 3
-0004e7c0: 5d29 2c20 6465 7669 6365 3d63 7075 2c20  ]), device=cpu, 
-0004e7d0: 6474 7970 653d 746f 7263 682e 666c 6f61  dtype=torch.floa
-0004e7e0: 7433 322c 2069 735f 7368 6172 6564 3d46  t32, is_shared=F
-0004e7f0: 616c 7365 292c 0d0a 2020 2020 2020 2020  alse),..        
-0004e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e810: 7265 7761 7264 3a20 5465 6e73 6f72 2873  reward: Tensor(s
-0004e820: 6861 7065 3d74 6f72 6368 2e53 697a 6528  hape=torch.Size(
-0004e830: 5b35 2c20 322c 2031 5d29 2c20 6465 7669  [5, 2, 1]), devi
-0004e840: 6365 3d63 7075 2c20 6474 7970 653d 746f  ce=cpu, dtype=to
-0004e850: 7263 682e 666c 6f61 7433 322c 2069 735f  rch.float32, is_
-0004e860: 7368 6172 6564 3d46 616c 7365 292c 0d0a  shared=False),..
-0004e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e880: 2020 2020 2020 2020 7465 726d 696e 6174          terminat
-0004e890: 6564 3a20 5465 6e73 6f72 2873 6861 7065  ed: Tensor(shape
-0004e8a0: 3d74 6f72 6368 2e53 697a 6528 5b35 2c20  =torch.Size([5, 
-0004e8b0: 322c 2031 5d29 2c20 6465 7669 6365 3d63  2, 1]), device=c
-0004e8c0: 7075 2c20 6474 7970 653d 746f 7263 682e  pu, dtype=torch.
-0004e8d0: 626f 6f6c 2c20 6973 5f73 6861 7265 643d  bool, is_shared=
-0004e8e0: 4661 6c73 6529 7d2c 0d0a 2020 2020 2020  False)},..      
-0004e8f0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-0004e900: 7463 685f 7369 7a65 3d74 6f72 6368 2e53  tch_size=torch.S
-0004e910: 697a 6528 5b35 2c20 325d 292c 0d0a 2020  ize([5, 2]),..  
-0004e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e930: 2020 6465 7669 6365 3d4e 6f6e 652c 0d0a    device=None,..
-0004e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e950: 2020 2020 6973 5f73 6861 7265 643d 4661      is_shared=Fa
-0004e960: 6c73 6529 2c0d 0a20 2020 2020 2020 2020  lse),..         
-0004e970: 2020 2020 2020 206f 6273 6572 7661 7469         observati
-0004e980: 6f6e 3a20 5465 6e73 6f72 2873 6861 7065  on: Tensor(shape
-0004e990: 3d74 6f72 6368 2e53 697a 6528 5b35 2c20  =torch.Size([5, 
-0004e9a0: 322c 2033 5d29 2c20 6465 7669 6365 3d63  2, 3]), device=c
-0004e9b0: 7075 2c20 6474 7970 653d 746f 7263 682e  pu, dtype=torch.
-0004e9c0: 666c 6f61 7433 322c 2069 735f 7368 6172  float32, is_shar
-0004e9d0: 6564 3d46 616c 7365 292c 0d0a 2020 2020  ed=False),..    
-0004e9e0: 2020 2020 2020 2020 2020 2020 7465 726d              term
-0004e9f0: 696e 6174 6564 3a20 5465 6e73 6f72 2873  inated: Tensor(s
-0004ea00: 6861 7065 3d74 6f72 6368 2e53 697a 6528  hape=torch.Size(
-0004ea10: 5b35 2c20 322c 2031 5d29 2c20 6465 7669  [5, 2, 1]), devi
-0004ea20: 6365 3d63 7075 2c20 6474 7970 653d 746f  ce=cpu, dtype=to
-0004ea30: 7263 682e 626f 6f6c 2c20 6973 5f73 6861  rch.bool, is_sha
-0004ea40: 7265 643d 4661 6c73 6529 7d2c 0d0a 2020  red=False)},..  
-0004ea50: 2020 2020 2020 2020 2020 6261 7463 685f            batch_
-0004ea60: 7369 7a65 3d74 6f72 6368 2e53 697a 6528  size=torch.Size(
-0004ea70: 5b35 2c20 325d 292c 0d0a 2020 2020 2020  [5, 2]),..      
-0004ea80: 2020 2020 2020 6465 7669 6365 3d4e 6f6e        device=Non
-0004ea90: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0004eaa0: 6973 5f73 6861 7265 643d 4661 6c73 6529  is_shared=False)
-0004eab0: 0d0a 0d0a 2020 2020 5468 6973 2074 7261  ....    This tra
-0004eac0: 6e73 666f 726d 2063 616e 2062 6520 7573  nsform can be us
-0004ead0: 6564 2074 6f20 6465 706c 6f79 206e 6f6e  ed to deploy non
-0004eae0: 2d62 6174 6368 2d6c 6f63 6b65 6420 656e  -batch-locked en
-0004eaf0: 7669 726f 6e6d 656e 7473 2077 6974 6869  vironments withi
-0004eb00: 6e20 6461 7461 0d0a 2020 2020 636f 6c6c  n data..    coll
-0004eb10: 6563 746f 7273 3a0d 0a0d 0a20 2020 2020  ectors:....     
-0004eb20: 2020 203e 3e3e 2066 726f 6d20 746f 7263     >>> from torc
-0004eb30: 6872 6c2e 636f 6c6c 6563 746f 7273 2069  hrl.collectors i
-0004eb40: 6d70 6f72 7420 5379 6e63 4461 7461 436f  mport SyncDataCo
-0004eb50: 6c6c 6563 746f 720d 0a20 2020 2020 2020  llector..       
-0004eb60: 203e 3e3e 2063 6f6c 6c65 6374 6f72 203d   >>> collector =
-0004eb70: 2053 796e 6344 6174 6143 6f6c 6c65 6374   SyncDataCollect
-0004eb80: 6f72 2865 6e76 2c20 6c61 6d62 6461 2074  or(env, lambda t
-0004eb90: 643a 2065 6e76 2e72 616e 645f 6163 7469  d: env.rand_acti
-0004eba0: 6f6e 2874 6429 2c20 6672 616d 6573 5f70  on(td), frames_p
-0004ebb0: 6572 5f62 6174 6368 3d31 302c 2074 6f74  er_batch=10, tot
-0004ebc0: 616c 5f66 7261 6d65 733d 2d31 290d 0a20  al_frames=-1).. 
-0004ebd0: 2020 2020 2020 203e 3e3e 2066 6f72 2064         >>> for d
-0004ebe0: 6174 6120 696e 2063 6f6c 6c65 6374 6f72  ata in collector
-0004ebf0: 3a0d 0a20 2020 2020 2020 202e 2e2e 2020  :..        ...  
-0004ec00: 2020 2070 7269 6e74 2864 6174 6129 0d0a     print(data)..
-0004ec10: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0004ec20: 6272 6561 6b0d 0a20 2020 2020 2020 2054  break..        T
-0004ec30: 656e 736f 7244 6963 7428 0d0a 2020 2020  ensorDict(..    
-0004ec40: 2020 2020 2020 2020 6669 656c 6473 3d7b          fields={
-0004ec50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004ec60: 2020 6163 7469 6f6e 3a20 5465 6e73 6f72    action: Tensor
-0004ec70: 2873 6861 7065 3d74 6f72 6368 2e53 697a  (shape=torch.Siz
-0004ec80: 6528 5b35 2c20 322c 2031 5d29 2c20 6465  e([5, 2, 1]), de
-0004ec90: 7669 6365 3d63 7075 2c20 6474 7970 653d  vice=cpu, dtype=
-0004eca0: 746f 7263 682e 666c 6f61 7433 322c 2069  torch.float32, i
-0004ecb0: 735f 7368 6172 6564 3d46 616c 7365 292c  s_shared=False),
-0004ecc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004ecd0: 2020 636f 6c6c 6563 746f 723a 2054 656e    collector: Ten
-0004ece0: 736f 7244 6963 7428 0d0a 2020 2020 2020  sorDict(..      
-0004ecf0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0004ed00: 656c 6473 3d7b 0d0a 2020 2020 2020 2020  elds={..        
-0004ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed20: 7472 616a 5f69 6473 3a20 5465 6e73 6f72  traj_ids: Tensor
-0004ed30: 2873 6861 7065 3d74 6f72 6368 2e53 697a  (shape=torch.Siz
-0004ed40: 6528 5b35 2c20 325d 292c 2064 6576 6963  e([5, 2]), devic
-0004ed50: 653d 6370 752c 2064 7479 7065 3d74 6f72  e=cpu, dtype=tor
-0004ed60: 6368 2e69 6e74 3634 2c20 6973 5f73 6861  ch.int64, is_sha
-0004ed70: 7265 643d 4661 6c73 6529 7d2c 0d0a 2020  red=False)},..  
-0004ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed90: 2020 6261 7463 685f 7369 7a65 3d74 6f72    batch_size=tor
-0004eda0: 6368 2e53 697a 6528 5b35 2c20 325d 292c  ch.Size([5, 2]),
-0004edb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004edc0: 2020 2020 2020 6465 7669 6365 3d4e 6f6e        device=Non
-0004edd0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0004ede0: 2020 2020 2020 2020 6973 5f73 6861 7265          is_share
-0004edf0: 643d 4661 6c73 6529 2c0d 0a20 2020 2020  d=False),..     
-0004ee00: 2020 2020 2020 2020 2020 2064 6f6e 653a             done:
-0004ee10: 2054 656e 736f 7228 7368 6170 653d 746f   Tensor(shape=to
-0004ee20: 7263 682e 5369 7a65 285b 352c 2032 2c20  rch.Size([5, 2, 
-0004ee30: 315d 292c 2064 6576 6963 653d 6370 752c  1]), device=cpu,
-0004ee40: 2064 7479 7065 3d74 6f72 6368 2e62 6f6f   dtype=torch.boo
-0004ee50: 6c2c 2069 735f 7368 6172 6564 3d46 616c  l, is_shared=Fal
-0004ee60: 7365 292c 0d0a 2020 2020 2020 2020 2020  se),..          
-0004ee70: 2020 2020 2020 6e65 7874 3a20 5465 6e73        next: Tens
-0004ee80: 6f72 4469 6374 280d 0a20 2020 2020 2020  orDict(..       
-0004ee90: 2020 2020 2020 2020 2020 2020 2066 6965               fie
-0004eea0: 6c64 733d 7b0d 0a20 2020 2020 2020 2020  lds={..         
-0004eeb0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0004eec0: 6f6e 653a 2054 656e 736f 7228 7368 6170  one: Tensor(shap
-0004eed0: 653d 746f 7263 682e 5369 7a65 285b 352c  e=torch.Size([5,
-0004eee0: 2032 2c20 315d 292c 2064 6576 6963 653d   2, 1]), device=
-0004eef0: 6370 752c 2064 7479 7065 3d74 6f72 6368  cpu, dtype=torch
-0004ef00: 2e62 6f6f 6c2c 2069 735f 7368 6172 6564  .bool, is_shared
-0004ef10: 3d46 616c 7365 292c 0d0a 2020 2020 2020  =False),..      
-0004ef20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ef30: 2020 6f62 7365 7276 6174 696f 6e3a 2054    observation: T
-0004ef40: 656e 736f 7228 7368 6170 653d 746f 7263  ensor(shape=torc
-0004ef50: 682e 5369 7a65 285b 352c 2032 2c20 335d  h.Size([5, 2, 3]
-0004ef60: 292c 2064 6576 6963 653d 6370 752c 2064  ), device=cpu, d
-0004ef70: 7479 7065 3d74 6f72 6368 2e66 6c6f 6174  type=torch.float
-0004ef80: 3332 2c20 6973 5f73 6861 7265 643d 4661  32, is_shared=Fa
-0004ef90: 6c73 6529 2c0d 0a20 2020 2020 2020 2020  lse),..         
-0004efa0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004efb0: 6577 6172 643a 2054 656e 736f 7228 7368  eward: Tensor(sh
-0004efc0: 6170 653d 746f 7263 682e 5369 7a65 285b  ape=torch.Size([
-0004efd0: 352c 2032 2c20 315d 292c 2064 6576 6963  5, 2, 1]), devic
-0004efe0: 653d 6370 752c 2064 7479 7065 3d74 6f72  e=cpu, dtype=tor
-0004eff0: 6368 2e66 6c6f 6174 3332 2c20 6973 5f73  ch.float32, is_s
-0004f000: 6861 7265 643d 4661 6c73 6529 2c0d 0a20  hared=False),.. 
-0004f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f020: 2020 2020 2020 2074 6572 6d69 6e61 7465         terminate
-0004f030: 643a 2054 656e 736f 7228 7368 6170 653d  d: Tensor(shape=
-0004f040: 746f 7263 682e 5369 7a65 285b 352c 2032  torch.Size([5, 2
-0004f050: 2c20 315d 292c 2064 6576 6963 653d 6370  , 1]), device=cp
-0004f060: 752c 2064 7479 7065 3d74 6f72 6368 2e62  u, dtype=torch.b
-0004f070: 6f6f 6c2c 2069 735f 7368 6172 6564 3d46  ool, is_shared=F
-0004f080: 616c 7365 297d 2c0d 0a20 2020 2020 2020  alse)},..       
-0004f090: 2020 2020 2020 2020 2020 2020 2062 6174               bat
-0004f0a0: 6368 5f73 697a 653d 746f 7263 682e 5369  ch_size=torch.Si
-0004f0b0: 7a65 285b 352c 2032 5d29 2c0d 0a20 2020  ze([5, 2]),..   
-0004f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f0d0: 2064 6576 6963 653d 4e6f 6e65 2c0d 0a20   device=None,.. 
-0004f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f0f0: 2020 2069 735f 7368 6172 6564 3d46 616c     is_shared=Fal
-0004f100: 7365 292c 0d0a 2020 2020 2020 2020 2020  se),..          
-0004f110: 2020 2020 2020 6f62 7365 7276 6174 696f        observatio
-0004f120: 6e3a 2054 656e 736f 7228 7368 6170 653d  n: Tensor(shape=
-0004f130: 746f 7263 682e 5369 7a65 285b 352c 2032  torch.Size([5, 2
-0004f140: 2c20 335d 292c 2064 6576 6963 653d 6370  , 3]), device=cp
-0004f150: 752c 2064 7479 7065 3d74 6f72 6368 2e66  u, dtype=torch.f
-0004f160: 6c6f 6174 3332 2c20 6973 5f73 6861 7265  loat32, is_share
-0004f170: 643d 4661 6c73 6529 2c0d 0a20 2020 2020  d=False),..     
-0004f180: 2020 2020 2020 2020 2020 2074 6572 6d69             termi
-0004f190: 6e61 7465 643a 2054 656e 736f 7228 7368  nated: Tensor(sh
-0004f1a0: 6170 653d 746f 7263 682e 5369 7a65 285b  ape=torch.Size([
-0004f1b0: 352c 2032 2c20 315d 292c 2064 6576 6963  5, 2, 1]), devic
-0004f1c0: 653d 6370 752c 2064 7479 7065 3d74 6f72  e=cpu, dtype=tor
-0004f1d0: 6368 2e62 6f6f 6c2c 2069 735f 7368 6172  ch.bool, is_shar
-0004f1e0: 6564 3d46 616c 7365 297d 2c0d 0a20 2020  ed=False)},..   
-0004f1f0: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
-0004f200: 697a 653d 746f 7263 682e 5369 7a65 285b  ize=torch.Size([
-0004f210: 352c 2032 5d29 2c0d 0a20 2020 2020 2020  5, 2]),..       
-0004f220: 2020 2020 2064 6576 6963 653d 4e6f 6e65       device=None
-0004f230: 2c0d 0a20 2020 2020 2020 2020 2020 2069  ,..            i
-0004f240: 735f 7368 6172 6564 3d46 616c 7365 290d  s_shared=False).
-0004f250: 0a20 2020 2020 2020 203e 3e3e 2063 6f6c  .        >>> col
-0004f260: 6c65 6374 6f72 2e73 6875 7464 6f77 6e28  lector.shutdown(
-0004f270: 290d 0a20 2020 2022 2222 0d0a 0d0a 2020  )..    """....  
-0004f280: 2020 5f45 4e56 5f45 5252 203d 2022 4261    _ENV_ERR = "Ba
-0004f290: 7463 6853 697a 6554 7261 6e73 666f 726d  tchSizeTransform
-0004f2a0: 2e7b 7d20 7265 7175 6972 6573 2061 2070  .{} requires a p
-0004f2b0: 6172 656e 7420 656e 762e 220d 0a0d 0a20  arent env.".... 
-0004f2c0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0004f2d0: 0d0a 2020 2020 2020 2020 7365 6c66 2c0d  ..        self,.
-0004f2e0: 0a20 2020 2020 2020 202a 2c0d 0a20 2020  .        *,..   
-0004f2f0: 2020 2020 2062 6174 6368 5f73 697a 653a       batch_size:
-0004f300: 2074 6f72 6368 2e53 697a 6520 7c20 4e6f   torch.Size | No
-0004f310: 6e65 203d 204e 6f6e 652c 0d0a 2020 2020  ne = None,..    
-0004f320: 2020 2020 7265 7368 6170 655f 666e 3a20      reshape_fn: 
-0004f330: 4361 6c6c 6162 6c65 5b5b 5465 6e73 6f72  Callable[[Tensor
-0004f340: 4469 6374 4261 7365 5d2c 2054 656e 736f  DictBase], Tenso
-0004f350: 7244 6963 7442 6173 655d 207c 204e 6f6e  rDictBase] | Non
-0004f360: 6520 3d20 4e6f 6e65 2c0d 0a20 2020 2020  e = None,..     
-0004f370: 2020 2072 6573 6574 5f66 756e 633a 2043     reset_func: C
-0004f380: 616c 6c61 626c 655b 5b54 656e 736f 7244  allable[[TensorD
-0004f390: 6963 7442 6173 652c 2054 656e 736f 7244  ictBase, TensorD
-0004f3a0: 6963 7442 6173 655d 2c20 5465 6e73 6f72  ictBase], Tensor
-0004f3b0: 4469 6374 4261 7365 5d0d 0a20 2020 2020  DictBase]..     
-0004f3c0: 2020 207c 204e 6f6e 6520 3d20 4e6f 6e65     | None = None
-0004f3d0: 2c0d 0a20 2020 2020 2020 2065 6e76 5f6b  ,..        env_k
-0004f3e0: 7761 7267 3a20 626f 6f6c 203d 2046 616c  warg: bool = Fal
-0004f3f0: 7365 2c0d 0a20 2020 2029 3a0d 0a20 2020  se,..    ):..   
-0004f400: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
-0004f410: 6e69 745f 5f28 290d 0a20 2020 2020 2020  nit__()..       
-0004f420: 2069 6620 6e6f 7420 2828 6261 7463 685f   if not ((batch_
-0004f430: 7369 7a65 2069 7320 4e6f 6e65 2920 5e20  size is None) ^ 
-0004f440: 2872 6573 6861 7065 5f66 6e20 6973 204e  (reshape_fn is N
-0004f450: 6f6e 6529 293a 0d0a 2020 2020 2020 2020  one)):..        
-0004f460: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0004f470: 7272 6f72 280d 0a20 2020 2020 2020 2020  rror(..         
-0004f480: 2020 2020 2020 2022 4f6e 6520 616e 6420         "One and 
-0004f490: 6f6e 6c79 206f 6e65 206f 6620 6261 7463  only one of batc
-0004f4a0: 685f 7369 7a65 204f 5220 7265 7368 6170  h_size OR reshap
-0004f4b0: 655f 666e 206d 7573 7420 6265 2070 726f  e_fn must be pro
-0004f4c0: 7669 6465 642e 220d 0a20 2020 2020 2020  vided."..       
-0004f4d0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0004f4e0: 6966 2062 6174 6368 5f73 697a 6520 6973  if batch_size is
-0004f4f0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0004f500: 2020 2020 2020 2020 7365 6c66 2e62 6174          self.bat
-0004f510: 6368 5f73 697a 6520 3d20 746f 7263 682e  ch_size = torch.
-0004f520: 5369 7a65 2862 6174 6368 5f73 697a 6529  Size(batch_size)
-0004f530: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0004f540: 6c66 2e72 6573 6861 7065 5f66 6e20 3d20  lf.reshape_fn = 
-0004f550: 4e6f 6e65 0d0a 2020 2020 2020 2020 656c  None..        el
-0004f560: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0004f570: 2073 656c 662e 7265 7368 6170 655f 666e   self.reshape_fn
-0004f580: 203d 2072 6573 6861 7065 5f66 6e0d 0a20   = reshape_fn.. 
-0004f590: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0004f5a0: 6261 7463 685f 7369 7a65 203d 204e 6f6e  batch_size = Non
-0004f5b0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0004f5c0: 7265 7368 6170 655f 666e 203d 2072 6573  reshape_fn = res
-0004f5d0: 6861 7065 5f66 6e0d 0a20 2020 2020 2020  hape_fn..       
-0004f5e0: 2073 656c 662e 7265 7365 745f 6675 6e63   self.reset_func
-0004f5f0: 203d 2072 6573 6574 5f66 756e 630d 0a20   = reset_func.. 
-0004f600: 2020 2020 2020 2073 656c 662e 656e 765f         self.env_
-0004f610: 6b77 6172 6720 3d20 656e 765f 6b77 6172  kwarg = env_kwar
-0004f620: 670d 0a0d 0a20 2020 2064 6566 205f 7265  g....    def _re
-0004f630: 7365 7428 0d0a 2020 2020 2020 2020 7365  set(..        se
-0004f640: 6c66 2c20 7465 6e73 6f72 6469 6374 3a20  lf, tensordict: 
-0004f650: 5465 6e73 6f72 4469 6374 4261 7365 2c20  TensorDictBase, 
-0004f660: 7465 6e73 6f72 6469 6374 5f72 6573 6574  tensordict_reset
-0004f670: 3a20 5465 6e73 6f72 4469 6374 4261 7365  : TensorDictBase
-0004f680: 0d0a 2020 2020 2920 2d3e 2054 656e 736f  ..    ) -> Tenso
-0004f690: 7244 6963 7442 6173 653a 0d0a 2020 2020  rDictBase:..    
-0004f6a0: 2020 2020 6966 2073 656c 662e 7265 7365      if self.rese
-0004f6b0: 745f 6675 6e63 2069 7320 6e6f 7420 4e6f  t_func is not No
-0004f6c0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0004f6d0: 2069 6620 7365 6c66 2e65 6e76 5f6b 7761   if self.env_kwa
-0004f6e0: 7267 3a0d 0a20 2020 2020 2020 2020 2020  rg:..           
-0004f6f0: 2020 2020 2074 656e 736f 7264 6963 745f       tensordict_
-0004f700: 7265 7365 7420 3d20 7365 6c66 2e72 6573  reset = self.res
-0004f710: 6574 5f66 756e 6328 0d0a 2020 2020 2020  et_func(..      
-0004f720: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0004f730: 6e73 6f72 6469 6374 2c20 7465 6e73 6f72  nsordict, tensor
-0004f740: 6469 6374 5f72 6573 6574 2c20 656e 763d  dict_reset, env=
-0004f750: 7365 6c66 2e63 6f6e 7461 696e 6572 0d0a  self.container..
-0004f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f770: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0004f780: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0004f790: 2020 2020 2020 7465 6e73 6f72 6469 6374        tensordict
-0004f7a0: 5f72 6573 6574 203d 2073 656c 662e 7265  _reset = self.re
-0004f7b0: 7365 745f 6675 6e63 2874 656e 736f 7264  set_func(tensord
-0004f7c0: 6963 742c 2074 656e 736f 7264 6963 745f  ict, tensordict_
-0004f7d0: 7265 7365 7429 0d0a 2020 2020 2020 2020  reset)..        
-0004f7e0: 6966 2073 656c 662e 6261 7463 685f 7369  if self.batch_si
-0004f7f0: 7a65 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ze is not None:.
-0004f800: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0004f810: 7572 6e20 7465 6e73 6f72 6469 6374 5f72  urn tensordict_r
-0004f820: 6573 6574 2e65 7870 616e 6428 7365 6c66  eset.expand(self
-0004f830: 2e62 6174 6368 5f73 697a 6529 0d0a 2020  .batch_size)..  
-0004f840: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0004f850: 662e 7265 7368 6170 655f 666e 2874 656e  f.reshape_fn(ten
-0004f860: 736f 7264 6963 745f 7265 7365 7429 0d0a  sordict_reset)..
-0004f870: 0d0a 2020 2020 6465 6620 5f63 616c 6c28  ..    def _call(
-0004f880: 7365 6c66 2c20 7465 6e73 6f72 6469 6374  self, tensordict
-0004f890: 3a20 5465 6e73 6f72 4469 6374 4261 7365  : TensorDictBase
-0004f8a0: 2920 2d3e 2054 656e 736f 7244 6963 7442  ) -> TensorDictB
-0004f8b0: 6173 653a 0d0a 2020 2020 2020 2020 6966  ase:..        if
-0004f8c0: 2073 656c 662e 7265 7368 6170 655f 666e   self.reshape_fn
-0004f8d0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0004f8e0: 2020 2020 2020 2020 2020 2074 656e 736f             tenso
-0004f8f0: 7264 6963 7420 3d20 7365 6c66 2e72 6573  rdict = self.res
-0004f900: 6861 7065 5f66 6e28 7465 6e73 6f72 6469  hape_fn(tensordi
-0004f910: 6374 290d 0a20 2020 2020 2020 2072 6574  ct)..        ret
-0004f920: 7572 6e20 7465 6e73 6f72 6469 6374 0d0a  urn tensordict..
-0004f930: 0d0a 2020 2020 666f 7277 6172 6420 3d20  ..    forward = 
-0004f940: 5f63 616c 6c0d 0a0d 0a20 2020 2064 6566  _call....    def
-0004f950: 205f 696e 765f 6361 6c6c 2873 656c 662c   _inv_call(self,
-0004f960: 2074 656e 736f 7264 6963 743a 2054 656e   tensordict: Ten
-0004f970: 736f 7244 6963 7442 6173 6529 202d 3e20  sorDictBase) -> 
-0004f980: 5465 6e73 6f72 4469 6374 4261 7365 3a0d  TensorDictBase:.
-0004f990: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0004f9a0: 2e72 6573 6861 7065 5f66 6e20 6973 206e  .reshape_fn is n
-0004f9b0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-0004f9c0: 2020 2020 2020 7061 7265 6e74 203d 2073        parent = s
-0004f9d0: 656c 662e 7061 7265 6e74 0d0a 2020 2020  elf.parent..    
-0004f9e0: 2020 2020 2020 2020 6966 2070 6172 656e          if paren
-0004f9f0: 7420 6973 206e 6f74 204e 6f6e 653a 0d0a  t is not None:..
-0004fa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fa10: 7061 7265 6e74 5f62 6174 6368 5f73 697a  parent_batch_siz
-0004fa20: 6520 3d20 7061 7265 6e74 2e62 6174 6368  e = parent.batch
-0004fa30: 5f73 697a 650d 0a20 2020 2020 2020 2020  _size..         
-0004fa40: 2020 2020 2020 2074 656e 736f 7264 6963         tensordic
-0004fa50: 7420 3d20 7465 6e73 6f72 6469 6374 2e72  t = tensordict.r
-0004fa60: 6573 6861 7065 2870 6172 656e 745f 6261  eshape(parent_ba
-0004fa70: 7463 685f 7369 7a65 290d 0a20 2020 2020  tch_size)..     
-0004fa80: 2020 2072 6574 7572 6e20 7465 6e73 6f72     return tensor
-0004fa90: 6469 6374 0d0a 0d0a 2020 2020 6465 6620  dict....    def 
-0004faa0: 7472 616e 7366 6f72 6d5f 656e 765f 6261  transform_env_ba
-0004fab0: 7463 685f 7369 7a65 2873 656c 662c 2062  tch_size(self, b
-0004fac0: 6174 6368 5f73 697a 653a 2074 6f72 6368  atch_size: torch
-0004fad0: 2e53 697a 6529 3a0d 0a20 2020 2020 2020  .Size):..       
-0004fae0: 2069 6620 7365 6c66 2e62 6174 6368 5f73   if self.batch_s
-0004faf0: 697a 6520 6973 206e 6f74 204e 6f6e 653a  ize is not None:
-0004fb00: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0004fb10: 7475 726e 2073 656c 662e 6261 7463 685f  turn self.batch_
-0004fb20: 7369 7a65 0d0a 2020 2020 2020 2020 7265  size..        re
-0004fb30: 7475 726e 2073 656c 662e 7265 7368 6170  turn self.reshap
-0004fb40: 655f 666e 2874 6f72 6368 2e7a 6572 6f73  e_fn(torch.zeros
-0004fb50: 2862 6174 6368 5f73 697a 652c 2064 6576  (batch_size, dev
-0004fb60: 6963 653d 226d 6574 6122 2929 2e73 6861  ice="meta")).sha
-0004fb70: 7065 0d0a 0d0a 2020 2020 6465 6620 7472  pe....    def tr
-0004fb80: 616e 7366 6f72 6d5f 6f75 7470 7574 5f73  ansform_output_s
-0004fb90: 7065 6328 7365 6c66 2c20 6f75 7470 7574  pec(self, output
-0004fba0: 5f73 7065 633a 2043 6f6d 706f 7369 7465  _spec: Composite
-0004fbb0: 5370 6563 2920 2d3e 2043 6f6d 706f 7369  Spec) -> Composi
-0004fbc0: 7465 5370 6563 3a0d 0a20 2020 2020 2020  teSpec:..       
-0004fbd0: 2069 6620 7365 6c66 2e62 6174 6368 5f73   if self.batch_s
-0004fbe0: 697a 6520 6973 206e 6f74 204e 6f6e 653a  ize is not None:
-0004fbf0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0004fc00: 7475 726e 206f 7574 7075 745f 7370 6563  turn output_spec
-0004fc10: 2e65 7870 616e 6428 7365 6c66 2e62 6174  .expand(self.bat
-0004fc20: 6368 5f73 697a 6529 0d0a 2020 2020 2020  ch_size)..      
-0004fc30: 2020 7265 7475 726e 2073 656c 662e 7265    return self.re
-0004fc40: 7368 6170 655f 666e 286f 7574 7075 745f  shape_fn(output_
-0004fc50: 7370 6563 290d 0a0d 0a20 2020 2064 6566  spec)....    def
-0004fc60: 2074 7261 6e73 666f 726d 5f69 6e70 7574   transform_input
-0004fc70: 5f73 7065 6328 7365 6c66 2c20 696e 7075  _spec(self, inpu
-0004fc80: 745f 7370 6563 3a20 436f 6d70 6f73 6974  t_spec: Composit
-0004fc90: 6553 7065 6329 202d 3e20 436f 6d70 6f73  eSpec) -> Compos
-0004fca0: 6974 6553 7065 633a 0d0a 2020 2020 2020  iteSpec:..      
-0004fcb0: 2020 6966 2073 656c 662e 6261 7463 685f    if self.batch_
-0004fcc0: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
-0004fcd0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0004fce0: 6574 7572 6e20 696e 7075 745f 7370 6563  eturn input_spec
-0004fcf0: 2e65 7870 616e 6428 7365 6c66 2e62 6174  .expand(self.bat
-0004fd00: 6368 5f73 697a 6529 0d0a 2020 2020 2020  ch_size)..      
-0004fd10: 2020 7265 7475 726e 2073 656c 662e 7265    return self.re
-0004fd20: 7368 6170 655f 666e 2869 6e70 7574 5f73  shape_fn(input_s
-0004fd30: 7065 6329 0d0a 0d0a 0d0a 636c 6173 7320  pec)......class 
-0004fd40: 4175 746f 5265 7365 7445 6e76 2854 7261  AutoResetEnv(Tra
-0004fd50: 6e73 666f 726d 6564 456e 7629 3a0d 0a20  nsformedEnv):.. 
-0004fd60: 2020 2022 2222 4120 7375 6263 6c61 7373     """A subclass
-0004fd70: 2066 6f72 2061 7574 6f2d 7265 7365 7474   for auto-resett
-0004fd80: 696e 6720 656e 7673 2e22 2222 0d0a 0d0a  ing envs."""....
-0004fd90: 2020 2020 6465 6620 5f72 6573 6574 2873      def _reset(s
-0004fda0: 656c 662c 2074 656e 736f 7264 6963 743a  elf, tensordict:
-0004fdb0: 204f 7074 696f 6e61 6c5b 5465 6e73 6f72   Optional[Tensor
-0004fdc0: 4469 6374 4261 7365 5d20 3d20 4e6f 6e65  DictBase] = None
-0004fdd0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0004fde0: 2020 2020 2020 6966 2074 656e 736f 7264        if tensord
-0004fdf0: 6963 7420 6973 206e 6f74 204e 6f6e 653a  ict is not None:
-0004fe00: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0004fe10: 5765 206d 7573 7420 6176 6f69 6420 6d6f  We must avoid mo
-0004fe20: 6469 6679 696e 6720 7468 6520 6f72 6967  difying the orig
-0004fe30: 696e 616c 2074 656e 736f 7264 6963 7420  inal tensordict 
-0004fe40: 736f 2061 2073 6861 6c6c 6f77 2063 6f70  so a shallow cop
-0004fe50: 7920 6973 206e 6563 6573 7361 7279 2e0d  y is necessary..
-0004fe60: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
-0004fe70: 6520 6a75 7374 2073 656c 6563 7420 7468  e just select th
-0004fe80: 6520 696e 7075 7420 6461 7461 2061 6e64  e input data and
-0004fe90: 2072 6573 6574 2073 6967 6e61 6c2c 2077   reset signal, w
-0004fea0: 6869 6368 2069 7320 616c 6c20 7765 206e  hich is all we n
-0004feb0: 6565 642e 0d0a 2020 2020 2020 2020 2020  eed...          
-0004fec0: 2020 7465 6e73 6f72 6469 6374 203d 2074    tensordict = t
-0004fed0: 656e 736f 7264 6963 742e 7365 6c65 6374  ensordict.select
-0004fee0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0004fef0: 2020 202a 7365 6c66 2e72 6573 6574 5f6b     *self.reset_k
-0004ff00: 6579 732c 202a 7365 6c66 2e73 7461 7465  eys, *self.state
-0004ff10: 5f73 7065 632e 6b65 7973 2854 7275 652c  _spec.keys(True,
-0004ff20: 2054 7275 6529 2c20 7374 7269 6374 3d46   True), strict=F
-0004ff30: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-0004ff40: 2020 290d 0a20 2020 2020 2020 2066 6f72    )..        for
-0004ff50: 2072 6573 6574 5f6b 6579 2069 6e20 7365   reset_key in se
-0004ff60: 6c66 2e62 6173 655f 656e 762e 7265 7365  lf.base_env.rese
-0004ff70: 745f 6b65 7973 3a0d 0a20 2020 2020 2020  t_keys:..       
-0004ff80: 2020 2020 2069 6620 7465 6e73 6f72 6469       if tensordi
-0004ff90: 6374 2069 7320 6e6f 7420 4e6f 6e65 2061  ct is not None a
-0004ffa0: 6e64 2072 6573 6574 5f6b 6579 2069 6e20  nd reset_key in 
-0004ffb0: 7465 6e73 6f72 6469 6374 2e6b 6579 7328  tensordict.keys(
-0004ffc0: 5472 7565 293a 0d0a 2020 2020 2020 2020  True):..        
-0004ffd0: 2020 2020 2020 2020 7465 6e73 6f72 6469          tensordi
-0004ffe0: 6374 5f72 6573 6574 203d 2074 656e 736f  ct_reset = tenso
-0004fff0: 7264 6963 742e 6578 636c 7564 6528 2a73  rdict.exclude(*s
-00050000: 656c 662e 6261 7365 5f65 6e76 2e72 6573  elf.base_env.res
-00050010: 6574 5f6b 6579 7329 0d0a 2020 2020 2020  et_keys)..      
-00050020: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00050030: 2020 2020 2020 2020 2020 2020 2074 656e               ten
-00050040: 736f 7264 6963 745f 7265 7365 7420 3d20  sordict_reset = 
-00050050: 7365 6c66 2e62 6173 655f 656e 762e 5f72  self.base_env._r
-00050060: 6573 6574 2874 656e 736f 7264 6963 742c  eset(tensordict,
-00050070: 202a 2a6b 7761 7267 7329 0d0a 2020 2020   **kwargs)..    
-00050080: 2020 2020 2020 2020 6272 6561 6b0d 0a20          break.. 
-00050090: 2020 2020 2020 2069 6620 7465 6e73 6f72         if tensor
-000500a0: 6469 6374 2069 7320 4e6f 6e65 3a0d 0a20  dict is None:.. 
-000500b0: 2020 2020 2020 2020 2020 2023 206d 616b             # mak
-000500c0: 6520 7375 7265 2061 6c6c 2074 7261 6e73  e sure all trans
-000500d0: 666f 726d 7320 7365 6520 6120 736f 7572  forms see a sour
-000500e0: 6365 2074 656e 736f 7264 6963 740d 0a20  ce tensordict.. 
-000500f0: 2020 2020 2020 2020 2020 2074 656e 736f             tenso
-00050100: 7264 6963 7420 3d20 7465 6e73 6f72 6469  rdict = tensordi
-00050110: 6374 5f72 6573 6574 2e65 6d70 7479 2829  ct_reset.empty()
-00050120: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-00050130: 6173 655f 656e 762e 5f63 6f6d 706c 6574  ase_env._complet
-00050140: 655f 646f 6e65 2873 656c 662e 6261 7365  e_done(self.base
-00050150: 5f65 6e76 2e66 756c 6c5f 646f 6e65 5f73  _env.full_done_s
-00050160: 7065 632c 2074 656e 736f 7264 6963 745f  pec, tensordict_
-00050170: 7265 7365 7429 0d0a 2020 2020 2020 2020  reset)..        
-00050180: 7465 6e73 6f72 6469 6374 5f72 6573 6574  tensordict_reset
-00050190: 203d 2073 656c 662e 7472 616e 7366 6f72   = self.transfor
-000501a0: 6d2e 5f72 6573 6574 2874 656e 736f 7264  m._reset(tensord
-000501b0: 6963 742c 2074 656e 736f 7264 6963 745f  ict, tensordict_
-000501c0: 7265 7365 7429 0d0a 2020 2020 2020 2020  reset)..        
-000501d0: 7265 7475 726e 2074 656e 736f 7264 6963  return tensordic
-000501e0: 745f 7265 7365 740d 0a0d 0a20 2020 2064  t_reset....    d
-000501f0: 6566 2069 6e73 6572 745f 7472 616e 7366  ef insert_transf
-00050200: 6f72 6d28 7365 6c66 2c20 696e 6465 783a  orm(self, index:
-00050210: 2069 6e74 2c20 7472 616e 7366 6f72 6d3a   int, transform:
-00050220: 2054 7261 6e73 666f 726d 2920 2d3e 204e   Transform) -> N
-00050230: 6f6e 653a 0d0a 2020 2020 2020 2020 7261  one:..        ra
-00050240: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-00050250: 2866 2243 616e 6e6f 7420 696e 7365 7274  (f"Cannot insert
-00050260: 2061 2074 7261 6e73 666f 726d 2069 6e20   a transform in 
-00050270: 7b73 656c 662e 5f5f 636c 6173 735f 2e5f  {self.__class_._
-00050280: 5f6e 616d 655f 5f7d 2e22 290d 0a0d 0a0d  _name__}.").....
-00050290: 0a63 6c61 7373 2041 7574 6f52 6573 6574  .class AutoReset
-000502a0: 5472 616e 7366 6f72 6d28 5472 616e 7366  Transform(Transf
-000502b0: 6f72 6d29 3a0d 0a20 2020 2022 2222 4120  orm):..    """A 
-000502c0: 7472 616e 7366 6f72 6d20 666f 7220 6175  transform for au
-000502d0: 746f 2d72 6573 6574 7469 6e67 2065 6e76  to-resetting env
-000502e0: 6972 6f6e 6d65 6e74 732e 0d0a 0d0a 2020  ironments.....  
-000502f0: 2020 5468 6973 2074 7261 6e73 666f 726d    This transform
-00050300: 2063 616e 2062 6520 6170 7065 6e64 6564   can be appended
-00050310: 2074 6f20 616e 7920 6175 746f 2d72 6573   to any auto-res
-00050320: 6574 7469 6e67 2065 6e76 6972 6f6e 6d65  etting environme
-00050330: 6e74 2c20 6f72 2061 7574 6f6d 6174 6963  nt, or automatic
-00050340: 616c 6c79 0d0a 2020 2020 6170 7065 6e64  ally..    append
-00050350: 6564 2075 7369 6e67 2060 6065 6e76 203d  ed using ``env =
-00050360: 2053 6f6d 6545 6e76 436c 6173 7328 2e2e   SomeEnvClass(..
-00050370: 2e2c 2061 7574 6f5f 7265 7365 743d 5472  ., auto_reset=Tr
-00050380: 7565 2960 602e 2049 6620 7468 6520 7472  ue)``. If the tr
-00050390: 616e 7366 6f72 6d20 6973 2065 7870 6c69  ansform is expli
-000503a0: 6369 746c 790d 0a20 2020 2061 7070 656e  citly..    appen
-000503b0: 6465 6420 746f 2061 6e20 656e 762c 2061  ded to an env, a
-000503c0: 203a 636c 6173 733a 607e 746f 7263 6872   :class:`~torchr
-000503d0: 6c2e 656e 7673 2e74 7261 6e73 666f 726d  l.envs.transform
-000503e0: 732e 4175 746f 5265 7365 7445 6e76 6020  s.AutoResetEnv` 
-000503f0: 6d75 7374 2062 6520 7573 6564 2e0d 0a0d  must be used....
-00050400: 0a20 2020 2041 6e20 6175 746f 2d72 6573  .    An auto-res
-00050410: 6574 2065 6e76 6972 6f6e 6d65 6e74 206d  et environment m
-00050420: 7573 7420 6861 7665 2074 6865 2066 6f6c  ust have the fol
-00050430: 6c6f 7769 6e67 2070 726f 7065 7274 6965  lowing propertie
-00050440: 7320 2864 6966 6665 7265 6e63 6573 2066  s (differences f
-00050450: 726f 6d20 7468 6973 0d0a 2020 2020 6465  rom this..    de
-00050460: 7363 7269 7074 696f 6e20 7368 6f75 6c64  scription should
-00050470: 2062 6520 6163 636f 756e 7465 6420 666f   be accounted fo
-00050480: 7220 6279 2073 7562 636c 6173 7369 6e67  r by subclassing
-00050490: 2074 6869 7320 636c 6173 7329 3a0d 0a0d   this class):...
-000504a0: 0a20 2020 2020 202d 2074 6865 2072 6573  .      - the res
-000504b0: 6574 2066 756e 6374 696f 6e20 6361 6e20  et function can 
-000504c0: 6265 2063 616c 6c65 6420 6f6e 6365 2061  be called once a
-000504d0: 7420 7468 6520 6265 6769 6e6e 696e 6720  t the beginning 
-000504e0: 2861 6674 6572 2069 6e73 7461 6e74 6961  (after instantia
-000504f0: 7469 6f6e 2920 7769 7468 0d0a 2020 2020  tion) with..    
-00050500: 2020 2020 6f72 2077 6974 686f 7574 2065      or without e
-00050510: 6666 6563 742e 2057 6865 7468 6572 2063  ffect. Whether c
-00050520: 616c 6c73 2074 6f20 6072 6573 6574 6020  alls to `reset` 
-00050530: 6172 6520 616c 6c6f 7765 6420 6166 7465  are allowed afte
-00050540: 7220 7468 6174 2069 7320 7570 2074 6f20  r that is up to 
-00050550: 7468 650d 0a20 2020 2020 2020 2065 6e76  the..        env
-00050560: 6972 6f6e 6d65 6e74 2069 7473 656c 662e  ironment itself.
-00050570: 0d0a 2020 2020 2020 2d20 4475 7269 6e67  ..      - During
-00050580: 2061 2072 6f6c 6c6f 7574 2c20 616e 7920   a rollout, any 
-00050590: 6060 646f 6e65 6060 2073 7461 7465 2077  ``done`` state w
-000505a0: 696c 6c20 7265 7375 6c74 2069 6e20 6120  ill result in a 
-000505b0: 7265 7365 7420 616e 6420 7072 6f64 7563  reset and produc
-000505c0: 6520 616e 206f 6273 6572 7661 7469 6f6e  e an observation
-000505d0: 0d0a 2020 2020 2020 2020 7468 6174 2069  ..        that i
-000505e0: 736e 2774 2074 6865 206c 6173 7420 6f62  sn't the last ob
-000505f0: 7365 7276 6174 696f 6e20 6f66 2074 6865  servation of the
-00050600: 2063 7572 7265 6e74 2065 7069 736f 6465   current episode
-00050610: 2c20 6275 7420 7468 6520 6669 7273 7420  , but the first 
-00050620: 6f62 7365 7276 6174 696f 6e0d 0a20 2020  observation..   
-00050630: 2020 2020 206f 6620 7468 6520 6e65 7874       of the next
-00050640: 2065 7069 736f 6465 2028 7468 6973 2074   episode (this t
-00050650: 7261 6e73 666f 726d 2077 696c 6c20 6578  ransform will ex
-00050660: 7472 6163 7420 616e 6420 6361 6368 6520  tract and cache 
-00050670: 7468 6973 206f 6273 6572 7661 7469 6f6e  this observation
-00050680: 0d0a 2020 2020 2020 2020 616e 6420 6669  ..        and fi
-00050690: 6c6c 2074 6865 206f 6273 2077 6974 6820  ll the obs with 
-000506a0: 736f 6d65 2061 7262 6974 7261 7279 2076  some arbitrary v
-000506b0: 616c 7565 292e 0d0a 0d0a 2020 2020 4b65  alue).....    Ke
-000506c0: 7977 6f72 6420 4172 6773 3a0d 0a20 2020  yword Args:..   
-000506d0: 2020 2020 2072 6570 6c61 6365 2028 626f       replace (bo
-000506e0: 6f6c 2c20 6f70 7469 6f6e 616c 293a 2069  ol, optional): i
-000506f0: 6620 6060 4661 6c73 6560 602c 2076 616c  f ``False``, val
-00050700: 7565 7320 6172 6520 6a75 7374 2070 6c61  ues are just pla
-00050710: 6365 6420 6173 2074 6865 7920 6172 6520  ced as they are 
-00050720: 696e 2074 6865 0d0a 2020 2020 2020 2020  in the..        
-00050730: 2020 2020 6060 226e 6578 7422 6060 2065      ``"next"`` e
-00050740: 6e74 7279 2065 7665 6e20 6966 2074 6865  ntry even if the
-00050750: 7920 6172 6520 6e6f 7420 7661 6c69 642e  y are not valid.
-00050760: 2044 6566 6175 6c74 7320 746f 2060 6054   Defaults to ``T
-00050770: 7275 6560 602e 2041 2076 616c 7565 206f  rue``. A value o
-00050780: 660d 0a20 2020 2020 2020 2020 2020 2060  f..            `
-00050790: 6046 616c 7365 6060 206f 7665 7272 6964  `False`` overrid
-000507a0: 6573 2061 6e79 2073 7562 7365 7175 656e  es any subsequen
-000507b0: 7420 6669 6c6c 696e 6720 6b65 7977 6f72  t filling keywor
-000507c0: 6420 6172 6775 6d65 6e74 2e0d 0a20 2020  d argument...   
-000507d0: 2020 2020 2020 2020 2054 6869 7320 6172           This ar
-000507e0: 6775 6d65 7420 6361 6e20 616c 736f 2062  gumet can also b
-000507f0: 6520 7061 7373 6564 2077 6974 6820 7468  e passed with th
-00050800: 6520 636f 6e73 7472 7563 746f 7220 6d65  e constructor me
-00050810: 7468 6f64 2062 7920 7061 7373 696e 6720  thod by passing 
-00050820: 610d 0a20 2020 2020 2020 2020 2020 2060  a..            `
-00050830: 6061 7574 6f5f 7265 7365 745f 7265 706c  `auto_reset_repl
-00050840: 6163 6560 6020 6172 6775 6d65 6e74 3a20  ace`` argument: 
-00050850: 6060 656e 7620 3d20 466f 6f45 6e76 282e  ``env = FooEnv(.
-00050860: 2e2e 2c20 6175 746f 5f72 6573 6574 3d54  .., auto_reset=T
-00050870: 7275 652c 2061 7574 6f5f 7265 7365 745f  rue, auto_reset_
-00050880: 7265 706c 6163 653d 4661 6c73 6529 6060  replace=False)``
-00050890: 2e0d 0a20 2020 2020 2020 2066 696c 6c5f  ...        fill_
-000508a0: 666c 6f61 7420 2866 6c6f 6174 206f 7220  float (float or 
-000508b0: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
-000508c0: 5468 6520 6669 6c6c 696e 6720 7661 6c75  The filling valu
-000508d0: 6520 666f 7220 666c 6f61 7469 6e67 2070  e for floating p
-000508e0: 6f69 6e74 2074 656e 736f 7273 0d0a 2020  oint tensors..  
-000508f0: 2020 2020 2020 2020 2020 7468 6174 2074            that t
-00050900: 6572 6d69 6e61 7465 2061 6e20 6570 6973  erminate an epis
-00050910: 6f64 652e 2041 2076 616c 7565 206f 6620  ode. A value of 
-00050920: 6060 4e6f 6e65 6060 206d 6561 6e73 206e  ``None`` means n
-00050930: 6f20 7265 706c 6163 656d 656e 7420 2876  o replacement (v
-00050940: 616c 7565 7320 6172 6520 6a75 7374 0d0a  alues are just..
-00050950: 2020 2020 2020 2020 2020 2020 706c 6163              plac
-00050960: 6564 2061 7320 7468 6579 2061 7265 2069  ed as they are i
-00050970: 6e20 7468 6520 6060 226e 6578 7422 6060  n the ``"next"``
-00050980: 2065 6e74 7279 2065 7665 6e20 6966 2074   entry even if t
-00050990: 6865 7920 6172 6520 6e6f 7420 7661 6c69  hey are not vali
-000509a0: 6429 2e0d 0a20 2020 2020 2020 2066 696c  d)...        fil
-000509b0: 6c5f 696e 7420 2869 6e74 2c20 6f70 7469  l_int (int, opti
-000509c0: 6f6e 616c 293a 2054 6865 2066 696c 6c69  onal): The filli
-000509d0: 6e67 2076 616c 7565 2066 6f72 2073 6967  ng value for sig
-000509e0: 6e65 6420 696e 7465 6765 7220 7465 6e73  ned integer tens
-000509f0: 6f72 730d 0a20 2020 2020 2020 2020 2020  ors..           
-00050a00: 2074 6861 7420 7465 726d 696e 6174 6520   that terminate 
-00050a10: 616e 2065 7069 736f 6465 2e20 2041 2076  an episode.  A v
-00050a20: 616c 7565 206f 6620 6060 4e6f 6e65 6060  alue of ``None``
-00050a30: 206d 6561 6e73 206e 6f20 7265 706c 6163   means no replac
-00050a40: 656d 656e 7420 2876 616c 7565 7320 6172  ement (values ar
-00050a50: 6520 6a75 7374 0d0a 2020 2020 2020 2020  e just..        
-00050a60: 2020 2020 706c 6163 6564 2061 7320 7468      placed as th
-00050a70: 6579 2061 7265 2069 6e20 7468 6520 6060  ey are in the ``
-00050a80: 226e 6578 7422 6060 2065 6e74 7279 2065  "next"`` entry e
-00050a90: 7665 6e20 6966 2074 6865 7920 6172 6520  ven if they are 
-00050aa0: 6e6f 7420 7661 6c69 6429 2e0d 0a20 2020  not valid)...   
-00050ab0: 2020 2020 2066 696c 6c5f 626f 6f6c 2028       fill_bool (
-00050ac0: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
-00050ad0: 2054 6865 2066 696c 6c69 6e67 2076 616c   The filling val
-00050ae0: 7565 2066 6f72 2062 6f6f 6c65 616e 2074  ue for boolean t
-00050af0: 656e 736f 7273 0d0a 2020 2020 2020 2020  ensors..        
-00050b00: 2020 2020 7468 6174 2074 6572 6d69 6e61      that termina
-00050b10: 7465 2061 6e20 6570 6973 6f64 652e 2020  te an episode.  
-00050b20: 4120 7661 6c75 6520 6f66 2060 604e 6f6e  A value of ``Non
-00050b30: 6560 6020 6d65 616e 7320 6e6f 2072 6570  e`` means no rep
-00050b40: 6c61 6365 6d65 6e74 2028 7661 6c75 6573  lacement (values
-00050b50: 2061 7265 206a 7573 740d 0a20 2020 2020   are just..     
-00050b60: 2020 2020 2020 2070 6c61 6365 6420 6173         placed as
-00050b70: 2074 6865 7920 6172 6520 696e 2074 6865   they are in the
-00050b80: 2060 6022 6e65 7874 2260 6020 656e 7472   ``"next"`` entr
-00050b90: 7920 6576 656e 2069 6620 7468 6579 2061  y even if they a
-00050ba0: 7265 206e 6f74 2076 616c 6964 292e 0d0a  re not valid)...
-00050bb0: 0d0a 2020 2020 4172 6775 6d65 6e74 7320  ..    Arguments 
-00050bc0: 6172 6520 6f6e 6c79 2061 7661 696c 6162  are only availab
-00050bd0: 6c65 2077 6865 6e20 7468 6520 7472 616e  le when the tran
-00050be0: 7366 6f72 6d20 6973 2065 7870 6c69 6369  sform is explici
-00050bf0: 746c 7920 696e 7374 616e 7469 6174 6564  tly instantiated
-00050c00: 2028 6e6f 7420 7468 726f 7567 6820 6045   (not through `E
-00050c10: 6e76 5479 7065 282e 2e2e 2c20 6175 746f  nvType(..., auto
-00050c20: 5f72 6573 6574 3d54 7275 6529 6029 2e0d  _reset=True)`)..
-00050c30: 0a0d 0a20 2020 2045 7861 6d70 6c65 733a  ...    Examples:
-00050c40: 0d0a 2020 2020 2020 2020 3e3e 3e20 6672  ..        >>> fr
-00050c50: 6f6d 2074 6f72 6368 726c 2e65 6e76 7320  om torchrl.envs 
-00050c60: 696d 706f 7274 2047 796d 456e 760d 0a20  import GymEnv.. 
-00050c70: 2020 2020 2020 203e 3e3e 2066 726f 6d20         >>> from 
-00050c80: 746f 7263 6872 6c2e 656e 7673 2069 6d70  torchrl.envs imp
-00050c90: 6f72 7420 7365 745f 6779 6d5f 6261 636b  ort set_gym_back
-00050ca0: 656e 640d 0a20 2020 2020 2020 203e 3e3e  end..        >>>
-00050cb0: 2069 6d70 6f72 7420 746f 7263 680d 0a20   import torch.. 
-00050cc0: 2020 2020 2020 203e 3e3e 2074 6f72 6368         >>> torch
-00050cd0: 2e6d 616e 7561 6c5f 7365 6564 2830 290d  .manual_seed(0).
-00050ce0: 0a20 2020 2020 2020 203e 3e3e 0d0a 2020  .        >>>..  
-00050cf0: 2020 2020 2020 3e3e 3e20 636c 6173 7320        >>> class 
-00050d00: 4175 746f 5265 7365 7474 696e 6747 796d  AutoResettingGym
-00050d10: 456e 7628 4779 6d45 6e76 293a 0d0a 2020  Env(GymEnv):..  
-00050d20: 2020 2020 2020 2e2e 2e20 2020 2020 6465        ...     de
-00050d30: 6620 5f73 7465 7028 7365 6c66 2c20 7465  f _step(self, te
-00050d40: 6e73 6f72 6469 6374 293a 0d0a 2020 2020  nsordict):..    
-00050d50: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-00050d60: 7465 6e73 6f72 6469 6374 203d 2073 7570  tensordict = sup
-00050d70: 6572 2829 2e5f 7374 6570 2874 656e 736f  er()._step(tenso
-00050d80: 7264 6963 7429 0d0a 2020 2020 2020 2020  rdict)..        
-00050d90: 2e2e 2e20 2020 2020 2020 2020 6966 2074  ...         if t
-00050da0: 656e 736f 7264 6963 745b 2264 6f6e 6522  ensordict["done"
-00050db0: 5d2e 616e 7928 293a 0d0a 2020 2020 2020  ].any():..      
-00050dc0: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
-00050dd0: 2020 7464 5f72 6573 6574 203d 2073 7570    td_reset = sup
-00050de0: 6572 2829 2e72 6573 6574 2829 0d0a 2020  er().reset()..  
-00050df0: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
-00050e00: 2020 2020 2020 7465 6e73 6f72 6469 6374        tensordict
-00050e10: 2e75 7064 6174 6528 7464 5f72 6573 6574  .update(td_reset
-00050e20: 2e65 7863 6c75 6465 282a 7365 6c66 2e64  .exclude(*self.d
-00050e30: 6f6e 655f 6b65 7973 2929 0d0a 2020 2020  one_keys))..    
-00050e40: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-00050e50: 7265 7475 726e 2074 656e 736f 7264 6963  return tensordic
-00050e60: 740d 0a20 2020 2020 2020 202e 2e2e 0d0a  t..        .....
-00050e70: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00050e80: 6465 6620 5f72 6573 6574 2873 656c 662c  def _reset(self,
-00050e90: 2074 656e 736f 7264 6963 743d 4e6f 6e65   tensordict=None
-00050ea0: 293a 0d0a 2020 2020 2020 2020 2e2e 2e20  ):..        ... 
-00050eb0: 2020 2020 2020 2020 6966 2074 656e 736f          if tenso
-00050ec0: 7264 6963 7420 6973 206e 6f74 204e 6f6e  rdict is not Non
-00050ed0: 6520 616e 6420 225f 7265 7365 7422 2069  e and "_reset" i
-00050ee0: 6e20 7465 6e73 6f72 6469 6374 3a0d 0a20  n tensordict:.. 
-00050ef0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-00050f00: 2020 2020 2020 2072 6574 7572 6e20 7465         return te
-00050f10: 6e73 6f72 6469 6374 2e63 6f70 7928 290d  nsordict.copy().
-00050f20: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-00050f30: 2020 2020 2072 6574 7572 6e20 7375 7065       return supe
-00050f40: 7228 292e 5f72 6573 6574 2874 656e 736f  r()._reset(tenso
-00050f50: 7264 6963 7429 0d0a 2020 2020 2020 2020  rdict)..        
-00050f60: 3e3e 3e0d 0a20 2020 2020 2020 203e 3e3e  >>>..        >>>
-00050f70: 2077 6974 6820 7365 745f 6779 6d5f 6261   with set_gym_ba
-00050f80: 636b 656e 6428 2267 796d 2229 3a0d 0a20  ckend("gym"):.. 
-00050f90: 2020 2020 2020 202e 2e2e 2020 2020 2065         ...     e
-00050fa0: 6e76 203d 2041 7574 6f52 6573 6574 7469  nv = AutoResetti
-00050fb0: 6e67 4779 6d45 6e76 2822 4361 7274 506f  ngGymEnv("CartPo
-00050fc0: 6c65 2d76 3122 2c20 6175 746f 5f72 6573  le-v1", auto_res
-00050fd0: 6574 3d54 7275 652c 2061 7574 6f5f 7265  et=True, auto_re
-00050fe0: 7365 745f 7265 706c 6163 653d 5472 7565  set_replace=True
-00050ff0: 290d 0a20 2020 2020 2020 202e 2e2e 2020  )..        ...  
-00051000: 2020 2065 6e76 2e73 6574 5f73 6565 6428     env.set_seed(
-00051010: 3029 0d0a 2020 2020 2020 2020 2e2e 2e20  0)..        ... 
-00051020: 2020 2020 7220 3d20 656e 762e 726f 6c6c      r = env.roll
-00051030: 6f75 7428 3330 2c20 6272 6561 6b5f 7768  out(30, break_wh
-00051040: 656e 5f61 6e79 5f64 6f6e 653d 4661 6c73  en_any_done=Fals
-00051050: 6529 0d0a 2020 2020 2020 2020 3e3e 3e20  e)..        >>> 
-00051060: 7072 696e 7428 725b 226e 6578 7422 2c20  print(r["next", 
-00051070: 2264 6f6e 6522 5d2e 7371 7565 657a 6528  "done"].squeeze(
-00051080: 2929 0d0a 2020 2020 2020 2020 7465 6e73  ))..        tens
-00051090: 6f72 285b 4661 6c73 652c 2046 616c 7365  or([False, False
-000510a0: 2c20 4661 6c73 652c 2046 616c 7365 2c20  , False, False, 
-000510b0: 4661 6c73 652c 2046 616c 7365 2c20 4661  False, False, Fa
-000510c0: 6c73 652c 2046 616c 7365 2c20 4661 6c73  lse, False, Fals
-000510d0: 652c 2046 616c 7365 2c0d 0a20 2020 2020  e, False,..     
-000510e0: 2020 2020 2020 2020 2020 2046 616c 7365             False
-000510f0: 2c20 4661 6c73 652c 2046 616c 7365 2c20  , False, False, 
-00051100: 2054 7275 652c 2046 616c 7365 2c20 4661   True, False, Fa
-00051110: 6c73 652c 2046 616c 7365 2c20 4661 6c73  lse, False, Fals
-00051120: 652c 2046 616c 7365 2c20 4661 6c73 652c  e, False, False,
-00051130: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00051140: 2020 4661 6c73 652c 2046 616c 7365 2c20    False, False, 
-00051150: 4661 6c73 652c 2046 616c 7365 2c20 4661  False, False, Fa
-00051160: 6c73 652c 2020 5472 7565 2c20 4661 6c73  lse,  True, Fals
-00051170: 652c 2046 616c 7365 2c20 4661 6c73 652c  e, False, False,
-00051180: 2046 616c 7365 5d29 0d0a 2020 2020 2020   False])..      
-00051190: 2020 3e3e 3e20 7072 696e 7428 226f 6273    >>> print("obs
-000511a0: 6572 7661 7469 6f6e 2061 6674 6572 2072  ervation after r
-000511b0: 6573 6574 2061 7265 2073 6574 2061 7320  eset are set as 
-000511c0: 6e61 6e22 2c20 725b 226e 6578 7422 2c20  nan", r["next", 
-000511d0: 226f 6273 6572 7661 7469 6f6e 225d 290d  "observation"]).
-000511e0: 0a20 2020 2020 2020 206f 6273 6572 7661  .        observa
-000511f0: 7469 6f6e 2061 6674 6572 2072 6573 6574  tion after reset
-00051200: 2061 7265 2073 6574 2061 7320 6e61 6e20   are set as nan 
-00051210: 7465 6e73 6f72 285b 5b2d 342e 3336 3333  tensor([[-4.3633
-00051220: 652d 3032 2c20 2d31 2e34 3837 3765 2d30  e-02, -1.4877e-0
-00051230: 312c 2020 312e 3238 3439 652d 3032 2c20  1,  1.2849e-02, 
-00051240: 2032 2e37 3538 3465 2d30 315d 2c0d 0a20   2.7584e-01],.. 
-00051250: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00051260: 2d34 2e36 3630 3965 2d30 322c 2020 342e  -4.6609e-02,  4.
-00051270: 3631 3636 652d 3032 2c20 2031 2e38 3336  6166e-02,  1.836
-00051280: 3665 2d30 322c 202d 312e 3237 3631 652d  6e-02, -1.2761e-
-00051290: 3032 5d2c 0d0a 2020 2020 2020 2020 2020  02],..          
-000512a0: 2020 2020 2020 5b2d 342e 3536 3835 652d        [-4.5685e-
-000512b0: 3032 2c20 2032 2e34 3130 3265 2d30 312c  02,  2.4102e-01,
-000512c0: 2020 312e 3831 3131 652d 3032 2c20 2d32    1.8111e-02, -2
-000512d0: 2e39 3935 3965 2d30 315d 2c0d 0a20 2020  .9959e-01],..   
-000512e0: 2020 2020 2020 2020 2020 2020 205b 2d34               [-4
-000512f0: 2e30 3836 3565 2d30 322c 2020 342e 3536  .0865e-02,  4.56
-00051300: 3434 652d 3032 2c20 2031 2e32 3131 3965  44e-02,  1.2119e
-00051310: 2d30 322c 202d 312e 3235 3432 652d 3033  -02, -1.2542e-03
-00051320: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00051330: 2020 2020 5b2d 332e 3939 3532 652d 3032      [-3.9952e-02
-00051340: 2c20 2032 2e34 3035 3965 2d30 312c 2020  ,  2.4059e-01,  
-00051350: 312e 3230 3934 652d 3032 2c20 2d32 2e39  1.2094e-02, -2.9
-00051360: 3030 3965 2d30 315d 2c0d 0a20 2020 2020  009e-01],..     
-00051370: 2020 2020 2020 2020 2020 205b 2d33 2e35             [-3.5
-00051380: 3134 3065 2d30 322c 2020 342e 3335 3534  140e-02,  4.3554
-00051390: 652d 3031 2c20 2036 2e32 3932 3065 2d30  e-01,  6.2920e-0
-000513a0: 332c 202d 352e 3738 3933 652d 3031 5d2c  3, -5.7893e-01],
-000513b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000513c0: 2020 5b2d 322e 3634 3239 652d 3032 2c20    [-2.6429e-02, 
-000513d0: 2036 2e33 3035 3765 2d30 312c 202d 352e   6.3057e-01, -5.
-000513e0: 3238 3637 652d 3033 2c20 2d38 2e36 3936  2867e-03, -8.696
-000513f0: 3365 2d30 315d 2c0d 0a20 2020 2020 2020  3e-01],..       
-00051400: 2020 2020 2020 2020 205b 2d31 2e33 3831           [-1.381
-00051410: 3865 2d30 322c 2020 382e 3235 3736 652d  8e-02,  8.2576e-
-00051420: 3031 2c20 2d32 2e32 3637 3965 2d30 322c  01, -2.2679e-02,
-00051430: 202d 312e 3136 3430 652b 3030 5d2c 0d0a   -1.1640e+00],..
-00051440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051450: 5b20 322e 3639 3732 652d 3033 2c20 2031  [ 2.6972e-03,  1
-00051460: 2e30 3231 3265 2b30 302c 202d 342e 3539  .0212e+00, -4.59
-00051470: 3539 652d 3032 2c20 2d31 2e34 3633 3765  59e-02, -1.4637e
-00051480: 2b30 305d 2c0d 0a20 2020 2020 2020 2020  +00],..         
-00051490: 2020 2020 2020 205b 2032 2e33 3132 3165         [ 2.3121e
-000514a0: 2d30 322c 2020 312e 3231 3638 652b 3030  -02,  1.2168e+00
-000514b0: 2c20 2d37 2e35 3233 3265 2d30 322c 202d  , -7.5232e-02, -
-000514c0: 312e 3737 3034 652b 3030 5d2c 0d0a 2020  1.7704e+00],..  
-000514d0: 2020 2020 2020 2020 2020 2020 2020 5b20                [ 
-000514e0: 342e 3734 3537 652d 3032 2c20 2031 2e34  4.7457e-02,  1.4
-000514f0: 3132 3765 2b30 302c 202d 312e 3130 3634  127e+00, -1.1064
-00051500: 652d 3031 2c20 2d32 2e30 3835 3465 2b30  e-01, -2.0854e+0
-00051510: 305d 2c0d 0a20 2020 2020 2020 2020 2020  0],..           
-00051520: 2020 2020 205b 2037 2e35 3731 3265 2d30       [ 7.5712e-0
-00051530: 322c 2020 312e 3231 3839 652b 3030 2c20  2,  1.2189e+00, 
-00051540: 2d31 2e35 3233 3565 2d30 312c 202d 312e  -1.5235e-01, -1.
-00051550: 3832 3839 652b 3030 5d2c 0d0a 2020 2020  8289e+00],..    
-00051560: 2020 2020 2020 2020 2020 2020 5b20 312e              [ 1.
-00051570: 3030 3039 652d 3031 2c20 2031 2e30 3235  0009e-01,  1.025
-00051580: 3765 2b30 302c 202d 312e 3838 3933 652d  7e+00, -1.8893e-
-00051590: 3031 2c20 2d31 2e35 3837 3265 2b30 305d  01, -1.5872e+00]
-000515a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000515b0: 2020 205b 2020 2020 2020 2020 6e61 6e2c     [        nan,
-000515c0: 2020 2020 2020 2020 206e 616e 2c20 2020           nan,   
-000515d0: 2020 2020 2020 6e61 6e2c 2020 2020 2020        nan,      
-000515e0: 2020 206e 616e 5d2c 0d0a 2020 2020 2020     nan],..      
-000515f0: 2020 2020 2020 2020 2020 5b2d 332e 3934            [-3.94
-00051600: 3035 652d 3032 2c20 2d31 2e37 3736 3665  05e-02, -1.7766e
-00051610: 2d30 312c 202d 312e 3034 3033 652d 3032  -01, -1.0403e-02
-00051620: 2c20 2033 2e30 3632 3665 2d30 315d 2c0d  ,  3.0626e-01],.
-00051630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051640: 205b 2d34 2e32 3935 3965 2d30 322c 202d   [-4.2959e-02, -
-00051650: 332e 3732 3633 652d 3031 2c20 2d34 2e32  3.7263e-01, -4.2
-00051660: 3737 3565 2d30 332c 2020 352e 3935 3634  775e-03,  5.9564
-00051670: 652d 3031 5d2c 0d0a 2020 2020 2020 2020  e-01],..        
-00051680: 2020 2020 2020 2020 5b2d 352e 3034 3131          [-5.0411
-00051690: 652d 3032 2c20 2d35 2e36 3736 3965 2d30  e-02, -5.6769e-0
-000516a0: 312c 2020 372e 3633 3534 652d 3033 2c20  1,  7.6354e-03, 
-000516b0: 2038 2e38 3639 3865 2d30 315d 2c0d 0a20   8.8698e-01],.. 
-000516c0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-000516d0: 2d36 2e31 3736 3565 2d30 322c 202d 372e  -6.1765e-02, -7.
-000516e0: 3632 3932 652d 3031 2c20 2032 2e35 3337  6292e-01,  2.537
-000516f0: 3565 2d30 322c 2020 312e 3138 3230 652b  5e-02,  1.1820e+
-00051700: 3030 5d2c 0d0a 2020 2020 2020 2020 2020  00],..          
-00051710: 2020 2020 2020 5b2d 372e 3730 3233 652d        [-7.7023e-
-00051720: 3032 2c20 2d39 2e35 3833 3665 2d30 312c  02, -9.5836e-01,
-00051730: 2020 342e 3930 3136 652d 3032 2c20 2031    4.9016e-02,  1
-00051740: 2e34 3832 3665 2b30 305d 2c0d 0a20 2020  .4826e+00],..   
-00051750: 2020 2020 2020 2020 2020 2020 205b 2d39               [-9
-00051760: 2e36 3139 3165 2d30 322c 202d 372e 3633  .6191e-02, -7.63
-00051770: 3837 652d 3031 2c20 2037 2e38 3636 3765  87e-01,  7.8667e
-00051780: 2d30 322c 2020 312e 3230 3536 652b 3030  -02,  1.2056e+00
-00051790: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-000517a0: 2020 2020 5b2d 312e 3131 3437 652d 3031      [-1.1147e-01
-000517b0: 2c20 2d39 2e35 3939 3165 2d30 312c 2020  , -9.5991e-01,  
-000517c0: 312e 3032 3738 652d 3031 2c20 2031 2e35  1.0278e-01,  1.5
-000517d0: 3231 3965 2b30 305d 2c0d 0a20 2020 2020  219e+00],..     
-000517e0: 2020 2020 2020 2020 2020 205b 2d31 2e33             [-1.3
-000517f0: 3036 3765 2d30 312c 202d 372e 3636 3137  067e-01, -7.6617
-00051800: 652d 3031 2c20 2031 2e33 3332 3265 2d30  e-01,  1.3322e-0
-00051810: 312c 2020 312e 3236 3239 652b 3030 5d2c  1,  1.2629e+00],
-00051820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00051830: 2020 5b2d 312e 3435 3939 652d 3031 2c20    [-1.4599e-01, 
-00051840: 2d35 2e37 3239 3865 2d30 312c 2020 312e  -5.7298e-01,  1.
-00051850: 3538 3438 652d 3031 2c20 2031 2e30 3134  5848e-01,  1.014
-00051860: 3865 2b30 305d 2c0d 0a20 2020 2020 2020  8e+00],..       
-00051870: 2020 2020 2020 2020 205b 2d31 2e35 3734           [-1.574
-00051880: 3565 2d30 312c 202d 372e 3639 3832 652d  5e-01, -7.6982e-
-00051890: 3031 2c20 2031 2e37 3837 3765 2d30 312c  01,  1.7877e-01,
-000518a0: 2020 312e 3335 3237 652b 3030 5d2c 0d0a    1.3527e+00],..
-000518b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000518c0: 5b2d 312e 3732 3835 652d 3031 2c20 2d39  [-1.7285e-01, -9
-000518d0: 2e36 3636 3865 2d30 312c 2020 322e 3035  .6668e-01,  2.05
-000518e0: 3833 652d 3031 2c20 2031 2e36 3935 3665  83e-01,  1.6956e
-000518f0: 2b30 305d 2c0d 0a20 2020 2020 2020 2020  +00],..         
-00051900: 2020 2020 2020 205b 2020 2020 2020 2020         [        
-00051910: 6e61 6e2c 2020 2020 2020 2020 206e 616e  nan,         nan
-00051920: 2c20 2020 2020 2020 2020 6e61 6e2c 2020  ,         nan,  
-00051930: 2020 2020 2020 206e 616e 5d2c 0d0a 2020         nan],..  
-00051940: 2020 2020 2020 2020 2020 2020 2020 5b2d                [-
-00051950: 342e 3339 3632 652d 3032 2c20 2031 2e39  4.3962e-02,  1.9
-00051960: 3834 3565 2d30 312c 202d 342e 3530 3135  845e-01, -4.5015
-00051970: 652d 3032 2c20 2d32 2e35 3930 3365 2d30  e-02, -2.5903e-0
-00051980: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
-00051990: 2020 2020 205b 2d33 2e39 3939 3365 2d30       [-3.9993e-0
-000519a0: 322c 2020 332e 3934 3138 652d 3031 2c20  2,  3.9418e-01, 
-000519b0: 2d35 2e30 3139 3665 2d30 322c 202d 352e  -5.0196e-02, -5.
-000519c0: 3635 3537 652d 3031 5d2c 0d0a 2020 2020  6557e-01],..    
-000519d0: 2020 2020 2020 2020 2020 2020 5b2d 332e              [-3.
-000519e0: 3231 3039 652d 3032 2c20 2035 2e38 3939  2109e-02,  5.899
-000519f0: 3765 2d30 312c 202d 362e 3135 3037 652d  7e-01, -6.1507e-
-00051a00: 3032 2c20 2d38 2e37 3336 3365 2d30 315d  02, -8.7363e-01]
-00051a10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00051a20: 2020 205b 2d32 2e30 3331 3065 2d30 322c     [-2.0310e-02,
-00051a30: 2020 332e 3935 3734 652d 3031 2c20 2d37    3.9574e-01, -7
-00051a40: 2e38 3938 3065 2d30 322c 202d 362e 3030  .8980e-02, -6.00
-00051a50: 3930 652d 3031 5d5d 290d 0a0d 0a20 2020  90e-01]])....   
-00051a60: 2022 2222 0d0a 0d0a 2020 2020 6465 6620   """....    def 
-00051a70: 5f5f 696e 6974 5f5f 280d 0a20 2020 2020  __init__(..     
-00051a80: 2020 2073 656c 662c 0d0a 2020 2020 2020     self,..      
-00051a90: 2020 2a2c 0d0a 2020 2020 2020 2020 7265    *,..        re
-00051aa0: 706c 6163 653a 2062 6f6f 6c20 7c20 4e6f  place: bool | No
-00051ab0: 6e65 203d 204e 6f6e 652c 0d0a 2020 2020  ne = None,..    
-00051ac0: 2020 2020 6669 6c6c 5f66 6c6f 6174 3d22      fill_float="
-00051ad0: 6e61 6e22 2c0d 0a20 2020 2020 2020 2066  nan",..        f
-00051ae0: 696c 6c5f 696e 743d 2d31 2c0d 0a20 2020  ill_int=-1,..   
-00051af0: 2020 2020 2066 696c 6c5f 626f 6f6c 3d46       fill_bool=F
-00051b00: 616c 7365 2c0d 0a20 2020 2029 3a0d 0a20  alse,..    ):.. 
-00051b10: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00051b20: 5f69 6e69 745f 5f28 290d 0a20 2020 2020  _init__()..     
-00051b30: 2020 2069 6620 7265 706c 6163 6520 6973     if replace is
-00051b40: 2046 616c 7365 3a0d 0a20 2020 2020 2020   False:..       
-00051b50: 2020 2020 2066 696c 6c5f 666c 6f61 7420       fill_float 
-00051b60: 3d20 6669 6c6c 5f69 6e74 203d 2066 696c  = fill_int = fil
-00051b70: 6c5f 626f 6f6c 203d 204e 6f6e 650d 0a20  l_bool = None.. 
-00051b80: 2020 2020 2020 2069 6620 6669 6c6c 5f66         if fill_f
-00051b90: 6c6f 6174 203d 3d20 226e 616e 223a 0d0a  loat == "nan":..
-00051ba0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-00051bb0: 5f66 6c6f 6174 203d 2066 6c6f 6174 2822  _float = float("
-00051bc0: 6e61 6e22 290d 0a20 2020 2020 2020 2073  nan")..        s
-00051bd0: 656c 662e 6669 6c6c 5f66 6c6f 6174 203d  elf.fill_float =
-00051be0: 2066 696c 6c5f 666c 6f61 740d 0a20 2020   fill_float..   
-00051bf0: 2020 2020 2073 656c 662e 6669 6c6c 5f69       self.fill_i
-00051c00: 6e74 203d 2066 696c 6c5f 696e 740d 0a20  nt = fill_int.. 
-00051c10: 2020 2020 2020 2073 656c 662e 6669 6c6c         self.fill
-00051c20: 5f62 6f6f 6c20 3d20 6669 6c6c 5f62 6f6f  _bool = fill_boo
-00051c30: 6c0d 0a20 2020 2020 2020 2073 656c 662e  l..        self.
-00051c40: 5f76 616c 6964 6174 6564 203d 2046 616c  _validated = Fal
-00051c50: 7365 0d0a 0d0a 2020 2020 6465 6620 5f76  se....    def _v
-00051c60: 616c 6964 6174 655f 636f 6e74 6169 6e65  alidate_containe
-00051c70: 7228 7365 6c66 293a 0d0a 2020 2020 2020  r(self):..      
-00051c80: 2020 6966 2073 656c 662e 5f76 616c 6964    if self._valid
-00051c90: 6174 6564 3a0d 0a20 2020 2020 2020 2020  ated:..         
-00051ca0: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
-00051cb0: 2020 2069 6620 7479 7065 2873 656c 662e     if type(self.
-00051cc0: 636f 6e74 6169 6e65 7229 2069 7320 6e6f  container) is no
-00051cd0: 7420 4175 746f 5265 7365 7445 6e76 3a0d  t AutoResetEnv:.
-00051ce0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00051cf0: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
-00051d00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00051d10: 2020 6622 5468 6520 7b73 656c 662e 5f5f    f"The {self.__
-00051d20: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00051d30: 7d20 636f 6e74 6169 6e65 7220 6d75 7374  } container must
-00051d40: 2062 6520 6f66 2074 7970 6520 4175 746f   be of type Auto
-00051d50: 5265 7365 7445 6e76 2e22 0d0a 2020 2020  ResetEnv."..    
-00051d60: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00051d70: 2020 2073 656c 662e 5f76 616c 6964 6174     self._validat
-00051d80: 6564 203d 2054 7275 650d 0a0d 0a20 2020  ed = True....   
-00051d90: 2064 6566 205f 7265 7365 7428 0d0a 2020   def _reset(..  
-00051da0: 2020 2020 2020 7365 6c66 2c20 7465 6e73        self, tens
-00051db0: 6f72 6469 6374 3a20 5465 6e73 6f72 4469  ordict: TensorDi
-00051dc0: 6374 4261 7365 2c20 7465 6e73 6f72 6469  ctBase, tensordi
-00051dd0: 6374 5f72 6573 6574 3a20 5465 6e73 6f72  ct_reset: Tensor
-00051de0: 4469 6374 4261 7365 0d0a 2020 2020 2920  DictBase..    ) 
-00051df0: 2d3e 2054 656e 736f 7244 6963 7442 6173  -> TensorDictBas
-00051e00: 653a 0d0a 2020 2020 2020 2020 7365 6c66  e:..        self
-00051e10: 2e5f 7661 6c69 6461 7465 5f63 6f6e 7461  ._validate_conta
-00051e20: 696e 6572 2829 0d0a 2020 2020 2020 2020  iner()..        
-00051e30: 7265 7475 726e 2073 656c 662e 5f72 6570  return self._rep
-00051e40: 6c61 6365 5f61 7574 6f5f 7265 7365 745f  lace_auto_reset_
-00051e50: 7661 6c73 2874 656e 736f 7264 6963 745f  vals(tensordict_
-00051e60: 7265 7365 743d 7465 6e73 6f72 6469 6374  reset=tensordict
-00051e70: 5f72 6573 6574 290d 0a0d 0a20 2020 2064  _reset)....    d
-00051e80: 6566 205f 7374 6570 280d 0a20 2020 2020  ef _step(..     
-00051e90: 2020 2073 656c 662c 2074 656e 736f 7264     self, tensord
-00051ea0: 6963 743a 2054 656e 736f 7244 6963 7442  ict: TensorDictB
-00051eb0: 6173 652c 206e 6578 745f 7465 6e73 6f72  ase, next_tensor
-00051ec0: 6469 6374 3a20 5465 6e73 6f72 4469 6374  dict: TensorDict
-00051ed0: 4261 7365 0d0a 2020 2020 2920 2d3e 2054  Base..    ) -> T
-00051ee0: 656e 736f 7244 6963 7442 6173 653a 0d0a  ensorDictBase:..
-00051ef0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00051f00: 656c 662e 5f63 6f72 7265 6374 5f61 7574  elf._correct_aut
-00051f10: 6f5f 7265 7365 745f 7661 6c73 286e 6578  o_reset_vals(nex
-00051f20: 745f 7465 6e73 6f72 6469 6374 290d 0a0d  t_tensordict)...
-00051f30: 0a20 2020 2064 6566 2066 6f72 7761 7264  .    def forward
-00051f40: 2873 656c 662c 2074 656e 736f 7264 6963  (self, tensordic
-00051f50: 743a 2054 656e 736f 7244 6963 7442 6173  t: TensorDictBas
-00051f60: 6529 202d 3e20 5465 6e73 6f72 4469 6374  e) -> TensorDict
-00051f70: 4261 7365 3a0d 0a20 2020 2020 2020 2072  Base:..        r
-00051f80: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
-00051f90: 720d 0a0d 0a20 2020 2040 7072 6f70 6572  r....    @proper
-00051fa0: 7479 0d0a 2020 2020 6465 6620 5f73 696d  ty..    def _sim
-00051fb0: 706c 655f 646f 6e65 2873 656c 6629 3a0d  ple_done(self):.
-00051fc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00051fd0: 7365 6c66 2e70 6172 656e 742e 5f73 696d  self.parent._sim
-00051fe0: 706c 655f 646f 6e65 0d0a 0d0a 2020 2020  ple_done....    
-00051ff0: 6465 6620 5f63 6f72 7265 6374 5f61 7574  def _correct_aut
-00052000: 6f5f 7265 7365 745f 7661 6c73 2873 656c  o_reset_vals(sel
-00052010: 662c 2074 656e 736f 7264 6963 7429 3a0d  f, tensordict):.
-00052020: 0a20 2020 2020 2020 2023 2077 6520 6e65  .        # we ne
-00052030: 6564 2074 6f20 6d6f 7665 2074 6865 2064  ed to move the d
-00052040: 6174 6120 6672 6f6d 2074 656e 736f 7264  ata from tensord
-00052050: 6963 7420 746f 2074 656e 736f 7264 6963  ict to tensordic
-00052060: 745f 0d0a 2020 2020 2020 2020 6465 6620  t_..        def 
-00052070: 7265 706c 6163 655f 616e 645f 7365 7428  replace_and_set(
-00052080: 6b65 792c 2076 616c 2c20 6d61 736b 2c20  key, val, mask, 
-00052090: 7361 7665 645f 7464 5f61 7574 6f72 6573  saved_td_autores
-000520a0: 6574 2c20 6167 656e 743d 7465 6e73 6f72  et, agent=tensor
-000520b0: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
-000520c0: 2020 2020 7361 7665 645f 7464 5f61 7574      saved_td_aut
-000520d0: 6f72 6573 6574 2e73 6574 286b 6579 2c20  oreset.set(key, 
-000520e0: 7661 6c29 0d0a 2020 2020 2020 2020 2020  val)..          
-000520f0: 2020 6966 2076 616c 2e64 7479 7065 2e69    if val.dtype.i
-00052100: 735f 666c 6f61 7469 6e67 5f70 6f69 6e74  s_floating_point
-00052110: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00052120: 2020 2069 6620 7365 6c66 2e66 696c 6c5f     if self.fill_
-00052130: 666c 6f61 7420 6973 204e 6f6e 653a 0d0a  float is None:..
-00052140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052150: 2020 2020 7661 6c5f 7365 745f 6e61 6e20      val_set_nan 
-00052160: 3d20 7661 6c2e 636c 6f6e 6528 290d 0a20  = val.clone().. 
-00052170: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00052180: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00052190: 2020 2020 2020 2020 2020 7661 6c5f 7365            val_se
-000521a0: 745f 6e61 6e20 3d20 746f 7263 682e 7768  t_nan = torch.wh
-000521b0: 6572 6528 0d0a 2020 2020 2020 2020 2020  ere(..          
-000521c0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-000521d0: 7061 6e64 5f61 735f 7269 6768 7428 6d61  pand_as_right(ma
-000521e0: 736b 2c20 7661 6c29 2c0d 0a20 2020 2020  sk, val),..     
-000521f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052200: 2020 2074 6f72 6368 2e66 756c 6c5f 6c69     torch.full_li
-00052210: 6b65 2876 616c 2c20 7365 6c66 2e66 696c  ke(val, self.fil
-00052220: 6c5f 666c 6f61 7429 2c0d 0a20 2020 2020  l_float),..     
-00052230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052240: 2020 2076 616c 2c0d 0a20 2020 2020 2020     val,..       
-00052250: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00052260: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00052270: 2076 616c 2e64 7479 7065 2e69 735f 7369   val.dtype.is_si
-00052280: 676e 6564 3a0d 0a20 2020 2020 2020 2020  gned:..         
-00052290: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
-000522a0: 696c 6c5f 696e 7420 6973 204e 6f6e 653a  ill_int is None:
-000522b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000522c0: 2020 2020 2020 7661 6c5f 7365 745f 6e61        val_set_na
-000522d0: 6e20 3d20 7661 6c2e 636c 6f6e 6528 290d  n = val.clone().
-000522e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000522f0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00052300: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
-00052310: 7365 745f 6e61 6e20 3d20 746f 7263 682e  set_nan = torch.
-00052320: 7768 6572 6528 0d0a 2020 2020 2020 2020  where(..        
-00052330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052340: 6578 7061 6e64 5f61 735f 7269 6768 7428  expand_as_right(
-00052350: 6d61 736b 2c20 7661 6c29 2c0d 0a20 2020  mask, val),..   
-00052360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052370: 2020 2020 2074 6f72 6368 2e66 756c 6c5f       torch.full_
-00052380: 6c69 6b65 2876 616c 2c20 7365 6c66 2e66  like(val, self.f
-00052390: 696c 6c5f 696e 7429 2c0d 0a20 2020 2020  ill_int),..     
-000523a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000523b0: 2020 2076 616c 2c0d 0a20 2020 2020 2020     val,..       
-000523c0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-000523d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000523e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000523f0: 2020 2069 6620 7365 6c66 2e66 696c 6c5f     if self.fill_
-00052400: 626f 6f6c 2069 7320 4e6f 6e65 3a0d 0a20  bool is None:.. 
-00052410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052420: 2020 2076 616c 5f73 6574 5f6e 616e 203d     val_set_nan =
-00052430: 2076 616c 2e63 6c6f 6e65 2829 0d0a 2020   val.clone()..  
-00052440: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00052450: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00052460: 2020 2020 2020 2020 2076 616c 5f73 6574           val_set
-00052470: 5f6e 616e 203d 2074 6f72 6368 2e77 6865  _nan = torch.whe
-00052480: 7265 280d 0a20 2020 2020 2020 2020 2020  re(..           
-00052490: 2020 2020 2020 2020 2020 2020 2065 7870               exp
-000524a0: 616e 645f 6173 5f72 6967 6874 286d 6173  and_as_right(mas
-000524b0: 6b2c 2076 616c 292c 0d0a 2020 2020 2020  k, val),..      
+0004af30: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0004af40: 7669 6365 3d63 7075 2c0d 0a20 2020 2020  vice=cpu,..     
+0004af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004af60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004af70: 735f 7368 6172 6564 3d46 616c 7365 297d  s_shared=False)}
+0004af80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004af90: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0004afa0: 6174 6368 5f73 697a 653d 746f 7263 682e  atch_size=torch.
+0004afb0: 5369 7a65 285b 325d 292c 0d0a 2020 2020  Size([2]),..    
+0004afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004afd0: 2020 2020 2020 2020 6465 7669 6365 3d63          device=c
+0004afe0: 7075 2c0d 0a20 2020 2020 2020 2020 2020  pu,..           
+0004aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b000: 2069 735f 7368 6172 6564 3d46 616c 7365   is_shared=False
+0004b010: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0004b020: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
+0004b030: 725f 7265 7761 7264 3a20 5465 6e73 6f72  r_reward: Tensor
+0004b040: 4469 6374 280d 0a20 2020 2020 2020 2020  Dict(..         
+0004b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b060: 2020 2066 6965 6c64 733d 7b0d 0a20 2020     fields={..   
+0004b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b080: 2020 2020 2020 2020 207d 2c0d 0a20 2020           },..   
+0004b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b0a0: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
+0004b0b0: 697a 653d 746f 7263 682e 5369 7a65 285b  ize=torch.Size([
+0004b0c0: 325d 292c 0d0a 2020 2020 2020 2020 2020  2]),..          
+0004b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b0e0: 2020 6465 7669 6365 3d63 7075 2c0d 0a20    device=cpu,.. 
+0004b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b100: 2020 2020 2020 2020 2020 2069 735f 7368             is_sh
+0004b110: 6172 6564 3d46 616c 7365 292c 0d0a 2020  ared=False),..  
+0004b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b130: 2020 2020 2020 7265 7761 7264 3a20 5465        reward: Te
+0004b140: 6e73 6f72 2873 6861 7065 3d74 6f72 6368  nsor(shape=torch
+0004b150: 2e53 697a 6528 5b32 2c20 315d 292c 2064  .Size([2, 1]), d
+0004b160: 6576 6963 653d 6370 752c 2064 7479 7065  evice=cpu, dtype
+0004b170: 3d74 6f72 6368 2e66 6c6f 6174 3332 2c20  =torch.float32, 
+0004b180: 6973 5f73 6861 7265 643d 4661 6c73 6529  is_shared=False)
+0004b190: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004b1a0: 2020 2020 2020 2020 2020 2074 6572 6d69             termi
+0004b1b0: 6e61 7465 643a 2054 656e 736f 7228 7368  nated: Tensor(sh
+0004b1c0: 6170 653d 746f 7263 682e 5369 7a65 285b  ape=torch.Size([
+0004b1d0: 322c 2031 5d29 2c20 6465 7669 6365 3d63  2, 1]), device=c
+0004b1e0: 7075 2c20 6474 7970 653d 746f 7263 682e  pu, dtype=torch.
+0004b1f0: 626f 6f6c 2c20 6973 5f73 6861 7265 643d  bool, is_shared=
+0004b200: 4661 6c73 6529 2c0d 0a20 2020 2020 2020  False),..       
+0004b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b220: 2074 7275 6e63 6174 6564 3a20 5465 6e73   truncated: Tens
+0004b230: 6f72 2873 6861 7065 3d74 6f72 6368 2e53  or(shape=torch.S
+0004b240: 697a 6528 5b32 2c20 315d 292c 2064 6576  ize([2, 1]), dev
+0004b250: 6963 653d 6370 752c 2064 7479 7065 3d74  ice=cpu, dtype=t
+0004b260: 6f72 6368 2e62 6f6f 6c2c 2069 735f 7368  orch.bool, is_sh
+0004b270: 6172 6564 3d46 616c 7365 297d 2c0d 0a20  ared=False)},.. 
+0004b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b290: 2020 2062 6174 6368 5f73 697a 653d 746f     batch_size=to
+0004b2a0: 7263 682e 5369 7a65 285b 325d 292c 0d0a  rch.Size([2]),..
+0004b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b2c0: 2020 2020 6465 7669 6365 3d63 7075 2c0d      device=cpu,.
+0004b2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b2e0: 2020 2020 2069 735f 7368 6172 6564 3d46       is_shared=F
+0004b2f0: 616c 7365 292c 0d0a 2020 2020 2020 2020  alse),..        
+0004b300: 2020 2020 2020 2020 6f62 7365 7276 6174          observat
+0004b310: 696f 6e3a 2054 656e 736f 7228 7368 6170  ion: Tensor(shap
+0004b320: 653d 746f 7263 682e 5369 7a65 285b 322c  e=torch.Size([2,
+0004b330: 2033 5d29 2c20 6465 7669 6365 3d63 7075   3]), device=cpu
+0004b340: 2c20 6474 7970 653d 746f 7263 682e 666c  , dtype=torch.fl
+0004b350: 6f61 7433 322c 2069 735f 7368 6172 6564  oat32, is_shared
+0004b360: 3d46 616c 7365 292c 0d0a 2020 2020 2020  =False),..      
+0004b370: 2020 2020 2020 2020 2020 7465 726d 696e            termin
+0004b380: 6174 6564 3a20 5465 6e73 6f72 2873 6861  ated: Tensor(sha
+0004b390: 7065 3d74 6f72 6368 2e53 697a 6528 5b32  pe=torch.Size([2
+0004b3a0: 2c20 315d 292c 2064 6576 6963 653d 6370  , 1]), device=cp
+0004b3b0: 752c 2064 7479 7065 3d74 6f72 6368 2e62  u, dtype=torch.b
+0004b3c0: 6f6f 6c2c 2069 735f 7368 6172 6564 3d46  ool, is_shared=F
+0004b3d0: 616c 7365 292c 0d0a 2020 2020 2020 2020  alse),..        
+0004b3e0: 2020 2020 2020 2020 7472 756e 6361 7465          truncate
+0004b3f0: 643a 2054 656e 736f 7228 7368 6170 653d  d: Tensor(shape=
+0004b400: 746f 7263 682e 5369 7a65 285b 322c 2031  torch.Size([2, 1
+0004b410: 5d29 2c20 6465 7669 6365 3d63 7075 2c20  ]), device=cpu, 
+0004b420: 6474 7970 653d 746f 7263 682e 626f 6f6c  dtype=torch.bool
+0004b430: 2c20 6973 5f73 6861 7265 643d 4661 6c73  , is_shared=Fals
+0004b440: 6529 7d2c 0d0a 2020 2020 2020 2020 2020  e)},..          
+0004b450: 2020 6261 7463 685f 7369 7a65 3d74 6f72    batch_size=tor
+0004b460: 6368 2e53 697a 6528 5b32 5d29 2c0d 0a20  ch.Size([2]),.. 
+0004b470: 2020 2020 2020 2020 2020 2064 6576 6963             devic
+0004b480: 653d 6370 752c 0d0a 2020 2020 2020 2020  e=cpu,..        
+0004b490: 2020 2020 6973 5f73 6861 7265 643d 4661      is_shared=Fa
+0004b4a0: 6c73 6529 0d0a 2020 2020 2020 2020 3e3e  lse)..        >>
+0004b4b0: 3e20 6368 6563 6b5f 656e 765f 7370 6563  > check_env_spec
+0004b4c0: 7328 6261 7365 5f65 6e76 290d 0a20 2020  s(base_env)..   
+0004b4d0: 2020 2020 203e 3e3e 2065 6e76 203d 2054       >>> env = T
+0004b4e0: 7261 6e73 666f 726d 6564 456e 7628 6261  ransformedEnv(ba
+0004b4f0: 7365 5f65 6e76 2c20 5265 6d6f 7665 456d  se_env, RemoveEm
+0004b500: 7074 7953 7065 6373 2829 290d 0a20 2020  ptySpecs())..   
+0004b510: 2020 2020 203e 3e3e 2070 7269 6e74 2865       >>> print(e
+0004b520: 6e76 2e72 6f6c 6c6f 7574 2832 2929 0d0a  nv.rollout(2))..
+0004b530: 2020 2020 2020 2020 5465 6e73 6f72 4469          TensorDi
+0004b540: 6374 280d 0a20 2020 2020 2020 2020 2020  ct(..           
+0004b550: 2066 6965 6c64 733d 7b0d 0a20 2020 2020   fields={..     
+0004b560: 2020 2020 2020 2020 2020 2061 6374 696f             actio
+0004b570: 6e3a 2054 656e 736f 7228 7368 6170 653d  n: Tensor(shape=
+0004b580: 746f 7263 682e 5369 7a65 285b 322c 2033  torch.Size([2, 3
+0004b590: 5d29 2c20 6465 7669 6365 3d63 7075 2c20  ]), device=cpu, 
+0004b5a0: 6474 7970 653d 746f 7263 682e 666c 6f61  dtype=torch.floa
+0004b5b0: 7433 322c 2069 735f 7368 6172 6564 3d46  t32, is_shared=F
+0004b5c0: 616c 7365 292c 0d0a 2020 2020 2020 2020  alse),..        
+0004b5d0: 2020 2020 2020 2020 646f 6e65 3a20 5465          done: Te
+0004b5e0: 6e73 6f72 2873 6861 7065 3d74 6f72 6368  nsor(shape=torch
+0004b5f0: 2e53 697a 6528 5b32 2c20 315d 292c 2064  .Size([2, 1]), d
+0004b600: 6576 6963 653d 6370 752c 2064 7479 7065  evice=cpu, dtype
+0004b610: 3d74 6f72 6368 2e62 6f6f 6c2c 2069 735f  =torch.bool, is_
+0004b620: 7368 6172 6564 3d46 616c 7365 292c 0d0a  shared=False),..
+0004b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b640: 6e65 7874 3a20 5465 6e73 6f72 4469 6374  next: TensorDict
+0004b650: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0004b660: 2020 2020 2020 2066 6965 6c64 733d 7b0d         fields={.
+0004b670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b680: 2020 2020 2020 2020 2064 6f6e 653a 2054           done: T
+0004b690: 656e 736f 7228 7368 6170 653d 746f 7263  ensor(shape=torc
+0004b6a0: 682e 5369 7a65 285b 322c 2031 5d29 2c20  h.Size([2, 1]), 
+0004b6b0: 6465 7669 6365 3d63 7075 2c20 6474 7970  device=cpu, dtyp
+0004b6c0: 653d 746f 7263 682e 626f 6f6c 2c20 6973  e=torch.bool, is
+0004b6d0: 5f73 6861 7265 643d 4661 6c73 6529 2c0d  _shared=False),.
+0004b6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b6f0: 2020 2020 2020 2020 206f 6273 6572 7661           observa
+0004b700: 7469 6f6e 3a20 5465 6e73 6f72 2873 6861  tion: Tensor(sha
+0004b710: 7065 3d74 6f72 6368 2e53 697a 6528 5b32  pe=torch.Size([2
+0004b720: 2c20 335d 292c 2064 6576 6963 653d 6370  , 3]), device=cp
+0004b730: 752c 2064 7479 7065 3d74 6f72 6368 2e66  u, dtype=torch.f
+0004b740: 6c6f 6174 3332 2c20 6973 5f73 6861 7265  loat32, is_share
+0004b750: 643d 4661 6c73 6529 2c0d 0a20 2020 2020  d=False),..     
+0004b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b770: 2020 2072 6577 6172 643a 2054 656e 736f     reward: Tenso
+0004b780: 7228 7368 6170 653d 746f 7263 682e 5369  r(shape=torch.Si
+0004b790: 7a65 285b 322c 2031 5d29 2c20 6465 7669  ze([2, 1]), devi
+0004b7a0: 6365 3d63 7075 2c20 6474 7970 653d 746f  ce=cpu, dtype=to
+0004b7b0: 7263 682e 666c 6f61 7433 322c 2069 735f  rch.float32, is_
+0004b7c0: 7368 6172 6564 3d46 616c 7365 292c 0d0a  shared=False),..
+0004b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b7e0: 2020 2020 2020 2020 7465 726d 696e 6174          terminat
+0004b7f0: 6564 3a20 5465 6e73 6f72 2873 6861 7065  ed: Tensor(shape
+0004b800: 3d74 6f72 6368 2e53 697a 6528 5b32 2c20  =torch.Size([2, 
+0004b810: 315d 292c 2064 6576 6963 653d 6370 752c  1]), device=cpu,
+0004b820: 2064 7479 7065 3d74 6f72 6368 2e62 6f6f   dtype=torch.boo
+0004b830: 6c2c 2069 735f 7368 6172 6564 3d46 616c  l, is_shared=Fal
+0004b840: 7365 292c 0d0a 2020 2020 2020 2020 2020  se),..          
+0004b850: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0004b860: 756e 6361 7465 643a 2054 656e 736f 7228  uncated: Tensor(
+0004b870: 7368 6170 653d 746f 7263 682e 5369 7a65  shape=torch.Size
+0004b880: 285b 322c 2031 5d29 2c20 6465 7669 6365  ([2, 1]), device
+0004b890: 3d63 7075 2c20 6474 7970 653d 746f 7263  =cpu, dtype=torc
+0004b8a0: 682e 626f 6f6c 2c20 6973 5f73 6861 7265  h.bool, is_share
+0004b8b0: 643d 4661 6c73 6529 7d2c 0d0a 2020 2020  d=False)},..    
+0004b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b8d0: 6261 7463 685f 7369 7a65 3d74 6f72 6368  batch_size=torch
+0004b8e0: 2e53 697a 6528 5b32 5d29 2c0d 0a20 2020  .Size([2]),..   
+0004b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b900: 2064 6576 6963 653d 6370 752c 0d0a 2020   device=cpu,..  
+0004b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b920: 2020 6973 5f73 6861 7265 643d 4661 6c73    is_shared=Fals
+0004b930: 6529 2c0d 0a20 2020 2020 2020 2020 2020  e),..           
+0004b940: 2020 2020 206f 6273 6572 7661 7469 6f6e       observation
+0004b950: 3a20 5465 6e73 6f72 2873 6861 7065 3d74  : Tensor(shape=t
+0004b960: 6f72 6368 2e53 697a 6528 5b32 2c20 335d  orch.Size([2, 3]
+0004b970: 292c 2064 6576 6963 653d 6370 752c 2064  ), device=cpu, d
+0004b980: 7479 7065 3d74 6f72 6368 2e66 6c6f 6174  type=torch.float
+0004b990: 3332 2c20 6973 5f73 6861 7265 643d 4661  32, is_shared=Fa
+0004b9a0: 6c73 6529 2c0d 0a20 2020 2020 2020 2020  lse),..         
+0004b9b0: 2020 2020 2020 2074 6572 6d69 6e61 7465         terminate
+0004b9c0: 643a 2054 656e 736f 7228 7368 6170 653d  d: Tensor(shape=
+0004b9d0: 746f 7263 682e 5369 7a65 285b 322c 2031  torch.Size([2, 1
+0004b9e0: 5d29 2c20 6465 7669 6365 3d63 7075 2c20  ]), device=cpu, 
+0004b9f0: 6474 7970 653d 746f 7263 682e 626f 6f6c  dtype=torch.bool
+0004ba00: 2c20 6973 5f73 6861 7265 643d 4661 6c73  , is_shared=Fals
+0004ba10: 6529 2c0d 0a20 2020 2020 2020 2020 2020  e),..           
+0004ba20: 2020 2020 2074 7275 6e63 6174 6564 3a20       truncated: 
+0004ba30: 5465 6e73 6f72 2873 6861 7065 3d74 6f72  Tensor(shape=tor
+0004ba40: 6368 2e53 697a 6528 5b32 2c20 315d 292c  ch.Size([2, 1]),
+0004ba50: 2064 6576 6963 653d 6370 752c 2064 7479   device=cpu, dty
+0004ba60: 7065 3d74 6f72 6368 2e62 6f6f 6c2c 2069  pe=torch.bool, i
+0004ba70: 735f 7368 6172 6564 3d46 616c 7365 297d  s_shared=False)}
+0004ba80: 2c0d 0a20 2020 2020 2020 2020 2020 2062  ,..            b
+0004ba90: 6174 6368 5f73 697a 653d 746f 7263 682e  atch_size=torch.
+0004baa0: 5369 7a65 285b 325d 292c 0d0a 2020 2020  Size([2]),..    
+0004bab0: 2020 2020 2020 2020 6465 7669 6365 3d63          device=c
+0004bac0: 7075 2c0d 0a20 2020 2020 2020 2020 2020  pu,..           
+0004bad0: 2069 735f 7368 6172 6564 3d46 616c 7365   is_shared=False
+0004bae0: 290d 0a20 2020 2020 2020 2063 6865 636b  )..        check
+0004baf0: 5f65 6e76 5f73 7065 6373 2865 6e76 290d  _env_specs(env).
+0004bb00: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
+0004bb10: 5f68 6173 5f65 6d70 7479 5f69 6e70 7574  _has_empty_input
+0004bb20: 203d 2054 7275 650d 0a0d 0a20 2020 2040   = True....    @
+0004bb30: 7374 6174 6963 6d65 7468 6f64 0d0a 2020  staticmethod..  
+0004bb40: 2020 6465 6620 5f73 6f72 7465 7228 6b65    def _sorter(ke
+0004bb50: 795f 7661 6c29 3a0d 0a20 2020 2020 2020  y_val):..       
+0004bb60: 206b 6579 2c20 5f20 3d20 6b65 795f 7661   key, _ = key_va
+0004bb70: 6c0d 0a20 2020 2020 2020 2069 6620 6973  l..        if is
+0004bb80: 696e 7374 616e 6365 286b 6579 2c20 7374  instance(key, st
+0004bb90: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
+0004bba0: 2072 6574 7572 6e20 300d 0a20 2020 2020   return 0..     
+0004bbb0: 2020 2072 6574 7572 6e20 6c65 6e28 6b65     return len(ke
+0004bbc0: 7929 0d0a 0d0a 2020 2020 6465 6620 7472  y)....    def tr
+0004bbd0: 616e 7366 6f72 6d5f 6f75 7470 7574 5f73  ansform_output_s
+0004bbe0: 7065 6328 7365 6c66 2c20 6f75 7470 7574  pec(self, output
+0004bbf0: 5f73 7065 633a 2043 6f6d 706f 7369 7465  _spec: Composite
+0004bc00: 5370 6563 2920 2d3e 2043 6f6d 706f 7369  Spec) -> Composi
+0004bc10: 7465 5370 6563 3a0d 0a20 2020 2020 2020  teSpec:..       
+0004bc20: 2066 756c 6c5f 646f 6e65 5f73 7065 6320   full_done_spec 
+0004bc30: 3d20 6f75 7470 7574 5f73 7065 635b 2266  = output_spec["f
+0004bc40: 756c 6c5f 646f 6e65 5f73 7065 6322 5d0d  ull_done_spec"].
+0004bc50: 0a20 2020 2020 2020 2066 756c 6c5f 7265  .        full_re
+0004bc60: 7761 7264 5f73 7065 6320 3d20 6f75 7470  ward_spec = outp
+0004bc70: 7574 5f73 7065 635b 2266 756c 6c5f 7265  ut_spec["full_re
+0004bc80: 7761 7264 5f73 7065 6322 5d0d 0a20 2020  ward_spec"]..   
+0004bc90: 2020 2020 2066 756c 6c5f 6f62 7365 7276       full_observ
+0004bca0: 6174 696f 6e5f 7370 6563 203d 206f 7574  ation_spec = out
+0004bcb0: 7075 745f 7370 6563 5b22 6675 6c6c 5f6f  put_spec["full_o
+0004bcc0: 6273 6572 7661 7469 6f6e 5f73 7065 6322  bservation_spec"
+0004bcd0: 5d0d 0a20 2020 2020 2020 2023 2077 6520  ]..        # we 
+0004bce0: 7265 7665 7273 6520 7468 696e 6773 2074  reverse things t
+0004bcf0: 6f20 6d61 6b65 2073 7572 6520 7765 2064  o make sure we d
+0004bd00: 656c 6574 6520 7468 696e 6773 2066 726f  elete things fro
+0004bd10: 6d20 7468 6520 6261 636b 0d0a 2020 2020  m the back..    
+0004bd20: 2020 2020 666f 7220 6b65 792c 2073 7065      for key, spe
+0004bd30: 6320 696e 2073 6f72 7465 6428 0d0a 2020  c in sorted(..  
+0004bd40: 2020 2020 2020 2020 2020 6675 6c6c 5f64            full_d
+0004bd50: 6f6e 655f 7370 6563 2e69 7465 6d73 2854  one_spec.items(T
+0004bd60: 7275 6529 2c20 6b65 793d 7365 6c66 2e5f  rue), key=self._
+0004bd70: 736f 7274 6572 2c20 7265 7665 7273 653d  sorter, reverse=
+0004bd80: 5472 7565 0d0a 2020 2020 2020 2020 293a  True..        ):
+0004bd90: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0004bda0: 2069 7369 6e73 7461 6e63 6528 7370 6563   isinstance(spec
+0004bdb0: 2c20 436f 6d70 6f73 6974 6553 7065 6329  , CompositeSpec)
+0004bdc0: 2061 6e64 2073 7065 632e 6973 5f65 6d70   and spec.is_emp
+0004bdd0: 7479 2829 3a0d 0a20 2020 2020 2020 2020  ty():..         
+0004bde0: 2020 2020 2020 2064 656c 2066 756c 6c5f         del full_
+0004bdf0: 646f 6e65 5f73 7065 635b 6b65 795d 0d0a  done_spec[key]..
+0004be00: 0d0a 2020 2020 2020 2020 666f 7220 6b65  ..        for ke
+0004be10: 792c 2073 7065 6320 696e 2073 6f72 7465  y, spec in sorte
+0004be20: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
+0004be30: 6675 6c6c 5f6f 6273 6572 7661 7469 6f6e  full_observation
+0004be40: 5f73 7065 632e 6974 656d 7328 5472 7565  _spec.items(True
+0004be50: 292c 206b 6579 3d73 656c 662e 5f73 6f72  ), key=self._sor
+0004be60: 7465 722c 2072 6576 6572 7365 3d54 7275  ter, reverse=Tru
+0004be70: 650d 0a20 2020 2020 2020 2029 3a0d 0a20  e..        ):.. 
+0004be80: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0004be90: 696e 7374 616e 6365 2873 7065 632c 2043  instance(spec, C
+0004bea0: 6f6d 706f 7369 7465 5370 6563 2920 616e  ompositeSpec) an
+0004beb0: 6420 7370 6563 2e69 735f 656d 7074 7928  d spec.is_empty(
+0004bec0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0004bed0: 2020 2020 6465 6c20 6675 6c6c 5f6f 6273      del full_obs
+0004bee0: 6572 7661 7469 6f6e 5f73 7065 635b 6b65  ervation_spec[ke
+0004bef0: 795d 0d0a 0d0a 2020 2020 2020 2020 666f  y]....        fo
+0004bf00: 7220 6b65 792c 2073 7065 6320 696e 2073  r key, spec in s
+0004bf10: 6f72 7465 6428 0d0a 2020 2020 2020 2020  orted(..        
+0004bf20: 2020 2020 6675 6c6c 5f72 6577 6172 645f      full_reward_
+0004bf30: 7370 6563 2e69 7465 6d73 2854 7275 6529  spec.items(True)
+0004bf40: 2c20 6b65 793d 7365 6c66 2e5f 736f 7274  , key=self._sort
+0004bf50: 6572 2c20 7265 7665 7273 653d 5472 7565  er, reverse=True
+0004bf60: 0d0a 2020 2020 2020 2020 293a 0d0a 2020  ..        ):..  
+0004bf70: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0004bf80: 6e73 7461 6e63 6528 7370 6563 2c20 436f  nstance(spec, Co
+0004bf90: 6d70 6f73 6974 6553 7065 6329 2061 6e64  mpositeSpec) and
+0004bfa0: 2073 7065 632e 6973 5f65 6d70 7479 2829   spec.is_empty()
+0004bfb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004bfc0: 2020 2064 656c 2066 756c 6c5f 7265 7761     del full_rewa
+0004bfd0: 7264 5f73 7065 635b 6b65 795d 0d0a 2020  rd_spec[key]..  
+0004bfe0: 2020 2020 2020 7265 7475 726e 206f 7574        return out
+0004bff0: 7075 745f 7370 6563 0d0a 0d0a 2020 2020  put_spec....    
+0004c000: 6465 6620 7472 616e 7366 6f72 6d5f 696e  def transform_in
+0004c010: 7075 745f 7370 6563 2873 656c 662c 2069  put_spec(self, i
+0004c020: 6e70 7574 5f73 7065 633a 2054 656e 736f  nput_spec: Tenso
+0004c030: 7253 7065 6329 202d 3e20 5465 6e73 6f72  rSpec) -> Tensor
+0004c040: 5370 6563 3a0d 0a20 2020 2020 2020 2066  Spec:..        f
+0004c050: 756c 6c5f 6163 7469 6f6e 5f73 7065 6320  ull_action_spec 
+0004c060: 3d20 696e 7075 745f 7370 6563 5b22 6675  = input_spec["fu
+0004c070: 6c6c 5f61 6374 696f 6e5f 7370 6563 225d  ll_action_spec"]
+0004c080: 0d0a 2020 2020 2020 2020 6675 6c6c 5f73  ..        full_s
+0004c090: 7461 7465 5f73 7065 6320 3d20 696e 7075  tate_spec = inpu
+0004c0a0: 745f 7370 6563 5b22 6675 6c6c 5f73 7461  t_spec["full_sta
+0004c0b0: 7465 5f73 7065 6322 5d0d 0a20 2020 2020  te_spec"]..     
+0004c0c0: 2020 2023 2077 6520 7265 7665 7273 6520     # we reverse 
+0004c0d0: 7468 696e 6773 2074 6f20 6d61 6b65 2073  things to make s
+0004c0e0: 7572 6520 7765 2064 656c 6574 6520 7468  ure we delete th
+0004c0f0: 696e 6773 2066 726f 6d20 7468 6520 6261  ings from the ba
+0004c100: 636b 0d0a 0d0a 2020 2020 2020 2020 7365  ck....        se
+0004c110: 6c66 2e5f 6861 735f 656d 7074 795f 696e  lf._has_empty_in
+0004c120: 7075 7420 3d20 4661 6c73 650d 0a20 2020  put = False..   
+0004c130: 2020 2020 2066 6f72 206b 6579 2c20 7370       for key, sp
+0004c140: 6563 2069 6e20 736f 7274 6564 280d 0a20  ec in sorted(.. 
+0004c150: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
+0004c160: 6163 7469 6f6e 5f73 7065 632e 6974 656d  action_spec.item
+0004c170: 7328 5472 7565 292c 206b 6579 3d73 656c  s(True), key=sel
+0004c180: 662e 5f73 6f72 7465 722c 2072 6576 6572  f._sorter, rever
+0004c190: 7365 3d54 7275 650d 0a20 2020 2020 2020  se=True..       
+0004c1a0: 2029 3a0d 0a20 2020 2020 2020 2020 2020   ):..           
+0004c1b0: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
+0004c1c0: 7065 632c 2043 6f6d 706f 7369 7465 5370  pec, CompositeSp
+0004c1d0: 6563 2920 616e 6420 7370 6563 2e69 735f  ec) and spec.is_
+0004c1e0: 656d 7074 7928 293a 0d0a 2020 2020 2020  empty():..      
+0004c1f0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0004c200: 6861 735f 656d 7074 795f 696e 7075 7420  has_empty_input 
+0004c210: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+0004c220: 2020 2020 2020 2020 6465 6c20 6675 6c6c          del full
+0004c230: 5f61 6374 696f 6e5f 7370 6563 5b6b 6579  _action_spec[key
+0004c240: 5d0d 0a0d 0a20 2020 2020 2020 2066 6f72  ]....        for
+0004c250: 206b 6579 2c20 7370 6563 2069 6e20 736f   key, spec in so
+0004c260: 7274 6564 280d 0a20 2020 2020 2020 2020  rted(..         
+0004c270: 2020 2066 756c 6c5f 7374 6174 655f 7370     full_state_sp
+0004c280: 6563 2e69 7465 6d73 2854 7275 6529 2c20  ec.items(True), 
+0004c290: 6b65 793d 7365 6c66 2e5f 736f 7274 6572  key=self._sorter
+0004c2a0: 2c20 7265 7665 7273 653d 5472 7565 0d0a  , reverse=True..
+0004c2b0: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
+0004c2c0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0004c2d0: 7461 6e63 6528 7370 6563 2c20 436f 6d70  tance(spec, Comp
+0004c2e0: 6f73 6974 6553 7065 6329 2061 6e64 2073  ositeSpec) and s
+0004c2f0: 7065 632e 6973 5f65 6d70 7479 2829 3a0d  pec.is_empty():.
+0004c300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c310: 2073 656c 662e 5f68 6173 5f65 6d70 7479   self._has_empty
+0004c320: 5f69 6e70 7574 203d 2054 7275 650d 0a20  _input = True.. 
+0004c330: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0004c340: 656c 2066 756c 6c5f 7374 6174 655f 7370  el full_state_sp
+0004c350: 6563 5b6b 6579 5d0d 0a20 2020 2020 2020  ec[key]..       
+0004c360: 2072 6574 7572 6e20 696e 7075 745f 7370   return input_sp
+0004c370: 6563 0d0a 0d0a 2020 2020 6465 6620 5f69  ec....    def _i
+0004c380: 6e76 5f63 616c 6c28 7365 6c66 2c20 7465  nv_call(self, te
+0004c390: 6e73 6f72 6469 6374 3a20 5465 6e73 6f72  nsordict: Tensor
+0004c3a0: 4469 6374 4261 7365 2920 2d3e 2054 656e  DictBase) -> Ten
+0004c3b0: 736f 7244 6963 7442 6173 653a 0d0a 2020  sorDictBase:..  
+0004c3c0: 2020 2020 2020 6966 2073 656c 662e 5f68        if self._h
+0004c3d0: 6173 5f65 6d70 7479 5f69 6e70 7574 3a0d  as_empty_input:.
+0004c3e0: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+0004c3f0: 7574 5f73 7065 6320 3d20 6765 7461 7474  ut_spec = getatt
+0004c400: 7228 7365 6c66 2e70 6172 656e 742c 2022  r(self.parent, "
+0004c410: 696e 7075 745f 7370 6563 222c 204e 6f6e  input_spec", Non
+0004c420: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0004c430: 6966 2069 6e70 7574 5f73 7065 6320 6973  if input_spec is
+0004c440: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0004c450: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+0004c460: 656e 736f 7264 6963 740d 0a0d 0a20 2020  ensordict....   
+0004c470: 2020 2020 2020 2020 2066 756c 6c5f 6163           full_ac
+0004c480: 7469 6f6e 5f73 7065 6320 3d20 696e 7075  tion_spec = inpu
+0004c490: 745f 7370 6563 5b22 6675 6c6c 5f61 6374  t_spec["full_act
+0004c4a0: 696f 6e5f 7370 6563 225d 0d0a 2020 2020  ion_spec"]..    
+0004c4b0: 2020 2020 2020 2020 6675 6c6c 5f73 7461          full_sta
+0004c4c0: 7465 5f73 7065 6320 3d20 696e 7075 745f  te_spec = input_
+0004c4d0: 7370 6563 5b22 6675 6c6c 5f73 7461 7465  spec["full_state
+0004c4e0: 5f73 7065 6322 5d0d 0a20 2020 2020 2020  _spec"]..       
+0004c4f0: 2020 2020 2023 2077 6520 7265 7665 7273       # we revers
+0004c500: 6520 7468 696e 6773 2074 6f20 6d61 6b65  e things to make
+0004c510: 2073 7572 6520 7765 2064 656c 6574 6520   sure we delete 
+0004c520: 7468 696e 6773 2066 726f 6d20 7468 6520  things from the 
+0004c530: 6261 636b 0d0a 0d0a 2020 2020 2020 2020  back....        
+0004c540: 2020 2020 666f 7220 6b65 792c 2073 7065      for key, spe
+0004c550: 6320 696e 2073 6f72 7465 6428 0d0a 2020  c in sorted(..  
+0004c560: 2020 2020 2020 2020 2020 2020 2020 6675                fu
+0004c570: 6c6c 5f61 6374 696f 6e5f 7370 6563 2e69  ll_action_spec.i
+0004c580: 7465 6d73 2854 7275 6529 2c20 6b65 793d  tems(True), key=
+0004c590: 7365 6c66 2e5f 736f 7274 6572 2c20 7265  self._sorter, re
+0004c5a0: 7665 7273 653d 5472 7565 0d0a 2020 2020  verse=True..    
+0004c5b0: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
+0004c5c0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0004c5d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004c5e0: 2020 2020 2020 6973 696e 7374 616e 6365        isinstance
+0004c5f0: 2873 7065 632c 2043 6f6d 706f 7369 7465  (spec, Composite
+0004c600: 5370 6563 290d 0a20 2020 2020 2020 2020  Spec)..         
+0004c610: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
+0004c620: 7065 632e 6973 5f65 6d70 7479 2829 0d0a  pec.is_empty()..
+0004c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c640: 2020 2020 616e 6420 6b65 7920 6e6f 7420      and key not 
+0004c650: 696e 2074 656e 736f 7264 6963 742e 6b65  in tensordict.ke
+0004c660: 7973 2854 7275 6529 0d0a 2020 2020 2020  ys(True)..      
+0004c670: 2020 2020 2020 2020 2020 293a 0d0a 2020            ):..  
+0004c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c690: 2020 7465 6e73 6f72 6469 6374 2e63 7265    tensordict.cre
+0004c6a0: 6174 655f 6e65 7374 6564 286b 6579 290d  ate_nested(key).
+0004c6b0: 0a0d 0a20 2020 2020 2020 2020 2020 2066  ...            f
+0004c6c0: 6f72 206b 6579 2c20 7370 6563 2069 6e20  or key, spec in 
+0004c6d0: 736f 7274 6564 280d 0a20 2020 2020 2020  sorted(..       
+0004c6e0: 2020 2020 2020 2020 2066 756c 6c5f 7374           full_st
+0004c6f0: 6174 655f 7370 6563 2e69 7465 6d73 2854  ate_spec.items(T
+0004c700: 7275 6529 2c20 6b65 793d 7365 6c66 2e5f  rue), key=self._
+0004c710: 736f 7274 6572 2c20 7265 7665 7273 653d  sorter, reverse=
+0004c720: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+0004c730: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
+0004c740: 2020 2020 2020 6966 2028 0d0a 2020 2020        if (..    
+0004c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c760: 6973 696e 7374 616e 6365 2873 7065 632c  isinstance(spec,
+0004c770: 2043 6f6d 706f 7369 7465 5370 6563 290d   CompositeSpec).
+0004c780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c790: 2020 2020 2061 6e64 2073 7065 632e 6973       and spec.is
+0004c7a0: 5f65 6d70 7479 2829 0d0a 2020 2020 2020  _empty()..      
+0004c7b0: 2020 2020 2020 2020 2020 2020 2020 616e                an
+0004c7c0: 6420 6b65 7920 6e6f 7420 696e 2074 656e  d key not in ten
+0004c7d0: 736f 7264 6963 742e 6b65 7973 2854 7275  sordict.keys(Tru
+0004c7e0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0004c7f0: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
+0004c800: 2020 2020 2020 2020 2020 2020 7465 6e73              tens
+0004c810: 6f72 6469 6374 2e63 7265 6174 655f 6e65  ordict.create_ne
+0004c820: 7374 6564 286b 6579 290d 0a20 2020 2020  sted(key)..     
+0004c830: 2020 2072 6574 7572 6e20 7465 6e73 6f72     return tensor
+0004c840: 6469 6374 0d0a 0d0a 2020 2020 6465 6620  dict....    def 
+0004c850: 5f63 616c 6c28 7365 6c66 2c20 7465 6e73  _call(self, tens
+0004c860: 6f72 6469 6374 3a20 5465 6e73 6f72 4469  ordict: TensorDi
+0004c870: 6374 4261 7365 2920 2d3e 2054 656e 736f  ctBase) -> Tenso
+0004c880: 7244 6963 7442 6173 653a 0d0a 2020 2020  rDictBase:..    
+0004c890: 2020 2020 666f 7220 6b65 792c 2076 616c      for key, val
+0004c8a0: 7565 2069 6e20 736f 7274 6564 280d 0a20  ue in sorted(.. 
+0004c8b0: 2020 2020 2020 2020 2020 2074 656e 736f             tenso
+0004c8c0: 7264 6963 742e 6974 656d 7328 5472 7565  rdict.items(True
+0004c8d0: 292c 206b 6579 3d73 656c 662e 5f73 6f72  ), key=self._sor
+0004c8e0: 7465 722c 2072 6576 6572 7365 3d54 7275  ter, reverse=Tru
+0004c8f0: 650d 0a20 2020 2020 2020 2029 3a0d 0a20  e..        ):.. 
+0004c900: 2020 2020 2020 2020 2020 2069 6620 280d             if (.
+0004c910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c920: 2069 735f 7465 6e73 6f72 5f63 6f6c 6c65   is_tensor_colle
+0004c930: 6374 696f 6e28 7661 6c75 6529 0d0a 2020  ction(value)..  
+0004c940: 2020 2020 2020 2020 2020 2020 2020 616e                an
+0004c950: 6420 6e6f 7420 6973 696e 7374 616e 6365  d not isinstance
+0004c960: 2876 616c 7565 2c20 4e6f 6e54 656e 736f  (value, NonTenso
+0004c970: 7244 6174 6129 0d0a 2020 2020 2020 2020  rData)..        
+0004c980: 2020 2020 2020 2020 616e 6420 7661 6c75          and valu
+0004c990: 652e 6973 5f65 6d70 7479 2829 0d0a 2020  e.is_empty()..  
+0004c9a0: 2020 2020 2020 2020 2020 293a 0d0a 2020            ):..  
+0004c9b0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0004c9c0: 6c20 7465 6e73 6f72 6469 6374 5b6b 6579  l tensordict[key
+0004c9d0: 5d0d 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
+0004c9e0: 6e20 7465 6e73 6f72 6469 6374 0d0a 0d0a  n tensordict....
+0004c9f0: 2020 2020 6465 6620 5f72 6573 6574 280d      def _reset(.
+0004ca00: 0a20 2020 2020 2020 2073 656c 662c 2074  .        self, t
+0004ca10: 656e 736f 7264 6963 743a 2054 656e 736f  ensordict: Tenso
+0004ca20: 7244 6963 7442 6173 652c 2074 656e 736f  rDictBase, tenso
+0004ca30: 7264 6963 745f 7265 7365 743a 2054 656e  rdict_reset: Ten
+0004ca40: 736f 7244 6963 7442 6173 650d 0a20 2020  sorDictBase..   
+0004ca50: 2029 202d 3e20 5465 6e73 6f72 4469 6374   ) -> TensorDict
+0004ca60: 4261 7365 3a0d 0a20 2020 2020 2020 2022  Base:..        "
+0004ca70: 2222 5265 7365 7473 2061 2074 7261 6e73  ""Resets a trans
+0004ca80: 666f 726d 2069 6620 6974 2069 7320 7374  form if it is st
+0004ca90: 6174 6566 756c 2e22 2222 0d0a 2020 2020  ateful."""..    
+0004caa0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0004cab0: 5f63 616c 6c28 7465 6e73 6f72 6469 6374  _call(tensordict
+0004cac0: 5f72 6573 6574 290d 0a0d 0a20 2020 2066  _reset)....    f
+0004cad0: 6f72 7761 7264 203d 205f 6361 6c6c 0d0a  orward = _call..
+0004cae0: 0d0a 0d0a 636c 6173 7320 5f49 6e76 6572  ....class _Inver
+0004caf0: 7454 7261 6e73 666f 726d 2854 7261 6e73  tTransform(Trans
+0004cb00: 666f 726d 293a 0d0a 2020 2020 5f4d 4953  form):..    _MIS
+0004cb10: 5349 4e47 5f54 5241 4e53 464f 524d 5f45  SING_TRANSFORM_E
+0004cb20: 5252 4f52 203d 2028 0d0a 2020 2020 2020  RROR = (..      
+0004cb30: 2020 2254 6865 7265 2069 7320 6e6f 7420    "There is not 
+0004cb40: 6765 6e65 7269 6320 7275 6c65 2074 6f20  generic rule to 
+0004cb50: 696e 7665 7274 2061 2073 7065 6320 7472  invert a spec tr
+0004cb60: 616e 7366 6f72 6d2e 2022 0d0a 2020 2020  ansform. "..    
+0004cb70: 2020 2020 2250 6c65 6173 6520 6669 6c65      "Please file
+0004cb80: 2061 6e20 6973 7375 6520 6f6e 2067 6974   an issue on git
+0004cb90: 6875 6220 746f 2067 6574 2068 656c 702e  hub to get help.
+0004cba0: 220d 0a20 2020 2029 0d0a 0d0a 2020 2020  "..    )....    
+0004cbb0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0004cbc0: 662c 2074 7261 6e73 666f 726d 3a20 5472  f, transform: Tr
+0004cbd0: 616e 7366 6f72 6d29 3a0d 0a20 2020 2020  ansform):..     
+0004cbe0: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
+0004cbf0: 745f 5f28 290d 0a20 2020 2020 2020 2073  t__()..        s
+0004cc00: 656c 662e 7472 616e 7366 6f72 6d20 3d20  elf.transform = 
+0004cc10: 7472 616e 7366 6f72 6d0d 0a0d 0a20 2020  transform....   
+0004cc20: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+0004cc30: 6465 6620 696e 5f6b 6579 7328 7365 6c66  def in_keys(self
+0004cc40: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+0004cc50: 726e 2073 656c 662e 7472 616e 7366 6f72  rn self.transfor
+0004cc60: 6d2e 696e 5f6b 6579 735f 696e 760d 0a0d  m.in_keys_inv...
+0004cc70: 0a20 2020 2040 696e 5f6b 6579 732e 7365  .    @in_keys.se
+0004cc80: 7474 6572 0d0a 2020 2020 6465 6620 696e  tter..    def in
+0004cc90: 5f6b 6579 7328 7365 6c66 2c20 7661 6c75  _keys(self, valu
+0004cca0: 6529 3a0d 0a20 2020 2020 2020 2069 6620  e):..        if 
+0004ccb0: 7661 6c75 6520 6973 206e 6f74 204e 6f6e  value is not Non
+0004ccc0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0004ccd0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+0004cce0: 6f72 2822 4361 6e6e 6f74 2073 6574 206e  or("Cannot set n
+0004ccf0: 6f6e 2d6e 756c 6c20 7661 6c75 6520 696e  on-null value in
+0004cd00: 2069 6e5f 6b65 7973 2e22 290d 0a0d 0a20   in_keys.").... 
+0004cd10: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+0004cd20: 2020 6465 6620 696e 5f6b 6579 735f 696e    def in_keys_in
+0004cd30: 7628 7365 6c66 293a 0d0a 2020 2020 2020  v(self):..      
+0004cd40: 2020 7265 7475 726e 2073 656c 662e 7472    return self.tr
+0004cd50: 616e 7366 6f72 6d2e 696e 5f6b 6579 730d  ansform.in_keys.
+0004cd60: 0a0d 0a20 2020 2040 696e 5f6b 6579 735f  ...    @in_keys_
+0004cd70: 696e 762e 7365 7474 6572 0d0a 2020 2020  inv.setter..    
+0004cd80: 6465 6620 696e 5f6b 6579 735f 696e 7628  def in_keys_inv(
+0004cd90: 7365 6c66 2c20 7661 6c75 6529 3a0d 0a20  self, value):.. 
+0004cda0: 2020 2020 2020 2069 6620 7661 6c75 6520         if value 
+0004cdb0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+0004cdc0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0004cdd0: 5275 6e74 696d 6545 7272 6f72 2822 4361  RuntimeError("Ca
+0004cde0: 6e6e 6f74 2073 6574 206e 6f6e 2d6e 756c  nnot set non-nul
+0004cdf0: 6c20 7661 6c75 6520 696e 2069 6e5f 6b65  l value in in_ke
+0004ce00: 7973 5f69 6e76 2e22 290d 0a0d 0a20 2020  ys_inv.")....   
+0004ce10: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+0004ce20: 6465 6620 6f75 745f 6b65 7973 2873 656c  def out_keys(sel
+0004ce30: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+0004ce40: 7572 6e20 7365 6c66 2e74 7261 6e73 666f  urn self.transfo
+0004ce50: 726d 2e6f 7574 5f6b 6579 735f 696e 760d  rm.out_keys_inv.
+0004ce60: 0a0d 0a20 2020 2040 6f75 745f 6b65 7973  ...    @out_keys
+0004ce70: 2e73 6574 7465 720d 0a20 2020 2064 6566  .setter..    def
+0004ce80: 206f 7574 5f6b 6579 7328 7365 6c66 2c20   out_keys(self, 
+0004ce90: 7661 6c75 6529 3a0d 0a20 2020 2020 2020  value):..       
+0004cea0: 2069 6620 7661 6c75 6520 6973 206e 6f74   if value is not
+0004ceb0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0004cec0: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
+0004ced0: 6545 7272 6f72 2822 4361 6e6e 6f74 2073  eError("Cannot s
+0004cee0: 6574 206e 6f6e 2d6e 756c 6c20 7661 6c75  et non-null valu
+0004cef0: 6520 696e 206f 7574 5f6b 6579 732e 2229  e in out_keys.")
+0004cf00: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+0004cf10: 790d 0a20 2020 2064 6566 206f 7574 5f6b  y..    def out_k
+0004cf20: 6579 735f 696e 7628 7365 6c66 293a 0d0a  eys_inv(self):..
+0004cf30: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0004cf40: 656c 662e 7472 616e 7366 6f72 6d2e 6f75  elf.transform.ou
+0004cf50: 745f 6b65 7973 0d0a 0d0a 2020 2020 406f  t_keys....    @o
+0004cf60: 7574 5f6b 6579 735f 696e 762e 7365 7474  ut_keys_inv.sett
+0004cf70: 6572 0d0a 2020 2020 6465 6620 6f75 745f  er..    def out_
+0004cf80: 6b65 7973 5f69 6e76 2873 656c 662c 2076  keys_inv(self, v
+0004cf90: 616c 7565 293a 0d0a 2020 2020 2020 2020  alue):..        
+0004cfa0: 6966 2076 616c 7565 2069 7320 6e6f 7420  if value is not 
+0004cfb0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0004cfc0: 2020 2072 6169 7365 2052 756e 7469 6d65     raise Runtime
+0004cfd0: 4572 726f 7228 2243 616e 6e6f 7420 7365  Error("Cannot se
+0004cfe0: 7420 6e6f 6e2d 6e75 6c6c 2076 616c 7565  t non-null value
+0004cff0: 2069 6e20 6f75 745f 6b65 7973 5f69 6e76   in out_keys_inv
+0004d000: 2e22 290d 0a0d 0a20 2020 2064 6566 2066  .")....    def f
+0004d010: 6f72 7761 7264 2873 656c 662c 2074 656e  orward(self, ten
+0004d020: 736f 7264 6963 743a 2054 656e 736f 7244  sordict: TensorD
+0004d030: 6963 7442 6173 6529 202d 3e20 5465 6e73  ictBase) -> Tens
+0004d040: 6f72 4469 6374 4261 7365 3a0d 0a20 2020  orDictBase:..   
+0004d050: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0004d060: 2e74 7261 6e73 666f 726d 2e69 6e76 2874  .transform.inv(t
+0004d070: 656e 736f 7264 6963 7429 0d0a 0d0a 2020  ensordict)....  
+0004d080: 2020 6465 6620 696e 7628 7365 6c66 2c20    def inv(self, 
+0004d090: 7465 6e73 6f72 6469 6374 3a20 5465 6e73  tensordict: Tens
+0004d0a0: 6f72 4469 6374 4261 7365 2920 2d3e 2054  orDictBase) -> T
+0004d0b0: 656e 736f 7244 6963 7442 6173 653a 0d0a  ensorDictBase:..
+0004d0c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0004d0d0: 656c 662e 7472 616e 7366 6f72 6d2e 666f  elf.transform.fo
+0004d0e0: 7277 6172 6428 7465 6e73 6f72 6469 6374  rward(tensordict
+0004d0f0: 290d 0a0d 0a20 2020 2064 6566 205f 6361  )....    def _ca
+0004d100: 6c6c 2873 656c 662c 2074 656e 736f 7264  ll(self, tensord
+0004d110: 6963 743a 2054 656e 736f 7244 6963 7442  ict: TensorDictB
+0004d120: 6173 6529 202d 3e20 5465 6e73 6f72 4469  ase) -> TensorDi
+0004d130: 6374 4261 7365 3a0d 0a20 2020 2020 2020  ctBase:..       
+0004d140: 2072 6574 7572 6e20 7365 6c66 2e74 7261   return self.tra
+0004d150: 6e73 666f 726d 2e5f 696e 765f 6361 6c6c  nsform._inv_call
+0004d160: 2874 656e 736f 7264 6963 7429 0d0a 0d0a  (tensordict)....
+0004d170: 2020 2020 6465 6620 5f69 6e76 5f63 616c      def _inv_cal
+0004d180: 6c28 7365 6c66 2c20 7465 6e73 6f72 6469  l(self, tensordi
+0004d190: 6374 3a20 5465 6e73 6f72 4469 6374 4261  ct: TensorDictBa
+0004d1a0: 7365 2920 2d3e 2054 656e 736f 7244 6963  se) -> TensorDic
+0004d1b0: 7442 6173 653a 0d0a 2020 2020 2020 2020  tBase:..        
+0004d1c0: 7265 7475 726e 2073 656c 662e 7472 616e  return self.tran
+0004d1d0: 7366 6f72 6d2e 5f63 616c 6c28 7465 6e73  sform._call(tens
+0004d1e0: 6f72 6469 6374 290d 0a0d 0a20 2020 2064  ordict)....    d
+0004d1f0: 6566 2074 7261 6e73 666f 726d 5f6f 6273  ef transform_obs
+0004d200: 6572 7661 7469 6f6e 5f73 7065 6328 7365  ervation_spec(se
+0004d210: 6c66 2c20 6f62 7365 7276 6174 696f 6e5f  lf, observation_
+0004d220: 7370 6563 3a20 5465 6e73 6f72 5370 6563  spec: TensorSpec
+0004d230: 2920 2d3e 2054 656e 736f 7253 7065 633a  ) -> TensorSpec:
+0004d240: 0d0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
+0004d250: 5275 6e74 696d 6545 7272 6f72 2873 656c  RuntimeError(sel
+0004d260: 662e 5f4d 4953 5349 4e47 5f54 5241 4e53  f._MISSING_TRANS
+0004d270: 464f 524d 5f45 5252 4f52 290d 0a0d 0a20  FORM_ERROR).... 
+0004d280: 2020 2064 6566 2074 7261 6e73 666f 726d     def transform
+0004d290: 5f73 7461 7465 5f73 7065 6328 7365 6c66  _state_spec(self
+0004d2a0: 2c20 7374 6174 655f 7370 6563 3a20 5465  , state_spec: Te
+0004d2b0: 6e73 6f72 5370 6563 2920 2d3e 2054 656e  nsorSpec) -> Ten
+0004d2c0: 736f 7253 7065 633a 0d0a 2020 2020 2020  sorSpec:..      
+0004d2d0: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
+0004d2e0: 7272 6f72 2873 656c 662e 5f4d 4953 5349  rror(self._MISSI
+0004d2f0: 4e47 5f54 5241 4e53 464f 524d 5f45 5252  NG_TRANSFORM_ERR
+0004d300: 4f52 290d 0a0d 0a20 2020 2064 6566 2074  OR)....    def t
+0004d310: 7261 6e73 666f 726d 5f72 6577 6172 645f  ransform_reward_
+0004d320: 7370 6563 2873 656c 662c 2072 6577 6172  spec(self, rewar
+0004d330: 645f 7370 6563 3a20 5465 6e73 6f72 5370  d_spec: TensorSp
+0004d340: 6563 2920 2d3e 2054 656e 736f 7253 7065  ec) -> TensorSpe
+0004d350: 633a 0d0a 2020 2020 2020 2020 7261 6973  c:..        rais
+0004d360: 6520 5275 6e74 696d 6545 7272 6f72 2873  e RuntimeError(s
+0004d370: 656c 662e 5f4d 4953 5349 4e47 5f54 5241  elf._MISSING_TRA
+0004d380: 4e53 464f 524d 5f45 5252 4f52 290d 0a0d  NSFORM_ERROR)...
+0004d390: 0a20 2020 2064 6566 2074 7261 6e73 666f  .    def transfo
+0004d3a0: 726d 5f61 6374 696f 6e5f 7370 6563 2873  rm_action_spec(s
+0004d3b0: 656c 662c 2061 6374 696f 6e5f 7370 6563  elf, action_spec
+0004d3c0: 3a20 5465 6e73 6f72 5370 6563 2920 2d3e  : TensorSpec) ->
+0004d3d0: 2054 656e 736f 7253 7065 633a 0d0a 2020   TensorSpec:..  
+0004d3e0: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
+0004d3f0: 696d 6545 7272 6f72 2873 656c 662e 5f4d  imeError(self._M
+0004d400: 4953 5349 4e47 5f54 5241 4e53 464f 524d  ISSING_TRANSFORM
+0004d410: 5f45 5252 4f52 290d 0a0d 0a20 2020 2064  _ERROR)....    d
+0004d420: 6566 2074 7261 6e73 666f 726d 5f64 6f6e  ef transform_don
+0004d430: 655f 7370 6563 2873 656c 662c 2064 6f6e  e_spec(self, don
+0004d440: 655f 7370 6563 3a20 5465 6e73 6f72 5370  e_spec: TensorSp
+0004d450: 6563 2920 2d3e 2054 656e 736f 7253 7065  ec) -> TensorSpe
+0004d460: 633a 0d0a 2020 2020 2020 2020 7261 6973  c:..        rais
+0004d470: 6520 5275 6e74 696d 6545 7272 6f72 2873  e RuntimeError(s
+0004d480: 656c 662e 5f4d 4953 5349 4e47 5f54 5241  elf._MISSING_TRA
+0004d490: 4e53 464f 524d 5f45 5252 4f52 290d 0a0d  NSFORM_ERROR)...
+0004d4a0: 0a0d 0a63 6c61 7373 205f 4361 6c6c 6162  ...class _Callab
+0004d4b0: 6c65 5472 616e 7366 6f72 6d28 5472 616e  leTransform(Tran
+0004d4c0: 7366 6f72 6d29 3a0d 0a20 2020 2023 2041  sform):..    # A
+0004d4d0: 2077 7261 7070 6572 2061 726f 756e 6420   wrapper around 
+0004d4e0: 6120 6375 7374 6f6d 2063 616c 6c61 626c  a custom callabl
+0004d4f0: 6520 746f 206d 616b 6520 6974 2070 6f73  e to make it pos
+0004d500: 7369 626c 6520 746f 2074 7261 6e73 666f  sible to transfo
+0004d510: 726d 2061 6e79 2064 6174 6120 7479 7065  rm any data type
+0004d520: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0004d530: 5f5f 2873 656c 662c 2066 756e 6329 3a0d  __(self, func):.
+0004d540: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+0004d550: 2e5f 5f69 6e69 745f 5f28 290d 0a20 2020  .__init__()..   
+0004d560: 2020 2020 2073 656c 662e 6675 6e63 203d       self.func =
+0004d570: 2066 756e 630d 0a0d 0a20 2020 2064 6566   func....    def
+0004d580: 2066 6f72 7761 7264 2873 656c 662c 202a   forward(self, *
+0004d590: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+0004d5a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0004d5b0: 2073 656c 662e 6675 6e63 282a 6172 6773   self.func(*args
+0004d5c0: 2c20 2a2a 6b77 6172 6773 290d 0a0d 0a20  , **kwargs).... 
+0004d5d0: 2020 2064 6566 205f 6361 6c6c 2873 656c     def _call(sel
+0004d5e0: 662c 2074 656e 736f 7264 6963 743a 2054  f, tensordict: T
+0004d5f0: 656e 736f 7244 6963 7442 6173 6529 3a0d  ensorDictBase):.
+0004d600: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0004d610: 7365 6c66 2e66 756e 6328 7465 6e73 6f72  self.func(tensor
+0004d620: 6469 6374 290d 0a0d 0a20 2020 2064 6566  dict)....    def
+0004d630: 205f 696e 765f 6361 6c6c 2873 656c 662c   _inv_call(self,
+0004d640: 2074 656e 736f 7264 6963 743a 2054 656e   tensordict: Ten
+0004d650: 736f 7244 6963 7442 6173 6529 202d 3e20  sorDictBase) -> 
+0004d660: 5465 6e73 6f72 4469 6374 4261 7365 3a0d  TensorDictBase:.
+0004d670: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0004d680: 7465 6e73 6f72 6469 6374 0d0a 0d0a 2020  tensordict....  
+0004d690: 2020 6465 6620 5f72 6573 6574 280d 0a20    def _reset(.. 
+0004d6a0: 2020 2020 2020 2073 656c 662c 2074 656e         self, ten
+0004d6b0: 736f 7264 6963 743a 2054 656e 736f 7244  sordict: TensorD
+0004d6c0: 6963 7442 6173 652c 2074 656e 736f 7264  ictBase, tensord
+0004d6d0: 6963 745f 7265 7365 743a 2054 656e 736f  ict_reset: Tenso
+0004d6e0: 7244 6963 7442 6173 650d 0a20 2020 2029  rDictBase..    )
+0004d6f0: 202d 3e20 5465 6e73 6f72 4469 6374 4261   -> TensorDictBa
+0004d700: 7365 3a0d 0a20 2020 2020 2020 2072 6574  se:..        ret
+0004d710: 7572 6e20 7365 6c66 2e5f 6361 6c6c 2874  urn self._call(t
+0004d720: 656e 736f 7264 6963 745f 7265 7365 7429  ensordict_reset)
+0004d730: 0d0a 0d0a 0d0a 636c 6173 7320 4261 7463  ......class Batc
+0004d740: 6853 697a 6554 7261 6e73 666f 726d 2854  hSizeTransform(T
+0004d750: 7261 6e73 666f 726d 293a 0d0a 2020 2020  ransform):..    
+0004d760: 2222 2241 2074 7261 6e73 666f 726d 2074  """A transform t
+0004d770: 6f20 6d6f 6469 6679 2074 6865 2062 6174  o modify the bat
+0004d780: 6368 2d73 697a 6520 6f66 2061 6e20 656e  ch-size of an en
+0004d790: 7669 726f 6e6d 742e 0d0a 0d0a 2020 2020  vironmt.....    
+0004d7a0: 5468 6973 2074 7261 6e73 666f 726d 2068  This transform h
+0004d7b0: 6173 2074 776f 2064 6973 7469 6e63 7420  as two distinct 
+0004d7c0: 7573 6167 6573 3a20 6974 2063 616e 2062  usages: it can b
+0004d7d0: 6520 7573 6564 2074 6f20 7365 7420 7468  e used to set th
+0004d7e0: 650d 0a20 2020 2062 6174 6368 2d73 697a  e..    batch-siz
+0004d7f0: 6520 666f 7220 6e6f 6e2d 6261 7463 682d  e for non-batch-
+0004d800: 6c6f 636b 6564 2028 652e 672e 2073 7461  locked (e.g. sta
+0004d810: 7465 6c65 7373 2920 656e 7669 726f 6e6d  teless) environm
+0004d820: 656e 7473 2074 6f0d 0a20 2020 2065 6e61  ents to..    ena
+0004d830: 626c 6520 6461 7461 2063 6f6c 6c65 6374  ble data collect
+0004d840: 696f 6e20 7573 696e 6720 6461 7461 2063  ion using data c
+0004d850: 6f6c 6c65 6374 6f72 732e 2049 7420 6361  ollectors. It ca
+0004d860: 6e20 616c 736f 2062 6520 7573 6564 0d0a  n also be used..
+0004d870: 2020 2020 746f 206d 6f64 6966 7920 7468      to modify th
+0004d880: 6520 6261 7463 682d 7369 7a65 206f 6620  e batch-size of 
+0004d890: 616e 2065 6e76 6972 6f6e 6d65 6e74 2028  an environment (
+0004d8a0: 652e 672e 2073 7175 6565 7a65 2c20 756e  e.g. squeeze, un
+0004d8b0: 7371 7565 657a 6520 6f72 0d0a 2020 2020  squeeze or..    
+0004d8c0: 7265 7368 6170 6529 2e0d 0a0d 0a20 2020  reshape).....   
+0004d8d0: 2054 6869 7320 7472 616e 7366 6f72 6d20   This transform 
+0004d8e0: 6d6f 6469 6669 6573 2074 6865 2065 6e76  modifies the env
+0004d8f0: 6972 6f6e 6d65 6e74 2062 6174 6368 2d73  ironment batch-s
+0004d900: 697a 6520 746f 206d 6174 6368 2074 6865  ize to match the
+0004d910: 206f 6e65 2070 726f 7669 6465 642e 0d0a   one provided...
+0004d920: 2020 2020 4974 2065 7870 6563 7473 2074      It expects t
+0004d930: 6865 2070 6172 656e 7420 656e 7669 726f  he parent enviro
+0004d940: 6e6d 656e 7420 6261 7463 682d 7369 7a65  nment batch-size
+0004d950: 2074 6f20 6265 2065 7870 616e 6461 626c   to be expandabl
+0004d960: 6520 746f 2074 6865 0d0a 2020 2020 7072  e to the..    pr
+0004d970: 6f76 6964 6564 206f 6e65 2e0d 0a0d 0a20  ovided one..... 
+0004d980: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
+0004d990: 0d0a 2020 2020 2020 2020 6261 7463 685f  ..        batch_
+0004d9a0: 7369 7a65 2028 746f 7263 682e 5369 7a65  size (torch.Size
+0004d9b0: 206f 7220 6571 7569 7661 6c65 6e74 2c20   or equivalent, 
+0004d9c0: 6f70 7469 6f6e 616c 293a 2074 6865 206e  optional): the n
+0004d9d0: 6577 2062 6174 6368 2d73 697a 6520 6f66  ew batch-size of
+0004d9e0: 2074 6865 2065 6e76 6972 6f6e 6d65 6e74   the environment
+0004d9f0: 2e0d 0a20 2020 2020 2020 2020 2020 2045  ...            E
+0004da00: 7863 6c75 7369 7665 2077 6974 6820 6060  xclusive with ``
+0004da10: 7265 7368 6170 655f 666e 6060 2e0d 0a20  reshape_fn``... 
+0004da20: 2020 2020 2020 2072 6573 6861 7065 5f66         reshape_f
+0004da30: 6e20 2863 616c 6c61 626c 652c 206f 7074  n (callable, opt
+0004da40: 696f 6e61 6c29 3a20 6120 6361 6c6c 6162  ional): a callab
+0004da50: 6c65 2074 6f20 6d6f 6469 6679 2074 6865  le to modify the
+0004da60: 2065 6e76 6972 6f6e 6d65 6e74 2062 6174   environment bat
+0004da70: 6368 2d73 697a 652e 0d0a 2020 2020 2020  ch-size...      
+0004da80: 2020 2020 2020 4578 636c 7573 6976 6520        Exclusive 
+0004da90: 7769 7468 2060 6062 6174 6368 5f73 697a  with ``batch_siz
+0004daa0: 6560 602e 0d0a 0d0a 2020 2020 2020 2020  e``.....        
+0004dab0: 2020 2020 2e2e 206e 6f74 653a 3a20 4375      .. note:: Cu
+0004dac0: 7272 656e 746c 792c 2074 7261 6e73 666f  rrently, transfo
+0004dad0: 726d 6174 696f 6e73 2069 6e76 6f6c 7669  rmations involvi
+0004dae0: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
+0004daf0: 2020 2020 6060 7265 7368 6170 6560 602c      ``reshape``,
+0004db00: 2060 6066 6c61 7474 656e 6060 2c20 6060   ``flatten``, ``
+0004db10: 756e 666c 6174 7465 6e60 602c 2060 6073  unflatten``, ``s
+0004db20: 7175 6565 7a65 6060 2061 6e64 2060 6075  queeze`` and ``u
+0004db30: 6e73 7175 6565 7a65 6060 0d0a 2020 2020  nsqueeze``..    
+0004db40: 2020 2020 2020 2020 2020 2020 6172 6520              are 
+0004db50: 7375 7070 6f72 7465 642e 2049 6620 616e  supported. If an
+0004db60: 6f74 6865 7220 7265 7368 6170 6520 6f70  other reshape op
+0004db70: 6572 6174 696f 6e20 6973 2072 6571 7569  eration is requi
+0004db80: 7265 642c 2070 6c65 6173 6520 7375 626d  red, please subm
+0004db90: 6974 0d0a 2020 2020 2020 2020 2020 2020  it..            
+0004dba0: 2020 2020 6120 6665 6174 7572 6520 7265      a feature re
+0004dbb0: 7175 6573 7420 6f6e 2054 6f72 6368 524c  quest on TorchRL
+0004dbc0: 2067 6974 6875 622e 0d0a 0d0a 2020 2020   github.....    
+0004dbd0: 2020 2020 7265 7365 745f 6675 6e63 2028      reset_func (
+0004dbe0: 6361 6c6c 6162 6c65 2c20 6f70 7469 6f6e  callable, option
+0004dbf0: 616c 293a 2061 2066 756e 6374 696f 6e20  al): a function 
+0004dc00: 7468 6174 2070 726f 6475 6365 7320 6120  that produces a 
+0004dc10: 7265 7365 7420 7465 6e73 6f72 6469 6374  reset tensordict
+0004dc20: 2e0d 0a20 2020 2020 2020 2020 2020 2054  ...            T
+0004dc30: 6865 2073 6967 6e61 7475 7265 206d 7573  he signature mus
+0004dc40: 7420 6d61 7463 6820 6060 4361 6c6c 6162  t match ``Callab
+0004dc50: 6c65 5b5b 5465 6e73 6f72 4469 6374 4261  le[[TensorDictBa
+0004dc60: 7365 2c20 5465 6e73 6f72 4469 6374 4261  se, TensorDictBa
+0004dc70: 7365 5d2c 2054 656e 736f 7244 6963 7442  se], TensorDictB
+0004dc80: 6173 655d 6060 0d0a 2020 2020 2020 2020  ase]``..        
+0004dc90: 2020 2020 7768 6572 6520 7468 6520 6669      where the fi
+0004dca0: 7273 7420 696e 7075 7420 6172 6775 6d65  rst input argume
+0004dcb0: 6e74 2069 7320 7468 6520 6f70 7469 6f6e  nt is the option
+0004dcc0: 616c 2074 656e 736f 7264 6963 7420 7061  al tensordict pa
+0004dcd0: 7373 6564 2074 6f20 7468 650d 0a20 2020  ssed to the..   
+0004dce0: 2020 2020 2020 2020 2065 6e76 6972 6f6e           environ
+0004dcf0: 6d65 6e74 2064 7572 696e 6720 7468 6520  ment during the 
+0004dd00: 6361 6c6c 2074 6f20 3a6d 6574 683a 607e  call to :meth:`~
+0004dd10: 456e 7642 6173 652e 7265 7365 7460 2061  EnvBase.reset` a
+0004dd20: 6e64 2074 6865 2073 6563 6f6e 640d 0a20  nd the second.. 
+0004dd30: 2020 2020 2020 2020 2020 2069 7320 7468             is th
+0004dd40: 6520 6f75 7470 7574 206f 6620 6060 5472  e output of ``Tr
+0004dd50: 616e 7366 6f72 6d65 6445 6e76 2e62 6173  ansformedEnv.bas
+0004dd60: 655f 656e 762e 7265 7365 7460 602e 2049  e_env.reset``. I
+0004dd70: 7420 6361 6e20 616c 736f 2073 7570 706f  t can also suppo
+0004dd80: 7274 2061 6e0d 0a20 2020 2020 2020 2020  rt an..         
+0004dd90: 2020 206f 7074 696f 6e61 6c20 6060 656e     optional ``en
+0004dda0: 7660 6020 6b65 7977 6f72 6420 6172 6775  v`` keyword argu
+0004ddb0: 6d65 6e74 2069 6620 6060 656e 765f 6b77  ment if ``env_kw
+0004ddc0: 6172 673d 5472 7565 6060 2e0d 0a20 2020  arg=True``...   
+0004ddd0: 2020 2020 2065 6e76 5f6b 7761 7267 2028       env_kwarg (
+0004dde0: 626f 6f6c 2c20 6f70 7469 6f6e 616c 293a  bool, optional):
+0004ddf0: 2069 6620 6060 5472 7565 6060 2c20 6060   if ``True``, ``
+0004de00: 7265 7365 745f 6675 6e63 6060 206d 7573  reset_func`` mus
+0004de10: 7420 7375 7070 6f72 7420 610d 0a20 2020  t support a..   
+0004de20: 2020 2020 2020 2020 2060 6065 6e76 6060           ``env``
+0004de30: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+0004de40: 742e 2044 6566 6175 6c74 7320 746f 2060  t. Defaults to `
+0004de50: 6046 616c 7365 6060 2e20 5468 6520 656e  `False``. The en
+0004de60: 7620 7061 7373 6564 2077 696c 6c0d 0a20  v passed will.. 
+0004de70: 2020 2020 2020 2020 2020 2062 6520 7468             be th
+0004de80: 6520 656e 7620 6163 636f 6d70 616e 6965  e env accompanie
+0004de90: 6420 6279 2069 7473 2074 7261 6e73 666f  d by its transfo
+0004dea0: 726d 2e0d 0a0d 0a20 2020 2045 7861 6d70  rm.....    Examp
+0004deb0: 6c65 3a0d 0a20 2020 2020 2020 203e 3e3e  le:..        >>>
+0004dec0: 2023 2043 6861 6e67 696e 6720 7468 6520   # Changing the 
+0004ded0: 6261 7463 682d 7369 7a65 2077 6974 6820  batch-size with 
+0004dee0: 6120 6675 6e63 7469 6f6e 0d0a 2020 2020  a function..    
+0004def0: 2020 2020 3e3e 3e20 6672 6f6d 2074 6f72      >>> from tor
+0004df00: 6368 726c 2e65 6e76 7320 696d 706f 7274  chrl.envs import
+0004df10: 2047 796d 456e 760d 0a20 2020 2020 2020   GymEnv..       
+0004df20: 203e 3e3e 2062 6173 655f 656e 7620 3d20   >>> base_env = 
+0004df30: 4779 6d45 6e76 2822 4361 7274 506f 6c65  GymEnv("CartPole
+0004df40: 2d76 3122 290d 0a20 2020 2020 2020 203e  -v1")..        >
+0004df50: 3e3e 2065 6e76 203d 2054 7261 6e73 666f  >> env = Transfo
+0004df60: 726d 6564 456e 7628 6261 7365 5f65 6e76  rmedEnv(base_env
+0004df70: 2c20 4261 7463 6853 697a 6554 7261 6e73  , BatchSizeTrans
+0004df80: 666f 726d 2872 6573 6861 7065 5f66 6e3d  form(reshape_fn=
+0004df90: 6c61 6d62 6461 2064 6174 613a 2064 6174  lambda data: dat
+0004dfa0: 612e 7265 7368 6170 6528 312c 2031 2929  a.reshape(1, 1))
+0004dfb0: 290d 0a20 2020 2020 2020 203e 3e3e 2065  )..        >>> e
+0004dfc0: 6e76 2e72 6f6c 6c6f 7574 2834 290d 0a20  nv.rollout(4).. 
+0004dfd0: 2020 2020 2020 203e 3e3e 2023 2053 6574         >>> # Set
+0004dfe0: 7469 6e67 2074 6865 2073 6861 7065 206f  ting the shape o
+0004dff0: 6620 6120 7374 6174 656c 6573 7320 656e  f a stateless en
+0004e000: 7669 726f 6e6d 656e 740d 0a20 2020 2020  vironment..     
+0004e010: 2020 203e 3e3e 2063 6c61 7373 204d 7945     >>> class MyE
+0004e020: 6e76 2845 6e76 4261 7365 293a 0d0a 2020  nv(EnvBase):..  
+0004e030: 2020 2020 2020 2e2e 2e20 2020 2020 6261        ...     ba
+0004e040: 7463 685f 6c6f 636b 6564 203d 2046 616c  tch_locked = Fal
+0004e050: 7365 0d0a 2020 2020 2020 2020 2e2e 2e20  se..        ... 
+0004e060: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0004e070: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+0004e080: 202e 2e2e 2020 2020 2020 2020 2073 7570   ...         sup
+0004e090: 6572 2829 2e5f 5f69 6e69 745f 5f28 290d  er().__init__().
+0004e0a0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+0004e0b0: 2020 2020 2073 656c 662e 6f62 7365 7276       self.observ
+0004e0c0: 6174 696f 6e5f 7370 6563 203d 2043 6f6d  ation_spec = Com
+0004e0d0: 706f 7369 7465 5370 6563 286f 6273 6572  positeSpec(obser
+0004e0e0: 7661 7469 6f6e 3d55 6e62 6f75 6e64 6564  vation=Unbounded
+0004e0f0: 436f 6e74 696e 756f 7573 5465 6e73 6f72  ContinuousTensor
+0004e100: 5370 6563 2833 2929 0d0a 2020 2020 2020  Spec(3))..      
+0004e110: 2020 2e2e 2e20 2020 2020 2020 2020 7365    ...         se
+0004e120: 6c66 2e72 6577 6172 645f 7370 6563 203d  lf.reward_spec =
+0004e130: 2055 6e62 6f75 6e64 6564 436f 6e74 696e   UnboundedContin
+0004e140: 756f 7573 5465 6e73 6f72 5370 6563 2831  uousTensorSpec(1
+0004e150: 290d 0a20 2020 2020 2020 202e 2e2e 2020  )..        ...  
+0004e160: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
+0004e170: 6f6e 5f73 7065 6320 3d20 556e 626f 756e  on_spec = Unboun
+0004e180: 6465 6443 6f6e 7469 6e75 6f75 7354 656e  dedContinuousTen
+0004e190: 736f 7253 7065 6328 3129 0d0a 2020 2020  sorSpec(1)..    
+0004e1a0: 2020 2020 2e2e 2e0d 0a20 2020 2020 2020      .....       
+0004e1b0: 202e 2e2e 2020 2020 2064 6566 205f 7265   ...     def _re
+0004e1c0: 7365 7428 7365 6c66 2c20 7465 6e73 6f72  set(self, tensor
+0004e1d0: 6469 6374 3a20 5465 6e73 6f72 4469 6374  dict: TensorDict
+0004e1e0: 4261 7365 2c20 2a2a 6b77 6172 6773 2920  Base, **kwargs) 
+0004e1f0: 2d3e 2054 656e 736f 7244 6963 7442 6173  -> TensorDictBas
+0004e200: 653a 0d0a 2020 2020 2020 2020 2e2e 2e20  e:..        ... 
+0004e210: 2020 2020 2020 2020 7465 6e73 6f72 6469          tensordi
+0004e220: 6374 5f62 6174 6368 5f73 697a 6520 3d20  ct_batch_size = 
+0004e230: 7465 6e73 6f72 6469 6374 2e62 6174 6368  tensordict.batch
+0004e240: 5f73 697a 6520 6966 2074 656e 736f 7264  _size if tensord
+0004e250: 6963 7420 6973 206e 6f74 204e 6f6e 6520  ict is not None 
+0004e260: 656c 7365 2074 6f72 6368 2e53 697a 6528  else torch.Size(
+0004e270: 5b5d 290d 0a20 2020 2020 2020 202e 2e2e  [])..        ...
+0004e280: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+0004e290: 3d20 7365 6c66 2e6f 6273 6572 7661 7469  = self.observati
+0004e2a0: 6f6e 5f73 7065 632e 7261 6e64 2874 656e  on_spec.rand(ten
+0004e2b0: 736f 7264 6963 745f 6261 7463 685f 7369  sordict_batch_si
+0004e2c0: 7a65 290d 0a20 2020 2020 2020 202e 2e2e  ze)..        ...
+0004e2d0: 2020 2020 2020 2020 2072 6573 756c 742e           result.
+0004e2e0: 7570 6461 7465 2873 656c 662e 6675 6c6c  update(self.full
+0004e2f0: 5f64 6f6e 655f 7370 6563 2e7a 6572 6f28  _done_spec.zero(
+0004e300: 7465 6e73 6f72 6469 6374 5f62 6174 6368  tensordict_batch
+0004e310: 5f73 697a 6529 290d 0a20 2020 2020 2020  _size))..       
+0004e320: 202e 2e2e 2020 2020 2020 2020 2072 6574   ...         ret
+0004e330: 7572 6e20 7265 7375 6c74 0d0a 2020 2020  urn result..    
+0004e340: 2020 2020 2e2e 2e0d 0a20 2020 2020 2020      .....       
+0004e350: 202e 2e2e 2020 2020 2064 6566 205f 7374   ...     def _st
+0004e360: 6570 280d 0a20 2020 2020 2020 202e 2e2e  ep(..        ...
+0004e370: 2020 2020 2020 2020 2073 656c 662c 0d0a           self,..
+0004e380: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0004e390: 2020 2020 7465 6e73 6f72 6469 6374 3a20      tensordict: 
+0004e3a0: 5465 6e73 6f72 4469 6374 4261 7365 2c0d  TensorDictBase,.
+0004e3b0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+0004e3c0: 2029 202d 3e20 5465 6e73 6f72 4469 6374   ) -> TensorDict
+0004e3d0: 4261 7365 3a0d 0a20 2020 2020 2020 202e  Base:..        .
+0004e3e0: 2e2e 2020 2020 2020 2020 2072 6573 756c  ..         resul
+0004e3f0: 7420 3d20 7365 6c66 2e6f 6273 6572 7661  t = self.observa
+0004e400: 7469 6f6e 5f73 7065 632e 7261 6e64 2874  tion_spec.rand(t
+0004e410: 656e 736f 7264 6963 742e 6261 7463 685f  ensordict.batch_
+0004e420: 7369 7a65 290d 0a20 2020 2020 2020 202e  size)..        .
+0004e430: 2e2e 2020 2020 2020 2020 2072 6573 756c  ..         resul
+0004e440: 742e 7570 6461 7465 2873 656c 662e 6675  t.update(self.fu
+0004e450: 6c6c 5f64 6f6e 655f 7370 6563 2e7a 6572  ll_done_spec.zer
+0004e460: 6f28 7465 6e73 6f72 6469 6374 2e62 6174  o(tensordict.bat
+0004e470: 6368 5f73 697a 6529 290d 0a20 2020 2020  ch_size))..     
+0004e480: 2020 202e 2e2e 2020 2020 2020 2020 2072     ...         r
+0004e490: 6573 756c 742e 7570 6461 7465 2873 656c  esult.update(sel
+0004e4a0: 662e 6675 6c6c 5f72 6577 6172 645f 7370  f.full_reward_sp
+0004e4b0: 6563 2e7a 6572 6f28 7465 6e73 6f72 6469  ec.zero(tensordi
+0004e4c0: 6374 2e62 6174 6368 5f73 697a 6529 290d  ct.batch_size)).
+0004e4d0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+0004e4e0: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+0004e4f0: 6c74 0d0a 2020 2020 2020 2020 2e2e 2e0d  lt..        ....
+0004e500: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+0004e510: 2064 6566 205f 7365 745f 7365 6564 2873   def _set_seed(s
+0004e520: 656c 662c 2073 6565 643a 204f 7074 696f  elf, seed: Optio
+0004e530: 6e61 6c5b 696e 745d 293a 0d0a 2020 2020  nal[int]):..    
+0004e540: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+0004e550: 7061 7373 0d0a 2020 2020 2020 2020 2e2e  pass..        ..
+0004e560: 2e0d 0a20 2020 2020 2020 203e 3e3e 2065  ...        >>> e
+0004e570: 6e76 203d 2054 7261 6e73 666f 726d 6564  nv = Transformed
+0004e580: 456e 7628 4d79 456e 7628 292c 2042 6174  Env(MyEnv(), Bat
+0004e590: 6368 5369 7a65 5472 616e 7366 6f72 6d28  chSizeTransform(
+0004e5a0: 5b35 5d29 290d 0a20 2020 2020 2020 203e  [5]))..        >
+0004e5b0: 3e3e 2061 7373 6572 7420 656e 762e 6261  >> assert env.ba
+0004e5c0: 7463 685f 7369 7a65 203d 3d20 746f 7263  tch_size == torc
+0004e5d0: 682e 5369 7a65 285b 355d 290d 0a20 2020  h.Size([5])..   
+0004e5e0: 2020 2020 203e 3e3e 2061 7373 6572 7420       >>> assert 
+0004e5f0: 656e 762e 726f 6c6c 6f75 7428 3130 292e  env.rollout(10).
+0004e600: 7368 6170 6520 3d3d 2074 6f72 6368 2e53  shape == torch.S
+0004e610: 697a 6528 5b35 2c20 3130 5d29 0d0a 0d0a  ize([5, 10])....
+0004e620: 2020 2020 5468 6520 6060 7265 7365 745f      The ``reset_
+0004e630: 6675 6e63 6060 2063 616e 2063 7265 6174  func`` can creat
+0004e640: 6520 6120 7465 6e73 6f72 6469 6374 2077  e a tensordict w
+0004e650: 6974 6820 7468 6520 6465 7369 7265 6420  ith the desired 
+0004e660: 6261 7463 682d 7369 7a65 2c20 616c 6c6f  batch-size, allo
+0004e670: 7769 6e67 2066 6f72 0d0a 2020 2020 6120  wing for..    a 
+0004e680: 6669 6e65 2d67 7261 696e 6564 2072 6573  fine-grained res
+0004e690: 6574 2063 616c 6c3a 0d0a 0d0a 2020 2020  et call:....    
+0004e6a0: 2020 2020 3e3e 3e20 6465 6620 7265 7365      >>> def rese
+0004e6b0: 745f 6675 6e63 2874 656e 736f 7264 6963  t_func(tensordic
+0004e6c0: 742c 2074 656e 736f 7264 6963 745f 7265  t, tensordict_re
+0004e6d0: 7365 742c 2065 6e76 293a 0d0a 2020 2020  set, env):..    
+0004e6e0: 2020 2020 2e2e 2e20 2020 2020 7265 7375      ...     resu
+0004e6f0: 6c74 203d 2065 6e76 2e6f 6273 6572 7661  lt = env.observa
+0004e700: 7469 6f6e 5f73 7065 632e 7261 6e64 2829  tion_spec.rand()
+0004e710: 0d0a 2020 2020 2020 2020 2e2e 2e20 2020  ..        ...   
+0004e720: 2020 7265 7375 6c74 2e75 7064 6174 6528    result.update(
+0004e730: 656e 762e 6675 6c6c 5f64 6f6e 655f 7370  env.full_done_sp
+0004e740: 6563 2e7a 6572 6f28 2929 0d0a 2020 2020  ec.zero())..    
+0004e750: 2020 2020 2e2e 2e20 2020 2020 6173 7365      ...     asse
+0004e760: 7274 2072 6573 756c 742e 6261 7463 685f  rt result.batch_
+0004e770: 7369 7a65 2021 3d20 746f 7263 682e 5369  size != torch.Si
+0004e780: 7a65 285b 5d29 0d0a 2020 2020 2020 2020  ze([])..        
+0004e790: 2e2e 2e20 2020 2020 7265 7475 726e 2072  ...     return r
+0004e7a0: 6573 756c 740d 0a20 2020 2020 2020 203e  esult..        >
+0004e7b0: 3e3e 2065 6e76 203d 2054 7261 6e73 666f  >> env = Transfo
+0004e7c0: 726d 6564 456e 7628 4d79 456e 7628 292c  rmedEnv(MyEnv(),
+0004e7d0: 2042 6174 6368 5369 7a65 5472 616e 7366   BatchSizeTransf
+0004e7e0: 6f72 6d28 5b35 5d2c 2072 6573 6574 5f66  orm([5], reset_f
+0004e7f0: 756e 633d 7265 7365 745f 6675 6e63 2c20  unc=reset_func, 
+0004e800: 656e 765f 6b77 6172 673d 5472 7565 2929  env_kwarg=True))
+0004e810: 0d0a 2020 2020 2020 2020 3e3e 3e20 7072  ..        >>> pr
+0004e820: 696e 7428 656e 762e 726f 6c6c 6f75 7428  int(env.rollout(
+0004e830: 3229 290d 0a20 2020 2020 2020 2054 656e  2))..        Ten
+0004e840: 736f 7244 6963 7428 0d0a 2020 2020 2020  sorDict(..      
+0004e850: 2020 2020 2020 6669 656c 6473 3d7b 0d0a        fields={..
+0004e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e870: 6163 7469 6f6e 3a20 5465 6e73 6f72 2873  action: Tensor(s
+0004e880: 6861 7065 3d74 6f72 6368 2e53 697a 6528  hape=torch.Size(
+0004e890: 5b35 2c20 322c 2031 5d29 2c20 6465 7669  [5, 2, 1]), devi
+0004e8a0: 6365 3d63 7075 2c20 6474 7970 653d 746f  ce=cpu, dtype=to
+0004e8b0: 7263 682e 666c 6f61 7433 322c 2069 735f  rch.float32, is_
+0004e8c0: 7368 6172 6564 3d46 616c 7365 292c 0d0a  shared=False),..
+0004e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e8e0: 646f 6e65 3a20 5465 6e73 6f72 2873 6861  done: Tensor(sha
+0004e8f0: 7065 3d74 6f72 6368 2e53 697a 6528 5b35  pe=torch.Size([5
+0004e900: 2c20 322c 2031 5d29 2c20 6465 7669 6365  , 2, 1]), device
+0004e910: 3d63 7075 2c20 6474 7970 653d 746f 7263  =cpu, dtype=torc
+0004e920: 682e 626f 6f6c 2c20 6973 5f73 6861 7265  h.bool, is_share
+0004e930: 643d 4661 6c73 6529 2c0d 0a20 2020 2020  d=False),..     
+0004e940: 2020 2020 2020 2020 2020 206e 6578 743a             next:
+0004e950: 2054 656e 736f 7244 6963 7428 0d0a 2020   TensorDict(..  
+0004e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e970: 2020 6669 656c 6473 3d7b 0d0a 2020 2020    fields={..    
+0004e980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e990: 2020 2020 646f 6e65 3a20 5465 6e73 6f72      done: Tensor
+0004e9a0: 2873 6861 7065 3d74 6f72 6368 2e53 697a  (shape=torch.Siz
+0004e9b0: 6528 5b35 2c20 322c 2031 5d29 2c20 6465  e([5, 2, 1]), de
+0004e9c0: 7669 6365 3d63 7075 2c20 6474 7970 653d  vice=cpu, dtype=
+0004e9d0: 746f 7263 682e 626f 6f6c 2c20 6973 5f73  torch.bool, is_s
+0004e9e0: 6861 7265 643d 4661 6c73 6529 2c0d 0a20  hared=False),.. 
+0004e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ea00: 2020 2020 2020 206f 6273 6572 7661 7469         observati
+0004ea10: 6f6e 3a20 5465 6e73 6f72 2873 6861 7065  on: Tensor(shape
+0004ea20: 3d74 6f72 6368 2e53 697a 6528 5b35 2c20  =torch.Size([5, 
+0004ea30: 322c 2033 5d29 2c20 6465 7669 6365 3d63  2, 3]), device=c
+0004ea40: 7075 2c20 6474 7970 653d 746f 7263 682e  pu, dtype=torch.
+0004ea50: 666c 6f61 7433 322c 2069 735f 7368 6172  float32, is_shar
+0004ea60: 6564 3d46 616c 7365 292c 0d0a 2020 2020  ed=False),..    
+0004ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ea80: 2020 2020 7265 7761 7264 3a20 5465 6e73      reward: Tens
+0004ea90: 6f72 2873 6861 7065 3d74 6f72 6368 2e53  or(shape=torch.S
+0004eaa0: 697a 6528 5b35 2c20 322c 2031 5d29 2c20  ize([5, 2, 1]), 
+0004eab0: 6465 7669 6365 3d63 7075 2c20 6474 7970  device=cpu, dtyp
+0004eac0: 653d 746f 7263 682e 666c 6f61 7433 322c  e=torch.float32,
+0004ead0: 2069 735f 7368 6172 6564 3d46 616c 7365   is_shared=False
+0004eae0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0004eaf0: 2020 2020 2020 2020 2020 2020 7465 726d              term
+0004eb00: 696e 6174 6564 3a20 5465 6e73 6f72 2873  inated: Tensor(s
+0004eb10: 6861 7065 3d74 6f72 6368 2e53 697a 6528  hape=torch.Size(
+0004eb20: 5b35 2c20 322c 2031 5d29 2c20 6465 7669  [5, 2, 1]), devi
+0004eb30: 6365 3d63 7075 2c20 6474 7970 653d 746f  ce=cpu, dtype=to
+0004eb40: 7263 682e 626f 6f6c 2c20 6973 5f73 6861  rch.bool, is_sha
+0004eb50: 7265 643d 4661 6c73 6529 7d2c 0d0a 2020  red=False)},..  
+0004eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eb70: 2020 6261 7463 685f 7369 7a65 3d74 6f72    batch_size=tor
+0004eb80: 6368 2e53 697a 6528 5b35 2c20 325d 292c  ch.Size([5, 2]),
+0004eb90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004eba0: 2020 2020 2020 6465 7669 6365 3d4e 6f6e        device=Non
+0004ebb0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0004ebc0: 2020 2020 2020 2020 6973 5f73 6861 7265          is_share
+0004ebd0: 643d 4661 6c73 6529 2c0d 0a20 2020 2020  d=False),..     
+0004ebe0: 2020 2020 2020 2020 2020 206f 6273 6572             obser
+0004ebf0: 7661 7469 6f6e 3a20 5465 6e73 6f72 2873  vation: Tensor(s
+0004ec00: 6861 7065 3d74 6f72 6368 2e53 697a 6528  hape=torch.Size(
+0004ec10: 5b35 2c20 322c 2033 5d29 2c20 6465 7669  [5, 2, 3]), devi
+0004ec20: 6365 3d63 7075 2c20 6474 7970 653d 746f  ce=cpu, dtype=to
+0004ec30: 7263 682e 666c 6f61 7433 322c 2069 735f  rch.float32, is_
+0004ec40: 7368 6172 6564 3d46 616c 7365 292c 0d0a  shared=False),..
+0004ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ec60: 7465 726d 696e 6174 6564 3a20 5465 6e73  terminated: Tens
+0004ec70: 6f72 2873 6861 7065 3d74 6f72 6368 2e53  or(shape=torch.S
+0004ec80: 697a 6528 5b35 2c20 322c 2031 5d29 2c20  ize([5, 2, 1]), 
+0004ec90: 6465 7669 6365 3d63 7075 2c20 6474 7970  device=cpu, dtyp
+0004eca0: 653d 746f 7263 682e 626f 6f6c 2c20 6973  e=torch.bool, is
+0004ecb0: 5f73 6861 7265 643d 4661 6c73 6529 7d2c  _shared=False)},
+0004ecc0: 0d0a 2020 2020 2020 2020 2020 2020 6261  ..            ba
+0004ecd0: 7463 685f 7369 7a65 3d74 6f72 6368 2e53  tch_size=torch.S
+0004ece0: 697a 6528 5b35 2c20 325d 292c 0d0a 2020  ize([5, 2]),..  
+0004ecf0: 2020 2020 2020 2020 2020 6465 7669 6365            device
+0004ed00: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+0004ed10: 2020 2020 6973 5f73 6861 7265 643d 4661      is_shared=Fa
+0004ed20: 6c73 6529 0d0a 0d0a 2020 2020 5468 6973  lse)....    This
+0004ed30: 2074 7261 6e73 666f 726d 2063 616e 2062   transform can b
+0004ed40: 6520 7573 6564 2074 6f20 6465 706c 6f79  e used to deploy
+0004ed50: 206e 6f6e 2d62 6174 6368 2d6c 6f63 6b65   non-batch-locke
+0004ed60: 6420 656e 7669 726f 6e6d 656e 7473 2077  d environments w
+0004ed70: 6974 6869 6e20 6461 7461 0d0a 2020 2020  ithin data..    
+0004ed80: 636f 6c6c 6563 746f 7273 3a0d 0a0d 0a20  collectors:.... 
+0004ed90: 2020 2020 2020 203e 3e3e 2066 726f 6d20         >>> from 
+0004eda0: 746f 7263 6872 6c2e 636f 6c6c 6563 746f  torchrl.collecto
+0004edb0: 7273 2069 6d70 6f72 7420 5379 6e63 4461  rs import SyncDa
+0004edc0: 7461 436f 6c6c 6563 746f 720d 0a20 2020  taCollector..   
+0004edd0: 2020 2020 203e 3e3e 2063 6f6c 6c65 6374       >>> collect
+0004ede0: 6f72 203d 2053 796e 6344 6174 6143 6f6c  or = SyncDataCol
+0004edf0: 6c65 6374 6f72 2865 6e76 2c20 6c61 6d62  lector(env, lamb
+0004ee00: 6461 2074 643a 2065 6e76 2e72 616e 645f  da td: env.rand_
+0004ee10: 6163 7469 6f6e 2874 6429 2c20 6672 616d  action(td), fram
+0004ee20: 6573 5f70 6572 5f62 6174 6368 3d31 302c  es_per_batch=10,
+0004ee30: 2074 6f74 616c 5f66 7261 6d65 733d 2d31   total_frames=-1
+0004ee40: 290d 0a20 2020 2020 2020 203e 3e3e 2066  )..        >>> f
+0004ee50: 6f72 2064 6174 6120 696e 2063 6f6c 6c65  or data in colle
+0004ee60: 6374 6f72 3a0d 0a20 2020 2020 2020 202e  ctor:..        .
+0004ee70: 2e2e 2020 2020 2070 7269 6e74 2864 6174  ..     print(dat
+0004ee80: 6129 0d0a 2020 2020 2020 2020 2e2e 2e20  a)..        ... 
+0004ee90: 2020 2020 6272 6561 6b0d 0a20 2020 2020      break..     
+0004eea0: 2020 2054 656e 736f 7244 6963 7428 0d0a     TensorDict(..
+0004eeb0: 2020 2020 2020 2020 2020 2020 6669 656c              fiel
+0004eec0: 6473 3d7b 0d0a 2020 2020 2020 2020 2020  ds={..          
+0004eed0: 2020 2020 2020 6163 7469 6f6e 3a20 5465        action: Te
+0004eee0: 6e73 6f72 2873 6861 7065 3d74 6f72 6368  nsor(shape=torch
+0004eef0: 2e53 697a 6528 5b35 2c20 322c 2031 5d29  .Size([5, 2, 1])
+0004ef00: 2c20 6465 7669 6365 3d63 7075 2c20 6474  , device=cpu, dt
+0004ef10: 7970 653d 746f 7263 682e 666c 6f61 7433  ype=torch.float3
+0004ef20: 322c 2069 735f 7368 6172 6564 3d46 616c  2, is_shared=Fal
+0004ef30: 7365 292c 0d0a 2020 2020 2020 2020 2020  se),..          
+0004ef40: 2020 2020 2020 636f 6c6c 6563 746f 723a        collector:
+0004ef50: 2054 656e 736f 7244 6963 7428 0d0a 2020   TensorDict(..  
+0004ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ef70: 2020 6669 656c 6473 3d7b 0d0a 2020 2020    fields={..    
+0004ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ef90: 2020 2020 7472 616a 5f69 6473 3a20 5465      traj_ids: Te
+0004efa0: 6e73 6f72 2873 6861 7065 3d74 6f72 6368  nsor(shape=torch
+0004efb0: 2e53 697a 6528 5b35 2c20 325d 292c 2064  .Size([5, 2]), d
+0004efc0: 6576 6963 653d 6370 752c 2064 7479 7065  evice=cpu, dtype
+0004efd0: 3d74 6f72 6368 2e69 6e74 3634 2c20 6973  =torch.int64, is
+0004efe0: 5f73 6861 7265 643d 4661 6c73 6529 7d2c  _shared=False)},
+0004eff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004f000: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
+0004f010: 3d74 6f72 6368 2e53 697a 6528 5b35 2c20  =torch.Size([5, 
+0004f020: 325d 292c 0d0a 2020 2020 2020 2020 2020  2]),..          
+0004f030: 2020 2020 2020 2020 2020 6465 7669 6365            device
+0004f040: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+0004f050: 2020 2020 2020 2020 2020 2020 6973 5f73              is_s
+0004f060: 6861 7265 643d 4661 6c73 6529 2c0d 0a20  hared=False),.. 
+0004f070: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0004f080: 6f6e 653a 2054 656e 736f 7228 7368 6170  one: Tensor(shap
+0004f090: 653d 746f 7263 682e 5369 7a65 285b 352c  e=torch.Size([5,
+0004f0a0: 2032 2c20 315d 292c 2064 6576 6963 653d   2, 1]), device=
+0004f0b0: 6370 752c 2064 7479 7065 3d74 6f72 6368  cpu, dtype=torch
+0004f0c0: 2e62 6f6f 6c2c 2069 735f 7368 6172 6564  .bool, is_shared
+0004f0d0: 3d46 616c 7365 292c 0d0a 2020 2020 2020  =False),..      
+0004f0e0: 2020 2020 2020 2020 2020 6e65 7874 3a20            next: 
+0004f0f0: 5465 6e73 6f72 4469 6374 280d 0a20 2020  TensorDict(..   
+0004f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f110: 2066 6965 6c64 733d 7b0d 0a20 2020 2020   fields={..     
+0004f120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f130: 2020 2064 6f6e 653a 2054 656e 736f 7228     done: Tensor(
+0004f140: 7368 6170 653d 746f 7263 682e 5369 7a65  shape=torch.Size
+0004f150: 285b 352c 2032 2c20 315d 292c 2064 6576  ([5, 2, 1]), dev
+0004f160: 6963 653d 6370 752c 2064 7479 7065 3d74  ice=cpu, dtype=t
+0004f170: 6f72 6368 2e62 6f6f 6c2c 2069 735f 7368  orch.bool, is_sh
+0004f180: 6172 6564 3d46 616c 7365 292c 0d0a 2020  ared=False),..  
+0004f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f1a0: 2020 2020 2020 6f62 7365 7276 6174 696f        observatio
+0004f1b0: 6e3a 2054 656e 736f 7228 7368 6170 653d  n: Tensor(shape=
+0004f1c0: 746f 7263 682e 5369 7a65 285b 352c 2032  torch.Size([5, 2
+0004f1d0: 2c20 335d 292c 2064 6576 6963 653d 6370  , 3]), device=cp
+0004f1e0: 752c 2064 7479 7065 3d74 6f72 6368 2e66  u, dtype=torch.f
+0004f1f0: 6c6f 6174 3332 2c20 6973 5f73 6861 7265  loat32, is_share
+0004f200: 643d 4661 6c73 6529 2c0d 0a20 2020 2020  d=False),..     
+0004f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f220: 2020 2072 6577 6172 643a 2054 656e 736f     reward: Tenso
+0004f230: 7228 7368 6170 653d 746f 7263 682e 5369  r(shape=torch.Si
+0004f240: 7a65 285b 352c 2032 2c20 315d 292c 2064  ze([5, 2, 1]), d
+0004f250: 6576 6963 653d 6370 752c 2064 7479 7065  evice=cpu, dtype
+0004f260: 3d74 6f72 6368 2e66 6c6f 6174 3332 2c20  =torch.float32, 
+0004f270: 6973 5f73 6861 7265 643d 4661 6c73 6529  is_shared=False)
+0004f280: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004f290: 2020 2020 2020 2020 2020 2074 6572 6d69             termi
+0004f2a0: 6e61 7465 643a 2054 656e 736f 7228 7368  nated: Tensor(sh
+0004f2b0: 6170 653d 746f 7263 682e 5369 7a65 285b  ape=torch.Size([
+0004f2c0: 352c 2032 2c20 315d 292c 2064 6576 6963  5, 2, 1]), devic
+0004f2d0: 653d 6370 752c 2064 7479 7065 3d74 6f72  e=cpu, dtype=tor
+0004f2e0: 6368 2e62 6f6f 6c2c 2069 735f 7368 6172  ch.bool, is_shar
+0004f2f0: 6564 3d46 616c 7365 297d 2c0d 0a20 2020  ed=False)},..   
+0004f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f310: 2062 6174 6368 5f73 697a 653d 746f 7263   batch_size=torc
+0004f320: 682e 5369 7a65 285b 352c 2032 5d29 2c0d  h.Size([5, 2]),.
+0004f330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004f340: 2020 2020 2064 6576 6963 653d 4e6f 6e65       device=None
+0004f350: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004f360: 2020 2020 2020 2069 735f 7368 6172 6564         is_shared
+0004f370: 3d46 616c 7365 292c 0d0a 2020 2020 2020  =False),..      
+0004f380: 2020 2020 2020 2020 2020 6f62 7365 7276            observ
+0004f390: 6174 696f 6e3a 2054 656e 736f 7228 7368  ation: Tensor(sh
+0004f3a0: 6170 653d 746f 7263 682e 5369 7a65 285b  ape=torch.Size([
+0004f3b0: 352c 2032 2c20 335d 292c 2064 6576 6963  5, 2, 3]), devic
+0004f3c0: 653d 6370 752c 2064 7479 7065 3d74 6f72  e=cpu, dtype=tor
+0004f3d0: 6368 2e66 6c6f 6174 3332 2c20 6973 5f73  ch.float32, is_s
+0004f3e0: 6861 7265 643d 4661 6c73 6529 2c0d 0a20  hared=False),.. 
+0004f3f0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0004f400: 6572 6d69 6e61 7465 643a 2054 656e 736f  erminated: Tenso
+0004f410: 7228 7368 6170 653d 746f 7263 682e 5369  r(shape=torch.Si
+0004f420: 7a65 285b 352c 2032 2c20 315d 292c 2064  ze([5, 2, 1]), d
+0004f430: 6576 6963 653d 6370 752c 2064 7479 7065  evice=cpu, dtype
+0004f440: 3d74 6f72 6368 2e62 6f6f 6c2c 2069 735f  =torch.bool, is_
+0004f450: 7368 6172 6564 3d46 616c 7365 297d 2c0d  shared=False)},.
+0004f460: 0a20 2020 2020 2020 2020 2020 2062 6174  .            bat
+0004f470: 6368 5f73 697a 653d 746f 7263 682e 5369  ch_size=torch.Si
+0004f480: 7a65 285b 352c 2032 5d29 2c0d 0a20 2020  ze([5, 2]),..   
+0004f490: 2020 2020 2020 2020 2064 6576 6963 653d           device=
+0004f4a0: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+0004f4b0: 2020 2069 735f 7368 6172 6564 3d46 616c     is_shared=Fal
+0004f4c0: 7365 290d 0a20 2020 2020 2020 203e 3e3e  se)..        >>>
+0004f4d0: 2063 6f6c 6c65 6374 6f72 2e73 6875 7464   collector.shutd
+0004f4e0: 6f77 6e28 290d 0a20 2020 2022 2222 0d0a  own()..    """..
+0004f4f0: 0d0a 2020 2020 5f45 4e56 5f45 5252 203d  ..    _ENV_ERR =
+0004f500: 2022 4261 7463 6853 697a 6554 7261 6e73   "BatchSizeTrans
+0004f510: 666f 726d 2e7b 7d20 7265 7175 6972 6573  form.{} requires
+0004f520: 2061 2070 6172 656e 7420 656e 762e 220d   a parent env.".
+0004f530: 0a0d 0a20 2020 2064 6566 205f 5f69 6e69  ...    def __ini
+0004f540: 745f 5f28 0d0a 2020 2020 2020 2020 7365  t__(..        se
+0004f550: 6c66 2c0d 0a20 2020 2020 2020 202a 2c0d  lf,..        *,.
+0004f560: 0a20 2020 2020 2020 2062 6174 6368 5f73  .        batch_s
+0004f570: 697a 653a 2074 6f72 6368 2e53 697a 6520  ize: torch.Size 
+0004f580: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0d0a  | None = None,..
+0004f590: 2020 2020 2020 2020 7265 7368 6170 655f          reshape_
+0004f5a0: 666e 3a20 4361 6c6c 6162 6c65 5b5b 5465  fn: Callable[[Te
+0004f5b0: 6e73 6f72 4469 6374 4261 7365 5d2c 2054  nsorDictBase], T
+0004f5c0: 656e 736f 7244 6963 7442 6173 655d 207c  ensorDictBase] |
+0004f5d0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0d 0a20   None = None,.. 
+0004f5e0: 2020 2020 2020 2072 6573 6574 5f66 756e         reset_fun
+0004f5f0: 633a 2043 616c 6c61 626c 655b 5b54 656e  c: Callable[[Ten
+0004f600: 736f 7244 6963 7442 6173 652c 2054 656e  sorDictBase, Ten
+0004f610: 736f 7244 6963 7442 6173 655d 2c20 5465  sorDictBase], Te
+0004f620: 6e73 6f72 4469 6374 4261 7365 5d0d 0a20  nsorDictBase].. 
+0004f630: 2020 2020 2020 207c 204e 6f6e 6520 3d20         | None = 
+0004f640: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2065  None,..        e
+0004f650: 6e76 5f6b 7761 7267 3a20 626f 6f6c 203d  nv_kwarg: bool =
+0004f660: 2046 616c 7365 2c0d 0a20 2020 2029 3a0d   False,..    ):.
+0004f670: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+0004f680: 2e5f 5f69 6e69 745f 5f28 290d 0a20 2020  .__init__()..   
+0004f690: 2020 2020 2069 6620 6e6f 7420 2828 6261       if not ((ba
+0004f6a0: 7463 685f 7369 7a65 2069 7320 4e6f 6e65  tch_size is None
+0004f6b0: 2920 5e20 2872 6573 6861 7065 5f66 6e20  ) ^ (reshape_fn 
+0004f6c0: 6973 204e 6f6e 6529 293a 0d0a 2020 2020  is None)):..    
+0004f6d0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0004f6e0: 6c75 6545 7272 6f72 280d 0a20 2020 2020  lueError(..     
+0004f6f0: 2020 2020 2020 2020 2020 2022 4f6e 6520             "One 
+0004f700: 616e 6420 6f6e 6c79 206f 6e65 206f 6620  and only one of 
+0004f710: 6261 7463 685f 7369 7a65 204f 5220 7265  batch_size OR re
+0004f720: 7368 6170 655f 666e 206d 7573 7420 6265  shape_fn must be
+0004f730: 2070 726f 7669 6465 642e 220d 0a20 2020   provided."..   
+0004f740: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+0004f750: 2020 2020 6966 2062 6174 6368 5f73 697a      if batch_siz
+0004f760: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
+0004f770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004f780: 2e62 6174 6368 5f73 697a 6520 3d20 746f  .batch_size = to
+0004f790: 7263 682e 5369 7a65 2862 6174 6368 5f73  rch.Size(batch_s
+0004f7a0: 697a 6529 0d0a 2020 2020 2020 2020 2020  ize)..          
+0004f7b0: 2020 7365 6c66 2e72 6573 6861 7065 5f66    self.reshape_f
+0004f7c0: 6e20 3d20 4e6f 6e65 0d0a 2020 2020 2020  n = None..      
+0004f7d0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0004f7e0: 2020 2020 2073 656c 662e 7265 7368 6170       self.reshap
+0004f7f0: 655f 666e 203d 2072 6573 6861 7065 5f66  e_fn = reshape_f
+0004f800: 6e0d 0a20 2020 2020 2020 2020 2020 2073  n..            s
+0004f810: 656c 662e 6261 7463 685f 7369 7a65 203d  elf.batch_size =
+0004f820: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
+0004f830: 656c 662e 7265 7368 6170 655f 666e 203d  elf.reshape_fn =
+0004f840: 2072 6573 6861 7065 5f66 6e0d 0a20 2020   reshape_fn..   
+0004f850: 2020 2020 2073 656c 662e 7265 7365 745f       self.reset_
+0004f860: 6675 6e63 203d 2072 6573 6574 5f66 756e  func = reset_fun
+0004f870: 630d 0a20 2020 2020 2020 2073 656c 662e  c..        self.
+0004f880: 656e 765f 6b77 6172 6720 3d20 656e 765f  env_kwarg = env_
+0004f890: 6b77 6172 670d 0a0d 0a20 2020 2064 6566  kwarg....    def
+0004f8a0: 205f 7265 7365 7428 0d0a 2020 2020 2020   _reset(..      
+0004f8b0: 2020 7365 6c66 2c20 7465 6e73 6f72 6469    self, tensordi
+0004f8c0: 6374 3a20 5465 6e73 6f72 4469 6374 4261  ct: TensorDictBa
+0004f8d0: 7365 2c20 7465 6e73 6f72 6469 6374 5f72  se, tensordict_r
+0004f8e0: 6573 6574 3a20 5465 6e73 6f72 4469 6374  eset: TensorDict
+0004f8f0: 4261 7365 0d0a 2020 2020 2920 2d3e 2054  Base..    ) -> T
+0004f900: 656e 736f 7244 6963 7442 6173 653a 0d0a  ensorDictBase:..
+0004f910: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0004f920: 7265 7365 745f 6675 6e63 2069 7320 6e6f  reset_func is no
+0004f930: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0004f940: 2020 2020 2069 6620 7365 6c66 2e65 6e76       if self.env
+0004f950: 5f6b 7761 7267 3a0d 0a20 2020 2020 2020  _kwarg:..       
+0004f960: 2020 2020 2020 2020 2074 656e 736f 7264           tensord
+0004f970: 6963 745f 7265 7365 7420 3d20 7365 6c66  ict_reset = self
+0004f980: 2e72 6573 6574 5f66 756e 6328 0d0a 2020  .reset_func(..  
+0004f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f9a0: 2020 7465 6e73 6f72 6469 6374 2c20 7465    tensordict, te
+0004f9b0: 6e73 6f72 6469 6374 5f72 6573 6574 2c20  nsordict_reset, 
+0004f9c0: 656e 763d 7365 6c66 2e63 6f6e 7461 696e  env=self.contain
+0004f9d0: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+0004f9e0: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+0004f9f0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0004fa00: 2020 2020 2020 2020 2020 7465 6e73 6f72            tensor
+0004fa10: 6469 6374 5f72 6573 6574 203d 2073 656c  dict_reset = sel
+0004fa20: 662e 7265 7365 745f 6675 6e63 2874 656e  f.reset_func(ten
+0004fa30: 736f 7264 6963 742c 2074 656e 736f 7264  sordict, tensord
+0004fa40: 6963 745f 7265 7365 7429 0d0a 2020 2020  ict_reset)..    
+0004fa50: 2020 2020 6966 2073 656c 662e 6261 7463      if self.batc
+0004fa60: 685f 7369 7a65 2069 7320 6e6f 7420 4e6f  h_size is not No
+0004fa70: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0004fa80: 2072 6574 7572 6e20 7465 6e73 6f72 6469   return tensordi
+0004fa90: 6374 5f72 6573 6574 2e65 7870 616e 6428  ct_reset.expand(
+0004faa0: 7365 6c66 2e62 6174 6368 5f73 697a 6529  self.batch_size)
+0004fab0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0004fac0: 2073 656c 662e 7265 7368 6170 655f 666e   self.reshape_fn
+0004fad0: 2874 656e 736f 7264 6963 745f 7265 7365  (tensordict_rese
+0004fae0: 7429 0d0a 0d0a 2020 2020 6465 6620 5f63  t)....    def _c
+0004faf0: 616c 6c28 7365 6c66 2c20 7465 6e73 6f72  all(self, tensor
+0004fb00: 6469 6374 3a20 5465 6e73 6f72 4469 6374  dict: TensorDict
+0004fb10: 4261 7365 2920 2d3e 2054 656e 736f 7244  Base) -> TensorD
+0004fb20: 6963 7442 6173 653a 0d0a 2020 2020 2020  ictBase:..      
+0004fb30: 2020 6966 2073 656c 662e 7265 7368 6170    if self.reshap
+0004fb40: 655f 666e 2069 7320 6e6f 7420 4e6f 6e65  e_fn is not None
+0004fb50: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
+0004fb60: 656e 736f 7264 6963 7420 3d20 7365 6c66  ensordict = self
+0004fb70: 2e72 6573 6861 7065 5f66 6e28 7465 6e73  .reshape_fn(tens
+0004fb80: 6f72 6469 6374 290d 0a20 2020 2020 2020  ordict)..       
+0004fb90: 2072 6574 7572 6e20 7465 6e73 6f72 6469   return tensordi
+0004fba0: 6374 0d0a 0d0a 2020 2020 666f 7277 6172  ct....    forwar
+0004fbb0: 6420 3d20 5f63 616c 6c0d 0a0d 0a20 2020  d = _call....   
+0004fbc0: 2064 6566 205f 696e 765f 6361 6c6c 2873   def _inv_call(s
+0004fbd0: 656c 662c 2074 656e 736f 7264 6963 743a  elf, tensordict:
+0004fbe0: 2054 656e 736f 7244 6963 7442 6173 6529   TensorDictBase)
+0004fbf0: 202d 3e20 5465 6e73 6f72 4469 6374 4261   -> TensorDictBa
+0004fc00: 7365 3a0d 0a20 2020 2020 2020 2069 6620  se:..        if 
+0004fc10: 7365 6c66 2e72 6573 6861 7065 5f66 6e20  self.reshape_fn 
+0004fc20: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+0004fc30: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+0004fc40: 203d 2073 656c 662e 7061 7265 6e74 0d0a   = self.parent..
+0004fc50: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0004fc60: 6172 656e 7420 6973 206e 6f74 204e 6f6e  arent is not Non
+0004fc70: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0004fc80: 2020 2020 7061 7265 6e74 5f62 6174 6368      parent_batch
+0004fc90: 5f73 697a 6520 3d20 7061 7265 6e74 2e62  _size = parent.b
+0004fca0: 6174 6368 5f73 697a 650d 0a20 2020 2020  atch_size..     
+0004fcb0: 2020 2020 2020 2020 2020 2074 656e 736f             tenso
+0004fcc0: 7264 6963 7420 3d20 7465 6e73 6f72 6469  rdict = tensordi
+0004fcd0: 6374 2e72 6573 6861 7065 2870 6172 656e  ct.reshape(paren
+0004fce0: 745f 6261 7463 685f 7369 7a65 290d 0a20  t_batch_size).. 
+0004fcf0: 2020 2020 2020 2072 6574 7572 6e20 7465         return te
+0004fd00: 6e73 6f72 6469 6374 0d0a 0d0a 2020 2020  nsordict....    
+0004fd10: 6465 6620 7472 616e 7366 6f72 6d5f 656e  def transform_en
+0004fd20: 765f 6261 7463 685f 7369 7a65 2873 656c  v_batch_size(sel
+0004fd30: 662c 2062 6174 6368 5f73 697a 653a 2074  f, batch_size: t
+0004fd40: 6f72 6368 2e53 697a 6529 3a0d 0a20 2020  orch.Size):..   
+0004fd50: 2020 2020 2069 6620 7365 6c66 2e62 6174       if self.bat
+0004fd60: 6368 5f73 697a 6520 6973 206e 6f74 204e  ch_size is not N
+0004fd70: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0004fd80: 2020 7265 7475 726e 2073 656c 662e 6261    return self.ba
+0004fd90: 7463 685f 7369 7a65 0d0a 2020 2020 2020  tch_size..      
+0004fda0: 2020 7265 7475 726e 2073 656c 662e 7265    return self.re
+0004fdb0: 7368 6170 655f 666e 2874 6f72 6368 2e7a  shape_fn(torch.z
+0004fdc0: 6572 6f73 2862 6174 6368 5f73 697a 652c  eros(batch_size,
+0004fdd0: 2064 6576 6963 653d 226d 6574 6122 2929   device="meta"))
+0004fde0: 2e73 6861 7065 0d0a 0d0a 2020 2020 6465  .shape....    de
+0004fdf0: 6620 7472 616e 7366 6f72 6d5f 6f75 7470  f transform_outp
+0004fe00: 7574 5f73 7065 6328 7365 6c66 2c20 6f75  ut_spec(self, ou
+0004fe10: 7470 7574 5f73 7065 633a 2043 6f6d 706f  tput_spec: Compo
+0004fe20: 7369 7465 5370 6563 2920 2d3e 2043 6f6d  siteSpec) -> Com
+0004fe30: 706f 7369 7465 5370 6563 3a0d 0a20 2020  positeSpec:..   
+0004fe40: 2020 2020 2069 6620 7365 6c66 2e62 6174       if self.bat
+0004fe50: 6368 5f73 697a 6520 6973 206e 6f74 204e  ch_size is not N
+0004fe60: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0004fe70: 2020 7265 7475 726e 206f 7574 7075 745f    return output_
+0004fe80: 7370 6563 2e65 7870 616e 6428 7365 6c66  spec.expand(self
+0004fe90: 2e62 6174 6368 5f73 697a 6529 0d0a 2020  .batch_size)..  
+0004fea0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0004feb0: 662e 7265 7368 6170 655f 666e 286f 7574  f.reshape_fn(out
+0004fec0: 7075 745f 7370 6563 290d 0a0d 0a20 2020  put_spec)....   
+0004fed0: 2064 6566 2074 7261 6e73 666f 726d 5f69   def transform_i
+0004fee0: 6e70 7574 5f73 7065 6328 7365 6c66 2c20  nput_spec(self, 
+0004fef0: 696e 7075 745f 7370 6563 3a20 436f 6d70  input_spec: Comp
+0004ff00: 6f73 6974 6553 7065 6329 202d 3e20 436f  ositeSpec) -> Co
+0004ff10: 6d70 6f73 6974 6553 7065 633a 0d0a 2020  mpositeSpec:..  
+0004ff20: 2020 2020 2020 6966 2073 656c 662e 6261        if self.ba
+0004ff30: 7463 685f 7369 7a65 2069 7320 6e6f 7420  tch_size is not 
+0004ff40: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0004ff50: 2020 2072 6574 7572 6e20 696e 7075 745f     return input_
+0004ff60: 7370 6563 2e65 7870 616e 6428 7365 6c66  spec.expand(self
+0004ff70: 2e62 6174 6368 5f73 697a 6529 0d0a 2020  .batch_size)..  
+0004ff80: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0004ff90: 662e 7265 7368 6170 655f 666e 2869 6e70  f.reshape_fn(inp
+0004ffa0: 7574 5f73 7065 6329 0d0a 0d0a 0d0a 636c  ut_spec)......cl
+0004ffb0: 6173 7320 4175 746f 5265 7365 7445 6e76  ass AutoResetEnv
+0004ffc0: 2854 7261 6e73 666f 726d 6564 456e 7629  (TransformedEnv)
+0004ffd0: 3a0d 0a20 2020 2022 2222 4120 7375 6263  :..    """A subc
+0004ffe0: 6c61 7373 2066 6f72 2061 7574 6f2d 7265  lass for auto-re
+0004fff0: 7365 7474 696e 6720 656e 7673 2e22 2222  setting envs."""
+00050000: 0d0a 0d0a 2020 2020 6465 6620 5f72 6573  ....    def _res
+00050010: 6574 2873 656c 662c 2074 656e 736f 7264  et(self, tensord
+00050020: 6963 743a 204f 7074 696f 6e61 6c5b 5465  ict: Optional[Te
+00050030: 6e73 6f72 4469 6374 4261 7365 5d20 3d20  nsorDictBase] = 
+00050040: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+00050050: 0d0a 2020 2020 2020 2020 6966 2074 656e  ..        if ten
+00050060: 736f 7264 6963 7420 6973 206e 6f74 204e  sordict is not N
+00050070: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00050080: 2020 2320 5765 206d 7573 7420 6176 6f69    # We must avoi
+00050090: 6420 6d6f 6469 6679 696e 6720 7468 6520  d modifying the 
+000500a0: 6f72 6967 696e 616c 2074 656e 736f 7264  original tensord
+000500b0: 6963 7420 736f 2061 2073 6861 6c6c 6f77  ict so a shallow
+000500c0: 2063 6f70 7920 6973 206e 6563 6573 7361   copy is necessa
+000500d0: 7279 2e0d 0a20 2020 2020 2020 2020 2020  ry...           
+000500e0: 2023 2057 6520 6a75 7374 2073 656c 6563   # We just selec
+000500f0: 7420 7468 6520 696e 7075 7420 6461 7461  t the input data
+00050100: 2061 6e64 2072 6573 6574 2073 6967 6e61   and reset signa
+00050110: 6c2c 2077 6869 6368 2069 7320 616c 6c20  l, which is all 
+00050120: 7765 206e 6565 642e 0d0a 2020 2020 2020  we need...      
+00050130: 2020 2020 2020 7465 6e73 6f72 6469 6374        tensordict
+00050140: 203d 2074 656e 736f 7264 6963 742e 7365   = tensordict.se
+00050150: 6c65 6374 280d 0a20 2020 2020 2020 2020  lect(..         
+00050160: 2020 2020 2020 202a 7365 6c66 2e72 6573         *self.res
+00050170: 6574 5f6b 6579 732c 202a 7365 6c66 2e73  et_keys, *self.s
+00050180: 7461 7465 5f73 7065 632e 6b65 7973 2854  tate_spec.keys(T
+00050190: 7275 652c 2054 7275 6529 2c20 7374 7269  rue, True), stri
+000501a0: 6374 3d46 616c 7365 0d0a 2020 2020 2020  ct=False..      
+000501b0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000501c0: 2066 6f72 2072 6573 6574 5f6b 6579 2069   for reset_key i
+000501d0: 6e20 7365 6c66 2e62 6173 655f 656e 762e  n self.base_env.
+000501e0: 7265 7365 745f 6b65 7973 3a0d 0a20 2020  reset_keys:..   
+000501f0: 2020 2020 2020 2020 2069 6620 7465 6e73           if tens
+00050200: 6f72 6469 6374 2069 7320 6e6f 7420 4e6f  ordict is not No
+00050210: 6e65 2061 6e64 2072 6573 6574 5f6b 6579  ne and reset_key
+00050220: 2069 6e20 7465 6e73 6f72 6469 6374 2e6b   in tensordict.k
+00050230: 6579 7328 5472 7565 293a 0d0a 2020 2020  eys(True):..    
+00050240: 2020 2020 2020 2020 2020 2020 7465 6e73              tens
+00050250: 6f72 6469 6374 5f72 6573 6574 203d 2074  ordict_reset = t
+00050260: 656e 736f 7264 6963 742e 6578 636c 7564  ensordict.exclud
+00050270: 6528 2a73 656c 662e 6261 7365 5f65 6e76  e(*self.base_env
+00050280: 2e72 6573 6574 5f6b 6579 7329 0d0a 2020  .reset_keys)..  
+00050290: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000502a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000502b0: 2074 656e 736f 7264 6963 745f 7265 7365   tensordict_rese
+000502c0: 7420 3d20 7365 6c66 2e62 6173 655f 656e  t = self.base_en
+000502d0: 762e 5f72 6573 6574 2874 656e 736f 7264  v._reset(tensord
+000502e0: 6963 742c 202a 2a6b 7761 7267 7329 0d0a  ict, **kwargs)..
+000502f0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00050300: 6b0d 0a20 2020 2020 2020 2069 6620 7465  k..        if te
+00050310: 6e73 6f72 6469 6374 2069 7320 4e6f 6e65  nsordict is None
+00050320: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00050330: 206d 616b 6520 7375 7265 2061 6c6c 2074   make sure all t
+00050340: 7261 6e73 666f 726d 7320 7365 6520 6120  ransforms see a 
+00050350: 736f 7572 6365 2074 656e 736f 7264 6963  source tensordic
+00050360: 740d 0a20 2020 2020 2020 2020 2020 2074  t..            t
+00050370: 656e 736f 7264 6963 7420 3d20 7465 6e73  ensordict = tens
+00050380: 6f72 6469 6374 5f72 6573 6574 2e65 6d70  ordict_reset.emp
+00050390: 7479 2829 0d0a 2020 2020 2020 2020 7365  ty()..        se
+000503a0: 6c66 2e62 6173 655f 656e 762e 5f63 6f6d  lf.base_env._com
+000503b0: 706c 6574 655f 646f 6e65 2873 656c 662e  plete_done(self.
+000503c0: 6261 7365 5f65 6e76 2e66 756c 6c5f 646f  base_env.full_do
+000503d0: 6e65 5f73 7065 632c 2074 656e 736f 7264  ne_spec, tensord
+000503e0: 6963 745f 7265 7365 7429 0d0a 2020 2020  ict_reset)..    
+000503f0: 2020 2020 7465 6e73 6f72 6469 6374 5f72      tensordict_r
+00050400: 6573 6574 203d 2073 656c 662e 7472 616e  eset = self.tran
+00050410: 7366 6f72 6d2e 5f72 6573 6574 2874 656e  sform._reset(ten
+00050420: 736f 7264 6963 742c 2074 656e 736f 7264  sordict, tensord
+00050430: 6963 745f 7265 7365 7429 0d0a 2020 2020  ict_reset)..    
+00050440: 2020 2020 7265 7475 726e 2074 656e 736f      return tenso
+00050450: 7264 6963 745f 7265 7365 740d 0a0d 0a20  rdict_reset.... 
+00050460: 2020 2064 6566 2069 6e73 6572 745f 7472     def insert_tr
+00050470: 616e 7366 6f72 6d28 7365 6c66 2c20 696e  ansform(self, in
+00050480: 6465 783a 2069 6e74 2c20 7472 616e 7366  dex: int, transf
+00050490: 6f72 6d3a 2054 7261 6e73 666f 726d 2920  orm: Transform) 
+000504a0: 2d3e 204e 6f6e 653a 0d0a 2020 2020 2020  -> None:..      
+000504b0: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
+000504c0: 7272 6f72 2866 2243 616e 6e6f 7420 696e  rror(f"Cannot in
+000504d0: 7365 7274 2061 2074 7261 6e73 666f 726d  sert a transform
+000504e0: 2069 6e20 7b73 656c 662e 5f5f 636c 6173   in {self.__clas
+000504f0: 735f 2e5f 5f6e 616d 655f 5f7d 2e22 290d  s_.__name__}.").
+00050500: 0a0d 0a0d 0a63 6c61 7373 2041 7574 6f52  .....class AutoR
+00050510: 6573 6574 5472 616e 7366 6f72 6d28 5472  esetTransform(Tr
+00050520: 616e 7366 6f72 6d29 3a0d 0a20 2020 2022  ansform):..    "
+00050530: 2222 4120 7472 616e 7366 6f72 6d20 666f  ""A transform fo
+00050540: 7220 6175 746f 2d72 6573 6574 7469 6e67  r auto-resetting
+00050550: 2065 6e76 6972 6f6e 6d65 6e74 732e 0d0a   environments...
+00050560: 0d0a 2020 2020 5468 6973 2074 7261 6e73  ..    This trans
+00050570: 666f 726d 2063 616e 2062 6520 6170 7065  form can be appe
+00050580: 6e64 6564 2074 6f20 616e 7920 6175 746f  nded to any auto
+00050590: 2d72 6573 6574 7469 6e67 2065 6e76 6972  -resetting envir
+000505a0: 6f6e 6d65 6e74 2c20 6f72 2061 7574 6f6d  onment, or autom
+000505b0: 6174 6963 616c 6c79 0d0a 2020 2020 6170  atically..    ap
+000505c0: 7065 6e64 6564 2075 7369 6e67 2060 6065  pended using ``e
+000505d0: 6e76 203d 2053 6f6d 6545 6e76 436c 6173  nv = SomeEnvClas
+000505e0: 7328 2e2e 2e2c 2061 7574 6f5f 7265 7365  s(..., auto_rese
+000505f0: 743d 5472 7565 2960 602e 2049 6620 7468  t=True)``. If th
+00050600: 6520 7472 616e 7366 6f72 6d20 6973 2065  e transform is e
+00050610: 7870 6c69 6369 746c 790d 0a20 2020 2061  xplicitly..    a
+00050620: 7070 656e 6465 6420 746f 2061 6e20 656e  ppended to an en
+00050630: 762c 2061 203a 636c 6173 733a 607e 746f  v, a :class:`~to
+00050640: 7263 6872 6c2e 656e 7673 2e74 7261 6e73  rchrl.envs.trans
+00050650: 666f 726d 732e 4175 746f 5265 7365 7445  forms.AutoResetE
+00050660: 6e76 6020 6d75 7374 2062 6520 7573 6564  nv` must be used
+00050670: 2e0d 0a0d 0a20 2020 2041 6e20 6175 746f  .....    An auto
+00050680: 2d72 6573 6574 2065 6e76 6972 6f6e 6d65  -reset environme
+00050690: 6e74 206d 7573 7420 6861 7665 2074 6865  nt must have the
+000506a0: 2066 6f6c 6c6f 7769 6e67 2070 726f 7065   following prope
+000506b0: 7274 6965 7320 2864 6966 6665 7265 6e63  rties (differenc
+000506c0: 6573 2066 726f 6d20 7468 6973 0d0a 2020  es from this..  
+000506d0: 2020 6465 7363 7269 7074 696f 6e20 7368    description sh
+000506e0: 6f75 6c64 2062 6520 6163 636f 756e 7465  ould be accounte
+000506f0: 6420 666f 7220 6279 2073 7562 636c 6173  d for by subclas
+00050700: 7369 6e67 2074 6869 7320 636c 6173 7329  sing this class)
+00050710: 3a0d 0a0d 0a20 2020 2020 202d 2074 6865  :....      - the
+00050720: 2072 6573 6574 2066 756e 6374 696f 6e20   reset function 
+00050730: 6361 6e20 6265 2063 616c 6c65 6420 6f6e  can be called on
+00050740: 6365 2061 7420 7468 6520 6265 6769 6e6e  ce at the beginn
+00050750: 696e 6720 2861 6674 6572 2069 6e73 7461  ing (after insta
+00050760: 6e74 6961 7469 6f6e 2920 7769 7468 0d0a  ntiation) with..
+00050770: 2020 2020 2020 2020 6f72 2077 6974 686f          or witho
+00050780: 7574 2065 6666 6563 742e 2057 6865 7468  ut effect. Wheth
+00050790: 6572 2063 616c 6c73 2074 6f20 6072 6573  er calls to `res
+000507a0: 6574 6020 6172 6520 616c 6c6f 7765 6420  et` are allowed 
+000507b0: 6166 7465 7220 7468 6174 2069 7320 7570  after that is up
+000507c0: 2074 6f20 7468 650d 0a20 2020 2020 2020   to the..       
+000507d0: 2065 6e76 6972 6f6e 6d65 6e74 2069 7473   environment its
+000507e0: 656c 662e 0d0a 2020 2020 2020 2d20 4475  elf...      - Du
+000507f0: 7269 6e67 2061 2072 6f6c 6c6f 7574 2c20  ring a rollout, 
+00050800: 616e 7920 6060 646f 6e65 6060 2073 7461  any ``done`` sta
+00050810: 7465 2077 696c 6c20 7265 7375 6c74 2069  te will result i
+00050820: 6e20 6120 7265 7365 7420 616e 6420 7072  n a reset and pr
+00050830: 6f64 7563 6520 616e 206f 6273 6572 7661  oduce an observa
+00050840: 7469 6f6e 0d0a 2020 2020 2020 2020 7468  tion..        th
+00050850: 6174 2069 736e 2774 2074 6865 206c 6173  at isn't the las
+00050860: 7420 6f62 7365 7276 6174 696f 6e20 6f66  t observation of
+00050870: 2074 6865 2063 7572 7265 6e74 2065 7069   the current epi
+00050880: 736f 6465 2c20 6275 7420 7468 6520 6669  sode, but the fi
+00050890: 7273 7420 6f62 7365 7276 6174 696f 6e0d  rst observation.
+000508a0: 0a20 2020 2020 2020 206f 6620 7468 6520  .        of the 
+000508b0: 6e65 7874 2065 7069 736f 6465 2028 7468  next episode (th
+000508c0: 6973 2074 7261 6e73 666f 726d 2077 696c  is transform wil
+000508d0: 6c20 6578 7472 6163 7420 616e 6420 6361  l extract and ca
+000508e0: 6368 6520 7468 6973 206f 6273 6572 7661  che this observa
+000508f0: 7469 6f6e 0d0a 2020 2020 2020 2020 616e  tion..        an
+00050900: 6420 6669 6c6c 2074 6865 206f 6273 2077  d fill the obs w
+00050910: 6974 6820 736f 6d65 2061 7262 6974 7261  ith some arbitra
+00050920: 7279 2076 616c 7565 292e 0d0a 0d0a 2020  ry value).....  
+00050930: 2020 4b65 7977 6f72 6420 4172 6773 3a0d    Keyword Args:.
+00050940: 0a20 2020 2020 2020 2072 6570 6c61 6365  .        replace
+00050950: 2028 626f 6f6c 2c20 6f70 7469 6f6e 616c   (bool, optional
+00050960: 293a 2069 6620 6060 4661 6c73 6560 602c  ): if ``False``,
+00050970: 2076 616c 7565 7320 6172 6520 6a75 7374   values are just
+00050980: 2070 6c61 6365 6420 6173 2074 6865 7920   placed as they 
+00050990: 6172 6520 696e 2074 6865 0d0a 2020 2020  are in the..    
+000509a0: 2020 2020 2020 2020 6060 226e 6578 7422          ``"next"
+000509b0: 6060 2065 6e74 7279 2065 7665 6e20 6966  `` entry even if
+000509c0: 2074 6865 7920 6172 6520 6e6f 7420 7661   they are not va
+000509d0: 6c69 642e 2044 6566 6175 6c74 7320 746f  lid. Defaults to
+000509e0: 2060 6054 7275 6560 602e 2041 2076 616c   ``True``. A val
+000509f0: 7565 206f 660d 0a20 2020 2020 2020 2020  ue of..         
+00050a00: 2020 2060 6046 616c 7365 6060 206f 7665     ``False`` ove
+00050a10: 7272 6964 6573 2061 6e79 2073 7562 7365  rrides any subse
+00050a20: 7175 656e 7420 6669 6c6c 696e 6720 6b65  quent filling ke
+00050a30: 7977 6f72 6420 6172 6775 6d65 6e74 2e0d  yword argument..
+00050a40: 0a20 2020 2020 2020 2020 2020 2054 6869  .            Thi
+00050a50: 7320 6172 6775 6d65 7420 6361 6e20 616c  s argumet can al
+00050a60: 736f 2062 6520 7061 7373 6564 2077 6974  so be passed wit
+00050a70: 6820 7468 6520 636f 6e73 7472 7563 746f  h the constructo
+00050a80: 7220 6d65 7468 6f64 2062 7920 7061 7373  r method by pass
+00050a90: 696e 6720 610d 0a20 2020 2020 2020 2020  ing a..         
+00050aa0: 2020 2060 6061 7574 6f5f 7265 7365 745f     ``auto_reset_
+00050ab0: 7265 706c 6163 6560 6020 6172 6775 6d65  replace`` argume
+00050ac0: 6e74 3a20 6060 656e 7620 3d20 466f 6f45  nt: ``env = FooE
+00050ad0: 6e76 282e 2e2e 2c20 6175 746f 5f72 6573  nv(..., auto_res
+00050ae0: 6574 3d54 7275 652c 2061 7574 6f5f 7265  et=True, auto_re
+00050af0: 7365 745f 7265 706c 6163 653d 4661 6c73  set_replace=Fals
+00050b00: 6529 6060 2e0d 0a20 2020 2020 2020 2066  e)``...        f
+00050b10: 696c 6c5f 666c 6f61 7420 2866 6c6f 6174  ill_float (float
+00050b20: 206f 7220 7374 722c 206f 7074 696f 6e61   or str, optiona
+00050b30: 6c29 3a20 5468 6520 6669 6c6c 696e 6720  l): The filling 
+00050b40: 7661 6c75 6520 666f 7220 666c 6f61 7469  value for floati
+00050b50: 6e67 2070 6f69 6e74 2074 656e 736f 7273  ng point tensors
+00050b60: 0d0a 2020 2020 2020 2020 2020 2020 7468  ..            th
+00050b70: 6174 2074 6572 6d69 6e61 7465 2061 6e20  at terminate an 
+00050b80: 6570 6973 6f64 652e 2041 2076 616c 7565  episode. A value
+00050b90: 206f 6620 6060 4e6f 6e65 6060 206d 6561   of ``None`` mea
+00050ba0: 6e73 206e 6f20 7265 706c 6163 656d 656e  ns no replacemen
+00050bb0: 7420 2876 616c 7565 7320 6172 6520 6a75  t (values are ju
+00050bc0: 7374 0d0a 2020 2020 2020 2020 2020 2020  st..            
+00050bd0: 706c 6163 6564 2061 7320 7468 6579 2061  placed as they a
+00050be0: 7265 2069 6e20 7468 6520 6060 226e 6578  re in the ``"nex
+00050bf0: 7422 6060 2065 6e74 7279 2065 7665 6e20  t"`` entry even 
+00050c00: 6966 2074 6865 7920 6172 6520 6e6f 7420  if they are not 
+00050c10: 7661 6c69 6429 2e0d 0a20 2020 2020 2020  valid)...       
+00050c20: 2066 696c 6c5f 696e 7420 2869 6e74 2c20   fill_int (int, 
+00050c30: 6f70 7469 6f6e 616c 293a 2054 6865 2066  optional): The f
+00050c40: 696c 6c69 6e67 2076 616c 7565 2066 6f72  illing value for
+00050c50: 2073 6967 6e65 6420 696e 7465 6765 7220   signed integer 
+00050c60: 7465 6e73 6f72 730d 0a20 2020 2020 2020  tensors..       
+00050c70: 2020 2020 2074 6861 7420 7465 726d 696e       that termin
+00050c80: 6174 6520 616e 2065 7069 736f 6465 2e20  ate an episode. 
+00050c90: 2041 2076 616c 7565 206f 6620 6060 4e6f   A value of ``No
+00050ca0: 6e65 6060 206d 6561 6e73 206e 6f20 7265  ne`` means no re
+00050cb0: 706c 6163 656d 656e 7420 2876 616c 7565  placement (value
+00050cc0: 7320 6172 6520 6a75 7374 0d0a 2020 2020  s are just..    
+00050cd0: 2020 2020 2020 2020 706c 6163 6564 2061          placed a
+00050ce0: 7320 7468 6579 2061 7265 2069 6e20 7468  s they are in th
+00050cf0: 6520 6060 226e 6578 7422 6060 2065 6e74  e ``"next"`` ent
+00050d00: 7279 2065 7665 6e20 6966 2074 6865 7920  ry even if they 
+00050d10: 6172 6520 6e6f 7420 7661 6c69 6429 2e0d  are not valid)..
+00050d20: 0a20 2020 2020 2020 2066 696c 6c5f 626f  .        fill_bo
+00050d30: 6f6c 2028 626f 6f6c 2c20 6f70 7469 6f6e  ol (bool, option
+00050d40: 616c 293a 2054 6865 2066 696c 6c69 6e67  al): The filling
+00050d50: 2076 616c 7565 2066 6f72 2062 6f6f 6c65   value for boole
+00050d60: 616e 2074 656e 736f 7273 0d0a 2020 2020  an tensors..    
+00050d70: 2020 2020 2020 2020 7468 6174 2074 6572          that ter
+00050d80: 6d69 6e61 7465 2061 6e20 6570 6973 6f64  minate an episod
+00050d90: 652e 2020 4120 7661 6c75 6520 6f66 2060  e.  A value of `
+00050da0: 604e 6f6e 6560 6020 6d65 616e 7320 6e6f  `None`` means no
+00050db0: 2072 6570 6c61 6365 6d65 6e74 2028 7661   replacement (va
+00050dc0: 6c75 6573 2061 7265 206a 7573 740d 0a20  lues are just.. 
+00050dd0: 2020 2020 2020 2020 2020 2070 6c61 6365             place
+00050de0: 6420 6173 2074 6865 7920 6172 6520 696e  d as they are in
+00050df0: 2074 6865 2060 6022 6e65 7874 2260 6020   the ``"next"`` 
+00050e00: 656e 7472 7920 6576 656e 2069 6620 7468  entry even if th
+00050e10: 6579 2061 7265 206e 6f74 2076 616c 6964  ey are not valid
+00050e20: 292e 0d0a 0d0a 2020 2020 4172 6775 6d65  ).....    Argume
+00050e30: 6e74 7320 6172 6520 6f6e 6c79 2061 7661  nts are only ava
+00050e40: 696c 6162 6c65 2077 6865 6e20 7468 6520  ilable when the 
+00050e50: 7472 616e 7366 6f72 6d20 6973 2065 7870  transform is exp
+00050e60: 6c69 6369 746c 7920 696e 7374 616e 7469  licitly instanti
+00050e70: 6174 6564 2028 6e6f 7420 7468 726f 7567  ated (not throug
+00050e80: 6820 6045 6e76 5479 7065 282e 2e2e 2c20  h `EnvType(..., 
+00050e90: 6175 746f 5f72 6573 6574 3d54 7275 6529  auto_reset=True)
+00050ea0: 6029 2e0d 0a0d 0a20 2020 2045 7861 6d70  `).....    Examp
+00050eb0: 6c65 733a 0d0a 2020 2020 2020 2020 3e3e  les:..        >>
+00050ec0: 3e20 6672 6f6d 2074 6f72 6368 726c 2e65  > from torchrl.e
+00050ed0: 6e76 7320 696d 706f 7274 2047 796d 456e  nvs import GymEn
+00050ee0: 760d 0a20 2020 2020 2020 203e 3e3e 2066  v..        >>> f
+00050ef0: 726f 6d20 746f 7263 6872 6c2e 656e 7673  rom torchrl.envs
+00050f00: 2069 6d70 6f72 7420 7365 745f 6779 6d5f   import set_gym_
+00050f10: 6261 636b 656e 640d 0a20 2020 2020 2020  backend..       
+00050f20: 203e 3e3e 2069 6d70 6f72 7420 746f 7263   >>> import torc
+00050f30: 680d 0a20 2020 2020 2020 203e 3e3e 2074  h..        >>> t
+00050f40: 6f72 6368 2e6d 616e 7561 6c5f 7365 6564  orch.manual_seed
+00050f50: 2830 290d 0a20 2020 2020 2020 203e 3e3e  (0)..        >>>
+00050f60: 0d0a 2020 2020 2020 2020 3e3e 3e20 636c  ..        >>> cl
+00050f70: 6173 7320 4175 746f 5265 7365 7474 696e  ass AutoResettin
+00050f80: 6747 796d 456e 7628 4779 6d45 6e76 293a  gGymEnv(GymEnv):
+00050f90: 0d0a 2020 2020 2020 2020 2e2e 2e20 2020  ..        ...   
+00050fa0: 2020 6465 6620 5f73 7465 7028 7365 6c66    def _step(self
+00050fb0: 2c20 7465 6e73 6f72 6469 6374 293a 0d0a  , tensordict):..
+00050fc0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+00050fd0: 2020 2020 7465 6e73 6f72 6469 6374 203d      tensordict =
+00050fe0: 2073 7570 6572 2829 2e5f 7374 6570 2874   super()._step(t
+00050ff0: 656e 736f 7264 6963 7429 0d0a 2020 2020  ensordict)..    
+00051000: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+00051010: 6966 2074 656e 736f 7264 6963 745b 2264  if tensordict["d
+00051020: 6f6e 6522 5d2e 616e 7928 293a 0d0a 2020  one"].any():..  
+00051030: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+00051040: 2020 2020 2020 7464 5f72 6573 6574 203d        td_reset =
+00051050: 2073 7570 6572 2829 2e72 6573 6574 2829   super().reset()
+00051060: 0d0a 2020 2020 2020 2020 2e2e 2e20 2020  ..        ...   
+00051070: 2020 2020 2020 2020 2020 7465 6e73 6f72            tensor
+00051080: 6469 6374 2e75 7064 6174 6528 7464 5f72  dict.update(td_r
+00051090: 6573 6574 2e65 7863 6c75 6465 282a 7365  eset.exclude(*se
+000510a0: 6c66 2e64 6f6e 655f 6b65 7973 2929 0d0a  lf.done_keys))..
+000510b0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+000510c0: 2020 2020 7265 7475 726e 2074 656e 736f      return tenso
+000510d0: 7264 6963 740d 0a20 2020 2020 2020 202e  rdict..        .
+000510e0: 2e2e 0d0a 2020 2020 2020 2020 2e2e 2e20  ....        ... 
+000510f0: 2020 2020 6465 6620 5f72 6573 6574 2873      def _reset(s
+00051100: 656c 662c 2074 656e 736f 7264 6963 743d  elf, tensordict=
+00051110: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+00051120: 2e2e 2e20 2020 2020 2020 2020 6966 2074  ...         if t
+00051130: 656e 736f 7264 6963 7420 6973 206e 6f74  ensordict is not
+00051140: 204e 6f6e 6520 616e 6420 225f 7265 7365   None and "_rese
+00051150: 7422 2069 6e20 7465 6e73 6f72 6469 6374  t" in tensordict
+00051160: 3a0d 0a20 2020 2020 2020 202e 2e2e 2020  :..        ...  
+00051170: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00051180: 6e20 7465 6e73 6f72 6469 6374 2e63 6f70  n tensordict.cop
+00051190: 7928 290d 0a20 2020 2020 2020 202e 2e2e  y()..        ...
+000511a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000511b0: 7375 7065 7228 292e 5f72 6573 6574 2874  super()._reset(t
+000511c0: 656e 736f 7264 6963 7429 0d0a 2020 2020  ensordict)..    
+000511d0: 2020 2020 3e3e 3e0d 0a20 2020 2020 2020      >>>..       
+000511e0: 203e 3e3e 2077 6974 6820 7365 745f 6779   >>> with set_gy
+000511f0: 6d5f 6261 636b 656e 6428 2267 796d 2229  m_backend("gym")
+00051200: 3a0d 0a20 2020 2020 2020 202e 2e2e 2020  :..        ...  
+00051210: 2020 2065 6e76 203d 2041 7574 6f52 6573     env = AutoRes
+00051220: 6574 7469 6e67 4779 6d45 6e76 2822 4361  ettingGymEnv("Ca
+00051230: 7274 506f 6c65 2d76 3122 2c20 6175 746f  rtPole-v1", auto
+00051240: 5f72 6573 6574 3d54 7275 652c 2061 7574  _reset=True, aut
+00051250: 6f5f 7265 7365 745f 7265 706c 6163 653d  o_reset_replace=
+00051260: 5472 7565 290d 0a20 2020 2020 2020 202e  True)..        .
+00051270: 2e2e 2020 2020 2065 6e76 2e73 6574 5f73  ..     env.set_s
+00051280: 6565 6428 3029 0d0a 2020 2020 2020 2020  eed(0)..        
+00051290: 2e2e 2e20 2020 2020 7220 3d20 656e 762e  ...     r = env.
+000512a0: 726f 6c6c 6f75 7428 3330 2c20 6272 6561  rollout(30, brea
+000512b0: 6b5f 7768 656e 5f61 6e79 5f64 6f6e 653d  k_when_any_done=
+000512c0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+000512d0: 3e3e 3e20 7072 696e 7428 725b 226e 6578  >>> print(r["nex
+000512e0: 7422 2c20 2264 6f6e 6522 5d2e 7371 7565  t", "done"].sque
+000512f0: 657a 6528 2929 0d0a 2020 2020 2020 2020  eze())..        
+00051300: 7465 6e73 6f72 285b 4661 6c73 652c 2046  tensor([False, F
+00051310: 616c 7365 2c20 4661 6c73 652c 2046 616c  alse, False, Fal
+00051320: 7365 2c20 4661 6c73 652c 2046 616c 7365  se, False, False
+00051330: 2c20 4661 6c73 652c 2046 616c 7365 2c20  , False, False, 
+00051340: 4661 6c73 652c 2046 616c 7365 2c0d 0a20  False, False,.. 
+00051350: 2020 2020 2020 2020 2020 2020 2020 2046                 F
+00051360: 616c 7365 2c20 4661 6c73 652c 2046 616c  alse, False, Fal
+00051370: 7365 2c20 2054 7275 652c 2046 616c 7365  se,  True, False
+00051380: 2c20 4661 6c73 652c 2046 616c 7365 2c20  , False, False, 
+00051390: 4661 6c73 652c 2046 616c 7365 2c20 4661  False, False, Fa
+000513a0: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
+000513b0: 2020 2020 2020 4661 6c73 652c 2046 616c        False, Fal
+000513c0: 7365 2c20 4661 6c73 652c 2046 616c 7365  se, False, False
+000513d0: 2c20 4661 6c73 652c 2020 5472 7565 2c20  , False,  True, 
+000513e0: 4661 6c73 652c 2046 616c 7365 2c20 4661  False, False, Fa
+000513f0: 6c73 652c 2046 616c 7365 5d29 0d0a 2020  lse, False])..  
+00051400: 2020 2020 2020 3e3e 3e20 7072 696e 7428        >>> print(
+00051410: 226f 6273 6572 7661 7469 6f6e 2061 6674  "observation aft
+00051420: 6572 2072 6573 6574 2061 7265 2073 6574  er reset are set
+00051430: 2061 7320 6e61 6e22 2c20 725b 226e 6578   as nan", r["nex
+00051440: 7422 2c20 226f 6273 6572 7661 7469 6f6e  t", "observation
+00051450: 225d 290d 0a20 2020 2020 2020 206f 6273  "])..        obs
+00051460: 6572 7661 7469 6f6e 2061 6674 6572 2072  ervation after r
+00051470: 6573 6574 2061 7265 2073 6574 2061 7320  eset are set as 
+00051480: 6e61 6e20 7465 6e73 6f72 285b 5b2d 342e  nan tensor([[-4.
+00051490: 3336 3333 652d 3032 2c20 2d31 2e34 3837  3633e-02, -1.487
+000514a0: 3765 2d30 312c 2020 312e 3238 3439 652d  7e-01,  1.2849e-
+000514b0: 3032 2c20 2032 2e37 3538 3465 2d30 315d  02,  2.7584e-01]
+000514c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000514d0: 2020 205b 2d34 2e36 3630 3965 2d30 322c     [-4.6609e-02,
+000514e0: 2020 342e 3631 3636 652d 3032 2c20 2031    4.6166e-02,  1
+000514f0: 2e38 3336 3665 2d30 322c 202d 312e 3237  .8366e-02, -1.27
+00051500: 3631 652d 3032 5d2c 0d0a 2020 2020 2020  61e-02],..      
+00051510: 2020 2020 2020 2020 2020 5b2d 342e 3536            [-4.56
+00051520: 3835 652d 3032 2c20 2032 2e34 3130 3265  85e-02,  2.4102e
+00051530: 2d30 312c 2020 312e 3831 3131 652d 3032  -01,  1.8111e-02
+00051540: 2c20 2d32 2e39 3935 3965 2d30 315d 2c0d  , -2.9959e-01],.
+00051550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051560: 205b 2d34 2e30 3836 3565 2d30 322c 2020   [-4.0865e-02,  
+00051570: 342e 3536 3434 652d 3032 2c20 2031 2e32  4.5644e-02,  1.2
+00051580: 3131 3965 2d30 322c 202d 312e 3235 3432  119e-02, -1.2542
+00051590: 652d 3033 5d2c 0d0a 2020 2020 2020 2020  e-03],..        
+000515a0: 2020 2020 2020 2020 5b2d 332e 3939 3532          [-3.9952
+000515b0: 652d 3032 2c20 2032 2e34 3035 3965 2d30  e-02,  2.4059e-0
+000515c0: 312c 2020 312e 3230 3934 652d 3032 2c20  1,  1.2094e-02, 
+000515d0: 2d32 2e39 3030 3965 2d30 315d 2c0d 0a20  -2.9009e-01],.. 
+000515e0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+000515f0: 2d33 2e35 3134 3065 2d30 322c 2020 342e  -3.5140e-02,  4.
+00051600: 3335 3534 652d 3031 2c20 2036 2e32 3932  3554e-01,  6.292
+00051610: 3065 2d30 332c 202d 352e 3738 3933 652d  0e-03, -5.7893e-
+00051620: 3031 5d2c 0d0a 2020 2020 2020 2020 2020  01],..          
+00051630: 2020 2020 2020 5b2d 322e 3634 3239 652d        [-2.6429e-
+00051640: 3032 2c20 2036 2e33 3035 3765 2d30 312c  02,  6.3057e-01,
+00051650: 202d 352e 3238 3637 652d 3033 2c20 2d38   -5.2867e-03, -8
+00051660: 2e36 3936 3365 2d30 315d 2c0d 0a20 2020  .6963e-01],..   
+00051670: 2020 2020 2020 2020 2020 2020 205b 2d31               [-1
+00051680: 2e33 3831 3865 2d30 322c 2020 382e 3235  .3818e-02,  8.25
+00051690: 3736 652d 3031 2c20 2d32 2e32 3637 3965  76e-01, -2.2679e
+000516a0: 2d30 322c 202d 312e 3136 3430 652b 3030  -02, -1.1640e+00
+000516b0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+000516c0: 2020 2020 5b20 322e 3639 3732 652d 3033      [ 2.6972e-03
+000516d0: 2c20 2031 2e30 3231 3265 2b30 302c 202d  ,  1.0212e+00, -
+000516e0: 342e 3539 3539 652d 3032 2c20 2d31 2e34  4.5959e-02, -1.4
+000516f0: 3633 3765 2b30 305d 2c0d 0a20 2020 2020  637e+00],..     
+00051700: 2020 2020 2020 2020 2020 205b 2032 2e33             [ 2.3
+00051710: 3132 3165 2d30 322c 2020 312e 3231 3638  121e-02,  1.2168
+00051720: 652b 3030 2c20 2d37 2e35 3233 3265 2d30  e+00, -7.5232e-0
+00051730: 322c 202d 312e 3737 3034 652b 3030 5d2c  2, -1.7704e+00],
+00051740: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00051750: 2020 5b20 342e 3734 3537 652d 3032 2c20    [ 4.7457e-02, 
+00051760: 2031 2e34 3132 3765 2b30 302c 202d 312e   1.4127e+00, -1.
+00051770: 3130 3634 652d 3031 2c20 2d32 2e30 3835  1064e-01, -2.085
+00051780: 3465 2b30 305d 2c0d 0a20 2020 2020 2020  4e+00],..       
+00051790: 2020 2020 2020 2020 205b 2037 2e35 3731           [ 7.571
+000517a0: 3265 2d30 322c 2020 312e 3231 3839 652b  2e-02,  1.2189e+
+000517b0: 3030 2c20 2d31 2e35 3233 3565 2d30 312c  00, -1.5235e-01,
+000517c0: 202d 312e 3832 3839 652b 3030 5d2c 0d0a   -1.8289e+00],..
+000517d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000517e0: 5b20 312e 3030 3039 652d 3031 2c20 2031  [ 1.0009e-01,  1
+000517f0: 2e30 3235 3765 2b30 302c 202d 312e 3838  .0257e+00, -1.88
+00051800: 3933 652d 3031 2c20 2d31 2e35 3837 3265  93e-01, -1.5872e
+00051810: 2b30 305d 2c0d 0a20 2020 2020 2020 2020  +00],..         
+00051820: 2020 2020 2020 205b 2020 2020 2020 2020         [        
+00051830: 6e61 6e2c 2020 2020 2020 2020 206e 616e  nan,         nan
+00051840: 2c20 2020 2020 2020 2020 6e61 6e2c 2020  ,         nan,  
+00051850: 2020 2020 2020 206e 616e 5d2c 0d0a 2020         nan],..  
+00051860: 2020 2020 2020 2020 2020 2020 2020 5b2d                [-
+00051870: 332e 3934 3035 652d 3032 2c20 2d31 2e37  3.9405e-02, -1.7
+00051880: 3736 3665 2d30 312c 202d 312e 3034 3033  766e-01, -1.0403
+00051890: 652d 3032 2c20 2033 2e30 3632 3665 2d30  e-02,  3.0626e-0
+000518a0: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
+000518b0: 2020 2020 205b 2d34 2e32 3935 3965 2d30       [-4.2959e-0
+000518c0: 322c 202d 332e 3732 3633 652d 3031 2c20  2, -3.7263e-01, 
+000518d0: 2d34 2e32 3737 3565 2d30 332c 2020 352e  -4.2775e-03,  5.
+000518e0: 3935 3634 652d 3031 5d2c 0d0a 2020 2020  9564e-01],..    
+000518f0: 2020 2020 2020 2020 2020 2020 5b2d 352e              [-5.
+00051900: 3034 3131 652d 3032 2c20 2d35 2e36 3736  0411e-02, -5.676
+00051910: 3965 2d30 312c 2020 372e 3633 3534 652d  9e-01,  7.6354e-
+00051920: 3033 2c20 2038 2e38 3639 3865 2d30 315d  03,  8.8698e-01]
+00051930: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00051940: 2020 205b 2d36 2e31 3736 3565 2d30 322c     [-6.1765e-02,
+00051950: 202d 372e 3632 3932 652d 3031 2c20 2032   -7.6292e-01,  2
+00051960: 2e35 3337 3565 2d30 322c 2020 312e 3138  .5375e-02,  1.18
+00051970: 3230 652b 3030 5d2c 0d0a 2020 2020 2020  20e+00],..      
+00051980: 2020 2020 2020 2020 2020 5b2d 372e 3730            [-7.70
+00051990: 3233 652d 3032 2c20 2d39 2e35 3833 3665  23e-02, -9.5836e
+000519a0: 2d30 312c 2020 342e 3930 3136 652d 3032  -01,  4.9016e-02
+000519b0: 2c20 2031 2e34 3832 3665 2b30 305d 2c0d  ,  1.4826e+00],.
+000519c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000519d0: 205b 2d39 2e36 3139 3165 2d30 322c 202d   [-9.6191e-02, -
+000519e0: 372e 3633 3837 652d 3031 2c20 2037 2e38  7.6387e-01,  7.8
+000519f0: 3636 3765 2d30 322c 2020 312e 3230 3536  667e-02,  1.2056
+00051a00: 652b 3030 5d2c 0d0a 2020 2020 2020 2020  e+00],..        
+00051a10: 2020 2020 2020 2020 5b2d 312e 3131 3437          [-1.1147
+00051a20: 652d 3031 2c20 2d39 2e35 3939 3165 2d30  e-01, -9.5991e-0
+00051a30: 312c 2020 312e 3032 3738 652d 3031 2c20  1,  1.0278e-01, 
+00051a40: 2031 2e35 3231 3965 2b30 305d 2c0d 0a20   1.5219e+00],.. 
+00051a50: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00051a60: 2d31 2e33 3036 3765 2d30 312c 202d 372e  -1.3067e-01, -7.
+00051a70: 3636 3137 652d 3031 2c20 2031 2e33 3332  6617e-01,  1.332
+00051a80: 3265 2d30 312c 2020 312e 3236 3239 652b  2e-01,  1.2629e+
+00051a90: 3030 5d2c 0d0a 2020 2020 2020 2020 2020  00],..          
+00051aa0: 2020 2020 2020 5b2d 312e 3435 3939 652d        [-1.4599e-
+00051ab0: 3031 2c20 2d35 2e37 3239 3865 2d30 312c  01, -5.7298e-01,
+00051ac0: 2020 312e 3538 3438 652d 3031 2c20 2031    1.5848e-01,  1
+00051ad0: 2e30 3134 3865 2b30 305d 2c0d 0a20 2020  .0148e+00],..   
+00051ae0: 2020 2020 2020 2020 2020 2020 205b 2d31               [-1
+00051af0: 2e35 3734 3565 2d30 312c 202d 372e 3639  .5745e-01, -7.69
+00051b00: 3832 652d 3031 2c20 2031 2e37 3837 3765  82e-01,  1.7877e
+00051b10: 2d30 312c 2020 312e 3335 3237 652b 3030  -01,  1.3527e+00
+00051b20: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00051b30: 2020 2020 5b2d 312e 3732 3835 652d 3031      [-1.7285e-01
+00051b40: 2c20 2d39 2e36 3636 3865 2d30 312c 2020  , -9.6668e-01,  
+00051b50: 322e 3035 3833 652d 3031 2c20 2031 2e36  2.0583e-01,  1.6
+00051b60: 3935 3665 2b30 305d 2c0d 0a20 2020 2020  956e+00],..     
+00051b70: 2020 2020 2020 2020 2020 205b 2020 2020             [    
+00051b80: 2020 2020 6e61 6e2c 2020 2020 2020 2020      nan,        
+00051b90: 206e 616e 2c20 2020 2020 2020 2020 6e61   nan,         na
+00051ba0: 6e2c 2020 2020 2020 2020 206e 616e 5d2c  n,         nan],
+00051bb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00051bc0: 2020 5b2d 342e 3339 3632 652d 3032 2c20    [-4.3962e-02, 
+00051bd0: 2031 2e39 3834 3565 2d30 312c 202d 342e   1.9845e-01, -4.
+00051be0: 3530 3135 652d 3032 2c20 2d32 2e35 3930  5015e-02, -2.590
+00051bf0: 3365 2d30 315d 2c0d 0a20 2020 2020 2020  3e-01],..       
+00051c00: 2020 2020 2020 2020 205b 2d33 2e39 3939           [-3.999
+00051c10: 3365 2d30 322c 2020 332e 3934 3138 652d  3e-02,  3.9418e-
+00051c20: 3031 2c20 2d35 2e30 3139 3665 2d30 322c  01, -5.0196e-02,
+00051c30: 202d 352e 3635 3537 652d 3031 5d2c 0d0a   -5.6557e-01],..
+00051c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051c50: 5b2d 332e 3231 3039 652d 3032 2c20 2035  [-3.2109e-02,  5
+00051c60: 2e38 3939 3765 2d30 312c 202d 362e 3135  .8997e-01, -6.15
+00051c70: 3037 652d 3032 2c20 2d38 2e37 3336 3365  07e-02, -8.7363e
+00051c80: 2d30 315d 2c0d 0a20 2020 2020 2020 2020  -01],..         
+00051c90: 2020 2020 2020 205b 2d32 2e30 3331 3065         [-2.0310e
+00051ca0: 2d30 322c 2020 332e 3935 3734 652d 3031  -02,  3.9574e-01
+00051cb0: 2c20 2d37 2e38 3938 3065 2d30 322c 202d  , -7.8980e-02, -
+00051cc0: 362e 3030 3930 652d 3031 5d5d 290d 0a0d  6.0090e-01]])...
+00051cd0: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
+00051ce0: 6465 6620 5f5f 696e 6974 5f5f 280d 0a20  def __init__(.. 
+00051cf0: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
+00051d00: 2020 2020 2020 2a2c 0d0a 2020 2020 2020        *,..      
+00051d10: 2020 7265 706c 6163 653a 2062 6f6f 6c20    replace: bool 
+00051d20: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0d0a  | None = None,..
+00051d30: 2020 2020 2020 2020 6669 6c6c 5f66 6c6f          fill_flo
+00051d40: 6174 3d22 6e61 6e22 2c0d 0a20 2020 2020  at="nan",..     
+00051d50: 2020 2066 696c 6c5f 696e 743d 2d31 2c0d     fill_int=-1,.
+00051d60: 0a20 2020 2020 2020 2066 696c 6c5f 626f  .        fill_bo
+00051d70: 6f6c 3d46 616c 7365 2c0d 0a20 2020 2029  ol=False,..    )
+00051d80: 3a0d 0a20 2020 2020 2020 2073 7570 6572  :..        super
+00051d90: 2829 2e5f 5f69 6e69 745f 5f28 290d 0a20  ().__init__().. 
+00051da0: 2020 2020 2020 2069 6620 7265 706c 6163         if replac
+00051db0: 6520 6973 2046 616c 7365 3a0d 0a20 2020  e is False:..   
+00051dc0: 2020 2020 2020 2020 2066 696c 6c5f 666c           fill_fl
+00051dd0: 6f61 7420 3d20 6669 6c6c 5f69 6e74 203d  oat = fill_int =
+00051de0: 2066 696c 6c5f 626f 6f6c 203d 204e 6f6e   fill_bool = Non
+00051df0: 650d 0a20 2020 2020 2020 2069 6620 6669  e..        if fi
+00051e00: 6c6c 5f66 6c6f 6174 203d 3d20 226e 616e  ll_float == "nan
+00051e10: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
+00051e20: 6669 6c6c 5f66 6c6f 6174 203d 2066 6c6f  fill_float = flo
+00051e30: 6174 2822 6e61 6e22 290d 0a20 2020 2020  at("nan")..     
+00051e40: 2020 2073 656c 662e 6669 6c6c 5f66 6c6f     self.fill_flo
+00051e50: 6174 203d 2066 696c 6c5f 666c 6f61 740d  at = fill_float.
+00051e60: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
+00051e70: 6c6c 5f69 6e74 203d 2066 696c 6c5f 696e  ll_int = fill_in
+00051e80: 740d 0a20 2020 2020 2020 2073 656c 662e  t..        self.
+00051e90: 6669 6c6c 5f62 6f6f 6c20 3d20 6669 6c6c  fill_bool = fill
+00051ea0: 5f62 6f6f 6c0d 0a20 2020 2020 2020 2073  _bool..        s
+00051eb0: 656c 662e 5f76 616c 6964 6174 6564 203d  elf._validated =
+00051ec0: 2046 616c 7365 0d0a 0d0a 2020 2020 6465   False....    de
+00051ed0: 6620 5f76 616c 6964 6174 655f 636f 6e74  f _validate_cont
+00051ee0: 6169 6e65 7228 7365 6c66 293a 0d0a 2020  ainer(self):..  
+00051ef0: 2020 2020 2020 6966 2073 656c 662e 5f76        if self._v
+00051f00: 616c 6964 6174 6564 3a0d 0a20 2020 2020  alidated:..     
+00051f10: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+00051f20: 2020 2020 2020 2069 6620 7479 7065 2873         if type(s
+00051f30: 656c 662e 636f 6e74 6169 6e65 7229 2069  elf.container) i
+00051f40: 7320 6e6f 7420 4175 746f 5265 7365 7445  s not AutoResetE
+00051f50: 6e76 3a0d 0a20 2020 2020 2020 2020 2020  nv:..           
+00051f60: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+00051f70: 726f 7228 0d0a 2020 2020 2020 2020 2020  ror(..          
+00051f80: 2020 2020 2020 6622 5468 6520 7b73 656c        f"The {sel
+00051f90: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
+00051fa0: 6d65 5f5f 7d20 636f 6e74 6169 6e65 7220  me__} container 
+00051fb0: 6d75 7374 2062 6520 6f66 2074 7970 6520  must be of type 
+00051fc0: 4175 746f 5265 7365 7445 6e76 2e22 0d0a  AutoResetEnv."..
+00051fd0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00051fe0: 2020 2020 2020 2073 656c 662e 5f76 616c         self._val
+00051ff0: 6964 6174 6564 203d 2054 7275 650d 0a0d  idated = True...
+00052000: 0a20 2020 2064 6566 205f 7265 7365 7428  .    def _reset(
+00052010: 0d0a 2020 2020 2020 2020 7365 6c66 2c20  ..        self, 
+00052020: 7465 6e73 6f72 6469 6374 3a20 5465 6e73  tensordict: Tens
+00052030: 6f72 4469 6374 4261 7365 2c20 7465 6e73  orDictBase, tens
+00052040: 6f72 6469 6374 5f72 6573 6574 3a20 5465  ordict_reset: Te
+00052050: 6e73 6f72 4469 6374 4261 7365 0d0a 2020  nsorDictBase..  
+00052060: 2020 2920 2d3e 2054 656e 736f 7244 6963    ) -> TensorDic
+00052070: 7442 6173 653a 0d0a 2020 2020 2020 2020  tBase:..        
+00052080: 7365 6c66 2e5f 7661 6c69 6461 7465 5f63  self._validate_c
+00052090: 6f6e 7461 696e 6572 2829 0d0a 2020 2020  ontainer()..    
+000520a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000520b0: 5f72 6570 6c61 6365 5f61 7574 6f5f 7265  _replace_auto_re
+000520c0: 7365 745f 7661 6c73 2874 656e 736f 7264  set_vals(tensord
+000520d0: 6963 745f 7265 7365 743d 7465 6e73 6f72  ict_reset=tensor
+000520e0: 6469 6374 5f72 6573 6574 290d 0a0d 0a20  dict_reset).... 
+000520f0: 2020 2064 6566 205f 7374 6570 280d 0a20     def _step(.. 
+00052100: 2020 2020 2020 2073 656c 662c 2074 656e         self, ten
+00052110: 736f 7264 6963 743a 2054 656e 736f 7244  sordict: TensorD
+00052120: 6963 7442 6173 652c 206e 6578 745f 7465  ictBase, next_te
+00052130: 6e73 6f72 6469 6374 3a20 5465 6e73 6f72  nsordict: Tensor
+00052140: 4469 6374 4261 7365 0d0a 2020 2020 2920  DictBase..    ) 
+00052150: 2d3e 2054 656e 736f 7244 6963 7442 6173  -> TensorDictBas
+00052160: 653a 0d0a 2020 2020 2020 2020 7265 7475  e:..        retu
+00052170: 726e 2073 656c 662e 5f63 6f72 7265 6374  rn self._correct
+00052180: 5f61 7574 6f5f 7265 7365 745f 7661 6c73  _auto_reset_vals
+00052190: 286e 6578 745f 7465 6e73 6f72 6469 6374  (next_tensordict
+000521a0: 290d 0a0d 0a20 2020 2064 6566 2066 6f72  )....    def for
+000521b0: 7761 7264 2873 656c 662c 2074 656e 736f  ward(self, tenso
+000521c0: 7264 6963 743a 2054 656e 736f 7244 6963  rdict: TensorDic
+000521d0: 7442 6173 6529 202d 3e20 5465 6e73 6f72  tBase) -> Tensor
+000521e0: 4469 6374 4261 7365 3a0d 0a20 2020 2020  DictBase:..     
+000521f0: 2020 2072 6169 7365 2052 756e 7469 6d65     raise Runtime
+00052200: 4572 726f 720d 0a0d 0a20 2020 2040 7072  Error....    @pr
+00052210: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+00052220: 5f73 696d 706c 655f 646f 6e65 2873 656c  _simple_done(sel
+00052230: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+00052240: 7572 6e20 7365 6c66 2e70 6172 656e 742e  urn self.parent.
+00052250: 5f73 696d 706c 655f 646f 6e65 0d0a 0d0a  _simple_done....
+00052260: 2020 2020 6465 6620 5f63 6f72 7265 6374      def _correct
+00052270: 5f61 7574 6f5f 7265 7365 745f 7661 6c73  _auto_reset_vals
+00052280: 2873 656c 662c 2074 656e 736f 7264 6963  (self, tensordic
+00052290: 7429 3a0d 0a20 2020 2020 2020 2023 2077  t):..        # w
+000522a0: 6520 6e65 6564 2074 6f20 6d6f 7665 2074  e need to move t
+000522b0: 6865 2064 6174 6120 6672 6f6d 2074 656e  he data from ten
+000522c0: 736f 7264 6963 7420 746f 2074 656e 736f  sordict to tenso
+000522d0: 7264 6963 745f 0d0a 2020 2020 2020 2020  rdict_..        
+000522e0: 6465 6620 7265 706c 6163 655f 616e 645f  def replace_and_
+000522f0: 7365 7428 6b65 792c 2076 616c 2c20 6d61  set(key, val, ma
+00052300: 736b 2c20 7361 7665 645f 7464 5f61 7574  sk, saved_td_aut
+00052310: 6f72 6573 6574 2c20 6167 656e 743d 7465  oreset, agent=te
+00052320: 6e73 6f72 6469 6374 293a 0d0a 2020 2020  nsordict):..    
+00052330: 2020 2020 2020 2020 7361 7665 645f 7464          saved_td
+00052340: 5f61 7574 6f72 6573 6574 2e73 6574 286b  _autoreset.set(k
+00052350: 6579 2c20 7661 6c29 0d0a 2020 2020 2020  ey, val)..      
+00052360: 2020 2020 2020 6966 2076 616c 2e64 7479        if val.dty
+00052370: 7065 2e69 735f 666c 6f61 7469 6e67 5f70  pe.is_floating_p
+00052380: 6f69 6e74 3a0d 0a20 2020 2020 2020 2020  oint:..         
+00052390: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
+000523a0: 696c 6c5f 666c 6f61 7420 6973 204e 6f6e  ill_float is Non
+000523b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000523c0: 2020 2020 2020 2020 7661 6c5f 7365 745f          val_set_
+000523d0: 6e61 6e20 3d20 7661 6c2e 636c 6f6e 6528  nan = val.clone(
+000523e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000523f0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00052400: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00052410: 6c5f 7365 745f 6e61 6e20 3d20 746f 7263  l_set_nan = torc
+00052420: 682e 7768 6572 6528 0d0a 2020 2020 2020  h.where(..      
+00052430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052440: 2020 6578 7061 6e64 5f61 735f 7269 6768    expand_as_righ
+00052450: 7428 6d61 736b 2c20 7661 6c29 2c0d 0a20  t(mask, val),.. 
+00052460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052470: 2020 2020 2020 2074 6f72 6368 2e66 756c         torch.ful
+00052480: 6c5f 6c69 6b65 2876 616c 2c20 7365 6c66  l_like(val, self
+00052490: 2e66 696c 6c5f 666c 6f61 7429 2c0d 0a20  .fill_float),.. 
+000524a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000524b0: 2020 2020 2020 2076 616c 2c0d 0a20 2020         val,..   
 000524c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000524d0: 2020 746f 7263 682e 6675 6c6c 5f6c 696b    torch.full_lik
-000524e0: 6528 7661 6c2c 2073 656c 662e 6669 6c6c  e(val, self.fill
-000524f0: 5f62 6f6f 6c29 2c0d 0a20 2020 2020 2020  _bool),..       
-00052500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052510: 2076 616c 2c0d 0a20 2020 2020 2020 2020   val,..         
-00052520: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00052530: 2020 2020 2020 2020 2020 6167 656e 742e            agent.
-00052540: 7365 7428 6b65 792c 2076 616c 5f73 6574  set(key, val_set
-00052550: 5f6e 616e 290d 0a0d 0a20 2020 2020 2020  _nan)....       
-00052560: 2069 6620 7365 6c66 2e5f 7369 6d70 6c65   if self._simple
-00052570: 5f64 6f6e 653a 0d0a 2020 2020 2020 2020  _done:..        
-00052580: 2020 2020 646f 6e65 203d 2074 656e 736f      done = tenso
-00052590: 7264 6963 742e 6765 7428 2264 6f6e 6522  rdict.get("done"
-000525a0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-000525b0: 6620 646f 6e65 2e61 6e79 2829 3a0d 0a20  f done.any():.. 
-000525c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000525d0: 6173 6b20 3d20 646f 6e65 2e73 7175 6565  ask = done.squee
-000525e0: 7a65 282d 3129 0d0a 2020 2020 2020 2020  ze(-1)..        
-000525f0: 2020 2020 2020 2020 7365 6c66 2e5f 7361          self._sa
-00052600: 7665 645f 7464 5f61 7574 6f72 6573 7420  ved_td_autorest 
-00052610: 3d20 5465 6e73 6f72 4469 6374 287b 7d2c  = TensorDict({},
-00052620: 205b 5d29 0d0a 2020 2020 2020 2020 2020   [])..          
-00052630: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
-00052640: 2073 656c 662e 7061 7265 6e74 2e66 756c   self.parent.ful
-00052650: 6c5f 6f62 7365 7276 6174 696f 6e5f 7370  l_observation_sp
-00052660: 6563 2e6b 6579 7328 5472 7565 2c20 5472  ec.keys(True, Tr
-00052670: 7565 293a 0d0a 2020 2020 2020 2020 2020  ue):..          
-00052680: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
-00052690: 7465 6e73 6f72 6469 6374 2e67 6574 286b  tensordict.get(k
-000526a0: 6579 290d 0a20 2020 2020 2020 2020 2020  ey)..           
-000526b0: 2020 2020 2020 2020 2072 6570 6c61 6365           replace
-000526c0: 5f61 6e64 5f73 6574 280d 0a20 2020 2020  _and_set(..     
-000526d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000526e0: 2020 206b 6579 2c20 7661 6c2c 206d 6173     key, val, mas
-000526f0: 6b2c 2073 6176 6564 5f74 645f 6175 746f  k, saved_td_auto
-00052700: 7265 7365 743d 7365 6c66 2e5f 7361 7665  reset=self._save
-00052710: 645f 7464 5f61 7574 6f72 6573 740d 0a20  d_td_autorest.. 
-00052720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052730: 2020 2029 0d0a 2020 2020 2020 2020 656c     )..        el
-00052740: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00052750: 2070 6172 656e 7473 203d 205b 5d0d 0a20   parents = [].. 
-00052760: 2020 2020 2020 2020 2020 2023 2047 6f20             # Go 
-00052770: 7468 726f 7567 6820 6561 6368 2022 646f  through each "do
-00052780: 6e65 2220 6b65 7920 616e 6420 6765 7420  ne" key and get 
-00052790: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
-000527a0: 6720 6167 656e 742e 0d0a 2020 2020 2020  g agent...      
-000527b0: 2020 2020 2020 5f73 6176 6564 5f74 645f        _saved_td_
-000527c0: 6175 746f 7265 7374 203d 204e 6f6e 650d  autorest = None.
-000527d0: 0a20 2020 2020 2020 2020 2020 206f 6273  .            obs
-000527e0: 5f6b 6579 7320 3d20 6c69 7374 2873 656c  _keys = list(sel
-000527f0: 662e 7061 7265 6e74 2e66 756c 6c5f 6f62  f.parent.full_ob
-00052800: 7365 7276 6174 696f 6e5f 7370 6563 2e6b  servation_spec.k
-00052810: 6579 7328 5472 7565 2c20 5472 7565 2929  eys(True, True))
-00052820: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00052830: 7220 646f 6e65 5f6b 6579 2069 6e20 7365  r done_key in se
-00052840: 6c66 2e70 6172 656e 742e 646f 6e65 5f6b  lf.parent.done_k
-00052850: 6579 733a 0d0a 2020 2020 2020 2020 2020  eys:..          
-00052860: 2020 2020 2020 6966 205f 656e 6473 5f77        if _ends_w
-00052870: 6974 6828 646f 6e65 5f6b 6579 2c20 2264  ith(done_key, "d
-00052880: 6f6e 6522 293a 0d0a 2020 2020 2020 2020  one"):..        
-00052890: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000528a0: 7369 6e73 7461 6e63 6528 646f 6e65 5f6b  sinstance(done_k
-000528b0: 6579 2c20 7374 7229 3a0d 0a20 2020 2020  ey, str):..     
-000528c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000528d0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-000528e0: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
-000528f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052900: 2022 4120 2764 6f6e 6527 206b 6579 2077   "A 'done' key w
-00052910: 6173 2061 2073 7472 696e 6720 6275 7420  as a string but 
-00052920: 6120 7475 706c 6520 7761 7320 6578 7065  a tuple was expe
-00052930: 6374 6564 2e22 0d0a 2020 2020 2020 2020  cted."..        
+000524d0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+000524e0: 656c 6966 2076 616c 2e64 7479 7065 2e69  elif val.dtype.i
+000524f0: 735f 7369 676e 6564 3a0d 0a20 2020 2020  s_signed:..     
+00052500: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00052510: 6c66 2e66 696c 6c5f 696e 7420 6973 204e  lf.fill_int is N
+00052520: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00052530: 2020 2020 2020 2020 2020 7661 6c5f 7365            val_se
+00052540: 745f 6e61 6e20 3d20 7661 6c2e 636c 6f6e  t_nan = val.clon
+00052550: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
+00052560: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00052570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052580: 7661 6c5f 7365 745f 6e61 6e20 3d20 746f  val_set_nan = to
+00052590: 7263 682e 7768 6572 6528 0d0a 2020 2020  rch.where(..    
+000525a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000525b0: 2020 2020 6578 7061 6e64 5f61 735f 7269      expand_as_ri
+000525c0: 6768 7428 6d61 736b 2c20 7661 6c29 2c0d  ght(mask, val),.
+000525d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000525e0: 2020 2020 2020 2020 2074 6f72 6368 2e66           torch.f
+000525f0: 756c 6c5f 6c69 6b65 2876 616c 2c20 7365  ull_like(val, se
+00052600: 6c66 2e66 696c 6c5f 696e 7429 2c0d 0a20  lf.fill_int),.. 
+00052610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052620: 2020 2020 2020 2076 616c 2c0d 0a20 2020         val,..   
+00052630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052640: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00052650: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00052660: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
+00052670: 696c 6c5f 626f 6f6c 2069 7320 4e6f 6e65  ill_bool is None
+00052680: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00052690: 2020 2020 2020 2076 616c 5f73 6574 5f6e         val_set_n
+000526a0: 616e 203d 2076 616c 2e63 6c6f 6e65 2829  an = val.clone()
+000526b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000526c0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000526d0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+000526e0: 5f73 6574 5f6e 616e 203d 2074 6f72 6368  _set_nan = torch
+000526f0: 2e77 6865 7265 280d 0a20 2020 2020 2020  .where(..       
+00052700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052710: 2065 7870 616e 645f 6173 5f72 6967 6874   expand_as_right
+00052720: 286d 6173 6b2c 2076 616c 292c 0d0a 2020  (mask, val),..  
+00052730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052740: 2020 2020 2020 746f 7263 682e 6675 6c6c        torch.full
+00052750: 5f6c 696b 6528 7661 6c2c 2073 656c 662e  _like(val, self.
+00052760: 6669 6c6c 5f62 6f6f 6c29 2c0d 0a20 2020  fill_bool),..   
+00052770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052780: 2020 2020 2076 616c 2c0d 0a20 2020 2020       val,..     
+00052790: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000527a0: 0d0a 2020 2020 2020 2020 2020 2020 6167  ..            ag
+000527b0: 656e 742e 7365 7428 6b65 792c 2076 616c  ent.set(key, val
+000527c0: 5f73 6574 5f6e 616e 290d 0a0d 0a20 2020  _set_nan)....   
+000527d0: 2020 2020 2069 6620 7365 6c66 2e5f 7369       if self._si
+000527e0: 6d70 6c65 5f64 6f6e 653a 0d0a 2020 2020  mple_done:..    
+000527f0: 2020 2020 2020 2020 646f 6e65 203d 2074          done = t
+00052800: 656e 736f 7264 6963 742e 6765 7428 2264  ensordict.get("d
+00052810: 6f6e 6522 290d 0a20 2020 2020 2020 2020  one")..         
+00052820: 2020 2069 6620 646f 6e65 2e61 6e79 2829     if done.any()
+00052830: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00052840: 2020 206d 6173 6b20 3d20 646f 6e65 2e73     mask = done.s
+00052850: 7175 6565 7a65 282d 3129 0d0a 2020 2020  queeze(-1)..    
+00052860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00052870: 2e5f 7361 7665 645f 7464 5f61 7574 6f72  ._saved_td_autor
+00052880: 6573 7420 3d20 5465 6e73 6f72 4469 6374  est = TensorDict
+00052890: 287b 7d2c 205b 5d29 0d0a 2020 2020 2020  ({}, [])..      
+000528a0: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+000528b0: 7920 696e 2073 656c 662e 7061 7265 6e74  y in self.parent
+000528c0: 2e66 756c 6c5f 6f62 7365 7276 6174 696f  .full_observatio
+000528d0: 6e5f 7370 6563 2e6b 6579 7328 5472 7565  n_spec.keys(True
+000528e0: 2c20 5472 7565 293a 0d0a 2020 2020 2020  , True):..      
+000528f0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00052900: 6c20 3d20 7465 6e73 6f72 6469 6374 2e67  l = tensordict.g
+00052910: 6574 286b 6579 290d 0a20 2020 2020 2020  et(key)..       
+00052920: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+00052930: 6c61 6365 5f61 6e64 5f73 6574 280d 0a20  lace_and_set(.. 
 00052940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052950: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00052960: 2020 2020 2020 2061 6765 6e74 5f6b 6579         agent_key
-00052970: 203d 2064 6f6e 655f 6b65 795b 3a2d 315d   = done_key[:-1]
-00052980: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00052990: 2020 2020 2020 646f 6e65 203d 2074 656e        done = ten
-000529a0: 736f 7264 6963 742e 6765 7428 646f 6e65  sordict.get(done
-000529b0: 5f6b 6579 290d 0a20 2020 2020 2020 2020  _key)..         
-000529c0: 2020 2020 2020 2020 2020 206d 6173 6b20             mask 
-000529d0: 3d20 646f 6e65 2e73 7175 6565 7a65 282d  = done.squeeze(-
-000529e0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-000529f0: 2020 2020 2020 2020 6966 2064 6f6e 652e          if done.
-00052a00: 616e 7928 293a 0d0a 2020 2020 2020 2020  any():..        
-00052a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052a20: 6966 205f 7361 7665 645f 7464 5f61 7574  if _saved_td_aut
-00052a30: 6f72 6573 7420 6973 204e 6f6e 653a 0d0a  orest is None:..
-00052a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052a50: 2020 2020 2020 2020 2020 2020 5f73 6176              _sav
-00052a60: 6564 5f74 645f 6175 746f 7265 7374 203d  ed_td_autorest =
-00052a70: 2054 656e 736f 7244 6963 7428 7b7d 2c20   TensorDict({}, 
-00052a80: 6261 7463 685f 7369 7a65 3d5b 5d29 0d0a  batch_size=[])..
-00052a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052aa0: 2020 2020 2020 2020 6167 656e 7420 3d20          agent = 
-00052ab0: 7465 6e73 6f72 6469 6374 2e67 6574 2861  tensordict.get(a
-00052ac0: 6765 6e74 5f6b 6579 290d 0a20 2020 2020  gent_key)..     
-00052ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ae0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00052af0: 2861 6765 6e74 2c20 4c61 7a79 5374 6163  (agent, LazyStac
-00052b00: 6b65 6454 656e 736f 7244 6963 7429 3a0d  kedTensorDict):.
-00052b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052b20: 2020 2020 2020 2020 2020 2020 2061 6765               age
-00052b30: 6e74 7320 3d20 6167 656e 742e 7465 6e73  nts = agent.tens
-00052b40: 6f72 6469 6374 730d 0a20 2020 2020 2020  ordicts..       
-00052b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052b60: 2020 2020 206d 6173 6b73 203d 206d 6173       masks = mas
-00052b70: 6b2e 756e 6269 6e64 2861 6765 6e74 2e73  k.unbind(agent.s
-00052b80: 7461 636b 5f64 696d 290d 0a20 2020 2020  tack_dim)..     
-00052b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ba0: 2020 2020 2020 2073 6176 6564 5f74 645f         saved_td_
-00052bb0: 6175 746f 7265 7374 5f61 6765 6e74 203d  autorest_agent =
-00052bc0: 204c 617a 7953 7461 636b 6564 5465 6e73   LazyStackedTens
-00052bd0: 6f72 4469 6374 280d 0a20 2020 2020 2020  orDict(..       
-00052be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052bf0: 2020 2020 2020 2020 202a 5b74 642e 656d           *[td.em
-00052c00: 7074 7928 2920 666f 7220 7464 2069 6e20  pty() for td in 
-00052c10: 6167 656e 7473 5d2c 0d0a 2020 2020 2020  agents],..      
-00052c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052c30: 2020 2020 2020 2020 2020 7374 6163 6b5f            stack_
-00052c40: 6469 6d3d 6167 656e 742e 7374 6163 6b5f  dim=agent.stack_
-00052c50: 6469 6d2c 0d0a 2020 2020 2020 2020 2020  dim,..          
-00052c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052c70: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00052950: 2020 2020 2020 206b 6579 2c20 7661 6c2c         key, val,
+00052960: 206d 6173 6b2c 2073 6176 6564 5f74 645f   mask, saved_td_
+00052970: 6175 746f 7265 7365 743d 7365 6c66 2e5f  autoreset=self._
+00052980: 7361 7665 645f 7464 5f61 7574 6f72 6573  saved_td_autores
+00052990: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+000529a0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000529b0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000529c0: 2020 2020 2070 6172 656e 7473 203d 205b       parents = [
+000529d0: 5d0d 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+000529e0: 2047 6f20 7468 726f 7567 6820 6561 6368   Go through each
+000529f0: 2022 646f 6e65 2220 6b65 7920 616e 6420   "done" key and 
+00052a00: 6765 7420 7468 6520 636f 7272 6573 706f  get the correspo
+00052a10: 6e64 696e 6720 6167 656e 742e 0d0a 2020  nding agent...  
+00052a20: 2020 2020 2020 2020 2020 5f73 6176 6564            _saved
+00052a30: 5f74 645f 6175 746f 7265 7374 203d 204e  _td_autorest = N
+00052a40: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00052a50: 206f 6273 5f6b 6579 7320 3d20 6c69 7374   obs_keys = list
+00052a60: 2873 656c 662e 7061 7265 6e74 2e66 756c  (self.parent.ful
+00052a70: 6c5f 6f62 7365 7276 6174 696f 6e5f 7370  l_observation_sp
+00052a80: 6563 2e6b 6579 7328 5472 7565 2c20 5472  ec.keys(True, Tr
+00052a90: 7565 2929 0d0a 2020 2020 2020 2020 2020  ue))..          
+00052aa0: 2020 666f 7220 646f 6e65 5f6b 6579 2069    for done_key i
+00052ab0: 6e20 7365 6c66 2e70 6172 656e 742e 646f  n self.parent.do
+00052ac0: 6e65 5f6b 6579 733a 0d0a 2020 2020 2020  ne_keys:..      
+00052ad0: 2020 2020 2020 2020 2020 6966 205f 656e            if _en
+00052ae0: 6473 5f77 6974 6828 646f 6e65 5f6b 6579  ds_with(done_key
+00052af0: 2c20 2264 6f6e 6522 293a 0d0a 2020 2020  , "done"):..    
+00052b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052b10: 6966 2069 7369 6e73 7461 6e63 6528 646f  if isinstance(do
+00052b20: 6e65 5f6b 6579 2c20 7374 7229 3a0d 0a20  ne_key, str):.. 
+00052b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052b40: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00052b50: 6545 7272 6f72 280d 0a20 2020 2020 2020  eError(..       
+00052b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052b70: 2020 2020 2022 4120 2764 6f6e 6527 206b       "A 'done' k
+00052b80: 6579 2077 6173 2061 2073 7472 696e 6720  ey was a string 
+00052b90: 6275 7420 6120 7475 706c 6520 7761 7320  but a tuple was 
+00052ba0: 6578 7065 6374 6564 2e22 0d0a 2020 2020  expected."..    
+00052bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052bc0: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00052bd0: 2020 2020 2020 2020 2020 2061 6765 6e74             agent
+00052be0: 5f6b 6579 203d 2064 6f6e 655f 6b65 795b  _key = done_key[
+00052bf0: 3a2d 315d 0d0a 2020 2020 2020 2020 2020  :-1]..          
+00052c00: 2020 2020 2020 2020 2020 646f 6e65 203d            done =
+00052c10: 2074 656e 736f 7264 6963 742e 6765 7428   tensordict.get(
+00052c20: 646f 6e65 5f6b 6579 290d 0a20 2020 2020  done_key)..     
+00052c30: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00052c40: 6173 6b20 3d20 646f 6e65 2e73 7175 6565  ask = done.squee
+00052c50: 7a65 282d 3129 0d0a 2020 2020 2020 2020  ze(-1)..        
+00052c60: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00052c70: 6f6e 652e 616e 7928 293a 0d0a 2020 2020  one.any():..    
 00052c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052c90: 2073 6176 6564 5f74 645f 6175 746f 7265   saved_td_autore
-00052ca0: 7374 5f61 6765 6e74 7320 3d20 280d 0a20  st_agents = (.. 
-00052cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052cc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00052cd0: 6176 6564 5f74 645f 6175 746f 7265 7374  aved_td_autorest
-00052ce0: 5f61 6765 6e74 2e74 656e 736f 7264 6963  _agent.tensordic
-00052cf0: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
-00052d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052d10: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00052d20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00052d30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00052d40: 2020 2020 2020 2020 2020 2020 2020 6167                ag
-00052d50: 656e 7473 203d 205b 6167 656e 745d 0d0a  ents = [agent]..
-00052d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052d70: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00052d80: 7320 3d20 5b6d 6173 6b5d 0d0a 2020 2020  s = [mask]..    
+00052c90: 2020 2020 6966 205f 7361 7665 645f 7464      if _saved_td
+00052ca0: 5f61 7574 6f72 6573 7420 6973 204e 6f6e  _autorest is Non
+00052cb0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00052cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052cd0: 5f73 6176 6564 5f74 645f 6175 746f 7265  _saved_td_autore
+00052ce0: 7374 203d 2054 656e 736f 7244 6963 7428  st = TensorDict(
+00052cf0: 7b7d 2c20 6261 7463 685f 7369 7a65 3d5b  {}, batch_size=[
+00052d00: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00052d10: 2020 2020 2020 2020 2020 2020 6167 656e              agen
+00052d20: 7420 3d20 7465 6e73 6f72 6469 6374 2e67  t = tensordict.g
+00052d30: 6574 2861 6765 6e74 5f6b 6579 290d 0a20  et(agent_key).. 
+00052d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052d50: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00052d60: 616e 6365 2861 6765 6e74 2c20 4c61 7a79  ance(agent, Lazy
+00052d70: 5374 6163 6b65 6454 656e 736f 7244 6963  StackedTensorDic
+00052d80: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
 00052d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052da0: 2020 2020 2020 2020 7361 7665 645f 7464          saved_td
-00052db0: 5f61 7574 6f72 6573 745f 6167 656e 7420  _autorest_agent 
-00052dc0: 3d20 5f73 6176 6564 5f74 645f 6175 746f  = _saved_td_auto
-00052dd0: 7265 7374 2e73 6574 6465 6661 756c 7428  rest.setdefault(
-00052de0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00052df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052e00: 2020 6167 656e 745f 6b65 792c 2061 6765    agent_key, age
-00052e10: 6e74 2e65 6d70 7479 2829 0d0a 2020 2020  nt.empty()..    
-00052e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052e30: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00052e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052e50: 2020 2020 2020 2073 6176 6564 5f74 645f         saved_td_
-00052e60: 6175 746f 7265 7374 5f61 6765 6e74 7320  autorest_agents 
-00052e70: 3d20 5b73 6176 6564 5f74 645f 6175 746f  = [saved_td_auto
-00052e80: 7265 7374 5f61 6765 6e74 5d0d 0a20 2020  rest_agent]..   
+00052da0: 2061 6765 6e74 7320 3d20 6167 656e 742e   agents = agent.
+00052db0: 7465 6e73 6f72 6469 6374 730d 0a20 2020  tensordicts..   
+00052dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052dd0: 2020 2020 2020 2020 206d 6173 6b73 203d           masks =
+00052de0: 206d 6173 6b2e 756e 6269 6e64 2861 6765   mask.unbind(age
+00052df0: 6e74 2e73 7461 636b 5f64 696d 290d 0a20  nt.stack_dim).. 
+00052e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052e10: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+00052e20: 5f74 645f 6175 746f 7265 7374 5f61 6765  _td_autorest_age
+00052e30: 6e74 203d 204c 617a 7953 7461 636b 6564  nt = LazyStacked
+00052e40: 5465 6e73 6f72 4469 6374 280d 0a20 2020  TensorDict(..   
+00052e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052e60: 2020 2020 2020 2020 2020 2020 202a 5b74               *[t
+00052e70: 642e 656d 7074 7928 2920 666f 7220 7464  d.empty() for td
+00052e80: 2069 6e20 6167 656e 7473 5d2c 0d0a 2020   in agents],..  
 00052e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ea0: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-00052eb0: 6f62 735f 6b65 7973 3a0d 0a20 2020 2020  obs_keys:..     
-00052ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ed0: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
-00052ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ef0: 2020 2020 2020 2020 2020 2020 2069 7369               isi
-00052f00: 6e73 7461 6e63 6528 6b65 792c 2074 7570  nstance(key, tup
-00052f10: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
-00052f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052f30: 2020 2020 2061 6e64 206b 6579 5b3a 206c       and key[: l
-00052f40: 656e 2861 6765 6e74 5f6b 6579 295d 203d  en(agent_key)] =
-00052f50: 3d20 6167 656e 745f 6b65 790d 0a20 2020  = agent_key..   
-00052f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052f70: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
-00052f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052f90: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00052fa0: 205f 6167 656e 742c 205f 6d61 736b 2c20   _agent, _mask, 
-00052fb0: 5f73 6176 6564 5f74 645f 6175 746f 7265  _saved_td_autore
-00052fc0: 7374 5f61 6765 6e74 2069 6e20 7a69 7028  st_agent in zip(
-00052fd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00052ea0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00052eb0: 6163 6b5f 6469 6d3d 6167 656e 742e 7374  ack_dim=agent.st
+00052ec0: 6163 6b5f 6469 6d2c 0d0a 2020 2020 2020  ack_dim,..      
+00052ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052ee0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00052ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052f00: 2020 2020 2073 6176 6564 5f74 645f 6175       saved_td_au
+00052f10: 746f 7265 7374 5f61 6765 6e74 7320 3d20  torest_agents = 
+00052f20: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00052f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052f40: 2020 2073 6176 6564 5f74 645f 6175 746f     saved_td_auto
+00052f50: 7265 7374 5f61 6765 6e74 2e74 656e 736f  rest_agent.tenso
+00052f60: 7264 6963 7473 0d0a 2020 2020 2020 2020  rdicts..        
+00052f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052f80: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00052f90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00052fa0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00052fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052fc0: 2020 6167 656e 7473 203d 205b 6167 656e    agents = [agen
+00052fd0: 745d 0d0a 2020 2020 2020 2020 2020 2020  t]..            
 00052fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ff0: 2020 2020 2020 6167 656e 7473 2c20 6d61        agents, ma
-00053000: 736b 732c 2073 6176 6564 5f74 645f 6175  sks, saved_td_au
-00053010: 746f 7265 7374 5f61 6765 6e74 730d 0a20  torest_agents.. 
-00053020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053030: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00053040: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00053050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053060: 2020 2020 2020 2076 616c 203d 205f 6167         val = _ag
-00053070: 656e 742e 6765 7428 6b65 795b 6c65 6e28  ent.get(key[len(
-00053080: 6167 656e 745f 6b65 7929 203a 5d29 0d0a  agent_key) :])..
+00052ff0: 6d61 736b 7320 3d20 5b6d 6173 6b5d 0d0a  masks = [mask]..
+00053000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053010: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00053020: 645f 7464 5f61 7574 6f72 6573 745f 6167  d_td_autorest_ag
+00053030: 656e 7420 3d20 5f73 6176 6564 5f74 645f  ent = _saved_td_
+00053040: 6175 746f 7265 7374 2e73 6574 6465 6661  autorest.setdefa
+00053050: 756c 7428 0d0a 2020 2020 2020 2020 2020  ult(..          
+00053060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053070: 2020 2020 2020 6167 656e 745f 6b65 792c        agent_key,
+00053080: 2061 6765 6e74 2e65 6d70 7479 2829 0d0a   agent.empty()..
 00053090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000530a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000530b0: 2020 2020 7265 706c 6163 655f 616e 645f      replace_and_
-000530c0: 7365 7428 0d0a 2020 2020 2020 2020 2020  set(..          
-000530d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000530e0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-000530f0: 795b 6c65 6e28 6167 656e 745f 6b65 7929  y[len(agent_key)
-00053100: 203a 5d2c 0d0a 2020 2020 2020 2020 2020   :],..          
-00053110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053120: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00053130: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-00053140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053150: 2020 2020 2020 2020 2020 2020 5f6d 6173              _mas
-00053160: 6b2c 0d0a 2020 2020 2020 2020 2020 2020  k,..            
-00053170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053180: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00053190: 645f 7464 5f61 7574 6f72 6573 6574 3d5f  d_td_autoreset=_
-000531a0: 7361 7665 645f 7464 5f61 7574 6f72 6573  saved_td_autores
-000531b0: 745f 6167 656e 742c 0d0a 2020 2020 2020  t_agent,..      
-000531c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000531d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000531e0: 2020 6167 656e 743d 5f61 6765 6e74 2c0d    agent=_agent,.
+000530a0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+000530b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000530c0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+000530d0: 5f74 645f 6175 746f 7265 7374 5f61 6765  _td_autorest_age
+000530e0: 6e74 7320 3d20 5b73 6176 6564 5f74 645f  nts = [saved_td_
+000530f0: 6175 746f 7265 7374 5f61 6765 6e74 5d0d  autorest_agent].
+00053100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053110: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+00053120: 2069 6e20 6f62 735f 6b65 7973 3a0d 0a20   in obs_keys:.. 
+00053130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053140: 2020 2020 2020 2020 2020 2069 6620 280d             if (.
+00053150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053170: 2069 7369 6e73 7461 6e63 6528 6b65 792c   isinstance(key,
+00053180: 2074 7570 6c65 290d 0a20 2020 2020 2020   tuple)..       
+00053190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000531a0: 2020 2020 2020 2020 2061 6e64 206b 6579           and key
+000531b0: 5b3a 206c 656e 2861 6765 6e74 5f6b 6579  [: len(agent_key
+000531c0: 295d 203d 3d20 6167 656e 745f 6b65 790d  )] == agent_key.
+000531d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000531e0: 2020 2020 2020 2020 2020 2020 2029 3a0d               ):.
 000531f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00053200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053210: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00053220: 2020 2020 2020 2020 2020 2020 7061 7265              pare
-00053230: 6e74 732e 6170 7065 6e64 2864 6f6e 655f  nts.append(done_
-00053240: 6b65 795b 3a2d 315d 290d 0a20 2020 2020  key[:-1])..     
-00053250: 2020 2020 2020 2069 6620 5f73 6176 6564         if _saved
-00053260: 5f74 645f 6175 746f 7265 7374 2069 7320  _td_autorest is 
-00053270: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00053280: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00053290: 5f5f 6469 6374 5f5f 5b22 5f73 6176 6564  __dict__["_saved
-000532a0: 5f74 645f 6175 746f 7265 7374 225d 203d  _td_autorest"] =
-000532b0: 205f 7361 7665 645f 7464 5f61 7574 6f72   _saved_td_autor
-000532c0: 6573 740d 0a0d 0a20 2020 2020 2020 2072  est....        r
-000532d0: 6574 7572 6e20 7465 6e73 6f72 6469 6374  eturn tensordict
-000532e0: 0d0a 0d0a 2020 2020 6465 6620 5f72 6570  ....    def _rep
-000532f0: 6c61 6365 5f61 7574 6f5f 7265 7365 745f  lace_auto_reset_
-00053300: 7661 6c73 2873 656c 662c 202a 2c20 7465  vals(self, *, te
-00053310: 6e73 6f72 6469 6374 5f72 6573 6574 293a  nsordict_reset):
-00053320: 0d0a 2020 2020 2020 2020 5f73 6176 6564  ..        _saved
-00053330: 5f74 645f 6175 746f 7265 7374 203d 2073  _td_autorest = s
-00053340: 656c 662e 5f5f 6469 6374 5f5f 2e67 6574  elf.__dict__.get
-00053350: 2822 5f73 6176 6564 5f74 645f 6175 746f  ("_saved_td_auto
-00053360: 7265 7374 222c 204e 6f6e 6529 0d0a 2020  rest", None)..  
-00053370: 2020 2020 2020 6966 205f 7361 7665 645f        if _saved_
-00053380: 7464 5f61 7574 6f72 6573 7420 6973 204e  td_autorest is N
-00053390: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-000533a0: 2020 7265 7475 726e 2074 656e 736f 7264    return tensord
-000533b0: 6963 745f 7265 7365 740d 0a20 2020 2020  ict_reset..     
-000533c0: 2020 2069 6620 7365 6c66 2e5f 7369 6d70     if self._simp
-000533d0: 6c65 5f64 6f6e 653a 0d0a 2020 2020 2020  le_done:..      
-000533e0: 2020 2020 2020 666f 7220 6b65 792c 2076        for key, v
-000533f0: 616c 2069 6e20 7365 6c66 2e5f 7361 7665  al in self._save
-00053400: 645f 7464 5f61 7574 6f72 6573 742e 6974  d_td_autorest.it
-00053410: 656d 7328 5472 7565 2c20 5472 7565 293a  ems(True, True):
-00053420: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00053430: 2020 6966 205f 656e 6473 5f77 6974 6828    if _ends_with(
-00053440: 6b65 792c 2022 5f72 6573 6574 2229 3a0d  key, "_reset"):.
-00053450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00053460: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
-00053470: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00053480: 616c 5f73 6574 5f72 6567 203d 2076 616c  al_set_reg = val
-00053490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000534a0: 2020 7465 6e73 6f72 6469 6374 5f72 6573    tensordict_res
-000534b0: 6574 2e73 6574 286b 6579 2c20 7661 6c5f  et.set(key, val_
-000534c0: 7365 745f 7265 6729 0d0a 2020 2020 2020  set_reg)..      
-000534d0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-000534e0: 2020 2020 2066 6f72 2064 6f6e 655f 6b65       for done_ke
-000534f0: 7920 696e 2073 656c 662e 7061 7265 6e74  y in self.parent
-00053500: 2e64 6f6e 655f 6b65 7973 3a0d 0a20 2020  .done_keys:..   
-00053510: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00053520: 5f65 6e64 735f 7769 7468 2864 6f6e 655f  _ends_with(done_
-00053530: 6b65 792c 2022 646f 6e65 2229 3a0d 0a20  key, "done"):.. 
-00053540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053550: 2020 2061 6765 6e74 5f6b 6579 203d 2064     agent_key = d
-00053560: 6f6e 655f 6b65 795b 3a2d 315d 0d0a 2020  one_key[:-1]..  
-00053570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053580: 2020 6d61 736b 203d 2073 656c 662e 5f73    mask = self._s
-00053590: 6176 6564 5f74 645f 6175 746f 7265 7374  aved_td_autorest
-000535a0: 2e70 6f70 280d 0a20 2020 2020 2020 2020  .pop(..         
-000535b0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-000535c0: 7265 706c 6163 655f 6c61 7374 2864 6f6e  replace_last(don
-000535d0: 655f 6b65 792c 2022 5f5f 6d61 736b 5f5f  e_key, "__mask__
-000535e0: 2229 2c20 4e6f 6e65 0d0a 2020 2020 2020  "), None..      
-000535f0: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-00053600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00053610: 2020 2020 2069 6620 6d61 736b 2069 7320       if mask is 
-00053620: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00053630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053640: 2020 2061 6765 6e74 203d 2073 656c 662e     agent = self.
-00053650: 5f73 6176 6564 5f74 645f 6175 746f 7265  _saved_td_autore
-00053660: 7374 2e67 6574 2861 6765 6e74 5f6b 6579  st.get(agent_key
-00053670: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00053680: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00053690: 6973 696e 7374 616e 6365 2861 6765 6e74  isinstance(agent
-000536a0: 2c20 4c61 7a79 5374 6163 6b65 6454 656e  , LazyStackedTen
-000536b0: 736f 7244 6963 7429 3a0d 0a20 2020 2020  sorDict):..     
-000536c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000536d0: 2020 2020 2020 2061 6765 6e74 7320 3d20         agents = 
-000536e0: 6167 656e 742e 7465 6e73 6f72 6469 6374  agent.tensordict
-000536f0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-00053700: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00053710: 6173 6b73 203d 206d 6173 6b2e 756e 6269  asks = mask.unbi
-00053720: 6e64 2861 6765 6e74 2e73 7461 636b 5f64  nd(agent.stack_d
-00053730: 696d 290d 0a20 2020 2020 2020 2020 2020  im)..           
-00053740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053750: 2064 6573 7473 203d 2074 656e 736f 7264   dests = tensord
-00053760: 6963 745f 7265 7365 742e 7365 7464 6566  ict_reset.setdef
-00053770: 6175 6c74 280d 0a20 2020 2020 2020 2020  ault(..         
-00053780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053790: 2020 2020 2020 2061 6765 6e74 5f6b 6579         agent_key
-000537a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000537b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000537c0: 2020 204c 617a 7953 7461 636b 6564 5465     LazyStackedTe
-000537d0: 6e73 6f72 4469 6374 280d 0a20 2020 2020  nsorDict(..     
-000537e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000537f0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00053800: 5b74 642e 656d 7074 7928 2920 666f 7220  [td.empty() for 
-00053810: 7464 2069 6e20 6167 656e 7473 5d2c 0d0a  td in agents],..
+00053210: 2066 6f72 205f 6167 656e 742c 205f 6d61   for _agent, _ma
+00053220: 736b 2c20 5f73 6176 6564 5f74 645f 6175  sk, _saved_td_au
+00053230: 746f 7265 7374 5f61 6765 6e74 2069 6e20  torest_agent in 
+00053240: 7a69 7028 0d0a 2020 2020 2020 2020 2020  zip(..          
+00053250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053260: 2020 2020 2020 2020 2020 6167 656e 7473            agents
+00053270: 2c20 6d61 736b 732c 2073 6176 6564 5f74  , masks, saved_t
+00053280: 645f 6175 746f 7265 7374 5f61 6765 6e74  d_autorest_agent
+00053290: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+000532a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000532b0: 2020 2029 3a0d 0a20 2020 2020 2020 2020     ):..         
+000532c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000532d0: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+000532e0: 205f 6167 656e 742e 6765 7428 6b65 795b   _agent.get(key[
+000532f0: 6c65 6e28 6167 656e 745f 6b65 7929 203a  len(agent_key) :
+00053300: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00053310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053320: 2020 2020 2020 2020 7265 706c 6163 655f          replace_
+00053330: 616e 645f 7365 7428 0d0a 2020 2020 2020  and_set(..      
+00053340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053360: 2020 6b65 795b 6c65 6e28 6167 656e 745f    key[len(agent_
+00053370: 6b65 7929 203a 5d2c 0d0a 2020 2020 2020  key) :],..      
+00053380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000533a0: 2020 7661 6c2c 0d0a 2020 2020 2020 2020    val,..        
+000533b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000533c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000533d0: 5f6d 6173 6b2c 0d0a 2020 2020 2020 2020  _mask,..        
+000533e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000533f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053400: 7361 7665 645f 7464 5f61 7574 6f72 6573  saved_td_autores
+00053410: 6574 3d5f 7361 7665 645f 7464 5f61 7574  et=_saved_td_aut
+00053420: 6f72 6573 745f 6167 656e 742c 0d0a 2020  orest_agent,..  
+00053430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053450: 2020 2020 2020 6167 656e 743d 5f61 6765        agent=_age
+00053460: 6e74 2c0d 0a20 2020 2020 2020 2020 2020  nt,..           
+00053470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053480: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00053490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000534a0: 7061 7265 6e74 732e 6170 7065 6e64 2864  parents.append(d
+000534b0: 6f6e 655f 6b65 795b 3a2d 315d 290d 0a20  one_key[:-1]).. 
+000534c0: 2020 2020 2020 2020 2020 2069 6620 5f73             if _s
+000534d0: 6176 6564 5f74 645f 6175 746f 7265 7374  aved_td_autorest
+000534e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+000534f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00053500: 656c 662e 5f5f 6469 6374 5f5f 5b22 5f73  elf.__dict__["_s
+00053510: 6176 6564 5f74 645f 6175 746f 7265 7374  aved_td_autorest
+00053520: 225d 203d 205f 7361 7665 645f 7464 5f61  "] = _saved_td_a
+00053530: 7574 6f72 6573 740d 0a0d 0a20 2020 2020  utorest....     
+00053540: 2020 2072 6574 7572 6e20 7465 6e73 6f72     return tensor
+00053550: 6469 6374 0d0a 0d0a 2020 2020 6465 6620  dict....    def 
+00053560: 5f72 6570 6c61 6365 5f61 7574 6f5f 7265  _replace_auto_re
+00053570: 7365 745f 7661 6c73 2873 656c 662c 202a  set_vals(self, *
+00053580: 2c20 7465 6e73 6f72 6469 6374 5f72 6573  , tensordict_res
+00053590: 6574 293a 0d0a 2020 2020 2020 2020 5f73  et):..        _s
+000535a0: 6176 6564 5f74 645f 6175 746f 7265 7374  aved_td_autorest
+000535b0: 203d 2073 656c 662e 5f5f 6469 6374 5f5f   = self.__dict__
+000535c0: 2e67 6574 2822 5f73 6176 6564 5f74 645f  .get("_saved_td_
+000535d0: 6175 746f 7265 7374 222c 204e 6f6e 6529  autorest", None)
+000535e0: 0d0a 2020 2020 2020 2020 6966 205f 7361  ..        if _sa
+000535f0: 7665 645f 7464 5f61 7574 6f72 6573 7420  ved_td_autorest 
+00053600: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00053610: 2020 2020 2020 7265 7475 726e 2074 656e        return ten
+00053620: 736f 7264 6963 745f 7265 7365 740d 0a20  sordict_reset.. 
+00053630: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00053640: 7369 6d70 6c65 5f64 6f6e 653a 0d0a 2020  simple_done:..  
+00053650: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+00053660: 792c 2076 616c 2069 6e20 7365 6c66 2e5f  y, val in self._
+00053670: 7361 7665 645f 7464 5f61 7574 6f72 6573  saved_td_autores
+00053680: 742e 6974 656d 7328 5472 7565 2c20 5472  t.items(True, Tr
+00053690: 7565 293a 0d0a 2020 2020 2020 2020 2020  ue):..          
+000536a0: 2020 2020 2020 6966 205f 656e 6473 5f77        if _ends_w
+000536b0: 6974 6828 6b65 792c 2022 5f72 6573 6574  ith(key, "_reset
+000536c0: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
+000536d0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+000536e0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+000536f0: 2020 2076 616c 5f73 6574 5f72 6567 203d     val_set_reg =
+00053700: 2076 616c 0d0a 2020 2020 2020 2020 2020   val..          
+00053710: 2020 2020 2020 7465 6e73 6f72 6469 6374        tensordict
+00053720: 5f72 6573 6574 2e73 6574 286b 6579 2c20  _reset.set(key, 
+00053730: 7661 6c5f 7365 745f 7265 6729 0d0a 2020  val_set_reg)..  
+00053740: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00053750: 2020 2020 2020 2020 2066 6f72 2064 6f6e           for don
+00053760: 655f 6b65 7920 696e 2073 656c 662e 7061  e_key in self.pa
+00053770: 7265 6e74 2e64 6f6e 655f 6b65 7973 3a0d  rent.done_keys:.
+00053780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053790: 2069 6620 5f65 6e64 735f 7769 7468 2864   if _ends_with(d
+000537a0: 6f6e 655f 6b65 792c 2022 646f 6e65 2229  one_key, "done")
+000537b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000537c0: 2020 2020 2020 2061 6765 6e74 5f6b 6579         agent_key
+000537d0: 203d 2064 6f6e 655f 6b65 795b 3a2d 315d   = done_key[:-1]
+000537e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000537f0: 2020 2020 2020 6d61 736b 203d 2073 656c        mask = sel
+00053800: 662e 5f73 6176 6564 5f74 645f 6175 746f  f._saved_td_auto
+00053810: 7265 7374 2e70 6f70 280d 0a20 2020 2020  rest.pop(..     
 00053820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053840: 2020 2020 7374 6163 6b5f 6469 6d3d 6167      stack_dim=ag
-00053850: 656e 742e 7374 6163 6b5f 6469 6d2c 0d0a  ent.stack_dim,..
+00053830: 2020 205f 7265 706c 6163 655f 6c61 7374     _replace_last
+00053840: 2864 6f6e 655f 6b65 792c 2022 5f5f 6d61  (done_key, "__ma
+00053850: 736b 5f5f 2229 2c20 4e6f 6e65 0d0a 2020  sk__"), None..  
 00053860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053880: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00053890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000538a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000538b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000538c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000538d0: 2020 2020 2020 2020 2020 2020 2020 6167                ag
-000538e0: 656e 7473 203d 205b 6167 656e 745d 0d0a  ents = [agent]..
+00053870: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00053880: 2020 2020 2020 2020 2069 6620 6d61 736b           if mask
+00053890: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+000538a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000538b0: 2020 2020 2020 2061 6765 6e74 203d 2073         agent = s
+000538c0: 656c 662e 5f73 6176 6564 5f74 645f 6175  elf._saved_td_au
+000538d0: 746f 7265 7374 2e67 6574 2861 6765 6e74  torest.get(agent
+000538e0: 5f6b 6579 290d 0a0d 0a20 2020 2020 2020  _key)....       
 000538f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053900: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00053910: 7320 3d20 5b6d 6173 6b5d 0d0a 2020 2020  s = [mask]..    
-00053920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053930: 2020 2020 2020 2020 6465 7374 7320 3d20          dests = 
-00053940: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-00053950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053960: 2020 2074 656e 736f 7264 6963 745f 7265     tensordict_re
-00053970: 7365 742e 7365 7464 6566 6175 6c74 2861  set.setdefault(a
-00053980: 6765 6e74 5f6b 6579 2c20 6167 656e 742e  gent_key, agent.
-00053990: 656d 7074 7928 2929 0d0a 2020 2020 2020  empty())..      
-000539a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000539b0: 2020 2020 2020 5d0d 0a20 2020 2020 2020        ]..       
-000539c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000539d0: 2066 6f72 205f 6167 656e 742c 205f 6d61   for _agent, _ma
-000539e0: 736b 2c20 5f64 6573 7420 696e 207a 6970  sk, _dest in zip
-000539f0: 2861 6765 6e74 732c 206d 6173 6b73 2c20  (agents, masks, 
-00053a00: 6465 7374 7329 3a0d 0a20 2020 2020 2020  dests):..       
-00053a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053a20: 2020 2020 2066 6f72 206b 6579 2c20 7661       for key, va
-00053a30: 6c20 696e 205f 6167 656e 742e 6974 656d  l in _agent.item
-00053a40: 7328 5472 7565 2c20 5472 7565 293a 0d0a  s(True, True):..
+00053900: 2069 6620 6973 696e 7374 616e 6365 2861   if isinstance(a
+00053910: 6765 6e74 2c20 4c61 7a79 5374 6163 6b65  gent, LazyStacke
+00053920: 6454 656e 736f 7244 6963 7429 3a0d 0a20  dTensorDict):.. 
+00053930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053940: 2020 2020 2020 2020 2020 2061 6765 6e74             agent
+00053950: 7320 3d20 6167 656e 742e 7465 6e73 6f72  s = agent.tensor
+00053960: 6469 6374 730d 0a20 2020 2020 2020 2020  dicts..         
+00053970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053980: 2020 206d 6173 6b73 203d 206d 6173 6b2e     masks = mask.
+00053990: 756e 6269 6e64 2861 6765 6e74 2e73 7461  unbind(agent.sta
+000539a0: 636b 5f64 696d 290d 0a20 2020 2020 2020  ck_dim)..       
+000539b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000539c0: 2020 2020 2064 6573 7473 203d 2074 656e       dests = ten
+000539d0: 736f 7264 6963 745f 7265 7365 742e 7365  sordict_reset.se
+000539e0: 7464 6566 6175 6c74 280d 0a20 2020 2020  tdefault(..     
+000539f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053a00: 2020 2020 2020 2020 2020 2061 6765 6e74             agent
+00053a10: 5f6b 6579 2c0d 0a20 2020 2020 2020 2020  _key,..         
+00053a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053a30: 2020 2020 2020 204c 617a 7953 7461 636b         LazyStack
+00053a40: 6564 5465 6e73 6f72 4469 6374 280d 0a20  edTensorDict(.. 
 00053a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00053a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053a70: 6966 205f 656e 6473 5f77 6974 6828 6b65  if _ends_with(ke
-00053a80: 792c 2022 5f72 6573 6574 2229 3a0d 0a20  y, "_reset"):.. 
-00053a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053a70: 2020 202a 5b74 642e 656d 7074 7928 2920     *[td.empty() 
+00053a80: 666f 7220 7464 2069 6e20 6167 656e 7473  for td in agents
+00053a90: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
 00053aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053ab0: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
-00053ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053ad0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00053ae0: 6e6f 7420 5f6d 6173 6b2e 616c 6c28 293a  not _mask.all():
-00053af0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00053ab0: 2020 2020 2020 2020 7374 6163 6b5f 6469          stack_di
+00053ac0: 6d3d 6167 656e 742e 7374 6163 6b5f 6469  m=agent.stack_di
+00053ad0: 6d2c 0d0a 2020 2020 2020 2020 2020 2020  m,..            
+00053ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053af0: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
 00053b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053b10: 2020 2020 2020 7661 6c5f 6e6f 745f 7265        val_not_re
-00053b20: 7365 7420 3d20 5f64 6573 742e 6765 7428  set = _dest.get(
-00053b30: 6b65 7929 0d0a 2020 2020 2020 2020 2020  key)..          
+00053b10: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00053b20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00053b30: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
 00053b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053b50: 2020 2020 2020 2020 2020 7661 6c5f 7365            val_se
-00053b60: 745f 7265 6720 3d20 746f 7263 682e 7768  t_reg = torch.wh
-00053b70: 6572 6528 0d0a 2020 2020 2020 2020 2020  ere(..          
-00053b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053b90: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00053ba0: 7061 6e64 5f61 735f 7269 6768 7428 6d61  pand_as_right(ma
-00053bb0: 736b 2c20 7661 6c29 2c20 7661 6c2c 2076  sk, val), val, v
-00053bc0: 616c 5f6e 6f74 5f72 6573 6574 0d0a 2020  al_not_reset..  
-00053bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053bf0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-00053c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053c10: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00053c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053b50: 2020 6167 656e 7473 203d 205b 6167 656e    agents = [agen
+00053b60: 745d 0d0a 2020 2020 2020 2020 2020 2020  t]..            
+00053b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053b80: 6d61 736b 7320 3d20 5b6d 6173 6b5d 0d0a  masks = [mask]..
+00053b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053ba0: 2020 2020 2020 2020 2020 2020 6465 7374              dest
+00053bb0: 7320 3d20 5b0d 0a20 2020 2020 2020 2020  s = [..         
+00053bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053bd0: 2020 2020 2020 2074 656e 736f 7264 6963         tensordic
+00053be0: 745f 7265 7365 742e 7365 7464 6566 6175  t_reset.setdefau
+00053bf0: 6c74 2861 6765 6e74 5f6b 6579 2c20 6167  lt(agent_key, ag
+00053c00: 656e 742e 656d 7074 7928 2929 0d0a 2020  ent.empty())..  
+00053c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053c20: 2020 2020 2020 2020 2020 5d0d 0a20 2020            ]..   
 00053c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053c40: 7661 6c5f 7365 745f 7265 6720 3d20 7661  val_set_reg = va
-00053c50: 6c0d 0a20 2020 2020 2020 2020 2020 2020  l..             
-00053c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053c70: 2020 205f 6465 7374 2e73 6574 286b 6579     _dest.set(key
-00053c80: 2c20 7661 6c5f 7365 745f 7265 6729 0d0a  , val_set_reg)..
-00053c90: 2020 2020 2020 2020 6465 6c61 7474 7228          delattr(
-00053ca0: 7365 6c66 2c20 225f 7361 7665 645f 7464  self, "_saved_td
-00053cb0: 5f61 7574 6f72 6573 7422 290d 0a20 2020  _autorest")..   
-00053cc0: 2020 2020 2072 6574 7572 6e20 7465 6e73       return tens
-00053cd0: 6f72 6469 6374 5f72 6573 6574 0d0a       ordict_reset..
+00053c40: 2020 2020 2066 6f72 205f 6167 656e 742c       for _agent,
+00053c50: 205f 6d61 736b 2c20 5f64 6573 7420 696e   _mask, _dest in
+00053c60: 207a 6970 2861 6765 6e74 732c 206d 6173   zip(agents, mas
+00053c70: 6b73 2c20 6465 7374 7329 3a0d 0a20 2020  ks, dests):..   
+00053c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053c90: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+00053ca0: 2c20 7661 6c20 696e 205f 6167 656e 742e  , val in _agent.
+00053cb0: 6974 656d 7328 5472 7565 2c20 5472 7565  items(True, True
+00053cc0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00053cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053ce0: 2020 2020 6966 205f 656e 6473 5f77 6974      if _ends_wit
+00053cf0: 6828 6b65 792c 2022 5f72 6573 6574 2229  h(key, "_reset")
+00053d00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00053d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053d20: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
+00053d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053d50: 2069 6620 6e6f 7420 5f6d 6173 6b2e 616c   if not _mask.al
+00053d60: 6c28 293a 0d0a 2020 2020 2020 2020 2020  l():..          
+00053d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053d80: 2020 2020 2020 2020 2020 7661 6c5f 6e6f            val_no
+00053d90: 745f 7265 7365 7420 3d20 5f64 6573 742e  t_reset = _dest.
+00053da0: 6765 7428 6b65 7929 0d0a 2020 2020 2020  get(key)..      
+00053db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053dc0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00053dd0: 6c5f 7365 745f 7265 6720 3d20 746f 7263  l_set_reg = torc
+00053de0: 682e 7768 6572 6528 0d0a 2020 2020 2020  h.where(..      
+00053df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053e10: 2020 6578 7061 6e64 5f61 735f 7269 6768    expand_as_righ
+00053e20: 7428 6d61 736b 2c20 7661 6c29 2c20 7661  t(mask, val), va
+00053e30: 6c2c 2076 616c 5f6e 6f74 5f72 6573 6574  l, val_not_reset
+00053e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00053e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053e60: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00053e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053e80: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00053e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053eb0: 2020 2020 7661 6c5f 7365 745f 7265 6720      val_set_reg 
+00053ec0: 3d20 7661 6c0d 0a20 2020 2020 2020 2020  = val..         
+00053ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053ee0: 2020 2020 2020 205f 6465 7374 2e73 6574         _dest.set
+00053ef0: 286b 6579 2c20 7661 6c5f 7365 745f 7265  (key, val_set_re
+00053f00: 6729 0d0a 2020 2020 2020 2020 6465 6c61  g)..        dela
+00053f10: 7474 7228 7365 6c66 2c20 225f 7361 7665  ttr(self, "_save
+00053f20: 645f 7464 5f61 7574 6f72 6573 7422 290d  d_td_autorest").
+00053f30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00053f40: 7465 6e73 6f72 6469 6374 5f72 6573 6574  tensordict_reset
+00053f50: 0d0a                                     ..
```

## torchrl/modules/distributions/continuous.py

```diff
@@ -240,16 +240,14 @@
         self.min = min
         self.max = max
         self.update(loc, scale)
 
     def update(self, loc: torch.Tensor, scale: torch.Tensor) -> None:
         if self.tanh_loc:
             loc = (loc / self.upscale).tanh() * self.upscale
-        if self.non_trivial_max or self.non_trivial_min:
-            loc = loc + (self.max - self.min) / 2 + self.min
         self.loc = loc
         self.scale = scale
 
         base_dist = _TruncatedNormal(
             loc,
             scale,
             self.min.expand_as(loc),
```

## Comparing `torchrl_nightly-2024.5.1.dist-info/LICENSE` & `torchrl_nightly-2024.5.2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `torchrl_nightly-2024.5.1.dist-info/METADATA` & `torchrl_nightly-2024.5.2.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: torchrl-nightly
-Version: 2024.5.1
+Version: 2024.5.2
 Summary: UNKNOWN
 Home-page: https://github.com/pytorch/rl
 Author: torchrl contributors
 Author-email: vmoens@fb.com
 License: MIT
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3.8
```

## Comparing `torchrl_nightly-2024.5.1.dist-info/RECORD` & `torchrl_nightly-2024.5.2.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 build_tools/__init__.py,sha256=5xRGSM4YMr794wxfVj_SQly2cyHNyhXTdXdWUZJoM2M,183
 build_tools/setup_helpers/__init__.py,sha256=uwhUMyZq6dm1J5T_rjItc0aZb8-WSJFYd81pU3aJQsE,245
 build_tools/setup_helpers/extension.py,sha256=8u0VrdMo3WzXp1V9KrB_tq2EfkGkWncQ6G8yzW8gcyo,6085
 torchrl/__init__.py,sha256=Oqfb3ofEysouMJgCXiRDO8O8lXmSx8WnUGeHuGOFLEk,1452
 torchrl/_extension.py,sha256=WFFGPKmxcvSqa24P00NIJKP12nnNl7TRGpOQexWeb3E,1240
-torchrl/_torchrl.pyd,sha256=2hJD_EnkPMtGCNS3So4Pv_yKEnhpiMwiIkGU4l4lYOU,373760
+torchrl/_torchrl.pyd,sha256=OpSznb9rRwKG9pj-OTvWjyh3bnhA9Jd_yB7TS2fFoLM,373760
 torchrl/_utils.py,sha256=Lb2Z7yJVGZfJl7P_6UHVcjgwxI7dEAlbcHzadMZBENY,26867
-torchrl/version.py,sha256=DZvCfgqtPlMGRlgibfQKxStQ7OOq1ABjNuu18wpdexY,84
+torchrl/version.py,sha256=eWNV7fwNnzfCnS8Vaco81oRzZhbQPLPQC70pXIcukUk,84
 torchrl/collectors/__init__.py,sha256=goQsshbO1p0ecv1SFwyNuiKrIjmzZxCYFW0UFL_ybSI,394
 torchrl/collectors/collectors.py,sha256=twOr2KJqi3vs7xp8d2MC3CJvOdlFnPjVD3QOKM4-lLM,134396
 torchrl/collectors/utils.py,sha256=CE-eM-iI0eP8dHkOBK00HvEyWuF4kRnNu70J6TMUTjI,8610
 torchrl/collectors/distributed/__init__.py,sha256=5qoBlS2wvrEFc9SRGwNMDcvCJ_XukVLyyvX7MwN9slU,412
 torchrl/collectors/distributed/default_configs.py,sha256=RkY8hmAzDttCXAjfoqdvAsCSwaXdtN4AGWJ70hSUmic,674
 torchrl/collectors/distributed/generic.py,sha256=kfu8AN1pUHNnCJxn5LT9xr8wXbOTavVn1YD3mZIxQoU,40438
 torchrl/collectors/distributed/ray.py,sha256=np6BA5QUFgI8Zsnefh2iH4wbMaKVXvKML43ZwMlAwww,33423
@@ -52,15 +52,15 @@
 torchrl/envs/utils.py,sha256=OdIIpFue87iBiHEGlEoA1Tyfzt6g8HumZDI9mJo_eak,68344
 torchrl/envs/vec_envs.py,sha256=dwl_s9wFRaybjFL1l6OYXu3p0qlNvWZnDppqMt5PbNw,339
 torchrl/envs/libs/__init__.py,sha256=lkasVqgsmo3f-fNmYT1Nz2ME7LOThVDUT8HzjdTLfAU,874
 torchrl/envs/libs/_gym_utils.py,sha256=I-pbJbhUg6kgKTuyMYBoPATsbdP6nXP6PQcyDbvS_Ac,10400
 torchrl/envs/libs/brax.py,sha256=-JYHn-BrmFshaBkuMxnFwlG_4TNWi3s-wuSoquwdzyw,24078
 torchrl/envs/libs/dm_control.py,sha256=rVZcio8HPgQ47jJK0scoE_oHu9rHpOEJV35hLPO2wnw,20968
 torchrl/envs/libs/envpool.py,sha256=ZoWReQEuoslEOMN588S8l239HGv5V4HLfZN3f7aYEyE,16723
-torchrl/envs/libs/gym.py,sha256=1BorNSDZwNApd-8DjwPC3KxTgKewlbJH6hxlAprFlfQ,62433
+torchrl/envs/libs/gym.py,sha256=DFngbWuUDtR8695bnSmOQoxesQQPAXH7WeQbXq-eLXE,62823
 torchrl/envs/libs/habitat.py,sha256=_7sH1VW1800-whGChi5ixwdm886_c7iwCO1FxmX7EXs,5437
 torchrl/envs/libs/isaacgym.py,sha256=bOoxcou0Tb1vosaZFPWpCiEiyhdB0wvIeBilPCSntNQ,6954
 torchrl/envs/libs/jax_utils.py,sha256=cU-M1fJUNEAXaHVLjFbxtXwukb8OVV740b2F6uOASeQ,5333
 torchrl/envs/libs/jumanji.py,sha256=ofK0MnbFTQtMkLOCwdkPis8h8ulrG3NMmYs8Su18Hro,38178
 torchrl/envs/libs/meltingpot.py,sha256=X67z_4RH1PgmhyYOvhFhywzhaller7_MY7TBlyFMzic,26778
 torchrl/envs/libs/openml.py,sha256=mrlZdadYF2CocGLHQWFC6KodQZDkknvSdyQi_Po2vk4,6019
 torchrl/envs/libs/pettingzoo.py,sha256=DClexiLo3-laatPRvjeivirSp5ocM-PPa6DXjT8Skxs,47103
@@ -73,21 +73,21 @@
 torchrl/envs/model_based/dreamer.py,sha256=oLlhoDLNq94NUANrwEWF1TW0VZPgox8ZmAJHi6Z_bTo,3487
 torchrl/envs/transforms/__init__.py,sha256=FC77waW5YJI_e7ZVX5VPYiO_Y1PHqwms7cEH566j9dY,1473
 torchrl/envs/transforms/functional.py,sha256=yyLZRk246UEUEXjdbzfLNY0tDR9O32QsoqoQ_tAxkPU,1485
 torchrl/envs/transforms/gym_transforms.py,sha256=rWcN35teiGtPrMP_Pe3nRufgF4pcO4mNp8XBCsyKdWQ,10062
 torchrl/envs/transforms/r3m.py,sha256=I6XArEwibW-7df8untO-QG6aW3yTdzUuC7tHJvHTqnw,13933
 torchrl/envs/transforms/rb_transforms.py,sha256=abe85Xr_Aoea7RdvqefxqgzHvD8YScY2824G-gtQILw,7684
 torchrl/envs/transforms/rlhf.py,sha256=mqV5p4919CDOdBSFqWKR_EZGuxTDBkeiOKjjVcnEfPw,10085
-torchrl/envs/transforms/transforms.py,sha256=1DaLoF9IsF3NKZFput8YGqpOAImR9vDkNWnv5PlVVK8,343262
+torchrl/envs/transforms/transforms.py,sha256=_Wg1tJz6iM4bi6_94xK6bhZOszY2C3scD1kZbJuYTY0,343890
 torchrl/envs/transforms/utils.py,sha256=xvrC9HjSXGW3mMgFgaFOtXZL_F5eR5CDb9E2XM1fsOc,2094
 torchrl/envs/transforms/vc1.py,sha256=tfmoCrZeME2oRC-G3D0560h5NAm5AsptBfUKfHLFEjY,10883
 torchrl/envs/transforms/vip.py,sha256=jIZFxWHaVkPfPrGPDN9KuR50gLr1xGbeRADh_hl9ZjY,15290
 torchrl/modules/__init__.py,sha256=_x_dM4y9IuxDntUNN2J7WNazEQZcSHtqkwovz0okZw8,1903
 torchrl/modules/distributions/__init__.py,sha256=yNx8ZiNT-tlyaspv8K7KiTBiUPuRelo2aFiWfyVyVX4,681
-torchrl/modules/distributions/continuous.py,sha256=O5AEXqsAkCnLFBXZtASm2BkVHo9_ao3zyG4HFpvGr7E,21547
+torchrl/modules/distributions/continuous.py,sha256=SPo0UpKMRrycur3sPfiD7pOHZGXapuepe-4a04I6PCE,21427
 torchrl/modules/distributions/discrete.py,sha256=ZoTEqTGXUqfZCz3jeq51FBSB3vFT7Lr52nEAZeCKzSQ,17803
 torchrl/modules/distributions/truncated_normal.py,sha256=dUncBbziOfwzCVsXx4f5EzVEK6_Wl7oR2VsjOYhac_0,6123
 torchrl/modules/distributions/utils.py,sha256=gZXO1yekg9rA-leslR7KWYo9tALg13oRs-5EqAGwjeY,6115
 torchrl/modules/models/__init__.py,sha256=6f8E7bfoS5hx28npirpHd-ByENa2pittZcqCNx3UVgI,884
 torchrl/modules/models/decision_transformer.py,sha256=gkZ1o_BeUIcEJ_EnUvD-v6vsPdeZ0fow9Tkj4PGepVs,6727
 torchrl/modules/models/exploration.py,sha256=JBU3YdYbwACPFirT7QyZTS74EDHidrJLMpzkZ00ToA0,21920
 torchrl/modules/models/model_based.py,sha256=3TYMF0O6Ek46xp3_kIo9CCFvoRVpkdbM8npQ-14Ta4g,14291
@@ -149,12 +149,12 @@
 torchrl/trainers/helpers/collectors.py,sha256=ogz7u_5BouixtF-DfTUN30AOFPNALnrjrymyxgqdyXM,19326
 torchrl/trainers/helpers/envs.py,sha256=Ee5BrAKApgfJXLySPw8Hik7yAwWJYonjCq8nhJ1bsrc,22336
 torchrl/trainers/helpers/logger.py,sha256=hLSo1MUl490z9-0GuZ2MS1WDSFqpLl1-oMGGA4Ubtgk,1275
 torchrl/trainers/helpers/losses.py,sha256=a8H2f0uarBZ2EqeOOh3LCu5SVcKf8hRVk9KNKrm5l-A,5389
 torchrl/trainers/helpers/models.py,sha256=60g7XXYmukgRzJsGr6BbzB8LPx9gSyx30pmyiFr9x9M,22664
 torchrl/trainers/helpers/replay_buffer.py,sha256=Wnmxx8TZqqb27ulRRE1opPaukrHEtsuN2f1or5uie_k,1985
 torchrl/trainers/helpers/trainers.py,sha256=bpH8SBtSUsltmHWsZiXgH5LoDIHpkBGwjhTQXhRFMrA,12385
-torchrl_nightly-2024.5.1.dist-info/LICENSE,sha256=PGO-oZsq4EzhE1-WQS2xGiEF3UCVb9YawfQ09cIMV_8,1119
-torchrl_nightly-2024.5.1.dist-info/METADATA,sha256=mmQ7gKZ9tZGWU2-QZ-2C1lOFFCbv3PWi0YmFfdg-OA0,32621
-torchrl_nightly-2024.5.1.dist-info/WHEEL,sha256=Z6c-bE0pUM47a70GvqO_SvH_XXU0lm62gEAKtoNJ08A,100
-torchrl_nightly-2024.5.1.dist-info/top_level.txt,sha256=JeTJ1jV7QJwLcUS1nr21aPn_wb-XlAZ9c-z_EH472JA,20
-torchrl_nightly-2024.5.1.dist-info/RECORD,,
+torchrl_nightly-2024.5.2.dist-info/LICENSE,sha256=PGO-oZsq4EzhE1-WQS2xGiEF3UCVb9YawfQ09cIMV_8,1119
+torchrl_nightly-2024.5.2.dist-info/METADATA,sha256=tW_aw9aIFQQPEDWPD92gT4rWMr1RX1pjpscDSBMQCUk,32621
+torchrl_nightly-2024.5.2.dist-info/WHEEL,sha256=Z6c-bE0pUM47a70GvqO_SvH_XXU0lm62gEAKtoNJ08A,100
+torchrl_nightly-2024.5.2.dist-info/top_level.txt,sha256=JeTJ1jV7QJwLcUS1nr21aPn_wb-XlAZ9c-z_EH472JA,20
+torchrl_nightly-2024.5.2.dist-info/RECORD,,
```

